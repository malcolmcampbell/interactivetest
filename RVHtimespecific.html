<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<style>body{background-color:white;}</style>
<script>(function() {
  // If window.HTMLWidgets is already defined, then use it; otherwise create a
  // new object. This allows preceding code to set options that affect the
  // initialization process (though none currently exist).
  window.HTMLWidgets = window.HTMLWidgets || {};

  // See if we're running in a viewer pane. If not, we're in a web browser.
  var viewerMode = window.HTMLWidgets.viewerMode =
      /\bviewer_pane=1\b/.test(window.location);

  // See if we're running in Shiny mode. If not, it's a static document.
  // Note that static widgets can appear in both Shiny and static modes, but
  // obviously, Shiny widgets can only appear in Shiny apps/documents.
  var shinyMode = window.HTMLWidgets.shinyMode =
      typeof(window.Shiny) !== "undefined" && !!window.Shiny.outputBindings;

  // We can't count on jQuery being available, so we implement our own
  // version if necessary.
  function querySelectorAll(scope, selector) {
    if (typeof(jQuery) !== "undefined" && scope instanceof jQuery) {
      return scope.find(selector);
    }
    if (scope.querySelectorAll) {
      return scope.querySelectorAll(selector);
    }
  }

  function asArray(value) {
    if (value === null)
      return [];
    if ($.isArray(value))
      return value;
    return [value];
  }

  // Implement jQuery's extend
  function extend(target /*, ... */) {
    if (arguments.length == 1) {
      return target;
    }
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      for (var prop in source) {
        if (source.hasOwnProperty(prop)) {
          target[prop] = source[prop];
        }
      }
    }
    return target;
  }

  // IE8 doesn't support Array.forEach.
  function forEach(values, callback, thisArg) {
    if (values.forEach) {
      values.forEach(callback, thisArg);
    } else {
      for (var i = 0; i < values.length; i++) {
        callback.call(thisArg, values[i], i, values);
      }
    }
  }

  // Replaces the specified method with the return value of funcSource.
  //
  // Note that funcSource should not BE the new method, it should be a function
  // that RETURNS the new method. funcSource receives a single argument that is
  // the overridden method, it can be called from the new method. The overridden
  // method can be called like a regular function, it has the target permanently
  // bound to it so "this" will work correctly.
  function overrideMethod(target, methodName, funcSource) {
    var superFunc = target[methodName] || function() {};
    var superFuncBound = function() {
      return superFunc.apply(target, arguments);
    };
    target[methodName] = funcSource(superFuncBound);
  }

  // Add a method to delegator that, when invoked, calls
  // delegatee.methodName. If there is no such method on
  // the delegatee, but there was one on delegator before
  // delegateMethod was called, then the original version
  // is invoked instead.
  // For example:
  //
  // var a = {
  //   method1: function() { console.log('a1'); }
  //   method2: function() { console.log('a2'); }
  // };
  // var b = {
  //   method1: function() { console.log('b1'); }
  // };
  // delegateMethod(a, b, "method1");
  // delegateMethod(a, b, "method2");
  // a.method1();
  // a.method2();
  //
  // The output would be "b1", "a2".
  function delegateMethod(delegator, delegatee, methodName) {
    var inherited = delegator[methodName];
    delegator[methodName] = function() {
      var target = delegatee;
      var method = delegatee[methodName];

      // The method doesn't exist on the delegatee. Instead,
      // call the method on the delegator, if it exists.
      if (!method) {
        target = delegator;
        method = inherited;
      }

      if (method) {
        return method.apply(target, arguments);
      }
    };
  }

  // Implement a vague facsimilie of jQuery's data method
  function elementData(el, name, value) {
    if (arguments.length == 2) {
      return el["htmlwidget_data_" + name];
    } else if (arguments.length == 3) {
      el["htmlwidget_data_" + name] = value;
      return el;
    } else {
      throw new Error("Wrong number of arguments for elementData: " +
        arguments.length);
    }
  }

  // http://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex
  function escapeRegExp(str) {
    return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
  }

  function hasClass(el, className) {
    var re = new RegExp("\\b" + escapeRegExp(className) + "\\b");
    return re.test(el.className);
  }

  // elements - array (or array-like object) of HTML elements
  // className - class name to test for
  // include - if true, only return elements with given className;
  //   if false, only return elements *without* given className
  function filterByClass(elements, className, include) {
    var results = [];
    for (var i = 0; i < elements.length; i++) {
      if (hasClass(elements[i], className) == include)
        results.push(elements[i]);
    }
    return results;
  }

  function on(obj, eventName, func) {
    if (obj.addEventListener) {
      obj.addEventListener(eventName, func, false);
    } else if (obj.attachEvent) {
      obj.attachEvent(eventName, func);
    }
  }

  function off(obj, eventName, func) {
    if (obj.removeEventListener)
      obj.removeEventListener(eventName, func, false);
    else if (obj.detachEvent) {
      obj.detachEvent(eventName, func);
    }
  }

  // Translate array of values to top/right/bottom/left, as usual with
  // the "padding" CSS property
  // https://developer.mozilla.org/en-US/docs/Web/CSS/padding
  function unpackPadding(value) {
    if (typeof(value) === "number")
      value = [value];
    if (value.length === 1) {
      return {top: value[0], right: value[0], bottom: value[0], left: value[0]};
    }
    if (value.length === 2) {
      return {top: value[0], right: value[1], bottom: value[0], left: value[1]};
    }
    if (value.length === 3) {
      return {top: value[0], right: value[1], bottom: value[2], left: value[1]};
    }
    if (value.length === 4) {
      return {top: value[0], right: value[1], bottom: value[2], left: value[3]};
    }
  }

  // Convert an unpacked padding object to a CSS value
  function paddingToCss(paddingObj) {
    return paddingObj.top + "px " + paddingObj.right + "px " + paddingObj.bottom + "px " + paddingObj.left + "px";
  }

  // Makes a number suitable for CSS
  function px(x) {
    if (typeof(x) === "number")
      return x + "px";
    else
      return x;
  }

  // Retrieves runtime widget sizing information for an element.
  // The return value is either null, or an object with fill, padding,
  // defaultWidth, defaultHeight fields.
  function sizingPolicy(el) {
    var sizingEl = document.querySelector("script[data-for='" + el.id + "'][type='application/htmlwidget-sizing']");
    if (!sizingEl)
      return null;
    var sp = JSON.parse(sizingEl.textContent || sizingEl.text || "{}");
    if (viewerMode) {
      return sp.viewer;
    } else {
      return sp.browser;
    }
  }

  // @param tasks Array of strings (or falsy value, in which case no-op).
  //   Each element must be a valid JavaScript expression that yields a
  //   function. Or, can be an array of objects with "code" and "data"
  //   properties; in this case, the "code" property should be a string
  //   of JS that's an expr that yields a function, and "data" should be
  //   an object that will be added as an additional argument when that
  //   function is called.
  // @param target The object that will be "this" for each function
  //   execution.
  // @param args Array of arguments to be passed to the functions. (The
  //   same arguments will be passed to all functions.)
  function evalAndRun(tasks, target, args) {
    if (tasks) {
      forEach(tasks, function(task) {
        var theseArgs = args;
        if (typeof(task) === "object") {
          theseArgs = theseArgs.concat([task.data]);
          task = task.code;
        }
        var taskFunc = tryEval(task);
        if (typeof(taskFunc) !== "function") {
          throw new Error("Task must be a function! Source:\n" + task);
        }
        taskFunc.apply(target, theseArgs);
      });
    }
  }

  // Attempt eval() both with and without enclosing in parentheses.
  // Note that enclosing coerces a function declaration into
  // an expression that eval() can parse
  // (otherwise, a SyntaxError is thrown)
  function tryEval(code) {
    var result = null;
    try {
      result = eval("(" + code + ")");
    } catch(error) {
      if (!(error instanceof SyntaxError)) {
        throw error;
      }
      try {
        result = eval(code);
      } catch(e) {
        if (e instanceof SyntaxError) {
          throw error;
        } else {
          throw e;
        }
      }
    }
    return result;
  }

  function initSizing(el) {
    var sizing = sizingPolicy(el);
    if (!sizing)
      return;

    var cel = document.getElementById("htmlwidget_container");
    if (!cel)
      return;

    if (typeof(sizing.padding) !== "undefined") {
      document.body.style.margin = "0";
      document.body.style.padding = paddingToCss(unpackPadding(sizing.padding));
    }

    if (sizing.fill) {
      document.body.style.overflow = "hidden";
      document.body.style.width = "100%";
      document.body.style.height = "100%";
      document.documentElement.style.width = "100%";
      document.documentElement.style.height = "100%";
      cel.style.position = "absolute";
      var pad = unpackPadding(sizing.padding);
      cel.style.top = pad.top + "px";
      cel.style.right = pad.right + "px";
      cel.style.bottom = pad.bottom + "px";
      cel.style.left = pad.left + "px";
      el.style.width = "100%";
      el.style.height = "100%";

      return {
        getWidth: function() { return cel.getBoundingClientRect().width; },
        getHeight: function() { return cel.getBoundingClientRect().height; }
      };

    } else {
      el.style.width = px(sizing.width);
      el.style.height = px(sizing.height);

      return {
        getWidth: function() { return cel.getBoundingClientRect().width; },
        getHeight: function() { return cel.getBoundingClientRect().height; }
      };
    }
  }

  // Default implementations for methods
  var defaults = {
    find: function(scope) {
      return querySelectorAll(scope, "." + this.name);
    },
    renderError: function(el, err) {
      var $el = $(el);

      this.clearError(el);

      // Add all these error classes, as Shiny does
      var errClass = "shiny-output-error";
      if (err.type !== null) {
        // use the classes of the error condition as CSS class names
        errClass = errClass + " " + $.map(asArray(err.type), function(type) {
          return errClass + "-" + type;
        }).join(" ");
      }
      errClass = errClass + " htmlwidgets-error";

      // Is el inline or block? If inline or inline-block, just display:none it
      // and add an inline error.
      var display = $el.css("display");
      $el.data("restore-display-mode", display);

      if (display === "inline" || display === "inline-block") {
        $el.hide();
        if (err.message !== "") {
          var errorSpan = $("<span>").addClass(errClass);
          errorSpan.text(err.message);
          $el.after(errorSpan);
        }
      } else if (display === "block") {
        // If block, add an error just after the el, set visibility:none on the
        // el, and position the error to be on top of the el.
        // Mark it with a unique ID and CSS class so we can remove it later.
        $el.css("visibility", "hidden");
        if (err.message !== "") {
          var errorDiv = $("<div>").addClass(errClass).css("position", "absolute")
            .css("top", el.offsetTop)
            .css("left", el.offsetLeft)
            // setting width can push out the page size, forcing otherwise
            // unnecessary scrollbars to appear and making it impossible for
            // the element to shrink; so use max-width instead
            .css("maxWidth", el.offsetWidth)
            .css("height", el.offsetHeight);
          errorDiv.text(err.message);
          $el.after(errorDiv);

          // Really dumb way to keep the size/position of the error in sync with
          // the parent element as the window is resized or whatever.
          var intId = setInterval(function() {
            if (!errorDiv[0].parentElement) {
              clearInterval(intId);
              return;
            }
            errorDiv
              .css("top", el.offsetTop)
              .css("left", el.offsetLeft)
              .css("maxWidth", el.offsetWidth)
              .css("height", el.offsetHeight);
          }, 500);
        }
      }
    },
    clearError: function(el) {
      var $el = $(el);
      var display = $el.data("restore-display-mode");
      $el.data("restore-display-mode", null);

      if (display === "inline" || display === "inline-block") {
        if (display)
          $el.css("display", display);
        $(el.nextSibling).filter(".htmlwidgets-error").remove();
      } else if (display === "block"){
        $el.css("visibility", "inherit");
        $(el.nextSibling).filter(".htmlwidgets-error").remove();
      }
    },
    sizing: {}
  };

  // Called by widget bindings to register a new type of widget. The definition
  // object can contain the following properties:
  // - name (required) - A string indicating the binding name, which will be
  //   used by default as the CSS classname to look for.
  // - initialize (optional) - A function(el) that will be called once per
  //   widget element; if a value is returned, it will be passed as the third
  //   value to renderValue.
  // - renderValue (required) - A function(el, data, initValue) that will be
  //   called with data. Static contexts will cause this to be called once per
  //   element; Shiny apps will cause this to be called multiple times per
  //   element, as the data changes.
  window.HTMLWidgets.widget = function(definition) {
    if (!definition.name) {
      throw new Error("Widget must have a name");
    }
    if (!definition.type) {
      throw new Error("Widget must have a type");
    }
    // Currently we only support output widgets
    if (definition.type !== "output") {
      throw new Error("Unrecognized widget type '" + definition.type + "'");
    }
    // TODO: Verify that .name is a valid CSS classname

    // Support new-style instance-bound definitions. Old-style class-bound
    // definitions have one widget "object" per widget per type/class of
    // widget; the renderValue and resize methods on such widget objects
    // take el and instance arguments, because the widget object can't
    // store them. New-style instance-bound definitions have one widget
    // object per widget instance; the definition that's passed in doesn't
    // provide renderValue or resize methods at all, just the single method
    //   factory(el, width, height)
    // which returns an object that has renderValue(x) and resize(w, h).
    // This enables a far more natural programming style for the widget
    // author, who can store per-instance state using either OO-style
    // instance fields or functional-style closure variables (I guess this
    // is in contrast to what can only be called C-style pseudo-OO which is
    // what we required before).
    if (definition.factory) {
      definition = createLegacyDefinitionAdapter(definition);
    }

    if (!definition.renderValue) {
      throw new Error("Widget must have a renderValue function");
    }

    // For static rendering (non-Shiny), use a simple widget registration
    // scheme. We also use this scheme for Shiny apps/documents that also
    // contain static widgets.
    window.HTMLWidgets.widgets = window.HTMLWidgets.widgets || [];
    // Merge defaults into the definition; don't mutate the original definition.
    var staticBinding = extend({}, defaults, definition);
    overrideMethod(staticBinding, "find", function(superfunc) {
      return function(scope) {
        var results = superfunc(scope);
        // Filter out Shiny outputs, we only want the static kind
        return filterByClass(results, "html-widget-output", false);
      };
    });
    window.HTMLWidgets.widgets.push(staticBinding);

    if (shinyMode) {
      // Shiny is running. Register the definition with an output binding.
      // The definition itself will not be the output binding, instead
      // we will make an output binding object that delegates to the
      // definition. This is because we foolishly used the same method
      // name (renderValue) for htmlwidgets definition and Shiny bindings
      // but they actually have quite different semantics (the Shiny
      // bindings receive data that includes lots of metadata that it
      // strips off before calling htmlwidgets renderValue). We can't
      // just ignore the difference because in some widgets it's helpful
      // to call this.renderValue() from inside of resize(), and if
      // we're not delegating, then that call will go to the Shiny
      // version instead of the htmlwidgets version.

      // Merge defaults with definition, without mutating either.
      var bindingDef = extend({}, defaults, definition);

      // This object will be our actual Shiny binding.
      var shinyBinding = new Shiny.OutputBinding();

      // With a few exceptions, we'll want to simply use the bindingDef's
      // version of methods if they are available, otherwise fall back to
      // Shiny's defaults. NOTE: If Shiny's output bindings gain additional
      // methods in the future, and we want them to be overrideable by
      // HTMLWidget binding definitions, then we'll need to add them to this
      // list.
      delegateMethod(shinyBinding, bindingDef, "getId");
      delegateMethod(shinyBinding, bindingDef, "onValueChange");
      delegateMethod(shinyBinding, bindingDef, "onValueError");
      delegateMethod(shinyBinding, bindingDef, "renderError");
      delegateMethod(shinyBinding, bindingDef, "clearError");
      delegateMethod(shinyBinding, bindingDef, "showProgress");

      // The find, renderValue, and resize are handled differently, because we
      // want to actually decorate the behavior of the bindingDef methods.

      shinyBinding.find = function(scope) {
        var results = bindingDef.find(scope);

        // Only return elements that are Shiny outputs, not static ones
        var dynamicResults = results.filter(".html-widget-output");

        // It's possible that whatever caused Shiny to think there might be
        // new dynamic outputs, also caused there to be new static outputs.
        // Since there might be lots of different htmlwidgets bindings, we
        // schedule execution for later--no need to staticRender multiple
        // times.
        if (results.length !== dynamicResults.length)
          scheduleStaticRender();

        return dynamicResults;
      };

      // Wrap renderValue to handle initialization, which unfortunately isn't
      // supported natively by Shiny at the time of this writing.

      shinyBinding.renderValue = function(el, data) {
        Shiny.renderDependencies(data.deps);
        // Resolve strings marked as javascript literals to objects
        if (!(data.evals instanceof Array)) data.evals = [data.evals];
        for (var i = 0; data.evals && i < data.evals.length; i++) {
          window.HTMLWidgets.evaluateStringMember(data.x, data.evals[i]);
        }
        if (!bindingDef.renderOnNullValue) {
          if (data.x === null) {
            el.style.visibility = "hidden";
            return;
          } else {
            el.style.visibility = "inherit";
          }
        }
        if (!elementData(el, "initialized")) {
          initSizing(el);

          elementData(el, "initialized", true);
          if (bindingDef.initialize) {
            var rect = el.getBoundingClientRect();
            var result = bindingDef.initialize(el, rect.width, rect.height);
            elementData(el, "init_result", result);
          }
        }
        bindingDef.renderValue(el, data.x, elementData(el, "init_result"));
        evalAndRun(data.jsHooks.render, elementData(el, "init_result"), [el, data.x]);
      };

      // Only override resize if bindingDef implements it
      if (bindingDef.resize) {
        shinyBinding.resize = function(el, width, height) {
          // Shiny can call resize before initialize/renderValue have been
          // called, which doesn't make sense for widgets.
          if (elementData(el, "initialized")) {
            bindingDef.resize(el, width, height, elementData(el, "init_result"));
          }
        };
      }

      Shiny.outputBindings.register(shinyBinding, bindingDef.name);
    }
  };

  var scheduleStaticRenderTimerId = null;
  function scheduleStaticRender() {
    if (!scheduleStaticRenderTimerId) {
      scheduleStaticRenderTimerId = setTimeout(function() {
        scheduleStaticRenderTimerId = null;
        window.HTMLWidgets.staticRender();
      }, 1);
    }
  }

  // Render static widgets after the document finishes loading
  // Statically render all elements that are of this widget's class
  window.HTMLWidgets.staticRender = function() {
    var bindings = window.HTMLWidgets.widgets || [];
    forEach(bindings, function(binding) {
      var matches = binding.find(document.documentElement);
      forEach(matches, function(el) {
        var sizeObj = initSizing(el, binding);

        var getSize = function(el) {
          if (sizeObj) {
            return {w: sizeObj.getWidth(), h: sizeObj.getHeight()}
          } else {
            var rect = el.getBoundingClientRect();
            return {w: rect.width, h: rect.height}
          }
        };

        if (hasClass(el, "html-widget-static-bound"))
          return;
        el.className = el.className + " html-widget-static-bound";

        var initResult;
        if (binding.initialize) {
          var size = getSize(el);
          initResult = binding.initialize(el, size.w, size.h);
          elementData(el, "init_result", initResult);
        }

        if (binding.resize) {
          var lastSize = getSize(el);
          var resizeHandler = function(e) {
            var size = getSize(el);
            if (size.w === 0 && size.h === 0)
              return;
            if (size.w === lastSize.w && size.h === lastSize.h)
              return;
            lastSize = size;
            binding.resize(el, size.w, size.h, initResult);
          };

          on(window, "resize", resizeHandler);

          // This is needed for cases where we're running in a Shiny
          // app, but the widget itself is not a Shiny output, but
          // rather a simple static widget. One example of this is
          // an rmarkdown document that has runtime:shiny and widget
          // that isn't in a render function. Shiny only knows to
          // call resize handlers for Shiny outputs, not for static
          // widgets, so we do it ourselves.
          if (window.jQuery) {
            window.jQuery(document).on(
              "shown.htmlwidgets shown.bs.tab.htmlwidgets shown.bs.collapse.htmlwidgets",
              resizeHandler
            );
            window.jQuery(document).on(
              "hidden.htmlwidgets hidden.bs.tab.htmlwidgets hidden.bs.collapse.htmlwidgets",
              resizeHandler
            );
          }

          // This is needed for the specific case of ioslides, which
          // flips slides between display:none and display:block.
          // Ideally we would not have to have ioslide-specific code
          // here, but rather have ioslides raise a generic event,
          // but the rmarkdown package just went to CRAN so the
          // window to getting that fixed may be long.
          if (window.addEventListener) {
            // It's OK to limit this to window.addEventListener
            // browsers because ioslides itself only supports
            // such browsers.
            on(document, "slideenter", resizeHandler);
            on(document, "slideleave", resizeHandler);
          }
        }

        var scriptData = document.querySelector("script[data-for='" + el.id + "'][type='application/json']");
        if (scriptData) {
          var data = JSON.parse(scriptData.textContent || scriptData.text);
          // Resolve strings marked as javascript literals to objects
          if (!(data.evals instanceof Array)) data.evals = [data.evals];
          for (var k = 0; data.evals && k < data.evals.length; k++) {
            window.HTMLWidgets.evaluateStringMember(data.x, data.evals[k]);
          }
          binding.renderValue(el, data.x, initResult);
          evalAndRun(data.jsHooks.render, initResult, [el, data.x]);
        }
      });
    });

    invokePostRenderHandlers();
  }


  function has_jQuery3() {
    if (!window.jQuery) {
      return false;
    }
    var $version = window.jQuery.fn.jquery;
    var $major_version = parseInt($version.split(".")[0]);
    return $major_version >= 3;
  }

  /*
  / Shiny 1.4 bumped jQuery from 1.x to 3.x which means jQuery's
  / on-ready handler (i.e., $(fn)) is now asyncronous (i.e., it now
  / really means $(setTimeout(fn)).
  / https://jquery.com/upgrade-guide/3.0/#breaking-change-document-ready-handlers-are-now-asynchronous
  /
  / Since Shiny uses $() to schedule initShiny, shiny>=1.4 calls initShiny
  / one tick later than it did before, which means staticRender() is
  / called renderValue() earlier than (advanced) widget authors might be expecting.
  / https://github.com/rstudio/shiny/issues/2630
  /
  / For a concrete example, leaflet has some methods (e.g., updateBounds)
  / which reference Shiny methods registered in initShiny (e.g., setInputValue).
  / Since leaflet is privy to this life-cycle, it knows to use setTimeout() to
  / delay execution of those methods (until Shiny methods are ready)
  / https://github.com/rstudio/leaflet/blob/18ec981/javascript/src/index.js#L266-L268
  /
  / Ideally widget authors wouldn't need to use this setTimeout() hack that
  / leaflet uses to call Shiny methods on a staticRender(). In the long run,
  / the logic initShiny should be broken up so that method registration happens
  / right away, but binding happens later.
  */
  function maybeStaticRenderLater() {
    if (shinyMode && has_jQuery3()) {
      window.jQuery(window.HTMLWidgets.staticRender);
    } else {
      window.HTMLWidgets.staticRender();
    }
  }

  if (document.addEventListener) {
    document.addEventListener("DOMContentLoaded", function() {
      document.removeEventListener("DOMContentLoaded", arguments.callee, false);
      maybeStaticRenderLater();
    }, false);
  } else if (document.attachEvent) {
    document.attachEvent("onreadystatechange", function() {
      if (document.readyState === "complete") {
        document.detachEvent("onreadystatechange", arguments.callee);
        maybeStaticRenderLater();
      }
    });
  }


  window.HTMLWidgets.getAttachmentUrl = function(depname, key) {
    // If no key, default to the first item
    if (typeof(key) === "undefined")
      key = 1;

    var link = document.getElementById(depname + "-" + key + "-attachment");
    if (!link) {
      throw new Error("Attachment " + depname + "/" + key + " not found in document");
    }
    return link.getAttribute("href");
  };

  window.HTMLWidgets.dataframeToD3 = function(df) {
    var names = [];
    var length;
    for (var name in df) {
        if (df.hasOwnProperty(name))
            names.push(name);
        if (typeof(df[name]) !== "object" || typeof(df[name].length) === "undefined") {
            throw new Error("All fields must be arrays");
        } else if (typeof(length) !== "undefined" && length !== df[name].length) {
            throw new Error("All fields must be arrays of the same length");
        }
        length = df[name].length;
    }
    var results = [];
    var item;
    for (var row = 0; row < length; row++) {
        item = {};
        for (var col = 0; col < names.length; col++) {
            item[names[col]] = df[names[col]][row];
        }
        results.push(item);
    }
    return results;
  };

  window.HTMLWidgets.transposeArray2D = function(array) {
      if (array.length === 0) return array;
      var newArray = array[0].map(function(col, i) {
          return array.map(function(row) {
              return row[i]
          })
      });
      return newArray;
  };
  // Split value at splitChar, but allow splitChar to be escaped
  // using escapeChar. Any other characters escaped by escapeChar
  // will be included as usual (including escapeChar itself).
  function splitWithEscape(value, splitChar, escapeChar) {
    var results = [];
    var escapeMode = false;
    var currentResult = "";
    for (var pos = 0; pos < value.length; pos++) {
      if (!escapeMode) {
        if (value[pos] === splitChar) {
          results.push(currentResult);
          currentResult = "";
        } else if (value[pos] === escapeChar) {
          escapeMode = true;
        } else {
          currentResult += value[pos];
        }
      } else {
        currentResult += value[pos];
        escapeMode = false;
      }
    }
    if (currentResult !== "") {
      results.push(currentResult);
    }
    return results;
  }
  // Function authored by Yihui/JJ Allaire
  window.HTMLWidgets.evaluateStringMember = function(o, member) {
    var parts = splitWithEscape(member, '.', '\\');
    for (var i = 0, l = parts.length; i < l; i++) {
      var part = parts[i];
      // part may be a character or 'numeric' member name
      if (o !== null && typeof o === "object" && part in o) {
        if (i == (l - 1)) { // if we are at the end of the line then evalulate
          if (typeof o[part] === "string")
            o[part] = tryEval(o[part]);
        } else { // otherwise continue to next embedded object
          o = o[part];
        }
      }
    }
  };

  // Retrieve the HTMLWidget instance (i.e. the return value of an
  // HTMLWidget binding's initialize() or factory() function)
  // associated with an element, or null if none.
  window.HTMLWidgets.getInstance = function(el) {
    return elementData(el, "init_result");
  };

  // Finds the first element in the scope that matches the selector,
  // and returns the HTMLWidget instance (i.e. the return value of
  // an HTMLWidget binding's initialize() or factory() function)
  // associated with that element, if any. If no element matches the
  // selector, or the first matching element has no HTMLWidget
  // instance associated with it, then null is returned.
  //
  // The scope argument is optional, and defaults to window.document.
  window.HTMLWidgets.find = function(scope, selector) {
    if (arguments.length == 1) {
      selector = scope;
      scope = document;
    }

    var el = scope.querySelector(selector);
    if (el === null) {
      return null;
    } else {
      return window.HTMLWidgets.getInstance(el);
    }
  };

  // Finds all elements in the scope that match the selector, and
  // returns the HTMLWidget instances (i.e. the return values of
  // an HTMLWidget binding's initialize() or factory() function)
  // associated with the elements, in an array. If elements that
  // match the selector don't have an associated HTMLWidget
  // instance, the returned array will contain nulls.
  //
  // The scope argument is optional, and defaults to window.document.
  window.HTMLWidgets.findAll = function(scope, selector) {
    if (arguments.length == 1) {
      selector = scope;
      scope = document;
    }

    var nodes = scope.querySelectorAll(selector);
    var results = [];
    for (var i = 0; i < nodes.length; i++) {
      results.push(window.HTMLWidgets.getInstance(nodes[i]));
    }
    return results;
  };

  var postRenderHandlers = [];
  function invokePostRenderHandlers() {
    while (postRenderHandlers.length) {
      var handler = postRenderHandlers.shift();
      if (handler) {
        handler();
      }
    }
  }

  // Register the given callback function to be invoked after the
  // next time static widgets are rendered.
  window.HTMLWidgets.addPostRenderHandler = function(callback) {
    postRenderHandlers.push(callback);
  };

  // Takes a new-style instance-bound definition, and returns an
  // old-style class-bound definition. This saves us from having
  // to rewrite all the logic in this file to accomodate both
  // types of definitions.
  function createLegacyDefinitionAdapter(defn) {
    var result = {
      name: defn.name,
      type: defn.type,
      initialize: function(el, width, height) {
        return defn.factory(el, width, height);
      },
      renderValue: function(el, x, instance) {
        return instance.renderValue(x);
      },
      resize: function(el, width, height, instance) {
        return instance.resize(width, height);
      }
    };

    if (defn.find)
      result.find = defn.find;
    if (defn.renderError)
      result.renderError = defn.renderError;
    if (defn.clearError)
      result.clearError = defn.clearError;

    return result;
  }
})();
</script>
<style type="text/css">.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.mapboxgl-canvas{left:0;position:absolute;top:0}.mapboxgl-map:-webkit-full-screen{height:100%;width:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-webkit-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom,.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-left,.mapboxgl-ctrl-right,.mapboxgl-ctrl-top,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.mapboxgl-ctrl-top-left{left:0;top:0}.mapboxgl-ctrl-top{left:50%;top:0;transform:translateX(-50%)}.mapboxgl-ctrl-top-right{right:0;top:0}.mapboxgl-ctrl-right{right:0;top:50%;transform:translateY(-50%)}.mapboxgl-ctrl-bottom-right{bottom:0;right:0}.mapboxgl-ctrl-bottom{bottom:0;left:50%;transform:translateX(-50%)}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-left{left:0;top:50%;transform:translateY(-50%)}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{float:left;margin:10px 0 0 10px}.mapboxgl-ctrl-top .mapboxgl-ctrl{float:left;margin:10px 0}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{float:right;margin:10px 10px 0 0}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl,.mapboxgl-ctrl-right .mapboxgl-ctrl{float:right;margin:0 10px 10px 0}.mapboxgl-ctrl-bottom .mapboxgl-ctrl{float:left;margin:10px 0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl,.mapboxgl-ctrl-left .mapboxgl-ctrl{float:left;margin:0 0 10px 10px}.mapboxgl-ctrl-group{background:#fff;border-radius:4px}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{background-color:initial;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;overflow:hidden;padding:0;width:29px}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:initial}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl-group button:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:only-child{border-radius:inherit}.mapboxgl-ctrl button:not(:disabled):hover{background-color:#0000000d}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 29 29'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle id='dot' cx='10' cy='10' r='2'/%3E%3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='%23f00'/%3E%3C/svg%3E")}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='0.9' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:initial;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23fff'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd' viewBox='0 0 88 23'%3E%3Cdefs%3E%3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='clip'%3E%3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/mask%3E%3Cg id='outline' opacity='1' stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E%3C/g%3E%3Cg id='fill' opacity='1' fill='%23000'%3E%3Cuse xlink:href='%23logo'/%3E%3Cuse xlink:href='%23text'/%3E%3C/g%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{background-color:#fff;border-radius:12px;box-sizing:initial;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:#0000000d}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{right:0;top:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{left:0;top:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}.mapboxgl-ctrl-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:#000000bf;text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px;white-space:nowrap}.mapboxgl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{border:10px solid #0000;height:0;width:0;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.mapboxgl-popup-close-button{background-color:initial;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.mapboxgl-popup-close-button:hover{background-color:#0000000d}.mapboxgl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:10px 10px 15px;pointer-events:auto;position:relative}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{left:0;opacity:1;position:absolute;top:0;transition:opacity .2s;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.mapboxgl-user-location-dot:before{animation:mapboxgl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.mapboxgl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading{height:0;width:0}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after,.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-bottom:7.5px solid #4aa1eb;content:"";position:absolute}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-left:7.5px solid #0000;transform:translateY(-28px) skewY(-20deg)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after{border-right:7.5px solid #0000;transform:translate(7.5px,-28px) skewY(20deg)}@keyframes mapboxgl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}@media print{.mapbox-improve-map{display:none}}.mapboxgl-scroll-zoom-blocker,.mapboxgl-touch-pan-blocker{align-items:center;background:#000000b3;color:#fff;display:flex;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;height:100%;justify-content:center;left:0;opacity:0;pointer-events:none;position:absolute;text-align:center;top:0;transition:opacity .75s ease-in-out;transition-delay:1s;width:100%}.mapboxgl-scroll-zoom-blocker-show,.mapboxgl-touch-pan-blocker-show{opacity:1;transition:opacity .1s ease-in-out}.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page,.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button{background-color:#fff;border:1px solid #ccc;border-radius:4px;color:#333;cursor:pointer;font-size:12px;height:auto;line-height:1.5;margin:2px;padding:5px 10px;width:auto}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button:hover{background-color:#f0f0f0}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button-selected{background-color:#4264fb;border-color:#4264fb;color:#fff}.mapboxgl-ctrl button.mapboxgl-ctrl-level-button-selected:hover{background-color:#3151d9}</style>
<style type="text/css">.mapboxgl-compare {
background-color:#fff;
position:absolute;
width:2px;
height:100%;
z-index:1;
}
.mapboxgl-compare .compare-swiper-vertical {
background-color:#3887be;
box-shadow:inset 0 0 0 2px #fff;
display:inline-block;
border-radius:50%;
position:absolute;
width:60px;
height:60px;
top:50%;
left:-30px;
margin:-30px 1px 0;
color: #fff;
cursor:ew-resize;
background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiICAgd2lkdGg9IjYwIiAgIGhlaWdodD0iNjAiICAgdmVyc2lvbj0iMS4xIiAgIHZpZXdCb3g9IjAgMCA2MCA2MCIgICBpZD0ic3ZnNTQzNCIgICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjkxK2RldmVsK29zeG1lbnUgcjEyOTExIiAgIHNvZGlwb2RpOmRvY25hbWU9Imwtci5zdmciPiAgPG1ldGFkYXRhICAgICBpZD0ibWV0YWRhdGE1NDQ0Ij4gICAgPHJkZjpSREY+ICAgICAgPGNjOldvcmsgICAgICAgICByZGY6YWJvdXQ9IiI+ICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4gICAgICAgIDxkYzp0eXBlICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+ICAgICAgPC9jYzpXb3JrPiAgICA8L3JkZjpSREY+ICA8L21ldGFkYXRhPiAgPGRlZnMgICAgIGlkPSJkZWZzNTQ0MiIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIgICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IiAgICAgYm9yZGVyb3BhY2l0eT0iMSIgICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiICAgICBncmlkdG9sZXJhbmNlPSIxMCIgICAgIGd1aWRldG9sZXJhbmNlPSIxMCIgICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwIiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIgICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTI4NiIgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijc1MSIgICAgIGlkPSJuYW1lZHZpZXc1NDQwIiAgICAgc2hvd2dyaWQ9InRydWUiICAgICBpbmtzY2FwZTp6b29tPSI0IiAgICAgaW5rc2NhcGU6Y3g9IjI1Ljg4OTgzMSIgICAgIGlua3NjYXBlOmN5PSIzNC4zODE4MzMiICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMCIgICAgIGlua3NjYXBlOndpbmRvdy15PSIyMyIgICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc1NDM0IiAgICAgaW5rc2NhcGU6b2JqZWN0LW5vZGVzPSJ0cnVlIiAgICAgaW5rc2NhcGU6c25hcC1zbW9vdGgtbm9kZXM9InRydWUiPiAgICA8aW5rc2NhcGU6Z3JpZCAgICAgICB0eXBlPSJ4eWdyaWQiICAgICAgIGlkPSJncmlkNTk4OSIgLz4gIDwvc29kaXBvZGk6bmFtZWR2aWV3PiAgPHBhdGggICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIiAgICAgZD0iTSAyNSAyNCBMIDE2IDMwIEwgMjUgMzYgTCAyNSAyNCB6IE0gMzUgMjQgTCAzNSAzNiBMIDQ0IDMwIEwgMzUgMjQgeiAiICAgICBpZD0icGF0aDU5OTUiIC8+PC9zdmc+);
}
.mapboxgl-compare-horizontal {
position:relative;
width:100%;
height:2px;
}
.mapboxgl-compare .compare-swiper-horizontal {
background-color:#3887be;
box-shadow:inset 0 0 0 2px #fff;
display:inline-block;
border-radius:50%;
position:absolute;
width:60px;
height:60px;
top:50%;
left:50%;
margin:-30px 1px 0;
color: #fff;
cursor:ns-resize;
background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIgICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiICAgd2lkdGg9IjYwIiAgIGhlaWdodD0iNjAiICAgdmVyc2lvbj0iMS4xIiAgIHZpZXdCb3g9IjAgMCA2MCA2MCIgICBpZD0ic3ZnNTQzNCIgICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjkxK2RldmVsK29zeG1lbnUgcjEyOTExIiAgIHNvZGlwb2RpOmRvY25hbWU9Imwtci5zdmciPiAgPG1ldGFkYXRhICAgICBpZD0ibWV0YWRhdGE1NDQ0Ij4gICAgPHJkZjpSREY+ICAgICAgPGNjOldvcmsgICAgICAgICByZGY6YWJvdXQ9IiI+ICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4gICAgICAgIDxkYzp0eXBlICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+ICAgICAgPC9jYzpXb3JrPiAgICA8L3JkZjpSREY+ICA8L21ldGFkYXRhPiAgPGRlZnMgICAgIGlkPSJkZWZzNTQ0MiIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIgICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IiAgICAgYm9yZGVyb3BhY2l0eT0iMSIgICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiICAgICBncmlkdG9sZXJhbmNlPSIxMCIgICAgIGd1aWRldG9sZXJhbmNlPSIxMCIgICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwIiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIgICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTI4NiIgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijc1MSIgICAgIGlkPSJuYW1lZHZpZXc1NDQwIiAgICAgc2hvd2dyaWQ9InRydWUiICAgICBpbmtzY2FwZTp6b29tPSI0IiAgICAgaW5rc2NhcGU6Y3g9IjI1Ljg4OTgzMSIgICAgIGlua3NjYXBlOmN5PSIzNC4zODE4MzMiICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMCIgICAgIGlua3NjYXBlOndpbmRvdy15PSIyMyIgICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc1NDM0IiAgICAgaW5rc2NhcGU6b2JqZWN0LW5vZGVzPSJ0cnVlIiAgICAgaW5rc2NhcGU6c25hcC1zbW9vdGgtbm9kZXM9InRydWUiPiAgICA8aW5rc2NhcGU6Z3JpZCAgICAgICB0eXBlPSJ4eWdyaWQiICAgICAgIGlkPSJncmlkNTk4OSIgLz4gIDwvc29kaXBvZGk6bmFtZWR2aWV3PiAgPHBhdGggICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIiAgICAgZD0iTSAyNSAyNCBMIDE2IDMwIEwgMjUgMzYgTCAyNSAyNCB6IE0gMzUgMjQgTCAzNSAzNiBMIDQ0IDMwIEwgMzUgMjQgeiAiICAgICBpZD0icGF0aDU5OTUiIC8+PC9zdmc+);
transform: rotate(90deg)
}
</style>
<script>/* Mapbox GL JS is Copyright  2020 Mapbox and subject to the Mapbox Terms of Service ((https://www.mapbox.com/legal/tos/). */
(function (global, factory) {
typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
typeof define === 'function' && define.amd ? define(factory) :
(global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.mapboxgl = factory());
})(this, (function () { 'use strict';

/* eslint-disable */

var shared, worker, mapboxgl;
// define gets called three times: one for each chunk. we rely on the order
// they're imported to know which is which
function define(_, chunk) {
if (!shared) {
    shared = chunk;
} else if (!worker) {
    worker = chunk;
} else {
    var workerBundleString = "self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; (" + shared + ")(sharedChunk); (" + worker + ")(sharedChunk); self.onerror = null;"

    var sharedChunk = {};
    shared(sharedChunk);
    mapboxgl = chunk(sharedChunk);
    if (typeof window !== 'undefined' && window && window.URL && window.URL.createObjectURL) {
        mapboxgl.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], { type: 'text/javascript' }));
    }
}
}


define(["exports"],(function(t){var e=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r*s-i*n;return o?(t[0]=s*(o=1/o),t[1]=-n*o,t[2]=-i*o,t[3]=r*o,t):null}function i(){var t=new r(9);return r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function s(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8];return t[0]=o*c-a*u,t[1]=i*u-n*c,t[2]=n*a-i*o,t[3]=a*l-s*c,t[4]=r*c-i*l,t[5]=i*s-r*a,t[6]=s*u-o*l,t[7]=n*l-r*u,t[8]=r*o-n*s,t}function o(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=r[0],d=r[1],f=r[2],m=r[3],y=r[4],g=r[5],x=r[6],v=r[7],b=r[8];return t[0]=p*n+d*o+f*u,t[1]=p*i+d*a+f*c,t[2]=p*s+d*l+f*h,t[3]=m*n+y*o+g*u,t[4]=m*i+y*a+g*c,t[5]=m*s+y*l+g*h,t[6]=x*n+v*o+b*u,t[7]=x*i+v*a+b*c,t[8]=x*s+v*l+b*h,t}function a(){var t=new r(16);return r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function l(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function u(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],y=e[14],g=e[15],x=r*a-n*o,v=r*l-i*o,b=r*u-s*o,w=n*l-i*a,_=n*u-s*a,A=i*u-s*l,M=c*m-h*f,I=c*y-p*f,S=c*g-d*f,P=h*y-p*m,E=h*g-d*m,k=p*g-d*y,z=x*k-v*E+b*P+w*S-_*I+A*M;return z?(t[0]=(a*k-l*E+u*P)*(z=1/z),t[1]=(i*E-n*k-s*P)*z,t[2]=(m*A-y*_+g*w)*z,t[3]=(p*_-h*A-d*w)*z,t[4]=(l*S-o*k-u*I)*z,t[5]=(r*k-i*S+s*I)*z,t[6]=(y*b-f*A-g*v)*z,t[7]=(c*A-p*b+d*v)*z,t[8]=(o*E-a*S+u*M)*z,t[9]=(n*S-r*E-s*M)*z,t[10]=(f*_-m*b+g*x)*z,t[11]=(h*b-c*_-d*x)*z,t[12]=(a*I-o*P-l*M)*z,t[13]=(r*P-n*I+i*M)*z,t[14]=(m*v-f*w-y*x)*z,t[15]=(c*w-h*v+p*x)*z,t):null}function c(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],y=e[13],g=e[14],x=e[15],v=r[0],b=r[1],w=r[2],_=r[3];return t[0]=v*n+b*a+w*h+_*m,t[1]=v*i+b*l+w*p+_*y,t[2]=v*s+b*u+w*d+_*g,t[3]=v*o+b*c+w*f+_*x,t[4]=(v=r[4])*n+(b=r[5])*a+(w=r[6])*h+(_=r[7])*m,t[5]=v*i+b*l+w*p+_*y,t[6]=v*s+b*u+w*d+_*g,t[7]=v*o+b*c+w*f+_*x,t[8]=(v=r[8])*n+(b=r[9])*a+(w=r[10])*h+(_=r[11])*m,t[9]=v*i+b*l+w*p+_*y,t[10]=v*s+b*u+w*d+_*g,t[11]=v*o+b*c+w*f+_*x,t[12]=(v=r[12])*n+(b=r[13])*a+(w=r[14])*h+(_=r[15])*m,t[13]=v*i+b*l+w*p+_*y,t[14]=v*s+b*u+w*d+_*g,t[15]=v*o+b*c+w*f+_*x,t}function h(t,e,r){var n,i,s,o,a,l,u,c,h,p,d,f,m=r[0],y=r[1],g=r[2];return e===t?(t[12]=e[0]*m+e[4]*y+e[8]*g+e[12],t[13]=e[1]*m+e[5]*y+e[9]*g+e[13],t[14]=e[2]*m+e[6]*y+e[10]*g+e[14],t[15]=e[3]*m+e[7]*y+e[11]*g+e[15]):(i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],d=e[10],f=e[11],t[0]=n=e[0],t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=d,t[11]=f,t[12]=n*m+a*y+h*g+e[12],t[13]=i*m+l*y+p*g+e[13],t[14]=s*m+u*y+d*g+e[14],t[15]=o*m+c*y+f*g+e[15]),t}function p(t,e,r){var n=r[0],i=r[1],s=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function d(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[4],o=e[5],a=e[6],l=e[7],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+u*n,t[5]=o*i+c*n,t[6]=a*i+h*n,t[7]=l*i+p*n,t[8]=u*i-s*n,t[9]=c*i-o*n,t[10]=h*i-a*n,t[11]=p*i-l*n,t}function f(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],u=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-u*n,t[1]=o*i-c*n,t[2]=a*i-h*n,t[3]=l*i-p*n,t[8]=s*n+u*i,t[9]=o*n+c*i,t[10]=a*n+h*i,t[11]=l*n+p*i,t}function m(t,e,r){var n=Math.sin(r),i=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],u=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+u*n,t[1]=o*i+c*n,t[2]=a*i+h*n,t[3]=l*i+p*n,t[4]=u*i-s*n,t[5]=c*i-o*n,t[6]=h*i-a*n,t[7]=p*i-l*n,t}function y(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g(t,r,n){var i,s,o,a=n[0],l=n[1],u=n[2],c=Math.hypot(a,l,u);return c<e?null:(a*=c=1/c,l*=c,u*=c,i=Math.sin(r),s=Math.cos(r),t[0]=a*a*(o=1-s)+s,t[1]=l*a*o+u*i,t[2]=u*a*o-l*i,t[3]=0,t[4]=a*l*o-u*i,t[5]=l*l*o+s,t[6]=u*l*o+a*i,t[7]=0,t[8]=a*u*o+l*i,t[9]=l*u*o-a*i,t[10]=u*u*o+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function x(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r+r,a=n+n,l=i+i,u=r*o,c=n*o,h=n*a,p=i*o,d=i*a,f=i*l,m=s*o,y=s*a,g=s*l;return t[0]=1-h-f,t[1]=c+g,t[2]=p-y,t[3]=0,t[4]=c-g,t[5]=1-u-f,t[6]=d+m,t[7]=0,t[8]=p+y,t[9]=d-m,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var v=c;function b(){var t=new r(3);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function w(t){var e=new r(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function _(t){return Math.hypot(t[0],t[1],t[2])}function A(t,e,n){var i=new r(3);return i[0]=t,i[1]=e,i[2]=n,i}function M(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function I(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function S(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function P(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function E(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function k(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function z(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function T(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function B(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function V(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function C(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function F(t,e){var r=e[0],n=e[1],i=e[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function D(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function L(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[0],a=r[1],l=r[2];return t[0]=i*l-s*a,t[1]=s*o-n*l,t[2]=n*a-i*o,t}function R(t,e,r,n){var i=e[0],s=e[1],o=e[2];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t[2]=o+n*(r[2]-o),t}function O(t,e,r){var n=e[0],i=e[1],s=e[2],o=r[3]*n+r[7]*i+r[11]*s+r[15];return t[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/(o=o||1),t[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/o,t}function U(t,e,r){var n=e[0],i=e[1],s=e[2];return t[0]=n*r[0]+i*r[3]+s*r[6],t[1]=n*r[1]+i*r[4]+s*r[7],t[2]=n*r[2]+i*r[5]+s*r[8],t}function N(t,e,r){var n=r[0],i=r[1],s=r[2],o=e[0],a=e[1],l=e[2],u=i*l-s*a,c=s*o-n*l,h=n*a-i*o,p=i*h-s*c,d=s*u-n*h,f=n*c-i*u,m=2*r[3];return c*=m,h*=m,d*=2,f*=2,t[0]=o+(u*=m)+(p*=2),t[1]=a+c+d,t[2]=l+h+f,t}function j(t){return t[0]=0,t[1]=0,t[2]=0,t}function $(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}var G=S,H=P,q=_;function X(){var t=new r(4);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Z(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function W(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=r*r+n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=s*o,t}function Y(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*o,t}function K(){var t=new r(4);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function J(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Q(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=n*l+o*a,t[1]=i*l+s*a,t[2]=s*l-i*a,t[3]=o*l-n*a,t}function tt(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=n*l-s*a,t[1]=i*l+o*a,t[2]=s*l+n*a,t[3]=o*l-i*a,t}b(),X();var et,rt,nt,it=W,st=(et=b(),rt=A(1,0,0),nt=A(0,1,0),function(t,e,r){var n=D(e,r);return n<-.999999?(L(et,rt,e),q(et)<1e-6&&L(et,nt,e),F(et,et),function(t,e,r){r*=.5;var n=Math.sin(r);t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r);}(t,et,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(L(et,e,r),t[0]=et[0],t[1]=et[1],t[2]=et[2],t[3]=1+n,it(t,t))});function ot(){var t=new r(2);return r!=Float32Array&&(t[0]=0,t[1]=0),t}function at(t,e){var n=new r(2);return n[0]=t,n[1]=e,n}function lt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function ut(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function ct(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function ht(t){return Math.hypot(t[0],t[1])}function pt(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function dt(t,e){return t[0]*e[0]+t[1]*e[1]}K(),K(),i();var ft,mt,yt=ut;function gt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}ot();var xt=function(){if(mt)return ft;function t(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=n;}return mt=1,ft=t,t.prototype={sampleCurveX:function(t){return ((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return ((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return (3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,n=0;n<8;n++){var i=this.sampleCurveX(r)-t;if(Math.abs(i)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=i/s;}var o=0,a=1;for(r=t,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-t)<e));n++)t>i?o=r:a=r,r=.5*(a-o)+o;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},ft}(),vt=gt(xt);function bt(t,e){this.x=t,this.y=e;}function wt(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return !1;for(let r=0;r<t.length;r++)if(!wt(t[r],e[r]))return !1;return !0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return !1;if(Object.keys(t).length!==Object.keys(e).length)return !1;for(const r in t)if(!wt(t[r],e[r]))return !1;return !0}return t===e}bt.prototype={clone(){return new bt(this.x,this.y)},add(t){return this.clone()._add(t)},sub(t){return this.clone()._sub(t)},multByPoint(t){return this.clone()._multByPoint(t)},divByPoint(t){return this.clone()._divByPoint(t)},mult(t){return this.clone()._mult(t)},div(t){return this.clone()._div(t)},rotate(t){return this.clone()._rotate(t)},rotateAround(t,e){return this.clone()._rotateAround(t,e)},matMult(t){return this.clone()._matMult(t)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(t){return this.x===t.x&&this.y===t.y},dist(t){return Math.sqrt(this.distSqr(t))},distSqr(t){const e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith(t){return this.angleWithSep(t.x,t.y)},angleWithSep(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult(t){const e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add(t){return this.x+=t.x,this.y+=t.y,this},_sub(t){return this.x-=t.x,this.y-=t.y,this},_mult(t){return this.x*=t,this.y*=t,this},_div(t){return this.x/=t,this.y/=t,this},_multByPoint(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint(t){return this.x/=t.x,this.y/=t.y,this},_unit(){return this._div(this.mag()),this},_perp(){const t=this.y;return this.y=this.x,this.x=-t,this},_rotate(t){const e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround(t,e){const r=Math.cos(t),n=Math.sin(t),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:bt},bt.convert=function(t){if(t instanceof bt)return t;if(Array.isArray(t))return new bt(+t[0],+t[1]);if(void 0!==t.x&&void 0!==t.y)return new bt(+t.x,+t.y);throw new Error("Expected [x, y] or {x, y} point format")};const _t=Math.PI/180,At=180/Math.PI;function Mt(t){return t*_t}function It(t){return t*At}const St=[[0,0],[1,0],[1,1],[0,1]];function Pt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function Et(t,e,r,n){const i=new vt(t,e,r,n);return function(t){return i.solve(t)}}const kt=Et(.25,.1,.25,1);function zt(t,e,r){return Math.min(r,Math.max(e,t))}function Tt(t,e,r){return (r=zt((r-t)/(e-t),0,1))*r*(3-2*r)}function Bt(t,e,r){const n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i}function Vt(t,e,r){if(!t.length)return r(null,[]);let n=t.length;const i=new Array(t.length);let s=null;t.forEach(((t,o)=>{e(t,((t,e)=>{t&&(s=t),i[o]=e,0==--n&&r(s,i);}));}));}function Ct(t,...e){for(const r of e)for(const e in r)t[e]=r[e];return t}let Ft=1;function Dt(){return Ft++}function Lt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Rt(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e));}));}function Ot(t,e,r){const n={};for(const r in t)n[r]=e.call(this,t[r],r,t);return n}function Ut(t,e,r){const n={};for(const r in t)e.call(this,t[r],r,t)&&(n[r]=t[r]);return n}function Nt(t){return Array.isArray(t)?t.map(Nt):"object"==typeof t&&t?Ot(t,Nt):t}function jt(t,e){for(let r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return !0;return !1}const $t={};function Gt(t){$t[t]||("undefined"!=typeof console&&console.warn(t),$t[t]=!0);}function Ht(t,e,r){return (r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function qt(t){let e=0;for(let r,n,i=0,s=t.length,o=s-1;i<s;o=i++)r=t[i],n=t[o],e+=(n.x-r.x)*(r.y+n.y);return e}function Xt([t,e,r]){const n=Mt(e+90),i=Mt(r);return {x:t*Math.cos(n)*Math.sin(i),y:t*Math.sin(n)*Math.sin(i),z:t*Math.cos(i),azimuthal:e,polar:r}}function Zt(t){return ("undefined"!=typeof self||void 0!==t)&&"undefined"!=typeof WorkerGlobalScope&&(void 0!==t?t:self)instanceof WorkerGlobalScope}function Wt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,r,n,i)=>{const s=n||i;return e[r]=!s||s.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t;}return e}let Yt=null;function Kt(t,e){return [t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Jt(t,e,r,n){for(;e<r;){const i=e+r>>1;t[i]<n?e=i+1:r=i;}return e}function Qt(t,e,r,n){for(;e<r;){const i=e+r>>1;t[i]<=n?e=i+1:r=i;}return e}function te(t){return t>0?1/(1.001-t):1+t}function ee(t){return t>0?1-1/(1.001-t):-t}function re(t,e,r){return (t-e.min)*(r.max-r.min)/(e.max-e.min)+r.min}const ne={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return /^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return /^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return /^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return /^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return /^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return /^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ne.API_URL)return null;try{const t=new URL(ne.API_URL);return "api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch(t){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ie(t){return ne.API_URL_REGEX.test(t)}function se(t){return ne.API_SPRITE_REGEX.test(t)}let oe,ae,le,ue,ce,he;function pe(){return null==oe&&(oe=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),oe}const de={now:()=>void 0!==ue?ue:performance.now(),setNow(t){ue=t;},restoreNow(){ue=void 0;},frame(t){const e=requestAnimationFrame(t);return {cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:n}=t;ce||(ce=document.createElement("canvas"));const i=ce.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return (r>ce.width||n>ce.height)&&(ce.width=r,ce.height=n),i.clearRect(-e,-e,r+2*e,n+2*e),i.drawImage(t,0,0,r,n),i.getImageData(-e,-e,r+2*e,n+2*e)},resolveURL:t=>(ae||(ae=document.createElement("a")),ae.href=t,ae.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return !!window.matchMedia&&(null==le&&(le=window.matchMedia("(prefers-reduced-motion: reduce)")),le.matches)},hasCanvasFingerprintNoise(){if(void 0!==he)return he;if(!pe())return he=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let r=0;for(let n=0;n<t.width;++n)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(n,0,1,1);const n=e.getImageData(0,0,t.width,t.height);r=0;for(let t=0;t<n.data.length;++t)if(t%4!=3&&r++!==n.data[t])return he=!0,!0;return he=!1,!1}};function fe(t,e){const r=t.indexOf("?");if(r<0)return `${t}?${new URLSearchParams(e).toString()}`;const n=new URLSearchParams(t.slice(r));for(const t in e)n.set(t,e[t]);return `${t.slice(0,r)}?${n.toString()}`}function me(t,e={persistentParams:[]}){const r=t.indexOf("?");if(r<0)return t;const n=new URLSearchParams,i=new URLSearchParams(t.slice(r));for(const t of e.persistentParams){const e=i.get(t);e&&n.set(t,e);}const s=n.toString();return `${t.slice(0,r)}${s.length>0?`?${s}`:""}`}const ye="mapbox-tiles";let ge=500,xe=50;const ve=["language","worldview","jobid"];let be,we;function _e(){try{return caches}catch(t){}}function Ae(){const t=_e();t&&null==be&&(be=t.open(ye));}let Me=1/0;const Ie={supported:!1,testSupport:function(t){!Ee&&Pe&&(ke?Te(t):Se=t);}};let Se,Pe,Ee=!1,ke=!1;const ze="undefined"!=typeof self?self:{};function Te(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Pe),t.isContextLost())return;Ie.supported=!0;}catch(t){}t.deleteTexture(e),Ee=!0;}ze.document&&(Pe=ze.document.createElement("img"),Pe.onload=function(){Se&&Te(Se),Se=null,ke=!0;},Pe.onerror=function(){Ee=!0,Se=null;},Pe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Be={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Be);class Ve extends Error{constructor(t,e,r){401===e&&ie(r)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=r;}toString(){return `${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ce=Zt()?()=>self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href;const Fe=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(Ce())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(t,e){const r=new AbortController,n=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:Ce(),referrerPolicy:t.referrerPolicy,signal:r.signal});let i=!1,s=!1;const o=(a=n.url).indexOf("sku=")>0&&ie(a);var a;"json"===t.type&&n.headers.set("Accept","application/json");const l=(r,i,a)=>{if(s)return;if(r&&"SecurityError"!==r.message&&Gt(r.toString()),i&&a)return u(i);const l=Date.now();fetch(n).then((r=>{if(r.ok){const t=o?r.clone():null;return u(r,t,l)}return e(new Ve(r.statusText,r.status,t.url))})).catch((r=>{"AbortError"!==r.name&&e(new Error(`${r.message} ${t.url}`));}));},u=(r,o,a)=>{("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then((t=>{s||(o&&a&&function(t,e,r){if(Ae(),null==be)return;const n=Wt(e.headers.get("Cache-Control")||"");if(n["no-store"])return;const i={status:e.status,statusText:e.statusText,headers:new Headers};e.headers.forEach(((t,e)=>i.headers.set(e,t))),n["max-age"]&&i.headers.set("Expires",new Date(r+1e3*n["max-age"]).toUTCString());const s=i.headers.get("Expires");if(!s)return;if(new Date(s).getTime()-r<42e4)return;let o=me(t.url,{persistentParams:ve});if(206===e.status){const e=t.headers.get("Range");if(!e)return;i.status=200,o=fe(o,{range:e});}!function(t,e){if(void 0===we)try{new Response(new ReadableStream),we=!0;}catch(t){we=!1;}we?e(t.body):t.blob().then(e).catch((t=>Gt(t.message)));}(e,(t=>{const r=new Response(200!==(n=e.status)&&404!==n&&[101,103,204,205,304].includes(n)?null:t,i);var n;Ae(),null!=be&&be.then((t=>t.put(o,r))).catch((t=>Gt(t.message)));}));}(n,o,a),i=!0,e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")));})).catch((t=>{s||e(new Error(t.message));}));};return o?function(t,e){if(Ae(),null==be)return e(null);be.then((r=>{let n=me(t.url,{persistentParams:ve});const i=t.headers.get("Range");i&&(n=fe(n,{range:i})),r.match(n).then((t=>{const i=function(t){if(!t)return !1;const e=new Date(t.headers.get("Expires")||0),r=Wt(t.headers.get("Cache-Control")||"");return Number(e)>Date.now()&&!r["no-cache"]}(t);r.delete(n).catch(e),i&&r.put(n,t.clone()).catch(e),e(null,t,i);})).catch(e);})).catch(e);}(n,l):l(null,null),{cancel:()=>{s=!0,i||r.abort();}}}(t,e);if(Zt(self)&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(t,e){const r=new XMLHttpRequest;r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer");for(const e in t.headers)r.setRequestHeader(e,t.headers[e]);return "json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=()=>{e(new Error(r.statusText));},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let n=r.response;if("json"===t.type)try{n=JSON.parse(r.response);}catch(t){return e(t)}e(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"));}else e(new Ve(r.statusText,r.status,t.url));},r.send(t.body),{cancel:()=>r.abort()}}(t,e)},De=function(t,e){return Fe(Ct(t,{type:"arrayBuffer"}),e)};function Le(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Oe,Ue;Oe=[],Ue=0;const Ne=function(t,e){if(Ie.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ue>=ne.MAX_PARALLEL_IMAGE_REQUESTS){const r={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0;}};return Oe.push(r),r}Ue++;let r=!1;const n=()=>{if(!r)for(r=!0,Ue--;Oe.length&&Ue<ne.MAX_PARALLEL_IMAGE_REQUESTS;){const t=Oe.shift(),{requestParameters:e,callback:r,cancelled:n}=t;n||(t.cancel=Ne(e,r).cancel);}},i=De(t,((t,r,i,s)=>{n(),t?e(t):r&&(self.createImageBitmap?function(t,e){const r=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(r).then((t=>{e(null,t);})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`));}));}(r,((t,r)=>e(t,r,i,s))):function(t,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,requestAnimationFrame((()=>{r.src=Re;}));},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(t)],{type:"image/png"});r.src=t.byteLength?URL.createObjectURL(n):Re;}(r,((t,r)=>e(t,r,i,s))));}));return {cancel:()=>{i.cancel(),n();}}};var je,$e,Ge,He={exports:{}},qe={exports:{}},Xe={exports:{}},Ze=function(){if(Ge)return He.exports;Ge=1;var t=(je||(je=1,qe.exports=function(t,e){var r,n,i,s,o,a,l,u;for(n=t.length-(r=3&t.length),i=e,o=3432918353,a=461845907,u=0;u<n;)l=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24,++u,i=27492+(65535&(s=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&t.charCodeAt(u+2))<<16;case 2:l^=(255&t.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&t.charCodeAt(u)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295;}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}),qe.exports),e=($e||($e=1,Xe.exports=function(t,e){for(var r,n=t.length,i=e^n,s=0;n>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:i^=(255&t.charCodeAt(s+2))<<16;case 2:i^=(255&t.charCodeAt(s+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(s)))+((1540483477*(i>>>16)&65535)<<16);}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}),Xe.exports);return He.exports=t,He.exports.murmur3=t,He.exports.murmur2=e,He.exports}(),We=gt(Ze);class Ye{constructor(t,...e){Ct(this,e[0]||{}),this.type=t;}}class Ke extends Ye{constructor(t,e={}){super("error",Ct({error:t},e));}}function Je(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e));}function Qe(t,e,r){if(r&&r[t]){const n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1);}}class tr{on(t,e){return this._listeners=this._listeners||{},Je(t,e,this._listeners),this}off(t,e){return Qe(t,e,this._listeners),Qe(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Je(t,e,this._oneTimeListeners),this):new Promise((e=>{this.once(t,e);}))}fire(t,e){const r="string"==typeof t?new Ye(t,e):t,n=r.type;if(this.listens(n)){r.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const e of t)e.call(this,r);const e=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const t of e)Qe(n,t,this._oneTimeListeners),t.call(this,r);const i=this._eventedParent;i&&(Ct(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(r));}else r instanceof Ke&&console.error(r.error);return this}listens(t){return !!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}class er{constructor(t){"string"==typeof t?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId);}static from(t){return new er(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){const[e,r]=t.split("");return new er({name:e,iconsetId:r})}static isEqual(t,e){return t.name===e.name&&t.iconsetId===e.iconsetId}toString(){return er.toString(this)}serialize(){return {name:this.name,iconsetId:this.iconsetId}}}var rr,nr={},ir=function(){if(rr)return nr;rr=1;var t={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(t){return (t=Math.round(t))<0?0:t>255?255:t}function r(t){return e("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function n(t){return (e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e;}function i(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{nr.parseCSSColor=function(s){var o,a=s.replace(/ /g,"").toLowerCase();if(a in t)return t[a].slice();if("#"===a[0])return 4===a.length?(o=parseInt(a.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===a.length&&(o=parseInt(a.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var l=a.indexOf("("),u=a.indexOf(")");if(-1!==l&&u+1===a.length){var c=a.substr(0,l),h=a.substr(l+1,u-(l+1)).split(","),p=1;switch(c){case "rgba":if(4!==h.length)return null;p=n(h.pop());case "rgb":return 3!==h.length?null:[r(h[0]),r(h[1]),r(h[2]),p];case "hsla":if(4!==h.length)return null;p=n(h.pop());case "hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,f=n(h[1]),m=n(h[2]),y=m<=.5?m*(f+1):m+f-m*f,g=2*m-y;return [e(255*i(g,y,d+1/3)),e(255*i(g,y,d)),e(255*i(g,y,d-1/3)),p];default:return null}}return null};}catch(t){}return nr}();class sr{constructor(t,e,r,n=1){this.r=t,this.g=e,this.b=r,this.a=n;}static parse(t){if(!t)return;if(t instanceof sr)return t;if("string"!=typeof t)return;const e=ir.parseCSSColor(t);return e?new sr(e[0]/255,e[1]/255,e[2]/255,e[3]):void 0}toString(){const[t,e,r,n]=[this.r,this.g,this.b,this.a];return `rgba(${Math.round(255*t)},${Math.round(255*e)},${Math.round(255*r)},${n})`}toNonPremultipliedRenderColor(t){const{r:e,g:r,b:n,a:i}=this;return new ar(t,e,r,n,i)}toPremultipliedRenderColor(t){const{r:e,g:r,b:n,a:i}=this;return new lr(t,e*i,r*i,n*i,i)}clone(){return new sr(this.r,this.g,this.b,this.a)}}class or{constructor(t,e,r,n,i,s=!1){if(this.premultiplied=!1,this.premultiplied=s,t){const s=t.image.height,o=s*s;this.premultiplied?(e=0===i?0:e/i*(s-1),r=0===i?0:r/i*(s-1),n=0===i?0:n/i*(s-1)):(e*=s-1,r*=s-1,n*=s-1);const a=Math.floor(e),l=Math.floor(r),u=Math.floor(n),c=Math.ceil(e),h=Math.ceil(r),p=Math.ceil(n),d=e-a,f=r-l,m=n-u,y=t.image.data,g=4*(a+l*o+u*s),x=4*(a+l*o+p*s),v=4*(a+h*o+u*s),b=4*(a+h*o+p*s),w=4*(c+l*o+u*s),_=4*(c+l*o+p*s),A=4*(c+h*o+u*s),M=4*(c+h*o+p*s);if(g<0||M>=y.length)throw new Error("out of range");this.r=ur(ur(ur(y[g],y[x],m),ur(y[v],y[b],m),f),ur(ur(y[w],y[_],m),ur(y[A],y[M],m),f),d)/255*(this.premultiplied?i:1),this.g=ur(ur(ur(y[g+1],y[x+1],m),ur(y[v+1],y[b+1],m),f),ur(ur(y[w+1],y[_+1],m),ur(y[A+1],y[M+1],m),f),d)/255*(this.premultiplied?i:1),this.b=ur(ur(ur(y[g+2],y[x+2],m),ur(y[v+2],y[b+2],m),f),ur(ur(y[w+2],y[_+2],m),ur(y[A+2],y[M+2],m),f),d)/255*(this.premultiplied?i:1),this.a=i;}else this.r=e,this.g=r,this.b=n,this.a=i;}toArray(){const{r:t,g:e,b:r,a:n}=this;return [255*t,255*e,255*r,n]}toHslaArray(){let{r:t,g:e,b:r,a:n}=this;if(this.premultiplied){if(0===n)return [0,0,0,0];t/=n,e/=n,r/=n;}const i=Math.min(Math.max(t,0),1),s=Math.min(Math.max(e,0),1),o=Math.min(Math.max(r,0),1),a=Math.min(i,s,o),l=Math.max(i,s,o),u=(a+l)/2;if(a===l)return [0,0,100*u,n];const c=l-a,h=u>.5?c/(2-l-a):c/(l+a);let p=0;return l===i?p=(s-o)/c+(s<o?6:0):l===s?p=(o-i)/c+2:l===o&&(p=(i-s)/c+4),p*=60,[Math.min(Math.max(p,0),360),Math.min(Math.max(100*h,0),100),Math.min(Math.max(100*u,0),100),n]}toArray01(){const{r:t,g:e,b:r,a:n}=this;return [t,e,r,n]}toArray01Scaled(t){const{r:e,g:r,b:n}=this;return [e*t,r*t,n*t]}toArray01Linear(){const{r:t,g:e,b:r,a:n}=this;return [Math.pow(t,2.2),Math.pow(e,2.2),Math.pow(r,2.2),n]}}class ar extends or{constructor(t,e,r,n,i){super(t,e,r,n,i,!1);}}class lr extends or{constructor(t,e,r,n,i){super(t,e,r,n,i,!0);}}function ur(t,e,r){return t*(1-r)+e*r}function cr(t,e,r){return t.map(((t,n)=>ur(t,e[n],r)))}sr.black=new sr(0,0,0,1),sr.white=new sr(1,1,1,1),sr.transparent=new sr(0,0,0,0),sr.red=new sr(1,0,0,1),sr.blue=new sr(0,0,1,1);var hr=Object.freeze({__proto__:null,array:cr,color:function(t,e,r){return new sr(ur(t.r,e.r,r),ur(t.g,e.g,r),ur(t.b,e.b,r),ur(t.a,e.a,r))},number:ur});function pr(t,...e){for(const r of e)for(const e in r)t[e]=r[e];return t}class dr extends Error{constructor(t,e){super(e),this.message=e,this.key=t;}}class fr{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,r]of e)this.bindings[t]=r;}concat(t){return new fr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return !!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const mr={kind:"null"},yr={kind:"number"},gr={kind:"string"},xr={kind:"boolean"},vr={kind:"color"},br={kind:"object"},wr={kind:"value"},_r={kind:"collator"},Ar={kind:"formatted"},Mr={kind:"resolvedImage"};function Ir(t,e){return {kind:"array",itemType:t,N:e}}function Sr(t){if("array"===t.kind){const e=Sr(t.itemType);return "number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Pr=[mr,yr,gr,xr,vr,Ar,br,Ir(wr),Mr];function Er(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Er(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else {if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Pr)if(!Er(t,e))return null}return `Expected ${Sr(t)} but found ${Sr(e)} instead.`}function kr(t,e){return e.some((e=>e.kind===t.kind))}function zr(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}function Tr(t,e){return "array"===t.kind&&"array"===e.kind?t.N===e.N&&Tr(t.itemType,e.itemType):t.kind===e.kind}class Br{constructor(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"});}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vr{constructor(t,e,r,n,i){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=i;}}class Cr{constructor(t){this.sections=t;}static fromString(t){return new Cr([new Vr(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||!!t.image&&t.image.hasPrimary()))}static factory(t){return t instanceof Cr?t:Cr.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){const r=e.image.getPrimary().id.toString();t.push(["image",r]);continue}t.push(e.text);const r={};e.fontStack&&(r["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(r["font-scale"]=e.scale),e.textColor&&(r["text-color"]=["rgba"].concat(e.textColor.toNonPremultipliedRenderColor(null).toArray())),t.push(r);}return t}}class Fr{constructor(t,e={}){if(this.id=er.from(t),this.options=Object.assign({},e),e.transform){const{a:t,b:r,c:n,d:i,e:s,f:o}=e.transform;this.options.transform=new DOMMatrix([t,r,n,i,s,o]);}else this.options.transform=new DOMMatrix([1,0,0,1,0,0]);}toString(){const{a:t,b:e,c:r,d:n,e:i,f:s}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:t,b:e,c:r,d:n,e:i,f:s}})}static parse(t){let e,r,n,i;try{({name:e,iconsetId:r,params:n,transform:i}=JSON.parse(t)||{});}catch(t){return null}if(!e)return null;const{a:s,b:o,c:a,d:l,e:u,f:c}=i||{};return new Fr({name:e,iconsetId:r},{params:n,transform:new DOMMatrix([s,o,a,l,u,c])})}scaleSelf(t,e){return this.options.transform.scaleSelf(t,e),this}}class Dr{constructor(t,e,r,n,i=!1){this.primaryId=er.from(t),this.primaryOptions=e,r&&(this.secondaryId=er.from(r)),this.secondaryOptions=n,this.available=i;}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return !!this.primaryId}getPrimary(){return new Fr(this.primaryId,this.primaryOptions)}hasSecondary(){return !!this.secondaryId}getSecondary(){return this.secondaryId?new Fr(this.secondaryId,this.secondaryOptions):null}static from(t){return "string"==typeof t?Dr.build({name:t}):t}static build(t,e,r,n){return !t||"object"==typeof t&&!("name"in t)?null:new Dr(t,r,e,n)}}function Lr(t,e,r,n){return "number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rr(t){if(null===t)return !0;if("string"==typeof t)return !0;if("boolean"==typeof t)return !0;if("number"==typeof t)return !0;if(t instanceof sr)return !0;if(t instanceof Br)return !0;if(t instanceof Cr)return !0;if(t instanceof Dr)return !0;if(Array.isArray(t)){for(const e of t)if(!Rr(e))return !1;return !0}if("object"==typeof t){for(const e in t)if(!Rr(t[e]))return !1;return !0}return !1}function Or(t){if(null===t)return mr;if("string"==typeof t)return gr;if("boolean"==typeof t)return xr;if("number"==typeof t)return yr;if(t instanceof sr)return vr;if(t instanceof Br)return _r;if(t instanceof Cr)return Ar;if(t instanceof Dr)return Mr;if(Array.isArray(t)){const e=t.length;let r;for(const e of t){const t=Or(e);if(r){if(r===t)continue;r=wr;break}r=t;}return Ir(r||wr,e)}return br}function Ur(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Cr||t instanceof Dr||t instanceof sr?t.toString():JSON.stringify(t)}class Nr{constructor(t,e){this.type=t,this.value=e;}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Rr(t[1]))return e.error("invalid value");const r=t[1];let n=Or(r);const i=e.expectedType;return "array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new Nr(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return !0}serialize(){return "array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof sr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Cr?this.value.serialize():this.value}}class jr{constructor(t){this.name="ExpressionEvaluationError",this.message=t;}toJSON(){return this.message}}const $r={string:gr,number:yr,boolean:xr,object:br};class Gr{constructor(t,e){this.type=t,this.args=e;}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let r,n=1;const i=t[0];if("array"===i){let i,s;if(t.length>2){const r=t[1];if("string"!=typeof r||!(r in $r)||"object"===r)return e.error('The item type argument of "array" must be one of string, number, boolean',1);i=$r[r],n++;}else i=wr;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);s=t[2],n++;}r=Ir(i,s);}else r=$r[i];const s=[];for(;n<t.length;n++){const r=e.parse(t[n],n,wr);if(!r)return null;s.push(r);}return new Gr(r,s)}evaluate(t){for(let e=0;e<this.args.length;e++){const r=this.args[e].evaluate(t);if(!Er(this.type,Or(r)))return r;if(e===this.args.length-1)throw new jr(`The expression ${JSON.stringify(this.args[e].serialize())} evaluated to ${Sr(Or(r))} but was expected to be of type ${Sr(this.type)}.`)}return null}eachChild(t){this.args.forEach(t);}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n);}}return e.concat(this.args.map((t=>t.serialize())))}}class Hr{constructor(t){this.type=Ar,this.sections=t;}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const r=t[1];if(!Array.isArray(r)&&"object"==typeof r)return e.error("First argument must be an image or text section.");const n=[];let i=!1;for(let r=1;r<=t.length-1;++r){const s=t[r];if(i&&"object"==typeof s&&!Array.isArray(s)){i=!1;let t=null;if(s["font-scale"]&&(t=e.parseObjectValue(s["font-scale"],r,"font-scale",yr),!t))return null;let o=null;if(s["text-font"]&&(o=e.parseObjectValue(s["text-font"],r,"text-font",Ir(gr)),!o))return null;let a=null;if(s["text-color"]&&(a=e.parseObjectValue(s["text-color"],r,"text-color",vr),!a))return null;const l=n[n.length-1];l.scale=t,l.font=o,l.textColor=a;}else {const s=e.parse(t[r],r,wr);if(!s)return null;const o=s.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:s,scale:null,font:null,textColor:null});}}return new Hr(n)}evaluate(t){return new Cr(this.sections.map((e=>{const r=e.content.evaluate(t);return Tr(Or(r),Mr)?new Vr("",r,null,null,null):new Vr(Ur(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor);}outputDefined(){return !1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const r={};e.scale&&(r["font-scale"]=e.scale.serialize()),e.font&&(r["text-font"]=e.font.serialize()),e.textColor&&(r["text-color"]=e.textColor.serialize()),t.push(r);}return t}}class qr{constructor(t,e,r,n){this._imageWarnHistory={},this.type=Mr,this.namePrimary=t,this.nameSecondary=e,r&&(this.paramsPrimary=r.params,this.iconsetIdPrimary=r.iconset?r.iconset.id:void 0),n&&(this.paramsSecondary=n.params,this.iconsetIdSecondary=n.iconset?n.iconset.id:void 0);}static parse(t,e){if(t.length<2)return e.error("Expected two or more arguments.");let r=1;const n=[];function i(){if(r<t.length){const i=e.parse(t[r],r++,gr);return i?(n.push({image:i,options:{}}),!0):(e.error(n.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return !0}function s(){if(r<t.length){const s=t[r];if(null===(i=s)||"object"!=typeof i||Array.isArray(i))return !0;const o=s.params,a=s.iconset,l=e.concat(r);if(!o&&!a)return r++,!0;if(o){if("object"!=typeof o||o.constructor!==Object)return l.error('Image options "params" should be an object'),!1;const t={},e=l.concat(void 0,"params");for(const r in o){if(!r)return e.error("Image parameter name should be non-empty"),!1;const n=e.concat(void 0,r).parse(o[r],void 0,vr,void 0,{typeAnnotation:"coerce"});if(!n)return !1;t[r]=n;}n[n.length-1].options.params=t;}if(a){if("object"!=typeof a||a.constructor!==Object)return l.error('Image options "iconset" should be an object'),!1;if(!a.id)return l.error('Image options "iconset" should have an "id" property'),!1;n[n.length-1].options.iconset=a;}return r++,!0}var i;return !0}for(let t=0;t<2;t++)if(!i()||!s())return;return new qr(n[0].image,n[1]?n[1].image:void 0,n[0].options,n[1]?n[1].options:void 0)}evaluateParams(t,e){const r={};if(e){for(const n in e)if(e[n])try{r[n]=e[n].evaluate(t);}catch(t){continue}if(0!==Object.keys(r).length)return {params:r}}}evaluate(t){const e={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},r=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,n=Dr.build(e,r,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(n&&t.availableImages){const e=n.getPrimary().id;if(n.available=t.availableImages.some((t=>er.isEqual(t,e))),n.available){const e=n.getSecondary()?n.getSecondary().id:null;e&&(n.available=t.availableImages.some((t=>er.isEqual(t,e))));}}return n}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(const e in this.paramsPrimary)this.paramsPrimary[e]&&t(this.paramsPrimary[e]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(const e in this.paramsSecondary)this.paramsSecondary[e]&&t(this.paramsSecondary[e]);}outputDefined(){return !1}serializeOptions(t,e){const r={};if(e&&(r.iconset={id:e}),t){r.params={};for(const e in t)t[e]&&(r.params[e]=t[e].serialize());}return Object.keys(r).length>0?r:void 0}serialize(){const t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const e=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);e&&t.push(e);}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const e=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);e&&t.push(e);}return t}}function Xr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const Zr={"to-boolean":xr,"to-color":vr,"to-number":yr,"to-string":gr};class Wr{constructor(t,e){this.type=t,this.args=e;}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const r=t[0],n=[];let i=mr;if("to-array"===r){if(!Array.isArray(t[1]))return null;const r=t[1].length;if(e.expectedType){if("array"!==e.expectedType.kind)return e.error(`Expected ${e.expectedType.kind} but found array.`);i=Ir(e.expectedType.itemType,r);}else {if(!(r>0&&Rr(t[1][0])))return null;i=Ir(Or(t[1][0]),r);}for(let s=0;s<r;s++){const r=t[1][s];let o;if("array"===Xr(r))o=e.parse(r,void 0,i.itemType);else {const t=Xr(r);if(t!==i.itemType.kind)return e.error(`Expected ${i.itemType.kind} but found ${t}.`);o=e.registry.literal.parse(["literal",void 0===r?null:r],e);}if(!o)return null;n.push(o);}}else {if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");i=Zr[r];for(let r=1;r<t.length;r++){const i=e.parse(t[r],r,wr);if(!i)return null;n.push(i);}}return new Wr(i,n)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,r;for(const n of this.args){if(e=n.evaluate(t),r=null,e instanceof sr)return e;if("string"==typeof e){const r=t.parseColor(e);if(r)return r}else if(Array.isArray(e)&&(r=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:Lr(e[0],e[1],e[2],e[3]),!r))return new sr(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new jr(r||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const r of this.args){if(e=r.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new jr(`Could not convert ${JSON.stringify(e)} to number.`)}return "formatted"===this.type.kind?Cr.fromString(Ur(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Dr.build(Ur(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map((e=>e.evaluate(t))):Ur(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t);}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Hr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new qr(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize());})),t}}const Yr=["Unknown","Point","LineString","Polygon"];class Kr{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e;}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Yr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=sr.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}}class Jr{constructor(t,e,r,n,i){this.name=t,this.type=e,this._evaluate=r,this.args=n,this._overloadIndex=i;}evaluate(t){if(!this._evaluate){const t=Jr.definitions[this.name];this._evaluate=Array.isArray(t)?t[2]:t.overloads[this._overloadIndex][1];}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t);}outputDefined(){return !1}serialize(){return [this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const r=t[0],n=Jr.definitions[r];if(!n)return e.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(n)?n[0]:n.type,s=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,o=[];let a=null,l=-1;for(const[n,u]of s){if(Array.isArray(n)&&n.length!==t.length-1)continue;o.push(n),l++,a=new bi(e.registry,e.path,null,e.scope,void 0,e._scope,e.options);const s=[];let c=!1;for(let e=1;e<t.length;e++){const r=t[e],i=Array.isArray(n)?n[e-1]:n.type,o=a.parse(r,1+s.length,i);if(!o){c=!0;break}s.push(o);}if(!c)if(Array.isArray(n)&&n.length!==s.length)a.error(`Expected ${n.length} arguments, but found ${s.length} instead.`);else {for(let t=0;t<s.length;t++){const e=Array.isArray(n)?n[t]:n.type,r=s[t];a.concat(t+1).checkSubtype(e,r.type);}if(0===a.errors.length)return new Jr(r,i,u,s,l)}}if(1===o.length)e.errors.push(...a.errors);else {const r=(o.length?o:s.map((([t])=>t))).map(Qr).join(" | "),n=[];for(let r=1;r<t.length;r++){const i=e.parse(t[r],1+n.length);if(!i)return null;n.push(Sr(i.type));}e.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`);}return null}static register(t,e){Jr.definitions=e;for(const r in e)t[r]=Jr;}}function Qr(t){return Array.isArray(t)?`(${t.map(Sr).join(", ")})`:`(${Sr(t.type)}...)`}class tn{constructor(t,e,r){this.type=_r,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e;}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");const n=void 0===r["case-sensitive"]?e.parse(!1,1,xr):e.parseObjectValue(r["case-sensitive"],1,"case-sensitive",xr);if(!n)return null;const i=void 0===r["diacritic-sensitive"]?e.parse(!1,1,xr):e.parseObjectValue(r["diacritic-sensitive"],1,"diacritic-sensitive",xr);if(!i)return null;let s=null;return r.locale&&(s=e.parseObjectValue(r.locale,1,"locale",gr),!s)?null:new tn(n,i,s)}evaluate(t){return new Br(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale);}outputDefined(){return !1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function en(t,e,r=0,n=t.length-1,i=nn){for(;n>r;){if(n-r>600){const s=n-r+1,o=e-r+1,a=Math.log(s),l=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1);en(t,e,Math.max(r,Math.floor(e-o*l/s+u)),Math.min(n,Math.floor(e+(s-o)*l/s+u)),i);}const s=t[e];let o=r,a=n;for(rn(t,r,e),i(t[n],s)>0&&rn(t,r,n);o<a;){for(rn(t,o,a),o++,a--;i(t[o],s)<0;)o++;for(;i(t[a],s)>0;)a--;}0===i(t[r],s)?rn(t,r,a):(a++,rn(t,a,n)),a<=e&&(r=a+1),e<=a&&(n=a-1);}}function rn(t,e,r){const n=t[e];t[e]=t[r],t[r]=n;}function nn(t,e){return t<e?-1:t>e?1:0}function sn(t){let e=0;for(let r,n,i=0,s=t.length,o=s-1;i<s;o=i++)r=t[i],n=t[o],e+=(n.x-r.x)*(r.y+n.y);return e}function on(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1]);}function an(t,e){return !(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ln(t,e,r){const n=t[0]-e[0],i=t[1]-e[1],s=t[0]-r[0],o=t[1]-r[1];return n*o-s*i==0&&n*s<=0&&i*o<=0}function un(t,e,r=!1){let n=!1;for(let a=0,l=e.length;a<l;a++){const l=e[a];for(let e=0,a=l.length,u=a-1;e<a;u=e++){const a=l[u],c=l[e];if(ln(t,a,c))return r;(s=a)[1]>(i=t)[1]!=(o=c)[1]>i[1]&&i[0]<(o[0]-s[0])*(i[1]-s[1])/(o[1]-s[1])+s[0]&&(n=!n);}}var i,s,o;return n}function cn(t,e,r,n){const i=n[0]-r[0],s=n[1]-r[1],o=(t[0]-r[0])*s-i*(t[1]-r[1]),a=(e[0]-r[0])*s-i*(e[1]-r[1]);return o>0&&a<0||o<0&&a>0}function hn(t,e,r,n){return 0!=(i=[n[0]-r[0],n[1]-r[1]])[0]*(s=[e[0]-t[0],e[1]-t[1]])[1]-i[1]*s[0]&&!(!cn(t,e,r,n)||!cn(r,n,t,e));var i,s;}function pn(t){const e=new bt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new bt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const n of t[0])e.x>n.x&&(e.x=n.x),e.y>n.y&&(e.y=n.y),r.x<n.x&&(r.x=n.x),r.y<n.y&&(r.y=n.y);return {min:e,max:r}}const dn=8192;function fn(t,e){const r=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return [Math.round(r*i*dn),Math.round(n*i*dn)]}function mn(t,e){for(let r=0;r<e.length;r++)if(un(t,e[r]))return !0;return !1}function yn(t,e,r){for(const n of r)for(let r=0,i=n.length,s=i-1;r<i;s=r++)if(hn(t,e,n[s],n[r]))return !0;return !1}function gn(t,e){for(let r=0;r<t.length;++r)if(!un(t[r],e))return !1;for(let r=0;r<t.length-1;++r)if(yn(t[r],t[r+1],e))return !1;return !0}function xn(t,e){for(let r=0;r<e.length;r++)if(gn(t,e[r]))return !0;return !1}function vn(t,e,r){const n=[];for(let i=0;i<t.length;i++){const s=[];for(let n=0;n<t[i].length;n++){const o=fn(t[i][n],r);on(e,o),s.push(o);}n.push(s);}return n}function bn(t,e,r){const n=[];for(let i=0;i<t.length;i++){const s=vn(t[i],e,r);n.push(s);}return n}function wn(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){const e=.5*n;let i=t[0]-r[0]>e?-n:r[0]-t[0]>e?n:0;0===i&&(i=t[0]-r[2]>e?-n:r[2]-t[0]>e?n:0),t[0]+=i;}on(e,t);}function _n(t,e,r,n){const i=Math.pow(2,n.z)*dn,s=[n.x*dn,n.y*dn],o=[];if(!t)return o;for(const n of t)for(const t of n){const n=[t.x+s[0],t.y+s[1]];wn(n,e,r,i),o.push(n);}return o}function An(t,e,r,n){const i=Math.pow(2,n.z)*dn,s=[n.x*dn,n.y*dn],o=[];if(!t)return o;for(const r of t){const t=[];for(const n of r){const r=[n.x+s[0],n.y+s[1]];on(e,r),t.push(r);}o.push(t);}if(e[2]-e[0]<=i/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of o)for(const n of t)wn(n,e,r,i);}var a;return o}class Mn{constructor(t,e){this.type=xr,this.geojson=t,this.geometries=e;}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Rr(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const r=e.features[t].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Mn(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Mn(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Mn(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return !1;if("Polygon"===e.type){const s=vn(e.coordinates,n,i),o=_n(t.geometry(),r,n,i);if(!an(r,n))return !1;for(const t of o)if(!un(t,s))return !1}if("MultiPolygon"===e.type){const s=bn(e.coordinates,n,i),o=_n(t.geometry(),r,n,i);if(!an(r,n))return !1;for(const t of o)if(!mn(t,s))return !1}return !0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return !1;if("Polygon"===e.type){const s=vn(e.coordinates,n,i),o=An(t.geometry(),r,n,i);if(!an(r,n))return !1;for(const t of o)if(!gn(t,s))return !1}if("MultiPolygon"===e.type){const s=bn(e.coordinates,n,i),o=An(t.geometry(),r,n,i);if(!an(r,n))return !1;for(const t of o)if(!xn(t,s))return !1}return !0}(t,this.geometries)}return !1}eachChild(){}outputDefined(){return !0}serialize(){return ["within",this.geojson]}}const In={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Sn=1/298.257223563,Pn=Sn*(2-Sn),En=Math.PI/180;class kn{static fromTile(t,e,r){const n=Math.PI*(1-2*(t+.5)/Math.pow(2,e)),i=Math.atan(.5*(Math.exp(n)-Math.exp(-n)))/En;return new kn(i,r)}static get units(){return In}constructor(t,e){if(void 0===t)throw new Error("No latitude given.");if(e&&!In[e])throw new Error(`Unknown unit ${e}. Use one of: ${Object.keys(In).join(", ")}`);const r=6378.137*En*(e?In[e]:1),n=Math.cos(t*En),i=1/(1-Pn*(1-n*n)),s=Math.sqrt(i);this.kx=r*s*n,this.ky=r*s*i*(1-Pn);}distance(t,e){const r=Bn(t[0]-e[0])*this.kx,n=(t[1]-e[1])*this.ky;return Math.sqrt(r*r+n*n)}bearing(t,e){const r=Bn(e[0]-t[0])*this.kx;return Math.atan2(r,(e[1]-t[1])*this.ky)/En}destination(t,e,r){const n=r*En;return this.offset(t,Math.sin(n)*e,Math.cos(n)*e)}offset(t,e,r){return [t[0]+e/this.kx,t[1]+r/this.ky]}lineDistance(t){let e=0;for(let r=0;r<t.length-1;r++)e+=this.distance(t[r],t[r+1]);return e}area(t){let e=0;for(let r=0;r<t.length;r++){const n=t[r];for(let t=0,i=n.length,s=i-1;t<i;s=t++)e+=Bn(n[t][0]-n[s][0])*(n[t][1]+n[s][1])*(r?-1:1);}return Math.abs(e)/2*this.kx*this.ky}along(t,e){let r=0;if(e<=0)return t[0];for(let n=0;n<t.length-1;n++){const i=t[n],s=t[n+1],o=this.distance(i,s);if(r+=o,r>e)return Tn(i,s,(e-(r-o))/o)}return t[t.length-1]}pointToSegmentDistance(t,e,r){let[n,i]=e,s=Bn(r[0]-n)*this.kx,o=(r[1]-i)*this.ky;if(0!==s||0!==o){const e=(Bn(t[0]-n)*this.kx*s+(t[1]-i)*this.ky*o)/(s*s+o*o);e>1?(n=r[0],i=r[1]):e>0&&(n+=s/this.kx*e,i+=o/this.ky*e);}return s=Bn(t[0]-n)*this.kx,o=(t[1]-i)*this.ky,Math.sqrt(s*s+o*o)}pointOnLine(t,e){let r=1/0,n=t[0][0],i=t[0][1],s=0,o=0;for(let a=0;a<t.length-1;a++){let l=t[a][0],u=t[a][1],c=Bn(t[a+1][0]-l)*this.kx,h=(t[a+1][1]-u)*this.ky,p=0;0===c&&0===h||(p=(Bn(e[0]-l)*this.kx*c+(e[1]-u)*this.ky*h)/(c*c+h*h),p>1?(l=t[a+1][0],u=t[a+1][1]):p>0&&(l+=c/this.kx*p,u+=h/this.ky*p)),c=Bn(e[0]-l)*this.kx,h=(e[1]-u)*this.ky;const d=c*c+h*h;d<r&&(r=d,n=l,i=u,s=a,o=p);}return {point:[n,i],index:s,t:Math.max(0,Math.min(1,o))}}lineSlice(t,e,r){let n=this.pointOnLine(r,t),i=this.pointOnLine(r,e);if(n.index>i.index||n.index===i.index&&n.t>i.t){const t=n;n=i,i=t;}const s=[n.point],o=n.index+1,a=i.index;!zn(r[o],s[0])&&o<=a&&s.push(r[o]);for(let t=o+1;t<=a;t++)s.push(r[t]);return zn(r[a],i.point)||s.push(i.point),s}lineSliceAlong(t,e,r){let n=0;const i=[];for(let s=0;s<r.length-1;s++){const o=r[s],a=r[s+1],l=this.distance(o,a);if(n+=l,n>t&&0===i.length&&i.push(Tn(o,a,(t-(n-l))/l)),n>=e)return i.push(Tn(o,a,(e-(n-l))/l)),i;n>t&&i.push(a);}return i}bufferPoint(t,e){const r=e/this.ky,n=e/this.kx;return [t[0]-n,t[1]-r,t[0]+n,t[1]+r]}bufferBBox(t,e){const r=e/this.ky,n=e/this.kx;return [t[0]-n,t[1]-r,t[2]+n,t[3]+r]}insideBBox(t,e){return Bn(t[0]-e[0])>=0&&Bn(t[0]-e[2])<=0&&t[1]>=e[1]&&t[1]<=e[3]}}function zn(t,e){return t[0]===e[0]&&t[1]===e[1]}function Tn(t,e,r){const n=Bn(e[0]-t[0]);return [t[0]+n*r,t[1]+(e[1]-t[1])*r]}function Bn(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}class Vn{constructor(t=[],e=((t,e)=>t<e?-1:t>e?1:0)){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t);}push(t){this.data.push(t),this._up(this.length++);}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return --this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:r}=this,n=e[t];for(;t>0;){const i=t-1>>1,s=e[i];if(r(n,s)>=0)break;e[t]=s,t=i;}e[t]=n;}_down(t){const{data:e,compare:r}=this,n=this.length>>1,i=e[t];for(;t<n;){let n=1+(t<<1);const s=n+1;if(s<this.length&&r(e[s],e[n])<0&&(n=s),r(e[n],i)>=0)break;e[t]=e[n],t=n;}e[t]=i;}}var Cn=8192;function Fn(t,e){return e.dist-t.dist}const Dn=100,Ln=50;function Rn(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return !1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return !1;return !0}function On(t){return t[1]-t[0]+1}function Un(t,e){const r=t[1]>=t[0]&&t[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function Nn(t,e){if(t[0]>t[1])return [null,null];const r=On(t);if(e){if(2===r)return [t,null];const e=Math.floor(r/2);return [[t[0],t[0]+e],[t[0]+e,t[1]]]}{if(1===r)return [t,null];const e=Math.floor(r/2)-1;return [[t[0],t[0]+e],[t[0]+e+1,t[1]]]}}function jn(t,e){const r=[1/0,1/0,-1/0,-1/0];if(!Un(e,t.length))return r;for(let n=e[0];n<=e[1];++n)on(r,t[n]);return r}function $n(t){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<t.length;++r)for(let n=0;n<t[r].length;++n)on(e,t[r][n]);return e}function Gn(t,e,r){if(Rn(t)||Rn(e))return NaN;let n=0,i=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(i=t[1]-e[3]),t[3]<e[1]&&(i=e[1]-t[3]),r.distance([0,0],[n,i])}function Hn(t){return 360*t-180}function qn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Xn(t,e){const r=Math.pow(2,e.z),n=(t.y/Cn+e.y)/r;return [Hn((t.x/Cn+e.x)/r),qn(n)]}function Zn(t,e){const r=[];for(let n=0;n<t.length;++n)r.push(Xn(t[n],e));return r}function Wn(t,e,r){const n=r.pointOnLine(e,t).point;return r.distance(t,n)}function Yn(t,e,r,n,i){const s=r.slice(n[0],n[1]+1);let o=1/0;for(let r=e[0];r<=e[1];++r)if(0===(o=Math.min(o,Wn(t[r],s,i))))return 0;return o}function Kn(t,e,r,n,i){const s=Math.min(i.pointToSegmentDistance(t,r,n),i.pointToSegmentDistance(e,r,n)),o=Math.min(i.pointToSegmentDistance(r,t,e),i.pointToSegmentDistance(n,t,e));return Math.min(s,o)}function Jn(t,e,r,n,i){if(!Un(e,t.length)||!Un(n,r.length))return NaN;let s=1/0;for(let o=e[0];o<e[1];++o)for(let e=n[0];e<n[1];++e){if(hn(t[o],t[o+1],r[e],r[e+1]))return 0;s=Math.min(s,Kn(t[o],t[o+1],r[e],r[e+1],i));}return s}function Qn(t,e,r,n,i){if(!Un(e,t.length)||!Un(n,r.length))return NaN;let s=1/0;for(let o=e[0];o<=e[1];++o)for(let e=n[0];e<=n[1];++e)if(0===(s=Math.min(s,i.distance(t[o],r[e]))))return s;return s}function ti(t,e,r){if(un(t,e,!0))return 0;let n=1/0;for(const i of e){const e=i.length;if(e<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(i[0]!==i[e-1]&&0===(n=Math.min(n,r.pointToSegmentDistance(t,i[e-1],i[0]))))return n;if(0===(n=Math.min(n,Wn(t,i,r))))return n}return n}function ei(t,e,r,n){if(!Un(e,t.length))return NaN;for(let n=e[0];n<=e[1];++n)if(un(t[n],r,!0))return 0;let i=1/0;for(let s=e[0];s<e[1];++s)for(const e of r)for(let r=0,o=e.length,a=o-1;r<o;a=r++){if(hn(t[s],t[s+1],e[a],e[r]))return 0;i=Math.min(i,Kn(t[s],t[s+1],e[a],e[r],n));}return i}function ri(t,e){for(const r of t)for(let t=0;t<=r.length-1;++t)if(un(r[t],e,!0))return !0;return !1}function ni(t,e,r,n=1/0){const i=$n(t),s=$n(e);if(n!==1/0&&Gn(i,s,r)>=n)return n;if(an(i,s)){if(ri(t,e))return 0}else if(ri(e,t))return 0;let o=n;for(const n of t)for(let t=0,i=n.length,s=i-1;t<i;s=t++)for(const i of e)for(let e=0,a=i.length,l=a-1;e<a;l=e++){if(hn(n[s],n[t],i[l],i[e]))return 0;o=Math.min(o,Kn(n[s],n[t],i[l],i[e],r));}return o}function ii(t,e,r,n,i,s,o){if(null===s||null===o)return;const a=Gn(jn(n,s),jn(i,o),r);a<e&&t.push({dist:a,range1:s,range2:o});}function si(t,e,r,n,i=1/0){let s=Math.min(n.distance(t[0],r[0][0]),i);if(0===s)return s;const o=new Vn([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Fn),a=e?Ln:Dn,l=$n(r);for(;o.length;){const i=o.pop();if(i.dist>=s)continue;const u=i.range1;if(On(u)<=a){if(!Un(u,t.length))return NaN;if(e){const e=ei(t,u,r,n);if(0===(s=Math.min(s,e)))return s}else for(let e=u[0];e<=u[1];++e){const i=ti(t[e],r,n);if(0===(s=Math.min(s,i)))return s}}else {const r=Nn(u,e);if(null!==r[0]){const e=Gn(jn(t,r[0]),l,n);e<s&&o.push({dist:e,range1:r[0],range2:[0,0]});}if(null!==r[1]){const e=Gn(jn(t,r[1]),l,n);e<s&&o.push({dist:e,range1:r[1],range2:[0,0]});}}}return s}function oi(t,e,r,n,i,s=1/0){let o=Math.min(s,i.distance(t[0],r[0]));if(0===o)return o;const a=new Vn([{dist:0,range1:[0,t.length-1],range2:[0,r.length-1]}],Fn),l=e?Ln:Dn,u=n?Ln:Dn;for(;a.length;){const s=a.pop();if(s.dist>=o)continue;const c=s.range1,h=s.range2;if(On(c)<=l&&On(h)<=u){if(!Un(c,t.length)||!Un(h,r.length))return NaN;if(e&&n?o=Math.min(o,Jn(t,c,r,h,i)):e||n?e&&!n?o=Math.min(o,Yn(r,h,t,c,i)):!e&&n&&(o=Math.min(o,Yn(t,c,r,h,i))):o=Math.min(o,Qn(t,c,r,h,i)),0===o)return o}else {const s=Nn(c,e),l=Nn(h,n);ii(a,o,i,t,r,s[0],l[0]),ii(a,o,i,t,r,s[0],l[1]),ii(a,o,i,t,r,s[1],l[0]),ii(a,o,i,t,r,s[1],l[1]);}}return o}function ai(t,e,r,n,i=1/0){let s=i;const o=jn(t,[0,t.length-1]);for(const i of r)if(!(s!==1/0&&Gn(o,jn(i,[0,i.length-1]),n)>=s)&&(s=Math.min(s,oi(t,e,i,!0,n,s)),0===s))return s;return s}function li(t,e,r,n,i=1/0){let s=i;const o=jn(t,[0,t.length-1]);for(const i of r){if(s!==1/0&&Gn(o,$n(i),n)>=s)continue;const r=si(t,e,i,n,s);if(isNaN(r))return r;if(0===(s=Math.min(s,r)))return s}return s}function ui(t){return "Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class ci{constructor(t,e){this.type=yr,this.geojson=t,this.geometries=e;}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Rr(t[1])){const e=t[1];if("FeatureCollection"===e.type){for(let t=0;t<e.features.length;++t)if(ui(e.features[t].geometry.type))return new ci(e,e.features[t].geometry)}else if("Feature"===e.type){if(ui(e.geometry.type))return new ci(e,e.geometry)}else if(ui(e.type))return new ci(e,e)}return e.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const e=t.geometry(),r=t.canonicalID();if(null!=e&&null!=r){if("Point"===t.geometryType())return function(t,e,r){const n=[];for(const r of t)for(const t of r)n.push(Xn(t,e));const i=new kn(n[0][1],"meters");return "Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type?oi(n,!1,"Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,i):"MultiLineString"===r.type?ai(n,!1,r.coordinates,i):"Polygon"===r.type||"MultiPolygon"===r.type?li(n,!1,"Polygon"===r.type?[r.coordinates]:r.coordinates,i):null}(e,r,this.geometries);if("LineString"===t.geometryType())return function(t,e,r){const n=[];for(const r of t){const t=[];for(const n of r)t.push(Xn(n,e));n.push(t);}const i=new kn(n[0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return ai("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,i);if("MultiLineString"===r.type){let t=1/0;for(let e=0;e<r.coordinates.length;e++){const s=ai(r.coordinates[e],!0,n,i,t);if(isNaN(s))return s;if(0===(t=Math.min(t,s)))return t}return t}if("Polygon"===r.type||"MultiPolygon"===r.type){let t=1/0;for(let e=0;e<n.length;e++){const s=li(n[e],!0,"Polygon"===r.type?[r.coordinates]:r.coordinates,i,t);if(isNaN(s))return s;if(0===(t=Math.min(t,s)))return t}return t}return null}(e,r,this.geometries);if("Polygon"===t.geometryType())return function(t,e,r){const n=[];for(const r of function(t,e){const r=t.length;if(r<=1)return [t];const n=[];let i,s;for(let e=0;e<r;e++){const r=sn(t[e]);0!==r&&(t[e].area=Math.abs(r),void 0===s&&(s=r<0),s===r<0?(i&&n.push(i),i=[t[e]]):i.push(t[e]));}return i&&n.push(i),n}(t)){const t=[];for(let n=0;n<r.length;++n)t.push(Zn(r[n],e));n.push(t);}const i=new kn(n[0][0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return li("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,i);if("MultiLineString"===r.type){let t=1/0;for(let e=0;e<r.coordinates.length;e++){const s=li(r.coordinates[e],!0,n,i,t);if(isNaN(s))return s;if(0===(t=Math.min(t,s)))return t}return t}return "Polygon"===r.type||"MultiPolygon"===r.type?function(t,e,r){let n=1/0;for(const i of t)for(const t of e){const e=ni(i,t,r,n);if(isNaN(e))return e;if(0===(n=Math.min(n,e)))return n}return n}("Polygon"===r.type?[r.coordinates]:r.coordinates,n,i):null}(e,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.");}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return !0}serialize(){return ["distance",this.geojson]}}function hi(t){if(t instanceof Jr){if("get"===t.name&&1===t.args.length)return !1;if("feature-state"===t.name)return !1;if("has"===t.name&&1===t.args.length)return !1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return !1;if(/^filter-/.test(t.name))return !1}if(t instanceof Mn)return !1;if(t instanceof ci)return !1;if(t instanceof xi)return t.featureConstant;let e=!0;return t.eachChild((t=>{e&&!hi(t)&&(e=!1);})),e}function pi(t){if(t instanceof Jr&&"feature-state"===t.name)return !1;let e=!0;return t.eachChild((t=>{e&&!pi(t)&&(e=!1);})),e}function di(t){if(t instanceof xi)return new Set([t.key]);let e=new Set;return t.eachChild((t=>{e=new Set([...e,...di(t)]);})),e}function fi(t,e){if(t instanceof Jr&&e.indexOf(t.name)>=0)return !1;let r=!0;return t.eachChild((t=>{r&&!fi(t,e)&&(r=!1);})),r}function mi(t,e,r){return [t,e,r].filter(Boolean).join("")}function yi(t,e){switch(t){case "string":return Ur(e);case "number":return +e;case "boolean":return !!e;case "color":return sr.parse(e);case "formatted":return Cr.fromString(Ur(e));case "resolvedImage":return Dr.build(Ur(e))}return e}function gi(t,e,r,n){return void 0!==n&&(t=n*Math.round(t/n)),void 0!==e&&t<e&&(t=e),void 0!==r&&t>r&&(t=r),t}class xi{constructor(t,e,r,n=!1){this.type=t,this.key=e,this.scope=r,this.featureConstant=n;}static parse(t,e){let r=e.expectedType;if(null==r&&(r=wr),t.length<2||t.length>3)return e.error("Invalid number of arguments for 'config' expression.");const n=e.parse(t[1],1);if(!(n instanceof Nr))return e.error("Key name of 'config' expression must be a string literal.");let i,s=!0;const o=Ur(n.value);if(t.length>=3){const r=e.parse(t[2],2);if(!(r instanceof Nr))return e.error("Scope of 'config' expression must be a string literal.");i=Ur(r.value);}if(e.options){const t=mi(o,i,e._scope),r=e.options.get(t);r&&(s=hi(r.value||r.default));}return new xi(r,o,i,s)}evaluate(t){const e=mi(this.key,this.scope,t.scope),r=t.getConfig(e);if(!r)return null;const{type:n,value:i,values:s,minValue:o,maxValue:a,stepValue:l}=r,u=r.default.evaluate(t);let c=u;if(i){const e=t.scope;t.scope=(e||"").split("").slice(1).join(""),c=i.evaluate(t),t.scope=e;}return n&&(c=yi(n,c)),void 0===c||void 0===o&&void 0===a&&void 0===l||("number"==typeof c?c=gi(c,o,a,l):Array.isArray(c)&&(c=c.map((t=>"number"==typeof t?gi(t,o,a,l):t)))),void 0!==i&&void 0!==c&&s&&!s.includes(c)&&(c=u,n&&(c=yi(n,c))),(n&&n!==this.type||void 0!==c&&!Tr(Or(c),this.type))&&(c=yi(this.type.kind,c)),c}eachChild(){}outputDefined(){return !1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.scope),t}}class vi{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e;}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const r=t[1];return e.scope.has(r)?new vi(r,e.scope.get(r)):e.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return !1}serialize(){return ["var",this.name]}}class bi{constructor(t,e=[],r,n=new fr,i=[],s,o){this.registry=t,this.path=e,this.key=e.map((t=>"string"==typeof t?`['${t}']`:`[${t}]`)).join(""),this.scope=n,this.errors=i,this.expectedType=r,this._scope=s,this.options=o;}parse(t,e,r,n,i={}){return e||r?this.concat(e,null,r,n)._parse(t,i):this._parse(t,i)}parseObjectValue(t,e,r,n,i,s={}){return this.concat(e,r,n,i)._parse(t,s)}_parse(t,e){function r(t,e,r){return "assert"===r?new Gr(e,[t]):"coerce"===r?new Wr(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof t[0]?this.registry[t[0]]:void 0;if(n){let i=n.parse(t,this);if(!i)return null;if(this.expectedType){const t=this.expectedType,n=i.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==n.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(t,n))return null}else i=r(i,t,e.typeAnnotation||"coerce");else i=r(i,t,e.typeAnnotation||"assert");}if(!(i instanceof Nr)&&"resolvedImage"!==i.type.kind&&wi(i)){const t=new Kr(this._scope,this.options);try{i=new Nr(i.type,i.evaluate(t));}catch(t){return this.error(t.message),null}}return i}return Wr.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,r,n){let i="number"==typeof t?this.path.concat(t):this.path;i="string"==typeof e?i.concat(e):i;const s=n?this.scope.concat(n):this.scope;return new bi(this.registry,i,r||null,s,this.errors,this._scope,this.options)}error(t,...e){const r=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new dr(r,t));}checkSubtype(t,e){const r=Er(t,e);return r&&this.error(r),r}}function wi(t){if(t instanceof vi)return wi(t.boundExpression);if(t instanceof Jr&&"error"===t.name)return !1;if(t instanceof tn)return !1;if(t instanceof Mn)return !1;if(t instanceof ci)return !1;if(t instanceof xi)return !1;const e=t instanceof Wr||t instanceof Gr;let r=!0;return t.eachChild((t=>{r=e?r&&wi(t):r&&t instanceof Nr;})),!!r&&hi(t)&&fi(t,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function _i(t,e){const r=t.length-1;let n,i,s=0,o=r,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),n=t[a],i=t[a+1],n<=e){if(a===r||e<i)return a;s=a+1;}else {if(!(n>e))throw new jr("Input is not a number.");o=a-1;}return 0}class Ai{constructor(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of r)this.labels.push(t),this.outputs.push(e);}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const r=e.parse(t[1],1,yr);if(!r)return null;const n=[];let i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(let r=1;r<t.length;r+=2){const s=1===r?-1/0:t[r],o=t[r+1],a=r,l=r+1;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const u=e.parse(o,l,i);if(!u)return null;i=i||u.type,n.push([s,u]);}return new Ai(i,r,n)}evaluate(t){const e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);const i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[_i(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e);}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}const Mi=.95047,Ii=1.08883,Si=4/29,Pi=6/29,Ei=3*Pi*Pi,ki=Pi*Pi*Pi,zi=Math.PI/180,Ti=180/Math.PI;function Bi(t){return t>ki?Math.pow(t,1/3):t/Ei+Si}function Vi(t){return t>Pi?t*t*t:Ei*(t-Si)}function Ci(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Fi(t){return (t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Di(t){const e=Fi(t.r),r=Fi(t.g),n=Fi(t.b),i=Bi((.4124564*e+.3575761*r+.1804375*n)/Mi),s=Bi((.2126729*e+.7151522*r+.072175*n)/1);return {l:116*s-16,a:500*(i-s),b:200*(s-Bi((.0193339*e+.119192*r+.9503041*n)/Ii)),alpha:t.a}}function Li(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Vi(e),r=Mi*Vi(r),n=Ii*Vi(n),new sr(Ci(3.2404542*r-1.5371385*e-.4985314*n),Ci(-.969266*r+1.8760108*e+.041556*n),Ci(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function Ri(t,e,r){const n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const Oi={forward:Di,reverse:Li,interpolate:function(t,e,r){return {l:ur(t.l,e.l,r),a:ur(t.a,e.a,r),b:ur(t.b,e.b,r),alpha:ur(t.alpha,e.alpha,r)}}},Ui={forward:function(t){const{l:e,a:r,b:n}=Di(t),i=Math.atan2(n,r)*Ti;return {h:i<0?i+360:i,c:Math.sqrt(r*r+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*zi,r=t.c;return Li({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return {h:Ri(t.h,e.h,r),c:ur(t.c,e.c,r),l:ur(t.l,e.l,r),alpha:ur(t.alpha,e.alpha,r)}}};var Ni=Object.freeze({__proto__:null,hcl:Ui,lab:Oi});class ji{constructor(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e);}static interpolationFactor(t,e,r,n){let i=0;if("exponential"===t.name)i=$i(e,t.base,r,n);else if("linear"===t.name)i=$i(e,1,r,n);else if("cubic-bezier"===t.name){const s=t.controlPoints;i=new vt(s[0],s[1],s[2],s[3]).solve($i(e,1,r,n));}return i}static parse(t,e){let[r,n,i,...s]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t};}else {if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t};}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(i=e.parse(i,2,yr),!i)return null;const o=[];let a=null;"interpolate-hcl"===r||"interpolate-lab"===r?a=vr:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<s.length;t+=2){const r=s[t],n=s[t+1],i=t+3,l=t+4;if("number"!=typeof r)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=r)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const u=e.parse(n,l,a);if(!u)return null;a=a||u.type,o.push([r,u]);}return "number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new ji(a,r,n,i,o):e.error(`Type ${Sr(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);const i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);const s=_i(e,n),o=ji.interpolationFactor(this.interpolation,n,e[s],e[s+1]),a=r[s].evaluate(t),l=r[s+1].evaluate(t);return "interpolate"===this.operator?hr[this.type.kind.toLowerCase()](a,l,o):"interpolate-hcl"===this.operator?Ui.reverse(Ui.interpolate(Ui.forward(a),Ui.forward(l),o)):Oi.reverse(Oi.interpolate(Oi.forward(a),Oi.forward(l),o))}eachChild(t){t(this.input);for(const e of this.outputs)t(e);}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function $i(t,e,r,n){const i=n-r,s=t-r;return 0===i?0:1===e?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}class Gi{constructor(t,e){this.type=t,this.args=e;}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let r=null;const n=e.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const n of t.slice(1)){const t=e.parse(n,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!t)return null;r=r||t.type,i.push(t);}const s=n&&i.some((t=>Er(n,t.type)));return new Gi(s?wr:r,i)}evaluate(t){let e,r=null,n=0;for(const i of this.args){if(n++,r=i.evaluate(t),r&&r instanceof Dr&&!r.available&&(e||(e=r),r=null,n===this.args.length))return e;if(null!==r)break}return r}eachChild(t){this.args.forEach(t);}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize());})),t}}class Hi{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e;}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result);}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const r=[];for(let n=1;n<t.length-1;n+=2){const i=t[n];if("string"!=typeof i)return e.error(`Expected string, but found ${typeof i} instead.`,n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);const s=e.parse(t[n+1],n+1);if(!s)return null;r.push([i,s]);}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return n?new Hi(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,r]of this.bindings)t.push(e,r.serialize());return t.push(this.result.serialize()),t}}class qi{constructor(t,e,r){this.type=t,this.index=e,this.input=r;}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,yr),n=e.parse(t[2],2,Ir(e.expectedType||wr));return r&&n?new qi(n.type.itemType,r,n):null}evaluate(t){const e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new jr(`Array index out of bounds: ${e} < 0.`);if(e>=r.length)throw new jr(`Array index out of bounds: ${e} > ${r.length-1}.`);if(e!==Math.floor(e))throw new jr(`Array index must be an integer, but found ${e} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return r[e]}eachChild(t){t(this.index),t(this.input);}outputDefined(){return !1}serialize(){return ["at",this.index.serialize(),this.input.serialize()]}}class Xi{constructor(t,e,r){this.type=t,this.index=e,this.input=r;}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,yr),n=e.parse(t[2],2,Ir(e.expectedType||wr));return r&&n?new Xi(n.type.itemType,r,n):null}evaluate(t){const e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new jr(`Array index out of bounds: ${e} < 0.`);if(e>r.length-1)throw new jr(`Array index out of bounds: ${e} > ${r.length-1}.`);if(e===Math.floor(e))return r[e];const n=Math.floor(e),i=Math.ceil(e),s=r[n],o=r[i];if("number"!=typeof s||"number"!=typeof o)throw new jr(`Cannot interpolate between non-number values at index ${e}.`);const a=e-n;return s*(1-a)+o*a}eachChild(t){t(this.index),t(this.input);}outputDefined(){return !1}serialize(){return ["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Zi{constructor(t,e){this.type=xr,this.needle=t,this.haystack=e;}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,wr),n=e.parse(t[2],2,wr);return r&&n?kr(r.type,[xr,gr,yr,mr,wr])?new Zi(r,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(r.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(null==r)return !1;if(!zr(e,["boolean","string","number","null"]))throw new jr(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(Or(e))} instead.`);if(!zr(r,["string","array"]))throw new jr(`Expected second argument to be of type array or string, but found ${Sr(Or(r))} instead.`);return r.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack);}outputDefined(){return !0}serialize(){return ["in",this.needle.serialize(),this.haystack.serialize()]}}class Wi{constructor(t,e,r){this.type=yr,this.needle=t,this.haystack=e,this.fromIndex=r;}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,wr),n=e.parse(t[2],2,wr);if(!r||!n)return null;if(!kr(r.type,[xr,gr,yr,mr,wr]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(r.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,yr);return i?new Wi(r,n,i):null}return new Wi(r,n)}evaluate(t){const e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!zr(e,["boolean","string","number","null"]))throw new jr(`Expected first argument to be of type boolean, string, number or null, but found ${Sr(Or(e))} instead.`);if(!zr(r,["string","array"]))throw new jr(`Expected second argument to be of type array or string, but found ${Sr(Or(r))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return r.indexOf(e,n)}return r.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex);}outputDefined(){return !1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return ["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return ["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Yi{constructor(t,e,r,n,i,s){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=s;}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const i={},s=[];for(let o=2;o<t.length-1;o+=2){let a=t[o];const l=t[o+1];Array.isArray(a)||(a=[a]);const u=e.concat(o);if(0===a.length)return u.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return u.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return u.error("Numeric branch labels must be integer values.");if(r){if(u.checkSubtype(r,Or(t)))return null}else r=Or(t);if(void 0!==i[String(t)])return u.error("Branch labels must be unique.");i[String(t)]=s.length;}const c=e.parse(l,o,n);if(!c)return null;n=n||c.type,s.push(c);}const o=e.parse(t[1],1,wr);if(!o)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==o.type.kind&&e.concat(1).checkSubtype(r,o.type)?null:new Yi(r,n,o,i,s,a):null}evaluate(t){const e=this.input.evaluate(t);return (Tr(Or(e),this.inputType)&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise);}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),r=[],n={};for(const t of e){const e=n[this.cases[t]];void 0===e?(n[this.cases[t]]=r.length,r.push([this.cases[t],[t]])):r[e][1].push(t);}const i=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,n]of r)t.push(1===n.length?i(n[0]):n.map(i)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}class Ki{constructor(t,e,r){this.type=t,this.branches=e,this.otherwise=r;}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const n=[];for(let i=1;i<t.length-1;i+=2){const s=e.parse(t[i],i,xr);if(!s)return null;const o=e.parse(t[i+1],i+1,r);if(!o)return null;n.push([s,o]),r=r||o.type;}const i=e.parse(t[t.length-1],t.length-1,r);return i?new Ki(r,n,i):null}evaluate(t){for(const[e,r]of this.branches)if(e.evaluate(t))return r.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,r]of this.branches)t(e),t(r);t(this.otherwise);}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize());})),t}}class Ji{constructor(t,e,r,n){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=n;}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,wr),n=e.parse(t[2],2,yr);if(!r||!n)return null;if(!kr(r.type,[Ir(wr),gr,wr]))return e.error(`Expected first argument to be of type array or string, but found ${Sr(r.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,yr);return i?new Ji(r.type,r,n,i):null}return new Ji(r.type,r,n)}evaluate(t){const e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!zr(e,["string","array"]))throw new jr(`Expected first argument to be of type array or string, but found ${Sr(Or(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(r,n)}return e.slice(r)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex);}outputDefined(){return !1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return ["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return ["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Qi{constructor(t,e){this.type=Ir(gr),this.str=t,this.delimiter=e;}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=e.parse(t[1],1,gr),n=e.parse(t[2],2,gr);return r&&n?new Qi(r,n):void 0}evaluate(t){const e=this.str.evaluate(t),r=this.delimiter.evaluate(t);return e.split(r)}eachChild(t){t(this.str),t(this.delimiter);}outputDefined(){return !1}serialize(){return ["split",this.str.serialize(),this.delimiter.serialize()]}}function ts(t,e){return "=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function es(t,e,r,n){return 0===n.compare(e,r)}function rs(t,e,r){const n="=="!==t&&"!="!==t;return class i{constructor(t,e,r){this.type=xr,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind;}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const r=t[0];let s=e.parse(t[1],1,wr);if(!s)return null;if(!ts(r,s.type))return e.concat(1).error(`"${r}" comparisons are not supported for type '${Sr(s.type)}'.`);let o=e.parse(t[2],2,wr);if(!o)return null;if(!ts(r,o.type))return e.concat(2).error(`"${r}" comparisons are not supported for type '${Sr(o.type)}'.`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error(`Cannot compare types '${Sr(s.type)}' and '${Sr(o.type)}'.`);n&&("value"===s.type.kind&&"value"!==o.type.kind?s=new Gr(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new Gr(s.type,[o])));let a=null;if(4===t.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,_r),!a)return null}return new i(s,o,a)}evaluate(i){const s=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const e=Or(s),r=Or(o);if(e.kind!==r.kind||"string"!==e.kind&&"number"!==e.kind)throw new jr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=Or(s),r=Or(o);if("string"!==t.kind||"string"!==r.kind)return e(i,s,o)}return this.collator?r(i,s,o,this.collator.evaluate(i)):e(i,s,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator);}outputDefined(){return !0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize());})),e}}}const ns=rs("==",(function(t,e,r){return e===r}),es),is=rs("!=",(function(t,e,r){return e!==r}),(function(t,e,r,n){return !es(0,e,r,n)})),ss=rs("<",(function(t,e,r){return e<r}),(function(t,e,r,n){return n.compare(e,r)<0})),os=rs(">",(function(t,e,r){return e>r}),(function(t,e,r,n){return n.compare(e,r)>0})),as=rs("<=",(function(t,e,r){return e<=r}),(function(t,e,r,n){return n.compare(e,r)<=0})),ls=rs(">=",(function(t,e,r){return e>=r}),(function(t,e,r,n){return n.compare(e,r)>=0}));class us{constructor(t,e,r,n,i,s){this.type=gr,this.number=t,this.locale=e,this.currency=r,this.unit=n,this.minFractionDigits=i,this.maxFractionDigits=s;}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const r=e.parse(t[1],1,yr);if(!r)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=e.parseObjectValue(n.locale,2,"locale",gr),!i))return null;let s=null;if(n.currency&&(s=e.parseObjectValue(n.currency,2,"currency",gr),!s))return null;let o=null;if(n.unit&&(o=e.parseObjectValue(n.unit,2,"unit",gr),!o))return null;let a=null;if(n["min-fraction-digits"]&&(a=e.parseObjectValue(n["min-fraction-digits"],2,"min-fraction-digits",yr),!a))return null;let l=null;return n["max-fraction-digits"]&&(l=e.parseObjectValue(n["max-fraction-digits"],2,"max-fraction-digits",yr),!l)?null:new us(r,i,s,o,a,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits);}outputDefined(){return !1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class cs{constructor(t){this.type=yr,this.input=t;}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error(`Expected argument of type string or array, but found ${Sr(r.type)} instead.`):new cs(r):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new jr(`Expected value to be of type string or array, but found ${Sr(Or(e))} instead.`)}eachChild(t){t(this.input);}outputDefined(){return !1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize());})),t}}function hs(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ps={"==":ns,"!=":is,">":os,"<":ss,">=":ls,"<=":as,array:Gr,at:qi,"at-interpolated":Xi,boolean:Gr,case:Ki,coalesce:Gi,collator:tn,format:Hr,image:qr,in:Zi,"index-of":Wi,interpolate:ji,"interpolate-hcl":ji,"interpolate-lab":ji,length:cs,let:Hi,literal:Nr,match:Yi,number:Gr,"number-format":us,object:Gr,slice:Ji,step:Ai,string:Gr,"to-boolean":Wr,"to-color":Wr,"to-number":Wr,"to-string":Wr,var:vi,within:Mn,distance:ci,config:xi,split:Qi};function ds(t,[e,r,n,i]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const s=i?i.evaluate(t):1,o=Lr(e,r,n,s);if(o)throw new jr(o);return new sr(e/255,r/255,n/255,s)}function fs(t,[e,r,n,i]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const s=i?i.evaluate(t):1,o=function(t,e,r,n){return "number"==typeof t&&t>=0&&t<=360?"number"==typeof e&&e>=0&&e<=100&&"number"==typeof r&&r>=0&&r<=100?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid hsla value [${[t,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,n,s);if(o)throw new jr(o);const a=`hsla(${e}, ${r}%, ${n}%, ${s})`,l=sr.parse(a);if(!l)throw new jr(`Failed to parse HSLA color: ${a}`);return l}function ms(t,e){return t in e}function ys(t,e){const r=e[t];return void 0===r?null:r}function gs(t){return {type:t}}function xs(t){return {result:"success",value:t}}function vs(t){return {result:"error",value:t}}function bs(t,e){return !!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function ws(t){return "data-driven"===t["property-type"]}function _s(t){return bs(t.expression,"measure-light")}function As(t){return bs(t.expression,"zoom")}function Ms(t){return !!t.expression&&t.expression.interpolated}function Is(t){return "object"==typeof t&&null!==t&&!Array.isArray(t)}function Ss(t){return t}function Ps(t,e){const r="color"===e.type,n=t.stops&&"object"==typeof t.stops[0][0],i=n||!(n||void 0!==t.property),s=t.type||(Ms(e)?"exponential":"interval");if(r&&((t=pr({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],sr.parse(t[1])]))),t.default=sr.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Ni[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let o,a,l;if("exponential"===s)o=Ts;else if("interval"===s)o=zs;else if("categorical"===s){o=ks,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];l=typeof t.stops[0][0];}else {if("identity"!==s)throw new Error(`Unknown function type "${s}"`);o=Bs;}if(n){const r={},n=[];for(let e=0;e<t.stops.length;e++){const i=t.stops[e],s=i[0].zoom;void 0===r[s]&&(r[s]={zoom:s,type:t.type,property:t.property,default:t.default,stops:[]},n.push(s)),r[s].stops.push([i[0].value,i[1]]);}const i=[];for(const t of n)i.push([r[t].zoom,Ps(r[t],e)]);const s={name:"linear"};return {kind:"composite",interpolationType:s,interpolationFactor:ji.interpolationFactor.bind(void 0,s),zoomStops:i.map((t=>t[0])),evaluate:({zoom:r},n)=>Ts({stops:i,base:t.base},e,r).evaluate(r,n)}}if(i){const r="exponential"===s?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return {kind:"camera",interpolationType:r,interpolationFactor:ji.interpolationFactor.bind(void 0,r),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:r})=>o(t,e,r,a,l)}}return {kind:"source",evaluate(r,n){const i=n&&n.properties?n.properties[t.property]:void 0;return void 0===i?Es(t.default,e.default):o(t,e,i,a,l)}}}function Es(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function ks(t,e,r,n,i){return Es(typeof r===i?n[r]:void 0,t.default,e.default)}function zs(t,e,r){if("number"!==Xr(r))return Es(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];const i=_i(t.stops.map((t=>t[0])),r);return t.stops[i][1]}function Ts(t,e,r){const n=void 0!==t.base?t.base:1;if("number"!==Xr(r))return Es(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];const s=_i(t.stops.map((t=>t[0])),r),o=function(t,e,r,n){const i=n-r,s=t-r;return 0===i?0:1===e?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}(r,n,t.stops[s][0],t.stops[s+1][0]),a=t.stops[s][1],l=t.stops[s+1][1];let u=hr[e.type]||Ss;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=Ni[t.colorSpace];u=(t,r)=>e.reverse(e.interpolate(e.forward(t),e.forward(r),o));}return "function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),r=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==r)return u(e,r,o)}}:u(a,l,o)}function Bs(t,e,r){return "color"===e.type?r=sr.parse(r):"formatted"===e.type?r=Cr.fromString(r.toString()):"resolvedImage"===e.type?r=Dr.build(r.toString()):Xr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),Es(r,t.default,e.default)}Jr.register(ps,{error:[{kind:"error"},[gr],(t,[e])=>{throw new jr(e.evaluate(t))}],typeof:[gr,[wr],(t,[e])=>Sr(Or(e.evaluate(t)))],"to-rgba":[Ir(yr,4),[vr],(t,[e])=>e.evaluate(t).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ir(yr,4),[vr],(t,[e])=>e.evaluate(t).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[vr,[yr,yr,yr],ds],rgba:[vr,[yr,yr,yr,yr],ds],hsl:[vr,[yr,yr,yr],fs],hsla:[vr,[yr,yr,yr,yr],fs],has:{type:xr,overloads:[[[gr],(t,[e])=>ms(e.evaluate(t),t.properties())],[[gr,br],(t,[e,r])=>ms(e.evaluate(t),r.evaluate(t))]]},get:{type:wr,overloads:[[[gr],(t,[e])=>ys(e.evaluate(t),t.properties())],[[gr,br],(t,[e,r])=>ys(e.evaluate(t),r.evaluate(t))]]},"feature-state":[wr,[gr],(t,[e])=>ys(e.evaluate(t),t.featureState||{})],properties:[br,[],t=>t.properties()],"geometry-type":[gr,[],t=>t.geometryType()],worldview:[gr,[],t=>t.globals.worldview||""],id:[wr,[],t=>t.id()],zoom:[yr,[],t=>t.globals.zoom],pitch:[yr,[],t=>t.globals.pitch||0],"distance-from-center":[yr,[],t=>t.distanceFromCenter()],"measure-light":[yr,[gr],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[yr,[],t=>t.globals.heatmapDensity||0],"line-progress":[yr,[],t=>t.globals.lineProgress||0],"raster-value":[yr,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[yr,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[yr,[],t=>t.globals.skyRadialProgress||0],accumulated:[wr,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[yr,gs(yr),(t,e)=>{let r=0;for(const n of e)r+=n.evaluate(t);return r}],"*":[yr,gs(yr),(t,e)=>{let r=1;for(const n of e)r*=n.evaluate(t);return r}],"-":{type:yr,overloads:[[[yr,yr],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[yr],(t,[e])=>-e.evaluate(t)]]},"/":[yr,[yr,yr],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[yr,[yr,yr],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[yr,[],()=>Math.LN2],pi:[yr,[],()=>Math.PI],e:[yr,[],()=>Math.E],"^":[yr,[yr,yr],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[yr,[yr],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[yr,[yr],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[yr,[yr],(t,[e])=>Math.log(e.evaluate(t))],log2:[yr,[yr],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[yr,[yr],(t,[e])=>Math.sin(e.evaluate(t))],cos:[yr,[yr],(t,[e])=>Math.cos(e.evaluate(t))],tan:[yr,[yr],(t,[e])=>Math.tan(e.evaluate(t))],asin:[yr,[yr],(t,[e])=>Math.asin(e.evaluate(t))],acos:[yr,[yr],(t,[e])=>Math.acos(e.evaluate(t))],atan:[yr,[yr],(t,[e])=>Math.atan(e.evaluate(t))],min:[yr,gs(yr),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[yr,gs(yr),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[yr,[yr],(t,[e])=>Math.abs(e.evaluate(t))],round:[yr,[yr],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[yr,[yr],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[yr,[yr],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[xr,[gr,wr],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[xr,[wr],(t,[e])=>t.id()===e.value],"filter-type-==":[xr,[gr],(t,[e])=>t.geometryType()===e.value],"filter-<":[xr,[gr,wr],(t,[e,r])=>{const n=t.properties()[e.value],i=r.value;return typeof n==typeof i&&n<i}],"filter-id-<":[xr,[wr],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[xr,[gr,wr],(t,[e,r])=>{const n=t.properties()[e.value],i=r.value;return typeof n==typeof i&&n>i}],"filter-id->":[xr,[wr],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[xr,[gr,wr],(t,[e,r])=>{const n=t.properties()[e.value],i=r.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[xr,[wr],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[xr,[gr,wr],(t,[e,r])=>{const n=t.properties()[e.value],i=r.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[xr,[wr],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[xr,[wr],(t,[e])=>e.value in t.properties()],"filter-has-id":[xr,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[xr,[Ir(gr)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[xr,[Ir(wr)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[xr,[gr,Ir(wr)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[xr,[gr,Ir(wr)],(t,[e,r])=>function(t,e,r,n){for(;r<=n;){const i=r+n>>1;if(e[i]===t)return !0;e[i]>t?n=i-1:r=i+1;}return !1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:xr,overloads:[[[xr,xr],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[gs(xr),(t,e)=>{for(const r of e)if(!r.evaluate(t))return !1;return !0}]]},any:{type:xr,overloads:[[[xr,xr],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[gs(xr),(t,e)=>{for(const r of e)if(r.evaluate(t))return !0;return !1}]]},"!":[xr,[xr],(t,[e])=>!e.evaluate(t)],"is-supported-script":[xr,[gr],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return !r||r(e.evaluate(t))}],upcase:[gr,[gr],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[gr,[gr],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[gr,gs(wr),(t,e)=>e.map((e=>Ur(e.evaluate(t)))).join("")],"resolved-locale":[gr,[_r],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[yr,[yr,yr,wr],(t,e)=>{const[r,n,i]=e.map((e=>e.evaluate(t)));if(r>n)return r;if(r===n)return r;let s;if("string"==typeof i)s=function(t){let e=0;if(0===t.length)return e;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}(i);else {if("number"!=typeof i)throw new jr(`Invalid seed input: ${i}`);s=i;}return r+hs(s)()*(n-r)}]});class Vs{constructor(t,e,r,n){this.expression=t,this._warningHistory={},this._evaluator=new Kr(r,n),this._defaultValue=e?function(t){return "color"===t.type&&(Is(t.default)||Array.isArray(t.default))?new sr(0,0,0,0):"color"===t.type?sr.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null,this.configDependencies=di(t);}evaluateWithoutErrorHandling(t,e,r,n,i,s,o,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,r,n,i,s,o,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new jr(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${t.message}`)),this._defaultValue}}}function Cs(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in ps}function Fs(t,e,r,n){const i=new bi(ps,[],e?function(t){const e={color:vr,string:gr,number:yr,enum:gr,boolean:xr,formatted:Ar,resolvedImage:Mr};return "array"===t.type?Ir(e[t.value]||wr,t.length):e[t.type]}(e):void 0,void 0,void 0,r,n),s=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?xs(new Vs(s,e,r,n)):vs(i.errors)}class Ds{constructor(t,e,r,n){this.kind=t,this._styleExpression=e,this.isLightConstant=r,this.isLineProgressConstant=n,this.isStateDependent="constant"!==t&&!pi(e.expression),this.configDependencies=di(e.expression);}evaluateWithoutErrorHandling(t,e,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,s)}evaluate(t,e,r,n,i,s){return this._styleExpression.evaluate(t,e,r,n,i,s)}}class Ls{constructor(t,e,r,n,i,s){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!pi(e.expression),this.isLightConstant=i,this.isLineProgressConstant=s,this.configDependencies=di(e.expression),this.interpolationType=n;}evaluateWithoutErrorHandling(t,e,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,s)}evaluate(t,e,r,n,i,s){return this._styleExpression.evaluate(t,e,r,n,i,s)}interpolationFactor(t,e,r){return this.interpolationType?ji.interpolationFactor(this.interpolationType,t,e,r):0}}function Rs(t,e,r,n){if("error"===(t=Fs(t,e,r,n)).result)return t;const i=t.value.expression,s=hi(i);if(!s&&!ws(e))return vs([new dr("","data expressions not supported")]);const o=fi(i,["zoom","pitch","distance-from-center"]);if(!o&&!As(e))return vs([new dr("","zoom expressions not supported")]);const a=fi(i,["measure-light"]);if(!a&&!_s(e))return vs([new dr("","measure-light expression not supported")]);const l=fi(i,["line-progress"]);if(!l&&!function(t){return bs(t.expression,"line-progress")}(e))return vs([new dr("","line-progress expression not supported")]);const u=e.expression&&e.expression.relaxZoomRestriction,c=Us(i);return c||o||u?c instanceof dr?vs([c]):c instanceof ji&&!Ms(e)?vs([new dr("",'"interpolate" expressions cannot be used with this property')]):xs(c?new Ls(s&&l?"camera":"composite",t.value,c.labels,c instanceof ji?c.interpolation:void 0,a,l):new Ds(s&&l?"constant":"source",t.value,a,l)):vs([new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Os{constructor(t,e){this._parameters=t,this._specification=e,pr(this,Ps(this._parameters,this._specification));}static deserialize(t){return new Os(t._parameters,t._specification)}static serialize(t){return {_parameters:t._parameters,_specification:t._specification}}}function Us(t){let e=null;if(t instanceof Hi)e=Us(t.result);else if(t instanceof Gi){for(const r of t.args)if(e=Us(r),e)break}else (t instanceof Ai||t instanceof ji)&&t.input instanceof Jr&&"zoom"===t.input.name&&(e=t);return e instanceof dr||t.eachChild((t=>{const r=Us(t);r instanceof dr?e=r:e&&r&&e!==r&&(e=new dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'));})),e}var Ns,js,$s=function(){if(js)return Ns;js=1,Ns=e;var t=3;function e(e,r,n){var i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var s=new Int32Array(this.arrayBuffer);e=s[0],this.d=(r=s[1])+2*(n=s[2]);for(var o=0;o<this.d*this.d;o++){var a=s[t+o],l=s[t+o+1];i.push(a===l?null:s.subarray(a,l));}var u=s[t+i.length+1];this.keys=s.subarray(s[t+i.length],u),this.bboxes=s.subarray(u),this.insert=this._insertReadonly;}else {this.d=r+2*n;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[];}this.n=r,this.extent=e,this.padding=n,this.scale=r/e,this.uid=0;var h=n/r*e;this.min=-h,this.max=e+h;}return e.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i);},e.prototype._insertReadonly=function(){throw "Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(t,e,r,n,i,s){this.cells[i].push(s);},e.prototype.query=function(t,e,r,n,i){var s=this.min,o=this.max;if(t<=s&&e<=s&&o<=r&&o<=n&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,r,n,this._queryCell,a,{},i),a},e.prototype._queryCell=function(t,e,r,n,i,s,o,a){var l=this.cells[i];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var p=l[h];if(void 0===o[p]){var d=4*p;(a?a(c[d+0],c[d+1],c[d+2],c[d+3]):t<=c[d+2]&&e<=c[d+3]&&r>=c[d+0]&&n>=c[d+1])?(o[p]=!0,s.push(u[p])):o[p]=!1;}}},e.prototype._forEachCell=function(t,e,r,n,i,s,o,a){for(var l=this._convertToCellCoord(t),u=this._convertToCellCoord(e),c=this._convertToCellCoord(r),h=this._convertToCellCoord(n),p=l;p<=c;p++)for(var d=u;d<=h;d++){var f=this.d*d+p;if((!a||a(this._convertFromCellCoord(p),this._convertFromCellCoord(d),this._convertFromCellCoord(p+1),this._convertFromCellCoord(d+1)))&&i.call(this,t,e,r,n,f,s,o,a))return}},e.prototype._convertFromCellCoord=function(t){return (t-this.padding)/this.scale},e.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,r=t+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var s=new Int32Array(r+n+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var o=r,a=0;a<e.length;a++){var l=e[a];s[t+a]=o,s.set(l,o),o+=l.length;}return s[t+e.length]=o,s.set(this.keys,o),s[t+e.length+1]=o+=this.keys.length,s.set(this.bboxes,o),o+=this.bboxes.length,s.buffer},Ns}(),Gs=gt($s);const Hs={};function qs(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),Hs[e]={klass:t,omit:r.omit||[]};}qs(Object,"Object"),Gs.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.add(r),{buffer:r}},Gs.deserialize=function(t){return new Gs(t.buffer)},Object.defineProperty(Gs,"name",{value:"Grid"}),qs(Gs,"Grid"),delete bt.prototype.constructor,"undefined"!=typeof DOMMatrix&&qs(DOMMatrix,"DOMMatrix"),qs(sr,"Color"),qs(Error,"Error"),qs(Cr,"Formatted"),qs(Vr,"FormattedSection"),qs(Ve,"AJAXError"),qs(Dr,"ResolvedImage"),qs(Os,"StylePropertyFunction"),qs(Vs,"StyleExpression",{omit:["_evaluator"]}),qs(er,"ImageId"),qs(Fr,"ImageVariant"),qs(Ls,"ZoomDependentExpression"),qs(Ds,"ZoomConstantExpression"),qs(Jr,"CompoundExpression",{omit:["_evaluate"]});for(const t in ps)Hs[ps[t]._classRegistryKey]||qs(ps[t],`Expression${t}`);function Xs(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Zs(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Ws(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Xs(t)||Zs(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t))return e&&e.add(t.buffer),t;if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const n of t)r.push(Ws(n,e));return r}if(t instanceof Map){const r={$name:"Map",entries:[]};for(const[n,i]of t.entries())r.entries.push(Ws(n),Ws(i,e));return r}if(t instanceof Set){const e={$name:"Set"};let r=0;for(const n of t.values())e[++r]=Ws(n);return e}if(t instanceof DOMMatrix){const e={$name:"DOMMatrix"},r=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const n of r)e[n]=t[n];return e}if("bigint"==typeof t)return {$name:"BigInt",value:t.toString()};if("object"==typeof t){const r=t.constructor,n=r._classRegistryKey;if(!n)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const i=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const r in t)t.hasOwnProperty(r)&&(Hs[n].omit.indexOf(r)>=0||(i[r]=Ws(t[r],e)));t instanceof Error&&(i.message=t.message);}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return "Object"!==n&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof t)}function Ys(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Xs(t)||Zs(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Ys);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const e=t.entries||[],r=new Map;for(let t=0;t<e.length;t+=2)r.set(Ys(e[t]),Ys(e[t+1]));return r}if("Set"===e){const e=new Set;for(const r of Object.keys(t))"$name"!==r&&e.add(Ys(t[r]));return e}if("DOMMatrix"===e){let e;return e=t.is2D?[t.a,t.b,t.c,t.d,t.e,t.f]:[t.m11,t.m12,t.m13,t.m14,t.m21,t.m22,t.m23,t.m24,t.m31,t.m32,t.m33,t.m34,t.m41,t.m42,t.m43,t.m44],new DOMMatrix(e)}if("BigInt"===e)return BigInt(t.value);const{klass:r}=Hs[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(t);const n=Object.create(r.prototype);for(const e of Object.keys(t))"$name"!==e&&(n[e]=Ys(t[e]));return n}throw new Error("can't deserialize object of type "+typeof t)}const Ks={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,Osage:t=>t>=66736&&t<=66815,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Js(t){for(const e of t)if(eo(e.charCodeAt(0)))return !0;return !1}function Qs(t){for(const e of t)if(!to(e.charCodeAt(0)))return !1;return !0}function to(t){return !(Ks.Arabic(t)||Ks["Arabic Supplement"](t)||Ks["Arabic Extended-A"](t)||Ks["Arabic Presentation Forms-A"](t)||Ks["Arabic Presentation Forms-B"](t))}function eo(t){return !(746!==t&&747!==t&&(t<4352||!(Ks["Bopomofo Extended"](t)||Ks.Bopomofo(t)||Ks["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ks["CJK Compatibility Ideographs"](t)||Ks["CJK Compatibility"](t)||Ks["CJK Radicals Supplement"](t)||Ks["CJK Strokes"](t)||!(!Ks["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Ks["CJK Unified Ideographs Extension A"](t)||Ks["CJK Unified Ideographs"](t)||Ks["Enclosed CJK Letters and Months"](t)||Ks["Hangul Compatibility Jamo"](t)||Ks["Hangul Jamo Extended-A"](t)||Ks["Hangul Jamo Extended-B"](t)||Ks["Hangul Jamo"](t)||Ks["Hangul Syllables"](t)||Ks.Hiragana(t)||Ks["Ideographic Description Characters"](t)||Ks.Kanbun(t)||Ks["Kangxi Radicals"](t)||Ks["Katakana Phonetic Extensions"](t)||Ks.Katakana(t)&&12540!==t||!(!Ks["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ks["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ks["Unified Canadian Aboriginal Syllabics"](t)||Ks["Unified Canadian Aboriginal Syllabics Extended"](t)||Ks["Vertical Forms"](t)||Ks["Yijing Hexagram Symbols"](t)||Ks["Yi Syllables"](t)||Ks["Yi Radicals"](t))))}function ro(t){return !(eo(t)||function(t){return !!(Ks["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Ks["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Ks["Letterlike Symbols"](t)||Ks["Number Forms"](t)||Ks["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ks["Control Pictures"](t)&&9251!==t||Ks["Optical Character Recognition"](t)||Ks["Enclosed Alphanumerics"](t)||Ks["Geometric Shapes"](t)||Ks["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ks["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ks["CJK Symbols and Punctuation"](t)||Ks.Katakana(t)||Ks["Private Use Area"](t)||Ks["CJK Compatibility Forms"](t)||Ks["Small Form Variants"](t)||Ks["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function no(t){return Ks.Arabic(t)||Ks["Arabic Supplement"](t)||Ks["Arabic Extended-A"](t)||Ks["Arabic Presentation Forms-A"](t)||Ks["Arabic Presentation Forms-B"](t)}function io(t){return t>=1424&&t<=2303||Ks["Arabic Presentation Forms-A"](t)||Ks["Arabic Presentation Forms-B"](t)}function so(t,e){return !(!e&&io(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ks.Khmer(t))}function oo(t){for(const e of t)if(io(e.charCodeAt(0)))return !0;return !1}const ao={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let lo=null,uo=ao.unavailable,co=null;const ho=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(uo=ao.error),lo&&lo(t);};function po(){fo.fire(new Ye("pluginStateChange",{pluginStatus:uo,pluginURL:co}));}const fo=new tr,mo=function(){return uo},yo=function(){if(uo!==ao.deferred||!co)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");uo=ao.loading,po(),co&&De({url:co},(t=>{t?ho(t):(uo=ao.loaded,po());}));},go={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>uo===ao.loaded||null!=go.applyArabicShaping,isLoading:()=>uo===ao.loading,setState(t){uo=t.pluginStatus,co=t.pluginURL;},isParsing:()=>uo===ao.parsing,isParsed:()=>uo===ao.parsed,getPluginURL:()=>co};class xo{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.transition=e.transition,this.pitch=e.pitch,this.brightness=e.brightness,this.worldview=e.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0);}isSupportedScript(t){return function(t,e){for(const r of t)if(!so(r.charCodeAt(0),e))return !1;return !0}(t,go.isLoaded())}}class vo{constructor(t,e,r,n){this.property=t,this.value=e,this.expression=function(t,e,r,n){if(Is(t))return new Os(t,e);if(Cs(t)||Array.isArray(t)&&t.length>0){const i=Rs(t,e,r,n);if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return i.value}{let r=t;return "string"==typeof t&&"color"===e.type&&(r=sr.parse(t)),{kind:"constant",configDependencies:new Set,evaluate:()=>r}}}(void 0===e?t.specification.default:e,t.specification,r,n);}isDataDriven(){return "source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)}}class bo{constructor(t,e,r){this.property=t,this.value=new vo(t,void 0,e,r);}transitioned(t,e){return new _o(this.property,this.value,e,Ct({},t.transition,this.transition),t.now)}untransitioned(){return new _o(this.property,this.value,null,{},0)}}class wo{constructor(t,e,r){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=e,this._options=r,this.configDependencies=new Set;}getValue(t){return Nt(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new bo(this._values[t].property,this._scope,this._options)),this._values[t].value=new vo(this._values[t].property,null===e?void 0:Nt(e),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]));}setTransitionOrValue(t,e){e&&(this._options=e);const r=this._properties.properties;if(t)for(const e in t){const n=t[e];if(e.endsWith("-transition")){const t=e.slice(0,-11);r[t]&&this.setTransition(t,n);}else r.hasOwnProperty(e)&&this.setValue(e,n);}}getTransition(t){return Nt(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new bo(this._values[t].property)),this._values[t].transition=Nt(e)||void 0;}serialize(){const t={};for(const e of Object.keys(this._values)){const r=this.getValue(e);void 0!==r&&(t[e]=r);const n=this.getTransition(e);void 0!==n&&(t[`${e}-transition`]=n);}return t}transitioned(t,e){const r=new Ao(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(t,e._values[n]);return r}untransitioned(){const t=new Ao(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class _o{constructor(t,e,r,n,i){const s=n.delay||0,o=n.duration||0;i=i||0,this.property=t,this.value=e,this.begin=i+s,this.end=this.begin+o,t.specification.transition&&(n.delay||n.duration)&&(this.prior=r);}possiblyEvaluate(t,e,r){const n=t.now||0,i=this.value.possiblyEvaluate(t,e,r),s=this.prior;if(s){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return s.possiblyEvaluate(t,e,r);{const o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(t,e,r),i,Pt(o))}}return i}}class Ao{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues);}possiblyEvaluate(t,e,r){const n=new So(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(t,e,r);return n}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return !0;return !1}}class Mo{constructor(t,e,r){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=e,this._options=r,this.configDependencies=new Set;}getValue(t){return Nt(this._values[t].value)}setValue(t,e){this._values[t]=new vo(this._values[t].property,null===e?void 0:Nt(e),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]));}serialize(){const t={};for(const e of Object.keys(this._values)){const r=this.getValue(e);void 0!==r&&(t[e]=r);}return t}possiblyEvaluate(t,e,r){const n=new So(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(t,e,r);return n}}class Io{constructor(t,e,r){this.property=t,this.value=e,this.parameters=r;}isConstant(){return "constant"===this.value.kind}constantOr(t){return "constant"===this.value.kind?this.value.value:t}evaluate(t,e,r,n){return this.property.evaluate(this.value,this.parameters,t,e,r,n)}}class So{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues);}get(t){return this._values[t]}}class Po{constructor(t){this.specification=t;}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,r){const n=hr[this.specification.type];return n?n(t,e,r):t}}class Eo{constructor(t,e){this.specification=t,this.overrides=e;}possiblyEvaluate(t,e,r,n){return new Io(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},r,n)}:t.expression,e)}interpolate(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Io(this,{kind:"constant",value:void 0},t.parameters);const n=hr[this.specification.type];return n?new Io(this,{kind:"constant",value:n(t.value.value,e.value.value,r)},t.parameters):t}evaluate(t,e,r,n,i,s){return "constant"===t.kind?t.value:t.evaluate(e,r,n,i,s)}}class ko{constructor(t){this.specification=t;}possiblyEvaluate(t,e,r,n){return !!t.expression.evaluate(e,null,{},r,n)}interpolate(){return !1}}class zo{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const e=new xo(0,{});for(const r in t){const n=t[r];n.specification.overridable&&this.overridableProperties.push(r);const i=this.defaultPropertyValues[r]=new vo(n,void 0),s=this.defaultTransitionablePropertyValues[r]=new bo(n);this.defaultTransitioningPropertyValues[r]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=i.possiblyEvaluate(e);}}}qs(Eo,"DataDrivenProperty"),qs(Po,"DataConstantProperty"),qs(ko,"ColorRampProperty");var To=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Bo(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Vo(t){if(Array.isArray(t))return t.map(Vo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=Vo(t[r]);return e}return Bo(t)}function Co(t){if(!0===t||!1===t)return !0;if(!Array.isArray(t)||0===t.length)return !1;switch(t[0]){case "has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case "in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case "!in":case "!has":case "none":return !1;case "==":case "!=":case ">":case ">=":case "<":case "<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case "any":case "all":for(const e of t.slice(1))if(!Co(e)&&"boolean"!=typeof e)return !1;return !0;default:return !0}}function Fo(t,e="",r=null,n="fill"){if(null==t)return {filter:()=>!0,needGeometry:!1,needFeature:!1};Co(t)||(t=jo(t));const i=t;let s=!0;try{s=function(t){if(!Ro(t))return t;let e=Vo(t);return Lo(e),e=Do(e),e}(i);}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `);}let o=null,a=null;if("background"!==n&&"sky"!==n&&"slot"!==n){a=To[`filter_${n}`];const t=Fs(s,a,e,r);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));o=(e,r,n)=>t.value.evaluate(e,r,{},n);}let l=null,u=null;if(s!==i){const t=Fs(i,a,e,r);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));l=(e,r,n,i,s)=>t.value.evaluate(e,r,{},n,void 0,void 0,i,s),u=!hi(t.value.expression);}return {filter:o,dynamicFilter:l||void 0,needGeometry:No(s),needFeature:!!u}}function Do(t){if(!Array.isArray(t))return t;const e=function(t){if(Oo.has(t[0]))for(let e=1;e<t.length;e++)if(Ro(t[e]))return !0;return t}(t);return !0===e?e:e.map((t=>Do(t)))}function Lo(t){let e=!1;const r=[];if("case"===t[0]){for(let n=1;n<t.length-1;n+=2)e=e||Ro(t[n]),r.push(t[n+1]);r.push(t[t.length-1]);}else if("match"===t[0]){e=e||Ro(t[1]);for(let e=2;e<t.length-1;e+=2)r.push(t[e+1]);r.push(t[t.length-1]);}else if("step"===t[0]){e=e||Ro(t[1]);for(let e=1;e<t.length-1;e+=2)r.push(t[e+1]);}e&&(t.length=0,t.push("any",...r));for(let e=1;e<t.length;e++)Lo(t[e]);}function Ro(t){if(!Array.isArray(t))return !1;if("pitch"===(e=t[0])||"distance-from-center"===e)return !0;var e;for(let e=1;e<t.length;e++)if(Ro(t[e]))return !0;return !1}const Oo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Uo(t,e){return t<e?-1:t>e?1:0}function No(t){if(!Array.isArray(t))return !1;if("within"===t[0]||"distance"===t[0])return !0;for(let e=1;e<t.length;e++)if(No(t[e]))return !0;return !1}function jo(t){if(!t)return !0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?$o(t[1],t[2],"=="):"!="===e?qo($o(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?$o(t[1],t[2],e):"any"===e?(r=t.slice(1),["any"].concat(r.map(jo))):"all"===e?["all"].concat(t.slice(1).map(jo)):"none"===e?["all"].concat(t.slice(1).map(jo).map(qo)):"in"===e?Go(t[1],t.slice(2)):"!in"===e?qo(Go(t[1],t.slice(2))):"has"===e?Ho(t[1]):"!has"!==e||qo(Ho(t[1]));var r;}function $o(t,e,r){switch(t){case "$type":return [`filter-type-${r}`,e];case "$id":return [`filter-id-${r}`,e];default:return [`filter-${r}`,t,e]}}function Go(t,e){if(0===e.length)return !1;switch(t){case "$type":return ["filter-type-in",["literal",e]];case "$id":return ["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(Uo)]]:["filter-in-small",t,["literal",e]]}}function Ho(t){switch(t){case "$type":return !0;case "$id":return ["filter-has-id"];default:return ["filter-has",t]}}function qo(t){return ["!",t]}const Xo="";function Zo(t,e){return e?`${t}${Xo}${e}`:t}const Wo="-transition",Yo=new Set(["fill","line","background","hillshade","raster"]);class Ko extends tr{constructor(t,e,r,n,i){if(super(),this.id=t.id,this.fqid=Zo(this.id,r),this.type=t.type,this.scope=r,this.lut=n,this.options=i,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==t.type){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const e=Fs(this.filter,To[`filter_${t.type}`]);"error"!==e.result&&(this.configDependencies=new Set([...this.configDependencies,...e.value.configDependencies]));}if(t.slot&&(this.slot=t.slot),e.layout&&(this._unevaluatedLayout=new Mo(e.layout,this.scope,i),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),e.paint){this._transitionablePaint=new wo(e.paint,this.scope,i);for(const e in t.paint)this.setPaintProperty(e,t.paint[e]);for(const e in t.layout)this.setLayoutProperty(e,t.layout[e]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new So(e.paint);}}}onAdd(t){}onRemove(t){}isDraped(t){return !this.is3D(!0)&&Yo.has(this.type)}getLayoutProperty(t){return "visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e){if("custom"===this.type&&"visibility"===t)return void(this.visibility=e);const r=this._unevaluatedLayout;r._properties.properties[t]&&(r.setValue(t,e),this.configDependencies=new Set([...this.configDependencies,...r.configDependencies]),"visibility"===t&&this.possiblyEvaluateVisibility());}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}));}getPaintProperty(t){return t.endsWith(Wo)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e){const r=this._transitionablePaint,n=r._properties.properties;if(t.endsWith(Wo)){const i=t.slice(0,-11);return n[i]&&r.setTransition(i,e||void 0),!1}if(!n[t])return !1;const i=r._values[t],s=i.value.isDataDriven(),o=i.value;r.setValue(t,e),this.configDependencies=new Set([...this.configDependencies,...r.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const a=r._values[t].value,l=a.isDataDriven(),u=t.endsWith("pattern")||"line-dasharray"===t;return l||s||u||this._handleOverridablePaintPropertyUpdate(t,o,a)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,e,r){return null}_handleOverridablePaintPropertyUpdate(t,e,r){return !1}isHidden(t){return !!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint);}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e);}serialize(){return Ut({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}is3D(t){return !1}hasElevation(){return !1}isSky(){return !1}isTileClipped(){return !1}hasOffscreenPass(){return !1}hasShadowPass(){return !1}canCastShadows(){return !1}hasLightBeamPass(){return !1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof Io&&ws(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return !0}return !1}compileFilter(t){this._filterCompiled||(this._featureFilter=Fo(this.filter,this.scope,t),this._filterCompiled=!0);}invalidateCompiledFilter(){this._filterCompiled=!1;}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&("shadow"===t.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0);}queryRadius(t){}queryIntersectsFeature(t,e,r,n,i,s,o,a,l){}}const Jo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qo{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8;}}class ta{constructor(){this.capacity=-1,this.resize(0);}static serialize(t,e){return t._trim(),e&&e.add(t.arrayBuffer),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews());}clear(){this.length=0;}resize(t){this.reserve(t),this.length=t;}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e);}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null;}}function ea(t,e=1){let r=0,n=0;return {members:t.map((t=>{const i=Jo[t.type].BYTES_PER_ELEMENT,s=r=ra(r,Math.max(e,i)),o=t.components||1;return n=Math.max(n,i),r+=i*o,{name:t.name,type:t.type,components:o,offset:s}})),size:ra(r,Math.max(n,e)),alignment:e}}function ra(t,e){return Math.ceil(t/e)*e}class na extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e){const r=this.length;return this.resize(r+1),this.emplace(r,t,e)}emplace(t,e,r){const n=2*t;return this.int16[n+0]=e,this.int16[n+1]=r,t}}na.prototype.bytesPerElement=4,qs(na,"StructArrayLayout2i4");class ia extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)}emplace(t,e,r,n){const i=3*t;return this.int16[i+0]=e,this.int16[i+1]=r,this.int16[i+2]=n,t}}ia.prototype.bytesPerElement=6,qs(ia,"StructArrayLayout3i6");class sa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)}emplace(t,e,r,n,i){const s=4*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,t}}sa.prototype.bytesPerElement=8,qs(sa,"StructArrayLayout4i8");class oa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}oa.prototype.bytesPerElement=4,qs(oa,"StructArrayLayout1f4");class aa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)}emplace(t,e,r,n){const i=4*t,s=2*t;return this.int16[i+0]=e,this.int16[i+1]=r,this.float32[s+1]=n,t}}aa.prototype.bytesPerElement=8,qs(aa,"StructArrayLayout2i1f8");class la extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)}emplace(t,e,r,n){const i=4*t;return this.int16[i+0]=e,this.int16[i+1]=r,this.int16[i+2]=n,t}}la.prototype.bytesPerElement=8,qs(la,"StructArrayLayout3i8");class ua extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,r,n,i)}emplace(t,e,r,n,i,s){const o=5*t;return this.int16[o+0]=e,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,this.int16[o+4]=s,t}}ua.prototype.bytesPerElement=10,qs(ua,"StructArrayLayout5i10");class ca extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,s,o)}emplace(t,e,r,n,i,s,o,a){const l=6*t,u=12*t,c=3*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.uint8[u+4]=n,this.uint8[u+5]=i,this.uint8[u+6]=s,this.uint8[u+7]=o,this.float32[c+2]=a,t}}ca.prototype.bytesPerElement=12,qs(ca,"StructArrayLayout2i4ub1f12");class ha extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)}emplace(t,e,r,n){const i=3*t;return this.float32[i+0]=e,this.float32[i+1]=r,this.float32[i+2]=n,t}}ha.prototype.bytesPerElement=12,qs(ha,"StructArrayLayout3f12");class pa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,r,n,i)}emplace(t,e,r,n,i,s){const o=6*t,a=3*t;return this.uint16[o+0]=e,this.uint16[o+1]=r,this.uint16[o+2]=n,this.uint16[o+3]=i,this.float32[a+2]=s,t}}pa.prototype.bytesPerElement=12,qs(pa,"StructArrayLayout4ui1f12");class da extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)}emplace(t,e,r,n,i){const s=4*t;return this.uint16[s+0]=e,this.uint16[s+1]=r,this.uint16[s+2]=n,this.uint16[s+3]=i,t}}da.prototype.bytesPerElement=8,qs(da,"StructArrayLayout4ui8");class fa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,s)}emplace(t,e,r,n,i,s,o){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=i,this.int16[a+4]=s,this.int16[a+5]=o,t}}fa.prototype.bytesPerElement=12,qs(fa,"StructArrayLayout6i12");class ma extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o,a,l,u,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,r,n,i,s,o,a,l,u,c,h)}emplace(t,e,r,n,i,s,o,a,l,u,c,h,p){const d=12*t;return this.int16[d+0]=e,this.int16[d+1]=r,this.int16[d+2]=n,this.int16[d+3]=i,this.uint16[d+4]=s,this.uint16[d+5]=o,this.uint16[d+6]=a,this.uint16[d+7]=l,this.int16[d+8]=u,this.int16[d+9]=c,this.int16[d+10]=h,this.int16[d+11]=p,t}}ma.prototype.bytesPerElement=24,qs(ma,"StructArrayLayout4i4ui4i24");class ya extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,s)}emplace(t,e,r,n,i,s,o){const a=10*t,l=5*t;return this.int16[a+0]=e,this.int16[a+1]=r,this.int16[a+2]=n,this.float32[l+2]=i,this.float32[l+3]=s,this.float32[l+4]=o,t}}ya.prototype.bytesPerElement=20,qs(ya,"StructArrayLayout3i3f20");class ga extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)}emplace(t,e,r,n,i){const s=4*t;return this.float32[s+0]=e,this.float32[s+1]=r,this.float32[s+2]=n,this.float32[s+3]=i,t}}ga.prototype.bytesPerElement=16,qs(ga,"StructArrayLayout4f16");class xa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}xa.prototype.bytesPerElement=4,qs(xa,"StructArrayLayout1ul4");class va extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e){const r=this.length;return this.resize(r+1),this.emplace(r,t,e)}emplace(t,e,r){const n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,t}}va.prototype.bytesPerElement=4,qs(va,"StructArrayLayout2ui4");class ba extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o,a,l,u,c,h,p){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,r,n,i,s,o,a,l,u,c,h,p)}emplace(t,e,r,n,i,s,o,a,l,u,c,h,p,d){const f=20*t,m=10*t;return this.int16[f+0]=e,this.int16[f+1]=r,this.int16[f+2]=n,this.int16[f+3]=i,this.int16[f+4]=s,this.float32[m+3]=o,this.float32[m+4]=a,this.float32[m+5]=l,this.float32[m+6]=u,this.int16[f+14]=c,this.uint32[m+8]=h,this.uint16[f+18]=p,this.uint16[f+19]=d,t}}ba.prototype.bytesPerElement=40,qs(ba,"StructArrayLayout5i4f1i1ul2ui40");class wa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,s,o)}emplace(t,e,r,n,i,s,o,a){const l=8*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+4]=i,this.int16[l+5]=s,this.int16[l+6]=o,this.int16[l+7]=a,t}}wa.prototype.bytesPerElement=16,qs(wa,"StructArrayLayout3i2i2i16");class _a extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,r,n,i)}emplace(t,e,r,n,i,s){const o=4*t,a=8*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=n,this.int16[a+6]=i,this.int16[a+7]=s,t}}_a.prototype.bytesPerElement=16,qs(_a,"StructArrayLayout2f1f2i16");class Aa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,s)}emplace(t,e,r,n,i,s,o){const a=20*t,l=5*t;return this.uint8[a+0]=e,this.uint8[a+1]=r,this.float32[l+1]=n,this.float32[l+2]=i,this.float32[l+3]=s,this.float32[l+4]=o,t}}Aa.prototype.bytesPerElement=20,qs(Aa,"StructArrayLayout2ub4f20");class Ma extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,r){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)}emplace(t,e,r,n){const i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,this.uint16[i+2]=n,t}}Ma.prototype.bytesPerElement=6,qs(Ma,"StructArrayLayout3ui6");class Ia extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y,g,x,v,b){const w=this.length;return this.resize(w+1),this.emplace(w,t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y,g,x,v,b)}emplace(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y,g,x,v,b,w){const _=30*t,A=15*t,M=60*t;return this.int16[_+0]=e,this.int16[_+1]=r,this.int16[_+2]=n,this.float32[A+2]=i,this.float32[A+3]=s,this.uint16[_+8]=o,this.uint16[_+9]=a,this.uint32[A+5]=l,this.uint32[A+6]=u,this.uint32[A+7]=c,this.uint16[_+16]=h,this.uint16[_+17]=p,this.uint16[_+18]=d,this.float32[A+10]=f,this.float32[A+11]=m,this.uint8[M+48]=y,this.uint8[M+49]=g,this.uint8[M+50]=x,this.uint32[A+13]=v,this.int16[_+28]=b,this.uint8[M+58]=w,t}}Ia.prototype.bytesPerElement=60,qs(Ia,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Sa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y,g,x,v,b,w,_,A,M,I,S,P,E,k,z,T,B){const V=this.length;return this.resize(V+1),this.emplace(V,t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y,g,x,v,b,w,_,A,M,I,S,P,E,k,z,T,B)}emplace(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y,g,x,v,b,w,_,A,M,I,S,P,E,k,z,T,B,V){const C=20*t,F=40*t,D=80*t;return this.float32[C+0]=e,this.float32[C+1]=r,this.int16[F+4]=n,this.int16[F+5]=i,this.int16[F+6]=s,this.int16[F+7]=o,this.int16[F+8]=a,this.int16[F+9]=l,this.int16[F+10]=u,this.int16[F+11]=c,this.int16[F+12]=h,this.uint16[F+13]=p,this.uint16[F+14]=d,this.uint16[F+15]=f,this.uint16[F+16]=m,this.uint16[F+17]=y,this.uint16[F+18]=g,this.uint16[F+19]=x,this.uint16[F+20]=v,this.uint16[F+21]=b,this.uint16[F+22]=w,this.uint16[F+23]=_,this.uint16[F+24]=A,this.uint16[F+25]=M,this.uint16[F+26]=I,this.uint16[F+27]=S,this.uint32[C+14]=P,this.float32[C+15]=E,this.float32[C+16]=k,this.float32[C+17]=z,this.float32[C+18]=T,this.uint8[D+76]=B,this.uint16[F+39]=V,t}}Sa.prototype.bytesPerElement=80,qs(Sa,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Pa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,s)}emplace(t,e,r,n,i,s,o){const a=6*t;return this.float32[a+0]=e,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=i,this.float32[a+4]=s,this.float32[a+5]=o,t}}Pa.prototype.bytesPerElement=24,qs(Pa,"StructArrayLayout6f24");class Ea extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,r,n,i)}emplace(t,e,r,n,i,s){const o=5*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,this.float32[o+4]=s,t}}Ea.prototype.bytesPerElement=20,qs(Ea,"StructArrayLayout5f20");class ka extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,s,o)}emplace(t,e,r,n,i,s,o,a){const l=7*t;return this.float32[l+0]=e,this.float32[l+1]=r,this.float32[l+2]=n,this.float32[l+3]=i,this.float32[l+4]=s,this.float32[l+5]=o,this.float32[l+6]=a,t}}ka.prototype.bytesPerElement=28,qs(ka,"StructArrayLayout7f28");class za extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o,a,l,u,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,e,r,n,i,s,o,a,l,u,c)}emplace(t,e,r,n,i,s,o,a,l,u,c,h){const p=11*t;return this.float32[p+0]=e,this.float32[p+1]=r,this.float32[p+2]=n,this.float32[p+3]=i,this.float32[p+4]=s,this.float32[p+5]=o,this.float32[p+6]=a,this.float32[p+7]=l,this.float32[p+8]=u,this.float32[p+9]=c,this.float32[p+10]=h,t}}za.prototype.bytesPerElement=44,qs(za,"StructArrayLayout11f44");class Ta extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o,a,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,r,n,i,s,o,a,l)}emplace(t,e,r,n,i,s,o,a,l,u){const c=9*t;return this.float32[c+0]=e,this.float32[c+1]=r,this.float32[c+2]=n,this.float32[c+3]=i,this.float32[c+4]=s,this.float32[c+5]=o,this.float32[c+6]=a,this.float32[c+7]=l,this.float32[c+8]=u,t}}Ta.prototype.bytesPerElement=36,qs(Ta,"StructArrayLayout9f36");class Ba extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e){const r=this.length;return this.resize(r+1),this.emplace(r,t,e)}emplace(t,e,r){const n=2*t;return this.float32[n+0]=e,this.float32[n+1]=r,t}}Ba.prototype.bytesPerElement=8,qs(Ba,"StructArrayLayout2f8");class Va extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t,e,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)}emplace(t,e,r,n,i){const s=6*t;return this.uint32[3*t+0]=e,this.uint16[s+2]=r,this.uint16[s+3]=n,this.uint16[s+4]=i,t}}Va.prototype.bytesPerElement=12,qs(Va,"StructArrayLayout1ul3ui12");class Ca extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Ca.prototype.bytesPerElement=2,qs(Ca,"StructArrayLayout1ui2");class Fa extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m)}emplace(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y){const g=16*t;return this.float32[g+0]=e,this.float32[g+1]=r,this.float32[g+2]=n,this.float32[g+3]=i,this.float32[g+4]=s,this.float32[g+5]=o,this.float32[g+6]=a,this.float32[g+7]=l,this.float32[g+8]=u,this.float32[g+9]=c,this.float32[g+10]=h,this.float32[g+11]=p,this.float32[g+12]=d,this.float32[g+13]=f,this.float32[g+14]=m,this.float32[g+15]=y,t}}Fa.prototype.bytesPerElement=64,qs(Fa,"StructArrayLayout16f64");class Da extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);}emplaceBack(t,e,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,s,o)}emplace(t,e,r,n,i,s,o,a){const l=10*t,u=5*t;return this.uint16[l+0]=e,this.uint16[l+1]=r,this.uint16[l+2]=n,this.uint16[l+3]=i,this.float32[u+2]=s,this.float32[u+3]=o,this.float32[u+4]=a,t}}Da.prototype.bytesPerElement=20,qs(Da,"StructArrayLayout4ui3f20");class La extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.int16[1*t+0]=e,t}}La.prototype.bytesPerElement=2,qs(La,"StructArrayLayout1i2");class Ra extends ta{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer);}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint8[1*t+0]=e,t}}Ra.prototype.bytesPerElement=1,qs(Ra,"StructArrayLayout1ub1");class Oa extends Qo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Oa.prototype.size=40;class Ua extends ba{get(t){return new Oa(this,t)}}qs(Ua,"CollisionBoxArray");class Na extends Qo{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t;}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t;}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t;}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t;}}Na.prototype.size=60;class ja extends Ia{get(t){return new Na(this,t)}}qs(ja,"PlacedSymbolArray");class $a extends Qo{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t;}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t;}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}$a.prototype.size=80;class Ga extends Sa{get(t){return new $a(this,t)}}qs(Ga,"SymbolInstanceArray");class Ha extends oa{getoffsetX(t){return this.float32[1*t+0]}}qs(Ha,"GlyphOffsetArray");class qa extends na{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}qs(qa,"SymbolLineVertexArray");class Xa extends Qo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Xa.prototype.size=12;class Za extends Va{get(t){return new Xa(this,t)}}qs(Za,"FeatureIndexArray");class Wa extends va{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}qs(Wa,"FillExtrusionCentroidArray");class Ya extends Qo{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Ya.prototype.size=6;class Ka extends ia{get(t){return new Ya(this,t)}}qs(Ka,"FillExtrusionWallArray");const Ja=ea([{name:"a_pos",components:2,type:"Int16"}],4),Qa=ea([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),tl=ea([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class el{constructor(t=[]){this.segments=t;}_prepareSegment(t,e,r,n){let i=this.segments[this.segments.length-1];return t>el.MAX_VERTEX_ARRAY_LENGTH&&Gt(`Max vertices per segment is ${el.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!i||i.vertexLength+t>el.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:e,primitiveOffset:r,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i}prepareSegment(t,e,r,n){return this._prepareSegment(t,e.length,r.length,n)}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy();}static simpleSegment(t,e,r,n){return new el([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}function rl(t,e){return 256*(t=zt(Math.floor(t),0,255))+zt(Math.floor(e),0,255)}el.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qs(el,"SegmentVector");const nl=ea([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),il=ea([{name:"a_pattern_b",components:4,type:"Uint16"}]),sl=ea([{name:"a_dash",components:4,type:"Uint16"}]);class ol{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1;}add(t,e,r,n){this.ids.push(al(t)),this.positions.push(e,r,n);}eachPosition(t,e){const r=al(t);let n=0,i=this.ids.length-1;for(;n<i;){const t=n+i>>1;this.ids[t]>=r?i=t:n=t+1;}for(;this.ids[n]===r;)e(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++;}static serialize(t,e){const r=new Float64Array(t.ids),n=new Uint32Array(t.positions);return ll(r,n,0,r.length-1),e&&(e.add(r.buffer),e.add(n.buffer)),{ids:r,positions:n}}static deserialize(t){const e=new ol;let r;e.ids=t.ids,e.positions=t.positions;for(const t of e.ids)t!==r&&e.uniqueIds.push(t),r=t;return e.indexed=!0,e}}function al(t){const e=+t;return !isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:We(String(t))}function ll(t,e,r,n){for(;r<n;){const i=t[r+n>>1];let s=r-1,o=n+1;for(;;){do{s++;}while(t[s]<i);do{o--;}while(t[o]>i);if(s>=o)break;ul(t,s,o),ul(e,3*s,3*o),ul(e,3*s+1,3*o+1),ul(e,3*s+2,3*o+2);}o-r<n-o?(ll(t,e,r,o),r=o+1):(ll(t,e,o+1,n),n=o);}}function ul(t,e,r){const n=t[e];t[e]=t[r],t[r]=n;}qs(ol,"FeaturePositionMap");class cl{constructor(t){this.gl=t.gl,this.initialized=!1;}fetchUniformLocation(t,e){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,e),this.initialized=!0),!!this.location}set(t,e,r){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class hl extends cl{constructor(t){super(t),this.current=0;}set(t,e,r){this.fetchUniformLocation(t,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r));}}class pl extends cl{constructor(t){super(t),this.current=0;}set(t,e,r){this.fetchUniformLocation(t,e)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r));}}class dl extends cl{constructor(t){super(t),this.current=[0,0];}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])));}}class fl extends cl{constructor(t){super(t),this.current=[0,0,0];}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])));}}class ml extends cl{constructor(t){super(t),this.current=[0,0,0,0];}set(t,e,r){this.fetchUniformLocation(t,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])));}}class yl extends cl{constructor(t){super(t),this.current=sr.transparent.toPremultipliedRenderColor(null);}set(t,e,r){this.fetchUniformLocation(t,e)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)));}}const gl=new Float32Array(16);class xl extends cl{constructor(t){super(t),this.current=gl;}set(t,e,r){if(this.fetchUniformLocation(t,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const vl=new Float32Array(9),bl=new Float32Array(4);class wl extends cl{constructor(t){super(t),this.current=bl;}set(t,e,r){if(this.fetchUniformLocation(t,e))for(let t=0;t<4;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}function _l(t){return [rl(255*t.r,255*t.g),rl(255*t.b,255*t.a)]}class Al{constructor(t,e,r,n){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=r,this.context=n;}setUniform(t,e,r,n,i){const s=n.constantOr(this.value);e.set(t,i,s instanceof sr?s.toPremultipliedRenderColor(this.lutExpression&&"none"===this.lutExpression.value?null:this.context.lut):s);}getBinding(t,e){return "color"===this.type?new yl(t):new pl(t)}}class Ml{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1;}setConstantPatternPositions(t,e){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br),this.patternTransition=e?e.tl.concat(e.br):this.pattern;}setUniform(t,e,r,n,i){let s=null;"u_pattern"!==i&&"u_dash"!==i||(s=this.pattern),"u_pattern_b"===i&&(s=this.patternTransition),"u_pixel_ratio"===i&&(s=this.pixelRatio),s&&e.set(t,i,s);}getBinding(t,e){return "u_pattern"===e||"u_pattern_b"===e||"u_dash"===e?new ml(t):new pl(t)}}class Il{constructor(t,e,r,n){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===r?2:1,offset:0}))),this.paintVertexArray=new n;}populatePaintArray(t,e,r,n,i,s,o,a){const l=this.paintVertexArray.length,u="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new xo(0,{brightness:s,worldview:a}),e,{},i,n,o):"constant"===this.expression.kind&&this.expression.value,c=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new xo(0,{brightness:s,worldview:a}),e,{},i,n,o):this.lutExpression.value);this.paintVertexArray.resize(t),this._setPaintValue(l,t,u,c?null:this.context.lut);}updatePaintArray(t,e,r,n,i,s,o,a){const l="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:o,worldview:a},r,n,void 0,i):"constant"===this.expression.kind&&this.expression.value,u=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new xo(0,{brightness:o,worldview:a}),r,n,void 0,i):this.lutExpression.value);this._setPaintValue(t,e,l,u?null:this.context.lut);}_setPaintValue(t,e,r,n){if("color"===this.type){const i=_l(r.toPremultipliedRenderColor(n));for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,i[0],i[1]);}else {for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r));}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)));}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();}}class Sl{constructor(t,e,r,n,i,s){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=r,this.useIntegerZoom=n,this.context=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===r?4:2,offset:0}))),this.paintVertexArray=new s;}populatePaintArray(t,e,r,n,i,s,o,a){const l=this.expression.evaluate(new xo(this.context.zoom,{brightness:s,worldview:a}),e,{},i,n,o),u=this.expression.evaluate(new xo(this.context.zoom+1,{brightness:s,worldview:a}),e,{},i,n,o),c=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new xo(0,{brightness:s,worldview:a}),e,{},i,n,o):this.lutExpression.value),h=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(h,t,l,u,c?null:this.context.lut);}updatePaintArray(t,e,r,n,i,s,o,a){const l=this.expression.evaluate({zoom:this.context.zoom,brightness:o,worldview:a},r,n,void 0,i),u=this.expression.evaluate({zoom:this.context.zoom+1,brightness:o,worldview:a},r,n,void 0,i),c=!!this.lutExpression&&"none"===("composite"===this.lutExpression.kind||"source"===this.lutExpression.kind?this.lutExpression.evaluate(new xo(0,{brightness:o,worldview:a}),r,n,void 0,i):this.lutExpression.value);this._setPaintValue(t,e,l,u,c?null:this.context.lut);}_setPaintValue(t,e,r,n,i){if("color"===this.type){const n=_l(r.toPremultipliedRenderColor(i)),s=_l(r.toPremultipliedRenderColor(i));for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n[0],n[1],s[0],s[1]);}else {for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n));}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant));}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();}setUniform(t,e,r,n,i){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,o=zt(this.expression.interpolationFactor(s,this.context.zoom,this.context.zoom+1),0,1);e.set(t,i,o);}getBinding(t,e){return new pl(t)}}class Pl{constructor(t,e,r,n,i){this.expression=t,this.layerId=i,this.paintVertexAttributes=("array"===r?sl:nl).members;for(let t=0;t<e.length;++t);this.paintVertexArray=new n,this.paintTransitionVertexArray=new da;}populatePaintArray(t,e,r,n){const i=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(i,t,e.patterns&&e.patterns[this.layerId],r);}updatePaintArray(t,e,r,n,i,s,o){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],s);}_setPaintValues(t,e,r,n){if(!n||!r)return;const i=n[r[0]],s=n[r[1]];if(i){if(i){const{tl:r,br:n,pixelRatio:s}=i;for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1],n[0],n[1],s);}if(s){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:r,br:n}=s;for(let i=t;i<e;i++)this.paintTransitionVertexArray.emplace(i,r[0],r[1],n[0],n[1]);}}}upload(t){const e=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,e)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=t.createVertexBuffer(this.paintTransitionVertexArray,il.members,e));}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy();}}class El{constructor(t,e,r=(()=>!0)){this.binders={},this._buffers=[],this.context=e;const n=[];for(const i in t.paint._values){const s=t.paint.get(i);if(i.endsWith("-use-theme"))continue;if(!r(i))continue;if(!(s instanceof Io&&ws(s.property.specification)))continue;const o=Tl(i,t.type),a=s.value,l=s.property.specification.type,u=!!s.property.useIntegerZoom,c="line-dasharray"===i||i.endsWith("pattern"),h=t.paint.get(`${i}-use-theme`),p="line-dasharray"===i&&"constant"!==t.layout.get("line-cap").value.kind||h&&"constant"!==h.value.kind;if("constant"!==a.kind||p)if("source"===a.kind||p||c){const e=Cl(i,l,"source");this.binders[i]=c?new Pl(a,o,l,e,t.id):new Il(a,o,l,e),n.push(`/a_${i}`);}else {const t=Cl(i,l,"composite");this.binders[i]=new Sl(a,o,l,u,e,t),n.push(`/z_${i}`);}else this.binders[i]=c?new Ml(a.value,o):new Al(a.value,o,l,e),n.push(`/u_${i}`);h&&(this.binders[i].lutExpression=h.value);}this.cacheKey=n.sort().join("");}getMaxValue(t){const e=this.binders[t];return e instanceof Il||e instanceof Sl?e.maxValue:0}populatePaintArrays(t,e,r,n,i,s,o,a){for(const l in this.binders){const u=this.binders[l];u.context=this.context,(u instanceof Il||u instanceof Sl||u instanceof Pl)&&u.populatePaintArray(t,e,r,n,i,s,o,a);}}setConstantPatternPositions(t,e){for(const r in this.binders){const n=this.binders[r];n instanceof Ml&&n.setConstantPatternPositions(t,e);}}getPatternTransitionVertexBuffer(t){const e=this.binders[t];return e instanceof Pl?e.paintTransitionVertexBuffer:null}updatePaintArrays(t,e,r,n,i,s,o,a,l,u){let c=!1;const h=Object.keys(t),p=0!==h.length&&!a,d=p?h:e.uniqueIds;this.context.lut=i.lut;for(const a in this.binders){const h=this.binders[a];if(h.context=this.context,(h instanceof Il||h instanceof Sl||h instanceof Pl)&&h.expression&&h.expression.kind&&"constant"!==h.expression.kind&&(!0===h.expression.isStateDependent||!1===h.expression.isLightConstant)){const f=i.paint.get(a);h.expression=f.value;for(const r of d){const i=t[r.toString()];e.eachPosition(r,((t,e,r)=>{const a=n.feature(t);h.updatePaintArray(e,r,a,i,s,o,l,u);}));}if(!p)for(const e of r.uniqueIds){const i=t[e.toString()];r.eachPosition(e,((t,e,r)=>{const a=n.feature(t);h.updatePaintArray(e,r,a,i,s,o,l,u);}));}c=!0;}}return c}defines(){const t=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Al||r instanceof Ml)&&t.push(...r.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)));}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const r=this.binders[e];if(r instanceof Il||r instanceof Sl||r instanceof Pl)for(let e=0;e<r.paintVertexAttributes.length;e++)t.push(r.paintVertexAttributes[e].name);if(r instanceof Pl)for(let e=0;e<il.members.length;e++)t.push(il.members[e].name);}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const r=this.binders[e];if(r instanceof Al||r instanceof Ml||r instanceof Sl)for(const e of r.uniformNames)t.push(e);}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Al||n instanceof Ml||n instanceof Sl)for(const i of n.uniformNames)e.push({name:i,property:r,binding:n.getBinding(t,i)});}return e}setUniforms(t,e,r,n,i){for(const{name:e,property:s,binding:o}of r)this.binders[s].setUniform(t,o,i,n.get(s),e);}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const e=this.binders[t];(e instanceof Il||e instanceof Sl||e instanceof Pl)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer),e instanceof Pl&&e.paintTransitionVertexBuffer&&this._buffers.push(e.paintTransitionVertexBuffer);}}upload(t){for(const e in this.binders){const r=this.binders[e];(r instanceof Il||r instanceof Sl||r instanceof Pl)&&r.upload(t);}this.updatePaintBuffers();}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Il||e instanceof Sl||e instanceof Pl)&&e.destroy();}}}class kl{constructor(t,e,r=(()=>!0)){this.programConfigurations={};for(const n of t)this.programConfigurations[n.id]=new El(n,e,r);this.needsUpload=!1,this._featureMap=new ol,this._featureMapWithoutIds=new ol,this._bufferOffset=0,this._idlessCounter=0;}populatePaintArrays(t,e,r,n,i,s,o,a,l){for(const r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(t,e,n,i,s,o,a,l);void 0!==e.id?this._featureMap.add(e.id,r,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0;}updatePaintArrays(t,e,r,n,i,s,o,a){for(const l of r)this.needsUpload=this.programConfigurations[l.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,e,l,n,i,s,o||0,a)||this.needsUpload;}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1;}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy();}}const zl={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Tl(t,e){return zl[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Bl={"line-pattern":{source:pa,composite:pa},"fill-pattern":{source:pa,composite:pa},"fill-extrusion-pattern":{source:pa,composite:pa},"line-dasharray":{source:da,composite:da}},Vl={color:{source:Ba,composite:ga},number:{source:oa,composite:Ba}};function Cl(t,e,r){const n=Bl[t];return n&&n[r]||Vl[e][r]}qs(Al,"ConstantBinder"),qs(Ml,"PatternConstantBinder"),qs(Il,"SourceExpressionBinder"),qs(Pl,"PatternCompositeBinder"),qs(Sl,"CompositeExpressionBinder"),qs(El,"ProgramConfiguration",{omit:["_buffers"]}),qs(kl,"ProgramConfigurationSet");const Fl=Cn/Math.PI/2,Dl=5,Ll=6,Rl=16383,Ol=64,Ul=[Ol,32,16],Nl=-Fl,jl=Fl;function $l(t,e,r,n=Fl){return r=Mt(r),[t*Math.sin(r)*n,-e*n,t*Math.cos(r)*n]}function Gl(t,e,r){return $l(Math.cos(Mt(t)),Math.sin(Mt(t)),e,r)}const Hl=6371008.8,ql=2*Math.PI*Hl;class Xl{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xl(Bt(this.lng,-180,180),this.lat)}toArray(){return [this.lng,this.lat]}toString(){return `LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,r=this.lat*e,n=t.lat*e,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return Hl*Math.acos(Math.min(i,1))}toBounds(t=0){const e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new Zl({lng:this.lng-r,lat:this.lat-e},{lng:this.lng+r,lat:this.lat+e})}toEcef(t){return Gl(this.lat,this.lng,Fl+t*Fl/Hl)}static convert(t){if(t instanceof Xl)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Xl(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Xl(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Zl{constructor(t,e){if(t)if(e)this.setSouthWest(t).setNorthEast(e);else if(4===t.length){const e=t;this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]);}else {const e=t;this.setSouthWest(e[0]).setNorthEast(e[1]);}}setNorthEast(t){return this._ne=t instanceof Xl?new Xl(t.lng,t.lat):Xl.convert(t),this}setSouthWest(t){return this._sw=t instanceof Xl?new Xl(t.lng,t.lat):Xl.convert(t),this}extend(t){const e=this._sw,r=this._ne;let n,i;if(t instanceof Xl)n=t,i=t;else {if(!(t instanceof Zl))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Zl.convert(t)):this.extend(Xl.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Xl.convert(t)):this;if(n=t._sw,i=t._ne,!n||!i)return this}return e||r?(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new Xl(n.lng,n.lat),this._ne=new Xl(i.lng,i.lat)),this}getCenter(){return new Xl((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xl(this.getWest(),this.getNorth())}getSouthEast(){return new Xl(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return [this._sw.toArray(),this._ne.toArray()]}toString(){return `LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return !(this._sw&&this._ne)}contains(t){const{lng:e,lat:r}=Xl.convert(t);let n=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(t){if(t)return t instanceof Zl?t:new Zl(t)}}const Wl=0,Yl=25.5;function Kl(t){return ql*Math.cos(t*Math.PI/180)}function Jl(t){return (180+t)/360}function Ql(t){return (180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function tu(t,e){return t/Kl(e)}function eu(t){return 360*t-180}function ru(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function nu(t,e){return t*Kl(ru(e))}const iu=85.051129;function su(t){return Math.cos(Mt(zt(t,-iu,iu)))}function ou(t,e){const r=zt(e,Wl,Yl),n=Math.pow(2,r);return su(t)*ql/(512*n)}function au(t){return 1/Math.cos(t*Math.PI/180)}function lu(t,e=0){const r=Math.exp(Math.PI*(1-(t.y+e/Cn)/(1<<t.z)*2));return 80150034*r/(r*r+1)/Cn/(1<<t.z)}class uu{constructor(t,e,r=0){this.x=+t,this.y=+e,this.z=+r;}static fromLngLat(t,e=0){const r=Xl.convert(t);return new uu(Jl(r.lng),Ql(r.lat),tu(e,r.lat))}toLngLat(){return new Xl(eu(this.x),ru(this.y))}toAltitude(){return nu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ql*au(ru(this.y))}}function cu(t,e,r,n,i,s,o,a,l){const u=(e+n)/2,c=(r+i)/2,h=new bt(u,c);a(h),function(t,e,r,n,i,s){const o=r-i,a=n-s;return Math.abs((n-e)*o-(r-t)*a)/Math.hypot(o,a)}(h.x,h.y,s.x,s.y,o.x,o.y)>=l?(cu(t,e,r,u,c,s,h,a,l),cu(t,u,c,n,i,h,o,a,l)):t.push(o);}function hu(t,e,r){let n=t[0],i=n.x,s=n.y;e(n);const o=[n];for(let a=1;a<t.length;a++){const l=t[a],{x:u,y:c}=l;e(l),cu(o,i,s,u,c,n,l,e,r),i=u,s=c,n=l;}return o}function pu(t,e,r,n){if(n(e,r)){const i=e.add(r)._mult(.5);pu(t,e,i,n),pu(t,i,r,n);}else t.push(r);}function du(t,e){let r=t[0];const n=[r];for(let i=1;i<t.length;i++){const s=t[i];pu(n,r,s,e),r=s;}return n}const fu=Math.pow(2,14)-1,mu=-fu-1;function yu(t,e){const r=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=zt(r,mu,fu),t.y=zt(n,mu,fu),(r<t.x||r>t.x+1||n<t.y||n>t.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function gu(t,e,r){const n=t.loadGeometry(),i=t.extent,s=Cn/i;if(e&&r&&r.projection.isReprojectedInTileSpace){const s=1<<e.z,{scale:o,x:a,y:l,projection:u}=r,c=t=>{const r=eu((e.x+t.x/i)/s),n=ru((e.y+t.y/i)/s),c=u.project(r,n);t.x=(c.x*o-a)*i,t.y=(c.y*o-l)*i;};for(let e=0;e<n.length;e++)if(1!==t.type)n[e]=hu(n[e],c,1);else {const t=[];for(const r of n[e])r.x<0||r.x>=i||r.y<0||r.y>=i||(c(r),t.push(r));n[e]=t;}}for(const t of n)for(const e of t)yu(e,s);return n}function xu(t,e){return {type:t.type,id:t.id,properties:t.properties,geometry:e?gu(t):[]}}class vu{constructor(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(bu,this,e);}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos,r=[];let n,i=1,s=0,o=0,a=0;for(;t.pos<e;){if(s<=0){const e=t.readVarint();i=7&e,s=e>>3;}if(s--,1===i||2===i)o+=t.readSVarint(),a+=t.readSVarint(),1===i&&(n&&r.push(n),n=[]),n&&n.push(new bt(o,a));else {if(7!==i)throw new Error(`unknown command ${i}`);n&&n.push(n[0].clone());}}return n&&r.push(n),r}bbox(){const t=this._pbf;t.pos=this._geometry;const e=t.readVarint()+t.pos;let r=1,n=0,i=0,s=0,o=1/0,a=-1/0,l=1/0,u=-1/0;for(;t.pos<e;){if(n<=0){const e=t.readVarint();r=7&e,n=e>>3;}if(n--,1===r||2===r)i+=t.readSVarint(),s+=t.readSVarint(),i<o&&(o=i),i>a&&(a=i),s<l&&(l=s),s>u&&(u=s);else if(7!==r)throw new Error(`unknown command ${r}`)}return [o,l,a,u]}toGeoJSON(t,e,r){const n=this.extent*Math.pow(2,r),i=this.extent*t,s=this.extent*e,o=this.loadGeometry();function a(t){return [360*(t.x+i)/n-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+s)/n)*Math.PI))-90]}function l(t){return t.map(a)}let u;if(1===this.type){const t=[];for(const e of o)t.push(e[0]);const e=l(t);u=1===t.length?{type:"Point",coordinates:e[0]}:{type:"MultiPoint",coordinates:e};}else if(2===this.type){const t=o.map(l);u=1===t.length?{type:"LineString",coordinates:t[0]}:{type:"MultiLineString",coordinates:t};}else {if(3!==this.type)throw new Error("unknown feature type");{const t=function(t){const e=t.length;if(e<=1)return [t];const r=[];let n,i;for(let s=0;s<e;s++){const e=wu(t[s]);0!==e&&(void 0===i&&(i=e<0),i===e<0?(n&&r.push(n),n=[t[s]]):n&&n.push(t[s]));}return n&&r.push(n),r}(o),e=[];for(const r of t)e.push(r.map(l));u=1===e.length?{type:"Polygon",coordinates:e[0]}:{type:"MultiPolygon",coordinates:e};}}const c={type:"Feature",geometry:u,properties:this.properties};return null!=this.id&&(c.id=this.id),c}}function bu(t,e,r){1===t?e.id=r.readVarint():2===t?function(t,e){const r=t.readVarint()+t.pos;for(;t.pos<r;){const r=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[r]=n;}}(r,e):3===t?e.type=r.readVarint():4===t&&(e._geometry=r.pos);}function wu(t){let e=0;for(let r,n,i=0,s=t.length,o=s-1;i<s;o=i++)r=t[i],n=t[o],e+=(n.x-r.x)*(r.y+n.y);return e}vu.types=["Unknown","Point","LineString","Polygon"];class _u{constructor(t,e){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Au,this,e),this.length=this._features.length;}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const e=this._pbf.readVarint()+this._pbf.pos;return new vu(this._pbf,e,this.extent,this._keys,this._values)}}function Au(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){let e=null;const r=t.readVarint()+t.pos;for(;t.pos<r;){const r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null;}if(null==e)throw new Error("unknown feature value");return e}(r));}class Mu{constructor(t,e){this.layers=t.readFields(Iu,{},e);}}function Iu(t,e,r){if(3===t){const t=new _u(r,r.readVarint()+r.pos);t.length&&(e[t.name]=t);}}const Su="3d_elevation_id",Pu="level";class Eu{constructor(){this._valid=!1;}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(t,e){return this._valid&&t(e(this._geometry)),this}require(t,e,r){return this.get(t,!0,e,r)}optional(t,e,r){return this.get(t,!1,e,r)}success(){return this._valid}get(t,e,r,n){const i=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&void 0!==i&&!Number.isNaN(i)?r(n?n(i):i):e&&(this._valid=!1),this}}class ku{constructor(t,e){this.featureFunc=t,this.vertexFunc=e;}parseFeature(t,e,r){return this.featureFunc(t,e,r)}parseVertex(t,e,r){return this.vertexFunc(t,e,r)}}const zu=new ku(((t,e,r)=>t.reset(e).require(Su,(t=>{r.id=t;})).optional("fixed_height_relative",(t=>{r.constantHeight=t;}),Bu.decodeRelativeHeight).geometry((t=>{r.bounds=t;}),pn).success()),((t,e,r)=>t.reset(e).require(Su,(t=>{r.id=t;})).require("elevation_idx",(t=>{r.idx=t;})).require("extent",(t=>{r.extent=t;})).require("height_relative",(t=>{r.height=t;}),Bu.decodeRelativeHeight).geometry((t=>{r.position=t;}),Bu.getPoint).success())),Tu=new ku(((t,e,r)=>t.reset(e).require(Su,(t=>{r.id=t;})).optional("fixed_height",(t=>{r.constantHeight=t;}),Bu.decodeMetricHeight).geometry((t=>{r.bounds=t;}),pn).success()),((t,e,r)=>t.reset(e).require(Su,(t=>{r.id=t;})).require("elevation_idx",(t=>{r.idx=t;})).require("extent",(t=>{r.extent=t;})).require("height",(t=>{r.height=t;}),Bu.decodeMetricHeight).geometry((t=>{r.position=t;}),Bu.getPoint).success()));class Bu{static getPoint(t){return at(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static parse(t){const e=[],r=[],n=t.length,i=new Eu;for(let o=0;o<n;o++){const n=t.feature(o),a=n.properties.version,l=(s=a)?"1.0.1"===s?Tu:void 0:zu;if(void 0===l){Gt(`Unknown elevation feature version number ${a||"(unknown)"}`);continue}const u=n.properties.hasOwnProperty("type")?n.properties.type:void 0;if(u)if("Point"===vu.types[n.type]&&"curve_point"===u){const t={};l.parseVertex(i,n,t)&&e.push(t);}else if("Polygon"===vu.types[n.type]&&"curve_meta"===u){const t={};l.parseFeature(i,n,t)&&r.push(t);}}var s;return {vertices:e,features:r}}}class Vu{constructor(t,e){this.pos=t,this.dir=e;}intersectsPlane(t,e,r){const n=dt(e,this.dir);if(Math.abs(n)<1e-6)return !1;const i=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,!0}}class Cu{constructor(t,e){this.pos=t,this.dir=e;}intersectsPlane(t,e,r){const n=D(e,this.dir);if(Math.abs(n)<1e-6)return !1;const i=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,r[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(t,r,n){if(function(t,r){var n=t[0],i=t[1],s=t[2],o=r[0],a=r[1],l=r[2];return Math.abs(n-o)<=e*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=e*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=e*Math.max(1,Math.abs(s),Math.abs(l))}(this.pos,t)||0===r)return n[0]=n[1]=n[2]=0,!1;const[i,s,o]=this.dir,a=this.pos[0]-t[0],l=this.pos[1]-t[1],u=this.pos[2]-t[2],c=i*i+s*s+o*o,h=2*(a*i+l*s+u*o),p=h*h-4*c*(a*a+l*l+u*u-r*r);if(p<0){const t=Math.max(-h/2,0),e=a+i*t,c=l+s*t,p=u+o*t,d=Math.hypot(e,c,p);return n[0]=e*r/d,n[1]=c*r/d,n[2]=p*r/d,!1}{const t=(-h-Math.sqrt(p))/(2*c);if(t<0){const t=Math.hypot(a,l,u);return n[0]=a*r/t,n[1]=l*r/t,n[2]=u*r/t,!1}return n[0]=a+i*t,n[1]=l+s*t,n[2]=u+o*t,!0}}}class Fu{constructor(t,e,r,n,i){this.TL=t,this.TR=e,this.BR=r,this.BL=n,this.horizon=i;}static fromInvProjectionMatrix(t,e,r){const n=[-1,1,1],i=[1,1,1],s=[1,-1,1],o=[-1,-1,1],a=O(n,n,t),l=O(i,i,t),u=O(s,s,t),c=O(o,o,t);return new Fu(a,l,u,c,e/r)}}function Du(t,e,r){let n=1/0,i=-1/0;const s=[];for(const o of t){G(s,o,e);const t=D(s,r);n=Math.min(n,t),i=Math.max(i,t);}return [n,i]}function Lu(t,e){let r=!0;for(let n=0;n<t.planes.length;n++){const i=t.planes[n];let s=0;for(let t=0;t<e.length;t++)s+=D(i,e[t])+i[3]>=0;if(0===s)return 0;s!==e.length&&(r=!1);}return r?2:1}function Ru(t,e){for(const r of t.projections){const n=Du(e,t.points[0],r.axis);if(r.projection[1]<n[0]||r.projection[0]>n[1])return 0}return 1}function Ou(t,e){let r=0;const n=[0,0,0,0];for(let o=0;o<t.length;o++)n[0]=t[o][0],n[1]=t[o][1],n[2]=t[o][2],n[3]=1,(i=n)[0]*(s=e)[0]+i[1]*s[1]+i[2]*s[2]+i[3]*s[3]>=0&&r++;var i,s;return r}class Uu{constructor(t,e){this.points=t||new Array(8).fill([0,0,0]),this.planes=e||new Array(6).fill([0,0,0,0]),this.bounds=Nu.fromPoints(this.points),this.projections=[],this.frustumEdges=[G([],this.points[2],this.points[3]),G([],this.points[0],this.points[3]),G([],this.points[4],this.points[0]),G([],this.points[5],this.points[1]),G([],this.points[6],this.points[2]),G([],this.points[7],this.points[3])];for(const t of this.frustumEdges){const e=[0,-t[2],t[1]],r=[t[2],0,-t[0]];this.projections.push({axis:e,projection:Du(this.points,this.points[0],e)}),this.projections.push({axis:r,projection:Du(this.points,this.points[0],r)});}}static fromInvProjectionMatrix(t,e,r,n){const i=Math.pow(2,r),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const s=Y([],r,t),o=1/s[3]/e*i;return (a=s)[0]=(l=s)[0]*(u=[o,o,n?1/s[3]:o,o])[0],a[1]=l[1]*u[1],a[2]=l[2]*u[2],a[3]=l[3]*u[3],a;var a,l,u;})),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const e=F([],L([],G([],s[t[0]],s[t[1]]),G([],s[t[2]],s[t[1]]))),r=-D(e,s[t[1]]);return e.concat(r)})),a=[];for(let t=0;t<s.length;t++)a.push([s[t][0],s[t][1],s[t][2]]);return new Uu(a,o)}intersectsPrecise(t,e,r){for(let r=0;r<e.length;r++)if(!Ou(t,e[r]))return 0;for(let e=0;e<this.planes.length;e++)if(!Ou(t,this.planes[e]))return 0;for(const e of r)for(const r of this.frustumEdges){const n=L([],e,r),i=_(n);if(0===i)continue;z(n,n,1/i);const s=Du(this.points,this.points[0],n),o=Du(t,this.points[0],n);if(s[0]>o[1]||o[0]>s[1])return 0}return 1}containsPoint(t){for(const e of this.planes){const r=e[3];if(D([e[0],e[1],e[2]],t)+r<0)return !1}return !0}}class Nu{static fromPoints(t){const e=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of t)E(e,e,n),k(r,r,n);return new Nu(e,r)}static fromTileIdAndHeight(t,e,r){const n=1<<t.canonical.z,i=t.canonical.x,s=t.canonical.y;return new Nu([i/n,s/n,e],[(i+1)/n,(s+1)/n,r])}static applyTransform(t,e){const r=t.getCorners();for(let t=0;t<r.length;++t)O(r[t],r[t],e);return Nu.fromPoints(r)}static applyTransformFast(t,e){const r=[e[12],e[13],e[14]],n=[...r];for(let i=0;i<3;i++)for(let s=0;s<3;s++){const o=e[4*s+i],a=o*t.min[s],l=o*t.max[s];r[i]+=Math.min(a,l),n[i]+=Math.max(a,l);}return new Nu(r,n)}static projectAabbCorners(t,e){const r=t.getCorners();for(let t=0;t<r.length;++t)O(r[t],r[t],e);return r}constructor(t,e){this.min=t,this.max=e,this.center=z([],I([],this.min,this.max),.5);}quadrant(t){const e=[t%2==0,t<2],r=w(this.min),n=w(this.max);for(let t=0;t<e.length;t++)r[t]=e[t]?this.min[t]:this.center[t],n[t]=e[t]?this.center[t]:this.max[t];return n[2]=this.max[2],new Nu(r,n)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return [[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Lu(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Lu(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,e){return e||this.intersects(t)?Ru(t,this.getCorners()):0}intersectsPreciseFlat(t,e){return e||this.intersectsFlat(t)?Ru(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let e=0;e<3;++e)if(this.min[e]>t.max[e]||t.min[e]>this.max[e])return !1;return !0}intersectsAabbXY(t){return !(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t.min[e]),this.max[e]=Math.max(this.max[e],t.max[e]);}encapsulatePoint(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t[e]),this.max[e]=Math.max(this.max[e],t[e]);}closestPoint(t){return [Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}qs(Nu,"Aabb");class ju{constructor(t,e){this.feature=t,this.metersToTile=e,this.index=0;}get(){const t=this.feature.vertices[this.index],e=this.feature.vertexProps[this.index].dir,r=e[1],n=-e[0],i=(t.extent+1)*this.metersToTile;return [new bt(Math.trunc(t.position[0]+r*i),Math.trunc(t.position[1]+n*i)),new bt(Math.trunc(t.position[0]-r*i),Math.trunc(t.position[1]-n*i))]}next(){this.index++;}valid(){return this.index<this.feature.vertices.length}}class $u{constructor(t,e,r,n,i,s){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=t,this.heightRange={min:r,max:r},this.safeArea=e,this.constantHeight=r,null==this.constantHeight&&(null!=this.constantHeight||0!==n.length)){this.vertices=n,this.edges=i,this.edges=this.edges.filter((t=>{return t.a<this.vertices.length&&t.b<this.vertices.length&&!((e=this.vertices[t.a].position)[0]===(r=this.vertices[t.b].position)[0]&&e[1]===r[1]);var e,r;})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const t of this.vertices)this.vertexProps.push({dir:at(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,t.height),this.heightRange.max=Math.max(this.heightRange.max,t.height);for(const t of this.edges){const e=this.vertices[t.a].position,r=this.vertices[t.b].position,n=ut(ot(),r,e),i=ht(n),s=ct(ot(),n,1/i);this.edgeProps.push({vec:n,dir:s,len:i});const o=this.vertexProps[t.a].dir,a=this.vertexProps[t.b].dir;lt(o,o,s),lt(a,a,s);}for(const t of this.vertexProps)0===t.dir[0]&&0===t.dir[1]||pt(t.dir,t.dir);this.tessellate(s);}}pointElevation(t){if(null!=this.constantHeight)return this.constantHeight;const e=this.getClosestEdge(t);if(null==e)return 0;const[r,n]=e;return ur(this.vertices[this.edges[r].a].height,this.vertices[this.edges[r].b].height,n)}computeSlopeNormal(t,e){const r=this.getClosestEdge(t);if(!r)return A(0,0,1);const n=r[0],i=this.edges[n],s=this.edgeProps[n].vec,o=A(s[0],s[1],(this.vertices[i.b].height-this.vertices[i.a].height)*e),a=A(o[1],-o[0],0);L(a,a,o);const l=_(a);return l>0?z(a,a,1/l):A(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(0===this.edges.length)return;let e=0,r=Number.POSITIVE_INFINITY,n=0;const i=at(t.x,t.y);for(let t=0;t<this.edges.length;t++){const s=this.edges[t],o=this.edgeProps[t].dir,a=new Vu(i,this.edgeProps[t].dir),l=this.vertices[s.a].position,u=this.vertices[s.b].position,c=ot(),h=ot(),p=a.intersectsPlane(l,this.vertexProps[s.a].dir,c),d=a.intersectsPlane(u,this.vertexProps[s.b].dir,h);if(!p||!d)continue;const f=ut(ot(),h,c),m=ut(ot(),i,c),y=dt(f,f),g=y>0?dt(m,f)/y:0,x=zt(g,0,1),v=Math.abs((g-x)*this.edgeProps[t].len),b=ut(ot(),i,l),w=v+Math.abs(dt(b,at(o[1],-o[0])));w<r&&(e=t,r=w,n=x);}return [e,n]}tessellate(t){for(let e=this.edges.length-1;e>=0;--e){const r=this.edges[e].a,n=this.edges[e].b,{position:i,height:s,extent:o}=this.vertices[r],{position:a,height:l,extent:u}=this.vertices[n],c=this.vertexProps[r].dir,h=this.vertexProps[n].dir,p=A(i[0]/t,i[1]/t,s),d=A(a[0]/t,a[1]/t,l),f=A(c[1],-c[0],0);z(f,f,o);const m=A(h[1],-h[0],0);if(z(m,m,u),this.distSqLines(A(p[0]+.5*f[0],p[1]+.5*f[1],p[2]+.5*f[2]),A(d[0]-.5*m[0],d[1]-.5*m[1],d[2]-.5*m[2]),A(p[0]-.5*f[0],p[1]-.5*f[1],p[2]-.5*f[2]),A(d[0]+.5*m[0],d[1]+.5*m[1],d[2]+.5*m[2]))<=.0025000000000000005)continue;const y=this.vertices.length,g=lt(ot(),i,a);this.vertices.push({position:ct(g,g,.5),height:.5*(s+l),extent:.5*(o+u)});const x=lt(ot(),c,h);this.vertexProps.push({dir:pt(x,x)}),this.edges.splice(e,1),this.edgeProps.splice(e,1),this.edges.push({a:r,b:y}),this.edges.push({a:y,b:n});const v=ut(ot(),this.vertices[y].position,i),b=ht(v),w={vec:v,dir:ct(ot(),v,1/b),len:b};this.edgeProps.push(w),this.edgeProps.push(w);}}distSqLines(t,e,r,n){const i=S(b(),e,t),s=S(b(),n,r),o=S(b(),t,r),a=D(i,i),l=D(i,s),u=D(i,o),c=D(s,s),h=D(s,o),p=a*c-l*l;if(0===p){const e=D(o,s)/D(s,s);return B(R(b(),r,n,e),t)}const d=(l*h-u*c)/p,f=(a*h-l*u)/p;return B(R(b(),t,e,d),R(b(),r,n,f))}}class Gu{static parseFrom(t,e){const r=Bu.parse(t);if(!r)return [];let{vertices:n,features:i}=r;const s=1/lu(e);i.sort(((t,e)=>t.id-e.id)),n.sort(((t,e)=>t.id-e.id||t.idx-e.idx)),n=n.filter(((t,e,r)=>e===r.findIndex((e=>e.id===t.id&&e.idx===t.idx))));const o=new Array;let a=0;const l=n.length;for(const t of i){if(t.constantHeight){o.push(new $u(t.id,t.bounds,t.constantHeight));continue}for(;a!==l&&n[a].id<t.id;)a++;if(a===l||n[a].id!==t.id)continue;const e=new Array,r=new Array,i=a;for(;a!==l&&n[a].id===t.id;){const t=n[a];if(e.push({position:t.position,height:t.height,extent:t.extent}),a!==i&&n[a-1].idx===t.idx-1){const t=a-i;r.push({a:t-1,b:t});}a++;}o.push(new $u(t.id,t.bounds,void 0,e,r,s));}return o}static getElevationFeature(t,e){if(!e)return;const r=+t.properties[Su];return Number.isNaN(r)?void 0:e.find((t=>t.id===r))}}class Hu{constructor(t,e){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(e)||(this.zScale=Math.pow(2,e.z-t.z),this.xOffset=(t.x*this.zScale-e.x)*Cn,this.yOffset=(t.y*this.zScale-e.y)*Cn);}constantElevation(t,e){if(null!=t.constantHeight)return this.computeBiasedHeight(t.constantHeight,e)}pointElevation(t,e,r){const n=this.constantElevation(e,r);return null!=n?n:(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(e.pointElevation(t),r))}computeBiasedHeight(t,e){return e<=0?t:t+e*Tt(0,e,t>=0?t:Math.abs(.5*t))}}qs($u,"ElevationFeature");class qu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new na,this.indexArray=new Ma,this.segments=new el,this.programConfigurations=new kl(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,"none"!==this.elevationMode&&(this.elevatedLayoutVertexArray=new oa),this.worldview=t.worldview;}updateFootprints(t,e){}populate(t,e,r,n){const i=this.layers[0],s=[];let o=null;"circle"===i.type&&(o=i.layout.get("circle-sort-key"));for(const{feature:e,id:i,index:a,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,u=xu(e,t);if(!this.layers[0]._featureFilter.filter(new xo(this.zoom,{worldview:this.worldview}),u,r))continue;const c=o?o.evaluate(u,{},r):void 0,h={id:i,properties:e.properties,type:e.type,sourceLayerIndex:l,index:a,geometry:t?u.geometry:gu(e,r,n),patterns:{},sortKey:c};s.push(h);}o&&s.sort(((t,e)=>t.sortKey-e.sortKey));let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new fa,a=n.projection);for(const n of s){const{geometry:i,index:s,sourceLayerIndex:o}=n,l=t[s].feature;this.addFeature(n,i,s,e.availableImages,r,a,e.brightness,e.elevationFeatures),e.featureIndex.insert(l,i,s,o,this.index);}this.hasElevation||(this.elevatedLayoutVertexArray=void 0);}update(t,e,r,n,i,s,o){this.programConfigurations.updatePaintArrays(t,e,i,r,n,s,o,this.worldview);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ja.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,tl.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,Qa.members))),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy());}addFeature(t,e,r,n,i,s,o,a){let l;"none"!==this.elevationMode&&(l=Gu.getElevationFeature(t,a));for(const r of e)for(const e of r){const r=e.x,n=e.y;if(r<0||r>=Cn||n<0||n>=Cn)continue;if(s){const t=s.projectTilePoint(r,n,i),e=s.upVector(i,r,n);this.addGlobeExtVertex(t,e),this.addGlobeExtVertex(t,e),this.addGlobeExtVertex(t,e),this.addGlobeExtVertex(t,e);}const o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=o.vertexLength;if(this.addCircleVertex(r,n,-1,-1),this.addCircleVertex(r,n,1,-1),this.addCircleVertex(r,n,1,1),this.addCircleVertex(r,n,-1,1),"none"!==this.elevationMode){const t=l?l.pointElevation(new bt(r,n)):0;this.hasElevation=this.hasElevation||0!==t;for(let e=0;e<4;e++)this.elevatedLayoutVertexArray.emplaceBack(t);}this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),o.vertexLength+=4,o.primitiveLength+=2;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},n,i,o,void 0,this.worldview);}addCircleVertex(t,e,r,n){this.layoutVertexArray.emplaceBack(2*t+(r+1)/2,2*e+(n+1)/2);}addGlobeExtVertex(t,e){const r=16384;this.globeExtVertexArray.emplaceBack(t.x,t.y,t.z,e[0]*r,e[1]*r,e[2]*r);}}function Xu(t,e){for(let r=0;r<t.length;r++)if(ic(e,t[r]))return !0;for(let r=0;r<e.length;r++)if(ic(t,e[r]))return !0;return !!Ku(t,e)}function Zu(t,e,r){return !!ic(t,e)||!!ec(e,t,r)}function Wu(t,e){if(1===t.length)return nc(e,t[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let e=0;e<n.length;e++)if(ic(t,n[e]))return !0}for(let r=0;r<t.length;r++)if(nc(e,t[r]))return !0;for(let r=0;r<e.length;r++)if(Ku(t,e[r]))return !0;return !1}function Yu(t,e,r){if(t.length>1){if(Ku(t,e))return !0;for(let n=0;n<e.length;n++)if(ec(e[n],t,r))return !0}for(let n=0;n<t.length;n++)if(ec(t[n],e,r))return !0;return !1}function Ku(t,e){if(0===t.length||0===e.length)return !1;for(let r=0;r<t.length-1;r++){const n=t[r],i=t[r+1];for(let t=0;t<e.length-1;t++)if(Ju(n,i,e[t],e[t+1]))return !0}return !1}function Ju(t,e,r,n){return Ht(t,r,n)!==Ht(e,r,n)&&Ht(t,e,r)!==Ht(t,e,n)}function Qu(t,e,r){return (t.x-r.x)*(e.y-r.y)-(t.y-r.y)*(e.x-r.x)}function tc(t,e,r,n){const i=Qu(t,e,n),s=Qu(t,e,r);if(Math.sign(i)===Math.sign(s))return;const o=Qu(r,n,t),a=o+s-i;return Math.sign(o)!==Math.sign(a)?[o/(o-a),s/(s-i)]:void 0}function ec(t,e,r){const n=r*r;if(1===e.length)return t.distSqr(e[0])<n;for(let r=1;r<e.length;r++)if(rc(t,e[r-1],e[r])<n)return !0;return !1}function rc(t,e,r){const n=e.distSqr(r);if(0===n)return t.distSqr(e);const i=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(i<0?e:i>1?r:r.sub(e)._mult(i)._add(e))}function nc(t,e){let r,n,i,s=!1;for(let o=0;o<t.length;o++){r=t[o];for(let t=0,o=r.length-1;t<r.length;o=t++)n=r[t],i=r[o],n.y>e.y!=i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(s=!s);}return s}function ic(t,e){let r=!1;for(let n=0,i=t.length-1;n<t.length;i=n++){const s=t[n],o=t[i];s.y>e.y!=o.y>e.y&&e.x<(o.x-s.x)*(e.y-s.y)/(o.y-s.y)+s.x&&(r=!r);}return r}function sc(t,e,r,n,i){for(const s of t)if(e<=s.x&&r<=s.y&&n>=s.x&&i>=s.y)return !0;const s=[new bt(e,r),new bt(e,i),new bt(n,i),new bt(n,r)];if(t.length>2)for(const e of s)if(ic(t,e))return !0;for(let e=0;e<t.length-1;e++)if(oc(t[e],t[e+1],s))return !0;return !1}function oc(t,e,r){const n=r[0],i=r[2];if(t.x<n.x&&e.x<n.x||t.x>i.x&&e.x>i.x||t.y<n.y&&e.y<n.y||t.y>i.y&&e.y>i.y)return !1;const s=Ht(t,e,r[0]);return s!==Ht(t,e,r[1])||s!==Ht(t,e,r[2])||s!==Ht(t,e,r[3])}function ac(t,e,r,n,i,s){let o=e.y-t.y,a=t.x-e.x;if(s=s||0){const t=o*o+a*a;if(0===t)return !0;const e=Math.sqrt(t);o/=e,a/=e;}return !((r.x-t.x)*o+(r.y-t.y)*a-s<0||(n.x-t.x)*o+(n.y-t.y)*a-s<0||(i.x-t.x)*o+(i.y-t.y)*a-s<0)}function lc(t,e,r,n,i,s,o){return !(ac(t,e,n,i,s,o)||ac(e,r,n,i,s,o)||ac(r,t,n,i,s,o)||ac(n,i,t,e,r,o)||ac(i,s,t,e,r,o)||ac(s,n,t,e,r,o))}function uc(t,e,r){const n=e.paint.get(t).value;return "constant"===n.kind?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function cc(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function hc(t,e,r,n,i){if(!e[0]&&!e[1])return t;const s=bt.convert(e)._mult(i);"viewport"===r&&s._rotate(-n);const o=[];for(let e=0;e<t.length;e++)o.push(t[e].sub(s));return o}function pc(t,e,r,n){const i=bt.convert(t)._mult(n);return "viewport"===e&&i._rotate(-r),i}let dc,fc;function mc(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return [t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}qs(qu,"CircleBucket",{omit:["layers"]});class yc{constructor(t,e,r){this.z=t,this.x=e,this.y=r,this.key=vc(0,t,t,e,r);}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}isChildOf(t){const e=this.z-t.z;return 0===t.z||t.z<this.z&&t.x===this.x>>e&&t.y===this.y>>e}url(t,e){const r=function(t,e,r){var n=mc(256*t,256*(e=Math.pow(2,r)-e-1),r),i=mc(256*(t+1),256*(e+1),r);return n[0]+","+n[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),n=function(t,e,r){let n,i="";for(let s=t;s>0;s--)n=1<<s-1,i+=(e&n?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}toString(){return `${this.z}/${this.x}/${this.y}`}}class gc{constructor(t,e){this.wrap=t,this.canonical=e,this.key=vc(t,e.z,e.z,e.x,e.y);}}class xc{constructor(t,e,r,n,i){this.overscaledZ=t,this.wrap=e,this.canonical=new yc(r,+n,+i),this.key=0===e&&t===r?this.canonical.key:vc(e,t,r,n,i);}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new xc(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xc(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return vc(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-t;return vc(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(t){if(t.wrap!==this.wrap)return !1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return [new xc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return [new xc(e,this.wrap,e,r,n),new xc(e,this.wrap,e,r+1,n),new xc(e,this.wrap,e,r,n+1),new xc(e,this.wrap,e,r+1,n+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new xc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new xc(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gc(this.wrap,this.canonical)}toString(){return `${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function vc(t,e,r,n,i){const s=1<<Math.min(r,22);let o=s*(i%s)+n%s;return t&&r<22&&(o+=s*s*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*o+r)+(e-r)}const bc=[t=>{let e=t.canonical.x-1,r=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,r--),new xc(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,r=t.wrap;return e===1<<t.canonical.z&&(e=0,r++),new xc(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>new xc(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new xc(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];qs(yc,"CanonicalTileID"),qs(xc,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const wc=ea([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_c}=wc,Ac=ea([{name:"a_pos_3",components:3,type:"Int16"}]);var Mc=ea([{name:"a_pos",type:"Int16",components:2}]);function Ic(t){return t*Fl/Hl}const Sc=[new Nu([Nl,Nl,Nl],[jl,jl,jl]),new Nu([Nl,Nl,Nl],[0,0,jl]),new Nu([0,Nl,Nl],[jl,0,jl]),new Nu([Nl,0,Nl],[0,jl,jl]),new Nu([0,0,Nl],[jl,jl,jl])];function Pc(t,e,r,n=!0){const i=z([],t._camera.position,t.worldSize),s=[e,r,1,1];Y(s,s,t.pixelMatrixInverse),Z(s,s,1/s[3]);const o=F([],G([],s,i)),a=t.globeMatrix,l=[a[12],a[13],a[14]],u=G([],l,i),c=_(u),h=F([],u),p=t.worldSize/(2*Math.PI),d=D(h,o),f=Math.asin(p/c);if(f<Math.acos(d)){if(!n)return null;const t=[],e=[];z(t,o,c/d),F(e,G(e,t,u)),F(o,I(o,u,z(o,e,Math.tan(f)*c)));}const m=[];new Cu(i,o).closestPointOnSphere(l,p,m);const y=F([],Kt(a,0)),g=F([],Kt(a,1)),x=F([],Kt(a,2)),v=D(y,m),b=D(g,m),w=D(x,m),A=It(Math.asin(-b/p));let M=It(Math.atan2(v,w));M=t.center.lng+function(t,e){const r=(e-t+180)%360-180;return r<-180?r+360:r}(t.center.lng,M);const S=Jl(M),P=zt(Ql(A),0,1);return new uu(S,P)}class Ec{constructor(t,e,r){this.a=G([],t,r),this.b=G([],e,r),this.center=r;const n=F([],this.a),i=F([],this.b);this.angle=Math.acos(D(n,i));}}function kc(t,e){if(0===t.angle)return null;let r;return r=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:function(t,e,r,n){const i=Math.sin(r);return t*(Math.sin((1-n)*r)/i)+e*(Math.sin(n*r)/i)}(t.a[e],t.b[e],t.angle,zt(r,0,1))+t.center[e]}function zc(t){if(t.z<=1)return Sc[t.z+2*t.y+t.x];const e=Fc(Cc(t));return Nu.fromPoints(e)}function Tc(t,e,r){return z(t,t,1-r),T(t,t,e,r)}function Bc(t,e,r){for(const n of t)O(n,n,e),z(n,n,r);}function Vc(t,e,r,n){const i=e/t.worldSize,s=t.globeMatrix;if(r.z<=1){const t=zc(r).getCorners();return Bc(t,s,i),Nu.fromPoints(t)}const o=Cc(r,n),a=Fc(o,Fl+Ic(t._tileCoverLift));Bc(a,s,i);const l=Number.MAX_VALUE,u=[-l,-l,-l],c=[l,l,l];if(o.contains(t.center)){for(const t of a)E(c,c,t),k(u,u,t);u[2]=0;const e=t.point,r=[e.x*i,e.y*i,0];return E(c,c,r),k(u,u,r),new Nu(c,u)}if(t._tileCoverLift>0){for(const t of a)E(c,c,t),k(u,u,t);return new Nu(c,u)}const h=[s[12]*i,s[13]*i,s[14]*i],p=o.getCenter(),d=zt(t.center.lat,-iu,iu),f=zt(p.lat,-iu,iu),m=Jl(t.center.lng),y=Ql(d);let g=m-Jl(p.lng);const x=y-Ql(f);g>.5?g-=1:g<-.5&&(g+=1);let v=0;Math.abs(g)>Math.abs(x)?v=g>=0?1:3:(v=x>=0?0:2,T(h,h,[s[4]*i,s[5]*i,s[6]*i],-Math.sin(Mt(x>=0?o.getSouth():o.getNorth()))*Fl));const b=a[v],w=a[(v+1)%4],_=new Ec(b,w,h),A=[kc(_,0)||b[0],kc(_,1)||b[1],kc(_,2)||b[2]],M=Gc(t.zoom);if(M>0){const n=function({x:t,y:e,z:r},n,i,s,o){const a=1/(1<<r);let l=t*a,u=l+a,c=e*a,h=c+a,p=0;const d=(l+u)/2-s;return d>.5?p=-1:d<-.5&&(p=1),l=((l+p)*n-(s*=n))*i+s,u=((u+p)*n-s)*i+s,c=(c*n-(o*=n))*i+o,h=(h*n-o)*i+o,[[l,h,0],[u,h,0],[u,c,0],[l,c,0]]}(r,e,t._pixelsPerMercatorPixel,m,y);for(let t=0;t<a.length;t++)Tc(a[t],n[t],M);const i=I([],n[v],n[(v+1)%4]);z(i,i,.5),Tc(A,i,M);}for(const t of a)E(c,c,t),k(u,u,t);return c[2]=Math.min(b[2],w[2]),E(c,c,A),k(u,u,A),new Nu(c,u)}function Cc({x:t,y:e,z:r},n=!1){const i=1/(1<<r),s=new Xl(eu(t*i),e===(1<<r)-1&&n?-90:ru((e+1)*i)),o=new Xl(eu((t+1)*i),0===e&&n?90:ru(e*i));return new Zl(s,o)}function Fc(t,e=Fl){const r=Mt(t.getNorth()),n=Mt(t.getSouth()),i=Math.cos(r),s=Math.cos(n),o=Math.sin(r),a=Math.sin(n),l=t.getWest(),u=t.getEast();return [$l(s,a,l,e),$l(s,a,u,e),$l(i,o,u,e),$l(i,o,l,e)]}function Dc(t,e,r,n){const i=1<<r.z,s=(t/Cn+r.x)/i;return Gl(ru((e/Cn+r.y)/i),eu(s),n)}function Lc({min:t,max:e}){return Rl/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Rc=new Float64Array(16);function Oc(t){const e=Lc(t),r=y(Rc,[e,e,e]);return h(r,r,C([],t.min))}function Uc(t){const e=(n=t.min,(r=Rc)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r);var r,n;const i=1/Lc(t);return p(e,e,[i,i,i])}function Nc(t){const e=Cn/(2*Math.PI);return t/(2*Math.PI)/e}function jc(t,e){return Cn/(512*Math.pow(2,t))*Lc(zc(e))}function $c(t,e,r,n,i){const s=Nc(r),o=[t,e,-r/(2*Math.PI)],a=l(new Float64Array(16));return h(a,a,o),p(a,a,[s,s,s]),d(a,a,Mt(-i)),f(a,a,Mt(-n)),a}function Gc(t){return Tt(Dl,Ll,t)}function Hc(t,e){const r=Gl(e.lat,e.lng),n=function(t){const e=Gl(t._center.lat,t._center.lng);let r=L([],A(0,1,0),e);const n=g([],-t.angle,e);r=O(r,r,n),g(n,-t._pitch,r);const i=F([],e);return z(i,i,Ic(t.cameraToCenterDistance/t.pixelsPerMeter)),O(i,i,n),I([],e,i)}(t);return o=(i=S([],n,r))[0],a=i[1],l=i[2],u=(s=r)[0],c=s[1],h=s[2],d=(p=Math.sqrt(o*o+a*a+l*l)*Math.sqrt(u*u+c*c+h*h))&&D(i,s)/p,Math.acos(Math.min(Math.max(d,-1),1));var i,s,o,a,l,u,c,h,p,d;}function qc(t,e){return Hc(t,e)>Math.PI/2*1.01}const Xc=Mt(85),Zc=Math.cos(Xc),Wc=Math.sin(Xc),Yc=a(),Kc=t=>{const e=[];return "map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function Jc(t,e,r,n,i,s,o,a,l){if(s&&t.queryGeometry.isAboveHorizon)return !1;s&&(l*=t.pixelToTileUnitsFactor);const u=t.tileID.canonical,c=r.projection.upVectorScale(u,r.center.lat,r.worldSize).metersToTile;for(const h of e)for(const e of h){const h=e.add(a),p=i&&r.elevation?r.elevation.exaggeration()*i.getElevationAt(h.x,h.y,!0):0,d=r.projection.projectTilePoint(h.x,h.y,u);if(p>0){const t=r.projection.upVector(u,h.x,h.y);d.x+=t[0]*c*p,d.y+=t[1]*c*p,d.z+=t[2]*c*p;}const f=s?h:Qc(d.x,d.y,d.z,n),m=s?t.tilespaceRays.map((t=>rh(t,p))):t.queryGeometry.screenGeometry,y=Y([],[d.x,d.y,d.z,1],n);if(!o&&s?l*=y[3]/r.cameraToCenterDistance:o&&!s&&(l*=r.cameraToCenterDistance/y[3]),s){const t=ru((e.y/Cn+u.y)/(1<<u.z));l/=r.projection.pixelsPerMeter(t,1)/tu(1,t);}if(Zu(m,f,l))return !0}return !1}function Qc(t,e,r,n){const i=Y([],[t,e,r,1],n);return new bt(i[0]/i[3],i[1]/i[3])}const th=A(0,0,0),eh=A(0,0,1);function rh(t,e){const r=b();return th[2]=e,t.intersectsPlane(th,eh,r),new bt(r[0],r[1])}class nh extends qu{}let ih,sh,oh,ah;function lh(t,{width:e,height:r},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==e*r*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(e*r*n);return t.width=e,t.height=r,t.data=i,t}function uh(t,e,r){const{width:n,height:i}=e;n===t.width&&i===t.height||(ch(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,i)},r,null),t.width=n,t.height=i,t.data=e.data);}function ch(t,e,r,n,i,s,o,a){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const l=t.data,u=e.data,c=4===s&&a;for(let a=0;a<i.height;a++){const h=((r.y+a)*t.width+r.x)*s,p=((n.y+a)*e.width+n.x)*s;if(c)for(let t=0;t<i.width;t++){const e=h+t*s+3,r=p+t*s;u[r+0]=255,u[r+1]=255,u[r+2]=255,u[r+3]=l[e];}else if(o)for(let t=0;t<i.width;t++){const e=h+t*s,r=p+t*s,n=new sr(l[e+0]/255,l[e+1]/255,l[e+2]/255,l[e+3]).toNonPremultipliedRenderColor(o).toArray();u[r+0]=n[0],u[r+1]=n[1],u[r+2]=n[2],u[r+3]=n[3];}else for(let t=0;t<i.width*s;t++)u[p+t]=l[h+t];}return e}qs(nh,"HeatmapBucket",{omit:["layers"]});class hh{constructor(t,e){lh(this,t,1,e);}resize(t){uh(this,new hh(t),1);}clone(){return new hh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,r,n,i){ch(t,e,r,n,i,1,null);}}class ph{constructor(t,e){lh(this,t,4,e);}resize(t){uh(this,new ph(t),4);}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t;}clone(){return new ph({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,r,n,i,s,o){ch(t,e,r,n,i,4,s,o);}}class dh{constructor(t,e){this.width=t.width,this.height=t.height,this.data=e instanceof Uint8Array?new Float32Array(e.buffer):e;}}function fh(t){const e={},r=t.resolution||256,n=t.clips?t.clips.length:1,i=t.image||new ph({width:r,height:n}),s=(r,n,s)=>{e[t.evaluationKey]=s;const o=t.expression.evaluate(e),a=o?o.toNonPremultipliedRenderColor(null):null;a&&(i.data[r+n+0]=Math.floor(255*a.r),i.data[r+n+1]=Math.floor(255*a.g),i.data[r+n+2]=Math.floor(255*a.b),i.data[r+n+3]=Math.floor(255*a.a));};if(t.clips)for(let e=0,i=0;e<n;++e,i+=4*r)for(let n=0,o=0;n<r;n++,o+=4){const a=n/(r-1),{start:l,end:u}=t.clips[e];s(i,o,l*(1-a)+u*a);}else for(let t=0,e=0;t<r;t++,e+=4)s(0,e,t/(r-1));return i}qs(hh,"AlphaImage"),qs(ph,"RGBAImage");const mh=ea([{name:"a_pos",components:2,type:"Int16"}],4),yh=ea([{name:"a_road_z_offset",components:1,type:"Float32"}],4),gh=ea([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),xh=ea([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function vh(t,e,r=2){const n=e&&e.length,i=n?e[0]*r:t.length;let s=bh(t,0,i,r,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,u;if(n&&(s=function(t,e,r,n){const i=[];for(let r=0,s=e.length;r<s;r++){const o=bh(t,e[r]*n,r<s-1?e[r+1]*n:t.length,n,!1);o===o.next&&(o.steiner=!0),i.push(Th(o));}i.sort(Ph);for(let t=0;t<i.length;t++)r=Eh(i[t],r);return r}(t,e,s,r)),t.length>80*r){a=t[0],l=t[1];let e=a,n=l;for(let s=r;s<i;s+=r){const r=t[s],i=t[s+1];r<a&&(a=r),i<l&&(l=i),r>e&&(e=r),i>n&&(n=i);}u=Math.max(e-a,n-l),u=0!==u?32767/u:0;}return _h(s,o,r,a,l,u,0),o}function bh(t,e,r,n,i){let s;if(i===function(t,e,r,n){let i=0;for(let s=e,o=r-n;s<r;s+=n)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}(t,e,r,n)>0)for(let i=e;i<r;i+=n)s=jh(i/n|0,t[i],t[i+1],s);else for(let i=r-n;i>=e;i-=n)s=jh(i/n|0,t[i],t[i+1],s);return s&&Dh(s,s.next)&&($h(s),s=s.next),s}function wh(t,e){if(!t)return t;e||(e=t);let r,n=t;do{if(r=!1,n.steiner||!Dh(n,n.next)&&0!==Fh(n.prev,n,n.next))n=n.next;else {if($h(n),n=e=n.prev,n===n.next)break;r=!0;}}while(r||n!==e);return e}function _h(t,e,r,n,i,s,o){if(!t)return;!o&&s&&function(t,e,r,n){let i=t;do{0===i.z&&(i.z=zh(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){let e,r=1;do{let n,i=t;t=null;let s=null;for(e=0;i;){e++;let o=i,a=0;for(let t=0;t<r&&(a++,o=o.nextZ,o);t++);let l=r;for(;a>0||l>0&&o;)0!==a&&(0===l||!o||i.z<=o.z)?(n=i,i=i.nextZ,a--):(n=o,o=o.nextZ,l--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=o;}s.nextZ=null,r*=2;}while(e>1)}(i);}(t,n,i,s);let a=t;for(;t.prev!==t.next;){const l=t.prev,u=t.next;if(s?Mh(t,n,i,s):Ah(t))e.push(l.i,t.i,u.i),$h(t),t=u.next,a=u.next;else if((t=u)===a){o?1===o?_h(t=Ih(wh(t),e),e,r,n,i,s,2):2===o&&Sh(t,e,r,n,i,s):_h(wh(t),e,r,n,i,s,1);break}}}function Ah(t){const e=t.prev,r=t,n=t.next;if(Fh(e,r,n)>=0)return !1;const i=e.x,s=r.x,o=n.x,a=e.y,l=r.y,u=n.y,c=Math.min(i,s,o),h=Math.min(a,l,u),p=Math.max(i,s,o),d=Math.max(a,l,u);let f=n.next;for(;f!==e;){if(f.x>=c&&f.x<=p&&f.y>=h&&f.y<=d&&Vh(i,a,s,l,o,u,f.x,f.y)&&Fh(f.prev,f,f.next)>=0)return !1;f=f.next;}return !0}function Mh(t,e,r,n){const i=t.prev,s=t,o=t.next;if(Fh(i,s,o)>=0)return !1;const a=i.x,l=s.x,u=o.x,c=i.y,h=s.y,p=o.y,d=Math.min(a,l,u),f=Math.min(c,h,p),m=Math.max(a,l,u),y=Math.max(c,h,p),g=zh(d,f,e,r,n),x=zh(m,y,e,r,n);let v=t.prevZ,b=t.nextZ;for(;v&&v.z>=g&&b&&b.z<=x;){if(v.x>=d&&v.x<=m&&v.y>=f&&v.y<=y&&v!==i&&v!==o&&Vh(a,c,l,h,u,p,v.x,v.y)&&Fh(v.prev,v,v.next)>=0)return !1;if(v=v.prevZ,b.x>=d&&b.x<=m&&b.y>=f&&b.y<=y&&b!==i&&b!==o&&Vh(a,c,l,h,u,p,b.x,b.y)&&Fh(b.prev,b,b.next)>=0)return !1;b=b.nextZ;}for(;v&&v.z>=g;){if(v.x>=d&&v.x<=m&&v.y>=f&&v.y<=y&&v!==i&&v!==o&&Vh(a,c,l,h,u,p,v.x,v.y)&&Fh(v.prev,v,v.next)>=0)return !1;v=v.prevZ;}for(;b&&b.z<=x;){if(b.x>=d&&b.x<=m&&b.y>=f&&b.y<=y&&b!==i&&b!==o&&Vh(a,c,l,h,u,p,b.x,b.y)&&Fh(b.prev,b,b.next)>=0)return !1;b=b.nextZ;}return !0}function Ih(t,e){let r=t;do{const n=r.prev,i=r.next.next;!Dh(n,i)&&Lh(n,r,r.next,i)&&Uh(n,i)&&Uh(i,n)&&(e.push(n.i,r.i,i.i),$h(r),$h(r.next),r=t=i),r=r.next;}while(r!==t);return wh(r)}function Sh(t,e,r,n,i,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Ch(o,t)){let a=Nh(o,t);return o=wh(o,o.next),a=wh(a,a.next),_h(o,e,r,n,i,s,0),void _h(a,e,r,n,i,s,0)}t=t.next;}o=o.next;}while(o!==t)}function Ph(t,e){let r=t.x-e.x;return 0===r&&(r=t.y-e.y,0===r)&&(r=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function Eh(t,e){const r=function(t,e){let r=e;const n=t.x,i=t.y;let s,o=-1/0;if(Dh(t,r))return r;do{if(Dh(t,r.next))return r.next;if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const t=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=n&&t>o&&(o=t,s=r.x<r.next.x?r:r.next,t===n))return s}r=r.next;}while(r!==e);if(!s)return null;const a=s,l=s.x,u=s.y;let c=1/0;r=s;do{if(n>=r.x&&r.x>=l&&n!==r.x&&Bh(i<u?n:o,i,l,u,i<u?o:n,i,r.x,r.y)){const e=Math.abs(i-r.y)/(n-r.x);Uh(r,t)&&(e<c||e===c&&(r.x>s.x||r.x===s.x&&kh(s,r)))&&(s=r,c=e);}r=r.next;}while(r!==a);return s}(t,e);if(!r)return e;const n=Nh(r,t);return wh(n,n.next),wh(r,r.next)}function kh(t,e){return Fh(t.prev,t,e.prev)<0&&Fh(e.next,t,t.next)<0}function zh(t,e,r,n,i){return (t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Th(t){let e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;}while(e!==t);return r}function Bh(t,e,r,n,i,s,o,a){return (i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(n-a)>=(r-o)*(e-a)&&(r-o)*(s-a)>=(i-o)*(n-a)}function Vh(t,e,r,n,i,s,o,a){return !(t===o&&e===a)&&Bh(t,e,r,n,i,s,o,a)}function Ch(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Lh(r,r.next,t,e))return !0;r=r.next;}while(r!==t);return !1}(t,e)&&(Uh(t,e)&&Uh(e,t)&&function(t,e){let r=t,n=!1;const i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;}while(r!==t);return n}(t,e)&&(Fh(t.prev,t,e.prev)||Fh(t,e.prev,e))||Dh(t,e)&&Fh(t.prev,t,t.next)>0&&Fh(e.prev,e,e.next)>0)}function Fh(t,e,r){return (e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Dh(t,e){return t.x===e.x&&t.y===e.y}function Lh(t,e,r,n){const i=Oh(Fh(t,e,r)),s=Oh(Fh(t,e,n)),o=Oh(Fh(r,n,t)),a=Oh(Fh(r,n,e));return i!==s&&o!==a||!(0!==i||!Rh(t,r,e))||!(0!==s||!Rh(t,n,e))||!(0!==o||!Rh(r,t,n))||!(0!==a||!Rh(r,e,n))}function Rh(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Oh(t){return t>0?1:t<0?-1:0}function Uh(t,e){return Fh(t.prev,t,t.next)<0?Fh(t,e,t.next)>=0&&Fh(t,t.prev,e)>=0:Fh(t,e,t.prev)<0||Fh(t,t.next,e)<0}function Nh(t,e){const r=Gh(t.i,t.x,t.y),n=Gh(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function jh(t,e,r,n){const i=Gh(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function $h(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function Gh(t,e,r){return {i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Hh(t,e){const r=t.length;if(r<=1)return [t];const n=[];let i,s;for(let e=0;e<r;e++){const r=qt(t[e]);0!==r&&(t[e].area=Math.abs(r),void 0===s&&(s=r<0),s===r<0?(i&&n.push(i),i=[t[e]]):i.push(t[e]));}if(i&&n.push(i),e>1)for(let t=0;t<n.length;t++)n[t].length<=e||(en(n[t],e,1,n[t].length-1,qh),n[t]=n[t].slice(0,e));return n}function qh(t,e){return e.area-t.area}function Xh(t,e,r=1){if(!t)return null;const n="string"==typeof t?Dr.from(t).getPrimary():t.getPrimary(),i="string"==typeof t?null:t.getSecondary();for(const t of [n,i]){if(!t)continue;const n=t.id.toString();e.has(n)||e.set(n,[]),t.scaleSelf(r),e.get(n).push(t);}return {primary:n.toString(),secondary:i?i.toString():null}}function Zh(t,e,r,n){const i=n.patternDependencies;let s=!1;for(const n of e){const e=n.paint.get(`${t}-pattern`);e.isConstant()||(s=!0),Xh(e.constantOr(null),i,r)&&(s=!0);}return s}function Wh(t,e,r,n,i,s){const o=s.patternDependencies;for(const a of e){const e=a.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:n},r,{},s.availableImages);t=t&&t.name?t.name:t;const l=Xh(t,o,i);if(!l)continue;const{primary:u,secondary:c}=l;u&&(r.patterns[a.id]=[u,c].filter(Boolean));}}return r}class Yh{constructor(){this.polygons=new Map;}add(t,...e){this.polygons.has(t)?this.polygons.get(t).push(...e):this.polygons.set(t,e);}merge(t){for(const[e,r]of t.polygons)this.add(e,...r);}}class Kh{constructor(){this.portals=[];}static evaluate(t){if(0===t.length)return new Kh;let e=[];for(const r of t)e.push(...r.portals);if(0===e.length)return new Kh;const r=(t,e)=>t<=0&&e<=0||t>=Cn&&e>=Cn;for(const t of e){const e=t.va,n=t.vb;(r(e.x,n.x)||r(e.y,n.y))&&(t.type="border");}const n=e.filter((t=>"unevaluated"!==t.type)),i=e.filter((t=>"unevaluated"===t.type));if(0===i.length)return new Kh;i.sort(((t,e)=>t.hash===e.hash?t.isTunnel===e.isTunnel?0:t.isTunnel?-1:1:t.hash<e.hash?1:-1)),e=n.concat(i);let s=n.length,o=s,a=s;do{if(o++,o===e.length||e[s].hash!==e[o].hash){if(o-s==2){a<s&&(e[a]=e[s],e[s]=null);const t=e[a],r=e[o-1];t.type=t.isTunnel!==r.isTunnel?"tunnel":"polygon",t.connection={a:t.connection.a,b:r.connection.a},a++;}s=o;}}while(s!==e.length);return e.splice(a),e.sort(((t,e)=>t.hash<e.hash?1:-1)),{portals:e}}}qs(Kh,"ElevationPortalGraph"),qs(Yh,"ElevationPolygons");class Jh{constructor(t,e,r){this.outPositions=t,this.outNormals=e,this.outIndices=r,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer);}addVertex(t,e,r){let n=t[2];null!=r&&(n*=r);const i=this.getVec3Bits(t)<<96n|this.getVec3Bits(e),s=this.vertexLookup.get(i);if(null!=s)return s;const o=this.outPositions.length;this.vertexLookup.set(i,o);const a=Math.trunc(16384*e[0]),l=Math.trunc(16384*e[1]),u=Math.trunc(16384*e[2]);return this.outPositions.emplaceBack(t[0],t[1],n),this.outNormals.emplaceBack(a,l,u),o}addTriangle(t,e,r){this.outIndices.emplaceBack(t,e,r);}addTriangles(t,e,r){if(0===t.length)return;const n=1===r.length,i=b(),s=b();for(let o=0;o<t.length;o+=3){const a=e[t[o+0]],l=e[t[o+1]],u=e[t[o+2]],c=n?r[0]:r[t[o+1]],h=n?r[0]:r[t[o+2]];M(i,a.x,a.y,n?r[0]:r[t[o+0]]);const p=this.addVertex(i,s);M(i,l.x,l.y,c);const d=this.addVertex(i,s);M(i,u.x,u.y,h);const f=this.addVertex(i,s);this.outIndices.emplaceBack(p,d,f);}}addQuad(t,e,r,n,i,s){const o=this.addVertex(t,i,s),a=this.addVertex(e,i,s),l=this.addVertex(r,i,s),u=this.addVertex(n,i,s);this.addTriangle(o,a,l),this.addTriangle(l,u,o);}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear();}getBits(t){return this.view.setFloat32(0,t),BigInt(this.view.getUint32(0))}getVec3Bits(t){return this.getBits(t[0])<<64n|this.getBits(t[1])<<32n|this.getBits(t[2])}}class Qh{constructor(t,e,r,n){this.unevaluatedPortals=new Kh,this.portalPolygons=new Yh,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new aa,this.vertexNormals=new la,this.indexArray=new Ma,this.tileToMeters=lu(t),this.bridgeProgramConfigurations=new kl(e,{zoom:r,lut:n},(t=>"fill-tunnel-structure-color"!==t)),this.tunnelProgramConfigurations=new kl(e,{zoom:r,lut:n},(t=>"fill-bridge-guard-rail-color"!==t));}addVertices(t,e){const r=this.unevalVertices.length;for(let r=0;r<t.length;r++)this.unevalVertices.push(t[r]),this.unevalHeights.push(e[r]);return r}addTriangles(t,e,r){const n=r?this.unevalTunnelTriangles:this.unevalTriangles;for(const r of t)n.push(r+e);}addRenderableRing(t,e,r,n,i,s){const o=[new bt(i.min.x,i.min.y),new bt(i.max.x,i.min.y),new bt(i.max.x,i.max.y),new bt(i.min.x,i.max.y)];for(let a=0;a<r-1;a++){const r=e+a,l=r+1,u=this.unevalVertices[r],c=this.unevalVertices[l];if(!(u.x>=i.min.x&&u.x<=i.max.x&&u.y>=i.min.y&&u.y<=i.max.y||c.x>=i.min.x&&c.x<=i.max.x&&c.y>=i.min.y&&c.y<=i.max.y||oc(u,c,o)))continue;if(this.isOnBorder(u.x,c.x)||this.isOnBorder(u.y,c.y))continue;const h=Qh.computeEdgeHash(this.unevalVertices[r],this.unevalVertices[l]);let p,d=this.vertexHashLookup.get(Qh.computePosHash(u));null!=d?p=d.next:(d=this.vertexHashLookup.get(Qh.computePosHash(c)),p=null!=d?d.prev:h),this.unevalEdges.push({polygonIdx:t,a:r,b:l,hash:h,portalHash:p,isTunnel:n,type:"unevaluated",featureInfo:s});}}addPortalCandidates(t,e,r,n,i){if(0===e.length)return;this.portalPolygons.add(t,{geometry:e,zLevel:i});const s=e[0];this.vertexHashLookup.clear();let o=Qh.computeEdgeHash(s[s.length-2],s[s.length-1]);for(let e=0;e<s.length-1;e++){const i=s[e+0],a=s[e+1],l=at(a.x-i.x,a.y-i.y),u=ht(l);if(0===u)continue;let c="unevaluated";const h=n.pointElevation(i),p=n.pointElevation(a);Math.abs(h)<.01&&Math.abs(p)<.01?c="entrance":(this.isOnBorder(i.x,a.x)||this.isOnBorder(i.y,a.y))&&(c="border");const d=Qh.computeEdgeHash(i,a);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:i,vb:a,vab:l,length:u,hash:d,isTunnel:r,type:c});const f=Qh.computePosHash(i);this.vertexHashLookup.set(f,{prev:o,next:d}),o=d;}}construct(t){if(0===this.unevalVertices.length)return;const e=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),r=t=>{t.primitiveLength=this.indexArray.length-t.primitiveOffset;},n=new Jh(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);const i=e(),s=e(),o=e(),a=(t,e)=>{t.sort(((t,r)=>t.type===e&&r.type!==e?-1:t.type!==e&&r.type===e?1:0));const r=t.findIndex((t=>t.type!==e));return r>=0?r:t.length};let l=0;this.unevalEdges.length>0&&(l=a(this.unevalEdges,"none"),this.constructBridgeStructures(n,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},this.tileToMeters)),r(o);const u=e(),c=e();if(this.unevalEdges.length>0){const t=this.unevalEdges.splice(l),e=a(t,"tunnel")+l;this.unevalEdges.push(...t),this.constructTunnelStructures(n,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},{min:l,max:e});}r(u),n.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),r(c),n.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),r(s),n.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),r(i),this.maskSegments=el.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength),this.depthSegments=el.simpleSegment(0,s.primitiveOffset,0,s.primitiveLength),this.renderableBridgeSegments=el.simpleSegment(0,o.primitiveOffset,0,o.primitiveLength),this.renderableTunnelSegments=el.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength),this.shadowCasterSegments=el.simpleSegment(0,i.primitiveOffset,0,i.primitiveLength);}update(t,e,r,n,i,s,o,a){this.bridgeProgramConfigurations.updatePaintArrays(t,e,i,r,n,s,o,a),this.tunnelProgramConfigurations.updatePaintArrays(t,e,i,r,n,s,o,a);}upload(t){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,gh.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,xh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(t),this.tunnelProgramConfigurations.upload(t));}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy();}populatePaintArrays(t,e,r,n,i){const s=(s,o)=>{for(let a=0;a<o.length-1;a++){const l=o[a].featureIndex,u=o[a+1].vertexStart,c=t.feature(l);s.populatePaintArrays(u,c,l,{},r,e,n,void 0,i);}};s(this.bridgeProgramConfigurations,this.bridgeFeatureSections),s(this.tunnelProgramConfigurations,this.tunnelFeatureSections);}computeVertexConnections(t,e,r,n,i){const s=new Map;for(let o=n;o<i;o++){const n=r[o],i=n.a,a=n.b,l=Qh.computePosHash(t[i]),u=Qh.computePosHash(t[a]);let c=s.get(l);c||(c={},s.set(l,c));let h=s.get(u);h||(h={},s.set(u,h)),e[i]<=0&&e[a]<=0||(c.to=a,h.from=i);}return s}isTerminalVertex(t,e){const r=Qh.computePosHash(this.unevalVertices[t]),n=e.get(r);return !n||!n.from||!n.to}constructBridgeStructures(t,e,r,n,i,s){t.clearVertexLookup();const o=this.computeVertexConnections(e,r,n,i.min,i.max),a=1/s,l=.5*a,u=(t,n)=>M(t,e[n].x,e[n].y,r[n]*a),c=b(),h=b(),p=b(),d=b(),f=b(),m=(t,r)=>{const n=o.get(Qh.computePosHash(e[r])),i=n.from,s=n.to;if(!i||!s)return;u(c,i),u(h,r),u(p,s),j(d),$(c,h)||(G(f,h,c),F(d,f)),$(p,h)||(G(f,p,h),I(d,d,F(f,f)));const a=q(d);return a>0?z(t,d,1/a):void 0};let y=Number.POSITIVE_INFINITY;this.sortSubarray(n,i.min,i.max,((t,e)=>t.featureInfo.featureIndex-e.featureInfo.featureIndex));const g=b(),x=b(),v=b(),w=b(),_=b(),A=b(),S=b(),P=b(),E=b(),k=[b(),b(),b(),b()],T=[b(),b(),b(),b()],B=[{coord:new bt(0,0),height:0},{coord:new bt(0,0),height:0}],V=(t,e)=>t>e;for(let u=i.min;u<i.max;u++){const i=n[u];if(!i.featureInfo.guardRailEnabled)continue;if(!this.prepareEdgePoints(B,e,r,i,V))continue;const[c,h]=B;if(M(g,c.coord.x,c.coord.y,a*c.height),M(x,h.coord.x,h.coord.y,a*h.height),$(g,x))continue;G(v,x,g),F(v,v);const p=m(P,i.a)||v,d=m(E,i.b)||v;M(w,p[1],-p[0],0),F(w,w),M(_,d[1],-d[0],0),F(_,_),L(P,w,p),F(A,P),L(P,_,d),F(S,P),I(k[0],g,z(P,G(P,w,A),l)),I(k[1],g,z(P,I(P,w,A),l)),I(k[2],g,z(P,A,l)),k[3]=g,I(T[0],x,z(P,G(P,_,S),l)),I(T[1],x,z(P,I(P,_,S),l)),I(T[2],x,z(P,S,l)),T[3]=x,y=this.addFeatureSection(i.featureInfo.featureIndex,y,this.bridgeFeatureSections,t);const f=t.addVertex(k[0],w,s),b=t.addVertex(k[1],w,s),D=t.addVertex(T[0],_,s),R=t.addVertex(T[1],_,s);t.addTriangle(f,b,D),t.addTriangle(b,R,D);const O=t.addVertex(k[1],A,s),U=t.addVertex(k[2],A,s),N=t.addVertex(T[1],S,s),j=t.addVertex(T[2],S,s);t.addTriangle(O,U,N),t.addTriangle(U,j,N),C(w,w),C(_,_);const H=t.addVertex(k[2],w,s),q=t.addVertex(k[3],w,s),X=t.addVertex(T[2],_,s),Z=t.addVertex(T[3],_,s);t.addTriangle(H,q,X),t.addTriangle(q,Z,X);const W=this.isTerminalVertex(i.a,o),Y=this.isTerminalVertex(i.b,o);c.height<.01&&W&&t.addQuad(k[3],k[2],k[1],k[0],C(p,p),s),h.height<.01&&Y&&t.addQuad(T[0],T[1],T[2],T[3],d,s);}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()});}constructTunnelStructures(t,e,r,n,i,s){t.clearVertexLookup();let o=Number.POSITIVE_INFINITY;const a=(t,e)=>t.featureInfo.featureIndex-e.featureInfo.featureIndex;this.sortSubarray(n,i.min,i.max,a),this.sortSubarray(n,s.min,s.max,a);const l=t=>F(t,t),u=[{coord:new bt(0,0),height:0},{coord:new bt(0,0),height:0}],c=(t,e)=>t<e,h=b(),p=b(),d=b(),f=b(),m=b();for(let s=i.min;s<i.max;s++){if(!this.prepareEdgePoints(u,e,r,n[s],c))continue;const[i,a]=u,y=l(M(m,-(a.coord.y-i.coord.y),a.coord.x-i.coord.x,0));o=this.addFeatureSection(n[s].featureInfo.featureIndex,o,this.tunnelFeatureSections,t),t.addQuad(M(h,i.coord.x,i.coord.y,i.height),M(p,a.coord.x,a.coord.y,a.height),M(d,a.coord.x,a.coord.y,n[s].isTunnel?-.1:0),M(f,i.coord.x,i.coord.y,n[s].isTunnel?-.1:0),y);}for(let i=s.min;i<s.max;i++){const s=n[i];s.isTunnel&&([s.a,s.b]=[s.b,s.a]);const a=e[s.a],u=e[s.b],c=l(M(m,-(u.y-a.y),u.x-a.x,0));o=this.addFeatureSection(s.featureInfo.featureIndex,o,this.tunnelFeatureSections,t),t.addQuad(M(h,u.x,u.y,0),M(p,a.x,a.y,0),M(d,a.x,a.y,r[s.a]+4),M(f,u.x,u.y,r[s.b]+4),c),t.addQuad(M(h,a.x,a.y,0),M(p,u.x,u.y,0),M(d,u.x,u.y,r[s.b]+4),M(f,a.x,a.y,r[s.a]+4),c);}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()});}setElevatedPoint(t,e,r,n){t.coord.x=e,t.coord.y=r,t.height=n;}prepareEdgePoints(t,e,r,n,i){let s=e[n.a].x,o=e[n.a].y,a=e[n.b].x,l=e[n.b].y,u=r[n.a],c=r[n.b];const h=i(u,0),p=i(c,0);if(h&&p)return this.setElevatedPoint(t[0],s,o,u),this.setElevatedPoint(t[1],a,l,c),!0;if(!h&&!p)return !1;if(h){if(!p){const t=c/(c-u);a=ur(a,s,t),l=ur(l,o,t),c=ur(c,u,t);}}else {const t=u/(u-c);s=ur(s,a,t),o=ur(o,l,t),u=ur(u,c,t);}return this.setElevatedPoint(t[0],s,o,u),this.setElevatedPoint(t[1],a,l,c),!0}prepareEdges(t,e){if(0===e.length)return;e.sort(((t,e)=>t.hash===e.hash?e.polygonIdx-t.polygonIdx:e.hash>t.hash?1:-1));let r=0,n=0,i=0,s=e[r].polygonIdx;do{n++,(n===e.length||e[r].hash!==e[n].hash)&&((1==n-r||e[n-1].polygonIdx!==s)&&(i<r&&(e[i]=e[r],e[r]=null),e[i].type="none",i++),r=n,r!==e.length&&(s=e[r].polygonIdx));}while(r!==e.length);if(e.splice(i),0!==e.length&&0!==t.length){e.sort(((t,e)=>t.portalHash<e.portalHash?1:-1));let r=0,n=0;for(;r!==e.length&&n!==t.length;){const i=e[r],s=t[n];i.portalHash>s.hash?r++:s.hash>i.portalHash?n++:(i.type=s.type,r++);}}}isOnBorder(t,e){return t<=0&&e<=0||t>=Cn&&e>=Cn}addFeatureSection(t,e,r,n){return t!==e&&(e=t,r.push({featureIndex:t,vertexStart:n.getVertexCount()}),n.clearVertexLookup()),e}sortSubarray(t,e,r,n){const i=t.slice(e,r);i.sort(n),t.splice(e,i.length,...i);}static computeEdgeHash(t,e){return (t.y===e.y&&t.x>e.x||t.y>e.y)&&([t,e]=[e,t]),BigInt(Qh.computePosHash(t))<<32n|BigInt(Qh.computePosHash(e))}static computePosHash(t){return ((65535&t.x)<<16|65535&t.y)>>>0}}var tp,ep={exports:{}},rp=(tp||(tp=1,function(t,e){!function(t){function e(t,e){return t>e?1:t<e?-1:0}var r=function(t,r){void 0===t&&(t=e),void 0===r&&(r=!1),this._compare=t,this._root=null,this._size=0,this._noDuplicates=!!r;},n={size:{configurable:!0}};function i(t,e,r,n,s){var o=s-n;if(o>0){var a=n+Math.floor(o/2),l={key:e[a],data:r[a],parent:t};return l.left=i(l,e,r,n,a),l.right=i(l,e,r,a+1,s),l}return null}function s(t,e,r,n,i){if(!(r>=n)){for(var o=t[r+n>>1],a=r-1,l=n+1;;){do{a++;}while(i(t[a],o)<0);do{l--;}while(i(t[l],o)>0);if(a>=l)break;var u=t[a];t[a]=t[l],t[l]=u,u=e[a],e[a]=e[l],e[l]=u;}s(t,e,r,l,i),s(t,e,l+1,n,i);}}r.prototype.rotateLeft=function(t){var e=t.right;e&&(t.right=e.left,e.left&&(e.left.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.left=t),t.parent=e;},r.prototype.rotateRight=function(t){var e=t.left;e&&(t.left=e.right,e.right&&(e.right.parent=t),e.parent=t.parent),t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.right=t),t.parent=e;},r.prototype._splay=function(t){for(;t.parent;){var e=t.parent;e.parent?e.left===t&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===t&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===t&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===t?this.rotateRight(e):this.rotateLeft(e);}},r.prototype.splay=function(t){for(var e,r,n,i,s;t.parent;)(r=(e=t.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=t:n.right=t,t.parent=n):(t.parent=null,this._root=t),i=t.left,s=t.right,t===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,e.right=r,r.parent=e):(i?(r.right=i,i.parent=r):r.right=null,t.left=r,r.parent=t)),s?(e.left=s,s.parent=e):e.left=null,t.right=e,e.parent=t):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,e.left=r,r.parent=e):(s?(r.left=s,s.parent=r):r.left=null,t.right=r,r.parent=t)),i?(e.right=i,i.parent=e):e.right=null,t.left=e,e.parent=t);},r.prototype.replace=function(t,e){t.parent?t===t.parent.left?t.parent.left=e:t.parent.right=e:this._root=e,e&&(e.parent=t.parent);},r.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},r.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},r.prototype.insert=function(t,e){var r=this._root,n=null,i=this._compare;if(this._noDuplicates)for(;r;){if(n=r,0===i(r.key,t))return;r=i(r.key,t)<0?r.right:r.left;}else for(;r;)n=r,r=i(r.key,t)<0?r.right:r.left;return r={key:t,data:e,left:null,right:null,parent:n},n?i(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r},r.prototype.find=function(t){for(var e=this._root,r=this._compare;e;){var n=r(e.key,t);if(n<0)e=e.right;else {if(!(n>0))return e;e=e.left;}}return null},r.prototype.contains=function(t){for(var e=this._root,r=this._compare;e;){var n=r(t,e.key);if(0===n)return !0;e=n<0?e.left:e.right;}return !1},r.prototype.remove=function(t){var e=this.find(t);if(!e)return !1;if(this.splay(e),e.left)if(e.right){var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r;}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},r.prototype.removeNode=function(t){if(!t)return !1;if(this.splay(t),t.left)if(t.right){var e=this.minNode(t.right);e.parent!==t&&(this.replace(e,e.right),e.right=t.right,e.right.parent=e),this.replace(t,e),e.left=t.left,e.left.parent=e;}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},r.prototype.erase=function(t){var e=this.find(t);if(e){this.splay(e);var r=e.left,n=e.right,i=null;r&&(r.parent=null,i=this.maxNode(r),this.splay(i),this._root=i),n&&(r?i.right=n:this._root=n,n.parent=i),this._size--;}},r.prototype.pop=function(){var t=this._root,e=null;if(t){for(;t.left;)t=t.left;e={key:t.key,data:t.data},this.remove(t.key);}return e},r.prototype.next=function(t){var e=t;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=t.parent;e&&e.right===t;)t=e,e=e.parent;return e},r.prototype.prev=function(t){var e=t;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=t.parent;e&&e.left===t;)t=e,e=e.parent;return e},r.prototype.forEach=function(t){for(var e=this._root,r=[],n=!1,i=0;!n;)e?(r.push(e),e=e.left):r.length>0?(t(e=r.pop(),i++),e=e.right):n=!0;return this},r.prototype.range=function(t,e,r,n){for(var i=[],s=this._compare,o=this._root;0!==i.length||o;)if(o)i.push(o),o=o.left;else {if(s((o=i.pop()).key,e)>0)break;if(s(o.key,t)>=0&&r.call(n,o))return this;o=o.right;}return this},r.prototype.keys=function(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),r.push(t.key),t=t.right):n=!0;return r},r.prototype.values=function(){for(var t=this._root,e=[],r=[],n=!1;!n;)t?(e.push(t),t=t.left):e.length>0?(t=e.pop(),r.push(t.data),t=t.right):n=!0;return r},r.prototype.at=function(t){for(var e=this._root,r=[],n=!1,i=0;!n;)if(e)r.push(e),e=e.left;else if(r.length>0){if(e=r.pop(),i===t)return e;i++,e=e.right;}else n=!0;return null},r.prototype.load=function(t,e,r){if(void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===r&&(r=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var n=t.length;return r&&s(t,e,0,n-1,this._compare),this._root=i(null,t,e,0,n),this._size=n,this},r.prototype.min=function(){var t=this.minNode(this._root);return t?t.key:null},r.prototype.max=function(){var t=this.maxNode(this._root);return t?t.key:null},r.prototype.isEmpty=function(){return null===this._root},n.size.get=function(){return this._size},r.createTree=function(t,e,n,i,s){return new r(n,s).load(t,e,i)},Object.defineProperties(r.prototype,n);var o=0,a=1,l=2,u=3,c=0,h=1,p=2,d=3;function f(t,e,r){null===e?(t.inOut=!1,t.otherInOut=!0):(t.isSubject===e.isSubject?(t.inOut=!e.inOut,t.otherInOut=e.otherInOut):(t.inOut=!e.otherInOut,t.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(t.prevInResult=!m(e,r)||e.isVertical()?e.prevInResult:e));var n=m(t,r);t.resultTransition=n?function(t,e){var r,n=!t.inOut,i=!t.otherInOut;switch(e){case c:r=n&&i;break;case h:r=n||i;break;case d:r=n^i;break;case p:r=t.isSubject?n&&!i:i&&!n;}return r?1:-1}(t,r):0;}function m(t,e){switch(t.type){case o:switch(e){case c:return !t.otherInOut;case h:return t.otherInOut;case p:return t.isSubject&&t.otherInOut||!t.isSubject&&!t.otherInOut;case d:return !0}break;case l:return e===c||e===h;case u:return e===p;case a:return !1}return !1}var y=function(t,e,r,n,i){this.left=e,this.point=t,this.otherEvent=r,this.isSubject=n,this.type=i||o,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0;},g={inResult:{configurable:!0}};function x(t,e){return t[0]===e[0]&&t[1]===e[1]}y.prototype.isBelow=function(t){var e=this.point,r=this.otherEvent.point;return this.left?(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])>0:(r[0]-t[0])*(e[1]-t[1])-(e[0]-t[0])*(r[1]-t[1])>0},y.prototype.isAbove=function(t){return !this.isBelow(t)},y.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},g.inResult.get=function(){return 0!==this.resultTransition},y.prototype.clone=function(){var t=new y(this.point,this.left,this.otherEvent,this.isSubject,this.type);return t.contourId=this.contourId,t.resultTransition=this.resultTransition,t.prevInResult=this.prevInResult,t.isExteriorRing=this.isExteriorRing,t.inOut=this.inOut,t.otherInOut=this.otherInOut,t},Object.defineProperties(y.prototype,g);var v=11102230246251565e-32,b=134217729,w=(3+8*v)*v;function _(t,e,r,n,i){var s,o,a,l,u=e[0],c=n[0],h=0,p=0;c>u==c>-u?(s=u,u=e[++h]):(s=c,c=n[++p]);var d=0;if(h<t&&p<r)for(c>u==c>-u?(a=s-((o=u+s)-u),u=e[++h]):(a=s-((o=c+s)-c),c=n[++p]),s=o,0!==a&&(i[d++]=a);h<t&&p<r;)c>u==c>-u?(a=s-((o=s+u)-(l=o-s))+(u-l),u=e[++h]):(a=s-((o=s+c)-(l=o-s))+(c-l),c=n[++p]),s=o,0!==a&&(i[d++]=a);for(;h<t;)a=s-((o=s+u)-(l=o-s))+(u-l),u=e[++h],s=o,0!==a&&(i[d++]=a);for(;p<r;)a=s-((o=s+c)-(l=o-s))+(c-l),c=n[++p],s=o,0!==a&&(i[d++]=a);return 0===s&&0!==d||(i[d++]=s),d}function A(t){return new Float64Array(t)}var M=33306690738754716e-32,I=22204460492503146e-32,S=11093356479670487e-47,P=A(4),E=A(8),k=A(12),z=A(16),T=A(4);function B(t,e,r){var n=function(t,e,r,n,i,s){var o=(e-s)*(r-i),a=(t-i)*(n-s),l=o-a;if(0===o||0===a||o>0!=a>0)return l;var u=Math.abs(o+a);return Math.abs(l)>=M*u?l:-function(t,e,r,n,i,s,o){var a,l,u,c,h,p,d,f,m,y,g,x,v,A,M,B,V,C,F=t-i,D=r-i,L=e-s,R=n-s;P[0]=(M=(f=F-(d=(p=b*F)-(p-F)))*(y=R-(m=(p=b*R)-(p-R)))-((A=F*R)-d*m-f*m-d*y))-((g=M-(V=(f=L-(d=(p=b*L)-(p-L)))*(y=D-(m=(p=b*D)-(p-D)))-((B=L*D)-d*m-f*m-d*y)))+(h=M-g))+(h-V),P[1]=(v=A-((x=A+g)-(h=x-A))+(g-h))-((g=v-B)+(h=v-g))+(h-B),P[2]=x-((C=x+g)-(h=C-x))+(g-h),P[3]=C;var O=function(t,e){for(var r=e[0],n=1;n<4;n++)r+=e[n];return r}(0,P),U=I*o;if(O>=U||-O>=U)return O;if(a=t-(F+(h=t-F))+(h-i),u=r-(D+(h=r-D))+(h-i),l=e-(L+(h=e-L))+(h-s),c=n-(R+(h=n-R))+(h-s),0===a&&0===l&&0===u&&0===c)return O;if(U=S*o+w*Math.abs(O),(O+=F*c+R*a-(L*u+D*l))>=U||-O>=U)return O;T[0]=(M=(f=a-(d=(p=b*a)-(p-a)))*(y=R-(m=(p=b*R)-(p-R)))-((A=a*R)-d*m-f*m-d*y))-((g=M-(V=(f=l-(d=(p=b*l)-(p-l)))*(y=D-(m=(p=b*D)-(p-D)))-((B=l*D)-d*m-f*m-d*y)))+(h=M-g))+(h-V),T[1]=(v=A-((x=A+g)-(h=x-A))+(g-h))-((g=v-B)+(h=v-g))+(h-B),T[2]=x-((C=x+g)-(h=C-x))+(g-h),T[3]=C;var N=_(4,P,4,T,E);T[0]=(M=(f=F-(d=(p=b*F)-(p-F)))*(y=c-(m=(p=b*c)-(p-c)))-((A=F*c)-d*m-f*m-d*y))-((g=M-(V=(f=L-(d=(p=b*L)-(p-L)))*(y=u-(m=(p=b*u)-(p-u)))-((B=L*u)-d*m-f*m-d*y)))+(h=M-g))+(h-V),T[1]=(v=A-((x=A+g)-(h=x-A))+(g-h))-((g=v-B)+(h=v-g))+(h-B),T[2]=x-((C=x+g)-(h=C-x))+(g-h),T[3]=C;var j=_(N,E,4,T,k);T[0]=(M=(f=a-(d=(p=b*a)-(p-a)))*(y=c-(m=(p=b*c)-(p-c)))-((A=a*c)-d*m-f*m-d*y))-((g=M-(V=(f=l-(d=(p=b*l)-(p-l)))*(y=u-(m=(p=b*u)-(p-u)))-((B=l*u)-d*m-f*m-d*y)))+(h=M-g))+(h-V),T[1]=(v=A-((x=A+g)-(h=x-A))+(g-h))-((g=v-B)+(h=v-g))+(h-B),T[2]=x-((C=x+g)-(h=C-x))+(g-h),T[3]=C;var $=_(j,k,4,T,z);return z[$-1]}(t,e,r,n,i,s,u)}(t[0],t[1],e[0],e[1],r[0],r[1]);return n>0?-1:n<0?1:0}function V(t,e){var r=t.point,n=e.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:function(t,e,r,n){return t.left!==e.left?t.left?1:-1:0!==B(r,t.otherEvent.point,e.otherEvent.point)?t.isBelow(e.otherEvent.point)?-1:1:!t.isSubject&&e.isSubject?1:-1}(t,e,r)}function C(t,e,r){var n=new y(e,!1,t,t.isSubject),i=new y(e,!0,t.otherEvent,t.isSubject);return x(t.point,t.otherEvent.point)&&console.warn("what is that, a collapsed segment?",t),n.contourId=i.contourId=t.contourId,V(i,t.otherEvent)>0&&(t.otherEvent.left=!0,i.left=!1),t.otherEvent.otherEvent=i,t.otherEvent=n,r.push(i),r.push(n),r}function F(t,e){return t[0]*e[1]-t[1]*e[0]}function D(t,e){return t[0]*e[0]+t[1]*e[1]}function L(t,e,r){var n=function(t,e,r,n,i){var s=[e[0]-t[0],e[1]-t[1]],o=[n[0]-r[0],n[1]-r[1]];function a(t,e,r){return [t[0]+e*r[0],t[1]+e*r[1]]}var l=[r[0]-t[0],r[1]-t[1]],u=F(s,o),c=u*u,h=D(s,s);if(c>0){var p=F(l,o)/u;if(p<0||p>1)return null;var d=F(l,s)/u;return d<0||d>1?null:0===p||1===p?[a(t,p,s)]:0===d||1===d?[a(r,d,o)]:[a(t,p,s)]}if((c=(u=F(l,s))*u)>0)return null;var f=D(s,l)/h,m=f+D(s,o)/h,y=Math.min(f,m),g=Math.max(f,m);return y<=1&&g>=0?1===y?[a(t,y>0?y:0,s)]:0===g?[a(t,g<1?g:1,s)]:[a(t,y>0?y:0,s),a(t,g<1?g:1,s)]:null}(t.point,t.otherEvent.point,e.point,e.otherEvent.point),i=n?n.length:0;if(0===i)return 0;if(1===i&&(x(t.point,e.point)||x(t.otherEvent.point,e.otherEvent.point)))return 0;if(2===i&&t.isSubject===e.isSubject)return 0;if(1===i)return x(t.point,n[0])||x(t.otherEvent.point,n[0])||C(t,n[0],r),x(e.point,n[0])||x(e.otherEvent.point,n[0])||C(e,n[0],r),1;var s=[],o=!1,c=!1;return x(t.point,e.point)?o=!0:1===V(t,e)?s.push(e,t):s.push(t,e),x(t.otherEvent.point,e.otherEvent.point)?c=!0:1===V(t.otherEvent,e.otherEvent)?s.push(e.otherEvent,t.otherEvent):s.push(t.otherEvent,e.otherEvent),o&&c||o?(e.type=a,t.type=e.inOut===t.inOut?l:u,o&&!c&&C(s[1].otherEvent,s[0].point,r),2):c?(C(s[0],s[1].point,r),3):s[0]!==s[3].otherEvent?(C(s[0],s[1].point,r),C(s[1],s[2].point,r),3):(C(s[0],s[1].point,r),C(s[3].otherEvent,s[2].point,r),3)}function R(t,e){if(t===e)return 0;if(0!==B(t.point,t.otherEvent.point,e.point)||0!==B(t.point,t.otherEvent.point,e.otherEvent.point))return x(t.point,e.point)?t.isBelow(e.otherEvent.point)?-1:1:t.point[0]===e.point[0]?t.point[1]<e.point[1]?-1:1:1===V(t,e)?e.isAbove(t.point)?-1:1:t.isBelow(e.point)?-1:1;if(t.isSubject!==e.isSubject)return t.isSubject?-1:1;var r=t.point,n=e.point;return r[0]===n[0]&&r[1]===n[1]?(r=t.otherEvent.point)[0]===(n=e.otherEvent.point)[0]&&r[1]===n[1]?0:t.contourId>e.contourId?1:-1:1===V(t,e)?1:-1}var O=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null;};function U(t,e,r,n){var i,s=t+1,o=e[t].point,a=e.length;for(s<a&&(i=e[s].point);s<a&&i[0]===o[0]&&i[1]===o[1];){if(!r[s])return s;++s<a&&(i=e[s].point);}for(s=t-1;r[s]&&s>n;)s--;return s}O.prototype.isExterior=function(){return null==this.holeOf};var N=$,j=$;function $(t,e){if(!(this instanceof $))return new $(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||G,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r);}function G(t,e){return t<e?-1:t>e?1:0}$.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1);},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var i=t-1>>1,s=e[i];if(r(n,s)>=0)break;e[t]=s,t=i;}e[t]=n;},_down:function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var s=1+(t<<1),o=s+1,a=e[s];if(o<this.length&&r(e[o],a)<0&&(s=o,a=e[o]),r(a,i)>=0)break;e[t]=a,t=s;}e[t]=i;}},N.default=j;var H=Math.max,q=Math.min,X=0;function Z(t,e,r,n,i,s){var o,a,l,u,c,h;for(o=0,a=t.length-1;o<a;o++)if(u=t[o+1],c=new y(l=t[o],!1,void 0,e),h=new y(u,!1,c,e),c.otherEvent=h,l[0]!==u[0]||l[1]!==u[1]){c.contourId=h.contourId=r,s||(c.isExteriorRing=!1,h.isExteriorRing=!1),V(c,h)>0?h.left=!0:c.left=!0;var p=l[0],d=l[1];i[0]=q(i[0],p),i[1]=q(i[1],d),i[2]=H(i[2],p),i[3]=H(i[3],d),n.push(c),n.push(h);}}var W=[];function Y(t,e,n){"number"==typeof t[0][0][0]&&(t=[t]),"number"==typeof e[0][0][0]&&(e=[e]);var i=function(t,e,r){var n=null;return t.length*e.length==0&&(r===c?n=W:r===p?n=t:r!==h&&r!==d||(n=0===t.length?e:t)),n}(t,e,n);if(i)return i===W?null:i;var s=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],a=function(t,e,r,n,i){var s,o,a,l,u,c,h=new N(null,V);for(a=0,l=t.length;a<l;a++)for(u=0,c=(s=t[a]).length;u<c;u++)(o=0===u)&&X++,Z(s[u],!0,X,h,r,o);for(a=0,l=e.length;a<l;a++)for(u=0,c=(s=e[a]).length;u<c;u++)o=0===u,i===p&&(o=!1),o&&X++,Z(s[u],!1,X,h,n,o);return h}(t,e,s,o,n);if(i=function(t,e,r,n,i){var s=null;return (r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3])&&(i===c?s=W:i===p?s=t:i!==h&&i!==d||(s=t.concat(e))),s}(t,e,s,o,n))return i===W?null:i;for(var l=function(t){var e,r,n=function(t){var e,r,n,i,s=[];for(r=0,n=t.length;r<n;r++)((e=t[r]).left&&e.inResult||!e.left&&e.otherEvent.inResult)&&s.push(e);for(var o=!1;!o;)for(o=!0,r=0,n=s.length;r<n;r++)r+1<n&&1===V(s[r],s[r+1])&&(i=s[r],s[r]=s[r+1],s[r+1]=i,o=!1);for(r=0,n=s.length;r<n;r++)(e=s[r]).otherPos=r;for(r=0,n=s.length;r<n;r++)(e=s[r]).left||(i=e.otherPos,e.otherPos=e.otherEvent.otherPos,e.otherEvent.otherPos=i);return s}(t),i={},s=[],o=function(){if(!i[e]){var t=s.length,r=function(t,e,r){var n=new O;if(null!=t.prevInResult){var i=t.prevInResult,s=i.outputContourId;if(i.resultTransition>0){var o=e[s];if(null!=o.holeOf){var a=o.holeOf;e[a].holeIds.push(r),n.holeOf=a,n.depth=e[s].depth;}else e[s].holeIds.push(r),n.holeOf=s,n.depth=e[s].depth+1;}else n.holeOf=null,n.depth=e[s].depth;}else n.holeOf=null,n.depth=0;return n}(n[e],s,t),o=function(e){i[e]=!0,e<n.length&&n[e]&&(n[e].outputContourId=t);},a=e,l=e;for(r.points.push(n[e].point);o(a),o(a=n[a].otherPos),r.points.push(n[a].point),!((a=U(a,n,i,l))==l||a>=n.length)&&n[a];);s.push(r);}};for(e=0,r=n.length;e<r;e++)o();return s}(function(t,e,n,i,s,o){for(var a,l,u,h=new r(R),d=[],m=Math.min(i[2],s[2]);0!==t.length;){var y=t.pop();if(d.push(y),o===c&&y.point[0]>m||o===p&&y.point[0]>i[2])break;if(y.left){l=a=h.insert(y),a=a!==(u=h.minNode())?h.prev(a):null,l=h.next(l);var g=a?a.key:null;if(f(y,g,o),l&&2===L(y,l.key,t)&&(f(y,g,o),f(l.key,y,o)),a&&2===L(a.key,y,t)){var x=a;f(g,(x=x!==u?h.prev(x):null)?x.key:null,o),f(y,g,o);}}else l=a=h.find(y=y.otherEvent),a&&l&&(a=a!==u?h.prev(a):null,l=h.next(l),h.remove(y),l&&a&&L(a.key,l.key,t));}return d}(a,0,0,s,o,n)),u=[],m=0;m<l.length;m++){var y=l[m];if(y.isExterior()){for(var g=[y.points],x=0;x<y.holeIds.length;x++)g.push(l[y.holeIds[x]].points);u.push(g);}}return u}var K={UNION:h,DIFFERENCE:p,INTERSECTION:c,XOR:d};t.diff=function(t,e){return Y(t,e,p)},t.intersection=function(t,e){return Y(t,e,c)},t.operations=K,t.union=function(t,e){return Y(t,e,h)},t.xor=function(t,e){return Y(t,e,d)},Object.defineProperty(t,"__esModule",{value:!0});}(e);}(0,ep.exports)),ep.exports);
/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function np(t,e,r,n){const i=[],s=0===n?(t,e,r,n,i,s)=>{t.push(new bt(s,r+(s-e)/(n-e)*(i-r)));}:(t,e,r,n,i,s)=>{t.push(new bt(e+(s-r)/(i-r)*(n-e),s));};for(const o of t){const t=[];for(const i of o){if(i.length<=2)continue;const o=[];for(let t=0;t<i.length-1;t++){const a=i[t].x,l=i[t].y,u=i[t+1].x,c=i[t+1].y,h=0===n?a:l,p=0===n?u:c;h<e?p>e&&s(o,a,l,u,c,e):h>r?p<r&&s(o,a,l,u,c,r):o.push(i[t]),p<e&&h>=e&&s(o,a,l,u,c,e),p>r&&h<=r&&s(o,a,l,u,c,r);}let a=i[i.length-1];const l=0===n?a.x:a.y;l>=e&&l<=r&&o.push(a),o.length&&(a=o[o.length-1],o[0].x===a.x&&o[0].y===a.y||o.push(o[0]),t.push(o));}t.length&&i.push(t);}return i}function ip(t,e){const r=op(t),n=op([e]),i=rp.intersection(r,n);return null==i?[]:ap(i)}function sp(t,e){const r=65536;let n=op(t,r);for(;e.valid();e.next()){const[t,i]=e.get(),s=t.x*r,o=t.y*r,a=i.x*r,l=i.y*r,u=a-s,c=l-o,h=Math.hypot(u,c),p=Math.trunc(c/h*3),d=-Math.trunc(u/h*3);n=rp.diff(n,[[[s,o],[a,l],[a+p,l+d],[s+p,o+d],[s,o]]]);}return ap(n,1/r)}function op(t,e=1){return [t.map((t=>t.map((t=>[t.x*e,t.y*e]))))]}function ap(t,e=1){return t.map((t=>t.map(((t,r)=>{const n=t.map((t=>new bt(t[0]*e,t[1]*e).round()));return r>0&&n.reverse(),n}))))}class lp{constructor(t,e){this.layoutVertexArray=new na,this.indexArray=new Ma,this.lineIndexArray=new va,this.triangleSegments=new el,this.lineSegments=new el,this.programConfigurations=new kl(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,e&&(this.elevatedLayoutVertexArray=new oa);}update(t,e,r,n,i,s,o,a){this.programConfigurations.updatePaintArrays(t,e,i,r,n,s,o,a);}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,yh.members))),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy());}populatePaintArrays(t,e,r,n,i,s,o){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,e,r,n,i,s,void 0,o);}}class up{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=t.lut,this.bufferData=new lp(t,!1),this.elevationBufferData=new lp(t,!0),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=t.sourceLayerIndex,this.worldview=t.worldview;}updateFootprints(t,e){}populate(t,e,r,n){this.hasPattern=Zh("fill",this.layers,this.pixelRatio,e);const i=this.layers[0].layout.get("fill-sort-key"),s=[];for(const{feature:o,id:a,index:l,sourceLayerIndex:u}of t){const t=this.layers[0]._featureFilter.needGeometry,c=xu(o,t);if(!this.layers[0]._featureFilter.filter(new xo(this.zoom,{worldview:this.worldview}),c,r))continue;const h=i?i.evaluate(c,{},r,e.availableImages):void 0,p={id:a,properties:o.properties,type:o.type,sourceLayerIndex:u,index:l,geometry:t?c.geometry:gu(o,r,n),patterns:{},sortKey:h};s.push(p);}i&&s.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of s){const{geometry:i,index:s,sourceLayerIndex:o}=n;if(this.hasPattern){const t=Wh("fill",this.layers,n,this.zoom,this.pixelRatio,e);this.patternFeatures.push(t);}else this.addFeature(n,i,s,r,{},e.availableImages,e.brightness,e.elevationFeatures);e.featureIndex.insert(t[s].feature,i,s,o,this.index);}}update(t,e,r,n,i,s,o){this.bufferData.update(t,e,r,n,i,s,o,this.worldview),this.elevationBufferData.update(t,e,r,n,i,s,o,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(t,e,r,n,i,s,o,this.worldview);}addFeatures(t,e,r,n,i,s){for(const i of this.patternFeatures)this.addFeature(i,i.geometry,i.index,e,r,n,s,t.elevationFeatures);}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return !this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t);}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy();}addFeature(t,e,r,n,i,s=[],o,a){const l=Hh(e,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(t,l,n,r,a):this.addGeometry(l,this.bufferData),this.bufferData.populatePaintArrays(t,r,i,s,n,o,this.worldview),this.elevationBufferData.populatePaintArrays(t,r,i,s,n,o,this.worldview);}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(t,e,r,n,i){this.elevatedStructures&&(this.elevatedStructures.construct(t),this.elevatedStructures.populatePaintArrays(e,r,n,i,this.worldview));}addElevatedRoadFeature(t,e,r,n,i){const s=new Array,o=Gu.getElevationFeature(t,i);if(!o)return void this.addGeometry(e,this.bufferData);{const t=this.clipPolygonsToTile(e,1);t.length>0&&s.push({polygons:t,elevationFeature:o,elevationTileID:r});}const a={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(t,{},r),featureIndex:n};for(const e of s)if(e.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new Qh(e.elevationTileID,this.layers,this.zoom,this.lut));const r=e.elevationFeature.isTunnel();let n=0;t.properties.hasOwnProperty(Pu)&&(n=+t.properties[Pu]);for(const t of e.polygons)this.elevatedStructures.addPortalCandidates(e.elevationFeature.id,t,r,e.elevationFeature,n);}null==e.elevationFeature.constantHeight&&(e.polygons=this.prepareElevatedPolygons(e.polygons,e.elevationFeature,e.elevationTileID));const i=new Hu(r,e.elevationTileID);this.addElevatedGeometry(e.polygons,i,e.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,n,a);}}addElevatedGeometry(t,e,r,n,i,s){const o={elevation:r,elevationSampler:e,bias:n,index:i,featureInfo:s},[a,l]=this.addGeometry(t,this.elevationBufferData,o);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:a,max:l}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,a),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,l));}addGeometry(t,e,r){let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=null;r&&(s=r.elevationSampler.constantElevation(r.elevation,r.bias),null!=s&&(n=s,i=s));const o=(t,o,a)=>{if(null!=r)if(o.push(t),null!=s)e.elevatedLayoutVertexArray.emplaceBack(s),a.push(s);else {const s=r.elevationSampler.pointElevation(t,r.elevation,r.bias);e.elevatedLayoutVertexArray.emplaceBack(s),a.push(s),n=Math.min(n,s),i=Math.max(i,s);}};for(const n of t){let t=0;for(const e of n)t+=e.length;const i=e.triangleSegments.prepareSegment(t,e.layoutVertexArray,e.indexArray),s=i.vertexLength,a=[],l=[],u=[],c=[],h=[],p=e.layoutVertexArray.length;for(const t of n){if(0===t.length)continue;t!==n[0]&&l.push(a.length/2);const i=e.lineSegments.prepareSegment(t.length,e.layoutVertexArray,e.lineIndexArray),s=i.vertexLength;r&&h.push(e.layoutVertexArray.length-p),o(t[0],u,c),e.layoutVertexArray.emplaceBack(t[0].x,t[0].y),e.lineIndexArray.emplaceBack(s+t.length-1,s),a.push(t[0].x),a.push(t[0].y);for(let r=1;r<t.length;r++)o(t[r],u,c),e.layoutVertexArray.emplaceBack(t[r].x,t[r].y),e.lineIndexArray.emplaceBack(s+r-1,s+r),a.push(t[r].x),a.push(t[r].y);i.vertexLength+=t.length,i.primitiveLength+=t.length;}const d=vh(a,l);for(let t=0;t<d.length;t+=3)e.indexArray.emplaceBack(s+d[t],s+d[t+1],s+d[t+2]);if(d.length>0&&r&&"hd-road-base"===this.elevationMode){const t=r.elevation.isTunnel(),e=r.elevation.safeArea,n=this.elevatedStructures.addVertices(u,c);this.elevatedStructures.addTriangles(d,n,t);const i=h.length;if(i>0){for(let s=0;s<i-1;s++)this.elevatedStructures.addRenderableRing(r.index,h[s]+n,h[s+1]-h[s],t,e,r.featureInfo);this.elevatedStructures.addRenderableRing(r.index,h[i-1]+n,u.length-h[i-1],t,e,r.featureInfo);}}i.vertexLength+=t,i.primitiveLength+=d.length/3;}return [n,i]}prepareElevatedPolygons(t,e,r){const n=1/lu(r),i=[];for(const r of t){const t=sp(r,new ju(e,n));i.push(...t);}return i}clipPolygonsToTile(t,e){const r=-e,n=-e,i=Cn+e,s=Cn+e;let o=0;const a=[],l=[];for(;o<t.length;o++){const e=t[o],u=pn(e);(u.min.x>=r&&u.max.x<=i&&u.min.y>=n&&u.max.y<=s?a:l).push(e);}if(a.length===t.length)return t;const u=[new bt(r,n),new bt(i,n),new bt(i,s),new bt(r,s),new bt(r,n)],c=a;for(const t of l)c.push(...ip(t,u));return c}}let cp,hp,pp,dp;qs(up,"FillBucket",{omit:["layers","patternFeatures"]}),qs(lp,"FillBufferData"),qs(Qh,"ElevatedStructures");class fp{constructor(t,e,r,n){if(this.triangleCount=e.length/3,this.min=new bt(0,0),this.max=new bt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length)return;const[i,s]=[t[0].clone(),t[0].clone()];for(let e=1;e<t.length;++e){const r=t[e];i.x=Math.min(i.x,r.x),i.y=Math.min(i.y,r.y),s.x=Math.max(s.x,r.x),s.y=Math.max(s.y,r.y);}if(n){const t=Math.ceil(Math.max(s.x-i.x,s.y-i.y)/n);r=Math.max(r,t);}if(0===r)return;this.min=i,this.max=s;const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const a=Math.max(o.x,o.y)/r;this.cellsX=Math.max(1,Math.ceil(o.x/a)),this.cellsY=Math.max(1,Math.ceil(o.y/a)),this.xScale=1/a,this.yScale=1/a;const l=[];for(let r=0;r<this.triangleCount;r++){const n=t[e[3*r+0]].sub(this.min),i=t[e[3*r+1]].sub(this.min),s=t[e[3*r+2]].sub(this.min),o=mp(Math.floor(Math.min(n.x,i.x,s.x)),this.xScale,this.cellsX),u=mp(Math.floor(Math.max(n.x,i.x,s.x)),this.xScale,this.cellsX),c=mp(Math.floor(Math.min(n.y,i.y,s.y)),this.yScale,this.cellsY),h=mp(Math.floor(Math.max(n.y,i.y,s.y)),this.yScale,this.cellsY),p=new bt(0,0),d=new bt(0,0),f=new bt(0,0),m=new bt(0,0);for(let t=c;t<=h;++t){p.y=d.y=t*a,f.y=m.y=(t+1)*a;for(let e=o;e<=u;++e)p.x=f.x=e*a,d.x=m.x=(e+1)*a,(lc(n,i,s,p,d,m)||lc(n,i,s,p,m,f))&&l.push({cellIdx:t*this.cellsX+e,triIdx:r});}}if(0===l.length)return;l.sort(((t,e)=>t.cellIdx-e.cellIdx||t.triIdx-e.triIdx));let u=0;for(;u<l.length;){const t=l[u].cellIdx,e={start:this.payload.length,len:0};for(;u<l.length&&l[u].cellIdx===t;)++e.len,this.payload.push(l[u++].triIdx);this.cells[t]=e;}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0);}queryPoint(t,e){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const r=mp(t.x-this.min.x,this.xScale,this.cellsX),n=mp(t.y-this.min.y,this.yScale,this.cellsY),i=this.cells[n*this.cellsX+r];if(i){this._lazyInitLookup();for(let t=0;t<i.len;t++){const r=this.payload[i.start+t],n=Math.floor(r/8),s=1<<r%8;if(!(this.lookup[n]&s)&&(this.lookup[n]|=s,e.push(r),e.length===this.triangleCount))return}}}query(t,e,r){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>e.x)return;if(t.y>this.max.y||this.min.y>e.y)return;this._lazyInitLookup();const n=mp(t.x-this.min.x,this.xScale,this.cellsX),i=mp(e.x-this.min.x,this.xScale,this.cellsX),s=mp(t.y-this.min.y,this.yScale,this.cellsY),o=mp(e.y-this.min.y,this.yScale,this.cellsY);for(let t=s;t<=o;t++)for(let e=n;e<=i;e++){const n=this.cells[t*this.cellsX+e];if(n)for(let t=0;t<n.len;t++){const e=this.payload[n.start+t],i=Math.floor(e/8),s=1<<e%8;if(!(this.lookup[i]&s)&&(this.lookup[i]|=s,r.push(e),r.length===this.triangleCount))return}}}}function mp(t,e,r){return Math.max(0,Math.min(r-1,Math.floor(t*e)))}qs(fp,"TriangleGridIndex");class yp{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.footprints=[],this.worldview=t.worldview;}updateFootprints(t,e){for(const r of this.footprints)e.push({footprint:r,id:t});}populate(t,e,r,n){const i=[];for(const{feature:e,id:s,index:o,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,l=xu(e,t);if(!this.layers[0]._featureFilter.filter(new xo(this.zoom,{worldview:this.worldview}),l,r))continue;const u={id:s,properties:e.properties,type:e.type,sourceLayerIndex:a,index:o,geometry:t?l.geometry:gu(e,r,n),patterns:{}};i.push(u);}for(const n of i){const{geometry:i,index:s,sourceLayerIndex:o}=n;this.addFeature(n,i,s,r,{},e.availableImages,e.brightness),e.featureIndex.insert(t[s].feature,i,s,o,this.index);}}isEmpty(){return 0===this.footprints.length}uploadPending(){return !1}upload(t){}update(t,e,r,n,i,s,o){}destroy(){}addFeature(t,e,r,n,i,s=[],o){for(const t of Hh(e,2)){const e=[],r=[],n=[],i=new bt(1/0,1/0),s=new bt(-1/0,-1/0);for(const o of t)if(0!==o.length){o!==t[0]&&n.push(r.length/2);for(let t=0;t<o.length;t++)r.push(o[t].x),r.push(o[t].y),e.push(o[t]),i.x=Math.min(i.x,o[t].x),i.y=Math.min(i.y,o[t].y),s.x=Math.max(s.x,o[t].x),s.y=Math.max(s.y,o[t].y);}const o=vh(r,n),a=new fp(e,o,8,256);this.footprints.push({vertices:e,indices:o,grid:a,min:i,max:s});}}}qs(yp,"ClipBucket",{omit:["layers"]});const gp=ea([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),xp=ea([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),vp=ea([{name:"a_centroid_pos",components:2,type:"Uint16"}]),bp=ea([{name:"a_join_normal_inside",components:3,type:"Int16"}]),wp=ea([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),_p=ea([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ap}=gp,Mp=Number.MAX_SAFE_INTEGER,Ip=Mp-1;function Sp(t,e,r,n){return t.order<e||t.order===Mp||!(t.clipMask&r)||function(t,e){return 0!==e.length&&void 0===e.find((e=>e===t))}(n,t.clipScope)}function Pp(t,e){return t.x-e.x||t.y-e.y}function Ep(t,e){return 0===Pp(t.min,e.min)&&0===Pp(t.max,e.max)}function kp(t,e){return !(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function zp(t,e){if(t.length!==e.length)return !1;for(let r=0;r<t.length;r++)if(t[r].sourceId!==e[r].sourceId||!Ep(t[r],e[r])||t[r].order!==e[r].order||t[r].clipMask!==e[r].clipMask||!wt(t[r].clipScope,e[r].clipScope))return !1;return !0}function Tp(t,e,r){const n=1/Cn,i=1/(1<<r.canonical.z),s=(e.x*n+r.canonical.x)*i+r.wrap,o=(e.y*n+r.canonical.y)*i;return {min:new bt((t.x*n+r.canonical.x)*i+r.wrap,(t.y*n+r.canonical.y)*i),max:new bt(s,o)}}function Bp(t,e,r){const n=1<<r.canonical.z,i=((e.x-r.wrap)*n-r.canonical.x)*Cn,s=(e.y*n-r.canonical.y)*Cn;return {min:new bt(((t.x-r.wrap)*n-r.canonical.x)*Cn,(t.y*n-r.canonical.y)*Cn),max:new bt(i,s)}}function Vp(t,e,r,n,i,s,o){const a=t.indices,l=t.vertices,u=[];for(let c=n;c<n+i;c+=3){const n=e[r[c+0]+s],i=e[r[c+1]+s],h=e[r[c+2]+s],p=Math.min(n.x,i.x,h.x),d=Math.max(n.x,i.x,h.x),f=Math.min(n.y,i.y,h.y),m=Math.max(n.y,i.y,h.y);u.length=0,t.grid.query(new bt(p,f),new bt(d,m),u);for(let t=0;t<u.length;t++){const e=u[t];if(lc(l[a[3*e+0]],l[a[3*e+1]],l[a[3*e+2]],n,i,h,o))return !0}}return !1}function Cp(t,e,r,n){if(!t||!r)return !1;let i=t.vertices;if(!e.canonical.equals(n.canonical)||e.wrap!==n.wrap){if(r.vertices.length<t.vertices.length)return Cp(r,n,t,e);const s=e.canonical,o=n.canonical,a=Math.pow(2,o.z-s.z);i=t.vertices.map((t=>new bt((t.x+s.x*Cn)*a-o.x*Cn,(t.y+s.y*Cn)*a-o.y*Cn)));}return Vp(r,i,t.indices,0,t.indices.length,0,0)}function Fp(t,e,r,n){const i=Math.pow(2,n.z-r.z);return new bt((t+r.x*Cn)*i-n.x*Cn,(e+r.y*Cn)*i-n.y*Cn)}function Dp(t,e){const r=[];e.grid.queryPoint(t,r);const n=e.indices,i=e.vertices;for(let e=0;e<r.length;e++){const s=r[e];if(ic([i[n[3*s+0]],i[n[3*s+1]],i[n[3*s+2]]],t))return !0}return !1}const Lp=[new bt(0,0),new bt(Cn,0),new bt(Cn,Cn),new bt(0,Cn)];function Rp(t,e){const r=[];let n=[];if(!e||t.length<2)return [t];if(2===t.length)return oc(t[0],t[1],Lp)?[t]:[];for(let e=0;e<t.length+2;e++){const i=t[e%t.length],s=t[(e+1)%t.length],o=oc(0===e?t[t.length-1]:t[(e-1)%t.length],i,Lp),a=oc(i,s,Lp),l=o||a;l&&n.push(i),l&&a||n.length>0&&(n.length>1&&r.push(n),n=[]);}return n.length>1&&r.push(n),r}const Op=vu.types,Up=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Np=["fill-extrusion-flood-light-ground-radius"],jp=Math.pow(2,13),$p=Math.pow(2,15)-1,Gp=new bt(0,1),Hp=2147483648;function qp(t,e,r,n,i,s,o,a){t.emplaceBack((e<<1)+o,(r<<1)+s,(Math.floor(n*jp)<<1)+i,Math.round(a));}function Xp(t,e,r){t.emplaceBack(e.x*Cn,e.y*Cn,r?1:0);}function Zp(t,e,r,n,i,s){t.emplaceBack(e.x,e.y,(r.x<<1)+n,(r.y<<1)+i,s);}function Wp(t,e,r){const n=16384;t.emplaceBack(e.x,e.y,e.z,r[0]*n,r[1]*n,r[2]*n);}class Yp{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0;}}class Kp{constructor(){this.centroidXY=new bt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new bt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new bt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0;}span(){return new bt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Jp{constructor(){this.acc=new bt(0,0),this.accCount=0,this.centroidDataIndex=0;}startRing(t,e){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=e.x,t.min.y=t.max.y=e.y);}appendEdge(t,e,r){this.accCount++,this.acc._add(e);let n=!!this.borders;e.x<t.min.x?(t.min.x=e.x,n=!0):e.x>t.max.x&&(t.max.x=e.x,n=!0),e.y<t.min.y?(t.min.y=e.y,n=!0):e.y>t.max.y&&(t.max.y=e.y,n=!0),((0===e.x||e.x===Cn)&&e.x===r.x)!=((0===e.y||e.y===Cn)&&e.y===r.y)&&this.processBorderOverlap(e,r),n&&this.checkBorderIntersection(e,r);}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,ur(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>Cn!=t.x>Cn&&this.addBorderIntersection(1,ur(e.y,t.y,(Cn-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,ur(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>Cn!=t.y>Cn&&this.addBorderIntersection(3,ur(e.x,t.x,(Cn-e.y)/(t.y-e.y)));}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[t];e<r[0]&&(r[0]=e),e>r[1]&&(r[1]=e);}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const r=0===t.x?0:1;this.addBorderIntersection(r,e.y),this.addBorderIntersection(r,t.y);}else {const r=0===t.y?2:3;this.addBorderIntersection(r,e.x),this.addBorderIntersection(r,t.x);}}centroid(){return 0===this.accCount?new bt(0,0):new bt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((t,e)=>t+ +(e[0]!==Number.MAX_VALUE)),0):0}}function Qp(t,e){const r=t.add(e)._unit(),n=zt(t.x*r.x+t.y*r.y,-1,1);var i,s,o;return i=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(i)))/4*$p*((s=t).x*(o=e).y-s.y*o.x<0?-1:1)}const td=[t=>t.x<0,t=>t.x>Cn,t=>t.y<0,t=>t.y>Cn];function ed(t,e,r,n){const i=[4];if(0===n)return i;r._mult(n);const s=t.sub(r),o=e.sub(r),a=[t,e,s,o];for(let t=0;t<4;t++)for(const e of a)if(td[t](e)){i.push(t);break}return i}class rd{constructor(t){this.vertexArray=new ua,this.indexArray=new Ma,this.programConfigurations=new kl(t.layers,{zoom:t.zoom,lut:t.lut},(t=>Np.includes(t))),this._segments=new el,this.hiddenByLandmarkVertexArray=new Ra,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new el;}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,e,r,n=!1){const i=t.length;if(i>2){let s=Math.max(0,this._segments.get().length-1);const o=this._segments._prepareSegment(4*i,this.vertexArray.length,2*this._segmentToGroundQuads[s].length);let a;s!==this._segments.get().length-1&&(s++,this._segmentToGroundQuads[s]=[],this._segmentToRegionTriCounts[s]=[0,0,0,0,0]);{const e=t[0],r=t[1];a=Qp(e.sub(t[i-1])._perp()._unit(),r.sub(e)._perp()._unit());}for(let l=0;l<i;l++){const u=l===i-1?0:l+1,c=t[l],h=t[u],p=t[u===i-1?0:u+1],d=h.sub(c)._perp()._unit(),f=Qp(d,p.sub(h)._perp()._unit()),m=a,y=f;if(ad(c,h,e)||n&&ld(c,e)&&ld(h,e)){a=f;continue}const g=o.vertexLength;Zp(this.vertexArray,c,h,1,1,m),Zp(this.vertexArray,c,h,1,0,m),Zp(this.vertexArray,c,h,0,1,y),Zp(this.vertexArray,c,h,0,0,y),o.vertexLength+=4;const x=ed(c,h,d,r);for(const t of x)this._segmentToGroundQuads[s].push({id:g,region:t}),this._segmentToRegionTriCounts[s][t]+=2,o.primitiveLength+=2;a=f;}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),e=t.length;for(let t=0;t<e;t++)this._segmentToGroundQuads[t].sort(((t,e)=>t.region-e.region));for(let r=0;r<e;r++){const e=this._segmentToGroundQuads[r],n=t[r],i=this._segmentToRegionTriCounts[r];i.reduce(((t,e)=>t+e),0);let s=0;for(let t=0;t<=4;t++){const e=i[t];if(0!==e){let r=this.regionSegments[t];r||(r=this.regionSegments[t]=new el);const i={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+s,vertexLength:n.vertexLength,primitiveLength:e};r.get().push(i);}s+=e;}for(let t=0;t<e.length;t++){const r=e[t].id;this.indexArray.emplaceBack(r,r+1,r+3),this.indexArray.emplaceBack(r,r+3,r+2);}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null;}addPaintPropertiesData(t,e,r,n,i,s,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,e,r,n,i,s,void 0,o);}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,xp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray));}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t);}update(t,e,r,n,i,s,o,a){this.hasData()&&this.programConfigurations.updatePaintArrays(t,e,r,n,i,s,o,a);}updateHiddenByLandmark(t){this.updateHiddenByLandmarkRange(t.groundVertexArrayOffset,t.groundVertexCount,!!(t.flags&Hp));}updateHiddenByLandmarkRange(t,e,r){if(!this.hasData())return;const n=e+t;if(0!==e){for(let e=t;e<n;++e)this.hiddenByLandmarkVertexArray.emplace(e,r?1:0);this._needsHiddenByLandmarkUpdate=!0;}}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,wp.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1);}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const e=this.regionSegments[t];e&&e.destroy();}}}}class nd{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ma,this.footprintVertices=new na,this.footprintSegments=[],this.layoutVertexArray=new sa,this.centroidVertexArray=new Wa,this.wallVertexArray=new Ka,this.indexArray=new Ma,this.programConfigurations=new kl(t.layers,{zoom:t.zoom,lut:t.lut},(t=>Up.includes(t))),this.segments=new el,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.groundEffect=new rd(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=t.worldview;}updateFootprints(t,e){}populate(t,e,r,n){this.features=[],this.hasPattern=Zh("fill-extrusion",this.layers,this.pixelRatio,e),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=lu(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:i,id:s,index:o,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,l=xu(i,t);if(!this.layers[0]._featureFilter.filter(new xo(this.zoom,{worldview:this.worldview}),l,r))continue;const u={id:s,sourceLayerIndex:a,index:o,geometry:t?l.geometry:gu(i,r,n),properties:i.properties,type:i.type,patterns:{}},c=this.layoutVertexArray.length,h="Polygon"===Op[u.type];if(this.hasPattern)this.features.push({featureId:i.id,feature:Wh("fill-extrusion",this.layers,u,this.zoom,this.pixelRatio,e)});else if(this.wallMode)for(const t of u.geometry)for(const s of Rp(t,h))this.addFeature(i.id,u,[s],o,r,{},e.availableImages,n,e.brightness);else this.addFeature(i.id,u,u.geometry,o,r,{},e.availableImages,n,e.brightness);e.featureIndex.insert(i,u.geometry,o,a,this.index,c);}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0;}addFeatures(t,e,r,n,i,s){for(const{featureId:t,feature:o}of this.features){const a="Polygon"===Op[o.type],{geometry:l}=o;if(this.wallMode)for(const u of l)for(const l of Rp(u,a))this.addFeature(t,o,[l],o.index,e,r,n,i,s);else this.addFeature(t,o,l,o.index,e,r,n,i,s);}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles();}update(t,e,r,n,i,s,o){this.programConfigurations.updatePaintArrays(t,e,i,r,n,s,o,this.worldview),this.groundEffect.update(t,e,i,r,n,s,o,this.worldview);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ap),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,bp.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,_p.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0;}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,vp.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}addFeature(t,e,r,n,i,s,o,a,l){const u=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new bt(0,0),new bt(Cn,Cn)],h=a.projection,p="globe"===h.name,d=this.wallMode||"Polygon"===Op[e.type],f=new Jp;f.centroidDataIndex=this.centroidData.length;const m=new Kp;m.buildingId=t,e.properties&&e.properties.hasOwnProperty("building_id")&&(m.buildingId=e.properties.building_id);const y=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},i)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},i);let x;if(m.height=g,m.vertexArrayOffset=this.layoutVertexArray.length,m.groundVertexArrayOffset=this.groundEffect.vertexArray.length,p&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new fa),this.wallMode){if(p)return void Gt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==r.length)return;x=function(t){const e=t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y,r=function(t){let e=0;const r=t.length;for(let n=0;n<r;n++)e+=(t[(n+1)%r].x-t[n].x)*(t[(n+1)%r].y+t[n].y);return e>=0}(t);r||(t=t.reverse());const n={geometry:[],joinNormals:[],indices:[]},i=[],s=[],o=[];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;if(a<(e?3:2))return n;let l,u,c,h,p,d=0;for(;d<a-1&&t[d].equals(t[d+1]);)d++;e&&(l=t[a-2],p=t[d].sub(l)._unit()._perp());for(let r=d;r<a;r++){if(c=r===a-1?e?t[d+1]:void 0:t[r+1],c&&t[r].equals(c))continue;p&&(h=p),l&&(u=l),l=t[r],p=c?c.sub(l)._unit()._perp():h,h=h||p;let n=h.add(p);0===n.x&&0===n.y||n._unit();const f=n.x*p.x+n.y*p.y,m=0!==f?1/f:1/0,y=h.x*p.y-h.y*p.x>0;let g="miter";const x=2;"miter"===g&&m>x&&(g="bevel"),"bevel"===g&&(m>100&&(g="flipbevel"),m<x&&(g="miter"));const v=(t,e,r,n)=>{const a=new bt(t.x,t.y),l=new bt(t.x,t.y);a.x+=e.x*n,a.y+=e.y*n,l.x-=e.x*Math.max(r,1),l.y-=e.y*Math.max(r,1),o.push(e),i.push(a),s.push(l);};if("miter"===g)n._mult(m),v(l,n,0,0);else if("flipbevel"===g)n=p.mult(-1),v(l,n,0,0),v(l,n.mult(-1),0,0);else {const t=-Math.sqrt(m*m-1),e=y?t:0,r=y?0:t;u&&v(l,h,e,r),c&&v(l,p,e,r);}}n.geometry=[...i,...s.reverse(),i[0]],n.joinNormals=[...o,...o.reverse(),o[o.length-1]];const f=n.geometry.length-1;for(let t=0;t<f/2;t++)if(t+1<f/2){let e=t,r=t+1,i=f-1-t,s=f-2-t;e=0===e?f-1:e-1,r=0===r?f-1:r-1,i=0===i?f-1:i-1,s=0===s?f-1:s-1,n.indices.push(i),n.indices.push(r),n.indices.push(e),n.indices.push(i),n.indices.push(s),n.indices.push(r);}return n}(r[0]),r=[x.geometry];}const v=(t,e)=>t<(e.length-1)/2||t===e.length-1,b=this.wallMode?[r]:Hh(r,500);for(let t=b.length-1;t>=0;t--){const e=b[t];(0===e.length||(w=e[0]).every((t=>t.x<=0))||w.every((t=>t.x>=Cn))||w.every((t=>t.y<=0))||w.every((t=>t.y>=Cn)))&&b.splice(t,1);}var w;let _;if(p)_=pd(b,c,i);else {_=[];for(const t of b)_.push({polygon:t,bounds:c});}const A=d?this.edgeRadius:0,M=A>0&&this.zoom<17,I=(t,e)=>{if(0===t.length)return !1;const r=t[t.length-1];return e.x===r.x&&e.y===r.y};for(const{polygon:t,bounds:e}of _){let r=0,n=0;for(const e of t)d&&!e[0].equals(e[e.length-1])&&e.push(e[0]),n+=d?e.length-1:e.length;const s=this.segments.prepareSegment((d?5:4)*n,this.layoutVertexArray,this.indexArray);m.footprintSegIdx<0&&(m.footprintSegIdx=this.footprintSegments.length),m.polygonSegIdx<0&&(m.polygonSegIdx=this.polygonSegments.length);const o={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},a=new Yp;if(a.vertexOffset=this.footprintVertices.length,a.indexOffset=3*this.footprintIndices.length,a.ringIndices=[],d){const n=[],o=[];r=s.vertexLength;for(let r=0;r<t.length;r++){const l=t[r];l.length&&0!==r&&o.push(n.length/2);const c=[];let d,f;d=l[1].sub(l[0])._perp()._unit(),a.ringIndices.push(l.length-1);for(let t=1;t<l.length;t++){const e=l[t],r=l[t===l.length-1?1:t+1],o=e.clone();if(A){f=r.sub(e)._perp()._unit();const t=d.add(f)._unit(),n=A*Math.min(4,1/(d.x*t.x+d.y*t.y));o.x+=n*t.x,o.y+=n*t.y,o.x=Math.round(o.x),o.y=Math.round(o.y),d=f;}if(!y||0!==A&&!M||I(c,o)||c.push(o),qp(this.layoutVertexArray,o.x,o.y,0,0,1,1,0),this.wallMode){const e=v(t,l);Xp(this.wallVertexArray,x.joinNormals[t],!e);}s.vertexLength++,this.footprintVertices.emplaceBack(e.x,e.y),n.push(e.x,e.y),p&&Wp(this.layoutVertexExtArray,h.projectTilePoint(o.x,o.y,i),h.upVector(i,o.x,o.y));}y&&(0===A||M)&&(0!==c.length&&I(c,c[0])&&c.pop(),this.groundEffect.addData(c,e,u));}const l=this.wallMode?x.indices:vh(n,o);for(let t=0;t<l.length;t+=3)this.footprintIndices.emplaceBack(a.vertexOffset+l[t+0],a.vertexOffset+l[t+1],a.vertexOffset+l[t+2]),this.indexArray.emplaceBack(r+l[t],r+l[t+2],r+l[t+1]),s.primitiveLength++;a.indexCount+=l.length,a.vertexCount+=this.footprintVertices.length-a.vertexOffset;}for(let n=0;n<t.length;n++){const o=t[n];f.startRing(m,o[0]);let a=o.length>4&&ud(o[o.length-2],o[0],o[1]),l=A?sd(o[o.length-2],o[0],o[1],A):0;const c=[];let g,b,w;b=o[1].sub(o[0])._perp()._unit();let _=!0;for(let t=1,n=0;t<o.length;t++){let u=o[t-1],d=o[t];const M=o[t===o.length-1?1:t+1];if(f.appendEdge(m,d,u),ad(d,u,e)){A&&(b=M.sub(d)._perp()._unit(),_=!_);continue}const S=d.sub(u)._perp(),P=S.x/(Math.abs(S.x)+Math.abs(S.y)),E=S.y>0?1:0,k=u.dist(d);if(n+k>32768&&(n=0),A){w=M.sub(d)._perp()._unit();let t=od(u,d,M,id(b,w),A);isNaN(t)&&(t=0);const e=d.sub(u)._unit();u=u.add(e.mult(l))._round(),d=d.add(e.mult(-t))._round(),l=t,b=w,y&&this.zoom>=17&&(I(c,u)||c.push(u),I(c,d)||c.push(d));}const z=s.vertexLength,T=o.length>4&&ud(u,d,M);let B=cd(n,a,_);if(qp(this.layoutVertexArray,u.x,u.y,P,E,0,0,B),qp(this.layoutVertexArray,u.x,u.y,P,E,0,1,B),this.wallMode){const e=v(t-1,o),r=x.joinNormals[t-1];Xp(this.wallVertexArray,r,e),Xp(this.wallVertexArray,r,e);}if(n+=k,B=cd(n,T,!_),a=T,qp(this.layoutVertexArray,d.x,d.y,P,E,0,0,B),qp(this.layoutVertexArray,d.x,d.y,P,E,0,1,B),this.wallMode){const e=v(t,o),r=x.joinNormals[t];Xp(this.wallVertexArray,r,e),Xp(this.wallVertexArray,r,e);}if(s.vertexLength+=4,this.indexArray.emplaceBack(z+0,z+1,z+2),this.indexArray.emplaceBack(z+1,z+3,z+2),s.primitiveLength+=2,A){const n=r+(1===t?o.length-2:t-2),i=1===t?r:n+1;if(this.indexArray.emplaceBack(z+1,n,z+3),this.indexArray.emplaceBack(n,i,z+3),s.primitiveLength+=2,void 0===g&&(g=z),!ad(M,o[t],e)){const e=t===o.length-1?g:s.vertexLength;this.indexArray.emplaceBack(z+2,z+3,e),this.indexArray.emplaceBack(z+3,e+1,e),this.indexArray.emplaceBack(z+3,i,e+1),s.primitiveLength+=3;}_=!_;}if(p){const t=this.layoutVertexExtArray,e=h.projectTilePoint(u.x,u.y,i),r=h.projectTilePoint(d.x,d.y,i),n=h.upVector(i,u.x,u.y),s=h.upVector(i,d.x,d.y);Wp(t,e,n),Wp(t,e,n),Wp(t,r,s),Wp(t,r,s);}}d&&(r+=o.length-1),y&&A&&this.zoom>=17&&(0!==c.length&&I(c,c[0])&&c.pop(),this.groundEffect.addData(c,e,u,A>0));}this.footprintSegments.push(a),o.triangleCount=this.indexArray.length-o.triangleArrayOffset,this.polygonSegments.push(o),++m.footprintSegLen,++m.polygonSegLen;}if(m.vertexCount=this.layoutVertexArray.length-m.vertexArrayOffset,m.groundVertexCount=this.groundEffect.vertexArray.length-m.groundVertexArrayOffset,0!==m.vertexCount){if(m.centroidXY=f.borders?Gp:this.encodeCentroid(f,m),this.centroidData.push(m),f.borders){this.featuresOnBorder.push(f);const t=this.featuresOnBorder.length-1;for(let e=0;e<f.borders.length;e++)f.borders[e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[e].push(t);}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,o,i,l,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,n,s,o,i,l,this.worldview),this.maxHeight=Math.max(this.maxHeight,g);}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort(((e,r)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[r].borders[t][0]));}splitToSubtiles(){const t=[];for(let e=0;e<this.centroidData.length;e++){const r=this.centroidData[e],n=+(r.min.y+r.max.y>Cn),i=2*n+(+(r.min.x+r.max.x>Cn)^n);for(let n=0;n<r.polygonSegLen;n++){const s=r.polygonSegIdx+n;t.push({centroidIdx:e,subtile:i,polygonSegmentIdx:s,triangleSegmentIdx:this.polygonSegments[s].triangleSegIdx});}}const e=new Ma;t.sort(((t,e)=>t.triangleSegmentIdx===e.triangleSegmentIdx?t.subtile-e.subtile:t.triangleSegmentIdx-e.triangleSegmentIdx));let r=0,n=0,i=0;for(const e of t){if(e.triangleSegmentIdx!==r)break;i++;}const s=t.length;for(;n!==t.length;){r=t[n].triangleSegmentIdx;let o=0,a=n,l=n;for(let e=a;e<i&&t[e].subtile===o;e++)l++;for(;a!==i;){const n=t[a];o=n.subtile;const s=this.centroidData[n.centroidIdx].min.clone(),u=this.centroidData[n.centroidIdx].max.clone(),c={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:e.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let r=a;r<l;r++){const n=t[r],i=this.polygonSegments[n.polygonSegmentIdx],o=this.centroidData[n.centroidIdx].min,a=this.centroidData[n.centroidIdx].max,l=this.indexArray.uint16;for(let t=i.triangleArrayOffset;t<i.triangleArrayOffset+i.triangleCount;t++)e.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);c.primitiveLength+=i.triangleCount,s.x=Math.min(s.x,o.x),s.y=Math.min(s.y,o.y),u.x=Math.max(u.x,a.x),u.y=Math.max(u.y,a.y);}c.primitiveLength>0&&this.triangleSubSegments.push({segment:c,min:s,max:u}),a=l;for(let e=a;e<i&&t[e].subtile===t[a].subtile;e++)l++;}n=i;for(let e=n;e<s&&t[e].triangleSegmentIdx===t[n].triangleSegmentIdx;e++)i++;}e._trim(),this.indexArray=e;}getVisibleSegments(t,e,r){const n=new el;if(this.wallMode){for(const t of this.triangleSubSegments)n.segments.push(t.segment);return n}let i=0,s=0;const o=1<<t.canonical.z;if(e){const r=e.getMinMaxForTile(t);r&&(i=r.min,s=r.max);}s+=this.maxHeight;const a=t.toUnwrapped();let l;const u=[a.canonical.x/o+a.wrap,a.canonical.y/o],c=[(a.canonical.x+1)/o+a.wrap,(a.canonical.y+1)/o],h=(t,e,r)=>[t[0]*(1-r[0])+e[0]*r[0],t[1]*(1-r[1])+e[1]*r[1]],p=[],d=[];for(const t of this.triangleSubSegments){p[0]=t.min.x/Cn,p[1]=t.min.y/Cn,d[0]=t.max.x/Cn,d[1]=t.max.y/Cn;const e=h(u,c,p),o=h(u,c,d);if(0===new Nu([e[0],e[1],i],[o[0],o[1],s]).intersectsPrecise(r)){l&&(n.segments.push(l),l=void 0);continue}const a=t.segment;l&&l.vertexOffset!==a.vertexOffset&&(n.segments.push(l),l=void 0),l?(l.vertexLength+=a.vertexLength,l.primitiveLength+=a.primitiveLength):l={vertexOffset:a.vertexOffset,primitiveLength:a.primitiveLength,vertexLength:a.vertexLength,primitiveOffset:a.primitiveOffset,sortKey:void 0,vaos:{}};}return l&&n.segments.push(l),n}encodeCentroid(t,e){const r=t.centroid(),n=e.span(),i=Math.min(7,Math.round(n.x*this.tileToMeter/10)),s=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new bt(zt(r.x,1,Cn-1)<<3|i,zt(r.y,1,Cn-1)<<3|s)}encodeBorderCentroid(t){if(!t.borders)return new bt(0,0);const e=t.borders,r=Number.MAX_VALUE;if(e[0][0]!==r||e[1][0]!==r){const t=e[0][0]!==r?0:1;return new bt(6|(e[0][0]!==r?0:65528),(e[t][0]+e[t][1])/2<<3|6)}{const t=e[2][0]!==r?2:3;return new bt((e[t][0]+e[t][1])/2<<3|6,6|(e[2][0]!==r?0:65528))}}showCentroid(t){const e=this.centroidData[t.centroidDataIndex];e.flags&=2147483647,e.centroidXY.x=0,e.centroidXY.y=0,this.writeCentroidToBuffer(e);}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const e=t.vertexArrayOffset,r=t.vertexCount+t.vertexArrayOffset,n=t.flags&Hp?Gp:t.centroidXY,i=this.centroidVertexArray.geta_centroid_pos0(e);if(this.centroidVertexArray.geta_centroid_pos1(e)!==n.y||i!==n.x){for(let t=e;t<r;++t)this.centroidVertexArray.emplace(t,n.x,n.y);this.needsCentroidUpdate=!0;}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t);}updateReplacement(t,e,r){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const n=e.getReplacementRegionsForTile(t.toUnwrapped());if(zp(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const t of this.centroidData)t.flags&=2147483647;const i=[];for(const e of this.activeReplacements){if(e.order<r)continue;const n=Math.max(1,Math.pow(2,e.footprintTileId.canonical.z-t.canonical.z));if(e.footprint.buildingId){const t=e.footprint.buildingId;for(const e of this.centroidData)e.buildingId===t&&(e.flags|=Hp);}else for(const r of this.centroidData)if(!(r.flags&Hp||e.min.x>r.max.x||r.min.x>e.max.x||e.min.y>r.max.y||r.min.y>e.max.y))for(let s=0;s<r.footprintSegLen;s++){const o=this.footprintSegments[r.footprintSegIdx+s];if(i.length=0,dd(this.footprintVertices,o.vertexOffset,o.vertexCount,e.footprintTileId.canonical,t.canonical,i),Vp(e.footprint,i,this.footprintIndices.uint16,o.indexOffset,o.indexCount,-o.vertexOffset,-n)){r.flags|=Hp;break}}}for(const t of this.centroidData)this.writeCentroidToBuffer(t);this.borderDoneWithNeighborZ=[-1,-1,-1,-1];}footprintContainsPoint(t,e,r){let n=!1;for(let i=0;i<r.footprintSegLen;i++){const s=this.footprintSegments[r.footprintSegIdx+i];let o=0;for(const r of s.ringIndices){for(let i=o,a=r+o-1;i<r+o;a=i++){const r=this.footprintVertices.int16[2*(i+s.vertexOffset)+0],o=this.footprintVertices.int16[2*(i+s.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+s.vertexOffset)+1];o>e!=l>e&&t<(this.footprintVertices.int16[2*(a+s.vertexOffset)+0]-r)*(e-o)/(l-o)+r&&(n=!n);}o=r;}}return n}getHeightAtTileCoord(t,e){let r=Number.NEGATIVE_INFINITY,n=!0;const i=4*(t+Cn)*Cn+(e+Cn);if(this.partLookup.hasOwnProperty(i)){const t=this.partLookup[i];return t?{height:t.height,hidden:!!(t.flags&Hp)}:void 0}for(const s of this.centroidData)t>s.max.x||s.min.x>t||e>s.max.y||s.min.y>e||s.height<=r||this.footprintContainsPoint(t,e,s)&&(r=s.height,this.partLookup[i]=s,n=!!(s.flags&Hp));if(r!==Number.NEGATIVE_INFINITY)return {height:r,hidden:n};this.partLookup[i]=void 0;}}function id(t,e){const r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function sd(t,e,r,n){const i=e.sub(t)._perp()._unit(),s=r.sub(e)._perp()._unit();return od(t,e,r,id(i,s),n)}function od(t,e,r,n,i){const s=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(r)/3,i*s/n)}function ad(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function ld(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function ud(t,e,r){if(t.x<0||t.x>=Cn||e.x<0||e.x>=Cn||r.x<0||r.x>=Cn)return !1;const n=r.sub(e),i=n.perp(),s=t.sub(e);return (n.x*s.x+n.y*s.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(s.x*s.x+s.y*s.y))>-.866&&i.x*s.x+i.y*s.y<0}function cd(t,e,r){const n=e?2|t:-3&t;return r?1|n:-2&n}function hd(){const t=Math.PI/32,e=Math.tan(t),r=Hl;return r*Math.sqrt(1+2*e*e)-r}function pd(t,e,r){const n=1<<r.z,i=eu(r.x/n),s=eu((r.x+1)/n),o=ru(r.y/n),a=ru((r.y+1)/n);return function(t,e,r,n,i=0,s){const o=[];if(!t.length||!r||!n)return o;const a=(t,e)=>{for(const r of t)o.push({polygon:r,bounds:e});},l=Math.ceil(Math.log2(r)),u=Math.ceil(Math.log2(n)),c=l-u,h=[];for(let t=0;t<Math.abs(c);t++)h.push(c>0?0:1);for(let t=0;t<Math.min(l,u);t++)h.push(0),h.push(1);let p=t;if(p=np(p,e[0].y-i,e[1].y+i,1),p=np(p,e[0].x-i,e[1].x+i,0),!p.length)return o;const d=[];for(h.length?d.push({polygons:p,bounds:e,depth:0}):a(p,e);d.length;){const t=d.pop(),e=t.depth,r=h[e],n=t.bounds[0],o=t.bounds[1],l=0===r?n.x:n.y,u=0===r?o.x:o.y,c=s?s(r,l,u):.5*(l+u),p=np(t.polygons,l-i,c+i,r),f=np(t.polygons,c-i,u+i,r);if(p.length){const t=[n,new bt(0===r?c:o.x,1===r?c:o.y)];h.length>e+1?d.push({polygons:p,bounds:t,depth:e+1}):a(p,t);}if(f.length){const t=[new bt(0===r?c:n.x,1===r?c:n.y),o];h.length>e+1?d.push({polygons:f,bounds:t,depth:e+1}):a(f,t);}}return o}(t,e,Math.ceil((s-i)/11.25),Math.ceil((o-a)/11.25),1,((t,e,i)=>{if(0===t)return .5*(e+i);{const t=ru((r.y+e/Cn)/n);return (Ql(.5*(ru((r.y+i/Cn)/n)+t))*n-r.y)*Cn}}))}function dd(t,e,r,n,i,s){const o=Math.pow(2,n.z-i.z);for(let a=0;a<r;a++){let r=t.int16[2*(a+e)+0],l=t.int16[2*(a+e)+1];r=(r+i.x*Cn)*o-n.x*Cn,l=(l+i.y*Cn)*o-n.y*Cn,s.push(new bt(r,l));}}let fd,md;qs(nd,"FillExtrusionBucket",{omit:["layers","features"]}),qs(Kp,"PartData"),qs(Yp,"FootprintSegment"),qs(Jp,"BorderCentroidData"),qs(rd,"GroundEffect");class yd extends bt{constructor(t,e,r){super(t,e),this.z=r;}}class gd extends yd{constructor(t,e,r,n){super(t,e,r),this.w=n;}}function xd(t,e,r,n){const i="x"===r?"y":"x",s=(n-t[r])/(e[r]-t[r]);t[i]=Math.round(t[i]+(e[i]-t[i])*s),t[r]=n,t.hasOwnProperty("z")&&(t.z=ur(t.z,e.z,s)),t.hasOwnProperty("w")&&(t.w=ur(t.w,e.w,s));}function vd(t,e,r,n){const i=r,s=n;for(const r of ["x","y"]){let n=t,o=e;n[r]>=o[r]&&(n=e,o=t),n[r]<i&&o[r]>i&&xd(n,o,r,i),n[r]<s&&o[r]>s&&xd(o,n,r,s);}}function bd(t,e,r,n,i,s){const o=[];for(let a=0;a<t.length;a++){const l=t[a];let u;const c=o.length;let h=0;for(let t=0;t<l.length-1;t++){let c=l[t],p=l[t+1],d=0;const f=h;let m,y;s&&(d=Math.hypot(p.x-c.x,p.y-c.y),h+=d,m=c,y=p),c.x<e&&p.x<e||(c.x<e?c=new bt(e,c.y+(e-c.x)/(p.x-c.x)*(p.y-c.y))._round():p.x<e&&(p=new bt(e,c.y+(e-c.x)/(p.x-c.x)*(p.y-c.y))._round()),c.y<r&&p.y<r||(c.y<r?c=new bt(c.x+(r-c.y)/(p.y-c.y)*(p.x-c.x),r)._round():p.y<r&&(p=new bt(c.x+(r-c.y)/(p.y-c.y)*(p.x-c.x),r)._round()),c.x>=n&&p.x>=n||(c.x>=n?c=new bt(n,c.y+(n-c.x)/(p.x-c.x)*(p.y-c.y))._round():p.x>=n&&(p=new bt(n,c.y+(n-c.x)/(p.x-c.x)*(p.y-c.y))._round()),c.y>=i&&p.y>=i||(c.y>=i?c=new bt(c.x+(i-c.y)/(p.y-c.y)*(p.x-c.x),i)._round():p.y>=i&&(p=new bt(c.x+(i-c.y)/(p.y-c.y)*(p.x-c.x),i)._round()),u&&c.equals(u[u.length-1])||(u=[c],o.push(u),s&&s.push({progress:{min:f+_d(m,y,c)*d,max:1},parentIndex:a,prevPoint:m,nextPoint:y})),u.push(p),s&&(s[s.length-1].progress.max=f+_d(m,y,p)*d,s[s.length-1].nextPoint=y)))));}if(s&&h>0)for(let t=c;t<o.length;t++)s[t].progress.min/=h,s[t].progress.max/=h;}return o}function wd(t,e,r,n,i){if(t.length<2)return void n.push(t);const s=[];for(;e.valid();){const[r,n]=e.get();for(let e=0;e<t.length-1;e++){const i=t[e],o=t[e+1],a=tc(i,o,r,n);if(a){const[t]=a,r=new bt(ur(i.x,o.x,t),ur(i.y,o.y,t));s.push({t:e+t,distance:0,point:r});}}e.next();}if(0===s.length)return void n.push(t);s.sort(((t,e)=>t.t-e.t));let o=0,a=0,l=[];for(n.push(l);o!==t.length;){if(a===s.length){for(;o!==t.length;)0!==l.length&&l[l.length-1].equals(t[o])||l.push(t[o]),o++;break}s[a].t<=o?(0!==l.length&&l[l.length-1].equals(s[a].point)||l.push(s[a].point),Math.trunc(s[a].t),a++):(0!==l.length&&l[l.length-1].equals(t[o])||l.push(t[o]),o++);}}function _d(t,e,r){return t.x!==e.x?(r.x-t.x)/(e.x-t.x):t.y!==e.y?(r.y-t.y)/(e.y-t.y):0}function Ad(t,e){return t.x*e.x+t.y*e.y}function Md(t,e){if(1===t.length){let r=0;const n=e[r++];let i;for(;!i||n.equals(i);)if(i=e[r++],!i)return 1/0;for(;r<e.length;r++){const s=e[r],o=t[0],a=i.sub(n),l=s.sub(n),u=o.sub(n),c=Ad(a,a),h=Ad(a,l),p=Ad(l,l),d=Ad(u,a),f=Ad(u,l),m=c*p-h*h,y=(p*d-h*f)/m,g=(c*f-h*d)/m,x=n.z*(1-y-g)+i.z*y+s.z*g;if(isFinite(x))return x}return 1/0}{let t=1/0;for(const r of e)t=Math.min(t,r.z);return t}}function Id(t,e,r,n,i,s,o,a){const l=o*i.getElevationAt(t,e,!0,!0),u=0!==s[0],c=u?0===s[1]?o*(s[0]/7-450):o*function(t,e,r){const n=Math.floor(e[0]/8),i=Math.floor(e[1]/8),s=10*(e[0]-8*n),o=10*(e[1]-8*i),a=t.getElevationAt(n,i,!0,!0),l=t.getMeterToDEM(r),u=Math.floor(.5*(s*l-1)),c=Math.floor(.5*(o*l-1)),h=t.tileCoordToPixel(n,i),p=2*u+1,d=2*c+1,f=function(t,e,r,n,i){return [t.getElevationAtPixel(e,r,!0),t.getElevationAtPixel(e+i,r,!0),t.getElevationAtPixel(e,r+i,!0),t.getElevationAtPixel(e+n,r+i,!0)]}(t,h.x-u,h.y-c,p,d),m=Math.abs(f[0]-f[1]),y=Math.abs(f[2]-f[3]),g=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),x=Math.min(.25,.5*l*(m+y)/p),v=Math.min(.25,.5*l*g/d);return a+Math.max(x*s,v*o)}(i,s,a):l;return {base:l+(0===r?-1:r),top:u?Math.max(c+n,l+r+2):l+n}}class Sd{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback();});}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback();}),0));}remove(){this._channel=void 0,this._callback=()=>{};}}class Pd{constructor(){this.tasks={},this.taskQueue=[],Rt(["process"],this),this.invoker=new Sd(this.process),this.nextId=0;}add(t,e){const r=this.nextId++,n=function({type:t,isSymbolTile:e,zoom:r}){return r=r||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-r:"maybePrepare"===t&&e?400-r:500:200-r:100-r}(e);if(0===n){try{t();}finally{}return null}return this.tasks[r]={fn:t,metadata:e,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r];}}}process(){try{if(this.taskQueue=this.taskQueue.filter((t=>!!this.tasks[t])),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn();}finally{}}pick(){let t=null,e=1/0;for(let r=0;r<this.taskQueue.length;r++){const n=this.tasks[this.taskQueue[r]];n.priority<e&&(e=n.priority,t=r);}if(null===t)return null;const r=this.taskQueue[t];return this.taskQueue.splice(t,1),r}remove(){this.invoker.remove();}}class Ed{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Rt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Pd;}send(t,e,r,n,i=!1,s){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=s,this.callbacks[o]=r);const a=new Set;return this.target.postMessage({id:o,type:t,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:Ws(e,a)},a),{cancel:()=>{r&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId});}}}receive(t){const e=t.data;if(!e)return;const r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[r];delete this.cancelCallbacks[r],t&&t.cancel();}else if(e.mustQueue||Zt(self)){const t=this.callbacks[r],n=this.scheduler.add((()=>this.processTask(r,e)),t&&t.metadata||{type:"message"});n&&(this.cancelCallbacks[r]=n);}else this.processTask(r,e);}processTask(t,e){if(delete this.cancelCallbacks[t],"<response>"===e.type){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Ys(e.error)):r(null,Ys(e.data)));}else {const r=new Set,n=e.hasCallback?(e,n)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?Ws(e):null,data:Ws(n,r)},r);}:()=>{},i=Ys(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,i,n);else if(this.parent.getWorkerSource){const t=e.type.split("."),{source:r,scope:s}=i;this.parent.getWorkerSource(e.sourceMapId,t[0],r,s)[t[1]](i,n);}else n(new Error(`Could not find function ${e.type}`));}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1);}}var kd={workerUrl:"",workerClass:null,workerParams:void 0};const zd="mapboxgl_preloaded_worker_pool";class Td{constructor(){this.active={};}acquire(t,e=Td.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<e;)this.workers.push(null!=kd.workerClass?new kd.workerClass:new self.Worker(kd.workerUrl,kd.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach((t=>{t.terminate();})),this.workers=null);}isPreloaded(){return !!this.active[zd]}numActive(){return Object.keys(this.active).length}}Td.workerCount=2;class Bd{constructor(t,e,r="Worker",n=Td.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Dt();const i=this.workerPool.acquire(this.id,n);for(let t=0;t<i.length;t++){const n=new Bd.Actor(i[t],e,this.id);n.name=`${r} ${t}`,this.actors.push(n);}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0;}));}broadcast(t,e,r){Vt(this.actors,((r,n)=>{r.send(t,e,n);}),r=r||function(){});}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove();})),this.actors=[],this.workerPool.release(this.id);}}let Vd,Cd;function Fd(){return Vd||(Vd=new Td),Vd}Bd.Actor=Ed;class Dd{constructor(t){this.module=t;}createIntArray(t){const e=new Int32Array(t),r=this.module.malloc(e.length*e.BYTES_PER_ELEMENT);return this.module.heap32.set(e,r/e.BYTES_PER_ELEMENT),r}createFloatArray(t){const e=new Float32Array(t),r=this.module.malloc(e.length*e.BYTES_PER_ELEMENT);return this.module.heapF32.set(e,r/e.BYTES_PER_ELEMENT),r}createStringBuffer(t){const e=this.module.malloc(t.length+1);for(let r=0;r<t.length;++r)this.module.heapU8[e+r]=t.charCodeAt(r);return this.module.heapU8[e+t.length]=0,e}readStringBuffer(t){let e="";for(;0!==this.module.heapU8[t];)e+=String.fromCharCode(this.module.heapU8[t]),++t;return e}setStyle(t){const e=t.entranceColorRgb,r=t.facadeGlazingColorRgb,n=t.roofColorRgb,i=t.wallColorRgb,s=t.normalScale;this.module.setStyle(e[0],e[1],e[2],r[0],r[1],r[2],n[0],n[1],n[2],i[0],i[1],i[2],s[0],s[1],s[2],t.tileToMeters);}setAOOptions(t,e){this.module.setAOOptions(t?1:0,e);}setMetricOptions(t,e){this.module.setMetricOptions(t?1:0,e);}setStructuralOptions(t){this.module.setStructuralOptions(t?1:0);}setFacadeOptions(t,e){this.module.setFacadeOptions(t,e?1:0);}setFauxFacadeOptions(t,e,r){this.module.setFauxFacadeOptions(t?1:0,e?1:0,r);}setFacadeClassifierOptions(t){this.module.setFacadeClassifierOptions(t);}generateMesh(t,e){for(const e of t){const t=this.createStringBuffer(e.roofType),r=[0],n=[];for(const t of e.coordinates)if(Array.isArray(t)){for(const e of t)n.push(e.x),n.push(e.y);r.push(n.length);}const i=this.createIntArray(r),s=this.createFloatArray(n);this.module.addFeature(e.id,e.sourceId,e.minHeight,e.height,t,e.roofType.length,s,i,r.length-1),this.module.free(t),this.module.free(i),this.module.free(s);}for(const t of e){let e;e=t.entrances?JSON.parse(t.entrances):[];const r=this.createFloatArray(e),n=[];for(const e of t.coordinates)n.push(e.x),n.push(e.y);const i=this.createFloatArray(n);this.module.addFacade(t.sourceId,t.crossPerc,t.distanceToRoad,r,e.length,i,n.length),this.module.free(r),this.module.free(i);}if(!this.module.generateMesh()){const t=this.module.getLastError();return this.readStringBuffer(t)}const r=this.module.getMeshCount(),n=new Array(r);for(let t=0;t<r;t++){const e=this.module.getPositionsPtr(t),r=this.module.getPositionsLength(t),i=new Float32Array(this.module.heapF32.buffer,e,r),s=this.module.getNormalsPtr(t),o=this.module.getNormalsLength(t),a=new Float32Array(this.module.heapF32.buffer,s,o),l=this.module.getColorsPtr(t),u=this.module.getColorsLength(t),c=new Uint8Array(this.module.heapU8.buffer,l,u),h=this.module.getAOPtr(t),p=this.module.getAOLength(t),d=new Float32Array(this.module.heapF32.buffer,h,p),f=this.module.getUVPtr(t),m=this.module.getUVLength(t),y=new Float32Array(this.module.heapF32.buffer,f,m),g=this.module.getFauxFacadePtr(t),x=this.module.getFauxFacadeLength(t),v=new Uint8Array(this.module.heapU8.buffer,g,x),b=this.module.getIndicesPtr(t),w=this.module.getIndicesLength(t),_=new Int32Array(this.module.heap32.buffer,b,w),A=this.module.getBuildingPart(t),M=this.readStringBuffer(A);n[t]={positions:i,normals:a,colors:c,ao:d,uv:y,isFauxFacade:v,indices:_,buildingPart:M};}const i=this.module.getRingCount(),s=[];for(let t=0;t<i;t++){const e=this.module.getRingPtr(t),r=this.module.getRingLength(t),n=new Float32Array(this.module.heapF32.buffer,e,r);s.push(n);}return {meshes:n,modifiedPolygonRings:s}}}let Ld,Rd,Od,Ud,Nd,jd=null,$d=null,Gd=null,Hd=null;function qd(){return Zt(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Rd||ne.DRACO_URL}function Xd(){if(Zt(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ud)return Ud;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ud=WebAssembly.validate(t)?ne.MESHOPT_SIMD_URL:ne.MESHOPT_URL,Ud}function Zd(){return Hd}const Wd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Yd={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Kd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Jd(t,e,r){const n=r.json.bufferViews.length,i=r.buffers.length;e.bufferView=n,r.json.bufferViews[n]={buffer:i,byteLength:t.byteLength},r.buffers[i]=t;}const Qd="KHR_draco_mesh_compression";function tf(t,e){const r=t.extensions&&t.extensions[Qd];if(!r)return;const n=new Od.Decoder,i=lf(e,r.bufferView),s=new Od.Mesh;if(!n.DecodeArrayToMesh(i,i.byteLength,s))throw new Error("Failed to decode Draco mesh");const o=e.json.accessors[t.indices],a=Wd[o.componentType],l=o.count*a.BYTES_PER_ELEMENT,u=Od._malloc(l);a===Uint16Array?n.GetTrianglesUInt16Array(s,l,u):n.GetTrianglesUInt32Array(s,l,u),Jd(Od.memory.buffer.slice(u,u+l),o,e),Od._free(u);for(const i of Object.keys(r.attributes)){const o=n.GetAttributeByUniqueId(s,r.attributes[i]),a=e.json.accessors[t.attributes[i]],l=Yd[a.componentType],u=a.count*Kd[a.type]*Wd[a.componentType].BYTES_PER_ELEMENT,c=Od._malloc(u);n.GetAttributeDataArrayForAllPoints(s,o,Od[l],u,c),Jd(Od.memory.buffer.slice(c,c+u),a,e),Od._free(c);}n.destroy(),s.destroy(),delete t.extensions[Qd];}const ef="EXT_meshopt_compression";function rf(t,e){if(!t.extensions||!t.extensions[ef])return;const r=t.extensions[ef],n=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),i=new Uint8Array(r.count*r.byteStride);Nd.decodeGltfBuffer(i,r.count,r.byteStride,n,r.mode,r.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=i.buffer,delete t.extensions[ef];}const nf=1179937895,sf=new TextDecoder("utf8");function of(t,e){return new URL(t,e).href}function af(t,e,r,n){return fetch(of(t.uri,n)).then((t=>t.arrayBuffer())).then((t=>{e.buffers[r]=t;}))}function lf(t,e){const r=t.json.bufferViews[e];return new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function uf(t,e,r,n){if(t.uri){const i=of(t.uri,n);return fetch(i).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((t=>{e.images[r]=t;}))}if(void 0!==t.bufferView){const n=lf(e,t.bufferView),i=new Blob([n],{type:t.mimeType});return createImageBitmap(i).then((t=>{e.images[r]=t;}))}}function cf(t,e=0,r){const n={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===nf){const r=new Uint32Array(t,e);let i=2;const s=(r[i++]>>2)-3,o=r[i++]>>2;if(i++,n.json=JSON.parse(sf.decode(r.subarray(i,i+o))),i+=o,i<s){const s=r[i++];i++;const o=e+(i<<2);n.buffers[0]=t.slice(o,o+s);}}else n.json=JSON.parse(sf.decode(new Uint8Array(t,e)));const{buffers:i,images:s,meshes:o,extensionsUsed:a,bufferViews:l}=n.json;let u=Promise.resolve();if(i){const t=[];for(let e=0;e<i.length;e++){const s=i[e];s.uri?t.push(af(s,n,e,r)):n.buffers[e]||(n.buffers[e]=null);}u=Promise.all(t);}return u.then((()=>{const t=[],e=a&&a.includes(Qd),i=a&&a.includes(ef);if(e&&t.push(function(){if(!Od)return null!=Ld?Ld:(Ld=function(t){let e,r=null;function n(){e=new Uint8Array(r.buffer);}function i(){throw new Error("Unexpected Draco error.")}const s={a:{a:i,d:function(t,r,n){return e.copyWithin(t,r,r+n)},c:function(t){const i=e.length,s=Math.max(t>>>0,Math.ceil(1.2*i)),o=Math.ceil((s-i)/65536);try{return r.grow(o),n(),!0}catch(t){return !1}},b:i}};return (WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(t,s):t.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,s)))).then((t=>{const{Rb:i,Qb:s,P:o,T:a,X:l,Ja:u,La:c,Qa:h,Va:p,Wa:d,eb:f,jb:m,f:y,e:g,yb:x,zb:v,Ab:b,Bb:w,Db:_,Gb:A}=t.instance.exports;r=g;const M=(()=>{let t=0,r=0,n=0,o=0;return a=>{n&&(i(o),i(t),r+=n,n=t=0),t||(r+=128,t=s(r));const l=a.length+7&-8;let u=t;l>=r&&(n=l,u=o=s(l));for(let t=0;t<a.length;t++)e[u+t]=a[t];return u}})();return n(),y(),{memory:g,_free:i,_malloc:s,Mesh:class{constructor(){this.ptr=o();}destroy(){a(this.ptr);}},Decoder:class{constructor(){this.ptr=u();}destroy(){m(this.ptr);}DecodeArrayToMesh(t,e,r){const n=M(t),i=c(this.ptr,n,e,r.ptr);return !!l(i)}GetAttributeByUniqueId(t,e){return {ptr:h(this.ptr,t.ptr,e)}}GetTrianglesUInt16Array(t,e,r){p(this.ptr,t.ptr,e,r);}GetTrianglesUInt32Array(t,e,r){d(this.ptr,t.ptr,e,r);}GetAttributeDataArrayForAllPoints(t,e,r,n,i){f(this.ptr,t.ptr,e.ptr,r,n,i);}},DT_INT8:x(),DT_UINT8:v(),DT_INT16:b(),DT_UINT16:w(),DT_UINT32:_(),DT_FLOAT32:A()}}))}(fetch(qd())),Ld.then((t=>{Od=t,Ld=void 0;})))}()),i&&t.push(function(){if(Nd)return;const t=function(t){let e;const r=WebAssembly.instantiateStreaming(t,{}).then((t=>{e=t.instance,e.exports.__wasm_call_ctors();})),n={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},i={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return {ready:r,supported:!0,decodeGltfBuffer(t,r,s,o,a,l){!function(t,e,r,n,i,s,o){const a=t.exports.sbrk,l=n+3&-4,u=a(l*i),c=a(s.length),h=new Uint8Array(t.exports.memory.buffer);h.set(s,c);const p=e(u,n,i,c,s.length);if(0===p&&o&&o(u,l,i),r.set(h.subarray(u,u+n*i)),a(u-a(0)),0!==p)throw new Error(`Malformed buffer data: ${p}`)}(e,e.exports[i[a]],t,r,s,o,e.exports[n[l]]);}}}(fetch(Xd()));return t.ready.then((()=>{Nd=t;}))}()),s)for(let e=0;e<s.length;e++)t.push(uf(s[e],n,e,r));return (t.length?Promise.all(t):Promise.resolve()).then((()=>{if(e&&o)for(const{primitives:t}of o)for(const e of t)tf(e,n);if(i&&o&&l)for(const t of l)rf(t,n);return n}))}))}function hf(t){switch(t){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function pf(t){switch(t){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class df{constructor(t,e,r,n){this.context=t,this.format=r,this.useMipmap=n&&n.useMipmap,this.texture=t.gl.createTexture(),this.update(e,{premultiply:n&&n.premultiply});}update(t,e){const r=t&&t instanceof HTMLVideoElement&&0===t.width?t.videoWidth:t.width,n=t&&t instanceof HTMLVideoElement&&0===t.height?t.videoHeight:t.height,{context:i}=this,{gl:s}=i,{x:o,y:a}=e&&e.position?e.position:{x:0,y:0},l=o+r,u=a+n;!this.size||this.size[0]===l&&this.size[1]===u||(s.bindTexture(s.TEXTURE_2D,null),s.deleteTexture(this.texture),this.texture=s.createTexture(),this.size=null),s.bindTexture(s.TEXTURE_2D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA8&&(!e||!1!==e.premultiply));const c=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&l>0&&u>0){const t=this.useMipmap?Math.floor(Math.log2(Math.max(l,u)))+1:1;s.texStorage2D(s.TEXTURE_2D,t,this.format,l,u),this.size=[l,u];}if(this.size)if(c)s.texSubImage2D(s.TEXTURE_2D,0,o,a,hf(this.format),pf(this.format),t);else {const e=t.data;e&&s.texSubImage2D(s.TEXTURE_2D,0,o,a,r,n,hf(this.format),pf(this.format),e);}this.useMipmap&&s.generateMipmap(s.TEXTURE_2D);}bind(t,e,r=!1){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),t!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap&&!r?t===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),e!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrapS=e);}bindExtraParam(t,e,r,n,i){const{context:s}=this,{gl:o}=s;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),this.magFilter=e),t!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?t===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),r!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r),this.wrapS=r),n!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,n),this.wrapT=n),i!==this.compareMode&&(i?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_FUNC,i)):o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_MODE,o.NONE),this.compareMode=i);}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null;}}class ff{constructor(t,e){this.context=t,this.texture=e;}bind(t,e){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrapS=e);}}const mf=ea([{name:"a_pos_3f",components:3,type:"Float32"}]),yf=ea([{name:"a_color_3f",components:3,type:"Float32"}]),gf=ea([{name:"a_color_4f",components:4,type:"Float32"}]),xf=ea([{name:"a_uv_2f",components:2,type:"Float32"}]),vf=ea([{name:"a_normal_3f",components:3,type:"Float32"}]),bf=ea([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),wf=ea([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function _f(t,e){const r=Mf(t.projection,t.zoom,t.width,t.height),n=function(t,e,r,n,i){const s=new Xl(r.lng-180*If,r.lat),o=new Xl(r.lng+180*If,r.lat),a=t.project(s.lng,s.lat),u=t.project(o.lng,o.lat),h=-Math.atan2(u.y-a.y,u.x-a.x),d=uu.fromLngLat(r);d.y=zt(d.y,-1+If,1-If);const f=d.toLngLat(),y=t.project(f.lng,f.lat),g=uu.fromLngLat(f);g.x+=If;const x=g.toLngLat(),v=t.project(x.lng,x.lat),b=Pf(v.x-y.x,v.y-y.y,h),w=uu.fromLngLat(f);w.y+=If;const _=w.toLngLat(),A=t.project(_.lng,_.lat),M=Pf(A.x-y.x,A.y-y.y,h),I=Math.abs(b.x)/Math.abs(M.y),S=l([]);m(S,S,-h*(1-(i?0:n)));const P=l([]);return p(P,P,[1,1-(1-I)*n,1]),P[4]=-M.x/M.y*n,m(P,P,h),c(P,S,P),P}(t.projection,0,t.center,r,e),i=Af(t);return p(n,n,[i,i,1]),n}function Af(t){const e=t.projection,r=Mf(t.projection,t.zoom,t.width,t.height),n=Sf(e,t.center),i=Sf(e,Xl.convert(e.center));return Math.pow(2,n*r+(1-r)*i)}function Mf(t,e,r,n,i=1/0){const s=t.range;if(!s)return 0;const o=Math.min(i,Math.max(r,n)),a=Math.log(o/1024)/Math.LN2;return Tt(s[0]+a,s[1]+a,e)}const If=1/4e4;function Sf(t,e){const r=zt(e.lat,-iu,iu),n=new Xl(e.lng-180*If,r),i=new Xl(e.lng+180*If,r),s=t.project(n.lng,r),o=t.project(i.lng,r),a=uu.fromLngLat(n),l=uu.fromLngLat(i),u=o.x-s.x,c=o.y-s.y,h=l.x-a.x,p=l.y-a.y,d=Math.sqrt((h*h+p*p)/(u*u+c*c));return Math.log(d)/Math.LN2}function Pf(t,e,r){const n=Math.cos(r),i=Math.sin(r);return {x:t*n-e*i,y:t*i+e*n}}function Ef(t,e,r){l(t),m(t,t,Mt(e[2])),d(t,t,Mt(e[0])),f(t,t,Mt(e[1])),p(t,t,r),c(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1]);}function kf(t,e,r,n,i,s,o,a){const l=[r[0]-e[0],r[1]-e[1],0],u=[n[0]-e[0],n[1]-e[1],0];if(_(l)<1e-12||_(u)<1e-12)return J(t);const c=L([],l,u);F(c,c),S(u,n,e),l[2]=(s-i)*a,u[2]=(o-i)*a;const h=l;return L(h,l,u),F(h,h),st(t,c,h)}function zf(t,e,r=!1){const n=Gc(e.zoom),i=function(t,e,r){const n=e.worldSize,i=[t[12],t[13],t[14]],s=ru(i[1]/n),o=eu(i[0]/n),a=l([]),u=tu(1,s)*n,d=tu(1,0)*n*ou(s,e.zoom),f=1/Nc(n);let m=d*f;if(r){const t=Mf(e.projection,e.zoom,e.width,e.height,1024);m=f*e.projection.pixelSpaceConversion(e.center.lat,n,t);}const y=Gl(s,o);I(y,y,z([],F([],y),u*m*i[2]));const g=function(t){const e=[t[0],t[1],t[2]];let r=[0,1,0];const n=L([],r,e);return L(r,e,n),0===V(r)&&(r=[0,1,0],L(n,e,r)),F(n,n),F(r,r),F(e,e),[n[0],n[1],n[2],0,r[0],r[1],r[2],0,e[0],e[1],e[2],0,t[0],t[1],t[2],1]}(y);p(a,a,[m,m,m*u]),h(a,a,[-i[0],-i[1],-i[2]]);const x=c([],e.globeMatrix,g);return c(x,x,a),c(x,x,t),x}(t,e,r);if(n>0){const r=function(t,e){const r=e.worldSize,n=tu(1,0)*r*ou(e.center.lat,e.zoom)/Nc(r),i=tu(1,e.center.lat)*r,s=l([]);return f(s,s,Mt(e.center.lng)),d(s,s,Mt(e.center.lat)),h(s,s,[0,0,Fl]),p(s,s,[n,n,n*i]),h(s,s,[e.point.x-.5*r,e.point.y-.5*r,0]),c(s,s,t),c(s,e.globeMatrix,s)}(t,e);return function(t,e,r){const n=(t,e,r)=>{const n=_(t),i=_(e),s=Tc(t,e,r);return z(s,s,1/_(s)*ur(n,i,r))},i=n([t[0],t[1],t[2]],[e[0],e[1],e[2]],r),s=n([t[4],t[5],t[6]],[e[4],e[5],e[6]],r),o=n([t[8],t[9],t[10]],[e[8],e[9],e[10]],r),a=Tc([t[12],t[13],t[14]],[e[12],e[13],e[14]],r);return [i[0],i[1],i[2],0,s[0],s[1],s[2],0,o[0],o[1],o[2],0,a[0],a[1],a[2],1]}(i,r,n)}return i}function Tf(t,e,r,n){const i=Nu.projectAabbCorners(n,r);let s=Number.MAX_VALUE,o=-1;for(let t=0;t<i.length;++t){const r=i[t];r[0]=(.5*r[0]+.5)*e.width,r[1]=(.5-.5*r[1])*e.height,r[2]<s&&(o=t,s=r[2]);}const a=t=>new bt(i[t][0],i[t][1]);let l;switch(o){case 0:case 6:l=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:l=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:l=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:l=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)];}if(Xu(t,l))return s}const Bf=64,Vf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Cf(t,e,r,n,i,s,o,a,u,d=!1){const f=r.zoom,m=r.project(n),y=ou(n.lat,f),g=1/y;l(t),h(t,t,[m.x+o[0]*g,m.y+o[1]*g,o[2]]);let v=1,b=1;const w=r.worldSize;if(d){if("mercator"===r.projection.name){let t=0;r.elevation&&(t=r.elevation.getAtPointOrZero(new uu(m.x/w,m.y/w),0));const e=Y([],[m.x,m.y,t,1],r.projMatrix)[3]/r.cameraToCenterDistance;v=e,b=e*ou(r.center.lat,f);}else if("globe"===r.projection.name){const e=zf(t,r),i=[0,0,0,1];Y(i,i,c([],r.projMatrix,e));const s=i[3]/r.cameraToCenterDistance,o=Gc(f),a=r.projection.pixelsPerMeter(n.lat,w)*ou(n.lat,f),l=r.projection.pixelsPerMeter(r.center.lat,w)*ou(r.center.lat,f);v=s/ur(a,su(r.center.lat),o),b=s*y/a,v*=l,b*=l;}}else v=g;p(t,t,[v,v,b]);const _=[...t],A=e.orientation,M=[];if(Ef(M,[A[0]+i[0],A[1]+i[1],A[2]+i[2]],s),c(t,_,M),a&&r.elevation){let i=0;const s=[];if(u&&r.elevation){i=function(t,e,r,n,i){const s=e.elevation;if(!s)return 0;const o=Nu.projectAabbCorners(r,n),a=tu(1,i.lat)*e.worldSize,l=function(t,e){const r=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const i of n){const n=t[i.corners[0]],s=t[i.corners[1]],o=t[i.corners[2]],a=[s[0]-n[0],s[1]-n[1],e*(s[2]-n[2])],l=L(a,a,[o[0]-n[0],o[1]-n[1],e*(o[2]-n[2])]);F(l,l),i.dotProductWithUp=D(l,r);}return n.sort(((t,e)=>t.dotProductWithUp-e.dotProductWithUp)),n[0].corners}(o,a),u=o[l[0]],c=o[l[1]],h=o[l[2]],p=o[l[3]],d=s.getAtPointOrZero(new uu(u[0]/e.worldSize,u[1]/e.worldSize),0),f=s.getAtPointOrZero(new uu(c[0]/e.worldSize,c[1]/e.worldSize),0),m=s.getAtPointOrZero(new uu(h[0]/e.worldSize,h[1]/e.worldSize),0),y=s.getAtPointOrZero(new uu(p[0]/e.worldSize,p[1]/e.worldSize),0),g=(d+y)/2,x=(f+m)/2;return g>x?f<m?kf(t,c,p,u,f,y,d,a):kf(t,h,u,p,m,d,y,a):d<y?kf(t,u,c,h,d,f,m,a):kf(t,p,h,c,y,m,f,a),Math.max(g,x)}(s,r,e.aabb,t,n);const o=c([],x([],s),M);c(t,_,o);}else i=r.elevation.getAtPointOrZero(new uu(m.x/w,m.y/w),0);0!==i&&(t[14]+=i);}}function Ff(t,e,r=!1){t.uploaded||(t.gfxTexture=new df(e,t.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null);}function Df(t,e,r){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,mf.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,vf.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,xf.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?yf:gf).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,wf.members,!0)),t.segments=el.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const n=t.material;n.pbrMetallicRoughness.baseColorTexture&&Ff(n.pbrMetallicRoughness.baseColorTexture,e),n.pbrMetallicRoughness.metallicRoughnessTexture&&Ff(n.pbrMetallicRoughness.metallicRoughnessTexture,e),n.normalTexture&&Ff(n.normalTexture,e),n.occlusionTexture&&Ff(n.occlusionTexture,e,r),n.emissionTexture&&Ff(n.emissionTexture,e);}function Lf(t,e,r){if(t.meshes)for(const n of t.meshes)Df(n,e,r);if(t.children)for(const n of t.children)Lf(n,e,r);}function Rf(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Rf(e);}function Of(t){if(t.meshes)for(const r of t.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const e of t.children)Of(e);}function Uf(t,e){const r=t.json.bufferViews[e.bufferView],n=Wd[e.componentType];return new n(t.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Kd[e.type]*n.BYTES_PER_ELEMENT?r.byteStride/n.BYTES_PER_ELEMENT:Kd[e.type]))}function Nf(t,e,r,n){const i=Wd[e.componentType],s=function(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(i),o=t.json.bufferViews[e.bufferView],a=o.byteStride?o.byteStride/i.BYTES_PER_ELEMENT:Kd[e.type],l=r.float32,u=l.length/r.capacity;for(let t=0,r=0;t<e.count*a;t+=a,r+=u)for(let e=0;e<u;e++)l[r+e]=n[t+e]*s;r._trim();}function jf(t,e,r){const n=t.indices,i=t.attributes,s={};s.indexArray=new Ma;const o=e.json.accessors[n],a=o.count/3;s.indexArray.reserve(a);const l=Uf(e,o);for(let t=0;t<a;t++)s.indexArray.emplaceBack(l[3*t],l[3*t+1],l[3*t+2]);s.indexArray._trim(),s.vertexArray=new ha;const u=e.json.accessors[i.POSITION];s.vertexArray.reserve(u.count);const c=Uf(e,u);for(let t=0;t<u.count;t++)s.vertexArray.emplaceBack(c[3*t],c[3*t+1],c[3*t+2]);if(s.vertexArray._trim(),s.aabb=new Nu(u.min,u.max),s.centroid=function(t,e){const r=[0,0,0],n=t.length;if(n>0){for(let i=0;i<n;i++){const n=3*t[i];r[0]+=e[n],r[1]+=e[n+1],r[2]+=e[n+2];}r[0]/=n,r[1]/=n,r[2]/=n;}return r}(l,c),void 0!==i.COLOR_0){const t=e.json.accessors[i.COLOR_0],r=Kd[t.type],n=Uf(e,t);s.colorArray=3===r?new ha:new ga,s.colorArray.resize(t.count),Nf(e,t,s.colorArray,n);}if(void 0!==i.NORMAL){s.normalArray=new ha;const t=e.json.accessors[i.NORMAL];s.normalArray.resize(t.count);const r=Uf(e,t);Nf(e,t,s.normalArray,r);}if(void 0!==i.TEXCOORD_0&&r.length>0){s.texcoordArray=new Ba;const t=e.json.accessors[i.TEXCOORD_0];s.texcoordArray.resize(t.count);const r=Uf(e,t);Nf(e,t,s.texcoordArray,r);}if(void 0!==i._FEATURE_ID_RGBA4444){const t=e.json.accessors[i._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(s.featureData=Uf(e,t));}void 0!==i._FEATURE_RGBA4444&&(s.featureData=new Uint32Array(Uf(e,e.json.accessors[i._FEATURE_RGBA4444]).buffer));const h=t.material;return s.material=function(t,e){const{emissiveFactor:r=[0,0,0],alphaMode:n="OPAQUE",alphaCutoff:i=.5,normalTexture:s,occlusionTexture:o,emissiveTexture:a,doubleSided:l}=t,{baseColorFactor:u=[1,1,1,1],metallicFactor:c=1,roughnessFactor:h=1,baseColorTexture:p,metallicRoughnessTexture:d}=t.pbrMetallicRoughness||{},f=o?e[o.index]:void 0;if(o&&o.extensions&&o.extensions.KHR_texture_transform&&f){const t=o.extensions.KHR_texture_transform;f.offsetScale=[t.offset[0],t.offset[1],t.scale[0],t.scale[1]];}return {pbrMetallicRoughness:{baseColorFactor:new sr(...u),metallicFactor:c,roughnessFactor:h,baseColorTexture:p?e[p.index]:void 0,metallicRoughnessTexture:d?e[d.index]:void 0},doubleSided:l,emissiveFactor:new sr(...r),alphaMode:n,alphaCutoff:i,normalTexture:s?e[s.index]:void 0,occlusionTexture:f,emissionTexture:a?e[a.index]:void 0,defined:void 0===t.defined}}(void 0!==h?e.json.materials[h]:{defined:!1},r),s}function $f(t,e,r){const{matrix:n,rotation:i,translation:s,scale:o,mesh:a,extras:l,children:u}=t,c={};if(c.matrix=n||function(t,e,r,n){var i=e[0],s=e[1],o=e[2],a=e[3],l=i+i,u=s+s,c=o+o,h=i*l,p=i*u,d=i*c,f=s*u,m=s*c,y=o*c,g=a*l,x=a*u,v=a*c,b=n[0],w=n[1],_=n[2];return t[0]=(1-(f+y))*b,t[1]=(p+v)*b,t[2]=(d-x)*b,t[3]=0,t[4]=(p-v)*w,t[5]=(1-(h+y))*w,t[6]=(m+g)*w,t[7]=0,t[8]=(d+x)*_,t[9]=(m-g)*_,t[10]=(1-(h+f))*_,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}([],i||[0,0,0,1],s||[0,0,0],o||[1,1,1]),void 0!==a){c.meshes=r[a];const t=c.anchor=[0,0];for(const e of c.meshes){const{min:r,max:n}=e.aabb;t[0]+=r[0]+n[0],t[1]+=r[1]+n[1];}t[0]=Math.floor(t[0]/c.meshes.length/2),t[1]=Math.floor(t[1]/c.meshes.length/2);}if(l&&(l.id&&(c.id=l.id),l.lights&&(c.lights=function(t){if(!t.length)return [];const e=function(t){const e=atob(t),r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.codePointAt(t);return r}(t),r=[],n=e.length/24,i=new Uint16Array(e.buffer),s=new Float32Array(e.buffer);for(let t=0;t<n;t++){const e=i[2*t*6]/30,n=i[2*t*6+1]/30,o=i[2*t*6+10]/100,a=s[6*t+1],l=s[6*t+2],u=s[6*t+3],c=s[6*t+4],h=u-a,p=c-l,d=Math.hypot(h,p);r.push({pos:[a+.5*h,l+.5*p,n],normal:[p/d,-h/d,0],width:d,height:e,depth:o,points:[a,l,u,c]});}return r}(l.lights))),u){const t=[];for(const n of u)t.push($f(e.json.nodes[n],e,r));c.children=t;}return c}function Gf(t){if(0===t.vertices.length||0===t.indices.length)return null;const e=new fp(t.vertices,t.indices,8,256),[r,n]=[e.min.clone(),e.max.clone()];return {vertices:t.vertices,indices:t.indices,grid:e,min:r,max:n}}function Hf(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const r=e[0];if(!r||!Array.isArray(r)||0===r.length)return null;const n=[];for(const t of r){if(!Array.isArray(t)||2!==t.length)continue;const e=t[0],r=t[1];"number"==typeof e&&"number"==typeof r&&n.push(new bt(e,r));}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let i=0;for(let t=0;t<n.length;t++){const e=n[t],r=n[(t+1)%n.length],s=n[(t+2)%n.length];i+=(e.x-r.x)*(s.y-r.y)-(s.x-r.x)*(e.y-r.y);}i>0&&n.reverse();const s=vh(n.flatMap((t=>[t.x,t.y])),[]);return 0===s.length?null:{vertices:n,indices:s}}function qf(t,e){const r=[],n=[];let i=0;const s=[];for(const o of t){i=r.length;const t=o.vertexArray.float32,a=o.indexArray.uint16;for(let n=0;n<o.vertexArray.length;n++)s[0]=t[3*n+0],s[1]=t[3*n+1],s[2]=t[3*n+2],O(s,s,e),r.push(new bt(s[0],s[1]));for(let t=0;t<3*o.indexArray.length;t++)n.push(a[t]+i);}if(n.length%3!=0)return null;for(let t=0;t<n.length;t+=3){const e=r[n[t+0]],i=r[n[t+1]],s=r[n[t+2]];(e.x-i.x)*(s.y-i.y)-(s.x-i.x)*(e.y-i.y)>0&&([n[t+1],n[t+2]]=[n[t+2],n[t+1]]);}return {vertices:r,indices:n}}function Xf(t){const e=function(t,e){const r=[],n=WebGL2RenderingContext;if(t.json.textures)for(const i of t.json.textures){const s={magFilter:n.LINEAR,minFilter:n.NEAREST,wrapS:n.REPEAT,wrapT:n.REPEAT};void 0!==i.sampler&&Object.assign(s,t.json.samplers[i.sampler]),r.push({image:e[i.source],sampler:s,uploaded:!1});}return r}(t,t.images),r=function(t,e){const r=[];for(const n of t.json.meshes){const i=[];for(const r of n.primitives)i.push(jf(r,t,e));r.push(i);}return r}(t,e),{scenes:n,scene:i,nodes:s}=t.json,o=n?n[i||0].nodes:s,a=[];for(const e of o)a.push($f(s[e],t,r));return function(t,e,r){const n={},i=new Set;for(let s=0;s<t.length;s++){const t=r[e[s]];if(!t.extras)continue;const o=t.extras["mapbox:footprint:version"],a=t.extras["mapbox:footprint:id"];(o||a)&&i.add(s),"1.0.0"===o&&a&&(n[a]=s);}for(let s=0;s<t.length;s++){if(i.has(s))continue;const o=t[s],a=r[e[s]];if(!a.extras)continue;let l=null;o.id in n&&(l=qf(t[n[o.id]].meshes,o.matrix)),l||(l=Hf(a)),l&&(o.footprint=Gf(l));}if(i.size>0){const e=Array.from(i.values()).sort(((t,e)=>t-e));for(let r=e.length-1;r>=0;r--)t.splice(e[r],1);}}(a,o,t.json.nodes),a}function Zf(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,r=t.aabb.min[0]-1,n=t.aabb.min[1]-1,i=Bf/(t.aabb.max[0]-r+2),s=Bf/(t.aabb.max[1]-n+2);for(let o=0;o<e.length;o+=3){const a=e[o+2],l=(e[o+0]-r)*i|0,u=(e[o+1]-n)*s|0;a>t.heightmap[u*Bf+l]&&(t.heightmap[u*Bf+l]=a);}}function Wf(t,e,r,n,i){r.reserve(r.length+4*t.length),n.reserve(n.length+10*t.length),i.reserve(i.length+10*t.length);let s=n.length;for(const o of t){const t=Math.min(10,Math.max(4,1.3*o.height))*e,a=[-o.normal[1],o.normal[0],0],l=Math.min(.29,.1*o.width/o.depth),u=o.width-2*o.depth*e*(l+.01),c=T([],o.pos,a,u/2),h=T([],o.pos,a,-u/2),p=[c[0],c[1],c[2]+o.height],d=[h[0],h[1],h[2]+o.height],f=T([],o.normal,a,l);z(f,f,t);const m=T([],o.normal,a,-l);z(m,m,t),I(f,c,f),I(m,h,m),c[2]+=.1,h[2]+=.1,n.emplaceBack(f[0],f[1],f[2]),n.emplaceBack(m[0],m[1],m[2]),n.emplaceBack(c[0],c[1],c[2]),n.emplaceBack(h[0],h[1],h[2]),n.emplaceBack(p[0],p[1],p[2]),n.emplaceBack(d[0],d[1],d[2]),n.emplaceBack(c[0],c[1],c[2]),n.emplaceBack(h[0],h[1],h[2]),n.emplaceBack(f[0],f[1],f[2]),n.emplaceBack(m[0],m[1],m[2]);const y=u/t/2;i.emplaceBack(-y-l,-1,y,.8),i.emplaceBack(y+l,-1,y,.8),i.emplaceBack(-y,0,y,1.3),i.emplaceBack(y,0,y,1.3),i.emplaceBack(y+l,-.8,y,.7),i.emplaceBack(y+l,-.8,y,.7),i.emplaceBack(0,0,y,1.3),i.emplaceBack(0,0,y,1.3),i.emplaceBack(y+l,-1.2,y,.8),i.emplaceBack(y+l,-1.2,y,.8),r.emplaceBack(6+s,4+s,8+s),r.emplaceBack(7+s,9+s,5+s),r.emplaceBack(0+s,1+s,2+s),r.emplaceBack(1+s,3+s,2+s),s+=10;}}function Yf(t,e){const r={};r.indexArray=new Ma,r.vertexArray=new ha,r.colorArray=new ga,Wf(t,e,r.indexArray,r.vertexArray,r.colorArray);const n={defined:!0};n.emissiveFactor=sr.black;const i={};return i.baseColorFactor=sr.white,n.pbrMetallicRoughness=i,r.material=n,r.aabb=new Nu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const Kf=ea([{name:"a_pos_3f",components:3,type:"Float32"}]),Jf=ea([{name:"a_normal_3",components:3,type:"Int16"}]),Qf=ea([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),tm=ea([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),em=vu.types,rm=32767;function nm(t,e){const r=Cn+e;for(const n of t)for(const t of n)if(t.x<-e||t.x>r||t.y<-e||t.y>r)return !1;return !0}class im{constructor(t){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.worldview=t.worldview,this.layoutVertexArray=new ha,this.layoutNormalArray=new ia,this.layoutColorArray=new va,this.indexArray=new Ma,this.indexArrayForConflation=new Ma,this.entranceBloom={layoutVertexArray:new ha,layoutVertexBuffer:null,layoutAttenuationArray:new ga,layoutAttenuationBuffer:null,layoutColorArray:new va,layoutColorBuffer:null,indexArray:new Ma,indexArrayForConflation:new Ma,indexBuffer:null,segmentsBucket:new el},this.programConfigurations=new kl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segmentsBucket=new el,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.projection=t.projection,this.groundEffect=new rd(t);}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(t,e){for(const r of this.footprints)e.push({footprint:r,id:t});}prepare(){return function(){if(null!=Hd||null!=Gd)return null;if(null!=$d)return $d;const t=fetch(ne.BUILDING_GEN_URL);return $d=function(t){let e,r,n,i;function s(){e=new Uint8Array(i.buffer),r=new Int32Array(i.buffer),n=new Float32Array(i.buffer);}function o(){throw new Error("Unexpected BuildingGen error.")}const a=()=>{},l={a:{a:o,f:function(t){const r=e.length,n=Math.max(t>>>0,Math.ceil(1.2*r)),o=Math.ceil((n-r)/65536);try{return i.grow(o),s(),!0}catch(t){return !1}},g:o,b:a,c:a,d:a,e:a}};return (WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(t,l):t.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,l)))).then((t=>{const o=t.instance.exports;return (0,o.g)(),i=o.f,s(),new Dd({setStyle:o.h,setAOOptions:o.i,setMetricOptions:o.j,setStructuralOptions:o.k,setFacadeOptions:o.l,setFauxFacadeOptions:o.m,setFacadeClassifierOptions:o.n,addFeature:o.o,addFacade:o.p,generateMesh:o.q,getLastError:o.r,getMeshCount:o.s,getPositionsPtr:o.t,getPositionsLength:o.u,getNormalsPtr:o.v,getNormalsLength:o.w,getColorsPtr:o.x,getColorsLength:o.y,getAOPtr:o.z,getAOLength:o.A,getUVPtr:o.B,getUVLength:o.C,getFauxFacadePtr:o.D,getFauxFacadeLength:o.E,getIndicesPtr:o.F,getIndicesLength:o.G,getBuildingPart:o.H,getRingCount:o.I,getRingPtr:o.J,getRingLength:o.K,free:o.L,malloc:o.M,heapU8:e,heap32:r,heapF32:n})}))}(t).then((t=>($d=null,Hd=t,Hd))).catch((t=>{Gt("Could not load building-gen"),$d=null,Gd=t;})),$d}()}populate(t,e,r,n){const i=Zd();if(!i)return;const s=lu(r);this.tileToMeter=s,this.brightness=e.brightness,i.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,s],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:s,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),i.setAOOptions(!1,.3),i.setMetricOptions(!1,16),i.setStructuralOptions(!0),i.setFacadeOptions(4,!0),i.setFauxFacadeOptions(!1,!1,1),i.setFacadeClassifierOptions(3);const o=new Map;for(const{feature:e}of t){if("LineString"!==em[e.type])continue;const t=this.layers[0]._featureFilter.needGeometry,i=xu(e,t);if(!this.layers[0]._featureFilter.filter(new xo(this.zoom),i,r))continue;const s=t?i.geometry:gu(e,r,n),a=[];for(const t of s)for(const e of t)a.push({x:e.x,y:e.y});const l={coordinates:a,crossPerc:e.properties.cross_perc,distanceToRoad:e.properties.distance_to_road,entrances:e.properties.entrances,sourceId:0},u=e.properties.source_id;let c=o.get(u);c||(c=[],o.set(u,c)),c.push(l);}this.maxHeight=0;for(const{feature:s,index:a}of t){if("LineString"===em[s.type])continue;const t=this.layers[0]._featureFilter.needGeometry,l=xu(s,t);if(!this.layers[0]._featureFilter.filter(new xo(this.zoom),l,r))continue;const u=t?l.geometry:gu(s,r,n),c=Hh(u,500);if(!nm(u,163))continue;const h=this.layers[0],p=h.layout.get("building-base").evaluate(s,{},r),d=h.layout.get("building-height").evaluate(s,{},r),f=h.layout.get("building-roof-shape").evaluate(s,{},r),m=h.paint.get("building-ambient-occlusion-intensity"),y=h.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if("flat"===f)continue;const g=s.properties.source_id;let x;x=o.has(g)?o.get(g):[];const v=[],b=new bt(1/0,1/0),w=new bt(-1/0,-1/0);for(const t of c)if(t.length>0){const e=[];for(const r of t){const t=[];for(let e=r.length-1;e>=0;e--){const n=r[e];t.push({x:n.x,y:n.y}),b.x=Math.min(b.x,n.x),b.y=Math.min(b.y,n.y),w.x=Math.max(w.x,n.x),w.y=Math.max(w.y,n.y);}e.push(t);}v.push({id:s.id,height:d,minHeight:p,sourceId:0,roofType:f,coordinates:e});}const _=i.generateMesh(v,x);if("string"==typeof _)continue;if(0===_.meshes.length||0===_.modifiedPolygonRings.length)continue;let A=0;for(const t of _.meshes)A+=t.positions.length/3;const M=this.segmentsBucket.prepareSegment(A,this.layoutVertexArray,this.indexArray),I=[];let S=null,P=0,E=-1;const k=this.indexArray.length;let z=0;for(const t of _.meshes){const e=this.layoutVertexArray.length;if("entrance"===t.buildingPart){const e=new Array;for(let r=0;r<t.indices.length;r+=12){const n=t.positions[r+0],i=t.positions[r+1],s=t.positions[r+3],o=t.positions[r+4],a=t.positions[r+2],l=t.positions[r+8]-a,u=1,c=s-n,h=o-i,p=Math.hypot(c,h);e.push({pos:[n+.5*c,i+.5*h,a],normal:[h/p,-c/p,0],width:p,height:l,depth:u,points:[n,i,s,o]});}const r=this.entranceBloom.segmentsBucket.prepareSegment(10*e.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),n=this.entranceBloom.layoutVertexArray.length;P=this.entranceBloom.indexArray.length,Wf(e,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const i=this.entranceBloom.layoutVertexArray.length-n;E=this.entranceBloom.indexArray.length-P;for(let t=0;t<i;t++){const t=65535;this.entranceBloom.layoutColorArray.emplaceBack(t,t);}r.vertexLength+=i,r.primitiveLength+=E,S={part:t.buildingPart,vertexOffset:n,vertexLength:i};}for(let e=0;e<t.positions.length;e+=3)z=Math.max(z,t.positions[e+2]),this.layoutVertexArray.emplaceBack(t.positions[e],t.positions[e+1],t.positions[e+2]);for(let e=0;e<t.normals.length;e+=3)this.layoutNormalArray.emplaceBack(t.normals[e+0]*rm,t.normals[e+1]*rm,t.normals[e+2]*rm);for(let e=0;e<t.ao.length;e++)this.layoutAOArray.push(t.ao[e]);for(let e=0;e<t.colors.length;e+=3){const r=1+(t.ao[e/3]-1)*m;this.layoutColorArray.emplaceBack(t.colors[e]*r<<8|t.colors[e+1]*r,t.colors[e+2]*r<<8);}const r=M.vertexLength;for(let e=0;e<t.indices.length;e+=3)this.indexArray.emplaceBack(r+t.indices[e],r+t.indices[e+1],r+t.indices[e+2]);M.vertexLength+=t.positions.length/3,M.primitiveLength+=t.indices.length/3,("roof"===t.buildingPart||"wall"===t.buildingPart||"facade_glazing"===t.buildingPart||"entrance"===t.buildingPart)&&I.push({part:t.buildingPart,vertexOffset:e,vertexLength:t.positions.length/3});}this.maxHeight=Math.max(this.maxHeight,z),this.buildingFeatures.push({feature:l,segment:M,parts:I,buildingBloom:S});const T=this.indexArray.length-k,B=[],V=[],C=new bt(1/0,1/0),F=new bt(-1/0,-1/0),D=this.groundEffect.vertexArray.length;for(const t of _.modifiedPolygonRings){const e=[],r=new bt(1/0,1/0),n=new bt(-1/0,-1/0);for(let i=0;i<t.length;i+=2){const s=t.length-i-2;r.x=Math.min(r.x,t[s]),r.y=Math.min(r.y,t[s+1]),n.x=Math.max(n.x,t[s]),n.y=Math.max(n.y,t[s+1]);const o=new bt(t[s],t[s+1]);e.push(o),B.push(o.x,o.y),V.push(o.clone());}C.x=Math.min(C.x,r.x),C.y=Math.min(C.y,r.y),F.x=Math.max(F.x,n.x),F.y=Math.max(F.y,n.y),this.groundEffect.addData(e,[r,n],y);}const L=this.groundEffect.vertexArray.length-D;(b.x<0||w.x>Cn||b.y<0||w.y>Cn)&&this.featuresOnBorder.push({featureId:s.id,footprintIndex:this.footprints.length});{const t=vh(B,null,2),e=new fp(V,t,8,256);let r=s.id;s.properties&&s.properties.hasOwnProperty("building_id")&&(r=s.properties.building_id),this.footprints.push({vertices:V,indices:t,grid:e,min:C,max:F,buildingId:r,hiddenFlags:0,indicesOffset:k,indicesLength:T,bloomIndicesOffset:P,bloomIndicesLength:E,groundEffectVertexOffset:D,groundEffectVertexLength:L,segment:M,height:z});}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,a,{},e.availableImages,r,e.brightness),this.groundEffect.addPaintPropertiesData(s,a,{},e.availableImages,r,e.brightness);}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0]);}update(t,e,r,n,i,s,o){this.programConfigurations.updatePaintArrays(t,e,i,r,n,s,o),this.groundEffect.update(t,e,i,r,n,s,o);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kf.members),this.layoutNormalBuffer=t.createVertexBuffer(this.layoutNormalArray,Jf.members),this.entranceBloom.layoutVertexBuffer=t.createVertexBuffer(this.entranceBloom.layoutVertexArray,Kf.members),this.entranceBloom.layoutAttenuationBuffer=t.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,tm.members),this.uploadUpdatedColorBuffer(t),this.uploadUpdatedIndexBuffer(t),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy());}updateFootprintHiddenFlags(t,e,r=!0){let n=!1;const i=r?e:0,s=0|(r?-1:~e);0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of t){const t=this.footprints[e],r=t.hiddenFlags&s|i;t.hiddenFlags!==r&&(t.hiddenFlags=r,n=!0,this.groundEffect.updateHiddenByLandmarkRange(t.groundEffectVertexOffset,t.groundEffectVertexLength,0!==t.hiddenFlags));}return n&&(this.indexArrayForConflationUploaded=!1),n}uploadUpdatedIndexBuffer(t){if(this.groundEffect.uploadHiddenByLandmark(t),!this.indexArrayForConflationUploaded&&0!==this.indexArray.length){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const t of this.footprints){const e=t.indicesOffset+t.indicesLength;if(0!==t.hiddenFlags){for(let r=t.indicesOffset;r<e;r++)this.indexArrayForConflation.uint16[3*r+0]=0,this.indexArrayForConflation.uint16[3*r+1]=0,this.indexArrayForConflation.uint16[3*r+2]=0;const r=t.bloomIndicesOffset+t.bloomIndicesLength;for(let e=t.bloomIndicesOffset;e<r;e++)this.entranceBloom.indexArrayForConflation.uint16[3*e+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*e+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*e+2]=0;}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=t.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=t.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0;}}uploadUpdatedColorBuffer(t){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=t.createVertexBuffer(this.layoutColorArray,Qf.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=t.createVertexBuffer(this.entranceBloom.layoutColorArray,Qf.members,!0);}evaluate(t){const e=t.paint.get("building-ambient-occlusion-intensity");for(const r of this.buildingFeatures){const n=r.feature;n.properties["building-part"]="roof";const i=t.paint.get("building-color").evaluate(n,{},this.canonical),s=t.paint.get("building-emissive-strength").evaluate(n,{},this.canonical);n.properties["building-part"]="wall";const o=t.paint.get("building-color").evaluate(n,{},this.canonical),a=t.paint.get("building-emissive-strength").evaluate(n,{},this.canonical);n.properties["building-part"]="window";const l=t.paint.get("building-color").evaluate(n,{},this.canonical),u=t.paint.get("building-emissive-strength").evaluate(n,{},this.canonical);n.properties["building-part"]="door";const c=t.paint.get("building-color").evaluate(n,{},this.canonical),h=t.paint.get("building-emissive-strength").evaluate(n,{},this.canonical);for(const t of r.parts){let r,n=i;"roof"===t.part?(n=i,r=s):"wall"===t.part?(n=o,r=a):"facade_glazing"===t.part?(n=l,r=u):"entrance"===t.part&&(n=c,r=h),r=zt(r,0,1);for(let i=0;i<t.vertexLength;i++){const s=t.vertexOffset+i,o=1+(this.layoutAOArray[s]-1)*e;this.layoutColorArray.emplace(s,n.r*o*255<<8|n.g*o*255,n.b*o*255<<8|255*r);}}const p=r.buildingBloom;if(p)for(let t=0;t<p.vertexLength;t++)this.bloomGeometry.layoutColorArray.emplace(p.vertexOffset+t,255*c.r<<8|255*c.g,255*c.b<<8|51*h);}}needsEvaluation(t,e){const r=t.transform.projectionOptions,n=t.style.getBrightness();return !(this.uploaded&&r.name===this.projection.name&&this.brightness===n||(this.projection=r,this.brightness=n,0))}updateReplacement(t,e,r){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const n=e.getReplacementRegionsForTile(t.toUnwrapped());if(zp(this.activeReplacements,n))return;this.activeReplacements=n;for(const t of this.footprints)t.hiddenFlags&=-2;const i=[];for(const e of this.activeReplacements){if(e.order<=Ip)continue;const r=Math.max(1,Math.pow(2,e.footprintTileId.canonical.z-t.canonical.z));for(const n of this.footprints)n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y||(i.length=0,sm(n.vertices,0,n.vertices.length,e.footprintTileId.canonical,t.canonical,i),Vp(e.footprint,i,n.indices,0,n.indices.length,0,-r)&&(n.hiddenFlags|=1));}0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(t.groundEffectVertexOffset,t.groundEffectVertexLength,0!==t.hiddenFlags);this.indexArrayForConflationUploaded=!1;}getHeightAtTileCoord(t,e){let r=Number.NEGATIVE_INFINITY,n=!0;const i=4*(t+Cn)*Cn+(e+Cn);if(this.footprintLookup.hasOwnProperty(i)){const t=this.footprintLookup[i];return t?{height:t.height,hidden:0!==t.hiddenFlags}:void 0}const s=new bt(t,e);for(const o of this.footprints)t>o.max.x||o.min.x>t||e>o.max.y||o.min.y>e||o.height<=r||Dp(s,o)&&(r=o.height,this.footprintLookup[i]=o,n=0!==o.hiddenFlags);if(r!==Number.NEGATIVE_INFINITY)return {height:r,hidden:n};this.footprintLookup[i]=void 0;}}function sm(t,e,r,n,i,s){const o=Math.pow(2,n.z-i.z);for(let a=0;a<r;a++){let r=t[a+e].x,l=t[a+e].y;r=(r+i.x*Cn)*o-n.x*Cn,l=(l+i.y*Cn)*o-n.y*Cn,s.push(new bt(r,l));}}let om,am;qs(im,"BuildingBucket",{omit:["layers"]});const lm=ea([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),um=ea([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:cm}=lm,hm=ea([{name:"a_packed",components:3,type:"Float32"}]),{members:pm}=hm,dm=ea([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:fm}=dm;class mm{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new hh({width:t,height:e}),this.positions={},this.uploaded=!1;}getDash(t,e){const r=this.getKey(t,e);return this.positions[r]}trim(){const t=this.width,e=this.height=Lt(this.nextRow);this.image.resize({width:t,height:e});}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,r){const n=[];let i=t.length%2==1?-t[t.length-1]*r:0,s=t[0]*r,o=!0;n.push({left:i,right:s,isDash:o,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){o=!o;const l=t[e];i=a*r,a+=l,s=a*r,n.push({left:i,right:s,isDash:o,zeroLength:0===l});}return n}addRoundDash(t,e,r){const n=e/2;for(let e=-r;e<=r;e++){const i=this.width*(this.nextRow+r+e);let s=0,o=t[s];for(let a=0;a<this.width;a++){a/o.right>1&&(o=t[++s]);const l=Math.abs(a-o.left),u=Math.abs(a-o.right),c=Math.min(l,u);let h;const p=e/r*(n+1);if(o.isDash){const t=n-Math.abs(p);h=Math.sqrt(c*c+t*t);}else h=n-Math.sqrt(c*c+p*p);this.image.data[i+a]=Math.max(0,Math.min(255,h+128));}}}addRegularDash(t,e){for(let e=t.length-1;e>=0;--e){const r=t[e],n=t[e+1];r.zeroLength?t.splice(e,1):n&&n.isDash===r.isDash&&(n.left=r.left,t.splice(e,1));}const r=t[0],n=t[t.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const i=this.width*this.nextRow;let s=0,o=t[s];for(let r=0;r<this.width;r++){r/o.right>1&&(o=t[++s]);const n=Math.abs(r-o.left),a=Math.abs(r-o.right),l=Math.min(n,a);this.image.data[i+r]=Math.max(0,Math.min(255,(o.isDash?l:-l)+e+128));}}addDash(t,e){const r=this.getKey(t,e);if(this.positions[r])return this.positions[r];const n="round"===e,i=n?7:0,s=2*i+1;if(this.nextRow+s>this.height)return Gt("LineAtlas out of space"),null;0===t.length&&t.push(1);let o=0;for(let e=0;e<t.length;e++)t[e]<0&&(Gt("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),o+=t[e];if(0!==o){const r=this.width/o,s=this.getDashRanges(t,this.width,r);n?this.addRoundDash(s,r,i):this.addRegularDash(s,"square"===e?.5*r:0);}const a=this.nextRow+i;this.nextRow+=s;const l={tl:[a,i],br:[o,0]};return this.positions[r]=l,l}}qs(mm,"LineAtlas");const ym=vu.types,gm=Math.cos(Math.PI/180*37.5),xm=Math.cos(Math.PI/180*5);class vm{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={};})),this.layoutVertexArray=new ca,this.layoutVertexArray2=new ha,this.patternVertexArray=new ha,this.indexArray=new Ma,this.programConfigurations=new kl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new el,this.maxLineLength=0,this.zOffsetVertexArray=new ha,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.tessellationStep=t.tessellationStep?t.tessellationStep:Cn/64,this.worldview=t.worldview;}updateFootprints(t,e){}populate(t,e,r,n){this.hasPattern=Zh("line",this.layers,this.pixelRatio,e);const i=this.layers[0].layout.get("line-sort-key");this.tileToMeter=lu(r);const s=this.layers[0].layout.get("line-elevation-reference");if("hd-road-markup"===s)this.elevationType="road";else {const t=this.layers[0].layout.get("line-z-offset"),e=t.isConstant()&&!t.constantOr(0);this.elevationType="sea"!==s&&"ground"!==s&&e?"none":"offset","offset"===this.elevationType&&"none"===s&&Gt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);}const o=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope="offset"===this.elevationType&&void 0!==o;const a=[];for(const{feature:e,id:s,index:o,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,u=xu(e,t);if(!this.layers[0]._featureFilter.filter(new xo(this.zoom,{worldview:this.worldview}),u,r))continue;const c=i?i.evaluate(u,{},r):void 0,h={id:s,properties:e.properties,type:e.type,sourceLayerIndex:l,index:o,geometry:t?u.geometry:gu(e,r,n),patterns:{},sortKey:c};a.push(h);}i&&a.sort(((t,e)=>t.sortKey-e.sortKey));const{lineAtlas:l,featureIndex:u}=e,c=this.addConstantDashes(l);for(const n of a){const{geometry:i,index:s,sourceLayerIndex:o}=n;if(c&&this.addFeatureDashes(n,l),this.hasPattern){const t=Wh("line",this.layers,n,this.zoom,this.pixelRatio,e);this.patternFeatures.push(t);}else this.addFeature(n,i,s,r,l.positions,e.availableImages,e.brightness,e.elevationFeatures);u.insert(t[s].feature,i,s,o,this.index);}}addConstantDashes(t){let e=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,i=r.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==i.kind)e=!0;else {const e=i.value,r=n.value;if(!r)continue;t.addDash(r,e);}}return e}addFeatureDashes(t,e){const r=this.zoom;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===s.kind)continue;let o,a;if("constant"===i.kind){if(o=i.value,!o)continue}else o=i.evaluate({zoom:r},t);a="constant"===s.kind?s.value:s.evaluate({zoom:r},t),e.addDash(o,a),t.patterns[n.id]=[e.getKey(o,a)];}}update(t,e,r,n,i,s,o,a){this.programConfigurations.updatePaintArrays(t,e,i,r,n,s,o,a);}addFeatures(t,e,r,n,i,s){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,r,n,s);}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return !this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,pm)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,fm)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,um.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cm),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return {start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,r,n,i,s,o,a){const l=this.layers[0].layout,u=l.get("line-join").evaluate(t,{}),c=l.get("line-cap").evaluate(t,{}),h=l.get("line-miter-limit"),p=l.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=l.get("line-z-offset").value;const d=this.layers[0].paint.get("line-width").value;if("constant"!==d.kind&&!1===d.isLineProgressConstant&&(this.variableWidthValue=d),"road"===this.elevationType){const r=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(t,e,n,a,u,c,h,p)){const[i,s]=this.clipRuntimeLinesToTile(e,1);for(let e=0;e<i.length;e++){const r=i[e],o=s[e],a={progress:{min:o.progress.min,max:o.progress.max},nextDir:this.computeSegNextDir(o,r),prevDir:this.computeSegPrevDir(o,r)};this.addLine(r,t,n,u,c,h,p,a);}this.fillNonElevatedRoadSegment(r);}}else for(const r of e)this.addLine(r,t,n,u,c,h,p);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,s,n,o,void 0,this.worldview);}computeSegNextDir(t,e){return t.nextPoint.sub(e.at(-2)).unit()}computeSegPrevDir(t,e){return e[1].sub(t.prevPoint).unit()}clipLinesToTile(t,e){return bd(t,-e,-e,Cn+e,Cn+e)}clipRuntimeLinesToTile(t,e){const r=[];return [bd(t,-e,-e,Cn+e,Cn+e,r),r]}addElevatedRoadFeature(t,e,r,n,i,s,o,a){const l=[],u=Gu.getElevationFeature(t,n);if(u){const t=this.clipLinesToTile(e,1),n=this.prepareElevatedLines(t,u,r);for(const t of n)l.push({geometry:t,elevation:u,elevationTileID:r,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}});}if(0===l.length)return !1;for(const e of l){const n=this.layoutVertexArray.length;this.addLine(e.geometry,t,r,i,s,o,a);const l=new Hu(r,e.elevationTileID);if(e.elevation)for(let t=n;t<this.layoutVertexArray.length;t++){const r=new bt(this.layoutVertexArray.int16[6*t]>>1,this.layoutVertexArray.int16[6*t+1]>>1),n=l.pointElevation(r,e.elevation,.05);this.updateHeightRange(n),this.zOffsetVertexArray.emplaceBack(n,0,0);}else this.fillNonElevatedRoadSegment(n);}return !0}prepareElevatedLines(t,e,r){if(null!=e.constantHeight)return t;const n=[],i=1/lu(r);for(const r of t)wd(r,new ju(e,i),0,n);return n}fillNonElevatedRoadSegment(t){for(let e=t;e<this.layoutVertexArray.length;e++)this.zOffsetVertexArray.emplaceBack(0,0,0);}updateHeightRange(t){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,t),this.heightRange.max=Math.max(this.heightRange.max,t)):this.heightRange={min:t,max:t};}addLine(t,e,r,n,i,s,o,a){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const l="none"===n;this.patternJoinNone=this.hasPattern&&l,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const u=a&&a.progress.min>0,c=a&&a.progress.max<1;if(this.lineClips){let r={min:this.lineClips.start,max:this.lineClips.end},n=1;if(a){const t=this.lineClips.end-this.lineClips.start;r=function(t,e,r){return {min:re(t.min,e,r),max:re(t.max,e,r)}}(a.progress,{min:0,max:1},r),t>0&&(n=(r.max-r.min)/t);}const i=+e.properties.mapbox_clip_feature_len,s=+e.properties.mapbox_clip_seg_len;if(Number.isNaN(i)||Number.isNaN(s)){for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);const e=this.totalDistance/(r.max-r.min);this.totalFeatureLength=Number.isFinite(e)?e:0,this.lineClips.start=r.min,this.lineClips.end=r.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance);}else this.totalFeatureLength=i,this.distance=s*n,this.lineClips.start=r.min,this.lineClips.end=r.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance();}const h="Polygon"===ym[e.type];let p=t.length;for(;p>=2&&t[p-1].equals(t[p-2]);)p--;let d=0;for(;d<p-1&&t[d].equals(t[d+1]);)d++;if(p<(h?3:2))return;"bevel"===n&&(s=1.05);const f=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);let m,y,g,x,v,b,w,_;a&&a.prevDir&&(b=a.prevDir.perp()),a&&a.nextDir&&(w=a.nextDir.perp()),this.e1=this.e2=-1,h&&(m=t[p-2],v=t[d].sub(m)._unit()._perp());for(let e=d;e<p;e++){if(g=e===p-1?h?t[d+1]:void 0:t[e+1],g&&t[e].equals(g))continue;v&&(x=v),m&&(y=m),m=t[e],_=this.evaluateLineProgressFeatures(y?y.dist(m):0),v=g?g.sub(m)._unit()._perp():x,x=x||v;const r=y&&g;let a=r?n:h||l?"butt":i;const A=x.x*v.x+x.y*v.y;if(l){const t=function(t){if(t.patternJoinNone){const e=t.segmentPoints.length/2,r=t.lineSoFar-t.segmentStart;for(let n=0;n<e;++n){const e=t.segmentPoints[2*n+1],i=Math.round(t.segmentPoints[2*n])+.5+.25*e;t.patternVertexArray.emplaceBack(i,r,t.segmentStart),t.patternVertexArray.emplaceBack(i,r,t.segmentStart);}t.segmentPoints.length=0;}t.e1=t.e2=-1;};if(r&&A<xm){this.updateDistance(y,m),this.addCurrentVertex(m,x,1,1,f,_),t(this),this.addCurrentVertex(m,v,-1,-1,f,_);continue}if(y){if(!g){this.updateDistance(y,m),this.addCurrentVertex(m,x,1,1,f,_),t(this);continue}a="miter";}}let M=x.add(v);0===M.x&&0===M.y||M._unit();const I=M.x*v.x+M.y*v.y,S=0!==I?1/I:1/0,P=2*Math.sqrt(2-2*I),E=I<gm&&y&&g,k=x.x*v.y-x.y*v.x>0,z=this.overscaling<=16?15*Cn/(512*this.overscaling):0;if(r&&"round"===a)if(S<o)a="miter";else if(S<=2){const t=bm(m,-10,Cn+10);a="offset"===this.elevationType&&(t||this.hasCrossSlope)?"miter":"fakeround";}if("miter"===a&&S>s&&(a="bevel"),"bevel"===a&&(S>2&&(a="flipbevel"),S<s&&(a="miter")),y&&!("miter"===a&&E)&&this.updateDistance(y,m),"miter"===a)if(E){const t=m.dist(y);if(t>2*z){const e=m.sub(m.sub(y)._mult(z/t)._round());this.updateDistance(y,e),this.addCurrentVertex(e,x,0,0,f,_),y=e;}this.updateDistance(y,m),M._mult(S),this.addCurrentVertex(m,M,0,0,f,_);const e=m.dist(g);if(e>2*z){const t=m.add(g.sub(m)._mult(z/e)._round());this.updateDistance(m,t),this.addCurrentVertex(t,v,0,0,f,_),m=t;}}else M._mult(S),this.addCurrentVertex(m,M,0,0,f,_);else if("flipbevel"===a){if(S>100)M=v.mult(-1);else {const t=S*x.add(v).mag()/x.sub(v).mag();M._perp()._mult(t*(k?-1:1));}this.addCurrentVertex(m,M,0,0,f,_),this.addCurrentVertex(m,M.mult(-1),0,0,f,_);}else if("bevel"===a||"fakeround"===a){null!=_&&y&&this.addCurrentVertex(m,w||x,-1,-1,f,_);const t=m.dist(y)<=2*z&&"bevel"!==a,e=M.mult(k?1:-1);e._mult(S);const r=v.mult(k?-1:1),n=x.mult(k?-1:1),i=this.evaluateLineProgressFeatures(this.distance);if(null==_&&(this.addHalfVertex(m,e.x,e.y,!1,!k,0,f,i),t||this.addHalfVertex(m,e.x+2*n.x,e.y+2*n.y,!1,k,0,f,i)),"fakeround"===a){const t=Math.round(180*P/Math.PI/20);this.addHalfVertex(m,n.x,n.y,!1,k,0,f,i);for(let e=0;e<t;e++){let s=e/t;if(.5!==s){const t=s-.5;s+=s*t*(s-1)*((1.0904+A*(A*(3.55645-1.43519*A)-3.2452))*t*t+(.848013+A*(.215638*A-1.06021)));}const o=r.sub(n)._mult(s)._add(n)._unit();this.addHalfVertex(m,o.x,o.y,!1,k,0,f,i);}this.addHalfVertex(m,r.x,r.y,!1,k,0,f,i);}t||null!=_||this.addHalfVertex(m,e.x+2*r.x,e.y+2*r.y,!1,k,0,f,i),null!=_&&g&&this.addCurrentVertex(m,b||v,1,1,f,_);}else if("butt"===a)this.addCurrentVertex(m,M,0,0,f,_);else if("square"===a){if(!y){const t=u?0:-1;this.addCurrentVertex(m,M,t,t,f,_);}if(this.addCurrentVertex(m,M,0,0,f,_),y){const t=c?0:1;this.addCurrentVertex(m,M,t,t,f,_);}}else if("round"===a){if(y){const t=!r&&w?w:x;this.addCurrentVertex(m,t,0,0,f,_),!r&&c||this.addCurrentVertex(m,t,1,1,f,_,!0);}if(g){const t=!r&&b?b:v;!r&&u||this.addCurrentVertex(m,t,-1,-1,f,_,!0),this.addCurrentVertex(m,t,0,0,f,_);}}}}addVerticesTo(t,e,r,n,i,s,o,a,l,u){const c=(e.w-t.w)/this.tessellationStep|0;let h=0;const p=this.scaledDistance;if(c>1){this.lineSoFar=t.w;const p=(e.x-t.x)/c,d=(e.y-t.y)/c,f=(e.z-t.z)/c,m=(e.w-t.w)/c;for(let e=1;e<c;++e){t.x+=p,t.y+=d,t.z+=f,this.lineSoFar+=m,h+=m;const e=this.evaluateLineProgressFeatures(this.prevDistance+h);this.scaledDistance=(this.prevDistance+h)/this.totalDistance,this.addHalfVertex(t,r,n,u,!1,o,l,e),this.addHalfVertex(t,i,s,u,!0,-a,l,e);}}this.lineSoFar=e.w,this.scaledDistance=p;const d=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(e,r,n,u,!1,o,l,d),this.addHalfVertex(e,i,s,u,!0,-a,l,d);}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&"offset"!==this.elevationType)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):Gt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let e=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(e=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),"offset"!==this.elevationType?{zOffset:0,variableWidth:e}:"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:e}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:e}}addCurrentVertex(t,e,r,n,i,s,o=!1){const a=e.x+e.y*r,l=e.y-e.x*r,u=e.y*n-e.x,c=-e.y-e.x*n;if(null!=s){const e="offset"===this.elevationType,h=-10,p=Cn+10,d=s.zOffset,f=new gd(t.x,t.y,d,this.lineSoFar),m=!!e&&bm(t,h,p),y=this.lineSoFar,g=this.distance;if(this.currentVertex)if(m){const e=this.currentVertexIsOutside,s=this.currentVertex,m=new gd(t.x,t.y,d,this.lineSoFar);if(vd(s,m,h,p),!bm(m,h,p)){if(e){this.e1=this.e2=-1,this.distance-=s.dist(f),this.lineSoFar=s.w;const t=this.evaluateLineProgressFeatures(s.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(s,a,l,o,!1,r,i,t),this.addHalfVertex(s,u,c,o,!0,-n,i,t),this.prevDistance=this.distance;}this.distance=this.prevDistance+s.dist(m),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(s,m,a,l,u,c,r,n,i,o),this.distance=g,this.scaledDistance=this.distance/this.totalDistance;}}else {const t=this.currentVertex;if(this.currentVertexIsOutside){vd(t,f,h,p),this.e1=this.e2=-1,this.distance-=t.dist(f),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t.w;const e=this.evaluateLineProgressFeatures(t.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(t,a,l,o,!1,r,i,e),this.addHalfVertex(t,u,c,o,!0,-n,i,e),this.prevDistance=this.distance,this.distance=g,this.scaledDistance=this.distance/this.totalDistance;}this.addVerticesTo(t,f,a,l,u,c,r,n,i,o);}else m||(this.addHalfVertex(t,a,l,o,!1,r,i,s),this.addHalfVertex(t,u,c,o,!0,-n,i,s));this.currentVertex=f,this.currentVertexIsOutside=m,this.lineSoFar=y;}else this.addHalfVertex(t,a,l,o,!1,r,i,s),this.addHalfVertex(t,u,c,o,!0,-n,i,s);}addHalfVertex({x:t,y:e},r,n,i,s,o,a,l){if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),s||this.segmentPoints.push(this.lineSoFar-this.segmentStart,o)),this.layoutVertexArray.emplaceBack((t<<1)+(i?1:0),(e<<1)+(s?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const t=ur(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,t);}const u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),s?this.e2=u:this.e1=u,null!=l&&this.zOffsetVertexArray.emplaceBack(l.zOffset,l.variableWidth,l.variableWidth);}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance;}updateDistance(t,e){this.prevDistance=this.distance,this.distance+=t.dist(e),this.updateScaledDistance();}}function bm(t,e,r){return t.x<e||t.x>r||t.y<e||t.y>r}let wm,_m;function Am(t,e,r){return e*(Cn/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}qs(vm,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Mm=(t,e,r)=>(1-r)*t+r*e;function Im(t,e){return 1/Am(t,1,e.tileZoom)}function Sm(t,e,r,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Pm=t=>{const e=[];Em(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=t.paint.get("line-trim-offset");0===r[0]&&0===r[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER");const n="none"===t.layout.get("line-join").constantOr("miter"),i=!!t.paint.get("line-pattern").constantOr(1);return n&&i&&e.push("LINE_JOIN_NONE"),e};function Em(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}let km;const zm=()=>km||(km={layout:wm||(wm=new zo({"line-cap":new Eo(To.layout_line["line-cap"]),"line-join":new Eo(To.layout_line["line-join"]),"line-miter-limit":new Po(To.layout_line["line-miter-limit"]),"line-round-limit":new Po(To.layout_line["line-round-limit"]),"line-sort-key":new Eo(To.layout_line["line-sort-key"]),"line-z-offset":new Eo(To.layout_line["line-z-offset"]),"line-elevation-reference":new Po(To.layout_line["line-elevation-reference"]),"line-cross-slope":new Po(To.layout_line["line-cross-slope"]),visibility:new Po(To.layout_line.visibility),"line-width-unit":new Po(To.layout_line["line-width-unit"])})),paint:_m||(_m=new zo({"line-opacity":new Eo(To.paint_line["line-opacity"]),"line-color":new Eo(To.paint_line["line-color"]),"line-translate":new Po(To.paint_line["line-translate"]),"line-translate-anchor":new Po(To.paint_line["line-translate-anchor"]),"line-width":new Eo(To.paint_line["line-width"]),"line-gap-width":new Eo(To.paint_line["line-gap-width"]),"line-offset":new Eo(To.paint_line["line-offset"]),"line-blur":new Eo(To.paint_line["line-blur"]),"line-dasharray":new Eo(To.paint_line["line-dasharray"]),"line-pattern":new Eo(To.paint_line["line-pattern"]),"line-pattern-cross-fade":new Po(To.paint_line["line-pattern-cross-fade"]),"line-gradient":new ko(To.paint_line["line-gradient"]),"line-trim-offset":new Po(To.paint_line["line-trim-offset"]),"line-trim-fade-range":new Po(To.paint_line["line-trim-fade-range"]),"line-trim-color":new Po(To.paint_line["line-trim-color"]),"line-emissive-strength":new Po(To.paint_line["line-emissive-strength"]),"line-border-width":new Eo(To.paint_line["line-border-width"]),"line-border-color":new Eo(To.paint_line["line-border-color"]),"line-occlusion-opacity":new Po(To.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},km);class Tm extends Eo{possiblyEvaluate(t,e){return e=new xo(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition,worldview:e.worldview}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,n){return e=Ct({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,n)}}let Bm;function Vm(t,e){return e>0?e+2*t:t}const Cm=ea([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Fm=ea([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Dm=ea([{name:"a_projected_pos",components:4,type:"Float32"}],4);ea([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Lm=ea([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Rm=ea([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Om=ea([{name:"a_texb",components:2,type:"Uint16"}]),Um=ea([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Nm=ea([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ea([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jm=ea([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$m=ea([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ea([{name:"triangle",components:3,type:"Uint16"}]),ea([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ea([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ea([{type:"Float32",name:"offsetX"}]),ea([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Gm=24;function Hm(t,e,r){return t.sections.forEach((t=>{t.text=function(t,e,r){const n=e.layout.get("text-transform").evaluate(r,{});return "uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),go.applyArabicShaping&&(t=go.applyArabicShaping(t)),t}(t.text,e,r);})),t}const qm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Xm(t){return ""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}function Zm(t){return ""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}const Wm=4294967296,Ym=1/Wm,Km="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");let Jm=class{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length;}readFields(t,e,r=this.length){for(;this.pos<r;){const r=this.readVarint(),n=r>>3,i=this.pos;this.type=7&r,t(n,e,this),this.pos===i&&this.skip(r);}return e}readMessage(t,e){return this.readFields(t,e,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Wm;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Wm;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const e=this.buf;let r,n;return n=e[this.pos++],r=127&n,n<128?r:(n=e[this.pos++],r|=(127&n)<<7,n<128?r:(n=e[this.pos++],r|=(127&n)<<14,n<128?r:(n=e[this.pos++],r|=(127&n)<<21,n<128?r:(n=e[this.pos],r|=(15&n)<<28,function(t,e,r){const n=r.buf;let i,s;if(s=n[r.pos++],i=(112&s)>>4,s<128)return Qm(t,i,e);if(s=n[r.pos++],i|=(127&s)<<3,s<128)return Qm(t,i,e);if(s=n[r.pos++],i|=(127&s)<<10,s<128)return Qm(t,i,e);if(s=n[r.pos++],i|=(127&s)<<17,s<128)return Qm(t,i,e);if(s=n[r.pos++],i|=(127&s)<<24,s<128)return Qm(t,i,e);if(s=n[r.pos++],i|=(1&s)<<31,s<128)return Qm(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(r,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return Boolean(this.readVarint())}readString(){const t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Km?Km.decode(this.buf.subarray(e,t)):function(t,e,r){let n="",i=e;for(;i<r;){const e=t[i];let s,o,a,l=null,u=e>239?4:e>223?3:e>191?2:1;if(i+u>r)break;1===u?e<128&&(l=e):2===u?(s=t[i+1],128==(192&s)&&(l=(31&e)<<6|63&s,l<=127&&(l=null))):3===u?(s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&(l=(15&e)<<12|(63&s)<<6|63&o,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===u&&(s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(l=(15&e)<<18|(63&s)<<12|(63&o)<<6|63&a,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,u=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=u;}return n}(this.buf,e,t)}readBytes(){const t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e}readPackedVarint(t=[],e){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readVarint(e));return t}readPackedSVarint(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed64());return t}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(t){const e=7&t;if(0===e)for(;this.buf[this.pos++]>127;);else if(2===e)this.pos=this.readVarint()+this.pos;else if(5===e)this.pos+=4;else {if(1!==e)throw new Error(`Unimplemented type: ${e}`);this.pos+=8;}}writeTag(t,e){this.writeVarint(t<<3|e);}realloc(t){let e=this.length||16;for(;e<this.pos+t;)e*=2;if(e!==this.length){const t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.dataView=new DataView(t.buffer),this.length=e;}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4;}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4;}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Ym),!0),this.pos+=8;}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Ym),!0),this.pos+=8;}writeVarint(t){(t=+t||0)>268435455||t<0?function(t,e){let r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(r=~(-t%4294967296),n=~(-t/4294967296),4294967295^r?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,r.buf[r.pos]=127&(t>>>=7);}(r,0,e),function(t,e){const r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))));}(n,e);}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))));}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t);}writeBoolean(t){this.writeVarint(+t);}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const e=this.pos;this.pos=function(t,e,r){for(let n,i,s=0;s<e.length;s++){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!i){n>56319||s+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null;}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128);}return r}(this.buf,t,this.pos);const r=this.pos-e;r>=128&&ty(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r;}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4;}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8;}writeBytes(t){const e=t.length;this.writeVarint(e),this.realloc(e);for(let r=0;r<e;r++)this.buf[this.pos++]=t[r];}writeRawMessage(t,e){this.pos++;const r=this.pos;t(e,this);const n=this.pos-r;n>=128&&ty(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n;}writeMessage(t,e,r){this.writeTag(t,2),this.writeRawMessage(e,r);}writePackedVarint(t,e){e.length&&this.writeMessage(t,ey,e);}writePackedSVarint(t,e){e.length&&this.writeMessage(t,ry,e);}writePackedBoolean(t,e){e.length&&this.writeMessage(t,sy,e);}writePackedFloat(t,e){e.length&&this.writeMessage(t,ny,e);}writePackedDouble(t,e){e.length&&this.writeMessage(t,iy,e);}writePackedFixed32(t,e){e.length&&this.writeMessage(t,oy,e);}writePackedSFixed32(t,e){e.length&&this.writeMessage(t,ay,e);}writePackedFixed64(t,e){e.length&&this.writeMessage(t,ly,e);}writePackedSFixed64(t,e){e.length&&this.writeMessage(t,uy,e);}writeBytesField(t,e){this.writeTag(t,2),this.writeBytes(e);}writeFixed32Field(t,e){this.writeTag(t,5),this.writeFixed32(e);}writeSFixed32Field(t,e){this.writeTag(t,5),this.writeSFixed32(e);}writeFixed64Field(t,e){this.writeTag(t,1),this.writeFixed64(e);}writeSFixed64Field(t,e){this.writeTag(t,1),this.writeSFixed64(e);}writeVarintField(t,e){this.writeTag(t,0),this.writeVarint(e);}writeSVarintField(t,e){this.writeTag(t,0),this.writeSVarint(e);}writeStringField(t,e){this.writeTag(t,2),this.writeString(e);}writeFloatField(t,e){this.writeTag(t,5),this.writeFloat(e);}writeDoubleField(t,e){this.writeTag(t,1),this.writeDouble(e);}writeBooleanField(t,e){this.writeVarintField(t,+e);}};function Qm(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function ty(t,e,r){const n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(let e=r.pos-1;e>=t;e--)r.buf[e+n]=r.buf[e];}function ey(t,e){for(let r=0;r<t.length;r++)e.writeVarint(t[r]);}function ry(t,e){for(let r=0;r<t.length;r++)e.writeSVarint(t[r]);}function ny(t,e){for(let r=0;r<t.length;r++)e.writeFloat(t[r]);}function iy(t,e){for(let r=0;r<t.length;r++)e.writeDouble(t[r]);}function sy(t,e){for(let r=0;r<t.length;r++)e.writeBoolean(t[r]);}function oy(t,e){for(let r=0;r<t.length;r++)e.writeFixed32(t[r]);}function ay(t,e){for(let r=0;r<t.length;r++)e.writeSFixed32(t[r]);}function ly(t,e){for(let r=0;r<t.length;r++)e.writeFixed64(t[r]);}function uy(t,e){for(let r=0;r<t.length;r++)e.writeSFixed64(t[r]);}const cy=3;function hy(t,e,r){e.glyphs=[],1===t&&r.readMessage(py,e);}function py(t,e,r){if(3===t){const{id:t,bitmap:n,width:i,height:s,left:o,top:a,advance:l}=r.readMessage(dy,{});e.glyphs.push({id:t,bitmap:new hh({width:i+2*cy,height:s+2*cy},n),metrics:{width:i,height:s,left:o,top:a,advance:l}});}else 4===t?e.ascender=r.readSVarint():5===t&&(e.descender=r.readSVarint());}function dy(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint());}const fy=cy,my={horizontal:1,vertical:2,horizontalOnly:3};class yy{constructor(){this.scale=1,this.fontStack="",this.image=null;}static forText(t,e){const r=new yy;return r.scale=t||1,r.fontStack=e,r}static forImage(t){const e=new yy;return e.image=t,e}}class gy{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null;}static fromFeature(t,e,r){const n=new gy;for(let i=0;i<t.sections.length;i++){const s=t.sections[i];s.image?n.addImageSection(s,r):n.addTextSection(s,e);}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(t,e){let r="";for(let n=0;n<t.length;n++){const i=t.charCodeAt(n+1)||null,s=t.charCodeAt(n-1)||null;r+=!e&&(i&&ro(i)&&!qm[t[n+1]]||s&&ro(s)&&!qm[t[n-1]])||!qm[t[n]]?t[n]:qm[t[n]];}return r}(this.text,t);}trim(){let t=0;for(let e=0;e<this.text.length&&vy[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let r=this.text.length-1;r>=0&&r>=t&&vy[this.text.charCodeAt(r)];r--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e);}substring(t,e){const r=new gy;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(yy.forText(t.scale,t.fontStack||e));const r=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(r);}addImageSection(t,e){const r=t.image?t.image.getPrimary():null;if(!r)return void Gt("Can't add FormattedSection with an empty image.");r.scaleSelf(e);const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(yy.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401");}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xy(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m=1){const y=gy.fromFeature(t,i,m);h===my.vertical&&y.verticalizePunctuation(p);let g=[];const x=function(t,e,r,n,i,s){if(!t)return [];const o=[],a=function(t,e,r,n,i,s){let o=0;for(let r=0;r<t.length();r++){const a=t.getSection(r);o+=wy(t.getCodePoint(r),a,n,i,e,s);}return o/Math.max(1,Math.ceil(o/r))}(t,e,r,n,i,s),l=t.text.indexOf("")>=0;let u=0;for(let r=0;r<t.length();r++){const h=t.getSection(r),p=t.getCodePoint(r);if(vy[p]||(u+=wy(p,h,n,i,e,s)),r<t.length()-1){const e=!((c=p)<11904||!(Ks["Bopomofo Extended"](c)||Ks.Bopomofo(c)||Ks["CJK Compatibility Forms"](c)||Ks["CJK Compatibility Ideographs"](c)||Ks["CJK Compatibility"](c)||Ks["CJK Radicals Supplement"](c)||Ks["CJK Strokes"](c)||Ks["CJK Symbols and Punctuation"](c)||Ks["CJK Unified Ideographs Extension A"](c)||Ks["CJK Unified Ideographs"](c)||Ks["Enclosed CJK Letters and Months"](c)||Ks["Halfwidth and Fullwidth Forms"](c)||Ks.Hiragana(c)||Ks["Ideographic Description Characters"](c)||Ks["Kangxi Radicals"](c)||Ks["Katakana Phonetic Extensions"](c)||Ks.Katakana(c)||Ks["Vertical Forms"](c)||Ks["Yi Radicals"](c)||Ks["Yi Syllables"](c)));(by[p]||e||h.image)&&o.push(My(r+1,u,a,o,Ay(p,t.getCodePoint(r+1),e&&l),!1));}}var c;return Iy(My(t.length(),u,a,o,0,!0))}(y,u,s,e,n,d),{processBidirectionalText:v,processStyledBidirectionalText:b}=go;if(v&&1===y.sections.length){const t=v(y.toString(),x);for(const e of t){const t=new gy;t.text=e,t.sections=y.sections;for(let r=0;r<e.length;r++)t.sectionIndex.push(0);g.push(t);}}else if(b){const t=b(y.text,y.sectionIndex,x);for(const e of t){const t=new gy;t.text=e[0],t.sectionIndex=e[1],t.sections=y.sections,g.push(t);}}else g=function(t,e){const r=[],n=t.text;let i=0;for(const n of e)r.push(t.substring(i,n)),i=n;return i<n.length&&r.push(t.substring(i,n.length)),r}(y,x);const w=[],_={positionedLines:w,text:y.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(t,e,r,n,i,s,o,a,l,u,c,h){let p=0,d=0,f=0;const m="right"===a?1:"left"===a?0:.5;let y=!1;for(const t of i){const r=t.getSections();for(const t of r){if(t.image)continue;const r=e[t.fontStack];if(r&&(y=void 0!==r.ascender&&void 0!==r.descender,!y))break}if(!y)break}let g=0;for(const o of i){o.trim();const i=o.getMaxScale(),a=(i-1)*Gm,v={positionedGlyphs:[],lineOffset:0};t.positionedLines[g]=v;const b=v.positionedGlyphs;let w=0;if(!o.length()){d+=s,++g;continue}let _=0,A=0;for(let s=0;s<o.length();s++){const a=o.getSection(s),f=o.getSectionIndex(s),m=o.getCodePoint(s);let g=a.scale,v=null,M=null,I=null,S=Gm,P=0,E=l;E===my.vertical&&(12312===(x=m)||12313===x||12316===x||12540===x||12448===x)&&(E=my.horizontal);const k=!(E===my.horizontal||!c&&!eo(m)||c&&(vy[m]||no(m)));if(a.image){const e=n.get(a.image.toString());if(!e)continue;I=a.image,t.iconsInText=t.iconsInText||!0,M=e.paddedRect;const r=e.displaySize;g=g*Gm/h,v={width:r[0],height:r[1],left:0,top:-fy,advance:k?r[1]:r[0],localGlyph:!1},P=y?-v.height*g:i*Gm-17-r[1]*g,S=v.advance;const s=(k?r[0]:r[1])*g-Gm*i;s>0&&s>w&&(w=s);}else {const t=r[a.fontStack];if(!t)continue;t[m]&&(M=t[m]);const n=e[a.fontStack];if(!n)continue;const s=n.glyphs[m];if(!s)continue;if(v=s.metrics,S=8203!==m?Gm:0,y){const t=void 0!==n.ascender?Math.abs(n.ascender):0,e=void 0!==n.descender?Math.abs(n.descender):0,r=(t+e)*g;_<r&&(_=r,A=(t-e)/2*g),P=-t*g;}else P=(i-g)*Gm-17;}k?(t.verticalizable=!0,b.push({glyph:m,image:I,x:p,y:d+P,vertical:k,scale:g,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:M}),p+=S*g+u):(b.push({glyph:m,image:I,x:p,y:d+P,vertical:k,scale:g,localGlyph:v.localGlyph,fontStack:a.fontStack,sectionIndex:f,metrics:v,rect:M}),p+=v.advance*g+u);}0!==b.length&&(f=Math.max(p-u,f),y?Py(b,m,w,A,s*i/2):Py(b,m,w,0,s/2)),p=0;const M=s*i+w;v.lineOffset=Math.max(w,a),d+=M,++g;}var x;const v=d,{horizontalAlign:b,verticalAlign:w}=Sy(o);((function(t,e,r,n,i,s){const o=(e-r)*i,a=-s*n;for(const e of t)for(const t of e.positionedGlyphs)t.x+=o,t.y+=a;}))(t.positionedLines,m,b,w,f,v),t.top+=-w*v,t.bottom=t.top+v,t.left+=-b*f,t.right=t.left+f,t.hasBaseline=y;}(_,e,r,n,g,o,a,l,h,u,p,f),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return !1;return !0}(w))return _}const vy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},by={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wy(t,e,r,n,i,s){if(e.image){const t=n.get(e.image.toString());return t?t.displaySize[0]*e.scale*Gm/s+i:0}{const n=r[e.fontStack],s=n&&n.glyphs[t];return s?s.metrics.advance*e.scale+i:0}}function _y(t,e,r,n){const i=Math.pow(t-e,2);return n?t<e?i/2:2*i:i+Math.abs(r)*r}function Ay(t,e,r){let n=0;return 10===t&&(n-=1e4),r&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function My(t,e,r,n,i,s){let o=null,a=_y(e,r,i,s);for(const t of n){const n=_y(e-t.x,r,i,s)+t.badness;n<=a&&(o=t,a=n);}return {index:t,x:e,priorBreak:o,badness:a}}function Iy(t){return t?Iy(t.priorBreak).concat(t.index):[]}function Sy(t){let e=.5,r=.5;switch(t){case "right":case "top-right":case "bottom-right":e=1;break;case "left":case "top-left":case "bottom-left":e=0;}switch(t){case "bottom":case "bottom-right":case "bottom-left":r=1;break;case "top":case "top-right":case "top-left":r=0;}return {horizontalAlign:e,verticalAlign:r}}function Py(t,e,r,n,i){if(!(e||r||n||i))return;const s=t.length-1,o=t[s],a=(o.x+o.metrics.advance*o.scale)*e;for(let e=0;e<=s;e++)t[e].x-=a,t[e].y+=r+n+i;}function Ey(t){return void 0!==t.imagePrimary&&void 0!==t.top&&void 0!==t.bottom&&void 0!==t.left&&void 0!==t.right}function ky(t,e,r,n){const{horizontalAlign:i,verticalAlign:s}=Sy(n),o=r[0]-t.displaySize[0]*i,a=r[1]-t.displaySize[1]*s;return {imagePrimary:t,imageSecondary:e,top:a,bottom:a+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function zy(t,e,r,n,i,s){const o=t.imagePrimary;let a;if(o.content){const t=o.content,e=o.pixelRatio||1;a=[t[0]/e,t[1]/e,o.displaySize[0]-t[2]/e,o.displaySize[1]-t[3]/e];}const l=e.left*s,u=e.right*s;let c,h,p,d;"width"===r||"both"===r?(d=i[0]+l-n[3],h=i[0]+u+n[1]):(d=i[0]+(l+u-o.displaySize[0])/2,h=d+o.displaySize[0]);const f=e.top*s,m=e.bottom*s;return "height"===r||"both"===r?(c=i[1]+f-n[0],p=i[1]+m+n[2]):(c=i[1]+(f+m-o.displaySize[1])/2,p=c+o.displaySize[1]),{imagePrimary:o,imageSecondary:void 0,top:c,right:h,bottom:p,left:d,collisionPadding:a}}function Ty(t){return !t.imagePrimary.stretchX}function By(t){return !t.imagePrimary.stretchY}function Vy(t){return {width:t.right-t.left,height:t.bottom-t.top}}const Cy=128;function Fy(t,e,r){const{expression:n}=e;if("constant"===n.kind)return {kind:"constant",layoutSize:n.evaluate(new xo(t+1,{worldview:r}))};if("source"===n.kind)return {kind:"source"};{const{zoomStops:e,interpolationType:i}=n;let s=0;for(;s<e.length&&e[s]<=t;)s++;s=Math.max(0,s-1);let o=s;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const a=e[s],l=e[o];return "composite"===n.kind?{kind:"composite",minZoom:a,maxZoom:l,interpolationType:i}:{kind:"camera",minZoom:a,maxZoom:l,minSize:n.evaluate(new xo(a,{worldview:r})),maxSize:n.evaluate(new xo(l,{worldview:r})),interpolationType:i}}}function Dy(t,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:i}){return "source"===t.kind?n/Cy:"composite"===t.kind?ur(n/Cy,i/Cy,r):e}function Ly(t,e,r=1){let n=0,i=0;if("constant"===t.kind)i=t.layoutSize*r;else if("source"!==t.kind){const{interpolationType:s,minZoom:o,maxZoom:a}=t,l=s?zt(ji.interpolationFactor(s,e,o,a),0,1):0;"camera"===t.kind?i=ur(t.minSize,t.maxSize,l)*r:n=l*r;}return {uSizeT:n,uSize:i}}class Ry extends bt{constructor(t,e,r,n,i){super(t,e),this.angle=n,this.z=r,void 0!==i&&(this.segment=i);}clone(){return new Ry(this.x,this.y,this.z,this.angle,this.segment)}}function Oy(t,e,r,n,i){if(void 0===e.segment)return !0;let s=e,o=e.segment+1,a=0;for(;a>-r/2;){if(o--,o<0)return !1;a-=t[o].dist(s),s=t[o];}a+=t[o].dist(t[o+1]),o++;const l=[];let u=0;for(;a<r/2;){const e=t[o],r=t[o+1];if(!r)return !1;let s=t[o-1].angleTo(e)-e.angleTo(r);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:s}),u+=s;a-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return !1;o++,a+=e.dist(r);}return !0}function Uy(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function Ny(t,e,r){return t?.6*e*r:0}function jy(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function $y(t,e,r,n,i,s){const o=Ny(r,i,s),a=jy(r,n)*s;let l=0;const u=Uy(t)/2;for(let r=0;r<t.length-1;r++){const n=t[r],i=t[r+1],s=n.dist(i);if(l+s>u){const c=(u-l)/s,h=ur(n.x,i.x,c),p=ur(n.y,i.y,c),d=new Ry(h,p,0,i.angleTo(n),r);return !o||Oy(t,d,a,o,e)?d:void 0}l+=s;}}function Gy(t,e,r,n,i,s,o,a,l){const u=Ny(n,s,o),c=jy(n,i),h=c*o,p=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-h<e/4&&(e=h+e/4),Hy(t,p?e/2*a%e:(c/2+2*s)*o*a%e,e,u,r,h,p,!1,l)}function Hy(t,e,r,n,i,s,o,a,l){const u=s/2,c=Uy(t);let h=0,p=e-r,d=[];for(let e=0;e<t.length-1;e++){const o=t[e],a=t[e+1],f=o.dist(a),m=a.angleTo(o);for(;p+r<h+f;){p+=r;const y=(p-h)/f,g=ur(o.x,a.x,y),x=ur(o.y,a.y,y);if(g>=0&&g<l&&x>=0&&x<l&&p-u>=0&&p+u<=c){const r=new Ry(g,x,0,m,e);n&&!Oy(t,r,s,n,i)||d.push(r);}}h+=f;}return a||d.length||o||(d=Hy(t,h/2,r,n,i,s,o,!0,l)),d}function qy(t){let e=0,r=0;for(const n of t)e+=n.w*n.h,r=Math.max(r,n.w);t.sort(((t,e)=>e.h-t.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let i=0,s=0;for(const e of t)for(let t=n.length-1;t>=0;t--){const r=n[t];if(!(e.w>r.w||e.h>r.h)){if(e.x=r.x,e.y=r.y,s=Math.max(s,e.y+e.h),i=Math.max(i,e.x+e.w),e.w===r.w&&e.h===r.h){const e=n.pop();e&&t<n.length&&(n[t]=e);}else e.h===r.h?(r.x+=e.w,r.w-=e.w):e.w===r.w?(r.y+=e.h,r.h-=e.h):(n.push({x:r.x+e.w,y:r.y,w:r.w-e.w,h:e.h}),r.y+=e.h,r.h-=e.h);break}}return {w:i,h:s,fill:e/(i*s)||0}}qs(Ry,"Anchor");const Xy=1;class Zy{static getImagePositionScale(t,e,r){if(e&&t&&t.options&&t.options.transform){const e=t.options.transform;return {x:e.a,y:e.d}}return {x:r,y:r}}constructor(t,e,r,n){this.paddedRect=t;const{pixelRatio:i,version:s,stretchX:o,stretchY:a,content:l,sdf:u,usvg:c}=e;this.pixelRatio=i,this.stretchX=o,this.stretchY=a,this.content=l,this.version=s,this.padding=r,this.sdf=u,this.usvg=c,this.scale=Zy.getImagePositionScale(n,c,i);}get tl(){return [this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return [this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return [(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Wy(t,e,r){const n=Fr.parse(t),i=function(t,e,r=[1,1]){return {x:0,y:0,w:(t.data?t.data.width:t.width*r[0])+2*e,h:(t.data?t.data.height:t.height*r[1])+2*e}}(e,r,[n.options.transform.a,n.options.transform.d]);return {bin:i,imagePosition:new Zy(i,e,r,n),imageVariant:n}}class Yy{constructor(t,e,r){const n=new Map,i=new Map;this.haveRenderCallbacks=[];const s=[];this.addImages(t,n,Xy,s),this.addImages(e,i,2,s);const{w:o,h:a}=qy(s),l=new ph({width:o||1,height:a||1});for(const[e,i]of t.entries()){const t=n.get(e).paddedRect;ph.copy(i.data,l,{x:0,y:0},{x:t.x+Xy,y:t.y+Xy},i.data,r,i.sdf);}for(const[t,n]of e.entries()){const e=i.get(t),s=e.paddedRect;let o=e.padding;const a=s.x+o,u=s.y+o,c=n.data.width,h=n.data.height;o=o>1?o-1:o,ph.copy(n.data,l,{x:0,y:0},{x:a,y:u},n.data,r),ph.copy(n.data,l,{x:0,y:h-o},{x:a,y:u-o},{width:c,height:o},r),ph.copy(n.data,l,{x:0,y:0},{x:a,y:u+h},{width:c,height:o},r),ph.copy(n.data,l,{x:c-o,y:0},{x:a-o,y:u},{width:o,height:h},r),ph.copy(n.data,l,{x:0,y:0},{x:a+c,y:u},{width:o,height:h},r),ph.copy(n.data,l,{x:c-o,y:h-o},{x:a-o,y:u-o},{width:o,height:o},r),ph.copy(n.data,l,{x:0,y:h-o},{x:a+c,y:u-o},{width:o,height:o},r),ph.copy(n.data,l,{x:0,y:0},{x:a+c,y:u+h},{width:o,height:o},r),ph.copy(n.data,l,{x:c-o,y:0},{x:a-o,y:u+h},{width:o,height:o},r);}this.lut=r,this.image=l,this.iconPositions=n,this.patternPositions=i;}addImages(t,e,r,n){for(const[i,s]of t.entries()){const{bin:t,imagePosition:o,imageVariant:a}=Wy(i,s,r);e.set(i,o),n.push(t),s.hasRenderCallback&&this.haveRenderCallbacks.push(a.id);}}patchUpdatedImages(t,e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((e=>t.hasImage(e,r))),t.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const n of t.getUpdatedImages(r)){for(const i of this.iconPositions.keys()){const s=Fr.parse(i);if(er.isEqual(s.id,n)){const s=t.getImage(n,r);this.patchUpdatedImage(this.iconPositions.get(i),s,e);}}for(const i of this.patternPositions.keys()){const s=Fr.parse(i);if(er.isEqual(s.id,n)){const s=t.getImage(n,r);this.patchUpdatedImage(this.patternPositions.get(i),s,e);}}}}patchUpdatedImage(t,e,r){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[n,i]=t.tl,s=t.sdf;if(this.lut||s){const t={width:e.data.width,height:e.data.height},o=new ph(t);ph.copy(e.data,o,{x:0,y:0},{x:0,y:0},t,this.lut,s),r.update(o,{position:{x:n,y:i}});}else r.update(e.data,{position:{x:n,y:i}});}}qs(Zy,"ImagePosition"),qs(Yy,"ImageAtlas");const Ky=1e20;function Jy(t,e,r,n,i,s,o,a,l){for(let u=e;u<e+n;u++)Qy(t,r*s+u,s,i,o,a,l);for(let u=r;u<r+i;u++)Qy(t,u*s+e,1,n,o,a,l);}function Qy(t,e,r,n,i,s,o){s[0]=0,o[0]=-Ky,o[1]=Ky,i[0]=t[e];for(let a=1,l=0,u=0;a<n;a++){i[a]=t[e+a*r];const n=a*a;do{const t=s[l];u=(i[a]-i[t]+n-t*t)/(a-t)/2;}while(u<=o[l]&&--l>-1);l++,s[l]=a,o[l]=u,o[l+1]=Ky;}for(let a=0,l=0;a<n;a++){for(;o[l+1]<a;)l++;const n=s[l],u=a-n;t[e+a*r]=i[n]+u*u;}}const tg=2,eg={none:0,ideographs:1,all:2};class rg{constructor(t,e,r){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=r,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}};}setURL(t){this.url=t;}getGlyphs(t,e){const r=[],n=this.url||ne.GLYPHS_URL;for(const e in t)for(const n of t[e])r.push({stack:e,id:n});Vt(r,(({stack:t,id:e},r)=>{let i=this.entries[t];i||(i=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let s=i.glyphs[e];if(void 0!==s)return void r(null,{stack:t,id:e,glyph:s});if(s=this._tinySDF(i,t,e),s)return i.glyphs[e]=s,void r(null,{stack:t,id:e,glyph:s});const o=Math.floor(e/256);if(256*o>65535)return Gt("glyphs > 65535 not supported"),void r(null,{stack:t,id:e,glyph:s});if(i.ranges[o])return void r(null,{stack:t,id:e,glyph:s});let a=i.requests[o];a||(a=i.requests[o]=[],rg.loadGlyphRange(t,o,n,this.requestManager,((t,e)=>{if(e){i.ascender=e.ascender,i.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(i.glyphs[+t]=e.glyphs[+t]);i.ranges[o]=!0;}for(const r of a)r(t,e);delete i.requests[o];}))),a.push(((n,i)=>{n?r(n):i&&r(null,{stack:t,id:e,glyph:i.glyphs[e]||null});}));}),((t,r)=>{if(t)e(t);else if(r){const t={};for(const{stack:e,id:n,glyph:i}of r)void 0===t[e]&&(t[e]={}),void 0===t[e].glyphs&&(t[e].glyphs={}),t[e].glyphs[n]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},t[e].ascender=this.entries[e].ascender,t[e].descender=this.entries[e].descender;e(null,t);}}));}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==eg.none&&(this.localGlyphMode===eg.all?!!this.localFontFamily:!!this.localFontFamily&&(Ks["CJK Unified Ideographs"](t)||Ks["Hangul Syllables"](t)||Ks.Hiragana(t)||Ks.Katakana(t)||Ks["CJK Symbols and Punctuation"](t)||Ks["CJK Unified Ideographs Extension A"](t)||Ks["CJK Unified Ideographs Extension B"](t)||Ks.Osage(t)))}_tinySDF(t,e,r){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(r))return;let i=t.tinySDF;if(!i){let r="400";/bold/i.test(e)?r="900":/medium/i.test(e)?r="500":/light/i.test(e)&&(r="200"),i=t.tinySDF=new rg.TinySDF({fontFamily:n,fontWeight:r,fontSize:24*tg,buffer:3*tg,radius:8*tg}),i.fontWeight=r;}if(this.localGlyphs[i.fontWeight][r])return this.localGlyphs[i.fontWeight][r];const s=String.fromCodePoint(r),{data:o,width:a,height:l,glyphWidth:u,glyphHeight:c,glyphLeft:h,glyphTop:p,glyphAdvance:d}=i.draw(s);return this.localGlyphs[i.fontWeight][r]={id:r,bitmap:new hh({width:a,height:l},o),metrics:{width:u/tg,height:c/tg,left:h/tg,top:p/tg-27,advance:d/tg,localGlyph:!0}}}}rg.loadGlyphRange=function(t,e,r,n,i){const s=256*e,o=s+255,a=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${s}-${o}`),Be.Glyphs);De(a,((t,e)=>{if(t)i(t);else if(e){const t={},r=function(t){return new Jm(t).readFields(hy,{})}(e);for(const e of r.glyphs)t[e.id]=e;i(null,{glyphs:t,ascender:r.ascender,descender:r.descender});}}));},rg.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:i="sans-serif",fontWeight:s="normal",fontStyle:o="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=r;const a=this.size=t+4*e,l=this._createCanvas(a),u=this.ctx=l.getContext("2d",{willReadFrequently:!0});u.font=`${o} ${s} ${t}px ${i}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a);}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:i,actualBoundingBoxRight:s}=this.ctx.measureText(t),o=Math.ceil(r),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-i))),l=Math.min(this.size-this.buffer,o+Math.ceil(n)),u=a+2*this.buffer,c=l+2*this.buffer,h=Math.max(u*c,0),p=new Uint8ClampedArray(h),d={data:p,width:u,height:c,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:e};if(0===a||0===l)return d;const{ctx:f,buffer:m,gridInner:y,gridOuter:g}=this;f.clearRect(m,m,a,l),f.fillText(t,m,m+o);const x=f.getImageData(m,m,a,l);g.fill(Ky,0,h),y.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<a;e++){const r=x.data[4*(t*a+e)+3]/255;if(0===r)continue;const n=(t+m)*u+e+m;if(1===r)g[n]=0,y[n]=Ky;else {const t=.5-r;g[n]=t>0?t*t:0,y[n]=t<0?t*t:0;}}Jy(g,0,0,u,c,u,this.f,this.v,this.z),Jy(y,m,m,a,l,u,this.f,this.v,this.z);for(let t=0;t<h;t++){const e=Math.sqrt(g[t])-Math.sqrt(y[t]);p[t]=Math.round(255-255*(e/this.radius+this.cutoff));}return d}};const ng=Xy;function ig(t,e){return t+e[1]-e[0]}function sg(t,e,r,n,i=1){const s=[],o=t.imagePrimary,a=o.pixelRatio,l=o.paddedRect.w-2*ng,u=o.paddedRect.h-2*ng,c=(t.right-t.left)*i,h=(t.bottom-t.top)*i,p=o.stretchX||[[0,l]],d=o.stretchY||[[0,u]],f=p.reduce(ig,0),m=d.reduce(ig,0),y=l-f,g=u-m;let x=0,v=f,b=0,w=m,_=0,A=y,M=0,I=g;if(o.content&&n){const t=o.content;x=og(p,0,t[0]),b=og(d,0,t[1]),v=og(p,t[0],t[2]),w=og(d,t[1],t[3]),_=t[0]-x,M=t[1]-b,A=t[2]-t[0]-v,I=t[3]-t[1]-w;}const S=(n,s,l,u)=>{const p=lg(n.stretch-x,v,c,t.left*i),d=ug(n.fixed-_,A,n.stretch,f),y=lg(s.stretch-b,w,h,t.top*i),g=ug(s.fixed-M,I,s.stretch,m),S=lg(l.stretch-x,v,c,t.left*i),P=ug(l.fixed-_,A,l.stretch,f),E=lg(u.stretch-b,w,h,t.top*i),k=ug(u.fixed-M,I,u.stretch,m),z=new bt(p,y),T=new bt(S,y),B=new bt(S,E),V=new bt(p,E),C=new bt(d/a,g/a),F=new bt(P/a,k/a),D=e*Math.PI/180;if(D){const t=Math.sin(D),e=Math.cos(D),r=[e,-t,t,e];z._matMult(r),T._matMult(r),V._matMult(r),B._matMult(r);}const L=n.stretch+n.fixed,R=l.stretch+l.fixed,O=s.stretch+s.fixed,U=u.stretch+u.fixed,N=t.imageSecondary;return {tl:z,tr:T,bl:V,br:B,texPrimary:{x:o.paddedRect.x+ng+L,y:o.paddedRect.y+ng+O,w:R-L,h:U-O},texSecondary:N?{x:N.paddedRect.x+ng+L,y:N.paddedRect.y+ng+O,w:R-L,h:U-O}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:C,pixelOffsetBR:F,minFontScaleX:A/a/c,minFontScaleY:I/a/h,isSDF:r}};if(n&&(o.stretchX||o.stretchY)){const t=ag(p,y,f),e=ag(d,g,m);for(let r=0;r<t.length-1;r++){const n=t[r],i=t[r+1];for(let t=0;t<e.length-1;t++)s.push(S(n,e[t],i,e[t+1]));}}else s.push(S({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:u+1}));return s}function og(t,e,r){let n=0;for(const i of t)n+=Math.max(e,Math.min(r,i[1]))-Math.max(e,Math.min(r,i[0]));return n}function ag(t,e,r){const n=[{fixed:-ng,stretch:0}];for(const[e,r]of t){const t=n[n.length-1];n.push({fixed:e-t.stretch,stretch:t.stretch}),n.push({fixed:e-t.stretch,stretch:t.stretch+(r-e)});}return n.push({fixed:e+ng,stretch:r}),n}function lg(t,e,r,n){return t/e*r+n}function ug(t,e,r,n){return t-e*r/n}function cg(t,e,r,n){const i=e+t.positionedLines[n].lineOffset;return 0===n?r+i/2:r+(i+(e+t.positionedLines[n-1].lineOffset))/2}function hg(t,e=1,r=!1){let n=1/0,i=1/0,s=-1/0,o=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<n)&&(n=e.x),(!t||e.y<i)&&(i=e.y),(!t||e.x>s)&&(s=e.x),(!t||e.y>o)&&(o=e.y);}const l=Math.min(s-n,o-i);let u=l/2;const c=new Vn([],pg);if(0===l)return new bt(n,i);for(let e=n;e<s;e+=l)for(let r=i;r<o;r+=l)c.push(new dg(e+u,r+u,u,t));let h=function(t){let e=0,r=0,n=0;const i=t[0];for(let t=0,s=i.length,o=s-1;t<s;o=t++){const s=i[t],a=i[o],l=s.x*a.y-a.x*s.y;r+=(s.x+a.x)*l,n+=(s.y+a.y)*l,e+=3*l;}return new dg(r/e,n/e,0,t)}(t),p=c.length;for(;c.length;){const n=c.pop();(n.d>h.d||!h.d)&&(h=n,r&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,p)),n.max-h.d<=e||(u=n.h/2,c.push(new dg(n.p.x-u,n.p.y-u,u,t)),c.push(new dg(n.p.x+u,n.p.y-u,u,t)),c.push(new dg(n.p.x-u,n.p.y+u,u,t)),c.push(new dg(n.p.x+u,n.p.y+u,u,t)),p+=4);}return r&&(console.log(`num probes: ${p}`),console.log(`best distance: ${h.d}`)),h.p}function pg(t,e){return e.max-t.max}class dg{constructor(t,e,r,n){this.p=new bt(t,e),this.h=r,this.d=function(t,e){let r=!1,n=1/0;for(let i=0;i<e.length;i++){const s=e[i];for(let e=0,i=s.length,o=i-1;e<i;o=e++){const i=s[e],a=s[o];i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(r=!r),n=Math.min(n,rc(t,i,a));}}return (r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2;}}const fg=Object.keys,mg=Number.POSITIVE_INFINITY,yg=Math.sqrt(2);function gg(t,[e,r]){let n=0,i=0;if(r===mg){e<0&&(e=0);const r=e/yg;switch(t){case "top-right":case "top-left":i=r-7;break;case "bottom-right":case "bottom-left":i=7-r;break;case "bottom":i=7-e;break;case "top":i=e-7;}switch(t){case "top-right":case "bottom-right":n=-r;break;case "top-left":case "bottom-left":n=r;break;case "left":n=e;break;case "right":n=-e;}}else {switch(e=Math.abs(e),r=Math.abs(r),t){case "top-right":case "top-left":case "top":i=r-7;break;case "bottom-right":case "bottom-left":case "bottom":i=7-r;}switch(t){case "top-right":case "bottom-right":case "right":n=-e;break;case "top-left":case "bottom-left":case "left":n=e;}}return [n,i]}function xg(t,e,r,n,i,s,o,a,l){if(!e||!e.usvg)return;const u=Vy(n),c=Vy(i),h="both"!==s&&"width"!==s||!Ty(n)?1:c.width/u.width,p="both"!==s&&"height"!==s||!By(n)?1:c.height/u.height;r.scaleSelf(h,p);const d=r.toString();o.set(d,r),a.set(d,e);const{imagePosition:f}=Wy(d,e,Xy);l.set(d,f);}function vg(t,e,r,n,i,s,o,a,l){if(!t)return;const u=function(t,e,r,n,i,s){if("camera"===t.kind)return t.maxSize;if("composite"===t.kind){const n=e.possiblyEvaluate(new xo(t.maxZoom,{worldview:s}),r).evaluate(i,{},r),o=e.possiblyEvaluate(new xo(t.minZoom,{worldview:s}),r).evaluate(i,{},r);return Math.max(n,o)}return e.possiblyEvaluate(new xo(n,{worldview:s})).evaluate(i,{},r)}(e,r,n,i,s,l);return t.scaleSelf(u*a*o)}function bg(t,e,r,n,i,s,o,a,l){return {iconPrimary:vg(t.getPrimary(),e,r,n,i,s,o,a,l),iconSecondary:vg(t.getSecondary(),e,r,n,i,s,o,a,l)}}function wg(t,e,r){if(!e)return;const n=r.get(t.toString()),i=r.get(e.toString());i&&(n.paddedRect.w===i.paddedRect.w&&n.paddedRect.h===i.paddedRect.h||Gt(`Mismatch in icon variant sizes: ${t.toString()} and ${e.toString()}`),n.usvg!==i.usvg&&Gt(`Mismatch in icon variant image types: ${t.id} and ${e.id}`));}function _g(t,e,r,n){if(!t)return;const i=e.get(r.toString());if(t.imagePrimary=i,n){const r=e.get(n.toString());t.imageSecondary=r;}}function Ag(t,e){for(const r in t.horizontal)Mg(t.horizontal[r],e);Mg(t.vertical,e);}function Mg(t,e){if(t)for(const r of t.positionedLines)for(const t of r.positionedGlyphs)if(null!==t.image){const r=t.image.toString();t.rect=e.get(r).paddedRect;}}function Ig(t){switch(t){case "right":case "top-right":case "bottom-right":return "right";case "left":case "top-left":case "bottom-left":return "left"}return "center"}function Sg(t,e,r,n,i,s,o,a,l){const u=Tg(s.horizontal)||s.vertical,c=r.get("icon-text-fit-padding").evaluate(n,{},i);let h,p=e;return e&&"none"!==l&&(t.allowVerticalPlacement&&s.vertical&&(h=zy(e,s.vertical,l,c,a,o)),u&&(p=zy(e,u,l,c,a,o))),{defaultShapedIcon:p,verticallyShapedIcon:h}}function Pg(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y,g,x,v){let b=o.textMaxSize.evaluate(e,{},p);void 0===b?b=a*o.textScaleFactor:b*=o.textScaleFactor;const w=t.layers[0].layout,_=Tg(r.horizontal)||r.vertical,A="globe"===d.name,M=Gm,I=t.tilePixelRatio*b/M,S=(B=t.overscaling,t.zoom>18&&B>2&&(B>>=1),Math.max(Cn/(512*B),1)*w.get("symbol-spacing")),P=w.get("text-padding")*t.tilePixelRatio,E=w.get("icon-padding")*t.tilePixelRatio,k=Mt(w.get("text-max-angle")),z="map"===w.get("icon-rotation-alignment")&&"point"!==v,T=S/2;var B;!1===t.hasAnyIconTextFit&&"none"!==y&&(t.hasAnyIconTextFit=!0);const V=e.properties?+e.properties[Su]:null,C=V&&t.elevationFeatureIdToIndex?t.elevationFeatureIdToIndex.get(V):65535,F=(a,l,v)=>{if(l.x<0||l.x>=Cn||l.y<0||l.y>=Cn)return;let b=null;if(A){const{x:t,y:e,z:r}=d.projectTilePoint(l.x,l.y,v);b={anchor:new Ry(t,e,r,0,void 0),up:d.upVector(v,l.x,l.y)};}!function(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y,g,x,v,b,w,_,A,M,I,S,P,E){const k=t.addToLineVertexArray(e,n);let z,T,B,V,C,F,D,L=0,R=0,O=0,U=0,N=-1,j=-1;const $={};let G=We("");const H=r?r.anchor:e,q="none"!==P;let X=0,Z=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")){const t=l.layout.get("text-offset").evaluate(b,{},M);X=t[0]*Gm,Z=t[1]*Gm;}else X=l.layout.get("text-radial-offset").evaluate(b,{},M)*Gm,Z=mg;if(t.allowVerticalPlacement&&i.vertical){const t=i.vertical;if(f)F=Vg(t),a&&(D=Vg(a));else {const r=l.layout.get("text-rotate").evaluate(b,{},M)+90;B=Bg(u,H,e,c,h,p,t,d,r,m),a&&(V=Bg(u,H,e,c,h,p,a,g,r));}}if(s){const n=t.iconSizeData,i=l.layout.get("icon-rotate").evaluate(b,{},M),o=sg(s,i,_,q,w.iconScaleFactor),d=a?sg(a,i,_,q,w.iconScaleFactor):void 0;T=Bg(u,H,e,c,h,p,s,g,i,null),L=4*o.length;let f=null;"source"===n.kind?(f=[Cy*l.layout.get("icon-size").evaluate(b,{},M)*w.iconScaleFactor],f[0]>kg&&Gt(`${t.layerIds[0]}: Value for "icon-size" is >= ${Eg}. Reduce your "icon-size".`)):"composite"===n.kind&&(f=[Cy*w.compositeIconSizes[0].evaluate(b,{},M)*w.iconScaleFactor,Cy*w.compositeIconSizes[1].evaluate(b,{},M)*w.iconScaleFactor],(f[0]>kg||f[1]>kg)&&Gt(`${t.layerIds[0]}: Value for "icon-size" is >= ${Eg}. Reduce your "icon-size".`)),t.addSymbols(t.icon,o,f,v,x,b,void 0,r,e,k.lineStartIndex,k.lineLength,-1,A,M,I,S),N=t.icon.placedSymbolArray.length-1,d&&(R=4*d.length,t.addSymbols(t.icon,d,f,v,x,b,my.vertical,r,e,k.lineStartIndex,k.lineLength,-1,A,M,I,S),j=t.icon.placedSymbolArray.length-1);}for(const n in i.horizontal){const s=n,a=i.horizontal[s];z||(G=We(a.text),f?C=Vg(a):z=Bg(u,H,e,c,h,p,a,d,l.layout.get("text-rotate").evaluate(b,{},M),m));const y=1===a.positionedLines.length;if(O+=zg(t,r,e,a,o,l,f,b,m,k,i.vertical?my.horizontal:my.horizontalOnly,y?fg(i.horizontal):[s],$,N,w,A,M,I),y)break}i.vertical&&(U+=zg(t,r,e,i.vertical,o,l,f,b,m,k,my.vertical,["vertical"],$,j,w,A,M,I));let W=-1;const Y=(t,e)=>t?Math.max(t,e):e;W=Y(C,W),W=Y(F,W),W=Y(D,W);const K=W>-1?1:0;t.glyphOffsetArray.length>=65535&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,H.x,H.y,H.z,$.right>=0?$.right:-1,$.center>=0?$.center:-1,$.left>=0?$.left:-1,$.vertical>=0?$.vertical:-1,N,j,G,void 0!==z?z:t.collisionBoxArray.length,void 0!==z?z+1:t.collisionBoxArray.length,void 0!==B?B:t.collisionBoxArray.length,void 0!==B?B+1:t.collisionBoxArray.length,void 0!==T?T:t.collisionBoxArray.length,void 0!==T?T+1:t.collisionBoxArray.length,V||t.collisionBoxArray.length,V?V+1:t.collisionBoxArray.length,c,O,U,L,R,K,0,X,Z,W,0,q?1:0,E);}(t,l,b,a,r,n,s,i,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,P,x,u,0,E,z,g,e,o,c,h,p,f,m,y,C);};if("line"===v)for(const i of bd(e.geometry,0,0,Cn,Cn)){const e=Gy(i,S,k,r.vertical||_,n,M,I,t.overscaling,Cn);for(const r of e)_&&Cg(t,_.text,T,r)||F(i,r,p);}else if("line-center"===v){for(const t of e.geometry)if(t.length>1){const e=$y(t,k,r.vertical||_,n,M,I);e&&F(t,e,p);}}else if("Polygon"===e.type)for(const t of Hh(e.geometry,0)){const e=hg(t,16);F(t[0],new Ry(e.x,e.y,0,0,void 0),p);}else if("LineString"===e.type)for(const t of e.geometry)F(t,new Ry(t[0].x,t[0].y,0,0,void 0),p);else if("Point"===e.type)for(const t of e.geometry)for(const e of t)F([e],new Ry(e.x,e.y,0,0,void 0),p);}const Eg=255,kg=Eg*Cy;function zg(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m,y,g){const x=function(t,e,r,n,i,s,o,a){const l=[];if(0===e.positionedLines.length)return l;const u=n.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,c=function(t){const e=t[0],r=t[1],n=e*r;return n>0?[e,-r]:n<0?[-e,r]:0===e?[r,e]:[r,-e]}(r);let h=Math.abs(e.top-e.bottom);for(const t of e.positionedLines)h-=t.lineOffset;const p=e.positionedLines.length,d=h/p;let f=e.top-r[1];for(let t=0;t<p;++t){const n=e.positionedLines[t];f=cg(e,d,f,t);for(const t of n.positionedGlyphs){if(!t.rect)continue;const n=t.rect||{};let s=fy+1,h=!0,p=1,d=0;if(t.image){const e=o.get(t.image.toString());if(!e)continue;if(e.sdf){Gt("SDF images are not supported in formatted text and will be ignored.");continue}h=!1,p=e.pixelRatio,s=Xy/p;}const m=(i||a)&&t.vertical,y=t.metrics.advance*t.scale/2,g=t.metrics,x=t.rect;if(null===x)continue;a&&e.verticalizable&&(d=t.image?y-t.metrics.width*t.scale/2:0);const v=i?[t.x+y,t.y]:[0,0];let b=[0,0],w=[0,0],_=!1;i||(m?(w=[t.x+y+c[0],t.y+c[1]-d],_=!0):b=[t.x+y+r[0],t.y+r[1]-d]);const A=x.w*t.scale/(p*(t.localGlyph?tg:1)),M=x.h*t.scale/(p*(t.localGlyph?tg:1));let I,S,P,E;if(m){const e=t.y-f,r=new bt(-y,y-e),n=-Math.PI/2,i=new bt(...w);I=new bt(-y+b[0],b[1]),I._rotateAround(n,r)._add(i),I.x+=-e+y,I.y-=(g.left-s)*t.scale;const o=t.image?g.advance*t.scale:Gm*t.scale,a=String.fromCodePoint(t.glyph);Xm(a)?I.x+=(1-s)*t.scale:Zm(a)?I.x+=o-g.height*t.scale+(-s-1)*t.scale:I.x+=t.image||g.width+2*s===x.w&&g.height+2*s===x.h?(o-M)/2:(o-(g.height+2*s)*t.scale)/2,S=new bt(I.x,I.y-A),P=new bt(I.x+M,I.y),E=new bt(I.x+M,I.y-A);}else {const e=(g.left-s)*t.scale-y+b[0],r=(-g.top-s)*t.scale+b[1],n=e+A,i=r+M;I=new bt(e,r),S=new bt(n,r),P=new bt(e,i),E=new bt(n,i);}if(u){let t;t=i?new bt(0,0):_?new bt(c[0],c[1]):new bt(r[0],r[1]),I._rotateAround(u,t),S._rotateAround(u,t),P._rotateAround(u,t),E._rotateAround(u,t);}const k=new bt(0,0),z=new bt(0,0);l.push({tl:I,tr:S,bl:P,br:E,texPrimary:n,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:v,sectionIndex:t.sectionIndex,isSDF:h,pixelOffsetTL:k,pixelOffsetBR:z,minFontScaleX:0,minFontScaleY:0});}}return l}(0,n,l,s,o,a,i,t.allowVerticalPlacement),v=t.textSizeData;let b=null;"source"===v.kind?(b=[Cy*s.layout.get("text-size").evaluate(a,{},y)*f.textScaleFactor],b[0]>kg&&Gt(`${t.layerIds[0]}: Value for "text-size" is >= ${Eg}. Reduce your "text-size".`)):"composite"===v.kind&&(b=[Cy*f.compositeTextSizes[0].evaluate(a,{},y)*f.textScaleFactor,Cy*f.compositeTextSizes[1].evaluate(a,{},y)*f.textScaleFactor],(b[0]>kg||b[1]>kg)&&Gt(`${t.layerIds[0]}: Value for "text-size" is >= ${Eg}. Reduce your "text-size".`)),t.addSymbols(t.text,x,b,l,o,a,c,e,r,u.lineStartIndex,u.lineLength,d,m,y,g,!1);for(const e of h)p[e]=t.text.placedSymbolArray.length-1;return 4*x.length}function Tg(t){for(const e in t)return t[e];return null}function Bg(t,e,r,n,i,s,o,a,l,u){let c=o.top,h=o.bottom,p=o.left,d=o.right;if(Ey(o)&&o.collisionPadding){const t=o.collisionPadding;p-=t[0],c-=t[1],d+=t[2],h+=t[3];}if(l){const t=new bt(p,c),e=new bt(d,c),r=new bt(p,h),n=new bt(d,h),i=Mt(l);let s=new bt(0,0);u&&(s=new bt(u[0],u[1])),t._rotateAround(i,s),e._rotateAround(i,s),r._rotateAround(i,s),n._rotateAround(i,s),p=Math.min(t.x,e.x,r.x,n.x),d=Math.max(t.x,e.x,r.x,n.x),c=Math.min(t.y,e.y,r.y,n.y),h=Math.max(t.y,e.y,r.y,n.y);}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,p,c,d,h,a,n,i,s),t.length-1}function Vg(t){Ey(t)&&t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Cg(t,e,r,n){const i=t.compareText;if(e in i){const t=i[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<r)return !0}else i[e]=[];return i[e].push(n),!1}function Fg(t,e){const r=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,i=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),s=Math.sin(r)*i/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01));let o=Math.sin(t._pitch)*s+i;const a=i*(1/t._horizonShift);if(!t.elevation||0===t.elevation.exaggeration()){let e=Math.max(t.zoom-17,0);t.isOrthographic&&(e/=10),o*=1+e;}return Math.min(1.01*o,a)}function Dg(t,e){if(!e.isReprojectedInTileSpace)return {scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),n=t.x*r,i=(t.x+1)*r,s=t.y*r,o=(t.y+1)*r,a=eu(n),l=eu(i),u=ru(s),c=ru(o),h=e.project(a,u),p=e.project(l,u),d=e.project(l,c),f=e.project(a,c);let m=Math.min(h.x,p.x,d.x,f.x),y=Math.min(h.y,p.y,d.y,f.y),g=Math.max(h.x,p.x,d.x,f.x),x=Math.max(h.y,p.y,d.y,f.y);const v=r/16;function b(t,r,n,i,s,o){const a=(n+s)/2,l=(i+o)/2,u=e.project(eu(a),ru(l)),c=Math.max(0,m-u.x,y-u.y,u.x-g,u.y-x);m=Math.min(m,u.x),g=Math.max(g,u.x),y=Math.min(y,u.y),x=Math.max(x,u.y),c>v&&(b(t,u,n,i,a,l),b(u,r,a,l,s,o));}b(h,p,n,s,i,s),b(p,d,i,s,i,o),b(d,f,i,o,n,o),b(f,h,n,o,n,s),m-=v,y-=v,g+=v,x+=v;const w=1/Math.max(g-m,x-y);return {scale:w,x:m*w,y:y*w,x2:g*w,y2:x*w,projection:e}}function Lg(t,{x:e,y:r},n=0){return new bt(((e-n)*t.scale-t.x)*Cn,(r*t.scale-t.y)*Cn)}const Rg=l(new Float32Array(16));class Og{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7];}project(t,e){return {x:0,y:0,z:0}}unproject(t,e){return new Xl(0,0)}projectTilePoint(t,e,r){return {x:t,y:e,z:0}}locationPoint(t,e,r,n=!0){return t._coordinatePoint(t.locationCoordinate(e,r),n)}pixelsPerMeter(t,e){return tu(1,t)*e}pixelSpaceConversion(t,e,r){return 1}farthestPixelDistance(t){return Fg(t,t.pixelsPerMeter)}pointCoordinate(t,e,r,n){const i=t.horizonLineFromTop(!1),s=new bt(e,Math.max(i,r));return t.rayIntersectionCoordinate(t.pointRayIntersection(s,n))}pointCoordinate3D(t,e,r){const n=new bt(e,r);if(t.elevation)return t.elevation.pointCoordinate(n);{const e=this.pointCoordinate(t,n.x,n.y,0);return [e.x,e.y,e.z]}}isPointAboveHorizon(t,e){if(t.elevation&&t.elevation.visibleDemTiles.length)return !this.pointCoordinate3D(t,e.x,e.y);const r=t.horizonLineFromTop();return e.y<r}createInversionMatrix(t,e){return Rg}createTileMatrix(t,e,r){let n,i,s;const o=r.canonical,a=l(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=Dg(o,this);n=1,i=l.x+r.wrap*l.scale,s=l.y,p(a,a,[n/l.scale,n/l.scale,t.pixelsPerMeter/e]);}else n=e/t.zoomScale(o.z),i=(o.x+Math.pow(2,o.z)*r.wrap)*n,s=o.y*n;return h(a,a,[i,s,0]),p(a,a,[n/Cn,n/Cn,1]),a}upVector(t,e,r){return [0,0,1]}upVectorScale(t,e,r){return {metersToTile:1}}}class Ug extends Og{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,r]=this.parallels=t.parallels||[29.5,45.5],n=Math.sin(Mt(e));this.n=(n+Math.sin(Mt(r)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n;}project(t,e){const{n:r,c:n,r0:i}=this,s=Mt(t-this.center[0]),o=Mt(e),a=Math.sqrt(n-2*r*Math.sin(o))/r;return {x:a*Math.sin(s*r),y:a*Math.cos(s*r)-i,z:0}}unproject(t,e){const{n:r,c:n,r0:i}=this,s=i+e;let o=Math.atan2(t,Math.abs(s))*Math.sign(s);s*r<0&&(o-=Math.PI*Math.sign(t)*Math.sign(s));const a=Mt(this.center[0])*r;o=Bt(o,-Math.PI-a,Math.PI-a);const l=zt(It(o/r)+this.center[0],-180,180),u=Math.asin(zt((n-(t*t+s*s)*r*r)/(2*r),-1,1)),c=zt(It(u),-iu,iu);return new Xl(l,c)}}const Ng=1.340264,jg=-.081106,$g=893e-6,Gg=.003796,Hg=Math.sqrt(3)/2;class qg extends Og{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(Hg*Math.sin(e)),n=r*r,i=n*n*n;return {x:.5*(t*Math.cos(r)/(Hg*(Ng+3*jg*n+i*(7*$g+9*Gg*n)))/Math.PI+.5),y:1-.5*(r*(Ng+jg*n+i*($g+Gg*n))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=r*r,i=n*n*n;for(let t,s,o,a=0;a<12&&(s=r*(Ng+jg*n+i*($g+Gg*n))-e,o=Ng+3*jg*n+i*(7*$g+9*Gg*n),t=s/o,r=zt(r-t,-Math.PI/3,Math.PI/3),n=r*r,i=n*n*n,!(Math.abs(t)<1e-12));++a);const s=Hg*t*(Ng+3*jg*n+i*(7*$g+9*Gg*n))/Math.cos(r),o=Math.asin(Math.sin(r)/Hg),a=zt(180*s/Math.PI,-180,180),l=zt(180*o/Math.PI,-iu,iu);return new Xl(a,l)}}class Xg extends Og{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0;}project(t,e){return {x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const r=360*(t-.5),n=zt(360*(.5-e),-iu,iu);return new Xl(r,n)}}const Zg=Math.PI/2;function Wg(t){return Math.tan((Zg+t)/2)}class Yg extends Og{constructor(t){super(t),this.center=t.center||[0,30];const[e,r]=this.parallels=t.parallels||[30,30];let n=Mt(e),i=Mt(r);this.southernCenter=n+i<0,this.southernCenter&&(n=-n,i=-i);const s=Math.cos(n),o=Wg(n);this.n=n===i?Math.sin(n):Math.log(s/Math.cos(i))/Math.log(Wg(i)/o),this.f=s*Math.pow(Wg(n),this.n)/this.n;}project(t,e){e=Mt(e),this.southernCenter&&(e=-e),t=Mt(t-this.center[0]);const r=1e-6,{n,f:i}=this;i>0?e<-Zg+r&&(e=-Zg+r):e>Zg-r&&(e=Zg-r);const s=i/Math.pow(Wg(e),n);let o=s*Math.sin(n*t),a=i-s*Math.cos(n*t);return o=.5*(o/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:o,y:this.southernCenter?a:1-a,z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,this.southernCenter&&(e=1-e),e=(2*(1-e)-.5)*Math.PI;const{n:r,f:n}=this,i=n-e,s=Math.sign(i),o=Math.sign(r)*Math.sqrt(t*t+i*i);let a=Math.atan2(t,Math.abs(i))*s;i*r<0&&(a-=Math.PI*Math.sign(t)*s);const l=zt(It(a/r)+this.center[0],-180,180),u=zt(It(2*Math.atan(Math.pow(n/o,1/r))-Zg),-iu,iu);return new Xl(l,this.southernCenter?-u:u)}}class Kg extends Og{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null;}project(t,e){return {x:Jl(t),y:Ql(e),z:0}}unproject(t,e){const r=eu(t),n=ru(e);return new Xl(r,n)}}const Jg=Mt(iu);class Qg extends Og{project(t,e){const r=(e=Mt(e))*e,n=r*r;return {x:.5*((t=Mt(t))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=25,i=0,s=r*r;do{s=r*r;const t=s*s;i=(r*(1.007226+s*(.015085+t*(.028874*s-.044475-.005916*t)))-e)/(1.007226+s*(.045255+t*(.259866*s-.311325-.005916*11*t))),r=zt(r-i,-Jg,Jg);}while(Math.abs(i)>1e-6&&--n>0);s=r*r;const o=zt(It(t/(.8707+s*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979))),-180,180),a=It(r);return new Xl(o,a)}}const tx=Mt(iu);class ex extends Og{project(t,e){e=Mt(e),t=Mt(t);const r=Math.cos(e),n=2/Math.PI,i=Math.acos(r*Math.cos(t/2)),s=Math.sin(i)/i,o=.5*(t*n+2*r*Math.sin(t/2)/s)||0,a=.5*(e+Math.sin(e)/s)||0;return {x:.5*(o/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(t,e){let r=t=(2*t-.5)*Math.PI,n=e=(2*(1-e)-1)*Math.PI,i=25;const s=1e-6;let o=0,a=0;do{const i=Math.cos(n),s=Math.sin(n),l=2*s*i,u=s*s,c=i*i,h=Math.cos(r/2),p=Math.sin(r/2),d=2*h*p,f=p*p,m=1-c*h*h,y=m?1/m:0,g=m?Math.acos(i*h)*Math.sqrt(1/m):0,x=.5*(2*g*i*p+2*r/Math.PI)-t,v=.5*(g*s+n)-e,b=.5*y*(c*f+g*i*h*u)+1/Math.PI,w=y*(d*l/4-g*s*p),_=.125*y*(l*p-g*s*c*d),A=.5*y*(u*h+g*f*i)+.5,M=w*_-A*b;o=(v*w-x*A)/M,a=(x*_-v*b)/M,r=zt(r-o,-Math.PI,Math.PI),n=zt(n-a,-tx,tx);}while((Math.abs(o)>s||Math.abs(a)>s)&&--i>0);return new Xl(It(r),It(n))}}class rx extends Og{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Mt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0;}project(t,e){const{scale:r,cosPhi:n}=this;return {x:Mt(t)*n*r+.5,y:-Math.sin(Mt(e))/n*r+.5,z:0}}unproject(t,e){const{scale:r,cosPhi:n}=this,i=-(e-.5)/r,s=zt(It((t-.5)/r)/n,-180,180),o=Math.asin(zt(i*n,-1,1)),a=zt(It(o),-iu,iu);return new Xl(s,a)}}class nx extends Kg{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5];}projectTilePoint(t,e,r){const n=Dc(t,e,r);return O(n,n,Oc(zc(r))),{x:n[0],y:n[1],z:n[2]}}locationPoint(t,e,r){const n=Gl(e.lat,e.lng),i=F([],n),s=r?t._centerAltitude+r:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(e),t._centerAltitude):t._centerAltitude;T(n,n,i,tu(1,0)*Cn*s);const o=l(new Float64Array(16));return c(o,t.pixelMatrix,t.globeMatrix),O(n,n,o),new bt(n[0],n[1])}pixelsPerMeter(t,e){return tu(1,0)*e}pixelSpaceConversion(t,e,r){const n=tu(1,t)*e,i=ur(tu(1,45)*e,n,r);return this.pixelsPerMeter(t,e)/i}createTileMatrix(t,e,r){const n=Uc(zc(r.canonical));return c(new Float64Array(16),t.globeMatrix,n)}createInversionMatrix(t,e){const{center:r}=t,n=Oc(zc(e));return f(n,n,Mt(r.lng)),d(n,n,Mt(r.lat)),p(n,n,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(t,e,r,n){return Pc(t,e,r,!0)||new uu(0,0)}pointCoordinate3D(t,e,r){const n=this.pointCoordinate(t,e,r,0);return [n.x,n.y,n.z]}isPointAboveHorizon(t,e){return !Pc(t,e.x,e.y,!1)}farthestPixelDistance(t){const e=function(t,e){const r=t.cameraToCenterDistance,n=t._centerAltitude*e,i=t._camera,s=t._camera.forward(),o=I([],z([],s,-r),[0,0,n]),a=t.worldSize/(2*Math.PI),l=[0,0,-a],u=t.width/t.height,c=Math.tan(t.fovAboveCenter),h=z([],i.up(),c),p=z([],i.right(),c*u),d=F([],I([],I([],s,h),p)),f=[];let m;if(new Cu(o,d).closestPointOnSphere(l,a,f)){const e=I([],f,l),r=G([],e,o);m=Math.cos(t.fovAboveCenter)*_(r);}else {const t=G([],o,l),e=G([],l,o);F(e,e);const r=_(t)-a;m=Math.sqrt(r*(r+2*a));const n=Math.acos(m/(a+r))-Math.acos(D(s,e));m*=Math.cos(n);}return 1.01*m}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),r=Gc(t.zoom);if(r>0){const n=Fg(t,tu(1,t.center.lat)*t.worldSize),i=t.worldSize/(2*Math.PI),s=Math.max(t.width,t.height)/t.worldSize*Math.PI;return ur(e,n+i*(1-Math.cos(s)),Math.pow(r,10))}return e}upVector(t,e,r){return Dc(e,r,t,1)}upVectorScale(t){return {metersToTile:Ic(Lc(zc(t)))}}}function ix(t){const e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case "mercator":return new Kg(t);case "equirectangular":return new Xg(t);case "naturalEarth":return new Qg(t);case "equalEarth":return new qg(t);case "winkelTripel":return new ex(t);case "albers":return r?new rx(t):new Ug(t);case "lambertConformalConic":return r?new rx(t):new Yg(t);case "globe":return new nx(t)}throw new Error(`Invalid projection name: ${t.name}`)}const sx=vu.types,ox=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ax(t,e,r,n,i,s,o,a,l,u,c,h,p){const d=a?Math.min(kg,Math.round(a[0])):0,f=a?Math.min(kg,Math.round(a[1])):0;t.emplaceBack(e,r,Math.round(32*n),Math.round(32*i),s,o,(d<<1)+(l?1:0),f,16*u,16*c,256*h,256*p);}function lx(t,e,r){t.emplaceBack(e,r);}function ux(t,e,r,n,i,s,o){t.emplaceBack(e,r,n,i,s,o);}const cx=(t,e,r,n)=>{for(let i=0;i<e;i++)t.emplaceBack(r[0],r[1],r[2],n[0],n[1],n[2]);};function hx(t,e,r,n,i){t.emplaceBack(e,r,n,i),t.emplaceBack(e,r,n,i),t.emplaceBack(e,r,n,i),t.emplaceBack(e,r,n,i);}function px(t){for(const e of t.sections)if(oo(e.text))return !0;return !1}class dx{constructor(t){this.layoutVertexArray=new ma,this.indexArray=new Ma,this.programConfigurations=t,this.segments=new el,this.dynamicLayoutVertexArray=new ga,this.opacityVertexArray=new xa,this.placedSymbolArray=new ja,this.iconTransitioningVertexArray=new va,this.globeExtVertexArray=new ya,this.zOffsetVertexArray=new oa,this.orientationVertexArray=new Pa;}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,e,r,n,i){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Dm.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,ox,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,Om.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Fm.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||i)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Lm.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=t.createVertexBuffer(this.orientationVertexArray,Rm.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(t));}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy());}}qs(dx,"SymbolBuffers");class fx{constructor(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new el,this.collisionVertexArray=new Aa,this.collisionVertexArrayExt=new ga;}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Um.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Nm.members,!0);}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy());}}qs(fx,"CollisionBuffers");class mx{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=l([]),this.placementViewportMatrix=l([]);const e=this.layers[0]._unevaluatedLayout._values;this.worldview=t.worldview,this.textSizeData=Fy(this.zoom,e["text-size"],this.worldview),this.iconSizeData=Fy(this.zoom,e["icon-size"],this.worldview);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map((t=>my[t])),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1;}createArrays(){this.text=new dx(new kl(this.layers,{zoom:this.zoom,lut:this.lut},(t=>t.startsWith("text")||t.startsWith("symbol")))),this.icon=new dx(new kl(this.layers,{zoom:this.zoom,lut:this.lut},(t=>t.startsWith("icon")||t.startsWith("symbol")))),this.glyphOffsetArray=new Ha,this.lineVertexArray=new qa,this.symbolInstances=new Ga;}calculateGlyphDependencies(t,e,r,n,i){for(const r of t){const t=r.codePointAt(0);if(void 0===t)break;if(e[t]=!0,n&&i&&t<=65535){const t=qm[r];t&&(e[t.charCodeAt(0)]=!0);}}}updateFootprints(t,e){}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return !1;this.replacementUpdateTime=e.updateTime;const r=e.getReplacementRegionsForTile(t.toUnwrapped(),!0);return !zp(this.activeReplacements,r)&&(this.activeReplacements=r,!0)}populate(t,e,r,n){const i=this.layers[0],s=i.layout,o="globe"===this.projection.name,a=s.get("text-font"),l=s.get("text-field"),u=s.get("icon-image"),[c,h]=s.get("icon-size-scale-range"),p=zt(e.scaleFactor||1,c,h),d=("constant"!==l.value.kind||l.value.value instanceof Cr&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),f="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,m=s.get("symbol-sort-key");if(this.features=[],!d&&!f)return;const y=e.iconDependencies,g=e.glyphDependencies,x=e.availableImages,v=new xo(this.zoom,{worldview:this.worldview});for(const{feature:e,id:l,index:u,sourceLayerIndex:c}of t){const t=i._featureFilter.needGeometry,h=xu(e,t);if(!i._featureFilter.filter(v,h,r))continue;if(t||(h.geometry=gu(e,r,n)),o&&1!==e.type&&r.z<=5){const t=h.geometry,e=.98078528056,n=(t,n)=>D(Dc(t.x,t.y,r,1),Dc(n.x,n.y,r,1))<e;for(let e=0;e<t.length;e++)t[e]=du(t[e],n);}let b,w;if(d){const t=i.getValueAndResolveTokens("text-field",h,r,x),e=Cr.factory(t);px(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===mo()||this.hasRTLText&&go.isParsed())&&(b=Hm(e,i,h));}if(f){const t=i.getValueAndResolveTokens("icon-image",h,r,x);w="string"==typeof t?Dr.build(t):t;}if(!b&&!w)continue;const _=this.sortFeaturesByKey?m.evaluate(h,{},r):void 0,A={id:l,text:b,icon:w,index:u,sourceLayerIndex:c,geometry:h.geometry,properties:e.properties,type:sx[e.type],sortKey:_};if(this.features.push(A),w){const t=this.layers[0]._unevaluatedLayout._values,{iconPrimary:e,iconSecondary:n}=bg(w,this.iconSizeData,t["icon-size"],r,this.zoom,A,this.pixelRatio,p,this.worldview),i=e.id.toString();if(y.has(i)?y.get(i).push(e):y.set(i,[e]),n){this.hasAnySecondaryIcon=!0;const t=n.id.toString();y.has(t)?y.get(t).push(n):y.set(t,[n]);}}if(b){const t=a.evaluate(h,{},r).join(","),e="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(my.vertical)>=0;for(const r of b.sections)if(r.image){const t=r.image.getPrimary().scaleSelf(this.pixelRatio),e=t.id.toString(),n=y.get(e)||[];n.push(t),y.set(e,n);}else {const n=Js(b.toString()),i=r.fontStack||t,s=g[i]=g[i]||{};this.calculateGlyphDependencies(r.text,s,e,this.allowVerticalPlacement,n);}}}if("line"===s.get("symbol-placement")&&(this.features=function(t){const e={},r={},n=[];let i=0;function s(e){n.push(t[e]),i++;}function o(t,e,i){const s=r[t];return delete r[t],r[e]=s,n[s].geometry[0].pop(),n[s].geometry[0]=n[s].geometry[0].concat(i[0]),s}function a(t,r,i){const s=e[r];return delete e[r],e[t]=s,n[s].geometry[0].shift(),n[s].geometry[0]=i[0].concat(n[s].geometry[0]),s}function l(t,e,r){const n=r?e[0][e[0].length-1]:e[0][0];return `${t}:${n.x}:${n.y}`}for(let u=0;u<t.length;u++){const c=t[u],h=c.geometry,p=c.text?c.text.toString():null;if(!p){s(u);continue}const d=l(p,h),f=l(p,h,!0);if(d in r&&f in e&&r[d]!==e[f]){const t=a(d,f,h),i=o(d,f,n[t].geometry);delete e[d],delete r[f],r[l(p,n[i].geometry,!0)]=i,n[t].geometry=null;}else d in r?o(d,f,h):f in e?a(d,f,h):(s(u),e[d]=i-1,r[f]=i-1);}return n.filter((t=>t.geometry))}(this.features)),"hd-road-markup"===s.get("symbol-elevation-reference")){if(this.elevationType="road",e.elevationFeatures){!this.elevationFeatures&&e.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const t of e.elevationFeatures)this.elevationFeatureIdToIndex.set(t.id,this.elevationFeatures.length),this.elevationFeatures.push(t);}}else s.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey));}update(t,e,r,n,i,s,o){this.text.programConfigurations.updatePaintArrays(t,e,i,r,n,s,o,this.worldview),this.icon.programConfigurations.updatePaintArrays(t,e,i,r,n,s,o,this.worldview);}updateRoadElevation(t){if("road"!==this.elevationType||!this.elevationFeatures)return;if(this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;const r=lu(t),n=1/r;let i=!1,s=!1;for(let t=0;t<this.symbolInstances.length;t++){const o=this.symbolInstances.get(t),a=A(1,0,0),l=A(0,1,0),{numHorizontalGlyphVertices:u,numVerticalGlyphVertices:c,numIconVertices:h,numVerticalIconVertices:p}=o,d=u>0||c>0,f=h>0,m=this.elevationFeatures[o.elevationFeatureIndex];if(m){const t=new bt(o.tileAnchorX,o.tileAnchorY),u=.075+m.pointElevation(t);o.zOffset!==u&&(e=!0,o.zOffset=u);const c=m.computeSlopeNormal(t,n),h=st(K(),A(0,0,1),c);N(a,a,h),N(l,l,h),a[2]*=r,l[2]*=r,1===a[0]&&0===a[1]&&0===a[2]&&0===l[0]&&1===l[1]&&0===l[2]||(i=i||d,s=s||f);}if(d&&(cx(this.text.orientationVertexArray,u,a,l),cx(this.text.orientationVertexArray,c,a,l)),f){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:e}=o;t>=0&&cx(this.icon.orientationVertexArray,h,a,l),e>=0&&cx(this.icon.orientationVertexArray,p,a,l);}}i||(this.text.orientationVertexArray=void 0),s||(this.icon.orientationVertexArray=void 0),e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0);}updateZOffset(){const t=(t,e,n)=>{r+=e,r>t.length&&t.resize(r);for(let i=-e;i<0;i++)t.emplace(i+r,n);},e=(t,e,r)=>{n+=e,n>t.length&&t.resize(n);for(let i=-e;i<0;i++)t.emplace(i+n,r);};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,n=0;for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:s,numIconVertices:o}=n,a=n.zOffset,l=o>0;if((i>0||s>0)&&(t(this.text.zOffsetVertexArray,i,a),t(this.text.zOffsetVertexArray,s,a)),l){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:r}=n;t>=0&&e(this.icon.zOffsetVertexArray,o,a),r>=0&&e(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,a);}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray);}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return !this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0;}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy();}getProjection(){return this.projectionInstance||(this.projectionInstance=ix(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();}addToLineVertexArray(t,e){const r=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:t,y:r}of e)this.lineVertexArray.emplaceBack(t,r);return {lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(t,e,r,n,i,s,o,a,l,u,c,h,p,d,f,m){const y=t.indexArray,g=t.layoutVertexArray,x=t.globeExtVertexArray,v=t.segments.prepareSegment(4*e.length,g,y,this.canOverlap?s.sortKey:void 0),b=this.glyphOffsetArray.length,w=v.vertexLength,_=this.allowVerticalPlacement&&o===my.vertical?Math.PI/2:0,A=s.text&&s.text.sections;for(let n=0;n<e.length;n++){const{tl:i,tr:o,bl:u,br:c,texPrimary:h,texSecondary:b,pixelOffsetTL:w,pixelOffsetBR:M,minFontScaleX:I,minFontScaleY:S,glyphOffset:P,isSDF:E,sectionIndex:k}=e[n],z=v.vertexLength,T=P[1];if(ax(g,l.x,l.y,i.x,T+i.y,h.x,h.y,r,E,w.x,w.y,I,S),ax(g,l.x,l.y,o.x,T+o.y,h.x+h.w,h.y,r,E,M.x,w.y,I,S),ax(g,l.x,l.y,u.x,T+u.y,h.x,h.y+h.h,r,E,w.x,M.y,I,S),ax(g,l.x,l.y,c.x,T+c.y,h.x+h.w,h.y+h.h,r,E,M.x,M.y,I,S),a){const{x:e,y:r,z:n}=a.anchor,[i,s,o]=a.up;ux(x,e,r,n,i,s,o),ux(x,e,r,n,i,s,o),ux(x,e,r,n,i,s,o),ux(x,e,r,n,i,s,o),hx(t.dynamicLayoutVertexArray,e,r,n,_);}else hx(t.dynamicLayoutVertexArray,l.x,l.y,l.z,_);if(m){const e=b||h;lx(t.iconTransitioningVertexArray,e.x,e.y),lx(t.iconTransitioningVertexArray,e.x+e.w,e.y),lx(t.iconTransitioningVertexArray,e.x,e.y+e.h),lx(t.iconTransitioningVertexArray,e.x+e.w,e.y+e.h);}y.emplaceBack(z,z+1,z+2),y.emplaceBack(z+1,z+2,z+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(P[0]),n!==e.length-1&&k===e[n+1].sectionIndex||t.programConfigurations.populatePaintArrays(g.length,s,s.index,{},p,d,f,A&&A[k],this.worldview);}const M=a?a.anchor:l;t.placedSymbolArray.emplaceBack(M.x,M.y,M.z,l.x,l.y,b,this.glyphOffsetArray.length-b,w,u,c,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],o,0,0,0,h,0);}_commitLayoutVertex(t,e,r,n,i,s,o){t.emplaceBack(e,r,n,i,s,Math.round(o.x),Math.round(o.y));}_addCollisionDebugVertices(t,e,r,n,i,s,o){const a=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=a.vertexLength,u=o.tileAnchorX,c=o.tileAnchorY;for(let t=0;t<4;t++)r.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,e,t.padding,o.zOffset),this._commitLayoutVertex(r.layoutVertexArray,n,i,s,u,c,new bt(t.x1,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,s,u,c,new bt(t.x2,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,s,u,c,new bt(t.x2,t.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,i,s,u,c,new bt(t.x1,t.y2)),a.vertexLength+=4;const h=r.indexArray;h.emplaceBack(l,l+1),h.emplaceBack(l+1,l+2),h.emplaceBack(l+2,l+3),h.emplaceBack(l+3,l),a.primitiveLength+=4;}_addTextDebugCollisionBoxes(t,e,r,n,i,s){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceTextSize(t,s,e,o);this._addCollisionDebugVertices(n,i,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s);}}_addIconDebugCollisionBoxes(t,e,r,n,i,s){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceIconSize(t,e,s.placedIconSymbolIndex);this._addCollisionDebugVertices(n,i,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s);}}generateCollisionDebugBuffers(t,e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fx(wa,jm.members,va),this.iconCollisionBox=new fx(wa,jm.members,va);const n=Ly(this.iconSizeData,t),i=Ly(this.textSizeData,t,r);for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this._addTextDebugCollisionBoxes(i,t,e,s.textBoxStartIndex,s.textBoxEndIndex,s),this._addTextDebugCollisionBoxes(i,t,e,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._addIconDebugCollisionBoxes(n,t,e,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._addIconDebugCollisionBoxes(n,t,e,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s);}}getSymbolInstanceTextSize(t,e,r,n){const i=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:n),s=Dy(this.textSizeData,t,i)/Gm;return this.tilePixelRatio*s}getSymbolInstanceIconSize(t,e,r){const n=this.icon.placedSymbolArray.get(r),i=Dy(this.iconSizeData,t,n);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(t,e,r,n){t.emplaceBack(e,-r,-r,n),t.emplaceBack(e,r,-r,n),t.emplaceBack(e,r,r,n),t.emplaceBack(e,-r,r,n);}_updateTextDebugCollisionBoxes(t,e,r,n,i,s,o){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceTextSize(t,s,e,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,n.padding,s.zOffset);}}_updateIconDebugCollisionBoxes(t,e,r,n,i,s,o){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceIconSize(t,e,s.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,n.padding,s.zOffset);}}updateCollisionDebugBuffers(t,e,r,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Ly(this.iconSizeData,t,n),s=Ly(this.textSizeData,t,r);for(let o=0;o<this.symbolInstances.length;o++){const a=this.symbolInstances.get(o);this._updateTextDebugCollisionBoxes(s,t,e,a.textBoxStartIndex,a.textBoxEndIndex,a,r),this._updateTextDebugCollisionBoxes(s,t,e,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,r),this._updateIconDebugCollisionBoxes(i,t,e,a.iconBoxStartIndex,a.iconBoxEndIndex,a,n),this._updateIconDebugCollisionBoxes(i,t,e,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,n);}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt);}_deserializeCollisionBoxesForSymbol(t,e,r,n,i,s,o,a,l){const u={};if(e<r){const{x1:r,y1:n,x2:i,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:p,featureIndex:d}=t.get(e);u.textBox={x1:r,y1:n,x2:i,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:p},u.textFeatureIndex=d;}if(n<i){const{x1:e,y1:r,x2:i,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:p,featureIndex:d}=t.get(n);u.verticalTextBox={x1:e,y1:r,x2:i,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:p},u.verticalTextFeatureIndex=d;}if(s<o){const{x1:e,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:p,featureIndex:d}=t.get(s);u.iconBox={x1:e,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:p},u.iconFeatureIndex=d;}if(a<l){const{x1:e,y1:r,x2:n,y2:i,padding:s,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:p,featureIndex:d}=t.get(a);u.verticalIconBox={x1:e,y1:r,x2:n,y2:i,padding:s,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:p},u.verticalIconFeatureIndex=d;}return u}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex));}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,e){const r=t.placedSymbolArray.get(e),n=r.vertexStartIndex+4*r.numGlyphs;for(let e=r.vertexStartIndex;e<n;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3);}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),r=Math.cos(t),n=[],i=[],s=[];for(let t=0;t<this.symbolInstances.length;++t){s.push(t);const o=this.symbolInstances.get(t);n.push(0|Math.round(e*o.tileAnchorX+r*o.tileAnchorY)),i.push(o.featureIndex);}return s.sort(((t,e)=>n[t]-n[e]||i[e]-i[t])),s}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t);}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((t,e)=>this.symbolInstances.get(e).zOffset-this.symbolInstances.get(t).zOffset))}addToSortKeyRanges(t,e){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1});}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex);const{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:i,verticalPlacedTextSymbolIndex:s,placedIconSymbolIndex:o,verticalPlacedIconSymbolIndex:a}=e;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&i!==r&&this.addIndicesForPlacedSymbol(this.text,i),s>=0&&this.addIndicesForPlacedSymbol(this.text,s),o>=0&&this.addIndicesForPlacedSymbol(this.icon,o),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a);}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}}}let yx,gx,xx;qs(mx,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),mx.addDynamicAttributes=hx;class vx{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:mr,this.defaultValue=t;}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression);}outputDefined(){return !1}serialize(){return null}}qs(vx,"FormatSectionOverride",{omit:["defaultValue"]});const bx=()=>xx||(xx={layout:yx||(yx=new zo({"symbol-placement":new Po(To.layout_symbol["symbol-placement"]),"symbol-spacing":new Po(To.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Po(To.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Eo(To.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Po(To.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Po(To.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Po(To.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Po(To.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Po(To.layout_symbol["icon-ignore-placement"]),"icon-optional":new Po(To.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Po(To.layout_symbol["icon-rotation-alignment"]),"icon-size":new Eo(To.layout_symbol["icon-size"]),"icon-size-scale-range":new Po(To.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Eo(To.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Eo(To.layout_symbol["icon-text-fit-padding"]),"icon-image":new Eo(To.layout_symbol["icon-image"]),"icon-rotate":new Eo(To.layout_symbol["icon-rotate"]),"icon-padding":new Po(To.layout_symbol["icon-padding"]),"icon-keep-upright":new Po(To.layout_symbol["icon-keep-upright"]),"icon-offset":new Eo(To.layout_symbol["icon-offset"]),"icon-anchor":new Eo(To.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Po(To.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Po(To.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Po(To.layout_symbol["text-rotation-alignment"]),"text-field":new Eo(To.layout_symbol["text-field"]),"text-font":new Eo(To.layout_symbol["text-font"]),"text-size":new Eo(To.layout_symbol["text-size"]),"text-size-scale-range":new Po(To.layout_symbol["text-size-scale-range"]),"text-max-width":new Eo(To.layout_symbol["text-max-width"]),"text-line-height":new Eo(To.layout_symbol["text-line-height"]),"text-letter-spacing":new Eo(To.layout_symbol["text-letter-spacing"]),"text-justify":new Eo(To.layout_symbol["text-justify"]),"text-radial-offset":new Eo(To.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Po(To.layout_symbol["text-variable-anchor"]),"text-anchor":new Eo(To.layout_symbol["text-anchor"]),"text-max-angle":new Po(To.layout_symbol["text-max-angle"]),"text-writing-mode":new Po(To.layout_symbol["text-writing-mode"]),"text-rotate":new Eo(To.layout_symbol["text-rotate"]),"text-padding":new Po(To.layout_symbol["text-padding"]),"text-keep-upright":new Po(To.layout_symbol["text-keep-upright"]),"text-transform":new Eo(To.layout_symbol["text-transform"]),"text-offset":new Eo(To.layout_symbol["text-offset"]),"text-allow-overlap":new Po(To.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Po(To.layout_symbol["text-ignore-placement"]),"text-optional":new Po(To.layout_symbol["text-optional"]),visibility:new Po(To.layout_symbol.visibility)})),paint:gx||(gx=new zo({"icon-opacity":new Eo(To.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Eo(To.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Eo(To.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Eo(To.paint_symbol["text-emissive-strength"]),"icon-color":new Eo(To.paint_symbol["icon-color"]),"icon-halo-color":new Eo(To.paint_symbol["icon-halo-color"]),"icon-halo-width":new Eo(To.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Eo(To.paint_symbol["icon-halo-blur"]),"icon-translate":new Po(To.paint_symbol["icon-translate"]),"icon-translate-anchor":new Po(To.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Po(To.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Eo(To.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Eo(To.paint_symbol["text-occlusion-opacity"]),"text-color":new Eo(To.paint_symbol["text-color"],{runtimeType:vr,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Eo(To.paint_symbol["text-halo-color"]),"text-halo-width":new Eo(To.paint_symbol["text-halo-width"]),"text-halo-blur":new Eo(To.paint_symbol["text-halo-blur"]),"text-translate":new Po(To.paint_symbol["text-translate"]),"text-translate-anchor":new Po(To.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Po(To.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Po(To.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Po(To.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Po(To.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Eo(To.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},xx);class wx extends Ko{constructor(t,e,r,n){super(t,bx(),e,r,n),this._colorAdjustmentMatrix=l([]),this.hasInitialOcclusionOpacityProperties=void 0!==t.paint&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint);}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const t=[];for(const e of r)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t;}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides();}getColorAdjustmentMatrix(t,e,r,n){return this._saturation===t&&this._contrast===e&&this._brightnessMin===r&&this._brightnessMax===n||(this._colorAdjustmentMatrix=function(t,e,r,n){t=ee(t),e=te(e);const i=a(),s=t/3,o=1-2*s,l=[o,s,s,0,s,o,s,0,s,s,o,0,0,0,0,1],u=.5-.5*e,h=n-r;return c(i,[h,0,0,0,0,h,0,0,0,0,h,0,r,r,r,1],[e,0,0,0,0,e,0,0,0,0,e,0,u,u,u,1]),c(i,i,l),i}(t,e,r,n),this._saturation=t,this._contrast=e,this._brightnessMin=r,this._brightnessMax=n),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,e,r,n){const i=this.layout.get(t).evaluate(e,{},r,n),s=this._unevaluatedLayout._values[t];return s.isDataDriven()||Cs(s.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,((e,r)=>r in t?String(t[r]):""))}(e.properties,i)}createBucket(t){return new mx(t)}queryRadius(){return 0}queryIntersectsFeature(){return !1}_setPaintOverrides(){for(const t of bx().paint.overridableProperties){if(!wx.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),r=new vx(e),n=new Vs(r,e.property.specification,this.scope,this.options);let i=null;i="constant"===e.value.kind||"source"===e.value.kind?new Ds("source",n):new Ls("composite",n,e.value.zoomStops,e.value.interpolationType),this.paint._values[t]=new Io(e.property,i,e.parameters);}}_handleOverridablePaintPropertyUpdate(t,e,r){return !(!this.layout||e.isDataDriven()||r.isDataDriven())&&wx.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const r=t.get("text-field"),n=bx().paint.properties[e];let i=!1;const s=t=>{for(const e of t)if(n.overrides&&n.overrides.hasOverride(e))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof Cr)s(r.value.value.sections);else if("source"===r.value.kind){const t=e=>{i||(e instanceof Nr&&Or(e.value)===Ar?s(e.value.sections):e instanceof Hr?s(e.sections):e.eachChild(t));},e=r.value;e._styleExpression&&t(e._styleExpression.expression);}return i}getProgramIds(){return ["symbol"]}getDefaultProgramParams(t,e,r){return {config:new El(this,{zoom:e,lut:r}),overrideFog:!1}}hasElevation(){return this.layout&&"hd-road-markup"===this.layout.get("symbol-elevation-reference")}}let _x,Ax,Mx,Ix;var Sx=ea([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Px(t,e,r,n,i,a,l,u){const c=[t,e,1,r,n,1,i,a,1],h=[l,u,1],p=s([],c),[d,f,m]=U(h,h,p);return o(c,c,[d,0,0,0,f,0,0,0,m])}function Ex(t,e,r,n,i,a,l,u){const c=function(t,e,r,n,i,a,l,u){const c=Px(0,0,1,0,1,1,0,1),h=Px(t,e,r,n,i,a,l,u);return o(h,h,s([],c))}(t,e,r,n,i,a,l,u);return [c[2]/c[8]/Cn,c[5]/c[8]/Cn]}function kx(t){return [t[0],Math.min(Math.max(t[1],-iu),iu)]}class zx extends tr{constructor(t,e,r,n){super(),this.id=t,this.dispatcher=r,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=e,this._dirty=!1;}load(t,e){if(this._loaded=e||!1,this.fire(new Ye("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Ne(this.map._requestManager.transformRequest(this.url,Be.Image),((e,r)=>{this._imageRequest=null,this._loaded=!0,e?this.fire(new Ke(e)):r&&(this.image=r instanceof HTMLImageElement?de.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading());}));}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ff(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ye("data",{dataType:"source",sourceDataType:"metadata"})));}onAdd(t){this.map=t,this.load();}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ff||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy());}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let e=t[0][1],r=t[0][1];for(const n of t)n[1]>r&&(r=n[1]),n[1]<e&&(e=n[1]);const n=(r+e)/2;if(n>iu?this.onNorthPole=!0:n<-iu&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const e=t.map(uu.fromLngLat);this.tileID=function(t){let e=1/0,r=1/0,n=-1/0,i=-1/0;for(const s of t)e=Math.min(e,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y);const s=Math.max(n-e,i-r),o=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),a=Math.pow(2,o);let l=Math.floor((e+n)/2*a);return l>1&&(l-=1),new yc(o,l,Math.floor((r+i)/2*a))}(e),this.minzoom=this.maxzoom=this.tileID.z;}return this.fire(new Ye("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof ff||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1;}_prepareData(t){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture);}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const e=Dg(new yc(0,0,0),this.map.transform.projection),r=[e.projection.project(this.coordinates[0][0],this.coordinates[0][1]),e.projection.project(this.coordinates[1][0],this.coordinates[1][1]),e.projection.project(this.coordinates[2][0],this.coordinates[2][1]),e.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(t){const e=t[1].x-t[0].x,r=t[1].y-t[0].y,n=t[2].x-t[1].x,i=t[2].y-t[1].y,s=t[3].x-t[2].x,o=t[3].y-t[2].y,a=t[0].x-t[3].x,l=t[0].y-t[3].y,u=e*i-n*r,c=n*o-s*i,h=s*l-a*o,p=a*r-e*l;return u>0&&c>0&&h>0&&p>0||u<0&&c<0&&h<0&&p<0}(r))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=Dg(this.tileID,this.map.transform.projection),[i,a,l,u]=this.coordinates.map((t=>{const e=n.projection.project(t[0],t[1]);return Lg(n,e)._round()}));this.perspectiveTransform=Ex(i.x,i.y,a.x,a.y,l.x,l.y,u.x,u.y);const c=this._boundsArray=new sa;c.emplaceBack(i.x,i.y,0,0),c.emplaceBack(a.x,a.y,Cn,0),c.emplaceBack(u.x,u.y,0,Cn),c.emplaceBack(l.x,l.y,Cn,Cn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(c,Sx.members),this.boundsSegments=el.simpleSegment(0,0,4,2);const h=[],p=[kx((d=this.coordinates)[0]),kx(d[1]),kx(d[2]),kx(d[3])];var d;const[f,m,y,g]=function(t){let e=t[0][0],r=e,n=t[0][1],i=n;for(let s=1;s<t.length;s++)t[s][0]<e?e=t[s][0]:t[s][0]>r&&(r=t[s][0]),t[s][1]<n?n=t[s][1]:t[s][1]>i&&(i=t[s][1]);return [e,n,r-e,i-n]}(p);{const n=new sa,[i,a,l,u]=function(t){let e=t[0].x,r=e,n=t[0].y,i=n;for(let s=1;s<t.length;s++)t[s].x<e?e=t[s].x:t[s].x>r&&(r=t[s].x),t[s].y<n?n=t[s].y:t[s].y>i&&(i=t[s].y);return [e,n,r-e,i-n]}(r),c=t=>[(t.x-i)/l,(t.y-a)/u],[p,d,x,v]=r.map(c),b=function(t,e,r,n,i,a,l,u){const c=Px(0,0,1,0,1,1,0,1);return o(c,c,s([],Px(t,e,r,n,i,a,l,u)))}(p[0],p[1],d[0],d[1],x[0],x[1],v[0],v[1]);this.elevatedGlobePerspectiveTransform=Ex(p[0],p[1],d[0],d[1],x[0],x[1],v[0],v[1]);const w=(t,e)=>{h.push(t.lng);const r=Math.round((t.lng-f)/y*Cn),i=Math.round((t.lat-m)/g*Cn),s=c(e),o=U([],[s[0],s[1],1],b),a=Math.round(o[0]/o[2]*Cn),l=Math.round(o[1]/o[2]*Cn);n.emplaceBack(r,i,a,l);},_=r[3].x-r[0].x,A=r[3].y-r[0].y,M=r[2].x-r[1].x,I=r[2].y-r[1].y;for(let t=0;t<65;t++){const n=t/64,i=[r[0].x+n*_,r[0].y+n*A],s=[r[1].x+n*M,r[1].y+n*I],o=s[0]-i[0],a=s[1]-i[1];for(let t=0;t<65;t++){const r=t/64,n={x:i[0]+o*r,y:i[1]+a*r};w(e.projection.unproject(n.x,n.y),n);}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(n,Sx.members);}{this.maxLongitudeTriangleSize=0;let e=[],r=new Ma;const n=(t,n,i)=>{r.emplaceBack(t,n,i);const s=h[t],o=h[n],a=h[i],l=Math.min(Math.min(s,o),a),u=Math.max(Math.max(s,o),a)-l;u>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=u),e.push(l+u/2);};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const r=65*t+e,i=r+1,s=r+65,o=s+1;n(r,s,i),n(i,s,o);}[e,r]=function(t,e){const r=Array.from({length:t.length},((t,e)=>e));r.sort(((e,r)=>t[e]-t[r]));const n=[],i=new Ma;for(let s=0;s<r.length;s++){const o=r[s];n.push(t[o]);const a=3*o,l=a+1;i.emplaceBack(e.uint16[a],e.uint16[l],e.uint16[l+1]);}return [n,i]}(e,r),this.elevatedGlobeTrianglesCenterLongitudes=e,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(r);}this.elevatedGlobeSegments=el.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,y/Cn,0,g/Cn,0,0,m,f,0]);}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const e=this.map.painter.context,r=e.gl;!this._dirty||this.texture instanceof ff||(this.texture?this.texture.update(this.image):(this.texture=new df(e,this.image,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(e);}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null));}serialize(){return {type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return !1}getSegmentsForLongitude(t){const e=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!e)return null;const r=this.elevatedGlobeTrianglesCenterLongitudes;let n=(i=t+180)+360*Math.round((r[0]-i)/360);var i;const s=new el,o=(t,r)=>{s.segments.push({vertexOffset:0,primitiveOffset:t,vertexLength:e.segments[0].vertexLength,primitiveLength:r,sortKey:void 0,vaos:{}});},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(r[0]-n)<=a){const t=Qt(r,0,r.length,n+a);return t===r.length||o(t,Jt(r,t+1,r.length,n+360-a)-t),s}n<r[0]&&(n+=360);const l=Jt(r,0,r.length,n-a);if(l===r.length)return o(0,r.length),s;o(0,l-0);const u=Qt(r,l+1,r.length,n+a);return u!==r.length&&o(u,r.length-u),s}}const Tx=(Math.pow(256,2)-1)/16907520;class Bx extends Ko{constructor(t,e,r,n){super(t,{layout:Mx||(Mx=new zo({visibility:new Po(To.layout_raster.visibility)})),paint:Ix||(Ix=new zo({"raster-opacity":new Po(To.paint_raster["raster-opacity"]),"raster-color":new ko(To.paint_raster["raster-color"]),"raster-color-mix":new Po(To.paint_raster["raster-color-mix"]),"raster-color-range":new Po(To.paint_raster["raster-color-range"]),"raster-hue-rotate":new Po(To.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Po(To.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Po(To.paint_raster["raster-brightness-max"]),"raster-saturation":new Po(To.paint_raster["raster-saturation"]),"raster-contrast":new Po(To.paint_raster["raster-contrast"]),"raster-resampling":new Po(To.paint_raster["raster-resampling"]),"raster-fade-duration":new Po(To.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Po(To.paint_raster["raster-emissive-strength"]),"raster-array-band":new Po(To.paint_raster["raster-array-band"]),"raster-elevation":new Po(To.paint_raster["raster-elevation"]),"raster-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN];}getProgramIds(){return ["raster"]}hasColorMap(){return !!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return !(t&&t._source instanceof zx&&(t._source.onNorthPole||t._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||(this._curRampRange=[NaN,NaN],this.updateColorRamp());}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null);}updateColorRamp(t){if(!this.hasColorMap())return;if(!this._curRampRange)return;const e=this._transitionablePaint._values["raster-color"].value.expression,[r,n]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(n)||r===this._curRampRange[0]&&n===this._curRampRange[1]||(this.colorRamp=fh({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:n}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,n]);}}let Vx,Cx,Fx,Dx,Lx;class Rx extends Ko{constructor(t,e,r,n){super(t,{layout:Vx||(Vx=new zo({visibility:new Po(To["layout_raster-particle"].visibility)})),paint:Cx||(Cx=new zo({"raster-particle-array-band":new Po(To["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Po(To["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ko(To["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Po(To["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Po(To["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Po(To["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Po(To["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Po(To["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n),this._updateColorRamp(),this.lastInvalidatedAt=de.now();}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null);}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy();}hasColorMap(){return !!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return ["rasterParticle"]}hasOffscreenPass(){return "none"!==this.visibility}isDraped(t){return !1}_handleSpecialPaintPropertyUpdate(t){"raster-particle-color"!==t&&"raster-particle-max-speed"!==t||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===t&&this._invalidateAnimationState();}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,e=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=fh({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:e}],resolution:256}),this.colorRampTexture=null;}_invalidateAnimationState(){this.lastInvalidatedAt=de.now();}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Ox extends Ko{constructor(t,e){super(t,{},e,null),this.implementation=t,t.slot&&(this.slot=t.slot);}is3D(t){return "3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return !!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return !1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl);}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl);}}function Ux(t,e,r){const n=[0,0,1],i=J([]);return tt(i,i,r?-Mt(t)+Math.PI:Mt(t)),Q(i,i,-Mt(e)),N(n,n,i),F(n,n)}const Nx={None:0,Model:1,Symbol:2,FillExtrusion:4};class jx{constructor(t,e,r,n){this.message=(t?`${t}: `:"")+r,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__);}}function $x(t,e){const r=-1===t.indexOf("://");try{return new URL(t,r&&e?"http://example.com":void 0),!0}catch(t){return !1}}class Gx{constructor(t,e){this.feature=t,this.instancedDataOffset=e,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0];}}class Hx{constructor(){this.instancedDataArray=new Fa,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={};}}class qx{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.projection=t.projection,this.index=t.index,this.worldview=t.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=t.styleDefinedModelURLs;}updateFootprints(t,e){}populate(t,e,r,n){this.tileToMeter=lu(r);const i=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:s,id:o,index:a,sourceLayerIndex:l}of t){const t=null!=o?o:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0,u=xu(s,i);if(!this.layers[0]._featureFilter.filter(new xo(this.zoom,{worldview:this.worldview}),u,r))continue;const c={id:t,sourceLayerIndex:l,index:a,geometry:i?u.geometry:gu(s,r,n),properties:s.properties,type:s.type,patterns:{}},h=this.addFeature(c,c.geometry,u);h&&e.featureIndex.insert(s,c.geometry,a,l,this.index,this.instancesPerModel[h].instancedDataArray.length,Cn/32);}this.lookup=null;}update(t,e,r,n){for(const e in this.instancesPerModel){const r=this.instancesPerModel[e];for(const e in t)r.idToFeaturesIndex.hasOwnProperty(e)&&(this.evaluate(r.features[r.idToFeaturesIndex[e]],t[e],r,!0),this.uploaded=!1);}this.maxHeight=0;}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return !1;let t=!1;for(const e in this.instancesPerModel){const r=this.instancesPerModel[e];for(const e of r.features){const n=this.layers[0],i=e.feature,s=this.canonical,o=n.paint.get("model-rotation").evaluate(i,{},s),a=n.paint.get("model-scale").evaluate(i,{},s),l=n.paint.get("model-translation").evaluate(i,{},s);$(e.rotation,o)&&$(e.scale,a)&&$(e.translation,l)||(this.evaluate(e,e.featureStates,r,!0),t=!0);}}return t}updateReplacement(t,e,r,n){if(e.updateTime===this.replacementUpdateTime)return !1;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(zp(this.activeReplacements,i))return !1;this.activeReplacements=i;let s=!1;for(const e in this.instancesPerModel){const i=this.instancesPerModel[e],o=i.instancedDataArray;for(const e of i.features){const i=e.instancedDataOffset,a=e.instancedDataCount;for(let e=0;e<a;e++){const a=16*(e+i);let l=o.float32[a+0];const u=l>Cn;l=u?l-Cn:l;const c=Math.floor(l),h=o.float32[a+1];let p=!1;for(const e of this.activeReplacements)if(!Sp(e,r,Nx.Model,n)&&!(e.min.x>c||c>e.max.x||e.min.y>h||h>e.max.y)&&(p=Dp(Fp(c,h,t.canonical,e.footprintTileId.canonical),e.footprint),p))break;o.float32[a]=p?l+Cn:l,s=s||p!==u;}}}return s}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return !1;return !0}uploadPending(){return !this.uploaded}upload(t){if(!this.uploaded)for(const e in this.instancesPerModel){const r=this.instancesPerModel[e];r.instancedDataArray.length<0||0===r.instancedDataArray.length||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=t.createVertexBuffer(r.instancedDataArray,bf.members,!0,void 0,this.instanceCount));}this.uploaded=!0;}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy();}const t=this.layers[0].modelManager;if(t&&this.modelUris&&this.modelsRequested)for(const e of this.modelUris)t.removeModel(e,"",!0);}addFeature(t,e,r){const n=this.layers[0],i=n.layout.get("model-id").evaluate(r,{},this.canonical);if(!i)return Gt(`modelId is not evaluated for layer ${n.id} and it is not going to get rendered.`),i;($x(i,!1)||void 0!==this.styleDefinedModelURLs[i])&&(this.modelUris.includes(i)||this.modelUris.push(i)),this.instancesPerModel[i]||(this.instancesPerModel[i]=new Hx);const s=this.instancesPerModel[i],o=s.instancedDataArray,a=new Gx(r,o.length);for(const t of e)for(const e of t){if(e.x<0||e.x>=Cn||e.y<0||e.y>=Cn)continue;const t=(this.lookupDim-1)/Cn,r=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[r])continue;this.lookup[r]=1;}this.instanceCount++;const n=o.length;o.resize(n+1),s.instancesEvaluatedElevation.push(0),o.float32[16*n]=e.x,o.float32[16*n+1]=e.y;}return a.instancedDataCount=s.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(t.id&&(s.idToFeaturesIndex[t.id]=s.features.length),s.features.push(a),this.evaluate(a,{},s,!1)),i}getModelUris(){return this.modelUris}evaluate(t,e,r,n){const i=this.layers[0],s=t.feature,o=this.canonical,a=t.rotation=i.paint.get("model-rotation").evaluate(s,e,o),l=t.scale=i.paint.get("model-scale").evaluate(s,e,o),u=t.translation=i.paint.get("model-translation").evaluate(s,e,o),c=i.paint.get("model-color").evaluate(s,e,o);c.a=i.paint.get("model-color-mix-intensity").evaluate(s,e,o);const h=[];this.maxVerticalOffset<u[2]&&(this.maxVerticalOffset=u[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),Ef(h,a,l);const p=Math.round(100*c.a)+c.b/1.05;for(let e=0;e<t.instancedDataCount;++e){const i=t.instancedDataOffset+e,s=16*i,a=r.instancedDataArray.float32;let l=0;n&&(l=a[s+6]-r.instancesEvaluatedElevation[i]);const d=0|a[s+1];a[s]=(0|a[s])+c.r/1.05,a[s+1]=d+c.g/1.05,a[s+2]=p,a[s+3]=1/(o.z>10?this.tileToMeter:lu(o,d)),a[s+4]=u[0],a[s+5]=u[1],a[s+6]=u[2]+l,a[s+7]=h[0],a[s+8]=h[1],a[s+9]=h[2],a[s+10]=h[4],a[s+11]=h[5],a[s+12]=h[6],a[s+13]=h[8],a[s+14]=h[9],a[s+15]=h[10],r.instancesEvaluatedElevation[i]=u[2];}}}let Xx,Zx;qs(qx,"ModelBucket",{omit:["layers"]}),qs(Hx,"PerModelAttributes"),qs(Gx,"ModelFeature");class Wx{constructor(t,e,r){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=r;}static create(t,e,r){const n=r||t.findDEMTileFor(e);if(!n||!n.dem)return;const i=n.dem,s=n.tileID,o=1<<e.canonical.z-s.canonical.z;return new Wx(n,i.dim/Cn/o,[(e.canonical.x/o-s.canonical.x)*i.dim,(e.canonical.y/o-s.canonical.y)*i.dim])}tileCoordToPixel(t,e){const r=e*this._scale+this._offset[1];return new bt(Math.floor(t*this._scale+this._offset[0]),Math.floor(r))}getElevationAt(t,e,r,n){const i=t*this._scale+this._offset[0],s=e*this._scale+this._offset[1],o=Math.floor(i),a=Math.floor(s),l=this._dem;return n=!!n,r?ur(ur(l.get(o,a,n),l.get(o,a+1,n),s-a),ur(l.get(o+1,a,n),l.get(o+1,a+1,n),s-a),i-o):l.get(o,a,n)}getElevationAtPixel(t,e,r){return this._dem.get(t,e,!!r)}getMeterToDEM(t){return (1<<this._demTile.tileID.canonical.z)*tu(1,t)*this._dem.stride}}const Yx=new Float32Array(262144),Kx=new Uint8Array(262144);function Jx(t){let e=0;if(t.meshes)for(const r of t.meshes)e=Math.max(e,r.aabb.max[2]);if(t.children)for(const r of t.children)e=Math.max(e,Jx(r));return e}function Qx(t,e,r){if(t.meshes)for(const n of t.meshes){if(n.aabb.min[0]===1/0)continue;const i=Nu.applyTransform(n.aabb,t.matrix);r.insert(e,i.min[0],i.min[1],i.max[0],i.max[1]);}if(t.children)for(const n of t.children)Qx(n,e,r);}const tv=["","wall","door","roof","window","lamp","logo"];class ev{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:Jx(t)}},this.aabb=this._getLocalBounds(),this.state=null;}_getLocalBounds(){if(!this.node.meshes)return new Nu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const e=new Nu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.node.meshes)this.node.lightMeshIndex!==t&&(r.transformedAabb=Nu.applyTransformFast(r.aabb,this.node.matrix),e.encapsulate(r.transformedAabb)),t++;this.aabb=e;}return this.aabb}}class rv{constructor(t,e,r,n,i,s,o,a){this.id=r,this.layers=t,this.layerIds=this.layers.map((t=>t.fqid)),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.modelTraits|=Vf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=Vf.HasMapboxMeshFeatures),i&&(this.modelTraits|=Vf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=s,this.worldview=a,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const t of e)this.nodesInfo.push(new ev(t)),Qx(t,o.featureIndexArray.length,o.grid),o.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,o.bucketLayerIDs.length-1,0);this.states={};}updateFootprints(t,e){for(const r of this.getNodesInfo()){const n=r.node;n.footprint&&e.push({footprint:n.footprint,id:t});}}update(t){const e=0!==Object.keys(t).length;if(e&&!this.stateDependentLayers.length)return;const r=e?this.stateDependentLayers:this.layers;if(!wt(t,this.states))for(const e of r)this.evaluate(e,t);this.states=structuredClone(t);}populate(){console.log("populate 3D model bucket");}uploadPending(){return !this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const e=this.getNodesInfo();for(const r of e){const e=r.node;this.uploaded?this.updatePbrBuffer(e):Lf(e,t,!0);}for(const t of e)Rf(t.node);this.uploaded=!0,this.needsUpload=!1;}updatePbrBuffer(t){let e=!1;if(!t.meshes)return e;for(const r of t.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),e=!0);return e}needsReEvaluation(t,e,r){const n=t.transform.projectionOptions,i=t.style.getBrightness(),s=this.brightness!==i;if(!this.uploaded||this.dirty||n.name!==this.projection.name||nv(r.paint.get("model-color").value,s)||nv(r.paint.get("model-color-mix-intensity").value,s)||nv(r.paint.get("model-roughness").value,s)||nv(r.paint.get("model-emissive-strength").value,s)||nv(r.paint.get("model-height-based-emissive-strength-multiplier").value,s)){this.projection=n,this.brightness=i;const t=this.getNodesInfo();for(const e of t)e.state=null;return !0}return !1}evaluateTransform(t,e){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const r=this.getNodesInfo(),n=this.id.canonical;for(const t of r){const r=t.feature;t.evaluatedTranslation=e.paint.get("model-translation").evaluate(r,{},n),t.evaluatedScale=e.paint.get("model-scale").evaluate(r,{},n);}}evaluate(t,e){const r=this.getNodesInfo();for(const n of r){if(!n.node.meshes)continue;const r=n.feature,i=e&&e[r.id];if(wt(i,n.state))continue;n.state=structuredClone(i);const s=n.node.meshes&&n.node.meshes[0].featureData,o=n.evaluatedColor[2],a=n.evaluatedRMEA[2],l=this.id.canonical;if(n.hasTranslucentParts=!1,s){for(let e=0;e<tv.length;e++){const s=tv[e];s.length&&(r.properties.part=s);const o=t.paint.get("model-color").evaluate(r,i,l).toPremultipliedRenderColor(null),a=t.paint.get("model-color-mix-intensity").evaluate(r,i,l);n.evaluatedColor[e]=[o.r,o.g,o.b,a],n.evaluatedRMEA[e][0]=t.paint.get("model-roughness").evaluate(r,i,l),n.evaluatedRMEA[e][2]=t.paint.get("model-emissive-strength").evaluate(r,i,l),n.evaluatedRMEA[e][3]=o.a,n.emissionHeightBasedParams[e]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(r,i,l),!n.hasTranslucentParts&&o.a<1&&(n.hasTranslucentParts=!0);}delete r.properties.part,sv(n,o!==n.evaluatedColor[2]||a!==n.evaluatedRMEA[2],this.modelTraits);}else n.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(r,i,l);n.evaluatedTranslation=t.paint.get("model-translation").evaluate(r,i,l),n.evaluatedScale=t.paint.get("model-scale").evaluate(r,i,l),this.updatePbrBuffer(n.node)||(this.needsUpload=!0);}this.dirty=!1;}elevationUpdate(t,e,r,n){const i=t.findDEMTileFor(r);if(i&&(i.tileID.canonical!==this.terrainTile||e!==this.terrainExaggeration)){if(i.dem&&i.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=i.tileID.overscaledZ;const e=Wx.create(t,r,i);if(!e)return;this.modelTraits&Vf.HasMapboxMeshFeatures&&this.updateDEM(t,e,r,n);for(const t of this.getNodesInfo()){const r=t.node;if(!r.footprint||!r.footprint.vertices||!r.footprint.vertices.length)continue;const n=r.footprint.vertices;let i=e.getElevationAt(n[0].x,n[0].y,!0,!0);for(let t=1;t<n.length;t++)i=Math.min(i,e.getElevationAt(n[t].x,n[t].y,!0,!0));r.elevation=i;}}this.terrainTile=i.tileID.canonical,this.terrainExaggeration=e;}}updateDEM(t,e,r,n){let i=e._dem._modifiedForSources[n];if(void 0===i&&(e._dem._modifiedForSources[n]=[],i=e._dem._modifiedForSources[n]),i.includes(r.canonical))return;const s=e._dem.dim;i.push(r.canonical);let o=!1;for(const t of this.getNodesInfo()){const r=t.node;if(!r.footprint||!r.footprint.grid)continue;const n=r.footprint.grid,i=e.tileCoordToPixel(n.min.x,n.min.y),a=e.tileCoordToPixel(n.max.x,n.max.y),l=Math.min(Math.min(s-a.y,i.x),Math.min(i.y,s-a.x));if(l<0)continue;const u=zt(l,2,5);let c=Math.max(0,i.x-u),h=Math.max(0,i.y-u),p=Math.min(a.x+u,s-1),d=Math.min(a.y+u,s-1);for(let t=h;t<=d;++t)for(let e=c;e<=p;++e)Kx[t*s+e]=255;let f=0,m=0;for(let t=0;t<n.cellsY;++t)for(let r=0;r<n.cellsX;++r){if(!n.cells[t*n.cellsX+r])continue;const i=e.tileCoordToPixel(n.min.x+r/n.xScale,n.min.y+t/n.yScale),o=e.tileCoordToPixel(n.min.x+(r+1)/n.xScale,n.min.y+(t+1)/n.yScale);for(let t=i.y;t<=Math.min(o.y+1,s-1);++t)for(let r=i.x;r<=Math.min(o.x+1,s-1);++r)255===Kx[t*s+r]&&(Kx[t*s+r]=0,f+=e.getElevationAtPixel(r,t),m++);}const y=f/m;c=Math.max(1,i.x-u),h=Math.max(1,i.y-u),p=Math.min(a.x+u,s-2),d=Math.min(a.y+u,s-2),o=!0;for(let t=h;t<=d;++t)for(let r=c;r<=p;++r)0===Kx[t*s+r]&&(Yx[t*s+r]=e._dem.set(r,t,y));for(let t=1;t<u;++t){c=Math.max(1,i.x-t),h=Math.max(1,i.y-t),p=Math.min(a.x+t,s-2),d=Math.min(a.y+t,s-2);for(let r=h;r<=d;++r)for(let n=c;n<=p;++n){const i=r*s+n;if(255===Kx[i]){let o=0,a=0,l=-1,c=-1;for(let e=-1;e<=1;++e)for(let i=-1;i<=1;++i){const u=(r+e)*s+n+i;if(Kx[u]>=t)continue;const h=Yx[u],p=Math.abs(h);p>a&&(o=h,a=p,l=i,c=e);}if(a>.1){const s=1-(t+.5*Math.abs(l*c))/u;let a=e._dem.get(n,r)+o*s;const h=e._dem.get(n+l,r+c),p=e._dem.get(n-l,r-c,!0);(a-h)*(a-p)>0&&(a=(h+p)/2),Yx[i]=e._dem.set(n,r,a),Kx[i]=t;}}}}}o&&(e._demTile.needsDEMTextureUpload=!0,e._dem._timestamp=de.now());}setFilter(t){this.filter=t?Fo(t):null;}getNodesInfo(){return this.filter?this.nodesInfo.filter((t=>this.filter.filter(new xo(this.id.overscaledZ,{worldview:this.worldview}),t.feature,this.id.canonical))):this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const e of t)Rf(e.node),Of(e.node);}isEmpty(){return !this.nodesInfo.length}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const r=e.getReplacementRegionsForTile(t.toUnwrapped());for(const t of this.getNodesInfo()){const e=t.node.footprint;t.hiddenByReplacement=!!e&&!r.find((t=>t.footprint===e));}}getHeightAtTileCoord(t,e){const r=[],n=[0,0,0],i=l([]);for(const s of this.getNodesInfo()){const o=s.node.meshes[0],a=o.transformedAabb;if(t<a.min[0]||e<a.min[1]||t>a.max[0]||e>a.max[1])continue;if(!0===s.node.hidden)return {height:1/0,maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]};u(i,s.node.matrix),n[0]=t,n[1]=e,O(n,n,i);const l=(n[0]-o.aabb.min[0])/(o.aabb.max[0]-o.aabb.min[0])*Bf|0,c=Math.min(63,(n[1]-o.aabb.min[1])/(o.aabb.max[1]-o.aabb.min[1])*Bf|0)*Bf+Math.min(63,l),h=o.heightmap[c];if(!(h<0&&s.node.footprint)){if(s.hiddenByReplacement)return;return {height:h,maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]}}if(s.node.footprint.grid.query(new bt(t,e),new bt(t,e),r),r.length>0)return {height:void 0,maxHeight:s.feature.properties.height,hidden:s.hiddenByReplacement,verticalScale:s.evaluatedScale[2]}}}}function nv(t,e){return t instanceof Ds&&!t.isLightConstant&&e}function iv(t,e,r,n,i,s,o,a){let l=(61440&e|(61440&e)>>4)>>8,u=(3840&e|(3840&e)>>4)>>4,c=240&e|(240&e)>>4;r[3]>0&&(l=ur(l,255*r[0],r[3]),u=ur(u,255*r[1],r[3]),c=ur(c,255*r[2],r[3]));const h=l<<8|u,p=c<<8|Math.floor(255*n[3]),d=function(t){const e=zt(t,0,2);return Math.min(Math.round(.5*e*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],f=zt(i[0],0,1),m=zt(i[1],0,1),y=zt(i[2],0,1),g=zt(i[3],0,1);let x,v,b,w;if(f!==m&&o!==s&&m!==f){const t=o-s;v=1/(t*(m-f)),b=-(s+t*f)/(t*(m-f));const e=zt(i[4],-1,1);w=Math.pow(10,e),x=255*y<<8|255*g;}else x=65535,v=0,b=1,w=1;if(t.emplaceBack(h,p,d,x,v,b,w),a){const t=a.length;a.clear();for(let e=0;e<t;e++)a.emplaceBack(h,p,d,x,v,b,w);}}function sv(t,e,r){const n=t.node;let i=0;const s=r&Vf.HasMeshoptCompression;for(const r of n.meshes){if(n.lights&&n.lightMeshIndex===i)continue;if(!r.featureData)continue;r.featureArray=new Da,r.featureArray.reserve(r.featureData.length);let o=e;for(const e of r.featureData){const i=s?65535&e:e>>16&65535,a=s?e>>16&65535:65535&e,l=(15&a)<8?15&a:0,u=t.evaluatedRMEA[l],c=t.evaluatedColor[l],h=t.emissionHeightBasedParams[l];let p;if(o&&2===l&&n.lights&&(p=new Da,p.resize(10*n.lights.length)),iv(r.featureArray,i,c,u,h,r.aabb.min[2],r.aabb.max[2],p),p&&o){o=!1;const t=n.meshes[n.lightMeshIndex];t.featureArray=p,t.featureArray._trim();}}r.featureArray._trim(),i++;}}function ov(t,e,r,n){const i=1<<t.z;e.lat=ru((n/Cn+t.y)/i),e.lng=eu((r/Cn+t.x)/i);}function av(t,e,r,n){const i=t.getNodesInfo()[e];if(!i||i.hiddenByReplacement||!i.node.meshes)return;let s=Number.MAX_VALUE;const o=i.node,a=r.tile,l=n.calculatePosMatrix(a.tileID.toUnwrapped(),n.worldSize),u=i.evaluatedScale;let d=0;n.elevation&&o.elevation&&(d=o.elevation*n.elevation.exaggeration()),h(l,l,[(o.anchor?o.anchor[0]:0)*(u[0]-1),(o.anchor?o.anchor[1]:0)*(u[1]-1),d]),p(l,l,u);const f=r.queryGeometry,m=f.isPointQuery()?f.screenBounds:f.screenGeometry,y=function(t){const e=c([],l,t.matrix);c(e,n.expandedFarZProjMatrix,e);for(let r=0;r<t.meshes.length;++r){const i=t.meshes[r];if(r===t.lightMeshIndex)continue;const o=Tf(m,n,e,i.aabb);null!=o&&(s=Math.min(o,s));}if(t.children)for(const e of t.children)y(e);};if(y(o),s===Number.MAX_VALUE)return;const g=new Xl(0,0);return ov(a.tileID.canonical,g,i.node.anchor[0],i.node.anchor[1]),{intersectionZ:s,position:g,feature:i.feature}}qs(rv,"Tiled3dModelBucket",{omit:["layers"]}),qs(ev,"Tiled3dModelFeature");const lv={circle:class extends Ko{constructor(t,e,r,n){super(t,{layout:dc||(dc=new zo({"circle-sort-key":new Eo(To.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Po(To.layout_circle["circle-elevation-reference"]),visibility:new Po(To.layout_circle.visibility)})),paint:fc||(fc=new zo({"circle-radius":new Eo(To.paint_circle["circle-radius"]),"circle-color":new Eo(To.paint_circle["circle-color"]),"circle-blur":new Eo(To.paint_circle["circle-blur"]),"circle-opacity":new Eo(To.paint_circle["circle-opacity"]),"circle-translate":new Po(To.paint_circle["circle-translate"]),"circle-translate-anchor":new Po(To.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Po(To.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Po(To.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Eo(To.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Eo(To.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Eo(To.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Po(To.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n);}createBucket(t){return new qu(t)}queryRadius(t){const e=t;return uc("circle-radius",this,e)+uc("circle-stroke-width",this,e)+cc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,n,i,s,o,a){const l=pc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),u=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Jc(t,n,s,o,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,u)}getProgramIds(){return ["circle"]}getDefaultProgramParams(t,e,r){const n=Kc(this);return {config:new El(this,{zoom:e,lut:r}),defines:n,overrideFog:!1}}is3D(t){return !t&&!!this.layout&&"none"!==this.layout.get("circle-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("circle-elevation-reference")}},heatmap:class extends Ko{createBucket(t){return new nh(t)}constructor(t,e,r,n){super(t,{layout:ih||(ih=new zo({visibility:new Po(To.layout_heatmap.visibility)})),paint:sh||(sh=new zo({"heatmap-radius":new Eo(To.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Eo(To.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Po(To.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ko(To.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Po(To.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n),this._updateColorRamp();}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp();}_updateColorRamp(){this.colorRamp=fh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null;}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null);}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null);}queryRadius(t){return uc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,n,i,s,o,a){const l=this.paint.get("heatmap-radius").evaluate(e,r);return Jc(t,n,s,o,a,!0,!0,new bt(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return ["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,r){return "heatmap"===t?{config:new El(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Ko{constructor(t,e,r,n){super(t,{layout:oh||(oh=new zo({visibility:new Po(To.layout_hillshade.visibility)})),paint:ah||(ah=new zo({"hillshade-illumination-direction":new Po(To.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Po(To.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Po(To.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Po(To.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Po(To.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Po(To.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Po(To.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n);}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return ["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,r){return {overrideFog:!1}}},fill:class extends Ko{constructor(t,e,r,n){super(t,{layout:cp||(cp=new zo({"fill-sort-key":new Eo(To.layout_fill["fill-sort-key"]),visibility:new Po(To.layout_fill.visibility),"fill-elevation-reference":new Po(To.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Eo(To.layout_fill["fill-construct-bridge-guard-rail"])})),paint:hp||(hp=new zo({"fill-antialias":new Po(To.paint_fill["fill-antialias"]),"fill-opacity":new Eo(To.paint_fill["fill-opacity"]),"fill-color":new Eo(To.paint_fill["fill-color"]),"fill-outline-color":new Eo(To.paint_fill["fill-outline-color"]),"fill-translate":new Po(To.paint_fill["fill-translate"]),"fill-translate-anchor":new Po(To.paint_fill["fill-translate-anchor"]),"fill-pattern":new Eo(To.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Po(To.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Po(To.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Eo(To.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Eo(To.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Eo(To.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n);}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(t,e,r){return {config:new El(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"]);}createBucket(t){return new up(t)}queryRadius(){return cc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,n,i,s){return !t.queryGeometry.isAboveHorizon&&Wu(hc(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(t){if(0!==this.paint.get("fill-z-offset").constantOr(1))return !0;const e=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=t?e&&!t:e}hasElevation(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}hasShadowPass(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}},"fill-extrusion":class extends Ko{constructor(t,e,r,n){super(t,{layout:fd||(fd=new zo({visibility:new Po(To["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Po(To["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:md||(md=new zo({"fill-extrusion-opacity":new Po(To["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Eo(To["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Po(To["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Po(To["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Eo(To["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Po(To["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Eo(To["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Eo(To["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Po(To["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Po(To["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Po(To["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Po(To["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Po(To["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Po(To["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Po(To["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Po(To["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Po(To["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Po(To["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Eo(To["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Eo(To["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Po(To["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Po(To["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Po(To["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Po(To["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Eo(To["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Eo(To["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Po(To["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0};}createBucket(t){return new nd(t)}queryRadius(){return cc(this.paint.get("fill-extrusion-translate"))}is3D(t){return !0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return !0}getProgramIds(){return [this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,r,n,i,s,o,a,l){const u=pc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),c=this.paint.get("fill-extrusion-height").evaluate(e,r),h=this.paint.get("fill-extrusion-base").evaluate(e,r),p=[0,0],d=a&&s.elevation,f=s.elevation?s.elevation.exaggeration():1,m=t.tile.getBucket(this);if(d&&m instanceof nd){const t=m.centroidVertexArray,e=l+1;e<t.length&&(p[0]=t.geta_centroid_pos0(e),p[1]=t.geta_centroid_pos1(e));}if(0===p[0]&&1===p[1])return !1;"globe"===s.projection.name&&(n=pd([n],[new bt(0,0),new bt(Cn,Cn)],t.tileID.canonical).map((t=>t.polygon)).flat());const y=d?a:null,[g,x]=function(t,e,r,n,i,s,o,a,l,u,c){return "globe"===t.projection.name?function(t,e,r,n,i,s,o,a,l,u,c){const h=[],p=[],d=t.projection.upVectorScale(c,t.center.lat,t.worldSize).metersToTile,f=[0,0,0,1],m=[0,0,0,1],y=(t,e,r,n)=>{t[0]=e,t[1]=r,t[2]=n,t[3]=1;},g=hd();r>0&&(r+=g),n+=g;for(const g of e){const e=[],x=[];for(const h of g){const p=h.x+i.x,g=h.y+i.y,v=t.projection.projectTilePoint(p,g,c),b=t.projection.upVector(c,h.x,h.y);let w=r,_=n;if(o){const t=Id(p,g,r,n,o,a,l,u);w+=t.base,_+=t.top;}0!==r?y(f,v.x+b[0]*d*w,v.y+b[1]*d*w,v.z+b[2]*d*w):y(f,v.x,v.y,v.z),y(m,v.x+b[0]*d*_,v.y+b[1]*d*_,v.z+b[2]*d*_),O(f,f,s),O(m,m,s),e.push(new yd(f[0],f[1],f[2])),x.push(new yd(m[0],m[1],m[2]));}h.push(e),p.push(x);}return [h,p]}(t,e,r,n,i,s,o,a,l,u,c):o?function(t,e,r,n,i,s,o,a,l){const u=[],c=[],h=[0,0,0,1];for(const p of t){const t=[],d=[];for(const u of p){const c=u.x+n.x,p=u.y+n.y,f=Id(c,p,e,r,s,o,a,l);h[0]=c,h[1]=p,h[2]=f.base,h[3]=1,Y(h,h,i),h[3]=Math.max(h[3],1e-5);const m=new yd(h[0]/h[3],h[1]/h[3],h[2]/h[3]);h[0]=c,h[1]=p,h[2]=f.top,h[3]=1,Y(h,h,i),h[3]=Math.max(h[3],1e-5);const y=new yd(h[0]/h[3],h[1]/h[3],h[2]/h[3]);t.push(m),d.push(y);}u.push(t),c.push(d);}return [u,c]}(e,r,n,i,s,o,a,l,u):function(t,e,r,n,i){const s=[],o=[],a=i[8]*e,l=i[9]*e,u=i[10]*e,c=i[11]*e,h=i[8]*r,p=i[9]*r,d=i[10]*r,f=i[11]*r;for(const e of t){const t=[],r=[];for(const s of e){const e=s.x+n.x,o=s.y+n.y,m=i[0]*e+i[4]*o+i[12],y=i[1]*e+i[5]*o+i[13],g=i[2]*e+i[6]*o+i[14],x=i[3]*e+i[7]*o+i[15],v=m+a,b=y+l,w=g+u,_=Math.max(x+c,1e-5),A=m+h,M=y+p,I=g+d,S=Math.max(x+f,1e-5);t.push(new yd(v/_,b/_,w/_)),r.push(new yd(A/S,M/S,I/S));}s.push(t),o.push(r);}return [s,o]}(e,r,n,i,s)}(s,n,h,c,u,o,y,p,f,s.center.lat,t.tileID.canonical),v=t.queryGeometry;return function(t,e,r){let n=1/0;Wu(r,e)&&(n=Md(r,e[0]));for(let i=0;i<e.length;i++){const s=e[i],o=t[i];for(let t=0;t<s.length-1;t++){const e=s[t],i=[e,s[t+1],o[t+1],o[t],e];Xu(r,i)&&(n=Math.min(n,Md(r,i)));}}return n!==1/0&&n}(g,x,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},building:class extends Ko{constructor(t,e,r,n){super(t,{layout:om||(om=new zo({visibility:new Po(To.layout_building.visibility),"building-facade":new Eo(To.layout_building["building-facade"]),"building-facade-floors":new Eo(To.layout_building["building-facade-floors"]),"building-facade-window":new Eo(To.layout_building["building-facade-window"]),"building-roof-shape":new Eo(To.layout_building["building-roof-shape"]),"building-height":new Eo(To.layout_building["building-height"]),"building-base":new Eo(To.layout_building["building-base"])})),paint:am||(am=new zo({"building-opacity":new Po(To.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Po(To.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Po(To.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Po(To.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Po(To.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Po(To.paint_building["building-vertical-scale"]),"building-cast-shadows":new Po(To.paint_building["building-cast-shadows"]),"building-color":new Eo(To.paint_building["building-color"]),"building-emissive-strength":new Eo(To.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Po(To.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Po(To.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0};}createBucket(t){return new im(t)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return !0}canCastShadows(){return !0}is3D(t){return !0}},line:class extends Ko{constructor(t,e,r,n){const i=zm();super(t,i,e,r,n),i.layout&&(this.layout=new So(i.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1;}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Ai,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER;}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=(()=>{if(Bm)return Bm;const t=zm();return Bm=new Tm(t.paint.properties["line-width"].specification),Bm.useIntegerZoom=!0,Bm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t);}createBucket(t){return new vm(t)}getProgramIds(){return [this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,r){const n=Pm(this);return {config:new El(this,{zoom:e,lut:r}),defines:n,overrideFog:!1}}queryRadius(t){const e=t,r=Vm(uc("line-width",this,e),uc("line-gap-width",this,e)),n=uc("line-offset",this,e);return r/2+Math.abs(n)+cc(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,n,i,s){if(t.queryGeometry.isAboveHorizon)return !1;const o=hc(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),a=t.pixelToTileUnitsFactor/2*Vm(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),l=this.paint.get("line-offset").evaluate(e,r);return l&&(n=function(t,e){const r=[],n=new bt(0,0);for(let i=0;i<t.length;i++){const s=t[i],o=[];for(let t=0;t<s.length;t++){const r=s[t],i=s[t+1],a=0===t?n:r.sub(s[t-1])._unit()._perp(),l=t===s.length-1?n:i.sub(r)._unit()._perp(),u=a._add(l)._unit();u._mult(1/(u.x*l.x+u.y*l.y)),o.push(u._mult(e)._add(r));}r.push(o);}return r}(n,l*t.pixelToTileUnitsFactor)),function(t,e,r){for(let n=0;n<e.length;n++){const i=e[n];if(t.length>=3)for(let e=0;e<i.length;e++)if(ic(t,i[e]))return !0;if(Yu(t,i,r))return !0}return !1}(o,n,a)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(t){return !this.hasElevatedBuckets||this.layout&&"hd-road-markup"===this.layout.get("line-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("line-elevation-reference")}},symbol:wx,background:class extends Ko{constructor(t,e,r,n){super(t,{layout:_x||(_x=new zo({visibility:new Po(To.layout_background.visibility)})),paint:Ax||(Ax=new zo({"background-pitch-alignment":new Po(To.paint_background["background-pitch-alignment"]),"background-color":new Po(To.paint_background["background-color"]),"background-pattern":new Po(To.paint_background["background-pattern"]),"background-opacity":new Po(To.paint_background["background-opacity"]),"background-emissive-strength":new Po(To.paint_background["background-emissive-strength"]),"background-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n);}getProgramIds(){return [this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,r){return {overrideFog:!1}}is3D(t){return "viewport"===this.paint.get("background-pitch-alignment")}},raster:Bx,"raster-particle":Rx,sky:class extends Ko{constructor(t,e,r,n){super(t,{layout:Fx||(Fx=new zo({visibility:new Po(To.layout_sky.visibility)})),paint:Dx||(Dx=new zo({"sky-type":new Po(To.paint_sky["sky-type"]),"sky-atmosphere-sun":new Po(To.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Po(To.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Po(To.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Po(To.paint_sky["sky-gradient-radius"]),"sky-gradient":new ko(To.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Po(To.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Po(To.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Po(To.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n),this._updateColorRamp();}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0;}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0);}_updateColorRamp(){this.colorRamp=fh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null);}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return !0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return !1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),n=!r,i=t.style.light,s=i.properties.get("position");return n&&"viewport"===i.properties.get("anchor")&&Gt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Ux(s.azimuthal,90-s.polar,e):Ux(r[0],90-r[1],e)}const r=this.paint.get("sky-gradient-center");return Ux(r[0],90-r[1],e)}isSky(){return !0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position");}hasOffscreenPass(){return !0}getProgramIds(){const t=this.paint.get("sky-type");return "atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends Ko{constructor(t,e,r,n){super(t,{paint:Lx||(Lx=new zo({}))},e,null);}},model:class extends Ko{constructor(t,e,r,n){super(t,{layout:Xx||(Xx=new zo({visibility:new Po(To.layout_model.visibility),"model-id":new Eo(To.layout_model["model-id"])})),paint:Zx||(Zx=new zo({"model-opacity":new Eo(To.paint_model["model-opacity"]),"model-rotation":new Eo(To.paint_model["model-rotation"]),"model-scale":new Eo(To.paint_model["model-scale"]),"model-translation":new Eo(To.paint_model["model-translation"]),"model-color":new Eo(To.paint_model["model-color"]),"model-color-mix-intensity":new Eo(To.paint_model["model-color-mix-intensity"]),"model-type":new Po(To.paint_model["model-type"]),"model-cast-shadows":new Po(To.paint_model["model-cast-shadows"]),"model-receive-shadows":new Po(To.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Po(To.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Eo(To.paint_model["model-emissive-strength"]),"model-roughness":new Eo(To.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Eo(To.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Po(To.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Po(To.paint_model["model-front-cutoff"]),"model-color-use-theme":new Eo({type:"string",default:"default","property-type":"data-driven"})}))},e,r,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0};}createBucket(t){return new qx(t)}getProgramIds(){return ["model"]}is3D(t){return !0}hasShadowPass(){return !0}canCastShadows(){return !0}hasLightBeamPass(){return !0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof rv?Cn-1:0}queryIntersectsFeature(t,e,r,n,i,s){if(!this.modelManager)return !1;const o=this.modelManager,l=t.tile.getBucket(this);if(!(l&&l instanceof qx))return !1;for(const r in l.instancesPerModel){const n=l.instancesPerModel[r],i=void 0!==e.id?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(n.idToFeaturesIndex.hasOwnProperty(i)){const e=n.features[n.idToFeaturesIndex[i]],u=o.getModel(r,this.scope);if(!u)return !1;let h=a();const p=new Xl(0,0),d=l.canonical;let f=Number.MAX_VALUE;for(let r=0;r<e.instancedDataCount;++r){const i=16*(e.instancedDataOffset+r),o=n.instancedDataArray.float32,a=[o[i+4],o[i+5],o[i+6]];ov(d,p,o[i],0|o[i+1]),Cf(h,u,s,p,e.rotation,e.scale,a,!1,!1,!1),"globe"===s.projection.name&&(h=zf(h,s));const l=c([],s.projMatrix,h),m=t.queryGeometry,y=Tf(m.isPointQuery()?m.screenBounds:m.screenGeometry,s,l,u.aabb);null!=y&&(f=Math.min(y,f));}return f!==Number.MAX_VALUE&&f}}return !1}_handleOverridablePaintPropertyUpdate(t,e,r){return !(!this.layout||e.isDataDriven()||r.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof Ls}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ko{constructor(t,e,r,n){super(t,{layout:pp||(pp=new zo({"clip-layer-types":new Po(To.layout_clip["clip-layer-types"]),"clip-layer-scope":new Po(To.layout_clip["clip-layer-scope"])})),paint:dp||(dp=new zo({}))},e,r,n);}recalculate(t,e){super.recalculate(t,e);}createBucket(t){return new yp(t)}is3D(t){return !0}}},uv=new sr(0,0,0),cv={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},hv={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},pv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},dv={PAINT_ORDER_FILL_AND_STROKE:1},fv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},mv={MASK_TYPE_LUMINANCE:1};function yv(t,e,r){1===t&&e.icons.push(function(t,e){return function(t){if(t.usvg_tree.height||(t.usvg_tree.height=t.usvg_tree.width),!t.metadata)return t;const{metadata:e}=t;if(e.content_area){const{content_area:r}=e;null==r.top&&(r.top=r.left),null==r.width&&(r.width=t.usvg_tree.width),null==r.height&&(r.height=r.width);}return e.stretch_x&&e.stretch_x.length&&gv(e,"x"),e.stretch_y&&e.stretch_y.length&&gv(e,"y"),t}(t.readFields(xv,{name:void 0},e))}(r,r.readVarint()+r.pos));}function gv(t,e){const r=[],n=t[`stretch_${e}`];let i=null;for(let t=0;t<n.length;t++)null===i?i=0===r.length?n[0]:r[r.length-1][1]+n[t]:(r.push([i,i+n[t]]),i=null);t[`stretch_${e}_areas`]=r;}function xv(t,e,r){1===t?e.name=r.readString():2===t?e.metadata=function(t,e){return t.readFields(vv,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},e)}(r,r.readVarint()+r.pos):3===t&&(e.usvg_tree=function(t,e){return t.readFields(_v,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},e)}(r,r.readVarint()+r.pos),e.data="usvg_tree");}function vv(t,e,r){1===t?e.stretch_x=r.readPackedVarint():2===t?e.stretch_y=r.readPackedVarint():3===t?e.content_area=function(t,e){return t.readFields(bv,{left:0},e)}(r,r.readVarint()+r.pos):4===t&&e.variables.push(function(t,e){return t.readFields(wv,{name:void 0},e)}(r,r.readVarint()+r.pos));}function bv(t,e,r){1===t?e.left=r.readVarint():2===t?e.width=r.readVarint():3===t?e.top=r.readVarint():4===t&&(e.height=r.readVarint());}function wv(t,e,r){1===t?e.name=r.readString():2===t&&(e.rgb_color=zv(r.readVarint()),e.value="rgb_color");}function _v(t,e,r){1===t?e.width=e.height=r.readVarint():2===t?e.height=r.readVarint():3===t?e.children.push(Av(r,r.readVarint()+r.pos)):4===t?e.linear_gradients.push(function(t,e){return t.readFields(Bv,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},e)}(r,r.readVarint()+r.pos)):5===t?e.radial_gradients.push(function(t,e){return t.readFields(Fv,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},e)}(r,r.readVarint()+r.pos)):7===t?e.clip_paths.push(function(t,e){return t.readFields(Dv,{children:[]},e)}(r,r.readVarint()+r.pos)):8===t&&e.masks.push(function(t,e){const r=t.readFields(Lv,{left:0,width:20,mask_type:mv.MASK_TYPE_LUMINANCE,children:[]},e);return null==r.height&&(r.height=r.width),null==r.top&&(r.top=r.left),r}(r,r.readVarint()+r.pos));}function Av(t,e){return t.readFields(Mv,{},e)}function Mv(t,e,r){1===t?(e.group=function(t,e){return t.readFields(Iv,{opacity:255,children:[]},e)}(r,r.readVarint()+r.pos),e.node="group"):2===t&&(e.path=function(t,e){return t.readFields(Ev,{paint_order:1,commands:[],step:1,diffs:[],rule:cv.PATH_RULE_NON_ZERO},e)}(r,r.readVarint()+r.pos),e.node="path");}function Iv(t,e,r){1===t?e.transform=Sv(r,r.readVarint()+r.pos):2===t?e.opacity=r.readVarint():5===t?e.clip_path_idx=r.readVarint():6===t?e.mask_idx=r.readVarint():7===t&&e.children.push(Av(r,r.readVarint()+r.pos));}function Sv(t,e){return t.readFields(Pv,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function Pv(t,e,r){1===t?e.sx=r.readFloat():2===t?e.ky=r.readFloat():3===t?e.kx=r.readFloat():4===t?e.sy=r.readFloat():5===t?e.tx=r.readFloat():6===t&&(e.ty=r.readFloat());}function Ev(t,e,r){1===t?e.fill=function(t,e){return t.readFields(kv,{rgb_color:uv,paint:"rgb_color",opacity:255},e)}(r,r.readVarint()+r.pos):2===t?e.stroke=function(t,e){return t.readFields(Tv,{rgb_color:uv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},e)}(r,r.readVarint()+r.pos):3===t?e.paint_order=r.readVarint():5===t?r.readPackedVarint(e.commands):6===t?e.step=r.readFloat():7===t?r.readPackedSVarint(e.diffs):8===t&&(e.rule=r.readVarint());}function kv(t,e,r){1===t?(e.rgb_color=zv(r.readVarint()),e.paint="rgb_color"):2===t?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):3===t?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):5===t&&(e.opacity=r.readVarint());}function zv(t){return new sr((t>>16&255)/255,(t>>8&255)/255,(255&t)/255,1)}function Tv(t,e,r){1===t?(e.rgb_color=zv(r.readVarint()),e.paint="rgb_color"):2===t?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):3===t?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):5===t?r.readPackedFloat(e.dasharray):6===t?e.dashoffset=r.readFloat():7===t?e.miterlimit=r.readFloat():8===t?e.opacity=r.readVarint():9===t?e.width=r.readFloat():10===t?e.linecap=r.readVarint():11===t&&(e.linejoin=r.readVarint());}function Bv(t,e,r){1===t?e.transform=Sv(r,r.readVarint()+r.pos):2===t?e.spread_method=r.readVarint():3===t?e.stops.push(Vv(r,r.readVarint()+r.pos)):4===t?e.x1=r.readFloat():5===t?e.y1=r.readFloat():6===t?e.x2=r.readFloat():7===t&&(e.y2=r.readFloat());}function Vv(t,e){return t.readFields(Cv,{offset:0,opacity:255,rgb_color:uv},e)}function Cv(t,e,r){1===t?e.offset=r.readFloat():2===t?e.opacity=r.readVarint():3===t&&(e.rgb_color=zv(r.readVarint()));}function Fv(t,e,r){1===t?e.transform=Sv(r,r.readVarint()+r.pos):2===t?e.spread_method=r.readVarint():3===t?e.stops.push(Vv(r,r.readVarint()+r.pos)):4===t?e.cx=r.readFloat():5===t?e.cy=r.readFloat():6===t?e.r=r.readFloat():7===t?e.fx=r.readFloat():8===t?e.fy=r.readFloat():9===t&&(e.fr=r.readFloat());}function Dv(t,e,r){1===t?e.transform=Sv(r,r.readVarint()+r.pos):2===t?e.clip_path_idx=r.readVarint():3===t&&e.children.push(Av(r,r.readVarint()+r.pos));}function Lv(t,e,r){1===t?e.left=e.top=r.readFloat():2===t?e.width=e.height=r.readFloat():3===t?e.top=r.readFloat():4===t?e.height=r.readFloat():5===t?e.mask_type=r.readVarint():6===t?e.mask_idx=r.readVarint():7===t&&e.children.push(Av(r,r.readVarint()+r.pos));}class Rv{static calculate(t={},e=[]){const r=new Map,n=new Map;if(0===Object.keys(t).length)return r;e.forEach((t=>{n.set(t.name,t.rgb_color||new sr(0,0,0));}));for(const[e,i]of Object.entries(t))n.has(e)?r.set(n.get(e).toString(),i):console.warn(`Ignoring unknown image variable "${e}"`);return r}}function Ov(t,e=255,r){const n=e/255,i=t.toString(),s=r.has(i)?r.get(i).clone():t.clone();return s.a*=n,s.toString()}function Uv(t,e){if(!pe()){const r=document.createElement("canvas");return r.width=t,r.height=e,r}return new OffscreenCanvas(t,e)}function Nv(t,e){const r=Rv.calculate(e.params,t.metadata?t.metadata.variables:[]),n=t.usvg_tree,i=n.width,s=n.height,o=e.transform?e.transform:new DOMMatrix,a=Math.max(1,Math.round(i*o.a)),l=Math.max(1,Math.round(s*o.d)),u=new DOMMatrix([a/i,0,0,l/s,0,0]),c=Uv(a,l).getContext("2d");return jv(c,u,n,n,r),c.getImageData(0,0,a,l)}function jv(t,e,r,n,i){for(const s of n.children)$v(t,e,r,s,i);}function $v(t,e,r,n,i){n.group?(t.save(),function(t,e,r,n,i){const s=null!=n.mask_idx?r.masks[n.mask_idx]:null,o=null!=n.clip_path_idx?r.clip_paths[n.clip_path_idx]:null;if(n.transform&&(e=Jv(n.transform).preMultiplySelf(e)),!function(t,e,r){return 255!==t.opacity||e||r}(n,null!=o,null!=s))return void jv(t,e,r,n,i);const a=Uv(t.canvas.width,t.canvas.height),l=a.getContext("2d");jv(l,e,r,n,i),o&&Yv(l,e,r,o),s&&Kv(l,e,r,s,i),t.globalAlpha=n.opacity/255,t.drawImage(a,0,0);}(t,e,r,n.group,i),t.restore()):n.path&&(t.save(),function(t,e,r,n,i){t.setTransform(e),n.paint_order===dv.PAINT_ORDER_FILL_AND_STROKE?(Gv(t,r,n,i),qv(t,r,n,i)):(qv(t,r,n,i),Gv(t,r,n,i));}(t,e,r,n.path,i),t.restore());}function Gv(t,e,r,n){const i=r.fill;if(!i)return;const s=i.opacity/255;switch(t.save(),t.beginPath(),Qv(r,t),i.paint){case "rgb_color":t.fillStyle=Ov(i.rgb_color,i.opacity,n);break;case "linear_gradient_idx":{const r=e.linear_gradients[i.linear_gradient_idx];r.transform&&t.setTransform(Jv(r.transform).preMultiplySelf(t.getTransform())),t.fillStyle=Xv(t,r,s,n);break}case "radial_gradient_idx":{const r=e.radial_gradients[i.radial_gradient_idx];r.transform&&t.setTransform(Jv(r.transform).preMultiplySelf(t.getTransform())),t.fillStyle=Zv(t,r,s,n);}}t.fill(Hv(r)),t.restore();}function Hv(t){return t.rule===cv.PATH_RULE_NON_ZERO?"nonzero":t.rule===cv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function qv(t,e,r,n){const i=r.stroke;if(!i)return;const s=tb(r);t.lineWidth=i.width,t.miterLimit=i.miterlimit,t.setLineDash(i.dasharray),t.lineDashOffset=i.dashoffset;const o=i.opacity/255;switch(i.paint){case "rgb_color":t.strokeStyle=Ov(i.rgb_color,i.opacity,n);break;case "linear_gradient_idx":t.strokeStyle=Xv(t,e.linear_gradients[i.linear_gradient_idx],o,n,!0);break;case "radial_gradient_idx":t.strokeStyle=Zv(t,e.radial_gradients[i.radial_gradient_idx],o,n,!0);}switch(i.linejoin){case pv.LINE_JOIN_MITER_CLIP:case pv.LINE_JOIN_MITER:t.lineJoin="miter";break;case pv.LINE_JOIN_ROUND:t.lineJoin="round";break;case pv.LINE_JOIN_BEVEL:t.lineJoin="bevel";}switch(i.linecap){case hv.LINE_CAP_BUTT:t.lineCap="butt";break;case hv.LINE_CAP_ROUND:t.lineCap="round";break;case hv.LINE_CAP_SQUARE:t.lineCap="square";}t.stroke(s);}function Xv(t,e,r,n,i=!1){if(1===e.stops.length){const t=e.stops[0];return Ov(t.rgb_color,t.opacity*r,n)}const{x1:s,y1:o,x2:a,y2:l}=e;let u=new DOMPoint(s,o),c=new DOMPoint(a,l);if(i){const t=Jv(e.transform);u=t.transformPoint(u),c=t.transformPoint(c);}const h=t.createLinearGradient(u.x,u.y,c.x,c.y);for(const t of e.stops)h.addColorStop(t.offset,Ov(t.rgb_color,t.opacity*r,n));return h}function Zv(t,e,r,n,i=!1){if(1===e.stops.length){const t=e.stops[0];return Ov(t.rgb_color,t.opacity*r,n)}const s=Jv(e.transform),{fx:o,fy:a,fr:l,cx:u,cy:c,r:h}=e;let p=new DOMPoint(o,a),d=new DOMPoint(u,c),f=l,m=h;if(i){p=s.transformPoint(p),d=s.transformPoint(d);const t=(s.a+s.d)/2;f=l*t,m=e.r*t;}const y=t.createRadialGradient(p.x,p.y,f,d.x,d.y,m);for(const t of e.stops)y.addColorStop(t.offset,Ov(t.rgb_color,t.opacity*r,n));return y}function Wv(t,e,r,n){const i=n.transform?Jv(n.transform).preMultiplySelf(e):e,s=Uv(t.canvas.width,t.canvas.height),o=s.getContext("2d");for(const t of n.children)if(t.group)Wv(o,i,r,t.group);else if(t.path){const e=t.path,r=new Path2D;r.addPath(tb(e),i),o.fill(r,Hv(e));}const a=null!=n.clip_path_idx?r.clip_paths[n.clip_path_idx]:null;a&&Yv(o,i,r,a),t.globalCompositeOperation="source-over",t.drawImage(s,0,0);}function Yv(t,e,r,n){const i=Uv(t.canvas.width,t.canvas.height);Wv(i.getContext("2d"),e,r,n),t.globalCompositeOperation="destination-in",t.drawImage(i,0,0);}function Kv(t,e,r,n,i){if(0===n.children.length)return;const s=null!=n.mask_idx?r.masks[n.mask_idx]:null;s&&Kv(t,e,r,s,i);const o=t.canvas.width,a=t.canvas.height,l=Uv(o,a),u=l.getContext("2d"),c=n.width,h=n.height,p=n.left,d=n.top,f=new Path2D,m=new Path2D;m.rect(p,d,c,h),f.addPath(m,e),u.clip(f);for(const t of n.children)$v(u,e,r,t,i);const y=u.getImageData(0,0,o,a),g=y.data;if(n.mask_type===mv.MASK_TYPE_LUMINANCE)for(let t=0;t<g.length;t+=4)g[t+3]=g[t+3]/255*(.2126*g[t]+.7152*g[t+1]+.0722*g[t+2]);u.putImageData(y,0,0),t.globalCompositeOperation="destination-in",t.drawImage(l,0,0);}function Jv(t){return t?new DOMMatrix([t.sx,t.ky,t.kx,t.sy,t.tx,t.ty]):new DOMMatrix}function Qv(t,e){const r=t.step;let n=t.diffs[0]*r,i=t.diffs[1]*r;e.moveTo(n,i);for(let s=0,o=2;s<t.commands.length;s++)switch(t.commands[s]){case fv.PATH_COMMAND_MOVE:n+=t.diffs[o++]*r,i+=t.diffs[o++]*r,e.moveTo(n,i);break;case fv.PATH_COMMAND_LINE:n+=t.diffs[o++]*r,i+=t.diffs[o++]*r,e.lineTo(n,i);break;case fv.PATH_COMMAND_QUAD:{const s=n+t.diffs[o++]*r,a=i+t.diffs[o++]*r;n=s+t.diffs[o++]*r,i=a+t.diffs[o++]*r,e.quadraticCurveTo(s,a,n,i);break}case fv.PATH_COMMAND_CUBIC:{const s=n+t.diffs[o++]*r,a=i+t.diffs[o++]*r,l=s+t.diffs[o++]*r,u=a+t.diffs[o++]*r;n=l+t.diffs[o++]*r,i=u+t.diffs[o++]*r,e.bezierCurveTo(s,a,l,u,n,i);break}case fv.PATH_COMMAND_CLOSE:e.closePath();}return e}function tb(t){return Qv(t,new Path2D)}class eb{constructor(t){this.capacity=t,this.cache=new Map;}get(t){if(!this.cache.has(t))return;const e=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,e),e}put(t,e){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,e);}delete(t){this.cache.delete(t);}}qs(eb,"LRUCache");class rb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map;}static _getImage(t){return new ph(t,t.data)}getFromCache(t,e,r){return this.cacheMap.has(r)||this.cacheMap.set(r,new eb(150)),this.cacheMap.get(r).get(Zo(t.toString(),e))}setInCache(t,e,r,n){this.cacheDependenciesMap.has(n)||this.cacheDependenciesMap.set(n,new Map),this.cacheMap.has(n)||this.cacheMap.set(n,new eb(150));const i=this.cacheDependenciesMap.get(n),s=Zo(t.id.toString(),r);i.get(s)||i.set(s,new Set);const o=this.cacheMap.get(n),a=t.toString();i.get(s).add(a),o.put(Zo(t.toString(),r),e);}removeImagesFromCacheByIds(t,e,r=0){if(!this.cacheMap.has(r)||!this.cacheDependenciesMap.has(r))return;const n=this.cacheMap.get(r),i=this.cacheDependenciesMap.get(r);for(const r of t){const t=Zo(r.toString(),e);if(i.has(t)){for(const e of i.get(t))n.delete(e);i.delete(t);}}}rasterize(t,e,r,n,i=Nv){const s=this.getFromCache(t,r,n);if(s)return s.clone();const o=i(e.icon,t.options),a=rb._getImage(o);return this.setInCache(t,a,r,n),a.clone()}}class nb{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[];}getElevation(t,e){const r=this.toIdx(t,e);return {min:this.minimums[r],max:this.maximums[r]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function ib(t,e,r,n){let i=0,s=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(n[o])<1e-15){if(r[o]<t[o]||r[o]>e[o])return null}else {const a=1/n[o];let l=(t[o]-r[o])*a,u=(e[o]-r[o])*a;if(l>u){const t=l;l=u,u=t;}if(l>i&&(i=l),u<s&&(s=u),i>s)return null}return i}function sb(t,e,r,n,i,s,o,a,l,u,c){const h=n-t,p=i-e,d=s-r,f=o-t,m=a-e,y=l-r,g=c[1]*y-c[2]*m,x=c[2]*f-c[0]*y,v=c[0]*m-c[1]*f,b=h*g+p*x+d*v;if(Math.abs(b)<1e-15)return null;const w=1/b,_=u[0]-t,A=u[1]-e,M=u[2]-r,I=(_*g+A*x+M*v)*w;if(I<0||I>1)return null;const S=A*d-M*p,P=M*h-_*d,E=_*p-A*h,k=(c[0]*S+c[1]*P+c[2]*E)*w;return k<0||I+k>1?null:(f*S+m*P+y*E)*w}function ob(t,e,r){return (t-e)/(r-e)}function ab(t,e,r,n,i,s,o,a,l){const u=1<<r,c=s-n,h=o-i,p=(t+1)/u*c+n,d=(e+0)/u*h+i,f=(e+1)/u*h+i;a[0]=(t+0)/u*c+n,a[1]=d,l[0]=p,l[1]=f;}class lb{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),r=[];let n=Math.ceil(Math.pow(2,e));const i=1/n,s=(t,e,r,n,i)=>{const s=n?1:0,o=(t+1)*r-s,a=e*r,l=(e+1)*r-s;i[0]=t*r,i[1]=a,i[2]=o,i[3]=l;};let o=new nb(n);const a=[];for(let e=0;e<n*n;e++){s(e%n,Math.floor(e/n),i,!1,a);const r=cb(a[0],a[1],t),l=cb(a[2],a[1],t),u=cb(a[2],a[3],t),c=cb(a[0],a[3],t);o.minimums.push(Math.min(r,l,u,c)),o.maximums.push(Math.max(r,l,u,c)),o.leaves.push(1);}for(r.push(o),n/=2;n>=1;n/=2){const t=r[r.length-1];o=new nb(n);for(let e=0;e<n*n;e++){s(e%n,Math.floor(e/n),2,!0,a);const r=t.getElevation(a[0],a[1]),i=t.getElevation(a[2],a[1]),l=t.getElevation(a[2],a[3]),u=t.getElevation(a[0],a[3]),c=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),p=t.isLeaf(a[2],a[3]),d=t.isLeaf(a[0],a[3]),f=Math.min(r.min,i.min,l.min,u.min),m=Math.max(r.max,i.max,l.max,u.max),y=c&&h&&p&&d;o.maximums.push(m),o.minimums.push(f),o.leaves.push(m-f<=5&&y?1:0);}r.push(o);}return r}(this.dem),r=e.length-1,n=e[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(e,0,0,r,0);}raycastRoot(t,e,r,n,i,s,o=1){return ib([t,e,-100],[r,n,this.maximums[0]*o],i,s)}raycast(t,e,r,n,i,s,o=1){if(!this.nodeCount)return null;const a=this.raycastRoot(t,e,r,n,i,s,o);if(null==a)return null;const l=[],u=[],c=[],h=[],p=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:a,t:d,nodex:f,nodey:m,depth:y}=p.pop();if(this.leaves[a]){ab(f,m,y,t,e,r,n,c,h);const a=1<<y,l=(f+0)/a,u=(f+1)/a,p=(m+0)/a,g=(m+1)/a,x=cb(l,p,this.dem)*o,v=cb(u,p,this.dem)*o,b=cb(u,g,this.dem)*o,w=cb(l,g,this.dem)*o,_=sb(c[0],c[1],x,h[0],c[1],v,h[0],h[1],b,i,s),A=sb(h[0],h[1],b,c[0],h[1],w,c[0],c[1],x,i,s),M=Math.min(null!==_?_:Number.MAX_VALUE,null!==A?A:Number.MAX_VALUE);if(M!==Number.MAX_VALUE)return M;{const t=T([],i,s,d);if(ub(x,v,w,b,ob(t[0],c[0],h[0]),ob(t[1],c[1],h[1]))>=t[2])return d}continue}let g=0;for(let p=0;p<this._siblingOffset.length;p++){ab((f<<1)+this._siblingOffset[p][0],(m<<1)+this._siblingOffset[p][1],y+1,t,e,r,n,c,h),c[2]=-100,h[2]=this.maximums[this.childOffsets[a]+p]*o;const d=ib(c,h,i,s);if(null!=d){const t=d;l[p]=t;let e=!1;for(let r=0;r<g&&!e;r++)t>=l[u[r]]&&(u.splice(r,0,p),e=!0);e||(u[g]=p),g++;}}for(let t=0;t<g;t++){const e=u[t];p.push({idx:this.childOffsets[a]+e,t:l[e],nodex:(f<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:y+1});}}return null}_addNode(t,e,r){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,r,n,i){if(1===t[n].isLeaf(e,r))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const s=n-1,o=t[s];let a=0,l=0;for(let t=0;t<this._siblingOffset.length;t++){const n=2*e+this._siblingOffset[t][0],i=2*r+this._siblingOffset[t][1],s=o.getElevation(n,i),u=o.isLeaf(n,i),c=this._addNode(s.min,s.max,u);u&&(a|=1<<t),l||(l=c);}for(let n=0;n<this._siblingOffset.length;n++)a&1<<n||this._construct(t,2*e+this._siblingOffset[n][0],2*r+this._siblingOffset[n][1],s,l+n);}}function ub(t,e,r,n,i,s){return ur(ur(t,r,s),ur(e,n,s),i)}function cb(t,e,r){const n=r.dim,i=zt(t*n-.5,0,n-1),s=zt(e*n-.5,0,n-1),o=Math.floor(i),a=Math.floor(s),l=Math.min(o+1,n-1),u=Math.min(a+1,n-1);return ub(r.get(o,a),r.get(l,a),r.get(o,u),r.get(l,u),i-o,s-a)}const hb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function pb(t,e,r){return (256*t*256+256*e+r)/10-1e4}function db(t,e,r){return 256*t+e+r/256-32768}class fb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,r,n=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return void Gt(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const i=this.dim=e.height-2,s=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.floatView=new Float32Array(e.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let t=0;t<i;t++)s[this._idx(-1,t)]=s[this._idx(0,t)],s[this._idx(i,t)]=s[this._idx(i-1,t)],s[this._idx(t,-1)]=s[this._idx(t,0)],s[this._idx(t,i)]=s[this._idx(t,i-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(i,-1)]=s[this._idx(i-1,0)],s[this._idx(-1,i)]=s[this._idx(0,i-1)],s[this._idx(i,i)]=s[this._idx(i-1,i-1)];}const o="terrarium"===r?db:pb;for(let t=0;t<s.length;++t){const e=4*t;this.floatView[t]=o(this.pixels[e],this.pixels[e+1],this.pixels[e+2]);}this._timestamp=de.now();}_buildQuadTree(){this._tree=new lb(this);}get(t,e,r=!1){r&&(t=zt(t,-1,this.dim),e=zt(e,-1,this.dim));const n=this._idx(t,e);return this.floatView[n]}set(t,e,r){const n=this._idx(t,e),i=this.floatView[n];return this.floatView[n]=r,r-i}static getUnpackVector(t){return hb[t]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return (e+1)*this.stride+(t+1)}static pack(t,e){const r=[0,0,0,0],n=fb.getUnpackVector(e);let i=Math.floor((t+n[3])/n[2]);return r[2]=i%256,i=Math.floor(i/256),r[1]=i%256,i=Math.floor(i/256),r[0]=i,r}getPixels(){return new dh({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,i=e*this.dim+this.dim,s=r*this.dim,o=r*this.dim+this.dim;switch(e){case -1:n=i-1;break;case 1:i=n+1;}switch(r){case -1:s=o-1;break;case 1:o=s+1;}const a=-e*this.dim,l=-r*this.dim;for(let e=s;e<o;e++)for(let r=n;r<i;r++){const n=4*this._idx(r,e),i=4*this._idx(r+a,e+l);this.pixels[n+0]=t.pixels[i+0],this.pixels[n+1]=t.pixels[i+1],this.pixels[n+2]=t.pixels[i+2],this.pixels[n+3]=t.pixels[i+3];}}onDeserialize(){this._tree&&(this._tree.dem=this);}}function mb(t,e,r){1===t?e.headerLength=r.readFixed32():2===t?e.x=r.readVarint():3===t?e.y=r.readVarint():4===t?e.z=r.readVarint():5===t&&e.layers.push(function(t,e){return t.readFields(bb,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},e)}(r,r.readVarint()+r.pos));}function yb(t,e,r){1===t?(e.delta_filter=function(t,e){return t.readFields(gb,{blockSize:0},e)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):2===t?(r.readVarint(),e.filter="zigzag_filter"):3===t?(r.readVarint(),e.filter="bitshuffle_filter"):4===t&&(r.readVarint(),e.filter="byteshuffle_filter");}function gb(t,e,r){1===t&&(e.blockSize=r.readVarint());}function xb(t,e,r){1===t?(r.readVarint(),e.codec="gzip_data"):2===t?(r.readVarint(),e.codec="jpeg_image"):3===t?(r.readVarint(),e.codec="webp_image"):4===t&&(r.readVarint(),e.codec="png_image");}function vb(t,e,r){let n=0,i=0;1===t?e.firstByte=r.readFixed64():2===t?e.lastByte=r.readFixed64():3===t?e.filters.push(function(t,e){return t.readFields(yb,{},e)}(r,r.readVarint()+r.pos)):4===t?e.codec=function(t,e){return t.readFields(xb,{},e)}(r,r.readVarint()+r.pos):5===t?i=r.readFloat():6===t?n=r.readFloat():7===t?e.bands.push(r.readString()):8===t?e.offset=r.readDouble():9===t&&(e.scale=r.readDouble()),0===e.offset&&(e.offset=i),0===e.scale&&(e.scale=n);}function bb(t,e,r){1===t?e.version=r.readVarint():2===t?e.name=r.readString():3===t?e.units=r.readString():4===t?e.tileSize=r.readVarint():5===t?e.buffer=r.readVarint():6===t?e.pixelFormat=r.readVarint():7===t&&e.dataIndex.push(function(t,e){return t.readFields(vb,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)}(r,r.readVarint()+r.pos));}function wb(t,e,r){if(2===t)!function(t,e,r){t.readFields(_b,r,e);}(r,r.readVarint()+r.pos,e);else if(3===t)throw new Error("Not implemented")}function _b(t,e,r){if(1===t){let t=0;const n=r.readVarint()+r.pos;for(;r.pos<n;)e[t++]=r.readVarint();}}function Ab(t,e){if(4!==e.length)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let n=2;n>=1;n--){const i=1===n?1:0,s=2===n?1:0;for(let n=0;n<e[0];n++){const o=e[1]*n;for(let n=i;n<e[1];n++){const i=e[2]*(n+o);for(let n=s;n<e[2];n++){const s=e[3]*(n+i);for(let n=0;n<e[3];n++){const e=s+n;t[e]+=t[e-r];}}}}r*=e[n];}return t}function Mb(t){for(let e=0,r=t.length;e<r;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function Ib(t,e){switch(e){case "uint32":return t;case "uint16":for(let e=0;e<t.length;e+=2){const r=t[e],n=t[e+1];t[e]=(240&r)>>4|(61440&r)>>8|(240&n)<<4|61440&n,t[e+1]=15&r|(3840&r)>>4|(15&n)<<8|(3840&n)<<4;}return t;case "uint8":for(let e=0;e<t.length;e+=4){const r=t[e],n=t[e+1],i=t[e+2],s=t[e+3];t[e+0]=(192&r)>>6|(192&n)>>4|(192&i)>>2|192&s,t[e+1]=(48&r)>>4|(48&n)>>2|48&i|(48&s)<<2,t[e+2]=(12&r)>>2|12&n|(12&i)<<2|(12&s)<<4,t[e+3]=3&r|(3&n)<<2|(3&i)<<4|(3&s)<<6;}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}qs(fb,"DEMData"),qs(lb,"DemMinMaxQuadTree",{omit:["dem"]});var Sb=Uint8Array,Pb=Uint16Array,Eb=Int32Array,kb=new Sb([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zb=new Sb([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Tb=new Sb([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bb=function(t,e){for(var r=new Pb(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];var i=new Eb(r[30]);for(n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)i[s]=s-r[n]<<5|n;return {b:r,r:i}},Vb=Bb(kb,2),Cb=Vb.b,Fb=Vb.r;Cb[28]=258,Fb[258]=28;for(var Db=Bb(zb,0).b,Lb=new Pb(32768),Rb=0;Rb<32768;++Rb){var Ob=(43690&Rb)>>1|(21845&Rb)<<1;Lb[Rb]=((65280&(Ob=(61680&(Ob=(52428&Ob)>>2|(13107&Ob)<<2))>>4|(3855&Ob)<<4))>>8|(255&Ob)<<8)>>1;}var Ub=function(t,e,r){for(var n=t.length,i=0,s=new Pb(e);i<n;++i)t[i]&&++s[t[i]-1];var o,a=new Pb(e);for(i=1;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;o=new Pb(1<<e);var l=15-e;for(i=0;i<n;++i)if(t[i])for(var u=i<<4|t[i],c=e-t[i],h=a[t[i]-1]++<<c,p=h|(1<<c)-1;h<=p;++h)o[Lb[h]>>l]=u;return o},Nb=new Sb(288);for(Rb=0;Rb<144;++Rb)Nb[Rb]=8;for(Rb=144;Rb<256;++Rb)Nb[Rb]=9;for(Rb=256;Rb<280;++Rb)Nb[Rb]=7;for(Rb=280;Rb<288;++Rb)Nb[Rb]=8;var jb=new Sb(32);for(Rb=0;Rb<32;++Rb)jb[Rb]=5;var $b=Ub(Nb,9),Gb=Ub(jb,5),Hb=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},qb=function(t,e,r){var n=e/8|0;return (t[n]|t[n+1]<<8)>>(7&e)&r},Xb=function(t,e){var r=e/8|0;return (t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},Zb=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Wb=function(t,e,r){var n=new Error(e||Zb[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Wb),!r)throw n;return n},Yb=new Sb(0),Kb="undefined"!=typeof TextDecoder&&new TextDecoder;try{Kb.decode(Yb,{stream:!0});}catch(t){}const Jb={gzip_data:"gzip"};class Qb extends Error{constructor(t){super(t),this.name="MRTError";}}const tw={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ew={uint32:1,uint16:2,uint8:4},rw={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let nw;class iw{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t;}getLayer(t){const e=this.layers[t];if(!e)throw new Qb(`Layer '${t}' not found`);return e}getHeaderLength(t){const e=new Uint8Array(t),r=new DataView(t);if(13!==e[0])throw new Qb("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(t){const e=new Uint8Array(t),r=this.getHeaderLength(t);if(e.length<r)throw new Qb(`Expected header with length >= ${r} but got buffer of length ${e.length}`);const n=new nw(e.subarray(0,r)).readFields(mb,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new Qb(`Invalid attempt to parse header ${n.z}/${n.x}/${n.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=n.x,this.y=n.y,this.z=n.z;for(const t of n.layers)this.layers[t.name]=new sw(t,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const e=[],r=this.getLayer(t.layerName);for(let n of t.blockIndices){const i=r.dataIndex[n],s=i.firstByte-t.firstByte,o=i.lastByte-t.firstByte;if(r._blocksInProgress.has(n))continue;const a={layerName:r.name,firstByte:s,lastByte:o,pixelFormat:r.pixelFormat,blockIndex:n,blockShape:[i.bands.length].concat(r.bandShape),buffer:r.buffer,codec:i.codec.codec,filters:i.filters.map((t=>t.filter))};r._blocksInProgress.add(n),e.push(a);}return new ow(e,(()=>{e.forEach((t=>r._blocksInProgress.delete(t.blockIndex)));}),((t,n)=>{if(e.forEach((t=>r._blocksInProgress.delete(t.blockIndex))),t)throw t;n.forEach((t=>{this.getLayer(t.layerName).processDecodedData(t);}));}))}}class sw{constructor({version:t,name:e,units:r,tileSize:n,pixelFormat:i,buffer:s,dataIndex:o},a){if(this.version=t,1!==this.version)throw new Qb(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=e,this.units=r,this.tileSize=n,this.buffer=s,this.pixelFormat=tw[i],this.dataIndex=o,this.bandShape=[n+2*s,n+2*s,ew[this.pixelFormat]],this._decodedBlocks=new eb(a?a.cacheSize:5),this._blocksInProgress=new Set;}get dimension(){return ew[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:t})=>t)).flat()}processDecodedData(t){const e=t.blockIndex.toString();this._decodedBlocks.get(e)||this._decodedBlocks.put(e,t.data);}getBlockForBand(t){let e=0;switch(typeof t){case "string":for(const[r,n]of this.dataIndex.entries()){for(const[i,s]of n.bands.entries())if(s===t)return {bandIndex:e+i,blockIndex:r,blockBandIndex:i};e+=n.bands.length;}break;case "number":for(const[r,n]of this.dataIndex.entries()){if(t>=e&&t<e+n.bands.length)return {bandIndex:t,blockIndex:r,blockBandIndex:t-e};e+=n.bands.length;}break;default:throw new Qb(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}return {blockIndex:-1,blockBandIndex:-1}}getDataRange(t){let e=1/0,r=-1/0;const n=[],i=new Set;for(const s of t){const{blockIndex:t}=this.getBlockForBand(s);if(t<0)throw new Qb(`Invalid band: ${JSON.stringify(s)}`);const o=this.dataIndex[t];n.includes(t)||n.push(t),i.add(t),e=Math.min(e,o.firstByte),r=Math.max(r,o.lastByte);}if(i.size>this.cacheSize)throw new Qb(`Number of blocks to decode (${i.size}) exceeds cache size (${this.cacheSize}).`);return {layerName:this.name,firstByte:e,lastByte:r,blockIndices:n}}hasBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0}hasDataForBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0&&!!this._decodedBlocks.get(e.toString())}getBandView(t){const{blockIndex:e,blockBandIndex:r}=this.getBlockForBand(t);if(e<0)throw new Qb(`Band not found: ${JSON.stringify(t)}`);const n=this._decodedBlocks.get(e.toString());if(!n)throw new Qb(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const i=this.dataIndex[e],s=this.bandShape.reduce(((t,e)=>t*e),1),o=r*s,a=n.subarray(o,o+s);return {data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:i.offset,scale:i.scale}}}iw.setPbf=function(t){nw=t;};class ow{constructor(t,e,r){this.tasks=t,this._onCancel=e,this._onComplete=r,this._finalized=!1;}cancel(){this._finalized||(this._onCancel(),this._finalized=!0);}complete(t,e){this._finalized||(this._onComplete(t,e),this._finalized=!0);}}iw.performDecoding=function(t,e){const r=new Uint8Array(t);return Promise.all(e.tasks.map((t=>{const{layerName:e,firstByte:n,lastByte:i,pixelFormat:s,blockShape:o,blockIndex:a,filters:l,codec:u}=t,c=r.subarray(n,i+1),h=new Uint32Array(o[0]*o[1]*o[2]);let p;if("gzip_data"!==u)throw new Qb(`Unhandled codec: ${u}`);return p=function(t,e){if(!globalThis.DecompressionStream&&"gzip_data"===e)return Promise.resolve(((s=function(t){31==t[0]&&139==t[1]&&8==t[2]||Wb(6,"invalid gzip data");var e=t[3],r=10;4&e&&(r+=2+(t[10]|t[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(2&e)}(i=t))+8>i.length&&Wb(6,"invalid gzip data"),function(t,e,r,n){var i=t.length;if(!i||e.f&&!e.l)return r||new Sb(0);var s=!r,o=s||2!=e.i,a=e.i;s&&(r=new Sb(3*i));var l,u,c=function(t){var e=r.length;if(t>e){var n=new Sb(Math.max(2*e,t));n.set(r),r=n;}},h=e.f||0,p=e.p||0,d=e.b||0,f=e.l,m=e.d,y=e.m,g=e.n,x=8*i;do{if(!f){h=qb(t,p,1);var v=qb(t,p+1,3);if(p+=3,!v){var b=t[(T=4+((p+7)/8|0))-4]|t[T-3]<<8,w=T+b;if(w>i){a&&Wb(0);break}o&&c(d+b),r.set(t.subarray(T,w),d),e.b=d+=b,e.p=p=8*w,e.f=h;continue}if(1==v)f=$b,m=Gb,y=9,g=5;else if(2==v){var _=qb(t,p,31)+257,A=qb(t,p+10,15)+4,M=_+qb(t,p+5,31)+1;p+=14;for(var I=new Sb(M),S=new Sb(19),P=0;P<A;++P)S[Tb[P]]=qb(t,p+3*P,7);p+=3*A;var E=Hb(S),k=(1<<E)-1,z=Ub(S,E);for(P=0;P<M;){var T,B=z[qb(t,p,k)];if(p+=15&B,(T=B>>4)<16)I[P++]=T;else {var V=0,C=0;for(16==T?(C=3+qb(t,p,3),p+=2,V=I[P-1]):17==T?(C=3+qb(t,p,7),p+=3):18==T&&(C=11+qb(t,p,127),p+=7);C--;)I[P++]=V;}}var F=I.subarray(0,_),D=I.subarray(_);y=Hb(F),g=Hb(D),f=Ub(F,y),m=Ub(D,g);}else Wb(1);if(p>x){a&&Wb(0);break}}o&&c(d+131072);for(var L=(1<<y)-1,R=(1<<g)-1,O=p;;O=p){var U=(V=f[Xb(t,p)&L])>>4;if((p+=15&V)>x){a&&Wb(0);break}if(V||Wb(2),U<256)r[d++]=U;else {if(256==U){O=p,f=null;break}var N=U-254;U>264&&(N=qb(t,p,(1<<(G=kb[P=U-257]))-1)+Cb[P],p+=G);var j=m[Xb(t,p)&R],$=j>>4;if(j||Wb(3),p+=15&j,D=Db[$],$>3){var G=zb[$];D+=Xb(t,p)&(1<<G)-1,p+=G;}if(p>x){a&&Wb(0);break}o&&c(d+131072);var H=d+N;if(d<D){var q=0-D,X=Math.min(D,H);for(q+d<0&&Wb(3);d<X;++d)r[d]=(void 0)[q+d];}for(;d<H;++d)r[d]=r[d-D];}}e.l=f,e.p=O,e.b=d,e.f=h,f&&(h=1,e.m=y,e.d=m,e.n=g);}while(!h);return d!=r.length&&s?(l=r,(null==(u=d)||u>l.length)&&(u=l.length),new Sb(l.subarray(0,u))):r.subarray(0,d)}(i.subarray(s,-8),{i:2},new Sb(((r=i)[(n=r.length)-4]|r[n-3]<<8|r[n-2]<<16|r[n-1]<<24)>>>0))));var r,n,i,s;const o=Jb[e];if(!o)throw new Error(`Unhandled codec: ${e}`);const a=new globalThis.DecompressionStream(o);return new Response(new Blob([t]).stream().pipeThrough(a)).arrayBuffer().then((t=>new Uint8Array(t)))}(c,u).then((t=>(function(t,e){t.readFields(wb,e);}(new nw(t),h),new(0,rw[s])(h.buffer)))),p.then((t=>{for(let e=l.length-1;e>=0;e--)switch(l[e]){case "delta_filter":Ab(t,o);break;case "zigzag_filter":Mb(t);break;case "bitshuffle_filter":Ib(t,s);break;default:throw new Qb(`Unhandled filter "${l[e]}"`)}return {layerName:e,blockIndex:a,data:t}})).catch((t=>{throw t}))})))},qs(ow,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),qs(iw,"MapboxRasterTile"),qs(sw,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class aw{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r;}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const lw=["id","tile","layer","source","sourceLayer","state"];class uw{constructor(t,e,r,n,i){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=r,this._y=n,this.properties=t.properties,this.id=i;}clone(){const t=new uw(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t;}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const e of lw)void 0!==this[e]&&(t[e]=this[e]);return t}}class cw{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Gs(Cn,16,0),this.featureIndexArray=new Za,this.promoteId=e,this.is3DTile=!1,this.serializedLayersCache=new Map;}insert(t,e,r,n,i,s=0,o=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i,s);const l=this.grid;for(let t=0;t<e.length;t++){const r=e[t],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<r.length;t++){const e=r[t];n[0]=Math.min(n[0],e.x),n[1]=Math.min(n[1],e.y),n[2]=Math.max(n[2],e.x),n[3]=Math.max(n[3],e.y);}0!==o&&(n[0]-=o,n[1]-=o,n[2]+=o,n[3]+=o),n[0]<Cn&&n[1]<Cn&&n[2]>=0&&n[3]>=0&&l.insert(a,n[0],n[1],n[2],n[3]);}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Mu(new Jm(this.rawTileData)).layers,this.sourceLayerCoder=new aw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[];}return this.vtLayers}query(t,e){const{tilespaceGeometry:r,transform:n,tileTransform:i,pixelPosMatrix:s,availableImages:o,worldview:a}=e;this.loadVTLayers(),this.serializedLayersCache.clear();const l=r.bufferedTilespaceBounds,u=this.grid.query(l.min.x,l.min.y,l.max.x,l.max.y,((t,e,n,i)=>sc(r.bufferedTilespaceGeometry,t,e,n,i)));u.sort(pw);let c=null;n.elevation&&u.length>0&&(c=Wx.create(n.elevation,this.tileID));const h={};let p;for(let e=0;e<u.length;e++){const l=u[e];if(l===p)continue;p=l;const d=this.featureIndexArray.get(l);let f=null;this.is3DTile?this.loadMatchingModelFeature(h,d,t,r,n,a):this.loadMatchingFeature(h,d,t,o,a,((t,e,o,a=0)=>(f||(f=gu(t,this.tileID.canonical,i)),e.queryIntersectsFeature(r,t,o,f,this.z,n,s,c,a))));}return h}loadMatchingFeature(t,e,r,n,i,s){const{featureIndex:o,bucketIndex:a,sourceLayerIndex:l,layoutVertexArrayOffset:u}=e,c=this.bucketLayerIDs[a],h=r.layers,p=Object.keys(h);if(p.length&&!jt(p,c))return;const d=r.sourceCache,f=this.sourceLayerCoder.decode(l),m=this.vtLayers[f].feature(o),y=this.getId(m,f);for(let e=0;e<c.length;e++){const r=c[e];if(!h[r])continue;const{styleLayer:a,targets:l}=h[r];let p={};void 0!==y&&(p=d.getFeatureState(a.sourceLayer,y));const f=!s||s(m,a,p,u);if(!f)continue;const g=new uw(m,this.z,this.x,this.y,y);g.tile=this.tileID.canonical,g.state=p;let x=this.serializedLayersCache.get(r);x||(x=a.serialize(),x.id=r,this.serializedLayersCache.set(r,x)),g.source=x.source,g.sourceLayer=x["source-layer"],g.layer=Ct({},x),g.layer.paint=hw(x.paint,a.paint,m,p,n),g.layer.layout=hw(x.layout,a.layout,m,p,n);let v=!1;for(const t of l){this.updateFeatureProperties(g,t);const{filter:e}=t;if(e)if(m.properties=g.properties,e.needGeometry){const t=xu(m,!0);if(!e.filter(new xo(this.tileID.overscaledZ,{worldview:i}),t,this.tileID.canonical))continue}else if(!e.filter(new xo(this.tileID.overscaledZ,{worldview:i}),m))continue;v=!0,t.targetId&&this.addFeatureVariant(g,t);}v&&this.appendToResult(t,r,o,g,f);}}loadMatchingModelFeature(t,e,r,n,i,s){const{featureIndex:o,bucketIndex:a}=e,l=this.bucketLayerIDs[a],u=r.layers,c=Object.keys(u);if(!c.length||jt(c,l))for(let e=0;e<l.length;e++){const a=l[e],{styleLayer:c,targets:h}=u[a];if("model"!==c.type)continue;const p=n.tile,d=p.getBucket(c);if(!(d&&d instanceof rv))continue;const f=av(d,o,n,i);if(!f)continue;const{z:m,x:y,y:g}=p.tileID.canonical,{feature:x,intersectionZ:v,position:b}=f;let w={};void 0!==x.id&&(w=r.sourceCache.getFeatureState(c.sourceLayer,x.id));const _=new uw({},m,y,g,x.id);_.tile=this.tileID.canonical,_.state=w,_.properties=x.properties,_.geometry={type:"Point",coordinates:[b.lng,b.lat]};let A=this.serializedLayersCache.get(a);A||(A=c.serialize(),A.id=a,this.serializedLayersCache.set(a,A)),_.source=A.source,_.sourceLayer=A["source-layer"],_.layer=Ct({},A);let M=!1;for(const t of h){this.updateFeatureProperties(_,t);const{filter:e}=t;if(e)if(x.properties=_.properties,e.needGeometry){if(!e.filter(new xo(this.tileID.overscaledZ,{worldview:s}),x,this.tileID.canonical))continue}else if(!e.filter(new xo(this.tileID.overscaledZ,{worldview:s}),x))continue;M=!0,t.targetId&&this.addFeatureVariant(_,t);}M&&this.appendToResult(t,a,o,_,v);}}updateFeatureProperties(t,e,r){if(e.properties){const n={};for(const i in e.properties){const s=e.properties[i].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,r);null!=s&&(n[i]=s);}t.properties=n;}}addFeatureVariant(t,e,r){const n={target:e.target,namespace:e.namespace,uniqueFeatureID:e.uniqueFeatureID};e.properties&&(n.properties=t.properties),t.variants=t.variants||{},t.variants[e.targetId]=t.variants[e.targetId]||[],t.variants[e.targetId].push(n);}appendToResult(t,e,r,n,i){let s=t[e];void 0===s&&(s=t[e]=[]),s.push({featureIndex:r,feature:n,intersectionZ:i});}lookupSymbolFeatures(t,e,r,n,i,s){const o={};this.loadVTLayers();for(const a of t)this.loadMatchingFeature(o,{bucketIndex:e,sourceLayerIndex:r,featureIndex:a,layoutVertexArrayOffset:0},n,i,s);return o}loadFeature(t){const{featureIndex:e,sourceLayerIndex:r}=t;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),i=this.vtFeatures[n];if(i[e])return i[e];const s=this.vtLayers[n].feature(e);return i[e]=s,s}hasLayer(t){for(const e of this.bucketLayerIDs)for(const r of e)if(t===r)return !0;return !1}getId(t,e){let r=t.id;if(this.promoteId){const n=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[e];if(null!=n)if(Array.isArray(n)){if(!this.promoteIdExpression){const t=Fs(n);if("success"!==t.result){const e=t.value.map((t=>`${t.key}: ${t.message}`)).join(", ");return void Gt(`Failed to create expression for promoteId: ${e}`)}this.promoteIdExpression=t.value;}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Kr),r=this.promoteIdExpression.evaluate({zoom:0},t);}else r=t.properties[n];"boolean"==typeof r&&(r=Number(r));}return r}}function hw(t,e,r,n,i){return Ot(t,((t,s)=>{const o=e instanceof So?e.get(s):null;return o&&o.evaluate?o.evaluate(r,n,void 0,i):o}))}function pw(t,e){return e-t}qs(cw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const dw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class fw{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,r]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const n=r>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const i=dw[15&r];if(!i)throw new Error("Unrecognized array type.");const[s]=new Uint16Array(t,2,1),[o]=new Uint32Array(t,4,1);return new fw(o,s,i,t)}constructor(t,e=64,r=Float64Array,n){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=r,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const i=dw.indexOf(this.ArrayType),s=2*t*this.ArrayType.BYTES_PER_ELEMENT,o=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-o%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+o+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+s+o+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+o+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t);}add(t,e){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=t,this.coords[this._pos++]=e,r}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return mw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:s,nodeSize:o}=this,a=[0,i.length-1,0],l=[];for(;a.length;){const u=a.pop()||0,c=a.pop()||0,h=a.pop()||0;if(c-h<=o){for(let o=h;o<=c;o++){const a=s[2*o],u=s[2*o+1];a>=t&&a<=r&&u>=e&&u<=n&&l.push(i[o]);}continue}const p=h+c>>1,d=s[2*p],f=s[2*p+1];d>=t&&d<=r&&f>=e&&f<=n&&l.push(i[p]),(0===u?t<=d:e<=f)&&(a.push(h),a.push(p-1),a.push(1-u)),(0===u?r>=d:n>=f)&&(a.push(p+1),a.push(c),a.push(1-u));}return l}within(t,e,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:i,nodeSize:s}=this,o=[0,n.length-1,0],a=[],l=r*r;for(;o.length;){const u=o.pop()||0,c=o.pop()||0,h=o.pop()||0;if(c-h<=s){for(let r=h;r<=c;r++)vw(i[2*r],i[2*r+1],t,e)<=l&&a.push(n[r]);continue}const p=h+c>>1,d=i[2*p],f=i[2*p+1];vw(d,f,t,e)<=l&&a.push(n[p]),(0===u?t-r<=d:e-r<=f)&&(o.push(h),o.push(p-1),o.push(1-u)),(0===u?t+r>=d:e+r>=f)&&(o.push(p+1),o.push(c),o.push(1-u));}return a}}function mw(t,e,r,n,i,s){if(i-n<=r)return;const o=n+i>>1;yw(t,e,o,n,i,s),mw(t,e,r,n,o-1,1-s),mw(t,e,r,o+1,i,1-s);}function yw(t,e,r,n,i,s){for(;i>n;){if(i-n>600){const o=i-n+1,a=r-n+1,l=Math.log(o),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(o-u)/o)*(a-o/2<0?-1:1);yw(t,e,r,Math.max(n,Math.floor(r-a*u/o+c)),Math.min(i,Math.floor(r+(o-a)*u/o+c)),s);}const o=e[2*r+s];let a=n,l=i;for(gw(t,e,n,r),e[2*i+s]>o&&gw(t,e,n,i);a<l;){for(gw(t,e,a,l),a++,l--;e[2*a+s]<o;)a++;for(;e[2*l+s]>o;)l--;}e[2*n+s]===o?gw(t,e,n,l):(l++,gw(t,e,l,i)),l<=r&&(n=l+1),r<=l&&(i=l-1);}}function gw(t,e,r,n){xw(t,r,n),xw(e,2*r,2*n),xw(e,2*r+1,2*n+1);}function xw(t,e,r){const n=t[e];t[e]=t[r],t[r]=n;}function vw(t,e,r,n){const i=t-r,s=e-n;return i*i+s*s}t.$=Jr,t.A=Ye,t.B=Fr,t.C=Zo,t.D=Bd,t.E=tr,t.F=2,t.G=Zy,t.H=qy,t.I=er,t.J=Xr,t.K=class extends jx{},t.L=pr,t.M=Bo,t.N=Ms,t.O=ws,t.P=bt,t.Q=As,t.R=Be,t.S=Cs,t.T=df,t.U=Vo,t.V=jx,t.W=Rs,t.X=Fs,t.Y=pi,t.Z=fi,t._=hi,t.a=function(t){return ne.API_CDN_URL_REGEX.test(t)},t.a$=Dt,t.a0=ir,t.a1=Co,t.a2=Is,t.a3=_s,t.a4=function(t){const e=t.value;let r=[];if(!e)return r;const n=Xr(e);return "string"!==n?(r=r.concat([new jx(t.key,e,`string expected, "${n}" found`)]),r):($x(e,!0)||(r=r.concat([new jx(t.key,e,`invalid url "${e}"`)])),r)},t.a5=To,t.a6=wo,t.a7=zo,t.a8=Po,t.a9=class{constructor(t){this.specification=t;}possiblyEvaluate(t,e){return Xt(t.expression.evaluate(e))}interpolate(t,e,r){return {x:ur(t.x,e.x,r),y:ur(t.y,e.y,r),z:ur(t.z,e.z,r),azimuthal:ur(t.azimuthal,e.azimuthal,r),polar:ur(t.polar,e.polar,r)}}},t.aA=Y,t.aB=Fl,t.aC=ic,t.aD=Jl,t.aE=hu,t.aF=function(t,e){const r={};for(let n=0;n<e.length;n++){const i=e[n];i in t&&(r[i]=t[i]);}return r},t.aG=Zl,t.aH=Ql,t.aI=class{constructor(t){this.entries={},this.scheduler=t;}request(t,e,r,n){const i=this.entries[t]=this.entries[t]||{callbacks:[]};if(i.result){const[t,r]=i.result;return this.scheduler?this.scheduler.add((()=>{n(t,r);}),e):n(t,r),()=>{}}return i.callbacks.push(n),i.cancel||(i.cancel=r(((r,n)=>{i.result=[r,n];for(const t of i.callbacks)this.scheduler?this.scheduler.add((()=>{t(r,n);}),e):t(r,n);setTimeout((()=>delete this.entries[t]),3e3);}))),()=>{i.result||(i.callbacks=i.callbacks.filter((t=>t!==n)),i.callbacks.length||(i.cancel(),delete this.entries[t]));}}},t.aJ=function(t,e,r){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(e=>{const n=De(t.request,((t,n,i,s)=>{t?e(t):n&&e(null,{vectorTile:r?void 0:new Mu(new Jm(n)),rawData:n,cacheControl:i,expires:s});}));return ()=>{n.cancel(),e();}}),e)},t.aK=function(t){Me++,Me>xe&&(t.getActor().send("enforceCacheSizeLimit",ge),Me=0);},t.aL=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.aM=xc,t.aN=Bx,t.aO=Rx,t.aP=zx,t.aQ=function(t,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r);};for(let e=0;e<t.length;e++){const n=document.createElement("source");Le(t[e])||(r.crossOrigin="Anonymous"),n.src=t[e],r.appendChild(n);}return {cancel:()=>{}}},t.aR=ff,t.aS=function(t){return fetch(t).then((t=>t.arrayBuffer())).then((e=>cf(e,0,t)))},t.aT=Xf,t.aU=class{constructor(t,e,r,n){this.id=t,this.position=null!=e?new Xl(e[0],e[1]):new Xl(0,0),this.orientation=null!=r?r:[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new Nu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[];}_applyTransformations(t,e){if(c(t.matrix,e,t.matrix),t.meshes)for(const e of t.meshes){const r=Nu.applyTransformFast(e.aabb,t.matrix);this.aabb.encapsulate(r);}if(t.children)for(const e of t.children)this._applyTransformations(e,t.matrix);}computeBoundsAndApplyParent(){const t=l([]);for(const e of this.nodes)this._applyTransformations(e,t);}computeModelMatrix(t,e,r,n,i,s,o=!1){Cf(this.matrix,this,t.transform,this.position,e,r,n,i,s,o);}upload(t){if(!this.uploaded){for(const e of this.nodes)Lf(e,t);for(const t of this.nodes)Rf(t);this.uploaded=!0;}}destroy(){for(const t of this.nodes)Of(t);}},t.aV=Rt,t.aW=Dg,t.aX=eu,t.aY=ru,t.aZ=sa,t.a_=Ma,t.aa=xo,t.ab=Ls,t.ac=uu,t.ad=O,t.ae=_,t.af=Tt,t.ag=So,t.ah=Gc,t.ai=ur,t.aj=Cn,t.ak=cr,t.al=Mt,t.am=sr,t.an=class{constructor(t){this.specification=t;}possiblyEvaluate(t,e){return function([t,e]){const r=Xt([1,t,e]);return {x:r.x,y:r.y,z:r.z}}(t.expression.evaluate(e))}interpolate(t,e,r){return {x:ur(t.x,e.x,r),y:ur(t.y,e.y,r),z:ur(t.z,e.z,r)}}},t.ao=function(t,e,r=0,n=!0){const i=new bt(r,r),s=t.sub(i),o=e.add(i),a=[s,new bt(o.x,s.y),o,new bt(s.x,o.y)];return n&&a.push(s.clone()),a},t.ap=function(t,e){const r=[];for(let n=0;n<t.length;n++){const i=Bt(n-1,-1,t.length-1),s=Bt(n+1,-1,t.length-1),o=t[n],a=t[s],l=t[i].sub(o).unit(),u=a.sub(o).unit(),c=u.angleWithSep(l.x,l.y),h=l.add(u).unit().mult(-1*e/Math.sin(c/2));r.push(o.add(h));}return r},t.aq=Lg,t.ar=sc,t.as=function(t,e,r=0){return A(((e.x-r)*t.scale-t.x)*Cn,(e.y*t.scale-t.y)*Cn,nu(e.z,e.y))},t.at=G,t.au=F,t.av=Cu,t.aw=Am,t.ax=function(t){let e=1/0,r=1/0,n=-1/0,i=-1/0;for(const s of t)e=Math.min(e,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y);return {min:new bt(e,r),max:new bt(n,i)}},t.ay=zt,t.az=c,t.b=function(t){return ne.API_FONTS_REGEX.test(t)},t.b$=Ig,t.b0=Ua,t.b1=mx,t.b2=function(){go.isLoading()||go.isLoaded()||"deferred"!==mo()||yo();},t.b3=Fo,t.b4=xu,t.b5=uw,t.b6=Wt,t.b7=vm,t.b8=up,t.b9=gu,t.bA=function(t,e){const{x:r,y:n}=t.point,i=$c(r,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return c(i,i,Uc(zc(e)))},t.bB=n,t.bC=j,t.bD=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},t.bE=T,t.bF=L,t.bG=D,t.bH=Ly,t.bI=my,t.bJ=Dy,t.bK=function(t,e,r,n,i){const s=5*e+2;t.float32[s+0]=r,t.float32[s+1]=n,t.float32[s+2]=i;},t.bL=hx,t.bM=at,t.bN=ct,t.bO=lt,t.bP=yt,t.bQ=Bt,t.bR=function(t,e,n,i){var s=new r(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s},t.bS=bd,t.bT=Xu,t.bU=Gm,t.bV=Sp,t.bW=Nx,t.bX=Fp,t.bY=Dp,t.bZ=Sy,t.b_=gg,t.ba=na,t.bb=Ca,t.bc=Mc,t.bd=el,t.be=vh,t.bf=Sx,t.bg=function(t,e){const r=Gc(e.zoom);if(0===r)return zc(t);const n=Cc(t),i=Fc(n),s=Jl(n.getWest())*e.worldSize,o=Jl(n.getEast())*e.worldSize,a=Ql(n.getNorth())*e.worldSize,l=Ql(n.getSouth())*e.worldSize,c=[s,a,0],h=[o,a,0],p=[s,l,0],d=[o,l,0],f=u([],e.globeMatrix);return O(c,c,f),O(h,h,f),O(p,p,f),O(d,d,f),i[0]=Tc(i[0],p,r),i[1]=Tc(i[1],d,r),i[2]=Tc(i[2],h,r),i[3]=Tc(i[3],c,r),Nu.fromPoints(i)},t.bh=Oc,t.bi=u,t.bj=Dc,t.bk=Tc,t.bl=ia,t.bm=Ac,t.bn=y,t.bo=h,t.bp=iw,t.bq=Jm,t.br=De,t.bs=function(t,e){const r=[];for(const n in t)n in e||r.push(n);return r},t.bt=Vt,t.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.bv=wt,t.bw=function(t){var e=new r(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.bx=l,t.by=m,t.bz=a,t.c=se,t.c$=45,t.c0=fw,t.c1=z,t.c2=q,t.c3=J,t.c4=function(t,e,r){r*=.5;var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=n*l+i*a,t[1]=i*l-n*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t},t.c5=Q,t.c6=Kt,t.c7=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.c8=x,t.c9=function(t,e,r,n,i){var s,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(s=1/(n-i)),t[14]=2*i*n*s):(t[10]=-1,t[14]=-2*n),t},t.cA=yc,t.cB=Vc,t.cC=function(t,e,r,n,i,s,o,a,l){if("globe"===l.name)return Vc(t,e,new yc(r,n,i),!1);const u=Dg({z:r,x:n,y:i},l);return new Nu([(s+u.x/u.scale)*e,e*(u.y/u.scale),o],[(s+u.x2/u.scale)*e,e*(u.y2/u.scale),a])},t.cD=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},t.cE=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},t.cF=function(t){const e=Math.round((t+45+360)%360/90)%4;return St[e]},t.cG=iu,t.cH=Z,t.cI=Ll,t.cJ=function(t){const e=l(new Float64Array(16));c(e,t.pixelMatrix,t.globeMatrix);const r=[0,Nl,0],n=[0,jl,0];return O(r,r,e),O(n,n,e),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!qc(t,new Xl(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!qc(t,new Xl(t.center.lat,-90))]},t.cK=function(t,e){const{scale:r}=t.tileTransform,n=r*Cn/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return function(t,e,r){var n=e[1],i=e[2],s=e[3],o=r[0],a=r[1];return t[0]=e[0]*o,t[1]=n*o,t[2]=i*a,t[3]=s*a,t}(new Float32Array(4),e.inverseAdjustmentMatrix,[n,n])},t.cL=Mf,t.cM=v,t.cN=_f,t.cO=function(t){const e=_f(t,!0);return n([],[e[0],e[1],e[4],e[5]])},t.cP=p,t.cQ=Fu,t.cR=d,t.cS=function(t){const{x:e,y:r}=t.point,{lng:n,lat:i}=t._center;return $c(e,r,t.worldSize,n,i)},t.cT=P,t.cU=It,t.cV=vc,t.cW=oc,t.cX=Dl,t.cY=function(t,e,r){let n=0;for(let r=0;r<2;++r){const i=0;t[r]>i&&(n+=(t[r]-i)*(t[r]-i)),e[r]<i&&(n+=(i-e[r])*(i-e[r]));}return n},t.cZ=function(t){return t*t*t*t*t},t.c_=Kl,t.ca=function(t,e,r,n,i,s,o){var a=1/(e-r),l=1/(n-i),u=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+r)*a,t[13]=(i+n)*l,t[14]=(o+s)*u,t[15]=1,t},t.cb=tu,t.cc=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3];},t.cd=hl,t.ce=fl,t.cf=pl,t.cg=dl,t.ch=xl,t.ci=Xl,t.cj=ix,t.ck=function(){var t=new r(4);return r!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.cl=function(t,e,r){var n=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=n*l+s*a,t[1]=i*l+o*a,t[2]=n*-a+s*l,t[3]=i*-a+o*l,t},t.cm=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.cn=$,t.co=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.cp=it,t.cq=N,t.cr=gc,t.cs=3,t.ct=2,t.cu=7,t.cv=6,t.cw=R,t.cx=b,t.cy=Uu,t.cz=Af,t.d=function(t){return ne.API_TILEJSON_REGEX.test(t)},t.d$=(t,e,r,n,i,s,o,a,l,u)=>{const c=t.transform,h=c.calculatePixelsToTileUnitsMatrix(e),p="none"===r.paint.get("line-trim-color-use-theme").constantOr("default"),d=c.pitch<15?Mm(.07,.7,zt((14-c.zoom)/5,0,1)):.07;return {u_matrix:Sm(t,e,r,n),u_pixels_to_tile_units:h,u_device_pixel_ratio:s,u_width_scale:o,u_floor_width_scale:a,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:i,u_texsize:Em(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Im(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:l,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(p?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:d,u_tile_to_meter:lu(e.tileID.canonical,0),u_ground_shadow_factor:u}},t.d0=ml,t.d1=function(t,e,r){const n=Math.sqrt(t*t+e*e+r*r),i=n>0?Math.acos(r/n)*At:0;let s=0!==t||0!==e?Math.atan2(-e,-t)*At+90:0;return s<0&&(s+=360),[n,s,i]},t.d2=A,t.d3=Xt,t.d4=lu,t.d5=I,t.d6=Nu,t.d7=S,t.d8=function(t){return [Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},t.d9=$x,t.dA=Cc,t.dB=function(t){const e=iu-5;t=zt(t,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Mt(t))),3);return Math.round(r*(Ul.length-1))},t.dC=function(t,e,r,n){const i=e.getNorth(),s=e.getSouth(),a=e.getWest(),l=e.getEast(),u=1<<t.z,c=l-a,h=i-s,p=c/Ol,d=-h/Ul[r],f=[0,p,0,d,0,0,i,a,0];if(t.z>0){const t=180/n;o(f,f,[t/c+1,0,0,0,t/h+1,0,-.5*t/p,.5*t/d,1]);}return f[2]=u,f[5]=t.x,f[8]=t.y,f},t.dD=zc,t.dE=function(t,e,r){const n=l(new Float64Array(16)),i=(e/(1<<t)-.5)*Math.PI*2;return f(n,r.globeMatrix,i),Float32Array.from(n)},t.dF=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return !1;const r=e.getSource().maxzoom,n=1<<r,i=Math.floor(t.x),s=Math.floor((t.x-i)*n),o=Math.floor(t.y*n),a=this.findDEMTileFor(new xc(r,i,r,s,o));return !(!a||!a.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const n=this._source();if(!n)return e;if(t.y<0||t.y>1)return e;const i=n.getSource().maxzoom,s=1<<i,o=Math.floor(t.x),a=t.x-o,l=new xc(i,o,i,Math.floor(a*s),Math.floor(t.y*s)),u=this.findDEMTileFor(l);if(!u||!u.dem)return e;const c=u.dem,h=1<<u.tileID.canonical.z,p=(a*h-u.tileID.canonical.x)*c.dim,d=(t.y*h-u.tileID.canonical.y)*c.dim,f=Math.floor(p),m=Math.floor(d);return (r?this.exaggeration():1)*ur(ur(c.get(f,m),c.get(f,m+1),d-m),ur(c.get(f+1,m),c.get(f+1,m+1),d-m),p-f)}getAtTileOffset(t,e,r){const n=1<<t.canonical.z;return this.getAtPointOrZero(new uu(t.wrap+(t.canonical.x+e/Cn)/n,(t.canonical.y+r/Cn)/n))}getAtTileOffsetFunc(t,e,r,n){return i=>{const s=this.getAtTileOffset(t,i.x,i.y),o=n.upVector(t.canonical,i.x,i.y);return z(o,o,s*n.upVectorScale(t.canonical,e,r).metersToTile),o}}getForTilePoints(t,e,r,n){if(this.isUsingMockSource())return !1;const i=Wx.create(this,t,n);return !!i&&(e.forEach((t=>{t[2]=this.exaggeration()*i.getElevationAt(t[0],t[1],r);})),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,i=1<<t.canonical.z-n.canonical.z;let s=t.canonical.x/i-n.canonical.x,o=t.canonical.y/i-n.canonical.y,a=0;for(let e=0;e<t.canonical.z-n.canonical.z&&!r.leaves[a];e++){s*=2,o*=2;const t=2*Math.floor(o)+Math.floor(s);a=r.childOffsets[a]+t,s%=1,o%=1;}return {min:this.exaggeration()*r.minimums[a],max:this.exaggeration()*r.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let e=!1,r=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const i of t){const t=this.getMinMaxForTile(i.tileID);t&&(r=Math.min(r,t.min),n=Math.max(n,t.max),e=!0);}return e?{min:r,max:n}:null}},t.dG=dh,t.dH=Ic,t.dI=function(t,e){return [Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},t.dJ=i,t.dK=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.dL=U,t.dM=jc,t.dN=te,t.dO=ee,t.dP=256,t.dQ=function(t,e){const r=[0,0,0];return O(r,r,Oc(zc(e.canonical))),O(r,r,t),r},t.dR=t=>({u_matrix:new xl(t),u_texsize:new dl(t),u_pixels_to_tile_units:new wl(t),u_device_pixel_ratio:new pl(t),u_width_scale:new pl(t),u_floor_width_scale:new pl(t),u_image:new hl(t),u_units_to_pixels:new dl(t),u_tile_units_to_pixels:new pl(t),u_alpha_discard_threshold:new pl(t),u_trim_offset:new dl(t),u_trim_fade_range:new dl(t),u_trim_color:new ml(t),u_emissive_strength:new pl(t),u_zbias_factor:new pl(t),u_tile_to_meter:new pl(t),u_ground_shadow_factor:new fl(t),u_pattern_transition:new pl(t)}),t.dS=t=>({u_matrix:new xl(t),u_pixels_to_tile_units:new wl(t),u_device_pixel_ratio:new pl(t),u_width_scale:new pl(t),u_floor_width_scale:new pl(t),u_units_to_pixels:new dl(t),u_dash_image:new hl(t),u_gradient_image:new hl(t),u_image_height:new pl(t),u_texsize:new dl(t),u_tile_units_to_pixels:new pl(t),u_alpha_discard_threshold:new pl(t),u_trim_offset:new dl(t),u_trim_fade_range:new dl(t),u_trim_color:new ml(t),u_emissive_strength:new pl(t),u_zbias_factor:new pl(t),u_tile_to_meter:new pl(t),u_ground_shadow_factor:new fl(t)}),t.dT=t=>({u_camera_to_center_distance:new pl(t),u_extrude_scale:new wl(t),u_device_pixel_ratio:new pl(t),u_matrix:new xl(t),u_inv_rot_matrix:new xl(t),u_merc_center:new dl(t),u_tile_id:new fl(t),u_zoom_transition:new pl(t),u_up_dir:new fl(t),u_emissive_strength:new pl(t)}),t.dU=_a,t.dV=$m,t.dW=Kc,t.dX=(t,e,r,n,i,s)=>{const o=t.transform,a="globe"===o.projection.name;let l;if("map"===s.paint.get("circle-pitch-alignment"))if(a){const t=jc(o.zoom,e.canonical)*o._pixelsPerMercatorPixel;l=Float32Array.from([t,0,0,t]);}else l=o.calculatePixelsToTileUnitsMatrix(r);else l=new Float32Array([o.pixelsToGLUnits[0],0,0,o.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(o.projection),u_matrix:t.translatePosMatrix(e.projMatrix,r,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:de.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Yc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:s.paint.get("circle-emissive-strength")};if(a){u.u_inv_rot_matrix=n,u.u_merc_center=i,u.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],u.u_zoom_transition=Gc(o.zoom);const t=i[0]*Cn,r=i[1]*Cn;u.u_up_dir=o.projection.upVector(new yc(0,0,0),t,r);}return u},t.dY=Pm,t.dZ=Dr,t.d_=(t,e,r,n,i,s,o,a,l,u)=>{const c=t.transform,h=c.pitch<15?Mm(.07,.7,zt((14-c.zoom)/5,0,1)):.07,p="none"===r.paint.get("line-trim-color-use-theme").constantOr("default");return {u_matrix:Sm(t,e,r,n),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:c.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:i,u_width_scale:s,u_floor_width_scale:o,u_image:0,u_tile_units_to_pixels:Im(e,c),u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(p?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:h,u_tile_to_meter:lu(e.tileID.canonical,0),u_ground_shadow_factor:l,u_pattern_transition:u}},t.da=function(t,e){return t.readFields(yv,{icons:[]},e)},t.db=Fd,t.dc=rg,t.dd=eg,t.de=Ce,t.df=ho,t.dg=me,t.dh=We,t.di=Nt,t.dj=function(t){const e=t.indexOf(Xo);return e>=0?t.slice(0,e):t},t.dk=function(t){return t.indexOf(Xo)>=0},t.dl=function(t){const e=t.lastIndexOf(Xo);return e>=0?t.slice(e+1):""},t.dm=function(t){const e=[],r=t.id;return void 0===r&&e.push({message:`layers.${r}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},t.dn=function(t,e,r,n){return "custom"===t.type?new Ox(t,e):new lv[t.type](t,e,r,n)},t.dp=Ut,t.dq=function(t){const e=t.indexOf(Xo);return e>=0?t.slice(e+1):""},t.dr=class extends uw{constructor(t,e){super(t._vectorTileFeature,t._z,t._x,t._y,t.id),t.state&&(this.state=Object.assign({},t.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=t.source,this.sourceLayer=t.sourceLayer,this.layer=t.layer);}toJSON(){const t=super.toJSON();return t.target=this.target,t.namespace=this.namespace,t}},t.ds=fo,t.dt=Fe,t.du=function(t){return t({pluginStatus:uo,pluginURL:co}),fo.on("pluginStateChange",t),t},t.dv=yl,t.dw=class extends cl{constructor(t){super(t),this.current=vl;}set(t,e,r){if(this.fetchUniformLocation(t,e))for(let t=0;t<9;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},t.dx=Pt,t.dy=function(t,e,r){const n=Gc(r.zoom),i=t.style.map._antialias,s=t.terrain&&t.terrain.exaggeration()>0;return 0===n&&!i&&!s},t.dz=function(t){const e=t.pixelsPerMeter,r=e/tu(1,t.center.lat),n=l(new Float64Array(16));return h(n,n,[t.point.x,t.point.y,0]),p(n,n,[r,r,e]),Float32Array.from(n)},t.e=ne,t.e$=mo,t.e0=Lt,t.e1=fh,t.e2=nu,t.e3=bc,t.e4=nd,t.e5=hd,t.e6=Hp,t.e7=450,t.e8=7,t.e9=ou,t.eA=function(t,e,n,i,s,o,a,l,u,c,h,p,d,f,m,y){var g=new r(16);return g[0]=t,g[1]=e,g[2]=n,g[3]=i,g[4]=s,g[5]=o,g[6]=a,g[7]=l,g[8]=u,g[9]=c,g[10]=h,g[11]=p,g[12]=d,g[13]=f,g[14]=m,g[15]=y,g},t.eB=Hl,t.eC=Ta,t.eD=za,t.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new bt(1/0,1/0),max:new bt(-1/0,-1/0)};}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[];}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){const r=Tp(new bt(0,0),new bt(Cn,Cn),t),n=[];if(e&&!kp(r,this._globalClipBounds))return n;for(const e of this._activeRegions){if(e.hiddenByOverlap)continue;if(!kp(r,e))continue;const i=Bp(e.min,e.max,t);n.push({min:i.min,max:i.max,sourceId:this._sourceIds[e.priority],footprint:e.footprint,footprintTileId:e.tileId,order:e.order,clipMask:e.clipMask,clipScope:e.clipScope});}return n}setSources(t){this._setSources(t.map((t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const e=[];for(const r of t.cache.getVisibleCoordinates()){const n=t.cache.getTile(r).buckets[t.layer];n&&n.updateFootprints(r.toUnwrapped(),e);}return e},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope}))));}_addSource(t){const e=t.getFootprints();if(0===e.length)return;const r=t.getOrder(),n=t.getClipMask(),i=t.getClipScope();for(const t of e){if(!t.footprint)continue;const e=Tp(t.footprint.min,t.footprint.max,t.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:t.id,footprint:t.footprint,order:r,clipMask:n,clipScope:i});}this._sourceIds.push(t.getSourceId());}_computeReplacement(){this._activeRegions.sort(((t,e)=>t.priority-e.priority||Pp(t.min,e.min)||Pp(t.max,e.max)||t.order-e.order||t.clipMask-e.clipMask||function(t,e){const r=(t,e)=>t+e;return t.length-e.length||t.reduce(r,"").localeCompare(e.reduce(r,""))}(t.clipScope,e.clipScope)));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){const r=this._activeRegions[e],n=this._prevRegions[e];t=r.priority!==n.priority||!Ep(r,n)||r.order!==n.order||r.clipMask!==n.clipMask||!wt(r.clipScope,n.clipScope),++e;}}if(t){++this._updateTime;for(const t of this._activeRegions)t.order!==Mp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,t.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,t.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,t.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,t.max.y));const t=t=>{const e=this._activeRegions;if(t>=e.length)return t;const r=e[t].priority;for(;t<e.length&&e[t].priority===r;)++t;return t};if(this._sourceIds.length>1){let e=0,r=t(e);for(;e!==r;){let n=e;const i=e;for(;n!==r;){const t=this._activeRegions[n];t.hiddenByOverlap=!1;for(let e=0;e<i;e++){const r=this._activeRegions[e];if(!r.hiddenByOverlap&&t.order===Mp&&kp(t,r)&&(t.hiddenByOverlap=Cp(t.footprint,t.tileId,r.footprint,r.tileId),t.hiddenByOverlap))break}++n;}e=r,r=t(e);}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement();}},t.eF=Mp,t.eG=class{constructor(t){this._createGrid(t),this._createPoles(t);}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();}_fillGridMeshWithLods(t,e){const r=new na,n=new Ma,i=[],s=t+1+2,o=e[0]+1,a=e[0]+1+(1+e.length),l=(t,e,r)=>{let n=t===s-1?t-2:0===t?t:t-1;return n+=r?24575:0,[n,e]};for(let t=0;t<s;++t)r.emplaceBack(...l(t,0,!0));for(let t=0;t<o;++t)for(let e=0;e<s;++e)r.emplaceBack(...l(e,t,(0===e||e===s-1)&&!0));for(let t=0;t<e.length;++t){const n=e[t];for(let t=0;t<s;++t)r.emplaceBack(...l(t,n,!0));}for(let t=0;t<e.length;++t){const o=n.length,l=e[t]+1+2,u=new Ma;for(let r=0;r<l-1;r++){const i=r===l-2,o=i?s*(a-e.length+t-r):s;for(let t=0;t<s-1;t++){const e=r*s+t;0===r||i||0===t||t===s-2?(u.emplaceBack(e+1,e,e+o),u.emplaceBack(e+o,e+o+1,e+1)):(n.emplaceBack(e+1,e,e+o),n.emplaceBack(e+o,e+o+1,e+1));}}const c=el.simpleSegment(0,o,r.length,n.length-o);for(let t=0;t<u.uint16.length;t+=3)n.emplaceBack(u.uint16[t],u.uint16[t+1],u.uint16[t+2]);const h=el.simpleSegment(0,o,r.length,n.length-o);i.push({withoutSkirts:c,withSkirts:h});}return {vertices:r,indices:n,segments:i}}_createGrid(t){const e=this._fillGridMeshWithLods(Ol,Ul);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Mc.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0);}_createPoles(t){const e=new Ma;for(let t=0;t<=Ol;t++)e.emplaceBack(0,t+1,t+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const r=new Ea,n=new Ea,i=new Ea,s=new Ea;this._poleSegments=[];for(let t=0,e=0;t<Dl;t++){const o=360/(1<<t);r.emplaceBack(0,-Fl,0,.5,0),n.emplaceBack(0,-Fl,0,.5,1),i.emplaceBack(0,-Fl,0,.5,.5),s.emplaceBack(0,-Fl,0,.5,.5);for(let t=0;t<=Ol;t++){let e=t/Ol,a=0;const l=ur(0,o,e),[u,c,h]=$l(Zc,Wc,l,Fl);r.emplaceBack(u,c,h,e,a),n.emplaceBack(u,c,h,e,1-a);const p=Mt(l);e=.5+.5*Math.sin(p),a=.5+.5*Math.cos(p),i.emplaceBack(u,c,h,e,a),s.emplaceBack(u,c,h,e,1-a);}this._poleSegments.push(el.simpleSegment(e,0,66,64)),e+=66;}this._poleNorthVertexBuffer=t.createVertexBuffer(r,_c,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,_c,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(i,_c,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(s,_c,!1);}getGridBuffers(t,e){return [this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return [e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},t.eH=Ip,t.eI=Et,t.eJ=function(){return !!document.fullscreenElement||!!document.webkitFullscreenElement},t.eK=kt,t.eL=au,t.eM=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},t.eN=H,t.eO=Gl,t.eP=V,t.eQ=M,t.eR=function([t,e,r]){const n=Math.hypot(t,e,r),i=Math.atan2(t,r),s=.5*Math.PI-Math.acos(-e/n);return new Xl(It(i),It(s))},t.eS=W,t.eT=Sf,t.eU=function(t){const e=t.navigator?t.navigator.userAgent:null;return !!function(t){if(null==Yt){const e=t.navigator?t.navigator.userAgent:null;Yt=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")));}return Yt}(t)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},t.eV=function(t,e){ge=t,xe=e;},t.eW=qc,t.eX=Hc,t.eY=function(t){const e=[0,0,0],r=l(new Float64Array(16));return c(r,t.pixelMatrix,t.globeMatrix),O(e,e,r),new bt(e[0],e[1])},t.eZ=function(){const t=Vd;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(zd),Vd=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"));},t.e_=function(){Fd().acquire(zd);},t.ea=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a;}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},t.eb=Tx,t.ec=ea,t.ed=La,t.ee=256,t.ef=Uc,t.eg=ha,t.eh=f,t.ei=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.ej=Ea,t.ek=ka,t.el=hs,t.em=function(t,e,r,n,i){return zt((t-e)/(r-e)*(i-n)+n,n,i)},t.en=tt,t.eo=function(t,e){var r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],h=c*o-a*u,p=-c*s+a*l,d=u*s-o*l,f=r*h+n*p+i*d;return f?(t[0]=h*(f=1/f),t[1]=(-c*n+i*u)*f,t[2]=(a*n-i*o)*f,t[3]=p*f,t[4]=(c*r-i*l)*f,t[5]=(-a*r+i*s)*f,t[6]=d*f,t[7]=(-u*r+n*l)*f,t[8]=(o*r-n*s)*f,t):null},t.ep=2,t.eq=C,t.er=zf,t.es=[1,1,1],t.et=class{constructor(t,e,r,n){this.context=t,this.format=n,this.size=r,this.texture=t.gl.createTexture();const[i,s,o]=this.size,{gl:a}=t;a.bindTexture(a.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1),a.texImage3D(a.TEXTURE_3D,0,this.format,i,s,o,0,hf(this.format),pf(this.format),e.data);}bind(t,e){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_3D,this.texture),t!==this.minFilter&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_T,e),this.wrapS=e);}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null;}},t.eu=Wx,t.ev=X,t.ew=function(t,e,r,n){var i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+n*(r[0]-i),t[1]=s+n*(r[1]-s),t[2]=o+n*(r[2]-o),t[3]=a+n*(r[3]-a),t},t.ex=Vf,t.ey=va,t.ez=Ba,t.f=function(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(Number("0x"+e)))))},t.f0=function(t,e,r=!1){if(uo===ao.deferred||uo===ao.loading||uo===ao.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");co=de.resolveURL(t),uo=ao.deferred,lo=e,po(),r||yo();},t.f1=function(t){Ud=de.resolveURL(t),jd||(jd=new Bd(Fd(),new tr)),jd.broadcast("setMeshoptUrl",Ud);},t.f2=Xd,t.f3=function(t){Rd=de.resolveURL(t),jd||(jd=new Bd(Fd(),new tr)),jd.broadcast("setDracoUrl",Rd);},t.f4=qd,t.f5=kd,t.f6=function(t){const e=_e();if(!e)return;const r=e.delete(ye);t&&r.then((()=>t())).catch(t);},t.f7=Td,t.f8=qs,t.f9=hh,t.fa=tg,t.fb=aw,t.fc=cw,t.fd=mm,t.fe=Su,t.ff="hd_road_elevation",t.fg=Gu,t.fh=Ot,t.fi=Kh,t.fj=Wy,t.fk=Xy,t.fl=function(t,e,r,n,i,s,o,a=1,l,u,c){t.createArrays(),t.tilePixelRatio=Cn/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const h=t.layers[0].layout,p=t.layers[0]._unevaluatedLayout._values,d={};d.scaleFactor=a,d.textSizeScaleRange=h.get("text-size-scale-range"),d.iconSizeScaleRange=h.get("icon-size-scale-range");const[f,m]=d.textSizeScaleRange,[y,g]=d.iconSizeScaleRange;d.textScaleFactor=zt(d.scaleFactor,f,m),d.iconScaleFactor=zt(d.scaleFactor,y,g);const x=p["text-size"],v=p["icon-size"];if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:r}=t.textSizeData;d.compositeTextSizes=[x.possiblyEvaluate(new xo(e,{worldview:c}),s),x.possiblyEvaluate(new xo(r,{worldview:c}),s)];}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:r}=t.iconSizeData;d.compositeIconSizes=[v.possiblyEvaluate(new xo(e,{worldview:c}),s),v.possiblyEvaluate(new xo(r,{worldview:c}),s)];}d.layoutTextSize=x.possiblyEvaluate(new xo(o+1,{worldview:c}),s),d.layoutIconSize=v.possiblyEvaluate(new xo(o+1,{worldview:c}),s),d.textMaxSize=x.possiblyEvaluate(new xo(18,{worldview:c}),s);const b=h.get("symbol-placement"),w="map"===h.get("text-rotation-alignment")&&"point"!==b,_=h.get("text-size");let A=!1;const M=[];for(const o of t.features){const a=h.get("text-font").evaluate(o,{},s).join(","),f=_.evaluate(o,{},s)*d.textScaleFactor,m=d.layoutTextSize.evaluate(o,{},s)*d.textScaleFactor,y=d.layoutIconSize.evaluate(o,{},s)*d.iconScaleFactor,g={horizontal:{},vertical:void 0},x=o.text;let v,I=[0,0];if(x){const n=x.toString(),u=h.get("text-letter-spacing").evaluate(o,{},s)*Gm,c=h.get("text-line-height").evaluate(o,{},s)*Gm,p=Qs(n)?u:0,d=h.get("text-anchor").evaluate(o,{},s),y=h.get("text-variable-anchor");if(!y){const t=h.get("text-radial-offset").evaluate(o,{},s);if(t)I=gg(d,[t*Gm,mg]);else {const t=h.get("text-offset").evaluate(o,{},s);I=[t[0]*Gm,t[1]*Gm];}}let v=w?"center":h.get("text-justify").evaluate(o,{},s);const _="point"===b,A=_?h.get("text-max-width").evaluate(o,{},s)*Gm:1/0,M=s=>{t.allowVerticalPlacement&&Js(n)&&(g.vertical=xy(x,e,r,i,a,A,c,d,s,p,I,my.vertical,!0,m,f,l));};if(!w&&y){const t="auto"===v?y.map((t=>Ig(t))):[v];let n=!1;for(let s=0;s<t.length;s++){const o=t[s];if(!g.horizontal[o])if(n)g.horizontal[o]=g.horizontal[0];else {const t=xy(x,e,r,i,a,A,c,"center",o,p,I,my.horizontal,!1,m,f,l);t&&(g.horizontal[o]=t,n=1===t.positionedLines.length);}}M("left");}else {if("auto"===v&&(v=Ig(d)),_||h.get("text-writing-mode").indexOf("horizontal")>=0||!Js(n)){const t=xy(x,e,r,i,a,A,c,d,v,p,I,my.horizontal,!1,m,f,l);t&&(g.horizontal[v]=t);}M(_?"left":v);}}let S,P,E,k,z,T,B=!1;const V=h.get("icon-text-fit").evaluate(o,{},s);if(o.icon&&o.icon.hasPrimary()){const e=bg(o.icon,t.iconSizeData,p["icon-size"],s,t.zoom,o,l,d.iconScaleFactor,c);S=e.iconPrimary,E=e.iconSecondary;const r=S.toString();if(P=n.get(r),P&&(z=h.get("icon-offset").evaluate(o,{},s),T=h.get("icon-anchor").evaluate(o,{},s),v=ky(i.get(r),E?i.get(E.toString()):void 0,z,T),B=P.sdf,void 0===t.sdfIcons?t.sdfIcons=P.sdf:t.sdfIcons!==P.sdf&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(P.pixelRatio!==t.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0)),E){const t=E.toString();k=n.get(t);}}A=A||!(!o.icon||!o.icon.hasSecondary());const C=Tg(g.horizontal)||g.vertical;t.iconsInText||(t.iconsInText=!!C&&C.iconsInText);const F=m*d.textScaleFactor/Gm,{defaultShapedIcon:D,verticallyShapedIcon:L}=Sg(t,v,h,o,s,g,F,z,V);"none"!==V&&v&&(Ty(v)||By(v))&&(xg(0,P,S,v,D,V,u,n,i),xg(0,k,E,v,D,V,u,n,i),L&&(xg(0,P,S,v,L,V,u,n,i),xg(0,k,E,v,L,V,u,n,i))),v=D,M.push({feature:o,shapedTextOrientations:g,shapedText:C,shapedIcon:v,iconPrimary:S,iconSecondary:E,iconOffset:z,iconAnchor:T,verticallyShapedIcon:L,layoutTextSize:m,layoutIconSize:y,textOffset:I,isSDFIcon:B,iconTextFit:V});}return {featureData:M,sizes:d,hasAnySecondaryIcon:A,textAlongLine:w,symbolPlacement:b}},t.fm=Yy,t.fn=function(t,e,r,n,i,s,o,a,l,u){const{featureData:c,hasAnySecondaryIcon:h,sizes:p,textAlongLine:d,symbolPlacement:f}=e;for(const e of c){const{shapedIcon:r,verticallyShapedIcon:s,feature:c,shapedTextOrientations:m,shapedText:y,layoutTextSize:g,textOffset:x,isSDFIcon:v,iconPrimary:b,iconSecondary:w,iconTextFit:_,iconOffset:A}=e;_g(r,u.iconPositions,b,w),_g(s,u.iconPositions,b,w),Ag(m,u.iconPositions),wg(b,w,u.iconPositions),(y||r)&&Pg(t,c,m,r,s,l,p,g,0,x,v,n,i,o,a,h,_,A,d,f);}r&&t.generateCollisionDebugBuffers(s,t.collisionBoxArray,p.textScaleFactor);},t.fo=Mu,t.fp=fb,t.fq=vu,t.fr=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==nf){const r=new Uint32Array(t,0,7),[,,n,i,s,o]=r;e=r.byteLength+i+s+o+s,(n!==t.byteLength||e>=t.byteLength)&&Gt("Invalid b3dm header information.");}return cf(t,e)},t.fs=function(t,e){const r=Xf(t);for(const t of r){for(const e of t.meshes)Zf(e);t.lights&&(t.lightMeshIndex=t.meshes.length,t.meshes.push(Yf(t.lights,e)));}return r},t.ft=rv,t.fu=Zt,t.fv=Ed,t.fw=go,t.fx=ao,t.fy=function(t){Ae(),null!=be&&be.then((e=>{e.keys().then((r=>{for(let n=0;n<r.length-t;n++)e.delete(r[n]).catch((t=>Gt(t.message)));})).catch((t=>Gt(t.message)));})).catch((t=>Gt(t.message)));},t.g=function(t,e){return Fe(Ct(t,{method:"GET"}),e)},t.h=Ct,t.i=function(t){return ne.API_STYLE_REGEX.test(t)&&!se(t)},t.j=function(t){return 0===t.indexOf("mapbox:")},t.k=ie,t.l=Ie,t.m=function(t){return decodeURIComponent(atob(t).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join(""))},t.n=function(t,e){return Fe(Ct(t,{type:"json"}),e)},t.o=Ne,t.p=function(t,e){return Fe(Ct(t,{method:"POST"}),e)},t.q=de,t.r=ph,t.s=function(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return !1}},t.t=pe,t.u=function(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()},t.v=function(t){return !!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)},t.w=Gt,t.x=function(){return Cd||(Cd=new Td),Cd},t.y=rb,t.z=Ke;}));

define(["./shared"],(function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function s(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const i of e)t+=`${s(i)},`;return `${t}]`}let t="{";for(const i of Object.keys(e).sort())t+=`${i}:${s(e[i])},`;return `${t}}`}function i(t){let i="";for(const o of e.bu)i+=`/${s(t[o])}`;return i}class o{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e);}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t);}update(t,o,n){this._options=n;for(const s of t)this._layerConfigs[s.id]=s,(this._layers[s.id]=e.dn(s,this.scope,null,this._options)).compileFilter(n),this.keyCache[s.id]&&delete this.keyCache[s.id];for(const e of o)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const r=function(e,t){const o={};for(let n=0;n<e.length;n++){const r=e[n];let a=t&&t[r.id];a||("symbol"===r.type?a=r.id:(a=i(r),"line"===r.type&&r.paint&&function e(t){return "string"==typeof t&&"line-progress"===t||(Array.isArray(t)?t.some(e):!(!t||"object"!=typeof t)&&Object.values(t).some(e))}(r.paint["line-width"])&&(a+=`/${s(r.paint["line-width"])}`))),t&&(t[r.id]=a);let l=o[a];l||(l=o[a]=[]),l.push(r);}const n=[];for(const e in o)n.push(o[e]);return n}(Object.values(this._layerConfigs),this.keyCache);for(const e of r){const t=e.map((e=>this._layers[e.id])),s=t[0];if("none"===s.visibility)continue;const i=s.source||"";let o=this.familiesBySource[i];o||(o=this.familiesBySource[i]={});const n=s.sourceLayer||"_geojsonTileLayer";let r=o[n];r||(r=o[n]=[]),r.push(t);}}}const n=1*e.fa;class r{constructor(t){const s={},i=[];for(const e in t){const o=t[e],r=s[e]={};for(const e in o.glyphs){const t=o.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const s=t.metrics.localGlyph?n:1,a={x:0,y:0,w:t.bitmap.width+2*s,h:t.bitmap.height+2*s};i.push(a),r[e]=a;}}const{w:o,h:r}=e.H(i),a=new e.f9({width:o||1,height:r||1});for(const i in t){const o=t[i];for(const t in o.glyphs){const r=o.glyphs[+t];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const l=s[i][t],c=r.metrics.localGlyph?n:1;e.f9.copy(r.bitmap,a,{x:0,y:0},{x:l.x+c,y:l.y+c},r.bitmap);}}this.image=a,this.positions=s;}}e.f8(r,"GlyphAtlas");class a{constructor(t){this.tileID=new e.aM(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.lut=t.lut,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.request&&t.request.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.aW(t.tileID.canonical,t.projection),this.projection=t.projection,this.worldview=t.worldview,this.localizableLayerIds=t.localizableLayerIds,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster,this.tessellationStep=t.tessellationStep,this.scaleFactor=t.scaleFactor,this.worldview=t.worldview;}parse(t,s,i,o,n,a){this.status="parsing",this.data=t,this.collisionBoxArray=new e.b0;const c=new e.fb(Object.keys(t.layers).sort()),h=new e.fc(this.tileID,this.promoteId);h.bucketLayerIDs=[];const u={},d=new e.fd(256,256),f={featureIndex:h,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:d,availableImages:i,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},p=[],g=s.familiesBySource[this.source];for(const s in g){const n=t.layers[s];if(!n)continue;let r=!1,a=!1,d=!1;for(const e of g[s])"symbol"===e[0].type?r=!0:a=!0,e[0].is3D()&&"model"!==e[0].type&&(d=!0);if(this.extraShadowCaster&&!d)continue;if(!0===this.isSymbolTile&&!r)continue;if(!1===this.isSymbolTile&&!a)continue;1===n.version&&e.w(`Vector tile source "${this.source}" layer "${s}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const m=c.encode(s),y=[];let w=!1;for(let t=0,i=0;t<n.length;t++){const o=n.feature(t),r=h.getId(o,s);if(this.localizableLayerIds&&this.localizableLayerIds.has(s)){const e=o.properties?o.properties.worldview:null;if(this.worldview&&"string"==typeof e)if("all"===e)o.properties.$localized=!0;else {if(!e.split(",").includes(this.worldview))continue;o.properties.$localized=!0,o.properties.worldview=this.worldview;}}!w&&o.properties&&o.properties.hasOwnProperty(e.fe)&&(w=!0),y.push({feature:o,id:r,index:i,sourceLayerIndex:m}),i++;}w&&!f.elevationFeatures&&t.layers.hasOwnProperty(e.ff)&&(f.elevationFeatures=e.fg.parseFrom(t.layers[e.ff],this.canonical));for(const t of g[s]){const s=t[0];if(this.extraShadowCaster&&(!s.is3D()||"model"===s.type))continue;if(void 0!==this.isSymbolTile&&"symbol"===s.type!==this.isSymbolTile)continue;if(s.minzoom&&this.zoom<Math.floor(s.minzoom))continue;if(s.maxzoom&&this.zoom>=s.maxzoom)continue;if("none"===s.visibility)continue;l(t,this.zoom,f.brightness,i,this.worldview);const n=u[s.id]=s.createBucket({index:h.bucketLayerIDs.length,layers:t,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:m,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:o,worldview:this.worldview});h.bucketLayerIDs.push(t.map((t=>e.C(t.id,t.scope))));let r=n.prepare?n.prepare():null;null!=r?(r=r.then((()=>n.populate(y,f,this.tileID.canonical,this.tileTransform))),p.push(r)):n.populate(y,f,this.tileID.canonical,this.tileTransform);}}const m=()=>{let s,o,p,g,m,y;d.trim();const w={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},b=()=>{if(s)return this.status="done",a(s);if(this.extraShadowCaster)this.status="done",a(null,{buckets:Object.values(u).filter((e=>!e.isEmpty())),featureIndex:h,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:f.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(o&&p&&g){const t=new r(o),s=new Map;for(const[t,i]of p.entries()){const{imagePosition:o}=e.fj(t,i,e.fk);s.set(t,o);}const a={};for(const n in u){const r=u[n];r instanceof e.b1&&(l(r.layers,this.zoom,f.brightness,i,this.worldview),a[n]=e.fl(r,o,t.positions,p,s,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,m,this.worldview));}const c={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(n,p,m,(()=>{c.iconsPending=!1,x(a,t,c);})),this.rasterizeIfNeeded(n,g,y,(()=>{c.patternsPending=!1,x(a,t,c);}));}},x=(t,s,o,n)=>{if(o.iconsPending||o.patternsPending)return;const r=new e.fm(p,g,this.lut);for(const s in u){const o=u[s];if(s in t)e.fn(o,t[s],this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,p,r);else if(o.hasPattern&&(o instanceof e.b7||o instanceof e.b8||o instanceof e.e4)){l(o.layers,this.zoom,f.brightness,i,this.worldview);const e=Object.fromEntries(r.patternPositions);o.addFeatures(f,this.tileID.canonical,e,i,this.tileTransform,this.brightness);}}this.status="done",a(null,{buckets:Object.values(u).filter((e=>!e.isEmpty())),featureIndex:h,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:s.image,lineAtlas:d,imageAtlas:r,brightness:f.brightness});};if(!this.extraShadowCaster){const t=e.fh(f.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(t).length?n.send("getGlyphs",{uid:this.uid,stacks:t},((e,t)=>{s||(s=e,o=t,b());}),void 0,!1,w):o={};const i=Array.from(f.iconDependencies.keys()).map((t=>e.I.parse(t)));i.length?n.send("getImages",{images:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{s||(s=e,p=new Map,m=this.updateImageMapAndGetImageTaskQueue(p,t,f.iconDependencies),b());}),void 0,!1,w):(p=new Map,m=new Map);const r=Array.from(f.patternDependencies.keys()).map((t=>e.I.parse(t)));r.length?n.send("getImages",{images:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{s||(s=e,g=new Map,y=this.updateImageMapAndGetImageTaskQueue(g,t,f.patternDependencies),b());}),void 0,!1,w):(g=new Map,y=new Map);}if(f.elevationFeatures&&f.elevationFeatures.length>0){const s=[];for(const t of Object.values(u))if(t instanceof e.b8){const e=t.getUnevaluatedPortalGraph();e&&s.push(e);}const i=e.fi.evaluate(s);for(const s of Object.values(u))if(s instanceof e.b8){const e=t.layers[c.decode(s.sourceLayerIndex)];s.setEvaluatedPortalGraph(i,e,this.tileID.canonical,f.availableImages,f.brightness);}}b();};p.length>0?Promise.allSettled(p).then(m).catch(a):m();}rasterizeIfNeeded(e,t,s,i){Array.from(t.values()).some((e=>e.usvg))?this.rasterize(e,t,s,i):i();}updateImageMapAndGetImageTaskQueue(e,t,s){const i=new Map;for(const o of t.keys()){const n=s.get(o)||[];for(const s of n){const o=s.toString(),n=t.get(s.id.toString());n.usvg?i.has(o)||(i.set(o,s),e.set(o,Object.assign({},n))):e.set(o,n);}}return i}rasterize(e,t,s,i){this.rasterizeTask=e.send("rasterizeImages",{scope:this.scope,tasks:s},((e,s)=>{if(!e)for(const[e,i]of s.entries()){const s=Object.assign(t.get(e),{data:i});t.set(e,s);}i();}));}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel();}}function l(t,s,i,o,n){const r=new e.aa(s,{brightness:i,worldview:n});for(const e of t)e.recalculate(r,o);}class c extends e.E{constructor(t,s,i,o,n,r,a){super(),this.actor=t,this.layerIndex=s,this.availableImages=i,this.availableModels=o,this.loadVectorData=r||e.aJ,this.loading={},this.loaded={},this.deduped=new e.aI(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler,this.brightness=a;}loadTile(s,i){const o=s.uid,n=s&&s.request,r=n&&n.collectResourceTiming,l=this.loading[o]=new a(s);l.abort=this.loadVectorData(s,((a,c)=>{const h=!this.loading[o];if(delete this.loading[o],l.cancelRasterize(),h||a||!c)return l.status="done",h||(this.loaded[o]=l),i(a);const u=c.rawData,d={};c.expires&&(d.expires=c.expires),c.cacheControl&&(d.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.fo(new e.bq(u));const f=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((s,o)=>{if(s||!o)return i(s);const a={};if(r){const e=t(n);e.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(e)));}i(null,e.h({rawTileData:u.slice(0)},o,d,a));}));};this.isSpriteLoaded?f():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(f,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):f();})),this.loaded=this.loaded||{},this.loaded[o]=l;}));}reloadTile(t,s){const i=this.loaded,o=t.uid;if(i&&i[o]){const n=i[o];n.scaleFactor=t.scaleFactor,n.showCollisionBoxes=t.showCollisionBoxes,n.projection=t.projection,n.brightness=t.brightness,n.tileTransform=e.aW(t.tileID.canonical,t.projection),n.extraShadowCaster=t.extraShadowCaster,n.lut=t.lut,n.worldview=t.worldview;const r=(e,t)=>{const i=n.reloadCallback;i&&(delete n.reloadCallback,n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,i)),s(e,t);};"parsing"===n.status?n.reloadCallback=r:"done"===n.status&&(n.vectorTile?n.parse(n.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,r):r());}else s(null,void 0);}abortTile(e,t){const s=e.uid,i=this.loading[s];i&&(i.abort&&i.abort(),delete this.loading[s]),t();}removeTile(e,t){const s=this.loaded,i=e.uid;s&&s[i]&&delete s[i],t();}}class h{loadTile(t,s){const{uid:i,encoding:o,rawImageData:n,padding:r}=t,a=ImageBitmap&&n instanceof ImageBitmap?this.getImageData(n,r):n;s(null,new e.fp(i,a,o,r<1));}reloadTile(e,t){t(null,null);}abortTile(e,t){t();}removeTile(e,t){t();}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const s=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),s}}e.bp.setPbf(e.bq);class u{constructor(t){this._mrt=new e.bp(t.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=t.uid,this.tileID=t.tileID,this.source=t.source;}parse(t,s){const i=this._mrt;this.status="parsing",this._entireBuffer=t;try{i.parseHeader(t),this._isHeaderLoaded=!0;const o=[];for(const s in i.layers){const n=i.getLayer(s),r=n.getDataRange(n.getBandList()),a=i.createDecodingTask(r),l=t.slice(r.firstByte,r.lastByte+1),c=e.bp.performDecoding(l,a).then((e=>a.complete(null,e))).catch((e=>a.complete(e,null)));o.push(c);}Promise.allSettled(o).then((()=>s(null,i))).catch((e=>s(e)));}catch(e){s(e);}}}class d{constructor(e){this.actor=e,this.loading={},this.loaded={};}loadTile(t,s){const i=t.uid,o=t.request,n=this.loading[i]=new u(t),{cancel:r}=e.br(o,((e,t,o,r)=>{const a=!this.loading[i];if(delete this.loading[i],a||e||!t)return n.status="done",a||(this.loaded[i]=n),s(e);n.parse(t,((e,t)=>{if(e||!t)return s(e);s(null,t,o,r);})),this.loaded[i]=n;}));n.abort=r;}reloadTile(e,t){t(null,void 0);}abortTile(e,t){const s=e.uid,i=this.loading[s];i&&(i.abort&&i.abort(),delete this.loading[s]),t();}removeTile(e,t){const s=e.uid;this.loaded[s]&&delete this.loaded[s],t();}decodeRasterArray(t,s){e.bp.performDecoding(t.buffer,t.task).then((e=>s(null,e))).catch((e=>s(e)));}}const f=e.fq.prototype.toGeoJSON;class p{constructor(t){this._feature=t,this.extent=e.aj,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10));}loadGeometry(){if(1===this._feature.type){const t=[];for(const s of this._feature.geometry)t.push([new e.P(s[0],s[1])]);return t}{const t=[];for(const s of this._feature.geometry){const i=[];for(const t of s)i.push(new e.P(t[0],t[1]));t.push(i);}return t}}toGeoJSON(e,t,s){return f.call(this,e,t,s)}}class g{constructor(t,s){this.name=t,this.extent=e.aj,this.length=s.length,this._jsonFeatures=s;}feature(e){return new p(this._jsonFeatures[e])}}class m{constructor(t){this.layers={},this.extent=e.aj;for(const e of Object.keys(t))this.layers[e]=new g(e,t[e]);}}const y=64/4096,w=128;class b{constructor(){this.features=new Map;}clear(){this.features.clear();}load(e=[],t){for(const s of e){const e=s.id;if(null==e)continue;let i=this.features.get(e);i&&this.updateCache(i,t),s.geometry?(i=v(s),this.updateCache(i,t),this.features.set(e,i)):this.features.delete(e),this.updateCache(i,t);}}updateCache(e,t){for(const{canonical:s,uid:i}of Object.values(t)){const{z:o,x:n,y:r}=s;x(e,Math.pow(2,o),n,r)&&delete t[i];}}getTile(e,t,s){const i=Math.pow(2,e),o=[];for(const e of this.features.values())x(e,i,t,s)&&o.push(P(e,i,t,s));return {features:o}}getFeatures(){return [...this.features.values()]}}function x({minX:e,minY:t,maxX:s,maxY:i},o,n,r){return e<(n+1+y)/o&&t<(r+1+y)/o&&s>(n-y)/o&&i>(r-y)/o}function v(e){const{id:t,geometry:s,properties:i}=e;if(!s)return;if("GeometryCollection"===s.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:o,coordinates:n}=s,r={id:t,type:1,geometry:[],tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},a=r.geometry;if("Point"===o)I(n,a,r);else if("MultiPoint"===o)for(const e of n)I(e,a,r);else if("LineString"===o)r.type=2,S(n,a,r);else if("MultiLineString"===o)r.type=2,M(n,a,r);else if("Polygon"===o)r.type=3,M(n,a,r,!0);else {if("MultiPolygon"!==o)throw new Error("Input data is not a valid GeoJSON object.");r.type=3;for(const e of n)M(e,a,r,!0);}return r}function I([t,s],i,o){const n=e.aD(t);let r=e.aH(s);r=r<0?0:r>1?1:r,i.push(n,r),o.minX=Math.min(o.minX,n),o.minY=Math.min(o.minY,r),o.maxX=Math.max(o.maxX,n),o.maxY=Math.max(o.maxY,r);}function S(e,t,s,i=!1,o=!1){const n=[];for(const t of e)I(t,n,s);t.push(n),i&&function(e,t){let s=0;for(let t=0,i=e.length,o=i-2;t<i;o=t,t+=2)s+=(e[t]-e[o])*(e[t+1]+e[o+1]);if(s>0===t)for(let t=0,s=e.length;t<s/2;t+=2){const i=e[t],o=e[t+1];e[t]=e[s-2-t],e[t+1]=e[s-1-t],e[s-2-t]=i,e[s-1-t]=o;}}(n,o);}function M(e,t,s,i=!1){for(let o=0;o<e.length;o++)S(e[o],t,s,i,0===o);}function P(t,s,i,o){const{id:n,type:r,geometry:a,tags:l}=t,c=[];if(1===r)!function(t,s,i,o,n){for(let r=0;r<t.length;r+=2){const a=Math.round(e.aj*(t[r+0]*s-i)),l=Math.round(e.aj*(t[r+1]*s-o));n.push([a,l]);}}(a,s,i,o,c);else for(const e of a)T(e,s,i,o,c);return {id:n,type:r,geometry:c,tags:l}}function T(t,s,i,o,n){const r=-w,a=e.aj+w;let l;for(let c=0;c<t.length-2;c+=2){let h=Math.round(e.aj*(t[c+0]*s-i)),u=Math.round(e.aj*(t[c+1]*s-o)),d=Math.round(e.aj*(t[c+2]*s-i)),f=Math.round(e.aj*(t[c+3]*s-o));const p=d-h,g=f-u;h<r&&d<r||(h<r?(u+=Math.round(g*((r-h)/p)),h=r):d<r&&(f=u+Math.round(g*((r-h)/p)),d=r),u<r&&f<r||(u<r?(h+=Math.round(p*((r-u)/g)),u=r):f<r&&(d=h+Math.round(p*((r-u)/g)),f=r),h>=a&&d>=a||(h>=a?(u+=Math.round(g*((a-h)/p)),h=a):d>=a&&(f=u+Math.round(g*((a-h)/p)),d=a),u>=a&&f>=a||(u>=a?(h+=Math.round(p*((a-u)/g)),u=a):f>=a&&(d=h+Math.round(p*((a-u)/g)),f=a),l&&h===l[l.length-1][0]&&u===l[l.length-1][1]||(l=[[h,u]],n.push(l)),l.push([d,f])))));}}function k({name:t,features:s},i){i.writeStringField(1,t),i.writeVarintField(5,e.aj);const o=new Map,n=new Map,r={keys:o,values:n,feature:null};for(const e of s)r.feature=e,i.writeMessage(2,L,r);for(const e of o.keys())i.writeStringField(3,e);for(const e of n.keys())i.writeMessage(4,D,e);}function L(e,t){const s=e.feature;void 0===s.id||isNaN(+s.id)||t.writeVarintField(1,+s.id),s.tags&&t.writeMessage(2,j,e),t.writeVarintField(3,s.type),t.writeMessage(4,z,s);}function j({keys:e,values:t,feature:s},i){for(const o of Object.keys(s.tags)){let n=s.tags[o];if(null===n)continue;let r=e.get(o);void 0===r&&(r=e.size,e.set(o,r)),i.writeVarint(r);const a=typeof n;"string"!==a&&"boolean"!==a&&"number"!==a&&(n=JSON.stringify(n));let l=t.get(n);void 0===l&&(l=t.size,t.set(n,l)),i.writeVarint(l);}}function _(e,t){return (t<<3)+(7&e)}function C(e){return e<<1^e>>31}function z(e,t){const{geometry:s,type:i}=e;let o=0,n=0;if(1===i){t.writeVarint(_(1,s.length));for(const e of s){const s=e[0]-o,i=e[1]-n;t.writeVarint(C(s)),t.writeVarint(C(i)),o+=s,n+=i;}}else for(const e of s){t.writeVarint(_(1,1));const s=e.length-(3===i?1:0);for(let i=0;i<s;i++){1===i&&t.writeVarint(_(2,s-1));const r=e[i][0]-o,a=e[i][1]-n;t.writeVarint(C(r)),t.writeVarint(C(a)),o+=r,n+=a;}3===i&&t.writeVarint(_(7,1));}}function D(e,t){const s=typeof e;"string"===s?t.writeStringField(1,e):"boolean"===s?t.writeBooleanField(7,e):"number"===s&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e));}const O={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},F=Math.fround||(A=new Float32Array(1),e=>(A[0]=+e,A[0]));var A;const Z=3,N=5,B=6;class R{constructor(e){this.options=Object.assign(Object.create(O),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[];}load(e){const{log:t,minZoom:s,maxZoom:i}=this.options;t&&console.time("total time");const o=`prepare ${e.length} points`;t&&console.time(o),this.points=e;const n=[];for(let t=0;t<e.length;t++){const s=e[t];if(!s.geometry)continue;const[i,o]=s.geometry.coordinates,r=F(Y(i)),a=F(J(o));n.push(r,a,1/0,t,-1,1),this.options.reduce&&n.push(0);}let r=this.trees[i+1]=this._createTree(n);t&&console.timeEnd(o);for(let e=i;e>=s;e--){const s=+Date.now();r=this.trees[e]=this._createTree(this._cluster(r,e)),t&&console.log("z%d: %d clusters in %dms",e,r.numItems,+Date.now()-s);}return t&&console.timeEnd("total time"),this}getClusters(e,t){let s=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let o=180===e[2]?180:((e[2]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)s=-180,o=180;else if(s>o){const e=this.getClusters([s,i,180,n],t),r=this.getClusters([-180,i,o,n],t);return e.concat(r)}const r=this.trees[this._limitZoom(t)],a=r.range(Y(s),J(n),Y(o),J(i)),l=r.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+N]>1?X(l,t,this.clusterProps):this.points[l[t+Z]]);}return c}getChildren(e){const t=this._getOriginId(e),s=this._getOriginZoom(e),i="No cluster with the specified id.",o=this.trees[s];if(!o)throw new Error(i);const n=o.data;if(t*this.stride>=n.length)throw new Error(i);const r=this.options.radius/(this.options.extent*Math.pow(2,s-1)),a=o.within(n[t*this.stride],n[t*this.stride+1],r),l=[];for(const t of a){const s=t*this.stride;n[s+4]===e&&l.push(n[s+N]>1?X(n,s,this.clusterProps):this.points[n[s+Z]]);}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,s){const i=[];return this._appendLeaves(i,e,t=t||10,s=s||0,0),i}getTile(e,t,s){const i=this.trees[this._limitZoom(e)],o=Math.pow(2,e),{extent:n,radius:r}=this.options,a=r/n,l=(s-a)/o,c=(s+1+a)/o,h={features:[]};return this._addTileFeatures(i.range((t-a)/o,l,(t+1+a)/o,c),i.data,t,s,o,h),0===t&&this._addTileFeatures(i.range(1-a/o,l,1,c),i.data,o,s,o,h),t===o-1&&this._addTileFeatures(i.range(0,l,a/o,c),i.data,-1,s,o,h),h.features.length?h:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const s=this.getChildren(e);if(t++,1!==s.length)break;e=s[0].properties.cluster_id;}return t}_appendLeaves(e,t,s,i,o){const n=this.getChildren(t);for(const t of n){const n=t.properties;if(n&&n.cluster?o+n.point_count<=i?o+=n.point_count:o=this._appendLeaves(e,n.cluster_id,s,i,o):o<i?o++:e.push(t),e.length===s)break}return o}_createTree(t){const s=new e.c0(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)s.add(t[e],t[e+1]);return s.finish(),s.data=t,s}_addTileFeatures(e,t,s,i,o,n){for(const r of e){const e=r*this.stride,a=t[e+N]>1;let l,c,h;if(a)l=E(t,e,this.clusterProps),c=t[e],h=t[e+1];else {const s=this.points[t[e+Z]];l=s.properties;const[i,o]=s.geometry.coordinates;c=Y(i),h=J(o);}const u={type:1,geometry:[[Math.round(this.options.extent*(c*o-s)),Math.round(this.options.extent*(h*o-i))]],tags:l};let d;d=a||this.options.generateId?t[e+Z]:this.points[t[e+Z]].id,void 0!==d&&(u.id=d),n.features.push(u);}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:s,extent:i,reduce:o,minPoints:n}=this.options,r=s/(i*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let s=0;s<a.length;s+=c){if(a[s+2]<=t)continue;a[s+2]=t;const i=a[s],h=a[s+1],u=e.within(a[s],a[s+1],r),d=a[s+N];let f=d;for(const e of u){const s=e*c;a[s+2]>t&&(f+=a[s+N]);}if(f>d&&f>=n){let e,n=i*d,r=h*d,p=-1;const g=(s/c<<5)+(t+1)+this.points.length;for(const i of u){const l=i*c;if(a[l+2]<=t)continue;a[l+2]=t;const h=a[l+N];n+=a[l]*h,r+=a[l+1]*h,a[l+4]=g,o&&(e||(e=this._map(a,s,!0),p=this.clusterProps.length,this.clusterProps.push(e)),o(e,this._map(a,l)));}a[s+4]=g,l.push(n/f,r/f,1/0,g,-1,f),o&&l.push(p);}else {for(let e=0;e<c;e++)l.push(a[s+e]);if(f>1)for(const e of u){const s=e*c;if(!(a[s+2]<=t)){a[s+2]=t;for(let e=0;e<c;e++)l.push(a[s+e]);}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return (e-this.points.length)%32}_map(e,t,s){if(e[t+N]>1){const i=this.clusterProps[e[t+B]];return s?Object.assign({},i):i}const i=this.points[e[t+Z]].properties,o=this.options.map(i);return s&&o===i?Object.assign({},o):o}}function X(e,t,s){return {type:"Feature",id:e[t+Z],properties:E(e,t,s),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),G(e[t+1])]}};var i;}function E(e,t,s){const i=e[t+N],o=i>=1e4?`${Math.round(i/1e3)}k`:i>=1e3?Math.round(i/100)/10+"k":i,n=e[t+B],r=-1===n?{}:Object.assign({},s[n]);return Object.assign(r,{cluster:!0,cluster_id:e[t+Z],point_count:i,point_count_abbreviated:o})}function Y(e){return e/360+.5}function J(e){const t=Math.sin(e*Math.PI/180),s=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return s<0?0:s>1?1:s}function G(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function V(e,t,s,i){let o=i;const n=t+(s-t>>1);let r,a=s-t;const l=e[t],c=e[t+1],h=e[s],u=e[s+1];for(let i=t+3;i<s;i+=3){const t=$(e[i],e[i+1],l,c,h,u);if(t>o)r=i,o=t;else if(t===o){const e=Math.abs(i-n);e<a&&(r=i,a=e);}}o>i&&(r-t>3&&V(e,t,r,i),e[r+2]=o,s-r>3&&V(e,r,s,i));}function $(e,t,s,i,o,n){let r=o-s,a=n-i;if(0!==r||0!==a){const l=((e-s)*r+(t-i)*a)/(r*r+a*a);l>1?(s=o,i=n):l>0&&(s+=r*l,i+=a*l);}return r=e-s,a=t-i,r*r+a*a}function q(e,t,s,i){const o={id:e??null,type:t,geometry:s,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)U(o,s);else if("Polygon"===t)U(o,s[0]);else if("MultiLineString"===t)for(const e of s)U(o,e);else if("MultiPolygon"===t)for(const e of s)U(o,e[0]);return o}function U(e,t){for(let s=0;s<t.length;s+=3)e.minX=Math.min(e.minX,t[s]),e.minY=Math.min(e.minY,t[s+1]),e.maxX=Math.max(e.maxX,t[s]),e.maxY=Math.max(e.maxY,t[s+1]);}function W(e,t,s,i){if(!t.geometry)return;const o=t.geometry.coordinates;if(o&&0===o.length)return;const n=t.geometry.type,r=Math.pow(s.tolerance/((1<<s.maxZoom)*s.extent),2);let a=[],l=t.id;if(s.promoteId?l=t.properties[s.promoteId]:s.generateId&&(l=i||0),"Point"===n)H(o,a);else if("MultiPoint"===n)for(const e of o)H(e,a);else if("LineString"===n)Q(o,a,r,!1);else if("MultiLineString"===n){if(s.lineMetrics){for(const s of o)a=[],Q(s,a,r,!1),e.push(q(l,"LineString",a,t.properties));return}K(o,a,r,!1);}else if("Polygon"===n)K(o,a,r,!0);else {if("MultiPolygon"!==n){if("GeometryCollection"===n){for(const o of t.geometry.geometries)W(e,{id:l,geometry:o,properties:t.properties},s,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of o){const t=[];K(e,t,r,!0),a.push(t);}}e.push(q(l,n,a,t.properties));}function H(e,t){t.push(ee(e[0]),te(e[1]),0);}function Q(e,t,s,i){let o,n,r=0;for(let s=0;s<e.length;s++){const a=ee(e[s][0]),l=te(e[s][1]);t.push(a,l,0),s>0&&(r+=i?(o*l-a*n)/2:Math.sqrt(Math.pow(a-o,2)+Math.pow(l-n,2))),o=a,n=l;}const a=t.length-3;t[2]=1,V(t,0,a,s),t[a+2]=1,t.size=Math.abs(r),t.start=0,t.end=t.size;}function K(e,t,s,i){for(let o=0;o<e.length;o++){const n=[];Q(e[o],n,s,i),t.push(n);}}function ee(e){return e/360+.5}function te(e){const t=Math.sin(e*Math.PI/180),s=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return s<0?0:s>1?1:s}function se(e,t,s,i,o,n,r,a){if(i/=t,n>=(s/=t)&&r<i)return e;if(r<s||n>=i)return null;const l=[];for(const t of e){const e=t.geometry;let n=t.type;const r=0===o?t.minX:t.minY,c=0===o?t.maxX:t.maxY;if(r>=s&&c<i){l.push(t);continue}if(c<s||r>=i)continue;let h=[];if("Point"===n||"MultiPoint"===n)ie(e,h,s,i,o);else if("LineString"===n)oe(e,h,s,i,o,!1,a.lineMetrics);else if("MultiLineString"===n)re(e,h,s,i,o,!1);else if("Polygon"===n)re(e,h,s,i,o,!0);else if("MultiPolygon"===n)for(const t of e){const e=[];re(t,e,s,i,o,!0),e.length&&h.push(e);}if(h.length){if(a.lineMetrics&&"LineString"===n){for(const e of h)l.push(q(t.id,n,e,t.tags));continue}"LineString"!==n&&"MultiLineString"!==n||(1===h.length?(n="LineString",h=h[0]):n="MultiLineString"),"Point"!==n&&"MultiPoint"!==n||(n=3===h.length?"Point":"MultiPoint"),l.push(q(t.id,n,h,t.tags));}}return l.length?l:null}function ie(e,t,s,i,o){for(let n=0;n<e.length;n+=3){const r=e[n+o];r>=s&&r<=i&&ae(t,e[n],e[n+1],e[n+2]);}}function oe(e,t,s,i,o,n,r){let a=ne(e);const l=0===o?le:ce;let c,h,u=e.start;for(let d=0;d<e.length-3;d+=3){const f=e[d],p=e[d+1],g=e[d+2],m=e[d+3],y=e[d+4],w=0===o?f:p,b=0===o?m:y;let x=!1;r&&(c=Math.sqrt(Math.pow(f-m,2)+Math.pow(p-y,2))),w<s?b>s&&(h=l(a,f,p,m,y,s),r&&(a.start=u+c*h)):w>i?b<i&&(h=l(a,f,p,m,y,i),r&&(a.start=u+c*h)):ae(a,f,p,g),b<s&&w>=s&&(h=l(a,f,p,m,y,s),x=!0),b>i&&w<=i&&(h=l(a,f,p,m,y,i),x=!0),!n&&x&&(r&&(a.end=u+c*h),t.push(a),a=ne(e)),r&&(u+=c);}let d=e.length-3;const f=e[d],p=e[d+1],g=0===o?f:p;g>=s&&g<=i&&ae(a,f,p,e[d+2]),d=a.length-3,n&&d>=3&&(a[d]!==a[0]||a[d+1]!==a[1])&&ae(a,a[0],a[1],a[2]),a.length&&t.push(a);}function ne(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function re(e,t,s,i,o,n){for(const r of e)oe(r,t,s,i,o,n,!1);}function ae(e,t,s,i){e.push(t,s,i);}function le(e,t,s,i,o,n){const r=(n-t)/(i-t);return ae(e,n,s+(o-s)*r,1),r}function ce(e,t,s,i,o,n){const r=(n-s)/(o-s);return ae(e,t+(i-t)*r,n,1),r}function he(e,t){const s=[];for(let i=0;i<e.length;i++){const o=e[i],n=o.type;let r;if("Point"===n||"MultiPoint"===n||"LineString"===n)r=ue(o.geometry,t);else if("MultiLineString"===n||"Polygon"===n){r=[];for(const e of o.geometry)r.push(ue(e,t));}else if("MultiPolygon"===n){r=[];for(const e of o.geometry){const s=[];for(const i of e)s.push(ue(i,t));r.push(s);}}s.push(q(o.id,n,r,o.tags));}return s}function ue(e,t){const s=[];s.size=e.size,void 0!==e.start&&(s.start=e.start,s.end=e.end);for(let i=0;i<e.length;i+=3)s.push(e[i]+t,e[i+1],e[i+2]);return s}function de(e,t){if(e.transformed)return e;const s=1<<e.z,i=e.x,o=e.y;for(const n of e.features){const e=n.geometry,r=n.type;if(n.geometry=[],1===r)for(let r=0;r<e.length;r+=2)n.geometry.push(fe(e[r],e[r+1],t,s,i,o));else for(let r=0;r<e.length;r++){const a=[];for(let n=0;n<e[r].length;n+=2)a.push(fe(e[r][n],e[r][n+1],t,s,i,o));n.geometry.push(a);}}return e.transformed=!0,e}function fe(e,t,s,i,o,n){return [Math.round(s*(e*i-o)),Math.round(s*(t*i-n))]}function pe(e,t,s,i,o){const n=t===o.maxZoom?0:o.tolerance/((1<<t)*o.extent),r={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:s,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const t of e)ge(r,t,n,o);return r}function ge(e,t,s,i){const o=t.geometry,n=t.type,r=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===n||"MultiPoint"===n)for(let t=0;t<o.length;t+=3)r.push(o[t],o[t+1]),e.numPoints++,e.numSimplified++;else if("LineString"===n)me(r,o,e,s,!1,!1);else if("MultiLineString"===n||"Polygon"===n)for(let t=0;t<o.length;t++)me(r,o[t],e,s,"Polygon"===n,0===t);else if("MultiPolygon"===n)for(let t=0;t<o.length;t++){const i=o[t];for(let t=0;t<i.length;t++)me(r,i[t],e,s,!0,0===t);}if(r.length){let s=t.tags||null;if("LineString"===n&&i.lineMetrics){s={};for(const e in t.tags)s[e]=t.tags[e];s.mapbox_clip_start=o.start/o.size,s.mapbox_clip_end=o.end/o.size;}const a={geometry:r,type:"Polygon"===n||"MultiPolygon"===n?3:"LineString"===n||"MultiLineString"===n?2:1,tags:s};null!==t.id&&(a.id=t.id),e.features.push(a);}}function me(e,t,s,i,o,n){const r=i*i;if(i>0&&t.size<(o?r:i))return void(s.numPoints+=t.length/3);const a=[];for(let e=0;e<t.length;e+=3)(0===i||t[e+2]>r)&&(s.numSimplified++,a.push(t[e],t[e+1])),s.numPoints++;o&&function(e,t){let s=0;for(let t=0,i=e.length,o=i-2;t<i;o=t,t+=2)s+=(e[t]-e[o])*(e[t+1]+e[o+1]);if(s>0===t)for(let t=0,s=e.length;t<s/2;t+=2){const i=e[t],o=e[t+1];e[t]=e[s-2-t],e[t+1]=e[s-1-t],e[s-2-t]=i,e[s-1-t]=o;}}(a,n),e.push(a);}const ye={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class we{constructor(e,t){const s=(t=this.options=function(e,t){for(const s in t)e[s]=t[s];return e}(Object.create(ye),t)).debug;if(s&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let i=function(e,t){const s=[];if("FeatureCollection"===e.type)for(let i=0;i<e.features.length;i++)W(s,e.features[i],t,i);else W(s,"Feature"===e.type?e:{geometry:e},t);return s}(e,t);this.tiles={},this.tileCoords=[],s&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(e,t){const s=t.buffer/t.extent;let i=e;const o=se(e,1,-1-s,s,0,-1,2,t),n=se(e,1,1-s,2+s,0,-1,2,t);return (o||n)&&(i=se(e,1,-s,1+s,0,-1,2,t)||[],o&&(i=he(o,1).concat(i)),n&&(i=i.concat(he(n,-1)))),i}(i,t),i.length&&this.splitTile(i,0,0,0),s&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)));}splitTile(e,t,s,i,o,n,r){const a=[e,t,s,i],l=this.options,c=l.debug;for(;a.length;){i=a.pop(),s=a.pop(),t=a.pop(),e=a.pop();const h=1<<t,u=be(t,s,i);let d=this.tiles[u];if(!d&&(c>1&&console.time("creation"),d=this.tiles[u]=pe(e,t,s,i,l),this.tileCoords.push({z:t,x:s,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,s,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));const e=`z${t}`;this.stats[e]=(this.stats[e]||0)+1,this.total++;}if(d.source=e,null==o){if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue}else {if(t===l.maxZoom||t===o)continue;if(null!=o){const e=o-t;if(s!==n>>e||i!==r>>e)continue}}if(d.source=null,0===e.length)continue;c>1&&console.time("clipping");const f=.5*l.buffer/l.extent,p=.5-f,g=.5+f,m=1+f;let y=null,w=null,b=null,x=null,v=se(e,h,s-f,s+g,0,d.minX,d.maxX,l),I=se(e,h,s+p,s+m,0,d.minX,d.maxX,l);e=null,v&&(y=se(v,h,i-f,i+g,1,d.minY,d.maxY,l),w=se(v,h,i+p,i+m,1,d.minY,d.maxY,l),v=null),I&&(b=se(I,h,i-f,i+g,1,d.minY,d.maxY,l),x=se(I,h,i+p,i+m,1,d.minY,d.maxY,l),I=null),c>1&&console.timeEnd("clipping"),a.push(y||[],t+1,2*s,2*i),a.push(w||[],t+1,2*s,2*i+1),a.push(b||[],t+1,2*s+1,2*i),a.push(x||[],t+1,2*s+1,2*i+1);}}getTile(e,t,s){e=+e,t=+t,s=+s;const i=this.options,{extent:o,debug:n}=i;if(e<0||e>24)return null;const r=1<<e,a=be(e,t=t+r&r-1,s);if(this.tiles[a])return de(this.tiles[a],o);n>1&&console.log("drilling down to z%d-%d-%d",e,t,s);let l,c=e,h=t,u=s;for(;!l&&c>0;)c--,h>>=1,u>>=1,l=this.tiles[be(c,h,u)];return l&&l.source?(n>1&&(console.log("found parent tile z%d-%d-%d",c,h,u),console.time("drilling down")),this.splitTile(l.source,c,h,u,e,t,s),n>1&&console.timeEnd("drilling down"),this.tiles[a]?de(this.tiles[a],o):null):null}}function be(e,t,s){return 32*((1<<e)*s+t)+e}function xe(t,s){const i=t.tileID.canonical;if(!this._geoJSONIndex)return void s(null,null);const o=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!o)return void s(null,null);const n=e=>e.tags&&"3d_elevation_id"in e.tags&&"source"in e.tags&&"elevation"===e.tags.source,r=o.features.filter((e=>n(e)));let a={_geojsonTileLayer:o.features};r.length>0&&(a={_geojsonTileLayer:o.features.filter((e=>!n(e))),hd_road_elevation:r});const l=new m(a),c=function(t){const s=new e.bq;for(const e of Object.keys(t))s.writeMessage(3,k,{name:e,features:t[e]});return s.finish()}(a).buffer;s(null,{vectorTile:l,rawData:c});}class ve extends c{constructor(e,t,s,i,o,n,r){super(e,t,s,i,o,xe,r),n&&(this.loadGeoJSON=n),this._dynamicIndex=new b;}loadData(s,i){const o=s&&s.request,n=o&&o.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(s,((r,a)=>{if(r||!a)return i(r);if("object"!=typeof a)return i(new Error(`Input data given to '${s.source}' is not a valid GeoJSON object.`));{try{if(s.filter){const t=e.X(s.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));a.features=a.features.filter((e=>t.value.evaluate({zoom:0},e)));}s.dynamic?("Feature"===a.type&&(a={type:"FeatureCollection",features:[a]}),s.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(a.features,this.loaded),s.cluster&&(a.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=s.cluster?new R(function({superclusterOptions:t,clusterProperties:s}){if(!s||!t)return t;const i={},o={},n={accumulated:null,zoom:0},r={properties:null},a=Object.keys(s);for(const t of a){const[n,r]=s[t],a=e.X(r),l=e.X("string"==typeof n?[n,["accumulated"],["get",t]]:n);i[t]=a.value,o[t]=l.value;}return t.map=e=>{r.properties=e;const t={};for(const e of a)t[e]=i[e].evaluate(n,r);return t},t.reduce=(e,t)=>{r.properties=t;for(const t of a)n.accumulated=e[t],e[t]=o[t].evaluate(n,r);},t}(s)).load(a.features):s.dynamic?this._dynamicIndex:function(e,t){return new we(e,t)}(a,s.geojsonVtOptions);}catch(e){return i(e)}const r={};if(n){const e=t(o);e&&(r.resourceTiming={},r.resourceTiming[s.source]=JSON.parse(JSON.stringify(e)));}i(null,r);}}));}reloadTile(e,t){const s=this.loaded;return s&&s[e.uid]?e.partial?t(null,void 0):super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,s){if(t.request)e.n(t.request,s);else {if("string"!=typeof t.data)return s(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return s(null,JSON.parse(t.data))}catch(e){return s(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}),0);}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId));}catch(e){t(e);}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId));}catch(e){t(e);}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset));}catch(e){t(e);}}}class Ie{constructor(t,s,i){this.tileID=new e.aM(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=s,this.worldview=i;}parse(t,s,i,o){this.status="parsing";const n=new e.aM(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),r=[],a=s.familiesBySource[i.source],l=new e.fc(n,i.promoteId);l.bucketLayerIDs=[],l.is3DTile=!0,e.fr(t).then((t=>{if(!t)return o(new Error("Could not parse tile"));const s=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),h=new e.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const o in a)for(const u of a[o]){const o=u[0];l.bucketLayerIDs.push(u.map((t=>e.C(t.id,t.scope)))),o.recalculate(h,[]);const a=e.fs(t,1/e.d4(i.tileID.canonical)),d=new e.ft(u,a,n,s,c,this.brightness,l,this.worldview);s||(d.needsUpload=!0),r.push(d),d.evaluate(o);}this.status="done",o(null,{buckets:r,featureIndex:l,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null});})).catch((e=>o(new Error(e.message))));}}class Se{constructor(e,t,s,i,o,n,r,a){this.actor=e,this.layerIndex=t,this.availableImages=s,this.availableModels=i,this.brightness=r,this.loading={},this.loaded={},this.worldview=a;}loadTile(t,s){const i=t.uid,o=this.loading[i]=new Ie(t,this.brightness,this.worldview);e.br(t.request,((e,n)=>{const r=!this.loading[i];return delete this.loading[i],r||e?(o.status="done",r||(this.loaded[i]=o),s(e)):n&&0!==n.byteLength?void o.parse(n,this.layerIndex,t,((e,t)=>{o.status="done",this.loaded=this.loaded||{},this.loaded[i]=o,e||!t?s(e):s(null,t);})):(o.status="done",this.loaded[i]=o,s())}));}reloadTile(e,t){const s=this.loaded,i=e.uid;if(s&&s[i]){const o=s[i];o.projection=e.projection,o.brightness=e.brightness;const n=(s,i)=>{o.reloadCallback&&(delete o.reloadCallback,this.loadTile(e,t)),t(s,i);};"parsing"===o.status?o.reloadCallback=n:"done"===o.status&&this.loadTile(e,t);}}abortTile(e,t){const s=e.uid;this.loading[s]&&delete this.loading[s],t();}removeTile(e,t){const s=this.loaded,i=e.uid;s&&s[i]&&delete s[i],t();}}class Me{constructor(t){this.self=t,this.actor=new e.fv(t,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new e.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=e.cj({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:ve,"raster-dem":h,"raster-array":d,"batched-model":Se},this.workerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t;},this.self.registerRTLTextPlugin=t=>{if(e.fw.isParsed())throw new Error("RTL text plugin already registered.");e.fw.setState({pluginStatus:e.fx.parsed,pluginURL:e.fw.getPluginURL()}),e.fw.applyArabicShaping=t.applyArabicShaping,e.fw.processBidirectionalText=t.processBidirectionalText,e.fw.processStyledBidirectionalText=t.processStyledBidirectionalText;for(const e of this.rtlPluginParsingListeners)e(null,!0);this.rtlPluginParsingListeners=[];};}clearCaches(e,t,s){delete this.layerIndexes[e],delete this.availableImages[e],delete this.availableModels[e],delete this.workerSources[e],s();}checkIfReady(e,t,s){s();}setReferrer(e,t){this.referrer=t;}spriteLoaded(t,s){this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={});const{scope:i,isLoaded:o}=s;if(this.isSpriteLoaded[t][i]=o,this.workerSources[t]&&this.workerSources[t][i])for(const s in this.workerSources[t][i]){const n=this.workerSources[t][i][s];for(const t in n){const s=n[t];s instanceof c&&(s.isSpriteLoaded=o,s.fire(new e.A("isSpriteLoaded")));}}}setImages(e,t,s){this.availableImages[e]||(this.availableImages[e]={});const{scope:i,images:o}=t;if(this.availableImages[e][i]=o,this.workerSources[e]&&this.workerSources[e][i]){for(const t in this.workerSources[e][i]){const s=this.workerSources[e][i][t];for(const e in s)s[e].availableImages=o;}s();}else s();}setModels(e,{scope:t,models:s},i){if(this.availableModels[e]||(this.availableModels[e]={}),this.availableModels[e][t]=s,this.workerSources[e]&&this.workerSources[e][t]){for(const i in this.workerSources[e][t]){const o=this.workerSources[e][t][i];for(const e in o)o[e].availableModels=s;}i();}else i();}setProjection(t,s){this.projections[t]=e.cj(s);}setBrightness(e,t,s){this.brightness=t,s();}setWorldview(e,t,s){this.worldview=t,s();}setLayers(e,t,s){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),s();}updateLayers(e,t,s){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),s();}loadTile(e,t,s){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,s);}decodeRasterArray(e,t,s){this.getWorkerSource(e,t.type,t.source,t.scope).decodeRasterArray(t,s);}reloadTile(e,t,s){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,s);}abortTile(e,t,s){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,s);}removeTile(e,t,s){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,s);}removeSource(e,t,s){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const i=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,s):s();}loadWorkerSource(e,t,s){try{this.self.importScripts(t.url),s();}catch(e){s(e.toString());}}syncRTLPluginState(t,s,i){if(e.fw.isParsed())i(null,!0);else if(e.fw.isParsing())this.rtlPluginParsingListeners.push(i);else try{e.fw.setState(s);const t=e.fw.getPluginURL();!e.fw.isLoaded()||e.fw.isParsed()||e.fw.isParsing()||null==t||(e.fw.setState({pluginStatus:e.fx.parsing,pluginURL:e.fw.getPluginURL()}),this.self.importScripts(t),e.fw.isParsed()?i(null,!0):this.rtlPluginParsingListeners.push(i));}catch(e){i(e.toString());}}setDracoUrl(e,t){this.dracoUrl=t;}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let s=this.availableImages[e][t];return s||(s=[]),s}getAvailableModels(e,t){this.availableModels[e]||(this.availableModels[e]={});let s=this.availableModels[e][t];return s||(s={}),s}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let s=this.layerIndexes[e][t];return s||(s=this.layerIndexes[e][t]=new o,s.scope=t),s}getWorkerSource(e,t,s,i){const o=this.workerSources;return o[e]||(o[e]={}),o[e][i]||(o[e][i]={}),o[e][i][t]||(o[e][i][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),o[e][i][t][s]||(o[e][i][t][s]=new this.workerSourceTypes[t]({send:(t,s,i,o,n,r)=>this.actor.send(t,s,i,e,n,r),scheduler:this.actor.scheduler},this.getLayerIndex(e,i),this.getAvailableImages(e,i),this.getAvailableModels(e,i),this.isSpriteLoaded[e][i],void 0,this.brightness,this.worldview)),o[e][i][t][s]}rasterizeImagesWorker(e,t,s){const i=new Map;for(const[s,{image:o,imageVariant:n}]of t.tasks.entries()){const r=this.imageRasterizer.rasterize(n,o,t.scope,e);i.set(s,r);}s(void 0,i);}removeRasterizedImages(e,t,s){this.imageRasterizer.removeImagesFromCacheByIds(t.imageIds,t.scope,e),s();}enforceCacheSizeLimit(t,s){e.fy(s);}getWorkerPerformanceMetrics(e,t,s){s(void 0,void 0);}}return e.fu(self)&&(self.worker=new Me(self)),Me}));

define(["./shared"],(function(e){var t="3.14.0";const i={create:"create",load:"load",fullLoad:"fullLoad"},o={mark(e){performance.mark(e);},measure(e,t,i){performance.measure(e,t,i);}};function r(t){const i=t.name.split("?")[0];return e.a(i)&&i.includes("mapbox-gl.js")?"javascript":e.a(i)&&i.includes("mapbox-gl.css")?"css":e.b(i)?"fontRange":e.c(i)?"sprite":e.i(i)?"style":e.d(i)?"tilejson":"other"}var s,n={},a=function(){if(s)return n;function e(e){return !t(e)}function t(t){return "undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return !1;var e,t,i=new Blob([""],{type:"text/javascript"}),o=URL.createObjectURL(i);try{t=new Worker(o),e=!0;}catch(t){e=!1;}return t&&t.terminate(),URL.revokeObjectURL(o),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return !1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===i[o=t&&t.failIfMajorPerformanceCaveat]&&(i[o]=function(t){var i,o=function(t){var i=document.createElement("canvas"),o=Object.create(e.webGLContextAttributes);return o.failIfMajorPerformanceCaveat=t,i.getContext("webgl2",o)}(t);if(!o)return !1;try{i=o.createShader(o.VERTEX_SHADER);}catch(e){return !1}return !(!i||o.isContextLost())&&(o.shaderSource(i,"void main() {}"),o.compileShader(i),!0===o.getShaderParameter(i,o.COMPILE_STATUS))}(o)),i[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var o;}s=1,n.supported=e,n.notSupportedReason=t;var i={};return e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},n}();function l(e,t,i){const o=document.createElement(e);return null!=t&&(o.className=t),i&&i.appendChild(o),o}function c(e,t,i){const o=document.createElementNS("http://www.w3.org/2000/svg",e);for(const e of Object.keys(t))o.setAttributeNS(null,e,String(t[e]));return i&&i.appendChild(o),o}const h="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,d=h&&void 0!==h.userSelect?"userSelect":"WebkitUserSelect";let u;function _(){h&&d&&(u=h[d],h[d]="none");}function p(){h&&d&&(h[d]=u);}function f(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",f,!0);}function m(){window.addEventListener("click",f,!0),window.setTimeout((()=>{window.removeEventListener("click",f,!0);}),0);}function g(e,t){const i=e.getBoundingClientRect();return x(e,i,t)}function v(e,t){const i=e.getBoundingClientRect(),o=[];for(let r=0;r<t.length;r++)o.push(x(e,i,t[r]));return o}function y(e){return /firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===e.button&&e.ctrlKey?0:e.button}function x(t,i,o){const r=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.P((o.clientX-i.left)*r,(o.clientY-i.top)*r)}const b="01",w="NO_ACCESS_TOKEN";class T{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken();}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return {token:["1",b,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt;}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(i,o){if(!e.j(i))return i;const r=S(i);return r.params.push(`sdk=js-${t}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||o)}normalizeGlyphsURL(t,i){if(!e.j(t))return t;const o=S(t);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeModelURL(t,i){if(!e.j(t))return t;const o=S(t);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||i)}normalizeSourceURL(t,i,o,r){if(!e.j(t))return t;const s=S(t);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),o&&s.params.push(`language=${o}`),r&&s.params.push(`worldview=${r}`),this._makeAPIURL(s,this._customAccessToken||i)}normalizeIconsetURL(t,i){const o=S(t);return e.j(t)?(o.path=`/styles/v1${o.path}/iconset.pbf`,this._makeAPIURL(o,this._customAccessToken||i)):I(o)}normalizeSpriteURL(t,i,o,r){const s=S(t);return e.j(t)?(s.path=`/styles/v1${s.path}/sprite${i}${o}`,this._makeAPIURL(s,this._customAccessToken||r)):(s.path+=`${i}${o}`,I(s))}normalizeTileURL(t,i,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!e.j(t))return t;const r=S(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||o&&"raster"!==r.authority&&512===o?"@2x":""}${e.l.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${e.e.RASTER_URL_PREFIX}${r.path}`:"rasterarrays"===r.authority?r.path=`/${e.e.RASTERARRAYS_URL_PREFIX}${r.path}`:"3dtiles"===r.authority?r.path=`/${e.e.TILES3D_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${e.e.TILE_URL_VERSION}${r.path}`);const s=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(r.params)||e.e.ACCESS_TOKEN;return e.e.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,s)}canonicalizeTileURL(t,i){const o=S(t);if(!o.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!o.path.match(/\.[\w]+$/))return t;let r="mapbox://";o.path.match(/^\/raster\/v1\//)?r+=`raster/${o.path.replace(`/${e.e.RASTER_URL_PREFIX}/`,"")}`:o.path.match(/^\/rasterarrays\/v1\//)?r+=`rasterarrays/${o.path.replace(`/${e.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:r+=`tiles/${o.path.replace(`/${e.e.TILE_URL_VERSION}/`,"")}`;let s=o.params;return i&&(s=s.filter((e=>!e.match(/^access_token=/)))),s.length&&(r+=`?${s.join("&")}`),r}canonicalizeTileset(t,i){const o=!!i&&e.j(i),r=[];for(const i of t.tiles||[])e.k(i)?r.push(this.canonicalizeTileURL(i,o)):r.push(i);return r}_makeAPIURL(t,i){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=S(e.e.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1);}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!e.e.REQUIRE_ACCESS_TOKEN)return I(t);if(i=i||e.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return t.params=t.params.filter((e=>-1===e.indexOf("access_token"))),t.params.push(`access_token=${i||""}`),I(t)}}const E=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function S(e){const t=e.match(E);if(!t)throw new Error("Unable to parse URL object");return {protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function I(e){const t=e.params.length?`?${e.params.join("&")}`:"";return `${e.protocol}://${e.authority}${e.path}${t}`}const C="mapbox.eventData";function R(t){if(!t)return null;const i=t.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(e.m(i[1]))}catch(e){return null}}class A{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null;}getStorageKey(t){const i=R(e.e.ACCESS_TOKEN);let o="";return o=i&&i.u?e.f(i.u):e.e.ACCESS_TOKEN||"",t?`${C}.${t}:${o}`:`${C}:${o}`}fetchEventData(){const t=e.s("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(t)try{const e=localStorage.getItem(i);e&&(this.eventData=JSON.parse(e));const t=localStorage.getItem(o);t&&(this.anonId=t);}catch(t){e.w("Unable to read from LocalStorage");}}saveEventData(){const t=e.s("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid"),r=this.anonId;if(t&&r)try{localStorage.setItem(o,r),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData));}catch(t){e.w("Unable to write to LocalStorage");}}processRequests(e){}postEvent(t,i,o,r){if(!e.e.EVENTS_URL)return;const s=S(e.e.EVENTS_URL);s.params.push(`access_token=${r||e.e.ACCESS_TOKEN||""}`);const n={event:this.type,created:new Date(t).toISOString()},a=i?e.h(n,i):n,l={url:I(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=e.p(l,(e=>{this.pendingRequest=null,o(e),this.saveEventData(),this.processRequests(r);}));}queueRequest(e,t){this.queue.push(e),this.processRequests(t);}}const D=new class extends A{constructor(e){super("appUserTurnstile"),this._customAccessToken=e;}postTurnstileEvent(t,i){e.e.EVENTS_URL&&e.e.ACCESS_TOKEN&&Array.isArray(t)&&t.some((t=>e.j(t)||e.k(t)))&&this.queueRequest(Date.now(),i);}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=R(e.e.ACCESS_TOKEN),r=o?o.u:e.e.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;e.v(this.anonId)||(this.anonId=e.u(),s=!0);const n=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(n),i=(n-this.eventData.lastSuccess)/864e5;s=s||i>=1||i<-1||e.getDate()!==t.getDate();}else s=!0;s?this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:b,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=n,this.eventData.tokenU=r);}),i):this.processRequests();}},P=D.postTurnstileEvent.bind(D),L=new class extends A{constructor(){super("map.load"),this.success={},this.skuToken="";}postMapLoadEvent(t,i,o,r){this.skuToken=i,this.errorCb=r,e.e.EVENTS_URL&&(o||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},o):this.errorCb(new Error(w)));}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:r}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),e.v(this.anonId)||(this.anonId=e.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:b,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):o&&(this.success[o]=!0);}),i));}remove(){this.errorCb=null;}},z=L.postMapLoadEvent.bind(L),M=new class extends A{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap;}getMapInstanceId(t){let i=this.mapInstanceIdMap.get(t);return i||(i=e.u(),this.mapInstanceIdMap.set(t,i)),i}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(t,i){const{map:o,style:r,importedStyles:s}=i;if(!e.e.EVENTS_URL||!t&&!e.e.ACCESS_TOKEN)return;const n=this.getMapInstanceId(o),a={mapInstanceId:n,eventId:this.getEventId(n),style:r};s.length&&(a.importedStyles=s),this.queueRequest({timestamp:Date.now(),payload:a},t);}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:i}=this.queue.shift();this.postEvent(t,i,(()=>{}),e);}},O=M.postStyleLoadEvent.bind(M),F=new class extends A{constructor(){super("gljs.performance");}postPerformanceEvent(t,i){e.e.EVENTS_URL&&(t||e.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},t);}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:s,performanceData:n}=this.queue.shift(),a=function(o){const s=performance.getEntriesByType("resource"),n=performance.getEntriesByType("mark"),a=function(e){const t={};if(e)for(const i in e)if("other"!==i)for(const o of e[i]){const e=`${i}ResolveRangeMin`,r=`${i}ResolveRangeMax`,s=`${i}RequestCount`,n=`${i}RequestCachedCount`;t[e]=Math.min(t[e]||1/0,o.startTime),t[r]=Math.max(t[r]||-1/0,o.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e];};void 0!==o.transferSize&&0===o.transferSize&&a(n),a(s);}return t}(function(e,t){const i={};if(e)for(const o of e){const e=t(o);void 0===i[e]&&(i[e]=[]),i[e].push(o);}return i}(s,r)),l=window.devicePixelRatio,c=navigator.connection||navigator.mozConnection||navigator.webkitConnection,h=c?c.effectiveType:void 0,d={counters:[],metadata:[],attributes:[]},u=(e,t,i)=>{null!=i&&e.push({name:t,value:i.toString()});};for(const e in a)u(d.counters,e,a[e]);if(o.interactionRange[0]!==1/0&&o.interactionRange[1]!==-1/0&&(u(d.counters,"interactionRangeMin",o.interactionRange[0]),u(d.counters,"interactionRangeMax",o.interactionRange[1])),n)for(const e of Object.keys(i)){const t=i[e],o=n.find((e=>e.name===t));o&&u(d.counters,t,o.startTime);}return u(d.counters,"visibilityHidden",o.visibilityHidden),u(d.attributes,"style",function(t){if(t)for(const i of t){const t=i.name.split("?")[0];if(e.i(t)){const e=t.split("/").slice(-2);if(2===e.length)return `mapbox://styles/${e[0]}/${e[1]}`}}}(s)),u(d.attributes,"terrainEnabled",o.terrainEnabled?"true":"false"),u(d.attributes,"fogEnabled",o.fogEnabled?"true":"false"),u(d.attributes,"projection",o.projection),u(d.attributes,"zoom",o.zoom),u(d.metadata,"devicePixelRatio",l),u(d.metadata,"connectionEffectiveType",h),u(d.metadata,"navigatorUserAgent",navigator.userAgent),u(d.metadata,"screenWidth",window.screen.width),u(d.metadata,"screenHeight",window.screen.height),u(d.metadata,"windowWidth",window.innerWidth),u(d.metadata,"windowHeight",window.innerHeight),u(d.metadata,"mapWidth",o.width/l),u(d.metadata,"mapHeight",o.height/l),u(d.metadata,"webglRenderer",o.renderer),u(d.metadata,"webglVendor",o.vendor),u(d.metadata,"sdkVersion",t),u(d.metadata,"sdkIdentifier","mapbox-gl-js"),d}(n);for(const e of a.metadata);for(const e of a.counters);for(const e of a.attributes);this.postEvent(s,a,(()=>{}),o);}},B=F.postPerformanceEvent.bind(F),k=new class extends A{constructor(){super("map.auth"),this.success={},this.skuToken="";}getSession(t,i,o,r){if(!e.e.API_URL||!e.e.SESSION_PATH)return;const s=S(e.e.API_URL+e.e.SESSION_PATH);s.params.push(`sku=${i||""}`),s.params.push(`access_token=${r||e.e.ACCESS_TOKEN||""}`);const n={url:I(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=e.g(n,(e=>{this.pendingRequest=null,o(e),this.saveEventData(),this.processRequests(r);}));}getSessionAPI(t,i,o,r){this.skuToken=i,this.errorCb=r,e.e.SESSION_PATH&&e.e.API_URL&&(o||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},o):this.errorCb(new Error(w)));}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0);}),e);}remove(){this.errorCb=null;}},N=k.getSessionAPI.bind(k),U=new Set;function j(e,t){t?U.add(e):U.delete(e);}class G{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={};}isDirty(){return this._changed}setDirty(){this._changed=!0;}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty();}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e];}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty();}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty();}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id];}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty();}getUpdatedImages(e){return this._updatedImages[e]?Array.from(this._updatedImages[e].values()):[]}updateImage(t,i){this._updatedImages[i]=this._updatedImages[i]||new Set,this._updatedImages[i].add(e.I.toString(t)),this.setDirty();}resetUpdatedImages(e){this._updatedImages[e]&&this._updatedImages[e].clear();}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={};}}function V(e){const{userImage:t}=e;return !!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class q extends e.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,"raster"!==t&&e.t()&&(this.imageRasterizerDispatcher=new e.D(e.x(),this,"Image Rasterizer Worker",1));}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new e.r({width:1,height:1}));}removeScope(e){this.loaded.delete(e),this.imageProviders.delete(e),this.images.delete(e),this.updatedImages.delete(e),this.callbackDispatchedThisFrame.delete(e),this.patterns.delete(e),this.atlasImage.delete(e);const t=this.atlasTexture.get(e);t&&(t.destroy(),this.atlasTexture.delete(e));}addImageProvider(e,t){this.imageProviders.has(t)||this.imageProviders.set(t,new Map),this.imageProviders.get(t).set(e.id,e);}removeImageProvider(e,t){this.imageProviders.has(t)&&this.imageProviders.get(t).delete(e);}getPendingImageProviders(){const e=[];for(const t of this.imageProviders.values())for(const i of t.values())i.hasPendingRequests()&&e.push(i);return e}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new e.y),this._imageRasterizer}isLoaded(){for(const e of this.loaded.keys())if(!this.loaded.get(e))return !1;return !0}setLoaded(e,t){if(this.loaded.get(t)!==e&&(this.loaded.set(t,e),e)){for(const{ids:e,callback:i}of this.requestors)this._notify(e,t,i);this.requestors=[];}}hasImage(e,t){return !!this.getImage(e,t)}getImage(e,t){return this.images.get(t).get(e.toString())}addImage(e,t,i){this._validate(e,i)&&this.images.get(t).set(e.toString(),i);}_validate(t,i){let o=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),o=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),o=!1),this._validateContent(i.content,i)||(this.fire(new e.z(new Error(`Image "${t.name}" has invalid "content" value`))),o=!1),o}_validateStretch(e,t){if(!e)return !0;let i=0;for(const o of e){if(o[0]<i||o[1]<o[0]||t<o[1])return !1;i=o[1];}return !0}_validateContent(e,t){if(!e)return !0;if(4!==e.length)return !1;if(!t.usvg){if(e[0]<0||t.data.width<e[0])return !1;if(e[1]<0||t.data.height<e[1])return !1;if(e[2]<0||t.data.width<e[2])return !1;if(e[3]<0||t.data.height<e[3])return !1}return !(e[2]<e[0]||e[3]<e[1])}updateImage(e,t,i){const o=this.images.get(t).get(e.toString());i.version=o.version+1,this.images.get(t).set(e.toString(),i),this.updatedImages.get(t).add(e),this.removeFromImageRasterizerCache(e,t);}clearUpdatedImages(e){this.updatedImages.get(e).clear();}removeFromImageRasterizerCache(t,i){"raster"!==this.spriteFormat&&(e.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:i}):this.imageRasterizer.removeImagesFromCacheByIds([t],i));}removeImage(e,t){const i=this.images.get(t),o=i.get(e.toString());i.delete(e.toString()),this.patterns.get(t).delete(e.toString()),this.removeFromImageRasterizerCache(e,t),o.userImage&&o.userImage.onRemove&&o.userImage.onRemove();}listImages(t){return Array.from(this.images.get(t).keys()).map((t=>e.I.from(t)))}getImages(e,t,i){const o=[],r=[],s=this.imageProviders.get(t);for(const i of e){if(!i.iconsetId){o.push(i);continue}const e=s.get(i.iconsetId);e&&(this.getImage(i,t)?r.push(i):e.addPendingRequest(i));}if(0===o.length)return void this._notify(r,t,i);let n=!0;const a=!!this.loaded.get(t),l=this.images.get(t);if(!a)for(const e of o)l.has(e.toString())||(n=!1);a||n?this._notify(o,t,i):this.requestors.push({ids:o,scope:t,callback:i});}rasterizeImages(e,t){const i=new Map,{tasks:o,scope:r}=e;for(const[e,t]of o.entries()){const o=this.getImage(t.id,r);o&&i.set(e,{image:o,imageVariant:t});}this._rasterizeImages(r,i,t);}_rasterizeImages(t,i,o){if(e.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:i,scope:t},o);else {const e=new Map;for(const[o,{image:r,imageVariant:s}]of i.entries())e.set(o,this.imageRasterizer.rasterize(s,r,t,0));o(void 0,e);}}getUpdatedImages(e){return this.updatedImages.get(e)||new Set}_notify(t,i,o){const r=this.images.get(i),s=new Map;for(const i of t){if(!r.get(i.toString())){if(i.iconsetId)continue;this.fire(new e.A("styleimagemissing",{id:i.name}));}const t=r.get(i.toString());if(!t){e.w(`Image "${i.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const o={data:t.usvg?null:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,usvg:t.usvg,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)};t.usvg&&Object.assign(o,{width:t.icon.usvg_tree.width,height:t.icon.usvg_tree.height}),s.set(e.I.toString(i),o);}o(null,s);}getPixelSize(e){const{width:t,height:i}=this.atlasImage.get(e);return {width:t,height:i}}getPattern(t,i,o){const r=t.toString(),s=this.patterns.get(i),n=s.get(r),a=this.getImage(t,i);if(!a)return null;if(n){if(n.position.version===a.version)return n.position;n.position.version=a.version;}else {if(a.usvg&&!a.data){const s=this.getPatternInFlightId(r,i);if(this.patternsInFlight.has(s))return null;this.patternsInFlight.add(s);const n=new e.B(t).scaleSelf(e.q.devicePixelRatio),l=new Map([[n.toString(),{image:a,imageVariant:n}]]);return this._rasterizeImages(i,l,((e,t)=>this.storePatternImage(n,i,a,o,t))),null}this.storePattern(t,i,a);}return this._updatePatternAtlas(i,o),s.get(r).position}getPatternInFlightId(t,i){return e.C(t,i)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(e,t,i,o,r){const s=e.toString(),n=r?r.get(s):void 0;n&&(i.data=n,this.storePattern(e.id,t,i),this._updatePatternAtlas(t,o),this.patternsInFlight.delete(this.getPatternInFlightId(e.id.toString(),t)));}storePattern(t,i,o){const r={w:o.data.width+2*e.F,h:o.data.height+2*e.F,x:0,y:0},s=new e.G(r,o,e.F);this.patterns.get(i).set(t.toString(),{bin:r,position:s});}destroyAtlasTextures(){for(const e of this.atlasTexture.values())e&&e.destroy();this.atlasTexture.clear();}bind(t,i){const o=t.gl;let r=this.atlasTexture.get(i);r?this.dirty&&(r.update(this.atlasImage.get(i)),this.dirty=!1):(r=new e.T(t,this.atlasImage.get(i),o.RGBA8),this.atlasTexture.set(i,r)),r.bind(o.LINEAR,o.CLAMP_TO_EDGE);}_updatePatternAtlas(t,i){const o=this.patterns.get(t),r=Array.from(o.values()).map((({bin:e})=>e)),{w:s,h:n}=e.H(r),a=this.atlasImage.get(t);a.resize({width:s||1,height:n||1});const l=this.images.get(t);for(const[t,{bin:r,position:s}]of o.entries()){let o=s.padding;const n=r.x+o,c=r.y+o,h=l.get(t).data,d=h.width,u=h.height;o=o>1?o-1:o,e.r.copy(h,a,{x:0,y:0},{x:n,y:c},{width:d,height:u},i),e.r.copy(h,a,{x:0,y:u-o},{x:n,y:c-o},{width:d,height:o},i),e.r.copy(h,a,{x:0,y:0},{x:n,y:c+u},{width:d,height:o},i),e.r.copy(h,a,{x:d-o,y:0},{x:n-o,y:c},{width:o,height:u},i),e.r.copy(h,a,{x:0,y:0},{x:n+d,y:c},{width:o,height:u},i),e.r.copy(h,a,{x:d-o,y:u-o},{x:n-o,y:c-o},{width:o,height:o},i),e.r.copy(h,a,{x:0,y:u-o},{x:n+d,y:c-o},{width:o,height:o},i),e.r.copy(h,a,{x:0,y:0},{x:n+d,y:c+u},{width:o,height:o},i),e.r.copy(h,a,{x:d-o,y:0},{x:n-o,y:c+u},{width:o,height:o},i);}this.dirty=!0;}beginFrame(){for(const e of this.images.keys())this.callbackDispatchedThisFrame.set(e,new Set);}dispatchRenderCallbacks(e,t){const i=this.images.get(t);for(const o of e){if(this.callbackDispatchedThisFrame.get(t).has(o.toString()))continue;this.callbackDispatchedThisFrame.get(t).add(o.toString());const e=i.get(o.toString());V(e)&&this.updateImage(o,t,e);}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove();}}function H(t){const i=t.key,o=t.value,r=t.valueSpec||{},s=t.objectElementValidators||{},n=t.style,a=t.styleSpec;let l=[];const c=e.J(o);if("object"!==c)return [new e.V(i,o,`object expected, ${c} found`)];for(const t in o){const c=t.split(".")[0];let h;s[c]?h=s[c]:r[c]?h=_e:s["*"]?h=s["*"]:r["*"]&&(h=_e),h?l=l.concat(h({key:(i?`${i}.`:i)+t,value:o[t],valueSpec:r[c]||r["*"],style:n,styleSpec:a,object:o,objectKey:t},o)):l.push(new e.K(i,o[t],`unknown property "${t}"`));}for(const t in r)s[t]||r[t].required&&void 0===r[t].default&&void 0===o[t]&&l.push(new e.V(i,o,`missing required property "${t}"`));return l}function Z(t){const i=t.value,o=t.valueSpec,r=t.style,s=t.styleSpec,n=t.key,a=t.arrayElementValidator||_e;if("array"!==e.J(i))return [new e.V(n,i,`array expected, ${e.J(i)} found`)];if(o.length&&i.length!==o.length)return [new e.V(n,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return [new e.V(n,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let l={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};s.$version<7&&(l.function=o.function),"object"===e.J(o.value)&&(l=o.value);let c=[];for(let e=0;e<i.length;e++)c=c.concat(a({array:i,arrayIndex:e,value:i[e],valueSpec:l,style:r,styleSpec:s,key:`${n}[${e}]`},!0));return c}function W(t){const i=t.key,o=t.value,r=t.valueSpec;let s=e.J(o);if("number"===s&&o!=o&&(s="NaN"),"number"!==s)return [new e.V(i,o,`number expected, ${s} found`)];if("minimum"in r){let s=r.minimum;if("array"===e.J(r.minimum)&&(s=r.minimum[t.arrayIndex]),o<s)return [new e.V(i,o,`${o} is less than the minimum value ${s}`)]}if("maximum"in r){let s=r.maximum;if("array"===e.J(r.maximum)&&(s=r.maximum[t.arrayIndex]),o>s)return [new e.V(i,o,`${o} is greater than the maximum value ${s}`)]}return []}function $(t){const i=t.valueSpec,o=e.M(t.value.type);let r,s,n,a={};const l="categorical"!==o&&void 0===t.value.property,c=!l,h="array"===e.J(t.value.stops)&&"array"===e.J(t.value.stops[0])&&"object"===e.J(t.value.stops[0][0]),d=H({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return [new e.V(t.key,t.value,'identity function may not have a "stops" property')];let i=[];const r=t.value;return i=i.concat(Z({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:u})),"array"===e.J(r)&&0===r.length&&i.push(new e.V(t.key,r,"array must have at least one stop")),i},default:function(e){return _e({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return "identity"===o&&l&&d.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||d.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!e.N(t.valueSpec)&&d.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.O(t.valueSpec)?d.push(new e.V(t.key,t.value,"property functions not supported")):l&&!e.Q(t.valueSpec)&&d.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!h||void 0!==t.value.property||d.push(new e.V(t.key,t.value,'"property" property is required')),d;function u(t){let o=[];const r=t.value,l=t.key;if("array"!==e.J(r))return [new e.V(l,r,`array expected, ${e.J(r)} found`)];if(2!==r.length)return [new e.V(l,r,`array length 2 expected, length ${r.length} found`)];if(h){if("object"!==e.J(r[0]))return [new e.V(l,r,`object expected, ${e.J(r[0])} found`)];if(void 0===r[0].zoom)return [new e.V(l,r,"object stop key must have zoom")];if(void 0===r[0].value)return [new e.V(l,r,"object stop key must have value")];const i=e.M(r[0].zoom);if("number"!=typeof i)return [new e.V(l,r[0].zoom,"stop zoom values must be numbers")];if(n&&n>i)return [new e.V(l,r[0].zoom,"stop zoom values must appear in ascending order")];i!==n&&(n=i,s=void 0,a={}),o=o.concat(H({key:`${l}[0]`,value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:W,value:_}}));}else o=o.concat(_({key:`${l}[0]`,value:r[0],style:t.style,styleSpec:t.styleSpec},r));return e.S(e.U(r[1]))?o.concat([new e.V(`${l}[1]`,r[1],"expressions are not allowed in function stops.")]):o.concat(_e({key:`${l}[1]`,value:r[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function _(t,n){const l=e.J(t.value),c=e.M(t.value),h=null!==t.value?t.value:n;if(r){if(l!==r)return [new e.V(t.key,h,`${l} stop domain type must match previous stop domain type ${r}`)]}else r=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return [new e.V(t.key,h,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==o){let r=`number expected, ${l} found`;return e.O(i)&&void 0===o&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,h,r)]}return "categorical"!==o||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==o&&"number"===l&&"number"==typeof c&&"number"==typeof s&&void 0!==s&&c<s?[new e.V(t.key,h,"stop domain values must appear in ascending order")]:(s=c,"categorical"===o&&c in a?[new e.V(t.key,h,"stop domain values must be unique")]:(a[c]=!0,[])):[new e.V(t.key,h,`integer expected, found ${String(c)}`)]}}function X(t){const i=("property"===t.expressionContext?e.W:e.X)(e.U(t.value),t.valueSpec);if("error"===i.result)return i.value.map((i=>new e.V(`${t.key}${i.key}`,t.value,i.message)));const o=i.value.expression||i.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!o.outputDefined())return [new e.V(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.Y(o))return [new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Y(o,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.Z(o,["zoom","feature-state"]))return [new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e._(o))return [new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return []}function Y(t,i){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const e of i.valueSpec.expression.parameters)o.delete(e);if(0===o.size)return [];const r=[];return t instanceof e.$&&o.has(t.name)?[new e.V(i.key,i.value,`["${t.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(t.eachChild((e=>{r.push(...Y(e,i));})),r)}function K(t){const i=t.key,o=t.value,r=t.valueSpec,s=[];return Array.isArray(r.values)?-1===r.values.indexOf(e.M(o))&&s.push(new e.V(i,o,`expected one of [${r.values.join(", ")}], ${JSON.stringify(o)} found`)):-1===Object.keys(r.values).indexOf(e.M(o))&&s.push(new e.V(i,o,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(o)} found`)),s}function J(t){return e.a1(e.U(t.value))?X(e.L({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Q(t)}function Q(t){const i=t.value,o=t.key;if("array"!==e.J(i))return [new e.V(o,i,`array expected, ${e.J(i)} found`)];const r=t.styleSpec;let s,n=[];if(i.length<1)return [new e.V(o,i,"filter array must have at least 1 element")];switch(n=n.concat(K({key:`${o}[0]`,value:i[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.M(i[0])){case "<":case "<=":case ">":case ">=":i.length>=2&&"$type"===e.M(i[1])&&n.push(new e.V(o,i,`"$type" cannot be use with operator "${i[0]}"`));case "==":case "!=":3!==i.length&&n.push(new e.V(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case "in":case "!in":i.length>=2&&(s=e.J(i[1]),"string"!==s&&n.push(new e.V(`${o}[1]`,i[1],`string expected, ${s} found`)));for(let a=2;a<i.length;a++)s=e.J(i[a]),"$type"===e.M(i[1])?n=n.concat(K({key:`${o}[${a}]`,value:i[a],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==s&&"number"!==s&&"boolean"!==s&&n.push(new e.V(`${o}[${a}]`,i[a],`string, number, or boolean expected, ${s} found`));break;case "any":case "all":case "none":for(let e=1;e<i.length;e++)n=n.concat(Q({key:`${o}[${e}]`,value:i[e],style:t.style,styleSpec:t.styleSpec}));break;case "has":case "!has":s=e.J(i[1]),2!==i.length?n.push(new e.V(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==s&&n.push(new e.V(`${o}[1]`,i[1],`string expected, ${s} found`));}return n}function ee(t,i){const o=t.key,r=t.style,s=t.layer,n=t.styleSpec,a=t.value,l=t.objectKey,c=n[`${i}_${t.layerType}`];if(!c)return [];const h=l.match(/^(.*)-use-theme$/);if("paint"===i&&h&&c[h[1]])return e.S(a)?[].concat(_e({key:t.key,value:a,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:r,styleSpec:n,expressionContext:"property",propertyType:i,propertyKey:l})):_e({key:o,value:a,valueSpec:{type:"string"},style:r,styleSpec:n});const d=l.match(/^(.*)-transition$/);if("paint"===i&&d&&c[d[1]]&&c[d[1]].transition)return _e({key:o,value:a,valueSpec:n.transition,style:r,styleSpec:n});const u=t.valueSpec||c[l];if(!u)return [new e.K(o,a,`unknown property "${l}"`)];let _;if("string"===e.J(a)&&e.O(u)&&!u.tokens&&(_=/^{([^}]+)}$/.exec(a))){const t=`\`{ "type": "identity", "property": ${_?JSON.stringify(_[1]):'"_"'} }\``;return [new e.V(o,a,`"${l}" does not support interpolation syntax\nUse an identity property function instead: ${t}.`)]}const p=[];if("symbol"===t.layerType)"text-field"!==l||!r||r.glyphs||r.imports||p.push(new e.V(o,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.a2(e.U(a))&&"identity"===e.M(a.type)&&p.push(new e.V(o,a,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===i&&s&&s.layout&&s.layout.hasOwnProperty("model-id")&&e.O(u)&&(e.a3(u)||e.Q(u))){const t=e.W(e.U(a),u),i=t.value.expression||t.value._styleExpression.expression;i&&!e.Z(i,["measure-light"])&&("model-emissive-strength"===l&&e._(i)&&e.Y(i)||p.push(new e.V(o,a,`${l} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)));}return p.concat(_e({key:t.key,value:a,valueSpec:u,style:r,styleSpec:n,expressionContext:"property",propertyType:i,propertyKey:l}))}function te(e){return ee(e,"paint")}function ie(e){return ee(e,"layout")}function oe(t){let i=[];const o=t.value,r=t.key,s=t.style,n=t.styleSpec;o.type||o.ref||i.push(new e.V(r,o,'either "type" or "ref" is required'));let a=e.M(o.type);const l=e.M(o.ref);if(o.id){const n=e.M(o.id);for(let a=0;a<t.arrayIndex;a++){const t=s.layers[a];e.M(t.id)===n&&i.push(new e.V(r,o.id,`duplicate layer id "${o.id}", previously used at line ${t.id.__line__}`));}}if("ref"in o){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in o&&i.push(new e.V(r,o[t],`"${t}" is prohibited for ref layers`));})),s.layers.forEach((i=>{e.M(i.id)===l&&(t=i);})),t?t.ref?i.push(new e.V(r,o.ref,"ref cannot reference another ref layer")):a=e.M(t.type):"string"==typeof l&&i.push(new e.V(r,o.ref,`ref layer "${l}" not found`));}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(o.source){const t=s.sources&&s.sources[o.source],n=t&&e.M(t.type);t?"vector"===n&&"raster"===a?i.push(new e.V(r,o.source,`layer "${o.id}" requires a raster source`)):"raster"===n&&"raster"!==a?i.push(new e.V(r,o.source,`layer "${o.id}" requires a vector source`)):"vector"!==n||o["source-layer"]?"raster-dem"===n&&"hillshade"!==a?i.push(new e.V(r,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==n||["raster","raster-particle"].includes(a)?"line"===a&&o.paint&&(o.paint["line-gradient"]||o.paint["line-trim-offset"])&&"geojson"===n&&!t.lineMetrics?i.push(new e.V(r,o,`layer "${o.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):"raster-particle"===a&&"raster-array"!==n&&i.push(new e.V(r,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):i.push(new e.V(r,o.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new e.V(r,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new e.V(r,o.source,`source "${o.source}" not found`));}else i.push(new e.V(r,o,'missing required property "source"'));return i=i.concat(H({key:r,value:o,valueSpec:n.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>_e({key:`${r}.type`,value:o.type,valueSpec:n.layer.type,style:t.style,styleSpec:t.styleSpec,object:o,objectKey:"type"}),filter:t=>J(e.L({layerType:a},t)),layout:t=>H({layer:o,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>ie(e.L({layerType:a},t))}}),paint:t=>H({layer:o,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>te(e.L({layerType:a,layer:o},t))}})}})),i}function re(t){const i=t.value,o=t.key,r=e.J(i);return "string"!==r?[new e.V(o,i,`string expected, ${r} found`)]:[]}const se={promoteId:function t({key:i,value:o}){if("string"===e.J(o))return re({key:i,value:o});if(Array.isArray(o)){const t=[],r=e.U(o),s=e.X(r);return "error"===s.result&&s.value.forEach((o=>{t.push(new e.V(`${i}${o.key}`,null,`${o.message}`));})),e.Z(s.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||t.push(new e.V(`${i}`,null,"promoteId expression should be only feature dependent")),t}{const e=[];for(const r in o)e.push(...t({key:`${i}.${r}`,value:o[r]}));return e}}};function ne(t){const i=t.value,o=t.key,r=t.styleSpec,s=t.style;if(!i.type)return [new e.V(o,i,'"type" is required')];const n=e.M(i.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(n)&&(i.url||i.tiles||a.push(new e.K(o,i,'Either "url" or "tiles" is required.'))),n){case "vector":case "raster":case "raster-dem":case "raster-array":return a=a.concat(H({key:o,value:i,valueSpec:r[`source_${n.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:se})),a;case "geojson":if(a=H({key:o,value:i,valueSpec:r.source_geojson,style:s,styleSpec:r,objectElementValidators:se}),i.cluster)for(const e in i.clusterProperties){const[t,r]=i.clusterProperties[e],s="string"==typeof t?[t,["accumulated"],["get",e]]:t;a.push(...X({key:`${o}.${e}.map`,value:r,expressionContext:"cluster-map"})),a.push(...X({key:`${o}.${e}.reduce`,value:s,expressionContext:"cluster-reduce"}));}return a;case "video":return H({key:o,value:i,valueSpec:r.source_video,style:s,styleSpec:r});case "image":return H({key:o,value:i,valueSpec:r.source_image,style:s,styleSpec:r});case "canvas":return [new e.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return K({key:`${o}.type`,value:i.type,valueSpec:{values:ae(r)}})}}function ae(e){return e.source.reduce(((t,i)=>{const o=e[i];return "enum"===o.type.type&&(t=t.concat(Object.keys(o.type.values))),t}),[])}function le(t){const i=t.value,o=t.styleSpec,r=o.light,s=t.style;let n=[];const a=e.J(i);if(void 0===i)return n;if("object"!==a)return n=n.concat([new e.V("light",i,`object expected, ${a} found`)]),n;for(const t in i){const a=t.match(/^(.*)-transition$/),l=t.match(/^(.*)-use-theme$/);n=n.concat(l&&r[l[1]]?_e({key:t,value:i[t],valueSpec:{type:"string"},style:s,styleSpec:o}):a&&r[a[1]]&&r[a[1]].transition?_e({key:t,value:i[t],valueSpec:o.transition,style:s,styleSpec:o}):r[t]?_e({key:t,value:i[t],valueSpec:r[t],style:s,styleSpec:o}):[new e.V(t,i[t],`unknown property "${t}"`)]);}return n}function ce(t){const i=t.value;let o=[];if(!i)return o;const r=e.J(i);if("object"!==r)return o=o.concat([new e.V("light-3d",i,`object expected, ${r} found`)]),o;const s=t.styleSpec,n=s["light-3d"],a=t.key,l=t.style,c=t.style.lights;for(const t of ["type","id"])if(!(t in i))return o=o.concat([new e.V("light-3d",i,`missing property ${t} on light`)]),o;if(i.type&&c)for(let r=0;r<t.arrayIndex;r++){const t=e.M(i.type),s=c[r];e.M(s.type)===t&&o.push(new e.V(a,i.id,`duplicate light type "${i.type}", previously defined at line ${s.id.__line__}`));}const h=`properties_light_${i.type}`;if(!(h in s))return o=o.concat([new e.V("light-3d",i,`Invalid light type ${i.type}`)]),o;const d=s[h];for(const r in i)if("properties"===r){const n=i[r],a=e.J(n);if("object"!==a)return o=o.concat([new e.V("properties",n,`object expected, ${a} found`)]),o;for(const a in n){const c=a.match(/^(.*)-transition$/),h=a.match(/^(.*)-use-theme$/);o=o.concat(h&&d[h[1]]?_e({key:r,value:n[a],valueSpec:{type:"string"},style:l,styleSpec:s}):c&&d[c[1]]&&d[c[1]].transition?_e({key:r,value:i[r],valueSpec:s.transition,style:l,styleSpec:s}):d[a]?_e({key:a,value:n[a],valueSpec:d[a],style:l,styleSpec:s}):[new e.K(t.key,n[a],`unknown property "${a}"`)]);}}else o=o.concat(n[r]?_e({key:r,value:i[r],valueSpec:n[r],style:l,styleSpec:s}):[new e.K(r,i[r],`unknown property "${r}"`)]);return o}function he(t){const i=t.value,o=t.key,r=t.style,s=t.styleSpec,n=s.terrain;let a=[];const l=e.J(i);if(void 0===i)return a;if("null"===l)return a;if("object"!==l)return a=a.concat([new e.V("terrain",i,`object expected, ${l} found`)]),a;for(const t in i){const o=t.match(/^(.*)-transition$/),l=t.match(/^(.*)-use-theme$/);a=a.concat(l&&n[l[1]]?_e({key:t,value:i[t],valueSpec:{type:"string"},style:r,styleSpec:s}):o&&n[o[1]]&&n[o[1]].transition?_e({key:t,value:i[t],valueSpec:s.transition,style:r,styleSpec:s}):n[t]?_e({key:t,value:i[t],valueSpec:n[t],style:r,styleSpec:s}):[new e.K(t,i[t],`unknown property "${t}"`)]);}if(i.source){const t=r.sources&&r.sources[i.source],s=t&&e.M(t.type);t?"raster-dem"!==s&&a.push(new e.V(o,i.source,`terrain cannot be used with a source of type ${String(s)}, it only be used with a "raster-dem" source type`)):a.push(new e.V(o,i.source,`source "${i.source}" not found`));}else a.push(new e.V(o,i,'terrain is missing required property "source"'));return a}function de(t){const i=t.value,o=t.style,r=t.styleSpec,s=r.fog;let n=[];const a=e.J(i);if(void 0===i)return n;if("object"!==a)return n=n.concat([new e.V("fog",i,`object expected, ${a} found`)]),n;for(const t in i){const a=t.match(/^(.*)-transition$/),l=t.match(/^(.*)-use-theme$/);n=n.concat(l&&s[l[1]]?_e({key:t,value:i[t],valueSpec:{type:"string"},style:o,styleSpec:r}):a&&s[a[1]]&&s[a[1]].transition?_e({key:t,value:i[t],valueSpec:r.transition,style:o,styleSpec:r}):s[t]?_e({key:t,value:i[t],valueSpec:s[t],style:o,styleSpec:r}):[new e.K(t,i[t],`unknown property "${t}"`)]);}return n}const ue={"*":()=>[],array:Z,boolean:function(t){const i=t.value,o=t.key,r=e.J(i);return "boolean"!==r?[new e.V(o,i,`boolean expected, ${r} found`)]:[]},number:W,color:function(t){const i=t.key,o=t.value,r=e.J(o);return "string"!==r?[new e.V(i,o,`color expected, ${r} found`)]:null===e.a0.parseCSSColor(o)?[new e.V(i,o,`color expected, "${o}" found`)]:[]},enum:K,filter:J,function:$,layer:oe,object:H,source:ne,model:e.a4,light:le,"light-3d":ce,terrain:he,fog:de,string:re,formatted:function(e){return 0===re(e).length?[]:X(e)},resolvedImage:function(e){return 0===re(e).length?[]:X(e)},projection:function(t){const i=t.value,o=t.styleSpec,r=o.projection,s=t.style;let n=[];const a=e.J(i);if("object"===a)for(const e in i)n=n.concat(_e({key:e,value:i[e],valueSpec:r[e],style:s,styleSpec:o}));else "string"!==a&&(n=n.concat([new e.V("projection",i,`object or string expected, ${a} found`)]));return n},import:function(t){const{value:i,styleSpec:o}=t,{data:r,...s}=i;Object.defineProperty(s,"__line__",{value:i.__line__,enumerable:!1});let n=H(e.L({},t,{value:s,valueSpec:o.import}));return ""===e.M(s.id)&&n.push(new e.V(`${t.key}.id`,s,"import id can't be an empty string")),r&&(n=n.concat(fe(r,o,{key:`${t.key}.data`}))),n},iconset:function(t){const i=t.value,o=t.key,r=t.styleSpec,s=t.style;if(!i.type)return [new e.V(o,i,'"type" is required')];const n=e.M(i.type);let a=[];if(a=a.concat(H({key:o,value:i,valueSpec:r[`iconset_${n}`],style:s,styleSpec:r})),"source"===n&&i.source){const t=s.sources&&s.sources[i.source],r=t&&e.M(t.type);t?"raster-array"!==r&&a.push(new e.V(o,i.source,`iconset cannot be used with a source of type ${String(r)}, it only be used with a "raster-array" source type`)):a.push(new e.V(o,i.source,`source "${i.source}" not found`));}return a}};function _e(t,i=!1){const o=t.value,r=t.valueSpec,s=t.styleSpec;if(r.expression&&e.a2(e.M(o)))return $(t);if(r.expression&&e.S(e.U(o)))return X(t);if(r.type&&ue[r.type]){const o=ue[r.type](t);return !0===i&&o.length>0&&"array"===e.J(t.value)?X(t):o}return H(e.L({},t,{valueSpec:r.type?s[r.type]:r}))}function pe(t){const i=t.value,o=t.key,r=re(t);return r.length||(-1===i.indexOf("{fontstack}")&&r.push(new e.V(o,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&r.push(new e.V(o,i,'"glyphs" url must include a "{range}" token'))),r}function fe(t,i=e.a5,o={}){return _e({key:o.key||"",value:t,valueSpec:i.$root,styleSpec:i,style:t,objectElementValidators:{glyphs:pe,"*":()=>[]}})}function me(t,i=e.a5){return Ae(fe(t,i))}const ge=e=>Ae(ne(e)),ve=e=>Ae(le(e)),ye=e=>Ae(ce(e)),xe=e=>Ae(he(e)),be=e=>Ae(de(e)),we=t=>Ae(function(t){const i=t.value,o=t.style,r=t.styleSpec,s=r.snow;let n=[];const a=e.J(i);if(void 0===i)return n;if("object"!==a)return n=n.concat([new e.V("snow",i,`object expected, ${a} found`)]),n;for(const t in i){const a=t.match(/^(.*)-transition$/);n=n.concat(a&&s[a[1]]&&s[a[1]].transition?_e({key:t,value:i[t],valueSpec:r.transition,style:o,styleSpec:r}):s[t]?_e({key:t,value:i[t],valueSpec:s[t],style:o,styleSpec:r}):[new e.K(t,i[t],`unknown property "${t}"`)]);}return n}(t)),Te=t=>Ae(function(t){const i=t.value,o=t.style,r=t.styleSpec,s=r.rain;let n=[];const a=e.J(i);if(void 0===i)return n;if("object"!==a)return n=n.concat([new e.V("rain",i,`object expected, ${a} found`)]),n;for(const t in i){const a=t.match(/^(.*)-transition$/);n=n.concat(a&&s[a[1]]&&s[a[1]].transition?_e({key:t,value:i[t],valueSpec:r.transition,style:o,styleSpec:r}):s[t]?_e({key:t,value:i[t],valueSpec:s[t],style:o,styleSpec:r}):[new e.K(t,i[t],`unknown property "${t}"`)]);}return n}(t)),Ee=e=>Ae(oe(e)),Se=e=>Ae(J(e)),Ie=e=>Ae(te(e)),Ce=e=>Ae(ie(e)),Re=t=>Ae(e.a4(t));function Ae(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function De(t,i){let o=!1;if(i&&i.length)for(const r of i)r instanceof e.K?e.w(r.message):(t.fire(new e.z(new Error(r.message))),o=!0);return o}let Pe;class Le extends e.E{constructor(t,i="flat"){super(),this._transitionable=new e.a6(Pe||(Pe=new e.a7({anchor:new e.a8(e.a5.light.anchor),position:new e.a9(e.a5.light.position),color:new e.a8(e.a5.light.color),intensity:new e.a8(e.a5.light.intensity)}))),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned();}getLight(){return this._transitionable.serialize()}setLight(e,t,i={}){this._validate(ve,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=t);}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning);}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e);}_validate(t,i,o){return (!o||!1!==o.validate)&&De(this,t.call(me,e.h({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let ze=class extends e.E{constructor(t,i,o,r,s){super(),this.scope=o,this._transitionable=new e.a6(new e.a7({source:new e.a8(e.a5.terrain.source),exaggeration:new e.a8(e.a5.terrain.exaggeration)}),o,r),this._transitionable.setTransitionOrValue(t,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i,this.worldview=s;}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t);}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning);}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e);}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.aa(t,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const t=this._transitionable._values.exaggeration;if(!t)return null;const i=t.value.expression;if(!i)return null;let o=-1,r=-1,s=1;for(const t of i.zoomStops)s=i.evaluate(new e.aa(t,{worldview:this.worldview})),s>.01?(o=t,r=-1):r=t;return s<.01&&o>0&&r>o?[o,r]:null}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.ab}};const Me=45,Oe=65,Fe=.05;function Be(t,i,o,r){const s=e.af(Me,Oe,o),[n,a]=ke(t,r);let l=1-Math.min(1,Math.exp((i-n)/(a-n)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*s*t.alpha}function ke(e,t){const i=.5/Math.tan(.5*t);return [e.range[0]+i,e.range[1]+i]}function Ne(t,i,o,r,s){const n=e.ad([],[i,o,r],s.mercatorFogMatrix);return Be(t,e.ae(n),s.pitch,s._fov)}function Ue(t,i,o,r,s,n,a){const l=[[o,r,0],[s,r,0],[s,n,0],[o,n,0]];let c=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(const t of l){const o=e.ad([],t,i),r=e.ae(o);c=Math.min(c,r),h=Math.max(h,r);}return [Be(t,c,a.pitch,a._fov),Be(t,h,a.pitch,a._fov)]}class je extends e.E{constructor(t,i,o,r){super();const s=new e.a7({range:new e.a8(e.a5.fog.range),color:new e.a8(e.a5.fog.color),"color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new e.a8(e.a5.fog["high-color"]),"high-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new e.a8(e.a5.fog["space-color"]),"space-color-use-theme":new e.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new e.a8(e.a5.fog["horizon-blend"]),"star-intensity":new e.a8(e.a5.fog["star-intensity"]),"vertical-range":new e.a8(e.a5.fog["vertical-range"])});this._transitionable=new e.a6(s,o,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new e.ag(s),this.scope=o;}get state(){const t=this._transform,i="globe"===t.projection.name,o=e.ah(t.zoom),r=this.properties.get("range"),s=[.5,3];return {range:i?[e.ai(s[0],r[0],o),e.ai(s[1],r[1],o)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i,o={}){if(this._validate(be,t,o))return;const r=e.h({},t);for(const t of Object.keys(e.a5.fog))void 0===r[t]&&(r[t]=e.a5.fog[t].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,i);}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return ("globe"===this._transform.projection.name?1:e.af(Me,Oe,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,o){const r=e.ac.fromLngLat(i),s=o.elevation?o.elevation.getAtPointOrZero(r):0;return Ne(t,r.x,r.y,s,o)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return [1,1];const i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ue(this.state,i,0,0,e.aj,e.aj,this._transform)}getOpacityForBounds(e,t,i,o,r){return this._transform.projection.supportsFog?Ue(this.state,e,t,i,o,r,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?ke(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return !1;const i=[4,5,6,7];for(const o of i){const i=t.points[o];let r;if(i[2]>=0)r=i;else {const s=t.points[o-4];r=e.ak(s,i,s[2]/(s[2]-i[2]));}if(Ne(this.state,r[0],r[1],0,this._transform)>=Fe)return !0}return !1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e));}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning);}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e);}_validate(t,i,o){return (!o||!1!==o.validate)&&De(this,t.call(me,e.h({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}}let Ge,Ve,qe,He,Ze=class extends e.E{constructor(t,i,o,r){super();const s=Ge||(Ge=new e.a7({density:new e.a8(e.a5.snow.density),intensity:new e.a8(e.a5.snow.intensity),color:new e.a8(e.a5.snow.color),opacity:new e.a8(e.a5.snow.opacity),vignette:new e.a8(e.a5.snow.vignette),"vignette-color":new e.a8(e.a5.snow["vignette-color"]),"center-thinning":new e.a8(e.a5.snow["center-thinning"]),direction:new e.a8(e.a5.snow.direction),"flake-size":new e.a8(e.a5.snow["flake-size"])}));this._transitionable=new e.a6(s,o,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(s),this.scope=o;}get state(){const t=this.properties.get("opacity"),i=this.properties.get("color"),o=this.properties.get("direction"),r=e.al(o[0]),s=-Math.max(e.al(o[1]),.01),n=[Math.cos(r)*Math.cos(s),Math.sin(r)*Math.cos(s),Math.sin(s)],a=this.properties.get("vignette"),l=this.properties.get("vignette-color");return l.a=a,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(i.r,i.g,i.b,i.a*t),direction:n,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:l}}get(){return this._transitionable.serialize()}set(t,i,o={}){if(this._validate(we,t,o))return;const r=e.h({},t);for(const t of Object.keys(e.a5.snow))void 0===r[t]&&(r[t]=e.a5.snow[t].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,i);}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e));}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning);}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e);}_validate(t,i,o){return (!o||!1!==o.validate)&&De(this,t.call(me,e.h({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}},We=class extends e.E{constructor(t,i,o,r){super();const s=Ve||(Ve=new e.a7({density:new e.a8(e.a5.rain.density),intensity:new e.a8(e.a5.rain.intensity),color:new e.a8(e.a5.rain.color),opacity:new e.a8(e.a5.rain.opacity),vignette:new e.a8(e.a5.rain.vignette),"vignette-color":new e.a8(e.a5.rain["vignette-color"]),"center-thinning":new e.a8(e.a5.rain["center-thinning"]),direction:new e.a8(e.a5.rain.direction),"droplet-size":new e.a8(e.a5.rain["droplet-size"]),"distortion-strength":new e.a8(e.a5.rain["distortion-strength"])}));this._transitionable=new e.a6(s,o,new Map(r)),this.set(t,r),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ag(s),this.scope=o;}get state(){const t=this.properties.get("opacity"),i=this.properties.get("color"),o=this.properties.get("direction"),r=e.al(o[0]),s=-Math.max(e.al(o[1]),.01),n=[Math.cos(r)*Math.cos(s),Math.sin(r)*Math.cos(s),Math.sin(s)],a=this.properties.get("vignette-color");return a.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.am(i.r,i.g,i.b,i.a*t),direction:n,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:a}}get(){return this._transitionable.serialize()}set(t,i,o={}){if(this._validate(Te,t,o))return;const r=e.h({},t);for(const t of Object.keys(e.a5.rain))void 0===r[t]&&(r[t]=e.a5.rain[t].default);this._options=r,this._transitionable.setTransitionOrValue(this._options,i);}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e));}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning);}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e);}_validate(t,i,o){return (!o||!1!==o.validate)&&De(this,t.call(me,e.h({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.a5})))}};class $e extends e.E{constructor(t,i,o,r){super(),this.scope=o,this._options=t,this.properties=new e.ag(i),this._transitionable=new e.a6(i,o,new Map(r)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned();}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e));}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning);}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e);}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t);}shadowsEnabled(){return !!this.properties&&!0===this.properties.get("cast-shadows")}}class Xe{constructor(e,t,i){this.screenBounds=e,this.cameraPoint=i.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=t,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,i);}static createFromScreenPoints(t,i){let o,r;if(t instanceof e.P||"number"==typeof t[0]){const s=e.P.convert(t);o=[s],r=i.isPointAboveHorizon(s);}else {const s=e.P.convert(t[0]),n=e.P.convert(t[1]),a=s.add(n)._div(2);o=[s,n],r=e.ao(s,n).every((e=>i.isPointAboveHorizon(e)))&&i.isPointAboveHorizon(a);}return new Xe(o,r,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.ao(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],o=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.ao(i,o,0,!1);return this.cameraPoint.y>o.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<o.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=o.x?r[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(r[3]=this.cameraPoint)),e.ap(r,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],o=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],r=e.ao(i,o,t),s=this.cameraPoint.clone();switch(3*((s.y>i.y)+(s.y>o.y))+((s.x>i.x)+(s.x>o.x))){case 0:r[0]=s,r[4]=s.clone();break;case 1:r.splice(1,0,s);break;case 2:r[1]=s;break;case 3:r.splice(4,0,s);break;case 5:r.splice(2,0,s);break;case 6:r[3]=s;break;case 7:r.splice(3,0,s);break;case 8:r[2]=s;}return r}containsTile(t,i,o,r=0){const s=t.queryPadding/i._pixelsPerMercatorPixel+1,n=o?this._bufferedCameraMercator(s,i):this._bufferedScreenMercator(s,i);let a=t.tileID.wrap+(n.unwrapped?r:0);const l=n.polygon.map((i=>e.aq(t.tileTransform,i,a)));if(!e.ar(l,0,0,e.aj,e.aj))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);const c=this.screenGeometryMercator.polygon.map((i=>e.as(t.tileTransform,i,a))),h=c.map((t=>new e.P(t[0],t[1]))),d=i.getFreeCameraOptions().position||new e.ac(0,0,0),u=e.as(t.tileTransform,d,a),_=c.map((t=>{const i=e.at(t,t,u);return e.au(i,i),new e.av(u,i)})),p=e.aw(t,1,i.zoom)*i._pixelsPerMercatorPixel;return {queryGeometry:this,tilespaceGeometry:h,tilespaceRays:_,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(f=e.ax(l),f.min.x=e.ay(f.min.x,0,e.aj),f.min.y=e.ay(f.min.y,0,e.aj),f.max.x=e.ay(f.max.x,0,e.aj),f.max.y=e.ay(f.max.y,0,e.aj),f),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:p};var f;}_bufferedScreenMercator(e,t){const i=Je(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let o;return o="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=o,o}}_bufferedCameraMercator(e,t){const i=Je(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let o;return o="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=o,o}}_projectAndResample(t,i){const o=function(t,i){const o=e.az([],i.pixelMatrix,i.globeMatrix),r=[0,-e.aB,0,1],s=[0,e.aB,0,1],n=[0,0,0,1];e.aA(r,r,o),e.aA(s,s,o),e.aA(n,n,o);const a=new e.P(r[0]/r[3],r[1]/r[3]),l=new e.P(s[0]/s[3],s[1]/s[3]),c=e.aC(t,a)&&r[3]<n[3],h=e.aC(t,l)&&s[3]<n[3];if(!c&&!h)return null;const d=function(e,t,i){for(let o=1;o<e.length;o++){const r=Ke(t.pointCoordinate3D(e[o-1]).x),s=Ke(t.pointCoordinate3D(e[o]).x);if(i<0){if(r<s)return {idx:o,t:-r/(s-1-r)}}else if(s<r)return {idx:o,t:(1-r)/(s+1-r)}}return null}(t,i,c?-1:1);if(!d)return null;const{idx:u,t:_}=d;let p=u>1?Ye(t.slice(0,u),i):[],f=u<t.length?Ye(t.slice(u),i):[];p=p.map((t=>new e.P(Ke(t.x),t.y))),f=f.map((t=>new e.P(Ke(t.x),t.y)));const m=[...p];0===m.length&&m.push(f[f.length-1]);const g=e.ai(m[m.length-1].y,(0===f.length?p[0]:f[0]).y,_);let v;return v=c?[new e.P(0,g),new e.P(0,0),new e.P(1,0),new e.P(1,g)]:[new e.P(1,g),new e.P(1,1),new e.P(0,1),new e.P(0,g)],m.push(...v),0===f.length?m.push(p[0]):m.push(...f),{polygon:m.map((t=>new e.ac(t.x,t.y))),unwrapped:!1}}(t,i);if(o)return o;const r=function(t,i){let o=!1,r=-1/0,s=0;for(let e=0;e<t.length-1;e++)t[e].x>r&&(r=t[e].x,s=e);for(let e=0;e<t.length-1;e++){const i=(s+e)%(t.length-1),r=t[i],n=t[i+1];Math.abs(r.x-n.x)>.5&&(r.x<n.x?(r.x+=1,0===i&&(t[t.length-1].x+=1)):(n.x+=1,i+1===t.length-1&&(t[0].x+=1)),o=!0);}const n=e.aD(i.center.lng);return o&&n<Math.abs(n-1)&&t.forEach((e=>{e.x-=1;})),{polygon:t,unwrapped:o}}(Ye(t,i).map((t=>new e.P(Ke(t.x),t.y))),i);return {polygon:r.polygon.map((t=>new e.ac(t.x,t.y))),unwrapped:r.unwrapped}}}function Ye(t,i){return e.aE(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y;}),1/256)}function Ke(e){return e<0?1+e%1:e%1}function Je(e){return 100*e|0}function Qe(t,i,o,r,s){const n=function(o,r){if(o)return s(o);if(r){if(t.url&&r.tiles&&t.tiles&&delete t.tiles,r.variants){if(!Array.isArray(r.variants))return s(new Error("variants must be an array"));for(const t of r.variants){if(null==t||"object"!=typeof t||t.constructor!==Object)return s(new Error("variant must be an object"));if(!Array.isArray(t.capabilities))return s(new Error("capabilities must be an array"));if(1===t.capabilities.length&&"meshopt"===t.capabilities[0]){r=e.h(r,t);break}}}const o=e.aF(e.h({},r,t),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);o.tiles=i.canonicalizeTileset(o,t.url),s(null,o);}},a=function(e,t,i){if(!e)return null;if(!t&&!i)return e;i=i||e.worldview_default;const o=Object.values(e.language||{});if(0===o.length)return null;const r=Object.values(e.worldview||{});if(0===r.length)return null;const s=o.every((e=>e===t)),n=r.every((e=>e===i));return s&&n?e:t in(e.language_options||{})||i in(e.worldview_options||{})?null:e.language_options&&e.worldview_options?e:null}(t.data,o,r);return a?e.q.frame((()=>n(null,a))):t.url?e.n(i.transformRequest(i.normalizeSourceURL(t.url,null,o,r),e.R.Source),n):e.q.frame((()=>{const{data:e,...i}=t;n(null,i);}))}function et(t,i){const o=Math.pow(2,i.z),r=Math.floor(e.aD(t.getWest())*o),s=Math.floor(e.aH(t.getNorth())*o),n=Math.ceil(e.aD(t.getEast())*o),a=Math.ceil(e.aH(t.getSouth())*o);return i.x>=r&&i.x<n&&i.y>=s&&i.y<a}class tt{constructor(t,i,o){this.bounds=t?e.aG.convert(this.validateBounds(t)):null,this.minzoom=i||0,this.maxzoom=o||24;}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const i of t)this.extraBounds.push(e.aG.convert(this.validateBounds(i)));}}contains(e){if(e.z>this.maxzoom||e.z<this.minzoom)return !1;if(this.bounds&&!et(this.bounds,e))return !1;if(!this.extraBounds)return !0;for(const t of this.extraBounds)if(et(t,e))return !0;return !1}static fromTileJSON(e){if(!e.bounds&&!e.extra_bounds)return null;const t=new tt(e.bounds,e.minzoom,e.maxzoom);return t.addExtraBounds(e.extra_bounds),t}}class it extends e.E{constructor(t,i,o,r){if(super(),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.h(this,e.aF(i,["url","scheme","tileSize","promoteId"])),this._options=e.h({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new e.aI;}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Qe(this._options,this.map._requestManager,i,o,((r,s)=>{if(this._tileJSONRequest=null,this._loaded=!0,r)i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),o&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new e.z(r));else if(s){if(e.h(this,s),this.hasWorldviews=!!s.worldview_options,s.worldview_default&&(this.worldviewDefault=s.worldview_default),s.vector_layers){this.vectorLayers=s.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const e of s.vector_layers)this.vectorLayerIds.push(e.id),s.worldview&&s.worldview[e.source]&&this.localizableLayerIds.add(e.id);}this.tileBounds=tt.fromTileJSON(s),P(s.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}));}t&&t(r);}));}loaded(){return this._loaded}hasTile(e){return !this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load();}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)));}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest();}serialize(){return e.h({},this._options)}loadTile(t,i){const o=t.tileID.canonical.url(this.tiles,this.scheme),r=this.map._requestManager.normalizeTileURL(o),s=this.map._requestManager.transformRequest(r,e.R.Tile),n=this.map.style?this.map.style.getLut(this.scope):null,a=n?{image:n.image.clone()}:null,l={request:s,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:a,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&e.j(o)&&(l.localizableLayerIds=this.localizableLayerIds),l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",l,c.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",l,c.bind(this),void 0,!0);else {const i=e.aJ.call({deduped:this._deduped},l,((e,i)=>{e||!i?c.call(this,e):(l.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",l,c.bind(this),void 0,!0));}),!0);t.request={cancel:i};}function c(o,r){return delete t.request,t.aborted?i(null):o&&404!==o.status?i(o):(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&r&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),e.aK(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope});}unloadTile(e,t){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy();}hasTransition(){return !1}afterUpdate(){this._tileWorkers={};}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}}class ot extends e.E{constructor(t,i,o,r){super(),this.id=t,this.dispatcher=o,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.h({type:"raster"},i),e.h(this,e.aF(i,["url","scheme","tileSize"]));}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const i=this.map.getWorldview();this._tileJSONRequest=Qe(this._options,this.map._requestManager,null,i,((i,o)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new e.z(i)):o&&(e.h(this,o),o.raster_layers&&(this.rasterLayers=o.raster_layers,this.rasterLayerIds=this.rasterLayers.map((e=>e.id))),this.tileBounds=tt.fromTileJSON(o),P(o.tiles),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i);}));}loaded(){return this._loaded}onAdd(e){this.map=e,this.load();}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)));}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest();}serialize(){return e.h({},this._options)}hasTile(e){return !this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const o=e.q.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),o,this.tileSize);t.request=e.o(this.map._requestManager.transformRequest(r,e.R.Tile),((o,r,s,n)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):o?(t.state="errored",i(o)):r?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:s,expires:n}),t.setTexture(r,this.map.painter),t.state="loaded",e.aK(this.dispatcher),void i(null)):i(null))));}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t&&t();}unloadTile(t,i){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i&&i();}hasTransition(){return !1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}}class rt extends ot{constructor(t,i,o,r){super(t,i,o,r),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=e.h({type:"raster-array"},i);}triggerRepaint(e){const t=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);t&&t.enabled&&i&&t._clearRenderCacheForTile(i.id,e.tileID),this.map.triggerRepaint();}loadTile(t,i){const o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),r=this.map._requestManager.transformRequest(o,e.R.Tile),s={request:r,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=r,t.actor||(t.actor=this.dispatcher.getActor());const n=(e,o,r,s)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(e){if("AbortError"===e.name)return;return t.state="errored",i(e)}if(this.map._refreshExpiredTiles&&o&&t.setExpiryData({cacheControl:r,expires:s}),this.partial)t.state="empty";else {if(!o)return i(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=o;}i(null);};t.request=this.partial?t.fetchHeader(void 0,n.bind(this)):t.actor.send("loadTile",s,n.bind(this),void 0,!0);}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope});}unloadTile(e,t){const i=e.texturePerLayer;if(e.flushAllQueues(),i.size){e.destroy(!0);for(const e of i.values())this.map.painter.saveTileTexture(e);}else e.destroy();}prepareTile(t,i,o,r){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(i,o,r,((i,r)=>{if(i)return t.state="errored",this.fire(new e.z(i)),void this.triggerRepaint(t);r&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(o,r,this.map.painter),t.state="loaded",this.triggerRepaint(t));})));}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find((({id:t})=>t===e)),i=t&&t.fields,o=i&&i.bands&&i.bands;return o?o[0]:0}getTextureDescriptor(t,i,o){if(!t)return;const r=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!r)return;let s=null;i instanceof e.aN?s=i.paint.get("raster-array-band"):i instanceof e.aO&&(s=i.paint.get("raster-particle-array-band"));const n=s||this.getInitialBand(r);if(null==n)return;if(!t.textureDescriptorPerLayer.get(i.id))return void this.prepareTile(t,r,i.id,n);if(t.updateNeeded(i.id,n)&&!o)return;const a=t.textureDescriptorPerLayer.get(i.id);return Object.assign({},a,{texture:t.texturePerLayer.get(i.id)})}getImages(t,i){const o=new Map;for(const r of t)for(const t of i){const[i,s]=t.split("/"),n=r.getLayer(i);if(!n)continue;if(!n.hasBand(s)||!n.hasDataForBand(s))continue;const{bytes:a,tileSize:l,buffer:c}=n.getBandView(s),h=l+2*c,d={data:new e.r({width:h,height:h},a),pixelRatio:2,sdf:!1,usvg:!1,version:0};o.set(t,d);}return o}}const st={vector:it,raster:ot,"raster-dem":class extends ot{constructor(t,i,o,r){super(t,i,o,r),this.type="raster-dem",this.maxzoom=22,this._options=e.h({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox";}loadTile(t,i){const o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(e,o){e&&(t.state="errored",i(e)),o&&(t.dem=o,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null));}t.request=e.o(this.map._requestManager.transformRequest(o,e.R.Tile),function(o,s,n,a){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(o)t.state="errored",i(o);else if(s){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:n,expires:a});const i=ImageBitmap&&s instanceof ImageBitmap&&e.t(),o=1-(s.width-e.aL(s.width))/2;o<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?s:e.q.getImageData(s,o),c={uid:t.uid,tileID:t.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:o};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadTile",c,r.bind(this),void 0,!0));}}.bind(this));}_getNeighboringTiles(t){const i=t.canonical,o=Math.pow(2,i.z),r=(i.x-1+o)%o,s=0===i.x?t.wrap-1:t.wrap,n=(i.x+1+o)%o,a=i.x+1===o?t.wrap+1:t.wrap,l={};return l[new e.aM(t.overscaledZ,s,i.z,r,i.y).key]={backfilled:!1},l[new e.aM(t.overscaledZ,a,i.z,n,i.y).key]={backfilled:!1},i.y>0&&(l[new e.aM(t.overscaledZ,s,i.z,r,i.y-1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,a,i.z,n,i.y-1).key]={backfilled:!1}),i.y+1<o&&(l[new e.aM(t.overscaledZ,s,i.z,r,i.y+1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.aM(t.overscaledZ,a,i.z,n,i.y+1).key]={backfilled:!1}),l}},"raster-array":rt,geojson:class extends e.E{constructor(t,i,o,r){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(r),this._data=i.data,this._options=e.h({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),void 0!==i.minzoom&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const s=e.aj/this.tileSize;this.workerOptions=e.h({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*s,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*s,extent:e.aj,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.aj,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*s,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions);}onAdd(e){this.map=e,this.setData(this._data);}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){if(!this._options.dynamic)return this.fire(new e.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof t&&("Feature"===t.type&&(t={type:"FeatureCollection",features:[t]}),"FeatureCollection"!==t.type))return this.fire(new e.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof t&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const e=new Map;for(const t of this._data.features)e.set(t.id,t);for(const i of t.features)e.set(i.id,i);this._data.features=[...e.values()];}else this._data=t;return this._updateWorkerData(!0),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,o){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},o),this}_updateWorkerData(t=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.A("dataloading",{dataType:"source"})),this._loaded=!1;const i=e.h({append:t},this.workerOptions);i.scope=this.scope;const o=this._data;"string"==typeof o?(i.request=this.map._requestManager.transformRequest(e.q.resolveURL(o),e.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,((i,o)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new e.z(i));else {const i={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&o&&o.resourceTiming&&o.resourceTiming[this.id]&&(i.resourceTiming=o.resourceTiming[this.id]),t&&(this._partialReload=!0),this.fire(new e.A("data",i)),this._partialReload=!1,this._metadataFired=!0;}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1);}));}loaded(){return this._loaded}reload(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t),this._updateWorkerData();}loadTile(t,i){const o=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const r=this.map.style?this.map.style.getLut(this.scope):null,s=r?{image:r.image.clone()}:null,n=this._partialReload,a={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:s,scope:this.scope,pixelRatio:e.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:n,worldview:this.map.getWorldview()};t.request=this.actor.send(o,a,((e,r)=>n&&!r?(t.state="loaded",i(null)):(delete t.request,t.destroy(),t.aborted?i(null):e?i(e):(t.loadVectorData(r,this.map.painter,"reloadTile"===o),i(null)))),void 0,"loadTile"===o);}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0;}unloadTile(e,t){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy();}onRemove(e){this._pendingLoad&&this._pendingLoad.cancel();}serialize(){return e.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return !1}},video:class extends e.aP{constructor(e,t,i,o){super(e,t,i,o),this.roundZoom=!0,this.type="video",this.options=t;}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.R.Source).url);e.aQ(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.z(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint();})),this.map&&this.video.play(),this._finishLoading());}));}pause(){this.video&&this.video.pause();}play(){this.video&&this.video.play();}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.z(new e.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=t;}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)));}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t);}serialize(){return {type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.aP,model:class extends e.E{constructor(e,t,i,o){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t;}load(){const t=[];for(const i in this._options.models){const o=this._options.models[i],r=e.aS(this.map._requestManager.transformRequest(o.uri,e.R.Model).url).then((t=>{if(!t)return;const r=e.aT(t),s=new e.aU(i,o.position,o.orientation,r);s.computeBoundsAndApplyParent(),this.models.push(s);})).catch((t=>{this.fire(new e.z(new Error(`Could not load model ${i} from ${o.uri}: ${t.message}`)));}));t.push(r);}Promise.allSettled(t).then((()=>{this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"}));})).catch((t=>{this._loaded=!0,this.fire(new e.z(new Error(`Could not load models: ${t.message}`)));}));}onAdd(e){this.map=e,this.load();}hasTransition(){return !1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return this._options}},"batched-model":class extends e.E{constructor(e,t,i,o){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(o);}onAdd(e){this.map=e,this.load();}reload(){this.cancelTileJSONRequest();const t=e.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)));}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);}load(t){this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Qe(this._options,this.map._requestManager,i,o,((r,s)=>{this._tileJSONRequest=null,this._loaded=!0,r?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),o&&2!==o.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new e.z(r))):s&&(e.h(this,s),s.bounds&&(this.tileBounds=new tt(s.bounds,this.minzoom,this.maxzoom)),P(s.tiles,this.map._requestManager._customAccessToken),this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r);}));}hasTransition(){return !1}hasTile(e){return !this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,i){const o=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(o,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:e.q.devicePixelRatio,promoteId:this.promoteId};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=i;else {if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",r,s.bind(this));}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",r,s.bind(this),void 0,!0);function s(e,o){return t.aborted?i(null):e&&404!==e.status?i(e):(this.map._refreshExpiredTiles&&o&&t.setExpiryData(o),t.loadModelData(o,this.map.painter),t.state="loaded",void i(null))}}serialize(){return e.h({},this._options)}},canvas:class extends e.aP{constructor(t,i,o,r){super(t,i,o,r),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.z(new e.V(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.z(new e.V(`sources.${t}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.z(new e.V(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new e.z(new e.V(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.z(new e.V(`sources.${t}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate;}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint();},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1);},this._finishLoading());}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play();}onRemove(e){this.pause();}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i);}serialize(){return {type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of [this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return !0;return !1}},custom:class extends e.E{constructor(t,i,o,r){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new e.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new tt(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.h(this,e.aF(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]));}serialize(){return e.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}));}loaded(){return this._loaded}onAdd(t){this.map=t,this._loaded=!1,this.fire(new e.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load();}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e);}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:o}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:o})}return !this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:i,y:o,z:r}=e.tileID.canonical,s=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:o,z:r},{signal:s.signal})).then(function(i){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===i?(e.state="errored",t(null)):null===i?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(i)?(this.loadTileData(e,i),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((i=>{"AbortError"!==i.name&&(e.state="errored",t(i));})),e.request.cancel=()=>s.abort();}loadTileData(e,t){e.setTexture(t,this.map.painter);}unloadTile(t,i){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:i,z:o}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:i,z:o});}i&&i();}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t&&t();}hasTransition(){return !1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const t=e.C(this.id,this.scope);this.map.style.clearSource(t);}_update(){this.fire(new e.A("data",{dataType:"source",sourceDataType:"content"}));}}},nt=function(t,i,o,r){const s=new st[i.type](t,i,o,r);if(s.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${s.id}`);return e.aV(["load","abort","unload","serialize","prepare"],s),s};function at(e,t,i=""){return `${i}:${t.id||""}:${t.layer.id}:${function(e){if("layerId"in e)return `layer:${e.layerId}`;{const{featuresetId:t,importId:i}=e;return `featureset:${t}${i?`:import:${i}`:""}`}}(e.target)}`}function lt(e,t,i,o=""){if(e.uniqueFeatureID){const r=at(e,t,o);if(i.has(r))return !0;i.add(r);}return !1}function ct(e,t,i,o,r=!1){const s=t.sourceCache.transform,n=t.sourceCache.tilesIn(e,t.has3DLayers,r);n.sort(ut);const a=[];for(const e of n){const n=e.tile.queryRenderedFeatures(t,e,i,o,s,r);Object.keys(n).length&&a.push({wrappedTileID:e.tile.tileID.wrapped().key,queryResults:n});}return 0===a.length?{}:function(e){const t={},i={};for(const o of e){const e=o.queryResults,r=o.wrappedTileID,s=i[r]=i[r]||{};for(const i in e){const o=e[i],r=s[i]=s[i]||{},n=t[i]=t[i]||[];for(const e of o)r[e.featureIndex]||(r[e.featureIndex]=!0,n.push(e));}}return t}(a)}function ht(e,t,i,o,r,s){const n={},a=o.queryRenderedSymbols(e),l=[];for(const e of Object.keys(a).map(Number))l.push(r[e]);l.sort(ut);for(const e of l){const o=e.featureIndex.lookupSymbolFeatures(a[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,t,i,s);for(const t in o){const i=n[t]=n[t]||[],r=o[t];r.sort(((t,i)=>{const o=e.featureSortOrder;if(o){const e=o.indexOf(t.featureIndex);return o.indexOf(i.featureIndex)-e}return i.featureIndex-t.featureIndex}));for(const e of r)i.push(e);}}return n}function dt(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),o=[],r={};for(let e=0;e<i.length;e++){const s=i[e],n=s.tileID.canonical.key;r[n]||(r[n]=!0,s.querySourceFeatures(o,t));}return o}function ut(e,t){const i=e.tileID,o=t.tileID;return i.overscaledZ-o.overscaledZ||i.canonical.y-o.canonical.y||i.wrap-o.wrap||i.canonical.x-o.canonical.x}function _t(e,t){const i={};if(!t)return i;for(const o of e){const e=o.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){o.layers=e,o.stateDependentLayerIds&&(o.stateDependentLayers=o.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.fqid]=o;}}return i}const pt=32,ft=33,mt=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,o=0,r=0,s=0,n=0,a=0;for(1&t?r=s=n=pt:i=o=a=pt;(t>>=1)>1;){const e=i+r>>1,l=o+s>>1;1&t?(r=i,s=o,i=n,o=a):(i=r,o=s,r=n,s=a),n=e,a=l;}const l=4*e;mt[l+0]=i,mt[l+1]=o,mt[l+2]=r,mt[l+3]=s;}const gt=new Uint16Array(2178),vt=new Uint8Array(1089),yt=new Uint16Array(1089);function xt(e){return 0===e?-.03125:32===e?.03125:0}const bt=(()=>({type:2,extent:e.aj,loadGeometry:()=>[[new e.P(0,0),new e.P(e.aj+1,0),new e.P(e.aj+1,e.aj+1),new e.P(0,e.aj+1),new e.P(0,0)]]}))();class wt{constructor(t,i,o,r,s,n){this.tileID=t,this.uid=e.a$(),this.uses=0,this.tileSize=i,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=s,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection),this.worldview=n;}registerFadeDuration(t){const i=t+this.timeAdded;i<e.q.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i);}wasRequested(){return "errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,o){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=_t(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.b1){if(this.hasSymbolBuckets=!0,!o)break;i.justReloaded=!0;}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.b1&&i.hasRTLText){this.hasRTLText=!0,e.b2();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],o=i.style.getOwnLayer(e);if(!o)continue;const r=o.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,r);}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness;}else this.collisionBoxArray=new e.b0;}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded";}}loadModelData(e,t,i){e&&(e.resourceTiming&&(this.resourceTiming=e.resourceTiming),this.buckets=Object.assign({},this.buckets,_t(e.buckets,t.style)),e.featureIndex&&(this.latestFeatureIndex=e.featureIndex));}getBucket(e){return this.buckets[e.fqid]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t);}const i=t.gl,o=this.imageAtlas;o&&!o.uploaded&&(this.imageAtlasTexture=new e.T(t,o.image,i.RGBA8,{useMipmap:!!o.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0);}prepare(e,t,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const o=t.style.getBrightness();(this._lastUpdatedBrightness||o)&&(this._lastUpdatedBrightness&&o&&Math.abs(this._lastUpdatedBrightness-o)<.001||(this.updateBuckets(t,this._lastUpdatedBrightness!==o),this._lastUpdatedBrightness=o));}queryRenderedFeatures(t,i,o,r,s,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return {};const a=function(t,i){const o=e.bn([],[.5*t.width,.5*-t.height,1]);return e.bo(o,o,[1,-1,0]),e.az(o,o,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(o)}(s,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:i,pixelPosMatrix:a,transform:r,availableImages:o,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,i){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const r=o.loadVTLayers(),s=i?i.sourceLayer:"",n=r._geojsonTileLayer||r[s];if(!n)return;const a=e.b3(i&&i.filter),{z:l,x:c,y:h}=this.tileID.canonical,d={z:l,x:c,y:h};for(let i=0;i<n.length;i++){const r=n.feature(i);if(a.needGeometry){const t=e.b4(r,!0);if(!a.filter(new e.aa(this.tileID.overscaledZ,{worldview:this.worldview}),t,this.tileID.canonical))continue}else if(!a.filter(new e.aa(this.tileID.overscaledZ,{worldview:this.worldview}),r))continue;const u=o.getId(r,s),_=new e.b5(r,l,c,h,u);_.tile=d,t.push(_);}}loaded(){return "loaded"===this.state||"errored"===this.state}hasData(){return "loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return !!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.b6(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"]);}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(i)if(this.expirationTime<i)t=!0;else {const o=this.expirationTime-i;o?this.expirationTime=e+Math.max(o,3e4):t=!0;}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0;}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(e){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&e&&this.updateBuckets(e);}updateBuckets(t,i){if(!this.latestFeatureIndex)return;if(!t.style)return;const o=this.latestFeatureIndex.loadVTLayers(),r=t.style.listImages(),s=t.style.getBrightness();for(const n in this.buckets){if(!t.style.hasLayer(n))continue;const a=this.buckets[n],l=a.layers[0],c=l.sourceLayer||"_geojsonTileLayer",h=o[c],d=t.style.getLayerSourceCache(l);let u={};d&&(u=d._state.getState(c,void 0));const _=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},p=Object.keys(u).length>0&&!i;p&&!a.stateDependentLayers.length&&!i||a.update(u,h,r,_,p?a.stateDependentLayers:a.layers,i,s),(a instanceof e.b7||a instanceof e.b8)&&t._terrain&&t._terrain.enabled&&d&&a.uploadPending()&&t._terrain._clearRenderCacheForTile(d.id,this.tileID);const f=t&&t.style&&t.style.getOwnLayer(n);f&&(this.queryPadding=Math.max(this.queryPadding,f.queryRadius(a)));}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return !this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0;}setHoldDuration(t){this.symbolFadeHoldUntil=e.q.now()+t;}setTexture(t,i){const o=i.context,r=o.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t):(this.texture=new e.T(o,t,r.RGBA8,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));}setDependencies(e,t){const i={};for(const e of t)i[e]=!0;this.dependencies[e]=i;}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return !0}return !1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const o=e.b9(bt,this.tileID.canonical,this.tileTransform)[0],r=new e.ba,s=new e.bb;for(let e=0;e<o.length;e++){const{x:t,y:i}=o[e];r.emplaceBack(t,i),s.emplaceBack(e);}s.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(s),this._tileDebugBuffer=t.createVertexBuffer(r,e.bc.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,r.length,s.length);}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const o=e.b9(bt,this.tileID.canonical,this.tileTransform)[0];let r,s;if(this.isRaster){const t=function(t,i){const o=e.aW(t,i),r=Math.pow(2,t.z);for(let s=0;s<ft;s++)for(let n=0;n<ft;n++){const a=e.aX((t.x+(n+xt(n))/pt)/r),l=e.aY((t.y+(s+xt(s))/pt)/r),c=i.project(a,l),h=s*ft+n;gt[2*h+0]=Math.round((c.x*o.scale-o.x)*e.aj),gt[2*h+1]=Math.round((c.y*o.scale-o.y)*e.aj);}vt.fill(0),yt.fill(0);for(let e=2045;e>=0;e--){const t=4*e,i=mt[t+0],o=mt[t+1],r=mt[t+2],s=mt[t+3],n=i+r>>1,a=o+s>>1,l=n+a-o,c=a+i-n,h=o*ft+i,d=s*ft+r,u=a*ft+n,_=Math.hypot((gt[2*h+0]+gt[2*d+0])/2-gt[2*u+0],(gt[2*h+1]+gt[2*d+1])/2-gt[2*u+1])>=16;vt[u]=vt[u]||(_?1:0),e<1022&&(vt[u]=vt[u]||vt[(o+c>>1)*ft+(i+l>>1)]||vt[(s+c>>1)*ft+(r+l>>1)]);}const s=new e.aZ,n=new e.a_;let a=0;function l(t,i){const o=i*ft+t;return 0===yt[o]&&(s.emplaceBack(gt[2*o+0],gt[2*o+1],t*e.aj/pt,i*e.aj/pt),yt[o]=++a),yt[o]-1}function c(e,t,i,o,r,s){const a=e+i>>1,h=t+o>>1;if(Math.abs(e-r)+Math.abs(t-s)>1&&vt[h*ft+a])c(r,s,e,t,a,h),c(i,o,r,s,a,h);else {const a=l(e,t),c=l(i,o),h=l(r,s);n.emplaceBack(a,c,h);}}return c(0,0,pt,pt,pt,0),c(pt,pt,0,0,0,pt),{vertices:s,indices:n}}(this.tileID.canonical,i);r=t.vertices,s=t.indices;}else {r=new e.aZ,s=new e.a_;for(const{x:e,y:t}of o)r.emplaceBack(e,t,0,0);const t=e.be(r.int16.subarray(0,4*r.length),void 0,4);for(let e=0;e<t.length;e+=3)s.emplaceBack(t[e],t[e+1],t[e+2]);}this._tileBoundsBuffer=t.createVertexBuffer(r,e.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(s),this._tileBoundsSegments=e.bd.simpleSegment(0,0,r.length,s.length);}_makeGlobeTileDebugBuffers(t,i){const o=i.projection;if(!o||"globe"!==o.name||i.freezeTileCoverage)return;const r=this.tileID.canonical,s=e.bg(r,i),n=e.bh(s),a=e.ah(i.zoom);let l;a>0&&(l=e.bi(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,r,i,n,l,a),this._makeGlobeTileDebugTextBuffer(t,r,i,n,l,a);}_globePoint(t,i,o,r,s,n,a){let l=e.bj(t,i,o);if(n){const s=1<<o.z,c=e.aD(r.center.lng),h=e.aH(r.center.lat),d=(o.x+.5)/s-c;let u=0;d>.5?u=-1:d<-.5&&(u=1);let _=(t/e.aj+o.x)/s+u,p=(i/e.aj+o.y)/s;_=(_-c)*r._pixelsPerMercatorPixel+c,p=(p-h)*r._pixelsPerMercatorPixel+h;const f=[_*r.worldSize,p*r.worldSize,0];e.ad(f,f,n),l=e.bk(l,f,a);}return e.ad(l,l,s)}_makeGlobeTileDebugBorderBuffer(t,i,o,r,s,n){const a=new e.ba,l=new e.bb,c=new e.bl,h=(e,t,h,d,u)=>{const _=(h-e)/(u-1),p=(d-t)/(u-1),f=a.length;for(let h=0;h<u;h++){const d=e+h*_,u=t+h*p;a.emplaceBack(d,u);const m=this._globePoint(d,u,i,o,r,s,n);c.emplaceBack(m[0],m[1],m[2]),l.emplaceBack(f+h);}},d=e.aj;h(0,0,d,0,16),h(d,0,d,d,16),h(d,d,0,d,16),h(0,d,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,e.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.bm.members),this._tileDebugSegments=e.bd.simpleSegment(0,0,a.length,l.length);}_makeGlobeTileDebugTextBuffer(t,i,o,r,s,n){const a=e.aj/4,l=new e.ba,c=new e.a_,h=new e.bl,d=25;c.reserve(32),l.reserve(d),h.reserve(d);const u=(e,t)=>d*e+t;for(let e=0;e<d;e++){const t=e*a;for(let e=0;e<d;e++){const c=e*a;l.emplaceBack(c,t);const d=this._globePoint(c,t,i,o,r,s,n);h.emplaceBack(d[0],d[1],d[2]);}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const i=u(e,t),o=u(e,t+1),r=u(e+1,t),s=u(e+1,t+1);c.emplaceBack(i,o,r),c.emplaceBack(r,o,s);}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(h,e.bm.members),this._tileDebugTextSegments=e.bd.simpleSegment(0,0,d,32);}destroy(t=!1){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded";}}e.bp.setPbf(e.bq);class Tt extends wt{constructor(e,t,i,o,r){super(e,t,i,o,r),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map;}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(e){return this._mrt&&this._mrt.getLayer(e)}setTexturePerLayer(t,i,o){const r=o.context,s=r.gl;let n=this.texturePerLayer.get(t)||o.getTileTexture(i.width);n&&n instanceof e.T?n.update(i,{premultiply:!1}):n=new e.T(r,i,s.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,n);}flushQueues(e){const t=this._workQueuePerLayer.get(e)||[],i=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()();for(;i.length;)i.pop()();}flushAllQueues(){for(const e of this._workQueuePerLayer.keys()){const t=this._workQueuePerLayer.get(e)||[];for(;t.length;)t.pop()();}for(const e of this._fetchQueuePerLayer.keys()){const t=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()();}}fetchHeader(t=16384,i){const o=this._mrt=new e.bp(30),r=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.br(r,((e,r,s,n)=>{if(e)i(e);else try{const e=o.getHeaderLength(r);if(e>t)return void(this.request=this.fetchHeader(e,i));o.parseHeader(r),this._isHeaderLoaded=!0;let a=0;for(const e of Object.values(o.layers))a=Math.max(a,e.dataIndex[e.dataIndex.length-1].lastByte);r.byteLength>=a&&(this.entireBuffer=r),i(null,this.entireBuffer||r,s,n);}catch(e){i(e);}})),this.request}fetchBand(t,i,o,r){const s=this._mrt;if(!this._isHeaderLoaded||!s)return void r(new Error("Tile header is not ready"));const n=this.actor;if(!n)return void r(new Error("Can't fetch tile band without an actor"));let a;const l=(e,s)=>{if(a.complete(e,s),e)return void r(e);this.updateTextureDescriptor(t,i,o);const n=this.textureDescriptorPerLayer.get(i);r(null,n&&n.img);},c=(e,t)=>{if(e)return r(e);const o=n.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:t,task:a},l,void 0,!0),s=this._workQueuePerLayer.get(i)||[];s.push((()=>{o&&o.cancel(),a.cancel();})),this._workQueuePerLayer.has(i)||this._workQueuePerLayer.set(i,s);},h=s.getLayer(t);if(!h)return void r(new Error(`Unknown sourceLayer "${t}"`));if(h.hasDataForBand(o)){this.updateTextureDescriptor(t,i,o);const e=this.textureDescriptorPerLayer.get(i);return void r(null,e?e.img:null)}const d=h.getDataRange([o]);if(a=s.createDecodingTask(d),!a||a.tasks.length)if(this.flushQueues(i),this.entireBuffer)c(null,this.entireBuffer.slice(d.firstByte,d.lastByte+1));else {const t=Object.assign({},this.requestParams,{headers:{Range:`bytes=${d.firstByte}-${d.lastByte}`}}),o=e.br(t,c),r=this._fetchQueuePerLayer.get(i)||[];r.push((()=>{o.cancel(),a.cancel();})),this._fetchQueuePerLayer.has(i)||this._fetchQueuePerLayer.set(i,r);}else r(null);}updateNeeded(e,t){return (!this.textureDescriptorPerLayer.get(e)||this.textureDescriptorPerLayer.get(e).band!==t)&&"errored"!==this.state}updateTextureDescriptor(t,i,o){if(!this._mrt)return;const r=this._mrt.getLayer(t);if(!r||!r.hasBand(o)||!r.hasDataForBand(o))return;const{bytes:s,tileSize:n,buffer:a,offset:l,scale:c}=r.getBandView(o),h=n+2*a,d=new e.r({width:h,height:h},s),u=this.texturePerLayer.get(i);u&&u instanceof e.T&&u.update(d,{premultiply:!1}),this.textureDescriptorPerLayer.set(i,{layer:t,band:o,img:d,buffer:a,offset:l,tileSize:n,format:r.pixelFormat,mix:[c,256*c,65536*c,16777216*c]});}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const t of this.texturePerLayer.values())t&&t instanceof e.T&&t.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1;}}class Et{constructor(e,t){this.max=e,this.onRemove=t,this.reset();}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const o=e.wrapped().key;void 0===this.data[o]&&(this.data[o]=[]);const r={value:t,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout((()=>{this.remove(e,r);}),i)),this.data[o].push(r),this.order.push(o),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,o=void 0===t?0:this.data[i].indexOf(t),r=this.data[i][o];return this.data[i].splice(o,1),r.timeout&&clearTimeout(r.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(r.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e);}return this}filter(e){const t=[];for(const i in this.data)for(const o of this.data[i])e(o.value)||t.push(o);for(const e of t)this.remove(e.value.tileID,e);}}class St{constructor(){this.state={},this.stateChanges={},this.deletedStates={};}updateState(t,i,o){const r=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},e.h(this.stateChanges[t][r],o),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null);}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])o[e]||(this.deletedStates[t][r][e]=null);}else for(const e in o)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][e]&&delete this.deletedStates[t][r][e];}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const o=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][o]&&(this.deletedStates[e][o]=this.deletedStates[e][o]||{},this.deletedStates[e][o][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][o])for(i in this.deletedStates[e][o]={},this.stateChanges[e][o])this.deletedStates[e][o][i]=null;else this.deletedStates[e][o]=null;else this.deletedStates[e]=null;}getState(t,i){const o=this.state[t]||{},r=this.stateChanges[t]||{},s=this.deletedStates[t];if(null===s)return {};if(void 0!==i){const t=String(i),n=e.h({},o[t],r[t]);if(s){const e=s[i];if(null===e)return {};for(const t in e)delete n[t];}return n}const n=e.h({},o,r);if(s)for(const e in s)delete n[e];return n}initializeTileState(e,t){e.refreshFeatureState(t);}coalesceChanges(t,i){const o={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const i={};for(const o in this.stateChanges[t])this.state[t][o]||(this.state[t][o]={}),e.h(this.state[t][o],this.stateChanges[t][o]),i[o]=this.state[t][o];o[t]=i;}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const i={};if(null===this.deletedStates[t])for(const e in this.state[t])i[e]={},this.state[t][e]={};else for(const e in this.deletedStates[t]){if(null===this.deletedStates[t][e])this.state[t][e]={};else if(this.state[t][e])for(const i of Object.keys(this.deletedStates[t][e]))delete this.state[t][e][i];i[e]=this.state[t][e];}o[t]=o[t]||{},e.h(o[t],i);}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(o).length)for(const e in t)t[e].refreshFeatureState(i);}}class It extends e.E{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform));})),t.on("error",(()=>{this._sourceErrored=!0;})),this._source=t,this._tiles={},this._cache=new Et(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new St,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType;}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize;}loaded(){if(this._sourceErrored)return !0;if(!this._sourceLoaded)return !1;if(!this._source.loaded())return !1;for(const e in this._tiles)if(!this._tiles[e].loaded())return !1;return !0}getSource(){return this._source}pause(){this._paused=!0;}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform);}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope);}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Ct).map((e=>e.key))}getRenderableIds(t,i){const o=[];for(const e in this._tiles)this._isIdRenderable(+e,t,i)&&o.push(this._tiles[e]);return t?o.sort(((t,i)=>{const o=t.tileID,r=i.tileID,s=new e.P(o.canonical.x,o.canonical.y)._rotate(this.transform.angle),n=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return o.overscaledZ-r.overscaledZ||n.y-s.y||n.x-s.x})).map((e=>e.tileID.key)):o.map((e=>e.tileID)).sort(Ct).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return !!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else {this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading");}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)));}_tileLoaded(t,i,o,r){if(r)if(t.state="errored",404!==r.status)this._source.fire(new e.z(r,{tile:t}));else {if(this._source.fire(new e.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id);}else this.update(this.transform);}else t.timeAdded=e.q.now(),"expired"===o&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}));}_backfillDEM(e){const t=this.getRenderableIds();for(let o=0;o<t.length;o++){const r=t[o];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);i(e,t),i(t,e);}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const o=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),s=t.tileID.key;0===i&&0===o||Math.abs(o)>1||(Math.abs(i)>1&&(1===Math.abs(i+r)?i+=r:1===Math.abs(i-r)&&(i-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,o),e.neighboringTiles&&e.neighboringTiles[s]&&(e.neighboringTiles[s].backfilled=!0)));}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,o){for(const r in this._tiles){let s=this._tiles[r];if(o[r]||!s.hasData()||s.tileID.overscaledZ<=t||s.tileID.overscaledZ>i)continue;let n=s.tileID;for(;s&&s.tileID.overscaledZ>t+1;){const e=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[e.key],s&&s.hasData()&&(n=e);}let a=n;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){o[n.key]=n;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),o=this._getLoadedTile(t);if(o)return o}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,o=Math.ceil(e.height/t)+1,r=Math.floor(i*o*5),s="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,r):r,n="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(n);}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const o=this._tiles[i];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+t),e[o.tileID.key]=o;}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e]);}}update(t,i,o,r,s){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!o)return;this.updateCacheSize(t,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const n="batched-model"===this._source.type;let a,l=this._source.maxzoom;const c=this.map&&this.map.painter?this.map.painter._terrain:null;if(c&&c.sourceCache===this&&c.attenuationRange()){const e=c.attenuationRange()[0],t=Math.floor(e)-Math.log2(c.getDemUpscale());l>t&&(l=t);}if(this.used||this.usedForTerrain){if(this._source.tileID)a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.aM(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)));else if(0!==this.tileCoverLift){const r=t.clone();r.tileCoverLift=this.tileCoverLift,a=r.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:n}),this._source.minzoom<=1&&"globe"===t.projection.name&&(a.push(new e.aM(1,0,1,0,0)),a.push(new e.aM(1,0,1,1,0)),a.push(new e.aM(1,0,1,0,1)),a.push(new e.aM(1,0,1,1,1)));}else if(a=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:n}),this._source.hasTile){const e=this._source.hasTile.bind(this._source);a=a.filter((t=>e(t)));}}else a=[];if(a.length>0&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Rt(this._source.type)){const e=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!o}),l=Math.min(e,this._source.maxzoom);if(n){const e=t.extendTileCover(a,l);for(const t of e)a.push(t);}else if(s){const e=t.extendTileCoverToNearPlane(a,this.transform.getFrustum(l),l);for(const t of e)a.push(t);}else if(this.castsShadows&&r){const e=t.extendTileCover(a,l,r);for(const t of e)this._shadowCasterTiles[t.key]=!0,a.push(t);}}const h=this._updateRetainedTiles(a);if(Rt(this._source.type)&&0!==a.length){const t={},i={},o=Object.keys(h);for(const r of o){const o=h[r],s=this._tiles[r];if(!s||s.fadeEndTime&&s.fadeEndTime<=e.q.now())continue;const n=this.findLoadedParent(o,Math.max(o.overscaledZ-It.maxOverzooming,this._source.minzoom));n&&(this._addTile(n.tileID),t[n.tileID.key]=n.tileID),i[r]=o;}const r=a[a.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(h[e]||!t.hasData())continue;let o=t.tileID;for(;o.overscaledZ>r;){o=o.scaledTo(o.overscaledZ-1);const r=this._tiles[o.key];if(r&&r.hasData()&&i[o.key]){h[e]=t.tileID;break}}}for(const e in t)h[e]||(this._coveredTiles[e]=!0,h[e]=t[e]);}for(const e in h)this._tiles[e].clearFadeHold();const d=e.bs(this._tiles,h);for(const e of d){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e);}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate();}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e);}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},o=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),r=e[0].overscaledZ,s=Math.max(r-It.maxOverzooming,this._source.minzoom),n=Math.max(r+It.maxUnderzooming,this._source.minzoom),a={};for(const i of e){const e=this._addTile(i);t[i.key]=i,e.hasData()||o<this._source.maxzoom&&(a[i.key]=i);}this._retainLoadedChildren(a,o,n,t);for(const o of e){let e=this._tiles[o.key];if(e.hasData())continue;if(o.canonical.z>=this._source.maxzoom){const e=o.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else {const e=o.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let r=e.wasRequested();for(let n=o.overscaledZ-1;n>=s;--n){const s=o.scaledTo(n);if(i[s.key])break;if(i[s.key]=!0,e=this.getTile(s),!e&&r&&(e=this._addTile(s)),e&&(t[s.key]=s,r=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,o=this._tiles[e].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){i=this._loadedParentTiles[o.key];break}t.push(o.key);const e=o.scaledTo(o.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;o=e;}for(const e of t)this._loadedParentTiles[e]=i;}}_addTile(t){let i=this._tiles[t.key];if(i)return !0!==i.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const o=Boolean(i);if(!o){const e=this.map?this.map.painter:null,o=this._source.tileSize*t.overscaleFactor();i="raster-array"===this._source.type?new Tt(t,o,this.transform.tileZoom,e,this._isRaster):new wt(t,o,this.transform.tileZoom,e,this._isRaster,this._source.worldview),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state));}return i.uses++,this._tiles[t.key]=i,o||this._source.fire(new e.A("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e];}),i));}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))));}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id);}tilesIn(t,i,o){const r=[],s=this.transform;if(!s)return r;const n="globe"===s.projection.name,a=e.aD(s.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(o&&c.clearQueryDebugViz(),c.holdingForFade())continue;let h;if(n){const t=c.tileID.canonical;if(0===t.z){const i=[Math.abs(e.ay(a,...At(t,-1))-a),Math.abs(e.ay(a,...At(t,1))-a)];h=[0,2*i.indexOf(Math.min(...i))-1];}else {const i=[Math.abs(e.ay(a,...At(t,-1))-a),Math.abs(e.ay(a,...At(t,0))-a),Math.abs(e.ay(a,...At(t,1))-a)];h=[i.indexOf(Math.min(...i))-1];}}else h=[0];for(const e of h){const o=t.containsTile(c,s,i,e);o&&r.push(o);}}return r}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const i=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID)),o="globe"===this.transform.projection.name;for(const e of i)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped()),e.expandedProjMatrix=o?this.transform.calculateProjMatrix(e.toUnwrapped(),!1,!0):e.projMatrix;return i}sortCoordinatesByDistance(e){const t=e.slice(),i=this.transform._camera.position,o=this.transform._camera.forward(),r={};for(const e of t){const t=1/(1<<e.canonical.z);r[e.key]=((e.canonical.x+.5)*t+e.wrap-i[0])*o[0]+((e.canonical.y+.5)*t-i[1])*o[1]-i[2]*o[2];}return t.sort(((e,t)=>r[e.key]-r[t.key])),t}hasTransition(){if(this._source.hasTransition())return !0;if(Rt(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=e.q.now())return !0}return !1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i);}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i);}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const o=this._tiles[e];o&&o.setDependencies(t,i);}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)));}_preloadTiles(t,i){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,i));};return void this._source.on("data",e)}const o=new Map,r=Array.isArray(t)?t:[t],s=this.map.painter.terrain,n=this.usedForTerrain&&s?s.getScaledDemTileSize():this._source.tileSize;for(const e of r){const t=e.coveringTiles({tileSize:n,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)o.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1);}const a=Array.from(o.values());e.bt(a,((e,t)=>{const i=new wt(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(i,(e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i);}));}),i);}}function Ct(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),o=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||o-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Rt(e){return "raster"===e||"image"===e||"video"===e||"custom"===e}function At(e,t){const i=1<<e.z;return [e.x/i+t,(e.x+1)/i+t]}It.maxOverzooming=10,It.maxUnderzooming=3;class Dt{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[];}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const i in this.style._mergedLayers){const o=this.style._mergedLayers[i];if("fill-extrusion"===o.type||"building"===o.type)this.layers.push({layer:o,visible:e,visibilityChanged:t});else if("model"===o.type){const i=this.style.getLayerSource(o);i&&"batched-model"===i.type&&this.layers.push({layer:o,visible:e,visibilityChanged:t});}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const i=t.layer;let o=!1;"fill-extrusion"===i.type?o=!i.isHidden(e)&&i.paint.get("fill-extrusion-opacity")>0:"building"===i.type?o=!i.isHidden(e)&&i.paint.get("building-opacity")>0:"model"===i.type&&(o=!i.isHidden(e)&&i.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!o&&t.visible,t.visible=o;}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const e of this.layers){const i=e.layer,o=this.style.getLayerSourceCache(i);let r=1;"fill-extrusion"===i.type?r=e.visible?i.paint.get("fill-extrusion-vertical-scale"):0:"building"===i.type&&(r=e.visible?i.paint.get("building-vertical-scale"):0);let s=o?o.getTile(t):null;if(!s&&o)for(const e in o._tiles){const i=o._tiles[e];if(t.canonical.isChildOf(i.tileID.canonical)){s=i;break}}this.currentBuildingBuckets.push({bucket:s?s.getBucket(i):null,tileID:s?s.tileID:t,verticalScale:r});}e.hasAnyZOffset=!1;let i=!1;for(let o=0;o<e.symbolInstances.length;o++){const r=e.symbolInstances.get(o),s=r.zOffset,n=this._getHeightAtTileOffset(t,r.tileAnchorX,r.tileAnchorY);r.zOffset=n!==Number.NEGATIVE_INFINITY?n:s,i||s===r.zOffset||(i=!0),e.hasAnyZOffset||0===r.zOffset||(e.hasAnyZOffset=!0);}i&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0);}_mapCoordToOverlappingTile(t,i,o,r){let s=i,n=o;if(t.canonical.z!==r.canonical.z){const a=r.canonical,l=1/(1<<t.canonical.z-a.z);s=(i+t.canonical.x*e.aj)*l-a.x*e.aj|0,n=(o+t.canonical.y*e.aj)*l-a.y*e.aj|0;}return {tileX:s,tileY:n}}_getHeightAtTileOffset(e,t,i){let o,r;for(let s=0;s<this.layers.length;++s){const n=this.layers[s].layer;if("fill-extrusion"!==n.type&&"building"!==n.type)continue;const{bucket:a,tileID:l,verticalScale:c}=this.currentBuildingBuckets[s];if(!a)continue;const{tileX:h,tileY:d}=this._mapCoordToOverlappingTile(e,t,i,l),u=a.getHeightAtTileCoord(h,d);u&&void 0!==u.height&&(u.hidden?o=u.height:r=Math.max(u.height*c,r||0));}if(void 0!==r)return r;for(let r=0;r<this.layers.length;++r){const s=this.layers[r];if("model"!==s.layer.type||!s.visible)continue;const{bucket:n,tileID:a}=this.currentBuildingBuckets[r];if(!n)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,i,a),h=n.getHeightAtTileCoord(l,c);if(h&&!h.hidden)return void 0===h.height&&void 0!==o?Math.min(h.maxHeight,o)*h.verticalScale:h.height?h.height*h.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Pt(t,i){const o={};for(const e in t)"ref"!==e&&(o[e]=t[e]);return e.bu.forEach((e=>{e in i&&(o[e]=i[e]);})),o}function Lt(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=Pt(e[i],t[e[i].ref]));return e}const zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Mt(e,t,i){i.push({command:zt.addSource,args:[e,t[e]]});}function Ot(e,t,i){t.push({command:zt.removeSource,args:[e]}),i[e]=!0;}function Ft(e,t,i,o){Ot(e,i,o),Mt(e,t,i);}function Bt(t,i,o){let r;for(r in t[o])if(t[o].hasOwnProperty(r)&&"data"!==r&&!e.bv(t[o][r],i[o][r]))return !1;for(r in i[o])if(i[o].hasOwnProperty(r)&&"data"!==r&&!e.bv(t[o][r],i[o][r]))return !1;return !0}function kt(t,i,o,r,s,n){let a;for(a in i=i||{},t=t||{})t.hasOwnProperty(a)&&(e.bv(t[a],i[a])||o.push({command:n,args:[r,a,i[a],s]}));for(a in i)i.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(e.bv(t[a],i[a])||o.push({command:n,args:[r,a,i[a],s]}));}function Nt(e){return e.id}function Ut(e,t){return e[t.id]=t,e}function jt(t,i,o){const r=i.createTileMatrix(t,t.worldSize,o.toUnwrapped());return e.az(new Float32Array(16),t.projMatrix,r)}function Gt(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const o=i.clone();return o.setProjection(t.projection),jt(o,t.getProjection(),e)}function Vt(e,t,i){return t.name===i.projection.name?e.projMatrix:jt(i,t,e)}class qt{constructor(e,t){this.reset(e,t);}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding;}lerp(t){if(1===this.points.length)return this.points[0];t=e.ay(t,0,1);let i=1,o=this._distances[i];const r=t*this.paddedLength+this.padding;for(;o<r&&i<this._distances.length;)o=this._distances[++i];const s=i-1,n=this._distances[s],a=o-n,l=a>0?(r-n)/a:0;return this.points[s].mult(1-l).add(this.points[i].mult(l))}}class Ht{constructor(e,t,i){const o=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let e=0;e<this.xCellCount*this.yCellCount;e++)o.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0;}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,o,r){this._forEachCell(t,i,o,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(r);}insertCircle(e,t,i,o){this._forEachCell(t-o,i-o,t+o,i+o,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(o);}_insertBoxCell(e,t,i,o,r,s){this.boxCells[r].push(s);}_insertCircleCell(e,t,i,o,r,s){this.circleCells[r].push(s);}_query(e,t,i,o,r,s){if(i<0||e>this.width||o<0||t>this.height)return !r&&[];const n=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=o){if(r)return !0;for(let e=0;e<this.boxKeys.length;e++)n.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],o=this.circles[3*e+2];n.push({key:this.circleKeys[e],x1:t-o,y1:i-o,x2:t+o,y2:i+o});}return s?n.filter(s):n}return this._forEachCell(e,t,i,o,this._queryCell,n,{hitTest:r,seenUids:{box:{},circle:{}}},s),r?n.length>0:n}_queryCircle(e,t,i,o,r){const s=e-i,n=e+i,a=t-i,l=t+i;if(n<0||s>this.width||l<0||a>this.height)return !o&&[];const c=[];return this._forEachCell(s,a,n,l,this._queryCellCircle,c,{hitTest:o,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},r),o?c.length>0:c}query(e,t,i,o,r){return this._query(e,t,i,o,!1,r)}hitTest(e,t,i,o,r){return this._query(e,t,i,o,!0,r)}hitTestCircle(e,t,i,o){return this._queryCircle(e,t,i,!0,o)}_queryCell(e,t,i,o,r,s,n,a){const l=n.seenUids,c=this.boxCells[r];if(null!==c){const r=this.bboxes;for(const h of c)if(!l.box[h]){l.box[h]=!0;const c=4*h;if(e<=r[c+2]&&t<=r[c+3]&&i>=r[c+0]&&o>=r[c+1]&&(!a||a(this.boxKeys[h]))){if(n.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[h],x1:r[c],y1:r[c+1],x2:r[c+2],y2:r[c+3]});}}}const h=this.circleCells[r];if(null!==h){const r=this.circles;for(const c of h)if(!l.circle[c]){l.circle[c]=!0;const h=3*c;if(this._circleAndRectCollide(r[h],r[h+1],r[h+2],e,t,i,o)&&(!a||a(this.circleKeys[c]))){if(n.hitTest)return s.push(!0),!0;{const e=r[h],t=r[h+1],i=r[h+2];s.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i});}}}}}_queryCellCircle(e,t,i,o,r,s,n,a){const l=n.circle,c=n.seenUids,h=this.boxCells[r];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!a||a(this.boxKeys[t])))return s.push(!0),!0}}const d=this.circleCells[r];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return s.push(!0),!0}}}_forEachCell(e,t,i,o,r,s,n,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),h=this._convertToXCellCoord(i),d=this._convertToYCellCoord(o);for(let u=l;u<=h;u++)for(let l=c;l<=d;l++)if(r.call(this,e,t,i,o,this.xCellCount*l+u,s,n,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,o,r,s){const n=o-e,a=r-t,l=i+s;return l*l>n*n+a*a}_circleAndRectCollide(e,t,i,o,r,s,n){const a=(s-o)/2,l=Math.abs(e-(o+a));if(l>a+i)return !1;const c=(n-r)/2,h=Math.abs(t-(r+c));if(h>c+i)return !1;if(l<=a||h<=c)return !0;const d=l-a,u=h-c;return d*d+u*u<=i*i}}const Zt={unknown:0,flipRequired:1,flipNotRequired:2},Wt=Math.tan(85*Math.PI/180);function $t(t,i,o,r,s,n,a){const l=e.bz();if(o)if("globe"===n.name){const t=e.bA(s,i);e.az(l,l,t);}else {const t=e.bB([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],r||e.by(l,l,s.angle);}else e.az(l,s.labelPlaneMatrix,t);return l}function Xt(e,t,i,o,r,s,n){const a=$t(e,t,i,o,r,s,n);return "globe"===s.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function Yt(t,i,o,r,s,n,a){if(o){if("globe"===n.name){const l=$t(t,i,o,r,s,n,a);return e.bi(l,l),e.az(l,t,l),l}{const i=e.bw(t),o=e.bx([]);return o[0]=a[0],o[1]=a[1],o[4]=a[2],o[5]=a[3],e.az(i,i,o),r||e.by(i,i,-s.angle),i}}return s.glCoordMatrix}function Kt(t,i,o,r){const s=[t,i,o,1];o?e.aA(s,s,r):li(s,s,r);const n=s[3];return s[0]/=n,s[1]/=n,s[2]/=n,s}function Jt(e,t){return Math.min(.5+e/t*.5,1.5)}function Qt(e,t){const i=e[0]/e[3],o=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&o>=-t[1]&&o<=t[1]}function ei(t,i,o,r,s,n,a,l,c,h){const d=o.transform,u=r?t.textSizeData:t.iconSizeData,_=e.bH(u,o.transform.zoom),p="globe"===d.projection.name,f=[256/o.width*2+1,256/o.height*2+1],m=r?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;m.clear();let g=null;p&&(g=r?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const v=t.lineVertexArray,y=r?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=o.transform.width/o.transform.height;let b,w=!1;for(let r=0;r<y.length;r++){const p=y.get(r),{numGlyphs:T,writingMode:E}=p;if(E!==e.bI.vertical||w||b===e.bI.horizontal||(w=!0),b=E,(p.hidden||E===e.bI.vertical)&&!w){ai(T,m);continue}w=!1;const S=new e.P(p.tileAnchorX,p.tileAnchorY);let{x:I,y:C,z:R}=d.projection.projectTilePoint(S.x,S.y,h.canonical);if(c){const[e,t,i]=c(S);I+=e,C+=t,R+=i;}const A=[I,C,R,1];if(e.aA(A,A,i),!Qt(A,f)){ai(T,m);continue}const D=A[3],P=Jt(o.transform.getCameraToCenterDistance(d.projection),D),L=e.bJ(u,_,p),z=a?L/P:L*P,M=Kt(I,C,R,s);if(M[3]<=0){ai(T,m);continue}let O={};const F=e.al(t.layers[0].layout.get("text-max-angle")),B=Math.cos(F),k=a?null:c,N=oi(p,z,!1,l,i,s,n,t.glyphOffsetArray,v,m,g,M,S,O,x,k,d.projection,h,a,B);w=N.useVertical,k&&N.needsFlipping&&(O={}),(N.notEnoughRoom||w||N.needsFlipping&&oi(p,z,!0,l,i,s,n,t.glyphOffsetArray,v,m,g,M,S,O,x,k,d.projection,h,a,B).notEnoughRoom)&&ai(T,m);}r?(t.text.dynamicLayoutVertexBuffer.updateData(m),g&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(g)):(t.icon.dynamicLayoutVertexBuffer.updateData(m),g&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(g));}function ti(e,t,i,o,r,s,n,a,l,c,h,d,u,_,p,f,m){const{lineStartIndex:g,glyphStartIndex:v,segment:y}=a,x=v+a.numGlyphs,b=g+a.lineLength,w=t.getoffsetX(v),T=t.getoffsetX(x-1),E=ni(e*w,i,o,r,s,n,y,g,b,l,c,h,d,u,!0,_,p,f,m);if(!E)return null;const S=ni(e*T,i,o,r,s,n,y,g,b,l,c,h,d,u,!0,_,p,f,m);return S?{first:E,last:S}:null}function ii(t,i,o,r){return t===e.bI.horizontal&&Math.abs(r)>Math.abs(o)?{useVertical:!0}:t===e.bI.vertical?r>0?{needsFlipping:!0}:null:i!==Zt.unknown&&function(e,t){return 0===e||Math.abs(t/e)>Wt}(o,r)?i===Zt.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function oi(t,i,o,r,s,n,a,l,c,h,d,u,_,p,f,m,g,v,y,x){const b=i/24,w=t.lineOffsetX*b,T=t.lineOffsetY*b,{lineStartIndex:E,glyphStartIndex:S,numGlyphs:I,segment:C,writingMode:R,flipState:A}=t,D=E+t.lineLength,P=t=>{if(d){const[i,o,r]=t.up,s=h.length;e.bK(d,s+0,i,o,r),e.bK(d,s+1,i,o,r),e.bK(d,s+2,i,o,r),e.bK(d,s+3,i,o,r);}const[i,o,r]=t.point;e.bL(h,i,o,r,t.angle);};if(I>1){const e=ti(b,l,w,T,o,u,_,t,c,n,p,m,!1,g,v,y,x);if(!e)return {notEnoughRoom:!0};if(r&&!o){let[i,o,r]=e.first.point,[s,n,l]=e.last.point;[i,o]=Kt(i,o,r,a),[s,n]=Kt(s,n,l,a);const c=ii(R,A,(s-i)*f,n-o);if(t.flipState=c&&c.needsFlipping?Zt.flipRequired:Zt.flipNotRequired,c)return c}P(e.first);for(let e=S+1;e<S+I-1;e++){const t=ni(b*l.getoffsetX(e),w,T,o,u,_,C,E,D,c,n,p,m,!1,!1,g,v,y,x);if(!t)return h.length-=4*(e-S),{notEnoughRoom:!0};P(t);}P(e.last);}else {if(r&&!o){const i=Kt(_.x,_.y,0,s),o=E+C+1,r=new e.P(c.getx(o),c.gety(o)),n=Kt(r.x,r.y,0,s),a=n[3]>0?n:si(_,r,i,1,s,void 0,g,v.canonical),l=ii(R,A,(a[0]-i[0])*f,a[1]-i[1]);if(t.flipState=l&&l.needsFlipping?Zt.flipRequired:Zt.flipNotRequired,l)return l}const i=ni(b*l.getoffsetX(S),w,T,o,u,_,C,E,D,c,n,p,m,!1,!1,g,v,y,x);if(!i)return {notEnoughRoom:!0};P(i);}return {}}function ri(e,t,i,o,r){const{x:s,y:n,z:a}=o.projectTilePoint(e.x,e.y,t);if(!r)return Kt(s,n,a,i);const[l,c,h]=r(e);return Kt(s+l,n+c,a+h,i)}function si(t,i,o,r,s,n,a,l){const c=ri(t.sub(i)._unit()._add(t),l,s,a,n);return e.at(c,o,c),e.au(c,c),e.bE(c,o,c,r)}function ni(t,i,o,r,s,n,a,l,c,h,d,u,_,p,f,m,g,v,y){const x=r?t-i:t+i;let b=x>0?1:-1,w=0;r&&(b*=-1,w=Math.PI),b<0&&(w+=Math.PI);let T=l+a+(b>0?0:1)|0,E=s,S=s,I=0,C=0;const R=Math.abs(x),A=[],D=[];let P=n,L=P,z=e.bC([]);const M=()=>si(L,P,S,R-I+1,d,_,m,g.canonical);for(;I+C<=R;){if(T+=b,T<l||T>=c)return null;if(S=E,L=P,A.push(S),p&&D.push(L),P=new e.P(h.getx(T),h.gety(T)),E=u[T],!E){const e=ri(P,g.canonical,d,m,_);E=e[3]>0?u[T]=e:M();}I+=C;const t=e.at([],E,S),i=e.bD(S,E);if(o&&i>0&&C>0&&e.bG(z,t)/(C*i)<y)return null;C=i,z=t;}f&&_&&(u[T]&&(E=M(),C=e.bD(S,E),z=e.at([],E,S)),u[T]=E);const O=(R-I)/C,F=P.sub(L)._mult(O)._add(L),B=e.bE([],S,z,O);let k=[0,0,1],N=z[0],U=z[1];if(v&&(k=m.upVector(g.canonical,F.x,F.y),0!==k[0]||0!==k[1]||1!==k[2])){const t=[k[2],0,-k[0]],i=e.bF([],k,t);e.au(t,t),e.au(i,i),N=e.bG(z,t),U=e.bG(z,i);}if(o){const t=e.bF([],k,z);e.au(t,t),e.bE(B,B,t,o*b);}const j=w+Math.atan2(U,N);return A.push(B),p&&D.push(F),{point:B,angle:j,path:A,tilePath:D,up:k}}function ai(e,t){const i=t.length,o=i+4*e;t.resize(o),t.float32.fill(-1/0,4*i,4*o);}function li(e,t,i){const o=t[0],r=t[1];return e[0]=i[0]*o+i[4]*r+i[12],e[1]=i[1]*o+i[5]*r+i[13],e[3]=i[3]*o+i[7]*r+i[15],e}const ci=100;class hi{constructor(e,t,i=new Ht(e.width+200,e.height+200,25),o=new Ht(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=o,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+ci,this.screenBottomBoundary=e.height+ci,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t;}placeCollisionBox(t,i,o,r,s,n,a,l,c,h,d){let u=o.projectedAnchorX,_=o.projectedAnchorY,p=o.projectedAnchorZ;const f=o.tileAnchorX,m=o.tileAnchorY,g=o.elevation,v=o.tileID,y=t.getProjection();if(g&&v){const[e,t,i]=y.upVector(v.canonical,o.tileAnchorX,o.tileAnchorY),r=y.upVectorScale(v.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;u+=e*g*r,_+=t*g*r,p+=i*g*r;}const x="globe"===t.projection.name,b="globe"===t.projection.name?e.ah(this.transform.zoom):0;if(v&&x&&b<1&&!n){const t=1<<v.canonical.z,i=e.bM(f,m);e.bN(i,i,1/e.aj),e.bO(i,i,e.bM(v.canonical.x,v.canonical.y)),e.bN(i,i,1/t),e.bP(i,i,e.bM(r[0],r[1])),i[0]=e.bQ(i[0],-.5,.5),e.bN(i,i,e.aj);const o=e.bR(i[0],i[1],e.aj/(2*Math.PI),1);e.aA(o,o,s),u=e.ai(u,o[0],b),_=e.ai(_,o[1],b),p=e.ai(p,o[2],b);}const w=this.projectAndGetPerspectiveRatio(h,u,_,p,o.tileID,"globe"===y.name||!!g||this.transform.pitch>0,y),T=c*w.perspectiveRatio,E=(o.x1*i+a.x-o.padding)*T+w.point.x,S=(o.y1*i+a.y-o.padding)*T+w.point.y,I=(o.x2*i+a.x+o.padding)*T+w.point.x,C=(o.y2*i+a.y+o.padding)*T+w.point.y,R=w.perspectiveRatio<=.55||w.occluded;return !this.isInsideGrid(E,S,I,C)||!l&&this.grid.hitTest(E,S,I,C,d)||R?{box:[],offscreen:!1,occluded:w.occluded}:{box:[E,S,I,C],offscreen:this.isOffscreen(E,S,I,C),occluded:!1}}placeCollisionCircles(t,i,o,r,s,n,a,l,c,h,d,u,_,p,f){const m=[],g=this.transform.elevation,v=t.getProjection(),y=g?g.getAtTileOffsetFunc(f,this.transform.center.lat,this.transform.worldSize,v):null,x=new e.P(o.tileAnchorX,o.tileAnchorY);let{x:b,y:w,z:T}=v.projectTilePoint(x.x,x.y,f.canonical);if(y){const[e,t,i]=y(x);b+=e,w+=t,T+=i;}const E="globe"===v.name,S=this.projectAndGetPerspectiveRatio(a,b,w,T,f,E||!!g||this.transform.pitch>0,v),{perspectiveRatio:I}=S,C=(d?n/I:n*I)/e.bU,R=Kt(b,w,T,l),A=o.lineOffsetX*C,D=o.lineOffsetY*C,P=e.al(t.layers[0].layout.get("text-max-angle")),L=Math.cos(P),z=S.signedDistanceFromCamera>0?ti(C,s,A,D,!1,R,x,o,r,l,{},g&&!d?y:null,d&&!!g,v,f,d,L):null;let M=!1,O=!1,F=!0;if(z&&!S.occluded){const t=.5*_*I+p,o=new e.P(-100,-100),r=new e.P(this.screenRightBoundary,this.screenBottomBoundary),s=new qt,{first:n,last:a}=z,l=n.path.length;let d=[];for(let e=l-1;e>=1;e--)d.push(n.path[e]);for(let e=1;e<a.path.length;e++)d.push(a.path[e]);const f=2.5*t;c&&(d=d.map((([e,t,i],o)=>(y&&!E&&(i=y(o<l-1?n.tilePath[l-1-o]:a.tilePath[o-l+2])[2]),Kt(e,t,i,c)))),d.some((e=>e[3]<=0))&&(d=[]));let g=[];if(d.length>0){let t=1/0,i=-1/0,s=1/0,n=-1/0;for(const e of d)t=Math.min(t,e[0]),s=Math.min(s,e[1]),i=Math.max(i,e[0]),n=Math.max(n,e[1]);i>=o.x&&t<=r.x&&n>=o.y&&s<=r.y&&(g=[d.map((t=>new e.P(t[0],t[1])))],(t<o.x||i>r.x||s<o.y||n>r.y)&&(g=e.bS(g,o.x,o.y,r.x,r.y)));}for(const e of g){s.reset(e,.25*t);let o=0;o=s.length<=.5*t?1:Math.ceil(s.paddedLength/f)+1;for(let e=0;e<o;e++){const r=e/Math.max(o-1,1),n=s.lerp(r),a=n.x+ci,l=n.y+ci;m.push(a,l,t,0);const c=a-t,d=l-t,_=a+t,p=l+t;if(F=F&&this.isOffscreen(c,d,_,p),O=O||this.isInsideGrid(c,d,_,p),!i&&this.grid.hitTestCircle(a,l,t,u)&&(M=!0,!h))return {circles:[],offscreen:!1,collisionDetected:M,occluded:!1}}}}return {circles:!h&&M||!O?[]:m,offscreen:F,collisionDetected:M,occluded:S.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return {};const i=[];let o=1/0,r=1/0,s=-1/0,n=-1/0;for(const a of t){const t=new e.P(a.x+ci,a.y+ci);o=Math.min(o,t.x),r=Math.min(r,t.y),s=Math.max(s,t.x),n=Math.max(n,t.y),i.push(t);}const a=this.grid.query(o,r,s,n).concat(this.ignoredGrid.query(o,r,s,n)),l={},c={};for(const t of a){const o=t.key;if(void 0===l[o.bucketInstanceId]&&(l[o.bucketInstanceId]={}),l[o.bucketInstanceId][o.featureIndex])continue;const r=[new e.P(t.x1,t.y1),new e.P(t.x2,t.y1),new e.P(t.x2,t.y2),new e.P(t.x1,t.y2)];e.bT(i,r)&&(l[o.bucketInstanceId][o.featureIndex]=!0,void 0===c[o.bucketInstanceId]&&(c[o.bucketInstanceId]=[]),c[o.bucketInstanceId].push(o.featureIndex));}return c}insertCollisionBox(e,t,i,o,r){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:o,collisionGroupID:r},e[0],e[1],e[2],e[3]);}insertCollisionCircles(e,t,i,o,r){const s=t?this.ignoredGrid:this.grid,n={bucketInstanceId:i,featureIndex:o,collisionGroupID:r};for(let t=0;t<e.length;t+=4)s.insertCircle(n,e[t],e[t+1],e[t+2]);}projectAndGetPerspectiveRatio(t,i,o,r,s,n,a){const l=[i,o,r,1];let c=!1;if(r||this.transform.pitch>0){if(e.aA(l,l,t),this.fogState&&s&&"globe"!==a.name){const t=function(t,i,o,r,s,n){const a=n.calculateFogTileMatrix(s),l=[i,o,r];return e.ad(l,l,a),Be(t,e.ae(l),n.pitch,n._fov)}(this.fogState,i,o,r,s.toUnwrapped(),this.transform);c=t>.9;}}else li(l,l,t);const h=l[3];return {point:new e.P((l[0]/h+1)/2*this.transform.width+ci,(-l[1]/h+1)/2*this.transform.height+ci),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/h*.5,1.5),signedDistanceFromCamera:h,occluded:n&&l[2]>h||c}}isOffscreen(e,t,i,o){return i<ci||e>=this.screenRightBoundary||o<ci||t>this.screenBottomBoundary}isInsideGrid(e,t,i,o){return i>=0&&e<this.gridRightBoundary&&o>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.bx([]);return e.bo(t,t,[-100,-100,0]),t}}class di{constructor(e,t,i,o){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):o&&i?1:0,this.placed=i;}isHidden(){return 0===this.opacity&&!this.placed}}class ui{constructor(e,t,i,o,r,s=!1){this.text=new di(e?e.text:null,t,i,r),this.icon=new di(e?e.icon:null,t,o,r),this.clipped=s;}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _i{constructor(e,t,i,o=!1){this.text=e,this.icon=t,this.skipFade=i,this.clipped=o;}}class pi{constructor(){this.invProjMatrix=e.bz(),this.viewportMatrix=e.bz(),this.circles=[];}}class fi{constructor(e,t,i,o,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=o,this.tileID=r;}}class mi{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={};}get(e){if(this.crossSourceCollisions)return {ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t};}return this.collisionGroups[e]}}function gi(t,i,o,r,s){const{horizontalAlign:n,verticalAlign:a}=e.bZ(t),l=-(n-.5)*i,c=-(a-.5)*o,h=e.b_(t,r);return new e.P(l+h[0]*s,c+h[1]*s)}function vi(t,i,o,r,s){const n=new e.P(t,i);return o&&n._rotate(r?s:-s),n}class yi{constructor(e,t,i,o,r,s){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new hi(this.transform,r),this.buildingIndex=s,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new mi(i),this.collisionCircleArrays={},this.prevPlacement=o,o&&(o.prevPlacement=void 0),this.placedOrientations={};}getBucketParts(t,i,o,r,s=1){const n=o.getBucket(i),a=o.latestFeatureIndex;if(!n||!a||i.fqid!==n.layerIds[0])return;const l=n.layers[0].layout,c=n.layers[0].paint,h=o.collisionBoxArray,d=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),u=o.tileSize/e.aj,_=o.tileID.toUnwrapped();this.transform.setProjection(n.projection);const p=(f=o.tileID,m=n.getProjection(),g=this.transform,m.name===this.projection?g.calculateProjMatrix(f.toUnwrapped()):jt(g,m,f));var f,m,g;const v="map"===l.get("text-pitch-alignment"),y="map"===l.get("text-rotation-alignment");i.compileFilter(i.options);const x=i.dynamicFilter(),b=i.dynamicFilterNeedsFeature(),w=this.transform.calculatePixelsToTileUnitsMatrix(o),T=Xt(p,o.tileID.canonical,v,y,this.transform,n.getProjection(),w);let E=null;const S=n.getProjection().createInversionMatrix(this.transform,o.tileID.canonical);if(v){const t=Yt(p,o.tileID.canonical,v,y,this.transform,n.getProjection(),w);E=e.az([],this.transform.labelPlaneMatrix,t);}let I=null;x&&o.latestFeatureIndex&&(I={unwrappedTileID:_,dynamicFilter:x,dynamicFilterNeedsFeature:b}),this.retainedQueryData[n.bucketInstanceId]=new fi(n.bucketInstanceId,a,n.sourceLayerIndex,n.index,o.tileID);const[C,R]=n.layers[0].layout.get("text-size-scale-range"),A=e.ay(s,C,R),[D,P]=l.get("icon-size-scale-range"),L=e.ay(s,D,P),z={bucket:n,layout:l,paint:c,posMatrix:p,invMatrix:S,mercatorCenter:[e.aD(this.transform.center.lng),e.aH(this.transform.center.lat)],textLabelPlaneMatrix:T,labelToScreenMatrix:E,clippingData:I,scale:d,textPixelRatio:u,holdingForFade:o.holdingForFade(),collisionBoxArray:h,partiallyEvaluatedTextSize:e.bH(n.textSizeData,this.transform.zoom,A),partiallyEvaluatedIconSize:e.bH(n.iconSizeData,this.transform.zoom,L),collisionGroup:this.collisionGroups.get(n.sourceID),latestFeatureIndex:o.latestFeatureIndex};if(r)for(const e of n.sortKeyRanges){const{sortKey:i,symbolInstanceStart:o,symbolInstanceEnd:r}=e;t.push({sortKey:i,symbolInstanceStart:o,symbolInstanceEnd:r,parameters:z});}else t.push({symbolInstanceStart:0,symbolInstanceEnd:n.symbolInstances.length,parameters:z});}attemptAnchorPlacement(e,t,i,o,r,s,n,a,l,c,h,d,u,_,p,f,m,g,v,y,x){const{textOffset0:b,textOffset1:w,crossTileID:T}=p,E=[b,w],S=gi(e,s,n,E,a),I=this.collisionIndex.placeCollisionBox(m,a,t,i,o,r,vi(S.x,S.y,l,c,this.transform.angle),_,h,d,u.predicate);if(v){const e=m.getSymbolInstanceIconSize(x,this.transform.zoom,p.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(m,e,v,i,o,r,vi(S.x,S.y,l,c,this.transform.angle),_,h,d,u.predicate).box.length)return}if(I.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[T]&&this.prevPlacement.placements[T]&&this.prevPlacement.placements[T].text&&(t=this.prevPlacement.variableOffsets[T].anchor),this.variableOffsets[T]={textOffset:E,width:s,height:n,anchor:e,textScale:a,prevAnchor:t},this.markUsedJustification(m,e,p,g),m.allowVerticalPlacement&&(this.markUsedOrientation(m,g,p),this.placedOrientations[T]=g),{shift:S,placedGlyphBoxes:I}}}placeLayerBucketPart(t,i,o,r,s=1){const{bucket:n,layout:a,paint:l,posMatrix:c,textLabelPlaneMatrix:h,labelToScreenMatrix:d,clippingData:u,textPixelRatio:_,mercatorCenter:p,invMatrix:f,holdingForFade:m,collisionBoxArray:g,partiallyEvaluatedTextSize:v,partiallyEvaluatedIconSize:y,collisionGroup:x,latestFeatureIndex:b}=t.parameters,w=a.get("text-optional"),T=a.get("icon-optional"),E=a.get("text-allow-overlap"),S=a.get("icon-allow-overlap"),I="map"===a.get("text-rotation-alignment"),C="map"===a.get("icon-rotation-alignment"),R="map"===a.get("text-pitch-alignment"),A=l.get("symbol-z-offset"),D="sea"===a.get("symbol-elevation-reference"),P=a.get("symbol-placement"),[L,z]=a.get("text-size-scale-range"),[M,O]=a.get("icon-size-scale-range"),F=e.ay(s,L,z),B=e.ay(s,M,O),k=a.get("text-variable-anchor"),N=I&&"point"!==P,U=C&&"point"!==P,j=k&&n.hasTextData(),G=n.hasIconTextFit()&&j&&n.hasIconData();this.transform.setProjection(n.projection);const V=j||N,q=U||G;let H=E&&(S||!n.hasIconData()||T),Z=S&&(E||!n.hasTextData()||w);const W=!A.isConstant();!n.collisionArrays&&g&&n.deserializeCollisionBoxes(g),o&&r&&n.updateCollisionDebugBuffers(this.transform.zoom,g,F,B);const $=(t,r,l)=>{const{crossTileID:g,numVerticalGlyphVertices:C}=t;let P=null;if(u&&u.dynamicFilterNeedsFeature||W){const e=this.retainedQueryData[n.bucketInstanceId];P=b.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0});}if(u&&!(0,u.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},P,this.retainedQueryData[n.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[g]=new _i(!1,!1,!1,!0),void i.add(g);const L=A.evaluate(P,{});if(i.has(g))return;if(m)return void(this.placements[g]=new _i(!1,!1,!1));let z=!1,M=!1,O=!0,F=!1,B=!1,N=null,U={box:null,offscreen:null,occluded:null},j={box:null},G=null,$=null,X=null,Y=0,K=0,J=0;l.textFeatureIndex?Y=l.textFeatureIndex:t.useRuntimeCollisionCircles&&(Y=t.featureIndex),l.verticalTextFeatureIndex&&(K=l.verticalTextFeatureIndex);const Q=e=>{e.tileID=this.retainedQueryData[n.bucketInstanceId].tileID;const i=this.transform.elevation;e.elevation=D?L:L+(i?i.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0),e.elevation+=t.zOffset;},ee=l.textBox;if(ee){Q(ee);const i=i=>{let o=e.bI.horizontal;if(n.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[g];e&&(this.placedOrientations[g]=e,o=e,this.markUsedOrientation(n,o,t));}return o},o=(t,i)=>{if(n.allowVerticalPlacement&&C>0&&l.verticalTextBox){for(const o of n.writingModes)if(o===e.bI.vertical?(U=i(),j=U):U=t(),U&&U.box&&U.box.length)break}else U=t();};if(k){let s=k;if(this.prevPlacement&&this.prevPlacement.variableOffsets[g]){const e=this.prevPlacement.variableOffsets[g];s.indexOf(e.anchor)>0&&(s=s.filter((t=>t!==e.anchor)),s.unshift(e.anchor));}const a=(e,i,o)=>{const a=n.getSymbolInstanceTextSize(v,t,this.transform.zoom,r),l=(e.x2-e.x1)*a+2*e.padding,h=(e.y2-e.y1)*a+2*e.padding,d=t.hasIconTextFit&&!S?i:null;d&&Q(d);let u={box:[],offscreen:!1,occluded:!1};const m=E?2*s.length:s.length;for(let i=0;i<m;++i){const m=this.attemptAnchorPlacement(s[i%s.length],e,p,f,V,l,h,a,I,R,_,c,x,i>=s.length,t,r,n,o,d,v,y);if(m&&(u=m.placedGlyphBoxes,u&&u.box&&u.box.length)){z=!0,N=m.shift;break}}return u};o((()=>a(ee,l.iconBox,e.bI.horizontal)),(()=>{const t=l.verticalTextBox;return t&&Q(t),n.allowVerticalPlacement&&!(U&&U.box&&U.box.length)&&C>0&&t?a(t,l.verticalIconBox,e.bI.vertical):{box:null,offscreen:null,occluded:null}})),U&&(z=U.box,O=U.offscreen,F=U.occluded);const h=i(!(!U||!U.box));if(!z&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[g];e&&(this.variableOffsets[g]=e,this.markUsedJustification(n,e.anchor,t,h));}}else {const a=(i,o)=>{const a=n.getSymbolInstanceTextSize(v,t,this.transform.zoom,r,s),l=this.collisionIndex.placeCollisionBox(n,a,i,p,f,V,new e.P(0,0),E,_,c,x.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(n,o,t),this.placedOrientations[g]=o),l};o((()=>a(ee,e.bI.horizontal)),(()=>{const t=l.verticalTextBox;return n.allowVerticalPlacement&&C>0&&t?(Q(t),a(t,e.bI.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(U&&U.box&&U.box.length));}}if(G=U,z=G&&G.box&&G.box.length>0,O=G&&G.offscreen,F=G&&G.occluded,t.useRuntimeCollisionCircles){const i=n.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),r=e.bJ(n.textSizeData,v,i),s=a.get("text-padding");$=this.collisionIndex.placeCollisionCircles(n,E,i,n.lineVertexArray,n.glyphOffsetArray,r,c,h,d,o,R,x.predicate,t.collisionCircleDiameter*r/e.bU,s,this.retainedQueryData[n.bucketInstanceId].tileID),z=E||$.circles.length>0&&!$.collisionDetected,O=O&&$.offscreen,F=$.occluded;}if(l.iconFeatureIndex&&(J=l.iconFeatureIndex),l.iconBox){const i=i=>{Q(i);const o=t.hasIconTextFit&&N?vi(N.x,N.y,I,R,this.transform.angle):new e.P(0,0),r=n.getSymbolInstanceIconSize(y,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(n,r,i,p,f,q,o,S,_,c,x.predicate)};j&&j.box&&j.box.length&&l.verticalIconBox?(X=i(l.verticalIconBox),M=X.box.length>0):(X=i(l.iconBox),M=X.box.length>0),O=O&&X.offscreen,B=X.occluded;}const te=w||0===t.numHorizontalGlyphVertices&&0===C,ie=T||0===t.numIconVertices;if(te||ie?ie?te||(M=M&&z):z=M&&z:M=z=M&&z,z&&G&&G.box&&this.collisionIndex.insertCollisionBox(G.box,a.get("text-ignore-placement"),n.bucketInstanceId,j&&j.box&&K?K:Y,x.ID),M&&X&&this.collisionIndex.insertCollisionBox(X.box,a.get("icon-ignore-placement"),n.bucketInstanceId,J,x.ID),$&&(z&&this.collisionIndex.insertCollisionCircles($.circles,a.get("text-ignore-placement"),n.bucketInstanceId,Y,x.ID),o)){const e=n.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new pi);for(let e=0;e<$.circles.length;e+=4)t.circles.push($.circles[e+0]),t.circles.push($.circles[e+1]),t.circles.push($.circles[e+2]),t.circles.push($.collisionDetected?1:0);}const oe="globe"!==n.projection.name;H=H&&(oe||!F),Z=Z&&(oe||!B),this.placements[g]=new _i(z||H,M||Z,O||n.justReloaded),i.add(g);},X=this.retainedQueryData[n.bucketInstanceId].tileID;if("offset"===n.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(n,X),"road"===n.elevationType&&n.updateRoadElevation(X.canonical),n.updateZOffset(),n.sortFeaturesByY){const t=n.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];$(n.symbolInstances.get(i),i,n.collisionArrays[i]);}n.hasAnyZOffset&&e.w(`${n.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`);}else if(n.hasAnyZOffset){const e=n.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const i=e[t];$(n.symbolInstances.get(i),i,n.collisionArrays[i]);}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)$(n.symbolInstances.get(e),e,n.collisionArrays[e]);if(o&&n.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[n.bucketInstanceId];e.bi(t.invProjMatrix,c),t.viewportMatrix=this.collisionIndex.getViewportMatrix();}n.justReloaded=!1;}markUsedJustification(t,i,o,r){const{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:n,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=o,h=e.b$(i),d=r===e.bI.vertical?l:"left"===h?s:"center"===h?n:"right"===h?a:-1;s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=d>=0&&s!==d?0:c),n>=0&&(t.text.placedSymbolArray.get(n).crossTileID=d>=0&&n!==d?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=d>=0&&a!==d?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=d>=0&&l!==d?0:c);}markUsedOrientation(t,i,o){const r=i===e.bI.horizontal||i===e.bI.horizontalOnly?i:0,s=i===e.bI.vertical?i:0,{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=o,h=t.text.placedSymbolArray;n>=0&&(h.get(n).placedOrientation=r),a>=0&&(h.get(a).placedOrientation=r),l>=0&&(h.get(l).placedOrientation=r),c>=0&&(h.get(c).placedOrientation=s);}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const o=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},s=t?t.variableOffsets:{},n=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],s=r[e];s?(this.opacities[e]=new ui(s,o,t.text,t.icon,null,t.clipped),i=i||t.text!==s.text.placed||t.icon!==s.icon.placed):(this.opacities[e]=new ui(null,o,t.text,t.icon,t.skipFade,t.clipped),i=i||t.text||t.icon);}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new ui(t,o,!1,!1);r.isHidden()||(this.opacities[e]=r,i=i||t.text.placed||t.icon.placed);}}for(const e in s)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=s[e]);for(const e in n)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=n[e]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e);}updateLayerOpacities(e,t,i,o){const r=new Set;for(const s of t){const t=s.getBucket(e);t&&s.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,r,s,s.collisionBoxArray,i,o,s.tileID,e.scope),"offset"===t.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(t,s.tileID),"road"===t.elevationType&&t.updateRoadElevation(s.tileID.canonical),t.updateZOffset());}}updateBucketOpacities(t,i,o,r,s,n,a,l){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0].layout,h=t.layers[0].paint,d=!!t.layers[0].dynamicFilter(),u=new ui(null,0,!1,!1,!0),_=c.get("text-allow-overlap"),p=c.get("icon-allow-overlap"),f=c.get("text-variable-anchor"),m="map"===c.get("text-rotation-alignment"),g="map"===c.get("text-pitch-alignment"),v=h.get("symbol-z-offset"),y="sea"===c.get("symbol-elevation-reference"),x=!v.isConstant(),b=new ui(null,0,_&&(p||!t.hasIconData()||c.get("icon-optional")),p&&(_||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const w=(e,t,i)=>{for(let o=0;o<t/4;o++)e.opacityVertexArray.emplaceBack(i);};let T=0;n&&t.updateReplacement(a,n);for(let r=0;r<t.symbolInstances.length;r++){const c=t.symbolInstances.get(r),{numHorizontalGlyphVertices:h,numVerticalGlyphVertices:_,crossTileID:p,numIconVertices:E,tileAnchorX:S,tileAnchorY:I}=c;let C=null;const R=this.retainedQueryData[t.bucketInstanceId];x&&c&&R&&(C=o.latestFeatureIndex.loadFeature({featureIndex:c.featureIndex,bucketIndex:R.bucketIndex,sourceLayerIndex:R.sourceLayerIndex,layoutVertexArrayOffset:0}));const A=v.evaluate(C,{}),D=i.has(p);let P=this.opacities[p];D?P=u:P||(P=b,this.opacities[p]=P),i.add(p);const L=h>0||_>0,z=E>0,M=this.placedOrientations[p],O=M===e.bI.vertical,F=M===e.bI.horizontal||M===e.bI.horizontalOnly;!L&&!z||P.isHidden()||T++;let B=!1;if((L||z)&&n)for(const i of t.activeReplacements){if(e.bV(i,s,e.bW.Symbol,l))continue;if(i.min.x>S||S>i.max.x||i.min.y>I||I>i.max.y)continue;const t=e.bX(S,I,a.canonical,i.footprintTileId.canonical);if(B=e.bY(t,i.footprint),B)break}if(L){const e=B?Ai:Ri(P.text);w(t.text,h,O?Ai:e),w(t.text,_,F?Ai:e);const i=P.text.isHidden(),{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:r,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:n}=c,a=t.text.placedSymbolArray,l=i||O?1:0;o>=0&&(a.get(o).hidden=l),r>=0&&(a.get(r).hidden=l),s>=0&&(a.get(s).hidden=l),n>=0&&(a.get(n).hidden=i||F?1:0);const d=this.variableOffsets[p];d&&this.markUsedJustification(t,d.anchor,c,M);const u=this.placedOrientations[p];u&&(this.markUsedJustification(t,"left",c,u),this.markUsedOrientation(t,u,c));}if(z){const e=B?Ai:Ri(P.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:o}=c,r=t.icon.placedSymbolArray,s=P.icon.isHidden()?1:0;i>=0&&(w(t.icon,E,O?Ai:e),r.get(i).hidden=s),o>=0&&(w(t.icon,c.numVerticalIconVertices,F?Ai:e),r.get(o).hidden=s);}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[r];if(i){let o=new e.P(0,0),r=!0;if(i.textBox||i.verticalTextBox){if(f){const e=this.variableOffsets[p];e?(o=gi(e.anchor,e.width,e.height,e.textOffset,e.textScale),m&&o._rotate(g?this.transform.angle:-this.transform.angle)):r=!1;}d&&(r=!P.clipped),i.textBox&&xi(t.textCollisionBox.collisionVertexArray,P.text.placed,!r||O,A,y,o.x,o.y),i.verticalTextBox&&xi(t.textCollisionBox.collisionVertexArray,P.text.placed,!r||F,A,y,o.x,o.y);}const s=r&&Boolean(!F&&i.verticalIconBox);i.iconBox&&xi(t.iconCollisionBox.collisionVertexArray,P.icon.placed,s,A,y,c.hasIconTextFit?o.x:0,c.hasIconTextFit?o.y:0),i.verticalIconBox&&xi(t.iconCollisionBox.collisionVertexArray,P.icon.placed,!s,A,y,c.hasIconTextFit?o.x:0,c.hasIconTextFit?o.y:0);}}}if(t.fullyClipped=0===T,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId];}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0;}}function xi(e,t,i,o,r,s,n){e.emplaceBack(t?1:0,i?1:0,s||0,n||0,o,r?1:0),e.emplaceBack(t?1:0,i?1:0,s||0,n||0,o,r?1:0),e.emplaceBack(t?1:0,i?1:0,s||0,n||0,o,r?1:0),e.emplaceBack(t?1:0,i?1:0,s||0,n||0,o,r?1:0);}const bi=Math.pow(2,25),wi=Math.pow(2,24),Ti=Math.pow(2,17),Ei=Math.pow(2,16),Si=Math.pow(2,9),Ii=Math.pow(2,8),Ci=Math.pow(2,1);function Ri(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*bi+t*wi+i*Ti+t*Ei+i*Si+t*Ii+i*Ci+t}const Ai=0;class Di{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[];}continuePlacement(e,t,i,o,r,s){const n=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(n,o,e[this._currentTileIndex],this._sortAcrossTiles,s),this._currentTileIndex++,r())return !0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,n.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<n.length;){const e=n[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart,s),this._currentPartIndex++,r())return !0}return !1}}class Pi{constructor(e,t,i,o,r,s,n,a,l){this.placement=new yi(e,r,s,n,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=o,this._done=!1;}isDone(){return this._done}continuePlacement(t,i,o,r,s){const n=e.q.now(),a=()=>{const t=e.q.now()-n;return !this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const n=i[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===n.type&&(!n.minzoom||n.minzoom<=l)&&(!n.maxzoom||n.maxzoom>l)){const t=n,i=t.layout.get("symbol-z-elevate"),l=void 0!==t.layout.get("symbol-sort-key").constantOr(1),c=t.layout.get("symbol-z-order"),h="viewport-y"===c||"auto"===c&&!("viewport-y"!==c&&l),d=t.layout.get("text-allow-overlap")||t.layout.get("icon-allow-overlap")||t.layout.get("text-ignore-placement")||t.layout.get("icon-ignore-placement"),u=h&&d,_=this._inProgressLayer=this._inProgressLayer||new Di(t),p=e.C(n.source,n.scope);if(_.continuePlacement(i||u?r[p]:o[p],this.placement,this._showCollisionBoxes,n,a,s))return;delete this._inProgressLayer;}this._currentPlacementIndex--;}this._done=!0;}commit(e){return this.placement.commit(e),this.placement}}const Li=512/e.aj/2;class zi{constructor(t,i,o){this.tileID=t,this.bucketInstanceId=o,this.index=new e.c0(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const r=t.canonical.x*e.aj,s=t.canonical.y*e.aj;for(let e=0;e<i.length;e++){const{key:t,crossTileID:o,tileAnchorX:n,tileAnchorY:a}=i.get(e),l=Math.floor((r+n)*Li),c=Math.floor((s+a)*Li);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(o);}this.index.finish();}findMatches(t,i,o){const r=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),s=Li/Math.pow(2,i.canonical.z-this.tileID.canonical.z),n=i.canonical.x*e.aj,a=i.canonical.y*e.aj;for(let e=0;e<t.length;e++){const i=t.get(e);if(i.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:h}=i,d=Math.floor((n+c)*s),u=Math.floor((a+h)*s),_=this.index.range(d-r,u-r,d+r,u+r).sort(((e,t)=>e-t));for(const e of _){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!o.has(t)){o.add(t),i.crossTileID=t;break}}}}}class Mi{constructor(){this.maxCrossTileID=0;}generate(){return ++this.maxCrossTileID}}class Oi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0;}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const i=this.indexes[e],o={};for(const e in i){const r=i[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),o[r.tileID.key]=r;}this.indexes[e]=o;}this.lng=e;}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return !1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key]);}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const o=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in r){const s=r[i];s.tileID.isChildOf(e)&&s.findMatches(t.symbolInstances,e,o);}else {const s=r[e.scaledTo(Number(i)).key];s&&s.findMatches(t.symbolInstances,e,o);}}for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances.get(e);r.crossTileID||(r.crossTileID=i.generate(),o.add(r.crossTileID));}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new zi(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i of t.crossTileIDs)this.usedCrossTileIDs[e].delete(i);}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const o=this.indexes[i];for(const r in o)e[o[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,o[r]),delete o[r],t=!0);}return t}}class Fi{constructor(){this.layerIndexes={},this.crossTileIDs=new Mi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={};}addLayer(e,t,i,o){let r=this.layerIndexes[e.fqid];void 0===r&&(r=this.layerIndexes[e.fqid]=new Oi);let s=!1;const n={};"globe"!==o.name&&r.handleWrapJump(i);for(const i of t){const t=i.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(i.tileID,t,this.crossTileIDs)&&(s=!0),n[t.bucketInstanceId]=!0);}return r.removeStaleBuckets(n)&&(s=!0),s}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0;}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e];}}const Bi=771;class ki{constructor(e,t,i,o){this.blendFunction=e,this.blendColor=t.toNonPremultipliedRenderColor(null),this.mask=i,this.blendEquation=o;}}ki.Replace=[1,0,1,0],ki.disabled=new ki(ki.Replace,e.am.transparent,[!1,!1,!1,!1]),ki.unblended=new ki(ki.Replace,e.am.transparent,[!0,!0,!0,!0]),ki.alphaBlended=new ki([1,Bi,1,Bi],e.am.transparent,[!0,!0,!0,!0]),ki.alphaBlendedNonPremultiplied=new ki([770,Bi,770,Bi],e.am.transparent,[!0,!0,!0,!0]),ki.multiply=new ki([774,0,774,0],e.am.transparent,[!0,!0,!0,!0]);class Ni{constructor(e,t,i){this.func=e,this.mask=t,this.range=i;}}Ni.ReadOnly=!1,Ni.ReadWrite=!0,Ni.disabled=new Ni(519,Ni.ReadOnly,[0,1]);const Ui=7680;class ji{constructor(e,t,i,o,r,s){this.test=e,this.ref=t,this.mask=i,this.fail=o,this.depthFail=r,this.pass=s;}}ji.disabled=new ji({func:519,mask:0},0,0,Ui,Ui,Ui);const Gi=1029,Vi=2305;class qi{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i;}}function Hi(t,i){const o=e.c6(t,3);e.c8(t,i),e.cc(t,3,o);}function Zi(t,i){const o=e.c3([]);return e.c4(o,o,-i),e.c5(o,o,-t),o}function Wi(t,i){const o=[t[0],t[1],0],r=[i[0],i[1],0];if(e.ae(o)>=1e-15){const t=e.au([],o);e.c1(r,t,e.bG(r,t)),i[0]=r[0],i[1]=r[1];}const s=e.bF([],i,t);if(e.c2(s)<1e-15)return null;const n=Math.atan2(-s[1],s[0]);return Zi(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),n)}qi.disabled=new qi(!1,Gi,Vi),qi.backCCW=new qi(!0,Gi,Vi),qi.backCW=new qi(!0,Gi,2304),qi.frontCW=new qi(!0,1028,2304),qi.frontCCW=new qi(!0,1028,Vi);class $i{constructor(e,t){this.position=e,this.orientation=t;}get position(){return this._position}set position(t){if(t){const i=t instanceof e.ac?t:new e.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.bQ(i.x,0,1)),this._position=i;}else this._position=null;}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const o=this.position,r=this._elevation?this._elevation.getAtPointOrZero(e.ac.fromLngLat(t)):0,s=e.ac.fromLngLat(t,r),n=[s.x-o.x,s.y-o.y,s.z-o.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Wi(n,i);}setPitchBearing(t,i){this.orientation=Zi(e.al(t),e.al(-i));}}class Xi{constructor(t,i){this._transform=e.bx([]),this.orientation=i,this.position=t;}get mercatorPosition(){const t=this.position;return new e.ac(t[0],t[1],t[2])}get position(){const t=e.c6(this._transform,3);return [t[0],t[1],t[2]]}set position(t){var i;t&&e.cc(this._transform,3,[(i=t)[0],i[1],i[2],1]);}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.c3([]),t&&Hi(this._transform,this._orientation);}getPitchBearing(){const e=this.forward(),t=this.right();return {bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=Zi(e,t),Hi(this._transform,this._orientation);}forward(){const t=e.c6(this._transform,2);return [-t[0],-t[1],-t[2]]}up(){const t=e.c6(this._transform,1);return [-t[0],-t[1],-t[2]]}right(){const t=e.c6(this._transform,0);return [t[0],t[1],t[2]]}getCameraToWorld(t,i){const o=new Float64Array(16);return e.bi(o,this.getWorldToCamera(t,i)),o}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,o){const r=this.position;e.c1(r,r,-t);const s=new Float64Array(16);return e.bn(s,[o,o,o]),e.bo(s,s,r),s[10]*=i,s}getWorldToCamera(t,i){const o=new Float64Array(16),r=new Float64Array(4),s=this.position;return e.c7(r,this._orientation),e.c1(s,s,-t),e.c8(o,r),e.bo(o,o,s),o[1]*=-1,o[5]*=-1,o[9]*=-1,o[13]*=-1,o[8]*=i,o[9]*=i,o[10]*=i,o[11]*=i,o}getCameraToClipPerspective(t,i,o,r){const s=new Float64Array(16);return e.c9(s,t,i,o,r),s}getCameraToClipOrthographic(t,i,o,r,s,n){const a=new Float64Array(16);return e.ca(a,t,i,o,r,s,n),a}getDistanceToElevation(t,i=!1){const o=0===t?0:e.cb(t,i?e.aY(this.position[1]):this.position[1]),r=this.forward();return (o-this.position[2])/r[2]}clone(){return new Xi([...this.position],[...this.orientation])}}const Yi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Ki{constructor(e=0,t=0,i=0,o=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=o;}interpolate(t,i,o){return null!=i.top&&null!=t.top&&(this.top=e.ai(t.top,i.top,o)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.ai(t.bottom,i.bottom,o)),null!=i.left&&null!=t.left&&(this.left=e.ai(t.left,i.left,o)),null!=i.right&&null!=t.right&&(this.right=e.ai(t.right,i.right,o)),this}getCenter(t,i){const o=e.ay((this.left+t-this.right)/2,0,t),r=e.ay((this.top+i-this.bottom)/2,0,i);return new e.P(o,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ki(this.top,this.bottom,this.left,this.right)}toJSON(){return {top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ji=15;class Qi{constructor(t,i,o,r,s,n,a){this.tileSize=512,this._renderWorldCopies=void 0===s||s,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=o??0,this._maxPitch=r??60,this.setProjection(n),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ki,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Xi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1;}clone(){const e=new Qi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e._allowWorldUnderZoom=this._allowWorldUnderZoom,e}get isOrthographic(){return "globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<Ji}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices());}get depthOcclusionForSymbolsAndCircles(){return "globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e,t=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(t),this._calcMatrices();}getProjection(){return e.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=e.cj(this.projectionOptions);const o=this.getProjection(),r=!e.bv(i,o);return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.cj({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e));}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e));}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e));}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e));}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e;}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bQ(this.rotation,-180,180)}set bearing(e){this.rotation=e;}get rotation(){return -this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=e.ck(),e.cl(this.rotationMatrix,this.rotationMatrix,this.angle));}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices());}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.al(t),this._calcMatrices());}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={};}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices());}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom;}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e);}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom();}_updateSeaLevelZoom(){if(void 0===this._centerAltitudeValidForExaggeration)return;const e=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(e);}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],o=this.horizonLineFromTop();let r=0,s=0;for(let n=0;n<i.length;n++){const a=new e.P(i[n][0]*this.width,o+i[n][1]*(this.height-o)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);r+=l[3]*c,s+=c;}return 0===s?NaN:r/s}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices());}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,o=this._mercatorZfromZoom(e),r=this._mercatorZfromZoom(this._maxZoom),s=Math.max(o-i,r);this._setZoom(this._zoomFromMercatorZ(s));}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices());}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let o;o=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const r=e.ae(e.at([],this._camera.position,o));return e.ay(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.cm(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const o=[t.position.x,t.position.y,t.position.z];e.cn(o,this._camera.position)||(this._setCameraPosition(o),i=!0);}i&&(this._updateStateFromCamera(),this.recenterOnTerrain());}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new $i;return i.position=new e.ac(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.co(t))return !1;e.cp(t,t);const i=e.cq([],[0,0,-1],t),o=e.cq([],[0,-1,0],t);if(o[2]<0)return !1;const r=Wi(i,o);return !!r&&(this._camera.orientation=r,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,o=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;t[2]=e.ay(t[2],r/o,r/i),this._camera.position=t;}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices();}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.cr(0,t)];if(this.renderWorldCopies){const o=this.pointCoordinate(new e.P(0,0)),r=this.pointCoordinate(new e.P(this.width,0)),s=this.pointCoordinate(new e.P(this.width,this.height)),n=this.pointCoordinate(new e.P(0,this.height)),a=Math.floor(Math.min(o.x,r.x,s.x,n.x)),l=Math.floor(Math.max(o.x,r.x,s.x,n.x)),c=1;for(let o=a-c;o<=l+c;o++)0!==o&&i.push(new e.cr(o,t));}return i}isLODDisabled(e){return (!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,i,o){let r=[];const s=null!=o,n=!s;if(n&&this.zoom<i)return r;if(s&&0===o[0]&&0===o[1])return r;const a=new Set,l=(t,i,o,s,n)=>{const l=e.cV(i,t,o,s,n);a.has(l)||(r.push(new e.aM(t,i,o,s,n)),a.add(l));};for(let e=0;e<t.length;e++){const r=t[e];if(n&&r.canonical.z!==i)continue;const a=r.canonical,c=r.overscaledZ,h=r.wrap,d=1<<a.z,u=a.x+1<d,_=a.x>0,p=a.y+1<d,f=a.y>0,m=r.wrap-(_?0:1),g=r.wrap+(u?0:1),v=_?a.x-1:d-1,y=u?a.x+1:0;if(s)o[0]<0?(l(c,g,a.z,y,a.y),o[1]<0&&p&&(l(c,h,a.z,a.x,a.y+1),l(c,g,a.z,y,a.y+1)),o[1]>0&&f&&(l(c,h,a.z,a.x,a.y-1),l(c,g,a.z,y,a.y-1))):o[0]>0?(l(c,m,a.z,v,a.y),o[1]<0&&p&&(l(c,h,a.z,a.x,a.y+1),l(c,m,a.z,v,a.y+1)),o[1]>0&&f&&(l(c,h,a.z,a.x,a.y-1),l(c,m,a.z,v,a.y-1))):o[1]<0&&p?l(c,h,a.z,a.x,a.y+1):f&&l(c,h,a.z,a.x,a.y-1);else {const e=r.visibleQuadrants;1&e&&(l(c,m,a.z,v,a.y),f&&(l(c,h,a.z,a.x,a.y-1),l(c,m,a.z,v,a.y-1))),2&e&&(l(c,g,a.z,y,a.y),f&&(l(c,h,a.z,a.x,a.y-1),l(c,g,a.z,y,a.y-1))),4&e&&(l(c,m,a.z,v,a.y),p&&(l(c,h,a.z,a.x,a.y+1),l(c,m,a.z,v,a.y+1))),8&e&&(l(c,g,a.z,y,a.y),p&&(l(c,h,a.z,a.x,a.y+1),l(c,g,a.z,y,a.y+1)));}}const c=[];for(const e of r)r.some((t=>e.isChildOf(t)))||c.push(e);if(r=c.filter((e=>!t.some((t=>!!(e.overscaledZ<i&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))))),n){const e=1<<i,t="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),o=[e*t.x,e*t.y],s=4,n=s*s;r=r.filter((e=>{const t=e.canonical.x+.5-o[0],i=e.canonical.y+.5-o[1];return t*t+i*i<n}));}return r}extendTileCoverToNearPlane(t,i,o){const r=[],s=new Set;for(const e of t)s.add(e.key);const n=(t,i,o,n,a)=>{const l=e.cV(i,t,o,n,a);s.has(l)||(r.push(new e.aM(t,i,o,n,a)),s.add(l));},a=t.reduce(((e,t)=>Math.max(e,t.overscaledZ)),o),l=1<<o,c=[new e.P(0,0),new e.P(e.aj,0),new e.P(e.aj,e.aj),new e.P(0,e.aj)],h=new e.P(0,0),d=new e.P(0,0),u=(t,i)=>{const r=Math.floor(t[0]),s=Math.floor(t[1]),u=(t[0]-r)*e.aj,_=(t[1]-s)*e.aj,p=Math.floor(i[0]),f=Math.floor(i[1]),m=(i[0]-p)*e.aj,g=(i[1]-f)*e.aj;for(let t=-1;t<=1;t++){const i=r+t;if(!(i<0||i>=l)){h.x=u-t*e.aj,d.x=m-(i-p)*e.aj;for(let t=-1;t<=1;t++){const r=s+t;h.y=_-t*e.aj,d.y=g-(r-f)*e.aj,e.cW(h,d,c)&&n(a,0,o,i,r);}}}},_=i.points,p=_[e.cs],f=_[e.ct],m=this._projectToGround(p,_[e.cu]),g=this._projectToGround(f,_[e.cv]);return u(p,m),u(f,g),r}_projectToGround(t,i){return e.cw(e.cx(),t,i,t[2]/(t[2]-i[2]))}coveringTiles(t){let i=this.coveringZoomLevel(t);const o=i,r=this.elevation&&this.elevation.exaggeration(),s=r&&!t.isTerrainDEM,n="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return [];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<i,h=[c*a.x,c*a.y,0],d="globe"===this.projection.name,u=!d,_=e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,u),p=d?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=c*e.cb(1,this.center.lat),m=this._camera.position[2]/e.cb(1,this.center.lat),g=[c*p.x,c*p.y,m*(u?1:f)],v=d||r,y=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),x=this.isLODDisabled(!0)?i:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude;}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,T=this.projection.isReprojectedInTileSpace?e.cz(this):1,E=t=>{const i=1/4e4,o=new e.ac(t.x+i,t.y,t.z),r=new e.ac(t.x,t.y+i,t.z),s=t.toLngLat(),n=o.toLngLat(),a=r.toLngLat(),l=this.locationCoordinate(s),c=this.locationCoordinate(n),h=this.locationCoordinate(a),d=Math.hypot(c.x-l.x,c.y-l.y),u=Math.hypot(h.x-l.x,h.y-l.y);return Math.sqrt(d*u)*T/i},S=t=>{const i=b,o=w;return {aabb:e.cC(this,c,0,0,0,t,o,i,this.projection),zoom:0,x:0,y:0,minZ:o,maxZ:i,wrap:t,fullyVisible:!1}},I=[];let C=[];const R=i,A=t.reparseOverscaled?o:i,D=(m-this._centerAltitude)*f,P=e=>{if(!this._elevation||!e.tileID||!n)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=z(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude));},L=(e,t)=>{if(.707*t<e)return 1;const i=t/e;return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)},z=t=>{if(t.zoom<x)return !0;if(t.zoom===R)return !1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(g),r=t.aabb.distanceY(g);let a=D,c=1;if(d){a=t.aabb.distanceZ(g);const i=Math.pow(2,t.zoom),o=e.aY((t.y+1)/i),r=e.aY(t.y/i),s=Math.min(Math.max(l,o),r),n=e.c_(s)/e.c_(l);if(c=s===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,n/this._mercatorScaleRatio),this.zoom<=e.cX&&t.zoom===R-1&&n>=.9)return !0}else if(s&&(a=t.aabb.distanceZ(g)*f),this.projection.isReprojectedInTileSpace&&o<=5){const i=Math.pow(2,t.zoom),o=E(new e.ac((t.x+.5)/i,(t.y+.5)/i));c=o>.85?1:o;}if(!n){const e=Math.sqrt(i*i+r*r+a*a);let o=(1<<R-t.zoom)*y*c;return o*=L(Math.max(a,D),e),e<o}let u=Number.MAX_VALUE,_=0;const p=t.aabb.getCorners(),m=[];for(const t of p){e.at(m,t,g),d||(s?m[2]*=f:m[2]=D);const i=e.bG(m,this._camera.forward());i<u&&(u=i,_=Math.abs(m[2]));}let v=(1<<R-t.zoom)*y*c;if(v*=L(Math.max(_,D),u),u<v)return !0;const b=t.aabb.closestPoint(h);return b[0]===h[0]&&b[1]===h[1]};if(this.renderWorldCopies)for(let e=1;e<=3;e++)I.push(S(-e)),I.push(S(e));for(I.push(S(0));I.length>0;){const o=I.pop(),r=o.x,a=o.y;let l=o.fullyVisible;const u=()=>"globe"===this.projection.name&&(0===o.y||o.y===(1<<o.zoom)-1);if(!l){let t=v?o.aabb.intersects(_):o.aabb.intersectsFlat(_);if(0===t&&u()){const i=new e.cA(o.zoom,r,a);t=e.cB(this,c,i,!0).intersects(_);}if(0===t)continue;l=2===t;}if(o.zoom!==R&&z(o))for(let t=0;t<4;t++){const i=(r<<1)+t%2,h=(a<<1)+(t>>1),u={aabb:n?o.aabb.quadrant(t):e.cC(this,c,o.zoom+1,i,h,o.wrap,o.minZ,o.maxZ,this.projection),zoom:o.zoom+1,x:i,y:h,wrap:o.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:o.minZ,maxZ:o.maxZ};s&&!d&&(u.tileID=new e.aM(o.zoom+1===R?A:o.zoom+1,o.wrap,o.zoom+1,i,h),P(u)),I.push(u);}else {const s=o.zoom===R?A:o.zoom;if(t.minzoom&&t.minzoom>s)continue;let n=0;if(!l){let i=v?o.aabb.intersectsPrecise(_):o.aabb.intersectsPreciseFlat(_);if(0===i&&u()){const t=new e.cA(o.zoom,r,a);i=e.cB(this,c,t,!0).intersectsPrecise(_);}if(0===i)continue;if(t.calculateQuadrantVisibility)if(_.containsPoint(o.aabb.center))n=15;else for(let e=0;e<4;e++)0!==o.aabb.quadrant(e).intersects(_)&&(n|=1<<e);}const d=h[0]-(.5+r+(o.wrap<<o.zoom))*(1<<i-o.zoom),p=h[1]-.5-a,f=o.tileID?o.tileID:new e.aM(s,o.wrap,o.zoom,r,a);t.calculateQuadrantVisibility&&(f.visibleQuadrants=n),C.push({tileID:f,distanceSq:d*d+p*p});}}if(this.fogCullDistSq){const i=this.fogCullDistSq,o=this.horizonLineFromTop();C=C.filter((r=>{const s=[0,0,0,1],n=[e.aj,e.aj,0,1],a=this.calculateFogTileMatrix(r.tileID.toUnwrapped());e.aA(s,s,a),e.aA(n,n,a);const l=e.cD([],s,n),c=e.cE([],s,n),h=e.cY(l,c);if(0===h)return !0;let d=!1;const u=this._elevation;if(u&&h>i&&0!==o){const i=this.calculateProjMatrix(r.tileID.toUnwrapped());let s;t.isTerrainDEM||(s=u.getMinMaxForTile(r.tileID)),s||(s={min:w,max:b});const n=e.cF(this.rotation),a=[n[0]*e.aj,n[1]*e.aj,s.max];e.ad(a,a,i),d=(1-a[1])*this.height*.5<o;}return h<i||d}));}return C.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices();}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.ay(t.lat,-e.cG,e.cG),o=this.projection.project(t.lng,i);return new e.P(o.x*this.worldSize,o.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let o,r;const s=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;o=(i.x-s.x)/e,r=(i.y-s.y)/e;}else {const e=this.pointCoordinate(i),t=this.pointCoordinate(s);o=e.x-t.x,r=e.y-t.y;}const n=this.locationCoordinate(t);this.setLocation(new e.ac(n.x-o,n.y-r));}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap());}locationPoint(e,t){return this.projection.locationPoint(this,e,t)}locationPoint3D(e,t){return this.projection.locationPoint(this,e,t,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e,t){return this.coordinateLocation(this.pointCoordinate3D(e,t))}locationCoordinate(t,i){const o=i?e.cb(i,t.lat):void 0,r=this.projection.project(t.lng,t.lat);return new e.ac(r.x,r.y,o)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const o=null!=i?i:this._centerAltitude,r=[t.x,t.y,0,1],s=[t.x,t.y,1,1];e.aA(r,r,this.pixelMatrixInverse),e.aA(s,s,this.pixelMatrixInverse);const n=s[3];e.cH(r,r,1/r[3]),e.cH(s,s,1/n);const a=r[2],l=s[2];return {p0:r,p1:s,t:a===l?0:(o-a)/(l-a)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],o=[t.x,t.y,1,1];return e.aA(i,i,this.pixelMatrixInverse),e.aA(o,o,this.pixelMatrixInverse),e.cH(i,i,1/i[3]),e.cH(o,o,1/o[3]),i[2]=e.cb(i[2],this._center.lat)*this.worldSize,o[2]=e.cb(o[2],this._center.lat)*this.worldSize,e.cH(i,i,1/this.worldSize),e.cH(o,o,1/this.worldSize),new e.av([i[0],i[1],i[2]],e.au([],e.at([],o,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:o,t:r}=t,s=e.cb(i[2],this._center.lat),n=e.cb(o[2],this._center.lat);return new e.ac(e.ai(i[0],o[0],r)/this.worldSize,e.ai(i[1],o[1],r)/this.worldSize,e.ai(s,n,r))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t,i){if(!this.elevation)return this.pointCoordinate(t,i);let o=this.projection.pointCoordinate3D(this,t.x,t.y);if(o)return new e.ac(o[0],o[1],o[2]);let r=0,s=this.horizonLineFromTop();if(t.y>s)return this.pointCoordinate(t,i);const n=.02*s,a=t.clone();for(let t=0;t<10&&s-r>n;t++){a.y=e.ai(r,s,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(s=a.y,o=t):r=a.y;}return o?new e.ac(o[0],o[1],o[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return !1;if(this.elevation||this.zoom>=e.cI)return !this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const o=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,r=[t.x*this.worldSize,t.y*this.worldSize,o+t.toAltitude(),1];return e.aA(r,r,this.pixelMatrix),r[3]>0?new e.P(r[0]/r[3],r[1]/r[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,s=this.pointLocation3D(new e.P(i,t)),n=this.pointLocation3D(new e.P(r,t)),a=this.pointLocation3D(new e.P(r,o)),l=this.pointLocation3D(new e.P(i,o));let c=Math.min(s.lng,n.lng,a.lng,l.lng),h=Math.max(s.lng,n.lng,a.lng,l.lng),d=Math.min(s.lat,n.lat,a.lat,l.lat),u=Math.max(s.lat,n.lat,a.lat,l.lat);const _=Math.pow(2,-this.zoom)/16*270,p="globe"===this.projection.name?1:4,f=(t,i,o,r,s)=>{const n=(t+o)/2,a=(i+r)/2,l=new e.P(n,a),{lng:m,lat:g}=this.pointLocation3D(l),v=Math.max(0,c-m,d-g,m-h,g-u);c=Math.min(c,m),h=Math.max(h,m),d=Math.min(d,g),u=Math.max(u,g),(s<p||v>_)&&(f(t,i,n,a,s+1),f(n,a,o,r,s+1));};if(f(i,t,r,t,1),f(r,t,r,o,1),f(r,o,i,o,1),f(i,o,i,t,1),"globe"===this.projection.name){const[t,i]=e.cJ(this);t?(u=90,h=180,c=-180):i&&(d=-90,h=180,c=-180);}return new e.aG(new e.ci(c,d),new e.ci(h,u))}_getBoundsRectangular(t,i){const{top:o,left:r}=this._edgeInsets,s=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,a=new e.P(r,o),l=new e.P(n,o),c=new e.P(n,s),h=new e.P(r,s);let d=this.pointCoordinate(a,t),u=this.pointCoordinate(l,t);const _=this.pointCoordinate(c,i),p=this.pointCoordinate(h,i),f=(e,t)=>(t.y-e.y)/(t.x-e.x);return d.y>1&&u.y>=0?d=new e.ac((1-p.y)/f(p,d)+p.x,1):d.y<0&&u.y<=1&&(d=new e.ac(-p.y/f(p,d)+p.x,0)),u.y>1&&d.y>=0?u=new e.ac((1-_.y)/f(_,u)+_.x,1):u.y<0&&d.y<=1&&(u=new e.ac(-_.y/f(_,u)+_.x,0)),(new e.aG).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(_))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0]);}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return "mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.cG,this.maxLat=e.cG,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.aD(this.minLng)*this.tileSize,this.worldMaxX=e.aD(this.maxLng)*this.tileSize,this.worldMinY=e.aH(this.maxLat)*this.tileSize,this.worldMaxY=e.aH(this.minLat)*this.tileSize,this._constrain();}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,o=this._distanceTileDataCache;if(o[i])return o[i];const r=t.canonical,s=1/this.height,n=this.cameraWorldSize,a=n/this.zoomScale(r.z),l=(r.x+Math.pow(2,r.z)*t.wrap)*a,c=r.y*a,h=this.point;h.x*=n/this.worldSize,h.y*=n/this.worldSize;const d=this.angle,u=Math.sin(-d),_=-Math.cos(-d);return o[i]={bearing:[u,_],center:[(h.x-l)*s,(h.y-c)*s],scale:a/e.aj*s},o[i]}calculateFogTileMatrix(t){const i=t.key,o=this._fogTileMatrixCache;if(o[i])return o[i];const r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.az(r,this.worldToFogMatrix,r),o[i]=new Float32Array(r),o[i]}calculateProjMatrix(t,i=!1,o=!1){const r=t.key;let s;if(s=o?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,s[r])return s[r];const n=this.calculatePosMatrix(t,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,e.az(n,a,n),s[r]=new Float32Array(n),s[r]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,o=this._pixelsToTileUnitsCache;if(o[i])return o[i];const r=e.cK(t,this);return o[i]=r,o[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,i=e.bn([],[t,t,t]);return e.az(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.cb(1,this._center.lat)*this.worldSize,o=this._computeCameraPosition(i),r=this._camera.forward(),s=e.cb(1,this._center.lat);o[2]/=s,r[2]/=s,e.au(r,r);const n=t.raycast(o,r,t.exaggeration());if(n){const t=e.bE([],o,r,n),i=new e.ac(t[0],t[1],e.cb(t[2],e.aY(t[1]))),a=(i.z+e.ae([i.x-o[0],i.y-o[1],i.z-o[2]*s]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices();}}_constrainCamera(t=!1){if(!this._elevation)return;const i=this._elevation,o=e.cb(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(o),s=i.getAtPointOrZero(new e.ac(...r)),n=this.pixelsPerMeter/this.worldSize*s,a=this._minimumHeightOverTerrain(),l=r[2]-n;if(l<=a)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[r[0],r[1],t.z-r[2]],o=e.ae(i);i[2]-=(a-l)/this._pixelsPerMercatorPixel;const s=e.ae(i);if(0===s)return;e.c1(i,i,o/s*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],t.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera();}else this._isCameraConstrained=!0;}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const i=this.center;return i.lat=e.ay(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(i.lng=e.ay(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:o,y:r}=this.point;let s=0,n=o,a=r;const l=this.width/2,c=this.height/2,h=this.worldMinY*this.scale,d=this.worldMaxY*this.scale;if(r-c<h&&(a=h+c),r+c>d&&(a=d-c),d-h<this.height&&(s=Math.max(s,this.height/(d-h)),a=(d+h)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,i=this.worldSize/2-(e+t)/2;n=(o+i+this.worldSize)%this.worldSize-i,n-l<e&&(n=e+l),n+l>t&&(n=t-l),t-e<this.width&&(s=Math.max(s,this.width/(t-e)),n=(t+e)/2);}n===o&&a===r||this._allowWorldUnderZoom||(this.center=this.unproject(new e.P(n,a))),s&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(s)),this._constrainCamera(),this._unmodified=i,this._constraining=!1;}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i="globe"===this.projection.name,o=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.cb(1,this.center.lat)/e.cb(1,e.c$));const r=e.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const s="meters"===this.projection.zAxisUnit?o:1,n=this._camera.getWorldToCamera(this.worldSize,s);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let i=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),o=i*this.aspect,r=-o,s=-i;o-=t.x,r-=t.x,i+=t.y,s+=t.y,a=this._camera.getCameraToClipOrthographic(r,o,s,i,this._nearZ,this._farZ),((t,i,o,r)=>{for(let s=0;s<16;s++)t[s]=e.ai(i[s],o[s],r);})(a,a,l,e.cZ(this.pitch>=Ji?1:this.pitch/Ji));}else a=l;const c=e.cM([],l,n);let h=e.cM([],a,n);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.bx([]);e.bo(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.az(i,i,e.cN(this)),e.bo(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.az(h,h,i),e.az(c,c,i),this.inverseAdjustmentMatrix=e.cO(this);}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.cP([],h,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=h,this.invProjMatrix=e.bi(new Float64Array(16),this.projMatrix),i){const i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=2*-t.x/this.width,i[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.cM([],i,n);}else this.expandedFarZProjMatrix=this.projMatrix;const d=e.bi([],a);this.frustumCorners=e.cQ.fromInvProjectionMatrix(d,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const u=new Float32Array(16);e.bx(u),e.cP(u,u,[1,-1,1]),e.cR(u,u,this._pitch),e.by(u,u,this.angle);const _=e.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.bw(_);const p=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;_[8]=2*-t.x/this.width,_[9]=2*(t.y+p)/this.height,this.skyboxMatrix=e.az(u,_,u);const f=this.point,m=f.x,g=f.y,v=this.width%2/2,y=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),w=m-Math.round(m)+x*v+b*y,T=g-Math.round(g)+x*y+b*v,E=new Float64Array(h);if(e.bo(E,E,[w>.5?w-1:w,T>.5?T-1:T,0]),this.alignedProjMatrix=E,h=e.bz(),e.cP(h,h,[this.width/2,-this.height/2,1]),e.bo(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=e.bz(),e.cP(h,h,[1,-1,1]),e.bo(h,h,[-1,-1,0]),e.cP(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h,this.pixelMatrix=e.az(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},h=e.bi(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=h,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.cS(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.ad(t,t,n),this.globeRadius=this.worldSize/2/Math.PI-1;}else this.globeMatrix=h;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={};}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,o=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,s=[t,t,i];e.c1(s,s,r),e.c1(o,o,-1),e.cT(o,o,s);const n=e.bz();e.bo(n,n,o),e.cP(n,n,s),this.mercatorFogMatrix=n,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,r);}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),o=this.point,r=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return [o.x/this.worldSize-i[0]*r,o.y/this.worldSize-i[1]*r,e/this.worldSize*this._centerAltitude-i[2]*r]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition());}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),o=this._camera.position[2],r=t[2];let s=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(s=Math.min((i-o)/r,1)),this._camera.position=e.bE([],this._camera.position,t,s),this._updateStateFromCamera();}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:o,bearing:r}=this._camera.getPitchBearing(),s=e.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,n=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.al(this._maxPitch)),a=Math.max((t[2]-s)/Math.cos(o),n),l=this._zoomFromMercatorZ(a);e.bE(t,t,i,a),this._pitch=e.ay(o,e.al(this.minPitch),e.al(this.maxPitch)),this.angle=e.bQ(r,-Math.PI,Math.PI),this._setZoom(e.ay(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices();}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,e)*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,o=e.cI,r=0,s=1/0;for(;o-i>1e-6&&o>i;){const e=i+.5*(o-i),n=this.tileSize*Math.pow(2,e),a=this.getCameraToCenterDistance(this.projection,e,n),l=this.scaleZoom(a/(Math.max(0,t)*this.tileSize)),c=Math.abs(e-l);c<s&&(s=c,r=e),e<l?i=e:o=e;}return r}_terrainEnabled(){return !(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const o=Math.min(t.x,i.x),r=Math.max(t.x,i.x),s=Math.min(t.y,i.y),n=Math.max(t.y,i.y);if(s<this.horizonLineFromTop(!1))return !0;if("mercator"!==this.projection.name)return !1;const a=[new e.P(o,s),new e.P(r,n),new e.P(o,n),new e.P(r,s)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return !0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return !0}return !1}isHorizonVisible(){return this.pitch+e.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,i){const o=e.ae(e.at([],this._camera.position,t)),r=this._zoomFromMercatorZ(o)+i;return o-this._mercatorZfromZoom(r)}getCameraPoint(){if("globe"===this.projection.name){const t=function([t,i,o],r){const s=[t,i,o,1];e.aA(s,s,r);const n=s[3]=Math.max(s[3],1e-6);return s[0]/=n,s[1]/=n,s[2]/=n,s}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t,i=this.zoom,o=this.worldSize){const r=e.cL(t,i,this.width,this.height,1024),s=t.pixelSpaceConversion(this.center.lat,o,r);let n=.5/Math.tan(.5*this._fov)*this.height*s;return this.isOrthographic&&(n=e.ai(1,n,e.cZ(this.pitch>=Ji?1:this.pitch/Ji))),n}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return "globe"===this.projection.name&&e.az(t,t,this.globeMatrix),t}getFrustum(t){return e.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const eo=(t,i)=>{if(i>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),i<=0||t.terrain)return {shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=t.transform,r=Math.max(Math.abs(o._zoom-(t.minCutoffZoom-1)),1),s=o.isLODDisabled(!1)?e.af(60,45,o.pitch):e.af(30,15,o.pitch),n=o._farZ-o._nearZ,a=i*o.height,l=((1-(c=s))*o.cameraToCenterDistance+c*(o._farZ+a))*r;var c;return {shouldRenderCutoff:s<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(l-o._nearZ)/n,(l-a-o._nearZ)/n]}}},to={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class io{constructor(e,t){this.aabb=e,this.lastCascade=t;}}class oo{add(e,t){const i=this.receivers[e.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],t.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],t.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],t.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],t.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],t.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],t.max[2])):this.receivers[e.key]=new io(t,null);}clear(){this.receivers={};}get(e){return this.receivers[e.key]}computeRequiredCascades(t,i,o){const r=e.d6.fromPoints(t.points);let s=0;for(const t in this.receivers){const n=this.receivers[t];if(!n)continue;if(!r.intersectsAabb(n.aabb))continue;n.aabb.min=r.closestPoint(n.aabb.min),n.aabb.max=r.closestPoint(n.aabb.max);const a=n.aabb.getCorners();for(let t=0;t<o.length;t++){let r=!0;for(const s of a){const n=[s[0]*i,s[1]*i,s[2]];if(e.ad(n,n,o[t].matrix),n[0]<-1||n[0]>1||n[1]<-1||n[1]>1){r=!1;break}}if(n.lastCascade=t,s=Math.max(s,t),r)break}}return s+1}}class ro{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new oo,this._depthMode=new Ni(e.context.gl.LEQUAL,Ni.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint();})),e.tp.registerParameter(to,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(to,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),e.tp.registerParameter(to,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"});}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[];}updateShadowParameters(t,i){const o=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const r=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||r<=0)return;if(this._shadowLayerCount=o.style.order.reduce(((e,i)=>{const r=o.style._mergedLayers[i];return e+(r.hasShadowPass()&&!r.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const s=o.context,n=to.shadowMapResolution,a=to.shadowMapResolution;if(0===this._cascades.length||to.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<to.cascadeCount;++t){const t=o._shadowMapDebug,i=s.gl,r=s.createFramebuffer(n,a,t,"texture"),l=new e.T(s,{width:n,height:a,data:null},i.DEPTH_COMPONENT16);if(r.depthAttachment.set(l.texture),t){const t=new e.T(s,{width:n,height:a,data:null},i.RGBA8);r.colorAttachment.set(t.texture);}this._cascades.push({framebuffer:r,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.cy,scale:0});}}this.shadowDirection=no(i);let l=0;if(t.elevation){const e=t.elevation,i=[1e4,-1e4];e.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;i[0]=Math.min(i[0],t.minimums[0]),i[1]=Math.max(i[1],t.maximums[0]);})),1e4!==i[0]&&(l=(i[1]-i[0])*e.exaggeration());}const c=1.5*t.cameraToCenterDistance,h=3*c,d=new Float64Array(16);for(let i=0;i<this._cascades.length;++i){const o=this._cascades[i];let r=t.height/50,s=1;1===to.cascadeCount?s=h:0===i?s=c:(r=c,s=h);const[n,a]=lo(t,this.shadowDirection,r,s,to.shadowMapResolution,l);o.scale=t.scale,o.matrix=n,o.boundingSphereRadius=a,e.bi(d,o.matrix),o.frustum=e.cy.fromInvProjectionMatrix(d,1,0,!0),o.far=s;}const u=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[u].far,this._cascades[u].far],this._uniformValues.u_shadow_intensity=r,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/to.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=to.shadowMapResolution,this._uniformValues.u_shadowmap_0=Yi.ShadowMap0,this._uniformValues.u_shadowmap_1=Yi.ShadowMap0+1,this._groundShadowTiles=o.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const _=o.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(_){const i=_.getMinMaxForTile(e);i&&(t=i);}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max);}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e;}drawShadowPass(t,i){if(!this.enabled)return;const o=this.painter,r=o.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(o.transform.getFrustum(0),o.transform.worldSize,this._cascades),r.viewport.set([0,0,to.shadowMapResolution,to.shadowMapResolution]);for(let s=0;s<this._numCascadesToRender;++s){o.currentShadowCascade=s,r.bindFramebuffer.set(this._cascades[s].framebuffer.framebuffer),r.clear({color:e.am.white,depth:1});for(const e of t.order){const r=t._mergedLayers[e];if(!r.hasShadowPass()||r.isHidden(o.transform.zoom))continue;const s=t.getLayerSourceCache(r),n=s?i[s.id]:void 0;("model"===r.type||n&&n.length)&&o.renderLayer(o,s,r,n);}}o.currentShadowCascade=0;}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,t=e.style,i=e.context,o=i.gl,r=t.directionalLight,s=t.ambientLight;if(!r||!s)return;const n=[],a=eo(e,e.longestCutoffRange);a.shouldRenderCutoff&&n.push("RENDER_CUTOFF"),n.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&n.push("NORMAL_OFFSET");const l=ao(t,r,s),c=new Ni(o.LEQUAL,Ni.ReadOnly,e.depthRangeFor3D),h=new ji({func:o.EQUAL,mask:255},0,255,o.KEEP,o.KEEP,o.KEEP);for(const t of this._groundShadowTiles){const r=t.toUnwrapped(),s=e.isTileAffectedByFog(t),d=e.getOrCreateProgram("groundShadow",{defines:n,overrideFog:s});this.setupShadows(r,d),e.uploadCommonUniforms(i,d,r,null,a);const u={u_matrix:e.transform.calculateProjMatrix(r),u_ground_shadow_factor:l};d.draw(e,o.TRIANGLES,c,h,ki.multiply,qi.disabled,u,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,null,e.transform.zoom,null,null);}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ki.unblended:ki.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const i=this.painter.transform,o=i.calculatePosMatrix(t,i.worldSize);return e.az(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}calculateShadowPassMatrixFromMatrix(t){return e.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,o){if(!this.enabled)return;const r=this.painter.transform,s=this.painter.context,n=s.gl,a=this._uniformValues,l=new Float64Array(16),c=r.calculatePosMatrix(t,r.worldSize);for(let t=0;t<this._cascades.length;t++)e.az(l,this._cascades[t].matrix,c),a[0===t?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),s.activeTexture.set(n.TEXTURE0+Yi.ShadowMap0+t),this._cascades[t].texture.bindExtraParam(n.LINEAR,n.LINEAR,n.CLAMP_TO_EDGE,n.CLAMP_TO_EDGE,n.GREATER);if(this.useNormalOffset=!!o,this.useNormalOffset){const i=e.d4(t.canonical),s=2/r.tileSize*e.aj/to.shadowMapResolution,n=s*this._cascades[0].boundingSphereRadius,l=s*this._cascades[this._cascades.length-1].boundingSphereRadius,c=("vector-tile"===o?1:3)*function(t,i,o,r,s){const n=e.ay((t-22)/-22,0,1);return .125*(1-n)+4*n}(r.zoom);a.u_shadow_normal_offset=[i,n*c,l*c],a.u_shadow_bias=[1e-4,.0012,.012];}else a.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(s,a);}setupShadowsFromMatrix(t,i,o=!1){if(!this.enabled)return;const r=this.painter.context,s=r.gl,n=this._uniformValues,a=new Float64Array(16);for(let i=0;i<to.cascadeCount;i++)e.az(a,this._cascades[i].matrix,t),n[0===i?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),r.activeTexture.set(s.TEXTURE0+Yi.ShadowMap0+i),this._cascades[i].texture.bindExtraParam(s.LINEAR,s.LINEAR,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE,s.GREATER);if(this.useNormalOffset=o,o){const e=to.normalOffset;n.u_shadow_normal_offset=[1,e,e],n.u_shadow_bias=[6e-5,.0012,.012];}else n.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(r,n);}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,o,r){if(r[2]>=0)return {};const s=function(t,i,o){const r=o/(1<<t.canonical.z);return new e.d6([t.canonical.x*r+t.wrap*o,t.canonical.y*r+t.wrap*o,0],[(t.canonical.x+1)*r+t.wrap*o,(t.canonical.y+1)*r+t.wrap*o,i])}(t,i,o).getCorners(),n=i/-r[2];r[0]<0?(e.d5(s[0],s[0],[r[0]*n,0,0]),e.d5(s[3],s[3],[r[0]*n,0,0])):r[0]>0&&(e.d5(s[1],s[1],[r[0]*n,0,0]),e.d5(s[2],s[2],[r[0]*n,0,0])),r[1]<0?(e.d5(s[0],s[0],[0,r[1]*n,0]),e.d5(s[1],s[1],[0,r[1]*n,0])):r[1]>0&&(e.d5(s[2],s[2],[0,r[1]*n,0]),e.d5(s[3],s[3],[0,r[1]*n,0]));const a={};return a.vertices=s,a.planes=[so(s[1],s[0],s[4]),so(s[2],s[1],s[5]),so(s[3],s[2],s[6]),so(s[0],s[3],s[7])],a}addShadowReceiver(t,i,o){this._receivers.add(t,e.d6.fromTileIdAndHeight(t,i,o));}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function so(t,i,o){const r=e.at([],o,i),s=e.at([],t,i),n=e.bF([],r,s),a=e.ae(n);return 0===a?[0,0,1,0]:(e.c1(n,n,1/a),[n[0],n[1],n[2],-e.bG(n,i)])}function no(t){const i=t.properties.get("direction"),o=e.d1(i.x,i.y,i.z);o[2]=e.ay(o[2],0,75);const r=e.d3([o[0],o[1],o[2]]);return e.d2(r.x,r.y,r.z)}function ao(t,i,o){const r="none"===i.properties.get("color-use-theme"),s=i.properties.get("color"),n=i.properties.get("intensity"),a=i.properties.get("direction"),l=[a.x,a.y,a.z],c="none"===o.properties.get("color-use-theme"),h=o.properties.get("color"),d=o.properties.get("intensity"),u=Math.max(e.bG([0,0,1],l),0),_=[0,0,0];e.c1(_,h.toPremultipliedRenderColor(c?null:t.getLut(i.scope)).toArray01Linear().slice(0,3),d);const p=[0,0,0];return e.c1(p,s.toPremultipliedRenderColor(r?null:t.getLut(o.scope)).toArray01Linear().slice(0,3),u*n),e.d8([_[0]>0?_[0]/(_[0]+p[0]):0,_[1]>0?_[1]/(_[1]+p[1]):0,_[2]>0?_[2]/(_[2]+p[2]):0])}function lo(t,i,o,r,s,n){const a=t.zoom,l=t.scale,c=t.worldSize,h=1/c,d=t.aspect,u=Math.sqrt(1+d*d)*Math.tan(.5*t.fovX),_=u*u,p=r-o,f=r+o;let m,g;_>p/f?(m=r,g=r*u):(m=.5*f*(1+_),g=.5*Math.sqrt(p*p+2*(r*r+o*o)*_+f*f*_*_));const v=t.projection.pixelsPerMeter(t.center.lat,c),y=t._camera.getCameraToWorldMercator(),x=[0,0,-m*h];e.ad(x,x,y);let b=g*h;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const i=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?v:1),s=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,o,r);s[8]=2*-t.centerOffset.x/t.width,s[9]=2*t.centerOffset.y/t.height;const n=new Float64Array(16);e.cM(n,s,i);const h=new Float64Array(16);e.bi(h,n);const d=e.cy.fromInvProjectionMatrix(h,c,a,!0);for(const i of d.points){const o=((T=i)[0]/=l,T[1]/=l,T[2]=e.cb(T[2],t._center.lat),T);b=Math.max(b,e.c2(e.d7([],x,o)));}}var T;b*=s/(s-1);const E=Math.acos(i[2]),S=Math.atan2(-i[0],-i[1]),I=new Xi;I.position=x,I.setPitchBearing(E,S);const C=I.getWorldToCamera(c,v),R=b*c,A=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*R),D=I.getCameraToClipOrthographic(-R,R,-R,R,A,(R+n*v)/i[2]),P=new Float64Array(16);e.az(P,D,C);const L=e.d2(Math.floor(1e6*x[0])/1e6*c,Math.floor(1e6*x[1])/1e6*c,0),z=.5*s,M=[0,0,0];e.ad(M,L,P),e.c1(M,M,z);const O=[Math.floor(M[0]),Math.floor(M[1]),Math.floor(M[2])],F=[0,0,0];e.at(F,M,O),e.c1(F,F,-1/z);const B=new Float64Array(16);return e.bx(B),e.bo(B,B,F),e.az(P,B,P),[P,R]}class co extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={};}loadModel(t,i){return e.aS(this.requestManager.transformRequest(i,e.R.Model).url).then((i=>{if(!i)return;const o=e.aT(i),r=new e.aU(t,void 0,void 0,o);return r.computeBoundsAndApplyParent(),r})).catch((o=>{if(o&&404===o.status)return null;this.fire(new e.z(new Error(`Could not load model ${t} from ${i}: ${o.message}`)));}))}load(t,i,o={forceReload:!1}){this.models[i]||(this.models[i]={});const r=Object.keys(t),s=[],n=[];for(const e of r){const r=t[e];this.hasURLBeenRequested(r)&&!o.forceReload||(this.modelByURL[r]={modelId:e,scope:i},s.push(this.loadModel(e,r)),n.push(e)),this.models[i][e]||(this.models[i][e]={model:null,numReferences:1});}this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+n.length,Promise.allSettled(s).then((t=>{for(let e=0;e<t.length;e++){const{status:o}=t[e];if("rejected"===o)continue;const{value:r}=t[e];this.models[i][n[e]]||(this.models[i][n[e]]={model:null,numReferences:1}),this.models[i][n[e]].model=r;}this.numModelsLoading[i]-=n.length,this.fire(new e.A("data",{dataType:"style"}));})).catch((t=>{this.fire(new e.z(new Error(`Could not load models: ${t.message}`)));}));}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return !1;return !0}hasModel(e,t,i={exactIdMatch:!1}){return !!(i.exactIdMatch?this.getModel(e,t):this.getModelByURL(this.modelUris[t][e]))}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}getModelByURL(e){if(!e)return null;const t=this.modelByURL[e];return t?this.models[t.scope][t.modelId].model:null}hasModelBeenAdded(e,t){return this.models[t]&&void 0!==this.models[t][e]}getModelURIs(e){return this.modelUris[e]||{}}addModel(e,t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});const o=this.requestManager.normalizeModelURL(t);if((this.hasModel(e,i,{exactIdMatch:!0})||this.hasModelBeenAdded(e,i))&&this.modelUris[i][e]===o)this.models[i][e].numReferences++;else if(this.hasURLBeenRequested(o)){const{scope:e,modelId:t}=this.modelByURL[o];this.models[e][t].numReferences++;}else this.modelUris[i][e]=o,this.load({[e]:this.modelUris[i][e]},i);}addModelURLs(e,t){this.models[t]||(this.models[t]={}),this.modelUris[t]||(this.modelUris[t]={});const i=this.modelUris[t];for(const t in e)i[t]=this.requestManager.normalizeModelURL(e[t]);}reloadModels(e){this.load(this.modelUris[e],e,{forceReload:!0});}addModelsFromBucket(t,i){this.models[i]||(this.models[i]={}),this.modelUris[i]||(this.modelUris[i]={});const o={};for(const r of t)this.hasModel(r,i,{exactIdMatch:!0})||this.hasURLBeenRequested(r)?this.models[i][r].numReferences++:this.modelUris[i][r]&&!this.hasURLBeenRequested(r)?o[r]=this.modelUris[i][r]:!this.hasURLBeenRequested(r)&&e.d9(r,!1)&&(this.modelUris[i][r]=this.requestManager.normalizeModelURL(r),o[r]=this.modelUris[i][r]);this.load(o,i);}hasURLBeenRequested(e){return void 0!==this.modelByURL[e]}removeModel(e,t,i=!1,o=!1){if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences||o)){const o=this.modelUris[t][e];i||delete this.modelUris[t][e],delete this.modelByURL[o];const r=this.models[t][e].model;if(!r)return;delete this.models[t][e],r.destroy();}}destroy(){for(const e of Object.keys(this.models))for(const t of Object.keys(this.models[e])){const i=this.models[e][t].model;delete this.models[e][t],i&&i.destroy();}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={};}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const i in this.models[t])this.models[t][i].model&&this.models[t][i].model.upload(e.context);}}const ho=new e.a7({data:new e.a8(e.a5.colorTheme.data)});class uo{constructor(e){this._scope=e,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}};}execute(e){const t=this._makeBuildingsQueryArea(e),i=this._makeFloorsQueryArea(e),o=e.queryRenderedFeatures(t,this._buildingQueryParams).filter((e=>"building"===e.properties.shape_type)).reduce(((e,t)=>{const i=t.properties.id;return "building"!==t.properties.shape_type||e.some((e=>e.properties.id===i))||e.push(t),e}),[]),r=e.queryRenderedFeatures(i,this._floorQueryParams).filter((e=>"floor"===e.properties.shape_type)).reduce(((e,t)=>{const i=t.properties.id;return "floor"!==t.properties.shape_type||e.some((e=>e.properties.id===i))||e.push(t),e}),[]),s=[e.getCenter().lng,e.getCenter().lat];return {floors:r,building:this._findBuildingAtCenter(s,o)||(o.length>0?o[0]:null)}}_makeBuildingsQueryArea(t){const i=t.transform.width,o=t.transform.height,r=Math.min(i,o),s=r*(1/8),n=r*(1/8),a=.5*(i-s),l=.5*(o-n);return [new e.P(a,l),new e.P(a+s,l+n)]}_makeFloorsQueryArea(t){const i=t.transform.width,o=t.transform.height,r=i*(2/3),s=o*(2/3),n=.5*(i-r),a=.5*(o-s);return [new e.P(n,a),new e.P(n+r,a+s)]}_findBuildingAtCenter(e,t){for(const i of t)if("Polygon"===i.geometry.type&&this._pointInPolygon(e,i.geometry.coordinates[0]))return i;return null}_pointInPolygon(e,t){let i=!1;for(let o=0,r=t.length-1;o<t.length;r=o++){const s=t[o][0],n=t[o][1],a=t[r][1];n>e[1]!=a>e[1]&&e[0]<(t[r][0]-s)*(e[1]-n)/(a-n)+s&&(i=!i);}return i}}class _o{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[];}setBuildingId(e){this._selectedBuildingId=e;}setFloors(e){if(this._floors=e.filter((e=>e.properties.building_id===this._selectedBuildingId)),!this._selectedFloorId||!this._floors.map((e=>e.properties.id)).includes(this._selectedFloorId)){const e=this._floors.map((e=>({id:e.properties.id,level:e.properties.floor_level}))).reduce(((e,t)=>{const i=Math.abs(e.level-1),o=Math.abs(t.level-1);return o<i||o===i&&t.level>e.level?t:e}));this._selectedFloorId=e.id;}}setFloorId(e){this._selectedFloorId=e;}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[];}}const po={"mbx-indoor-level-selected":{default:["literal",[]]}};function fo(e){return e=e||{},Object.assign(e,po)}class mo extends e.E{constructor(t){super(),e.aV(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new _o,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove);}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null;}_onLoad(){this._map.style.forEachFragmentStyle((t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new e.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new uo(this._scope)));})),this._map._addIndoorControl(),this._queryIndoor();}_onMove(){this._queryIndoor();}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const e=this._indoorDataQuery.execute(this._map);e&&0!==e.floors.length?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(e)):this._clearIndoorData();}_selectFloors(e){if(e.building)this._floorSelectionState.setBuildingId(e.building.properties.id),this._floorSelectionState.setFloors(e.floors),this._updateUI();else {const t=this._floorSelectionState.getSelectedFloorId();if(t&&e.floors.some((e=>e.properties.id===t)))return;this._clearIndoorData();}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]]);}_updateUI(){const t=this._floorSelectionState.getCurrentBuildingFloors().map((e=>({id:e.properties.id,name:e.properties.name,shortName:e.properties.floor_level,levelOrder:e.properties.floor_level}))),i=this._floorSelectionState.getSelectedFloorId();i?(this._updateIndoorConfig(),this.fire(new e.A("indoorupdate",{selectedFloorId:i,floors:t}))):console.warn("IndoorManager: Selected floor is not set");}_updateIndoorConfig(){const e=this._floorSelectionState.getSelectedFloorId();e?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[e]]):console.warn("IndoorManager: Selected floor is not set");}selectFloor(e){this._floorSelectionState.setFloorId(e),this._updateIndoorConfig();}}function go(t){if(!t.metadata||!t.metadata.content_area)return;const i=e.q.devicePixelRatio,{left:o,top:r,width:s,height:n}=t.metadata.content_area,a=o*i,l=r*i;return [a,l,a+s*i,l+n*i]}function vo(t){if(t)return t.map((([t,i])=>[t*e.q.devicePixelRatio,i*e.q.devicePixelRatio]))}class yo{constructor(e,t,i){this.id=e,this.scope=t,this.sourceCache=i,this.pendingRequests=new Set,this.missingRequests=new Set;}addPendingRequest(e){this.missingRequests.has(e.name)||this.pendingRequests.has(e.name)||this.pendingRequests.add(e.name);}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const i=this.sourceCache.getVisibleCoordinates();if(0===i.length)return t;const o=this.sourceCache.getSource();if(!(o instanceof rt))return t;const r=i.map((e=>this.sourceCache.getTile(e))),s=o.getImages(r,Array.from(this.pendingRequests));for(const[i,o]of s)t.set(e.I.from({name:i,iconsetId:this.id}),o),this.pendingRequests.delete(i);for(const e of this.pendingRequests)this.missingRequests.add(e);return this.pendingRequests.clear(),t}}const xo=(e,t)=>De(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),bo=e.aF(zt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),wo=e.aF(zt,["setCenter","setZoom","setBearing","setPitch"]),To=new Set(["background","sky","slot","custom"]),Eo={version:8,layers:[],sources:{}},So={duration:300,delay:0};class Io extends e.E{constructor(t,i={}){super(),this.map=t,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=e.h({},So),this._buildingIndex=new Dt(this),this.crossTileSymbolIndex=new Fi,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new G,this.dispatcher=i.dispatcher?i.dispatcher:new e.D(e.db(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new q(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new e.dc(t._requestManager,i.localFontFamily?e.dd.all:i.localIdeographFontFamily?e.dd.ideographs:e.dd.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new co(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:i.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",e.de());const o=this;this._rtlTextPluginCallback=Io.registerForPluginStateChange((t=>{o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.df(t),i&&i.every((e=>e)))for(const e in o._sourceCaches){const t=o._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload();}}));})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){const i=this._layers[e];i.source===t.id&&this._validateLayer(i);}}));}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.j(t))return t;const i=e.dg(t);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch(e){return i}return i}return `json://${e.dh(JSON.stringify(t))}`}_diffStyle(t,i,o){this.globalId=this._getGlobalId(t);const r=(e,t)=>{try{t(null,this.setState(e,o));}catch(e){t(e,!1);}};if("string"==typeof t){const o=this.map._requestManager.normalizeStyleURL(t),s=this.map._requestManager.transformRequest(o,e.R.Style);e.n(s,((t,o)=>{t?this.fire(new e.z(t)):o&&r(o,i);}));}else "object"==typeof t&&r(t,i);}loadURL(t,i={}){this.fire(new e.A("dataloading",{dataType:"style"}));const o="boolean"==typeof i.validate?i.validate:!e.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);const r=this.importsCache.get(t);if(r)return this._load(r,o);const s=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.n(s,((i,r)=>{if(this._request=null,i)this.fire(new e.z(i));else if(r)return this.importsCache.set(t,r),this._load(r,o)}));}loadJSON(t,i={}){this.fire(new e.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.q.frame((()=>{this._request=null,this._load(t,!1!==i.validate);}));}loadEmpty(){this.fire(new e.A("dataloading",{dataType:"style"})),this._load(Eo,!1);}_loadImports(t,i,o){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const r=[];for(const e of t){const t=this._createFragmentStyle(e),s=new Promise((e=>{t.once("style.import.load",e),t.once("error",e);})).then((()=>this.mergeAll()));if(r.push(s),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const n=e.data||this.importsCache.get(e.url);n?(t.loadJSON(n,{validate:i}),this._isInternalStyle(n)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:i}):t.loadEmpty();const a={style:t,id:e.id,config:e.config};if(o){const e=this.fragments.findIndex((({id:e})=>e===o));this.fragments=this.fragments.slice(0,e).concat(a).concat(this.fragments.slice(e));}else this.fragments.push(a);}return Promise.allSettled(r)}getImportGlobalIds(e=this,t=new Set){for(const i of e.fragments)i.style.globalId&&t.add(i.style.globalId),this.getImportGlobalIds(i.style,t);return [...t.values()]}_createFragmentStyle(t){const i=this.scope?e.C(t.id,this.scope):t.id;let o;const r=this._initialConfig&&this._initialConfig[i];(t.config||r)&&(o=e.h({},t.config,r));const s=new Io(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:o,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return s.setEventedParent(this.map,{style:s}),s}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle();}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,i){const o=t.indoor?fo(t.schema):t.schema;if(this._isInternalStyle(t)){const o=e.h({},Eo,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(o,i)}if(this.updateConfig(this._config,o),i&&xo(this,me(t)))return;this._loaded=!0,this.stylesheet=e.di(t);const r=()=>{for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const e in t.iconsets)this.addIconset(e,t.iconsets[e]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const o=Lt(this.stylesheet.layers);if(this._order=o.map((e=>e.id)),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new Le(e.properties,e.id);}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Le(this.stylesheet.light)),this._layers={};for(const t of o){const i=e.dn(t,this.scope,this._styleColorTheme.lut,this.options);0!==i.configDependencies.size&&this._configDependentLayers.add(i.fqid),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i;const o=this.getOwnLayerSourceCache(i),r=!!this.directionalLight&&this.directionalLight.shadowsEnabled();o&&i.canCastShadows()&&r&&(o.castsShadows=!0);}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const r=this.stylesheet.terrain;r&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(r,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.A("data",{dataType:"style"}));const s=this.isRootStyle();t.imports?this._loadImports(t.imports,i).then((()=>{this._reloadImports(),this.fire(new e.A(s?"style.load":"style.import.load"));})).catch((t=>{this.fire(new e.z(new Error("Failed to load imports",t))),this.fire(new e.A(s?"style.load":"style.import.load"));})):(this._reloadImports(),this.fire(new e.A(s?"style.load":"style.import.load")));};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(s){const t=this._evaluateColorThemeData(s);this._loadColorTheme(t).then((()=>{r();})).catch((t=>{e.w(`Couldn't load color theme from the stylesheet: ${t}`),r();}));}else this._styleColorTheme.lut=null,r();}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,i,o,r,s,n,a,l,c,h;const d={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(i=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(o=e.directionalLight);r=this._prioritizeTerrain(r,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(s=e.fog),e.stylesheet.snow&&null!=e.snow&&(n=e.snow),e.stylesheet.rain&&null!=e.rain&&(a=e.rain),null!=e.stylesheet.camera&&(h=e.stylesheet.camera),null!=e.stylesheet.projection&&(l=e.stylesheet.projection),null!=e.stylesheet.transition&&(c=e.stylesheet.transition),d[e.scope]=e._styleColorTheme;}})),this.light=t,this.ambientLight=i,this.directionalLight=o,this.fog=s,this.snow=n,this.rain=a,this._styleColorThemeForScope=d,null===r?delete this.terrain:this.terrain=r,this.camera=h||{"camera-projection":"perspective"},this.projection=l||{name:"mercator"},this.transition=e.h({},So,c),this.mergeSources(),this.mergeLayers();}forEachFragmentStyle(e){const t=i=>{for(const e of i.fragments)t(e.style);e(i);};t(this);}_prioritizeTerrain(e,t,i){const o=e&&0===e.drapeRenderMode;return null===i?t&&0===t.drapeRenderMode?t:o?e:null:null!=t&&(!e||o||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain);})),null===e?delete this.terrain:this.terrain=e;}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection);})),this.projection=e||{name:"mercator"};}mergeSources(){const t={},i={},o={};this.forEachFragmentStyle((r=>{for(const i in r._sourceCaches){const o=e.C(i,r.scope);t[o]=r._sourceCaches[i];}for(const t in r._otherSourceCaches){const o=e.C(t,r.scope);i[o]=r._otherSourceCaches[t];}for(const t in r._symbolSourceCaches){const i=e.C(t,r.scope);o[i]=r._symbolSourceCaches[t];}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=o;}mergeLayers(){const t={},i=[],o={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((o=>{for(const r of o._order){const s=o._layers[r];if("slot"===s.type){const i=e.dj(r);if(t[i])continue;t[i]=[];}s.slot&&t[s.slot]?t[s.slot].push(s):i.push(s);}})),this._mergedOrder=[];const r=(i=[])=>{for(const s of i)if("slot"===s.type){const i=e.dj(s.id);t[i]&&r(t[i]),this._mergedSlots.push(i);}else {const t=e.C(s.id,s.scope);this._mergedOrder.push(t),o[t]=s,s.is3D(!!this.terrain)&&(this._has3DLayers=!0),"circle"===s.type&&(this._hasCircleLayers=!0),"symbol"===s.type&&(this._hasSymbolLayers=!0),"clip"===s.type&&(this._clipLayerPresent=!0);}};r(i),this._mergedOrder.sort(((e,t)=>{const i=o[e],r=o[t];return i.hasInitialOcclusionOpacityProperties?r.is3D(!!this.terrain)?1:0:i.is3D(!!this.terrain)&&r.hasInitialOcclusionOpacityProperties?-1:0})),this._mergedLayers=o,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged();}terrainSetForDrapingOnly(){return !!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(t,i,o,r){const s=e.h({},i);for(const t of Object.keys(e.a5.colorTheme))void 0===s[t]&&(s[t]=e.a5.colorTheme[t].default);const n=new e.a6(ho,t,new Map(o));return n.setTransitionOrValue(s,o),n.untransitioned().possiblyEvaluate(new e.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const i=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((o,r)=>{const s="data:image/png;base64,";if(!t||0===t.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void o();let n=t;n.startsWith(s)||(n=s+n);const a=e.I.from("mapbox-reserved-lut"),l=new Image;l.src=n,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,r(new Error("Failed to load image data"));},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==i)return void o();this._styleColorTheme.lutLoading=!1;const{width:s,height:n,data:c}=e.q.getImageData(l);if(n>32)return void r(new Error("The height of the image must be less than or equal to 32 pixels."));if(s!==n*n)return void r(new Error("The width of the image must be equal to the height squared."));this.getImage(a)&&this.removeImage(a),this.addImage(a,{data:new e.r({width:s,height:n},c),pixelRatio:1,sdf:!1,usvg:!1,version:0});const h=this.imageManager.getImage(a,this.scope);h?(this._styleColorTheme.lut={image:h.data,data:t},o()):r(new Error("Missing LUT image."));};}))}getLut(e){const t=this._styleColorThemeForScope[e];return t?t.lut:null}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection();}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0));}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection));}_loadSprite(t){this._spriteRequest=function(t,i,o){let r,s,n;const a=e.q.devicePixelRatio>1?"@2x":"";let l=e.n(i.transformRequest(i.normalizeSpriteURL(t,a,".json"),e.R.SpriteJSON),((e,t)=>{l=null,n||(n=e,r=t,h());})),c=e.o(i.transformRequest(i.normalizeSpriteURL(t,a,".png"),e.R.SpriteImage),((e,t)=>{c=null,n||(n=e,s=t,h());}));function h(){if(n)o(n);else if(r&&s){const t=e.q.getImageData(s),i={};for(const o in r){const{width:s,height:n,x:a,y:l,sdf:c,pixelRatio:h,stretchX:d,stretchY:u,content:_}=r[o],p=new e.r({width:s,height:n});e.r.copy(t,p,{x:a,y:l},{x:0,y:0},{width:s,height:n},null),i[o]={data:p,pixelRatio:h,sdf:c,stretchX:d,stretchY:u,content:_,usvg:!1};}o(null,i);}}return {cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null);}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.z(t));else if(i){const t=new Map;for(const o in i)t.set(e.I.from(o),i[o]);this.addImages(t);}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}));}));}addIconset(t,i){if("sprite"===i.type)return void this._loadSprite(i.url);const o=this.getOwnSourceCache(i.source);if(!o)return void this.fire(new e.z(new Error(`Source "${i.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const r=o.getSource();if("raster-array"!==r.type)return void this.fire(new e.z(new Error(`Source "${i.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));r.partial=!1;const s=new yo(t,this.scope,o);this.imageManager.addImageProvider(s,this.scope);}removeIconset(e){this.imageManager.removeImageProvider(e,this.scope);}_loadIconset(t){if(!e.j(t)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(t);const i="auto"===this.map._spriteFormat;var o,r;this._spriteRequest=(r=(o,r)=>{if(this._spriteRequest=null,o)i?this._loadSprite(t):this.fire(new e.z(o));else if(r){const t=new Map;for(const i in r)t.set(e.I.from(i),r[i]);this.addImages(t);}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.A("data",{dataType:"style"}));},e.br((o=this.map._requestManager).transformRequest(o.normalizeIconsetURL(t),e.R.Iconset),((t,i)=>{if(t)return void r(t);const o={},s=e.da(new e.bq(i));for(const t of s.icons){const i={version:1,pixelRatio:e.q.devicePixelRatio,content:go(t),stretchX:t.metadata?vo(t.metadata.stretch_x_areas):void 0,stretchY:t.metadata?vo(t.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:t};o[t.name]=i;}r(null,o);})));}_validateLayer(t){const i=this.getOwnSource(t.source);if(!i)return;const o=t.sourceLayer;o&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(o))&&this.fire(new e.z(new Error(`Source layer "${o}" does not exist on source "${i.id}" as specified by style layer "${t.id}"`)));}loaded(){if(!this._loaded)return !1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return !1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return !1;if(!this.imageManager.isLoaded())return !1;if(this.imageManager.hasPatternsInFlight())return !1;if(!this.modelManager.isLoaded())return !1;if(this._styleColorTheme.lutLoading)return !1;for(const{style:e}of this.fragments)if(!e.loaded())return !1;return !0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const i=this.fragments[t];return i&&i.style&&(e.data=i.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const i=this._sourceCaches[t].getSource();e[i.id]||(e[i.id]=i.serialize());}return e}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];e&&"custom"!==e.type&&t.push(e.serialize());}return t}hasLightTransitions(){return !(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return !!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return !!this.snow&&this.snow.hasTransition()}hasRainTransition(){return !!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return !0;if(this.hasFogTransition())return !0;if(this.hasSnowTransition())return !0;if(this.hasRainTransition())return !0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return !0;for(const e in this._layers)if(this._layers[e].hasTransition())return !0;return !1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(e){return e?this.order:this._mergedOrder}isLayerDraped(e){return !!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const i=this.getOwnLayer(t);if(i)return i;this.fire(new e.z(new Error(`The layer '${t}' does not exist in the map's style.`)));}_checkSource(t){const i=this.getOwnSource(t);if(i)return i;this.fire(new e.z(new Error(`The source '${t}' does not exist in the map's style.`)));}precompilePrograms(e,t){const i=this.map.painter;if(i)for(let o=e.minzoom||0;o<(e.maxzoom||25.5);o++){const o=e.getProgramIds();if(o)for(const r of o){const o=e.getDefaultProgramParams(r,t.zoom,this._styleColorTheme.lut);o&&(i.style=this,this.fog&&(i._fogVisible=!0,o.overrideFog=!0,i.getOrCreateProgram(r,o)),i._fogVisible=!1,o.overrideFog=!1,i.getOrCreateProgram(r,o),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(o.overrideRtt=!0,i.getOrCreateProgram(r,o)));}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const o=this._changes.isDirty();let r=!1;if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:i,removedIds:o}=e[t];(i||o)&&(this._updateWorkerLayers(t,i,o),r=!0);}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset();}const s={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];s[e]=t.used,t.used=!1,t.tileCoverLift=0;}for(const e of this._mergedOrder){const i=this._mergedLayers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this.getLayerSourceCache(i);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,i.tileCoverLift()));}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(i,t);})):this.precompilePrograms(i,t));}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&r&&this.mergeLayers();const n=this.imageManager.getPendingImageProviders();for(const e of n)e.sourceCache.used=!0;for(const t in s){const i=this._mergedSourceCaches[t];s[t]!==i.used&&i.getSource().fire(new e.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}));}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),o&&this.fire(new e.A("data",{dataType:"style"}));}updateImageProviders(){const e=this.imageManager.getPendingImageProviders();for(const t of e){const e=t.resolvePendingRequests(),i=this.getFragmentStyle(t.scope);i&&i.addImages(e);}}_updateTilesForChangedImages(){const e={};for(const t in this._mergedSourceCaches){const i=this._mergedSourceCaches[t].getSource().scope;e[i]=e[i]||this._changes.getUpdatedImages(i),0!==e[i].length&&this._mergedSourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e[i]);}for(const t in e)this._changes.resetUpdatedImages(t);}_updateWorkerLayers(e,t,i){const o=this.getFragmentStyle(e);o&&this.dispatcher.broadcast("updateLayers",{layers:t?o._serializeLayers(t):[],scope:e,removedIds:i||[],options:o.options});}setState(t,i){if(this._checkLoaded(),xo(this,me(t)))return !1;(t=e.di(t)).layers=Lt(t.layers);const o=function(t,i){if(!t)return [{command:zt.setStyle,args:[i]}];let o=[];try{if(!e.bv(t.version,i.version))return [{command:zt.setStyle,args:[i]}];if(e.bv(t.center,i.center)||o.push({command:zt.setCenter,args:[i.center]}),e.bv(t.zoom,i.zoom)||o.push({command:zt.setZoom,args:[i.zoom]}),e.bv(t.bearing,i.bearing)||o.push({command:zt.setBearing,args:[i.bearing]}),e.bv(t.pitch,i.pitch)||o.push({command:zt.setPitch,args:[i.pitch]}),e.bv(t.sprite,i.sprite)||o.push({command:zt.setSprite,args:[i.sprite]}),e.bv(t.glyphs,i.glyphs)||o.push({command:zt.setGlyphs,args:[i.glyphs]}),e.bv(t.imports,i.imports)||function(t=[],i=[],o){i=i||[];const r=(t=t||[]).map(Nt),s=i.map(Nt),n=t.reduce(Ut,{}),a=i.reduce(Ut,{}),l=r.slice();let c,h,d,u;for(c=0,h=0;c<r.length;c++)d=r[c],a.hasOwnProperty(d)?h++:(o.push({command:zt.removeImport,args:[d]}),l.splice(l.indexOf(d,h),1));for(c=0,h=0;c<s.length;c++)d=s[s.length-1-c],l[l.length-1-c]!==d&&(n.hasOwnProperty(d)?(o.push({command:zt.removeImport,args:[d]}),l.splice(l.lastIndexOf(d,l.length-h),1)):h++,u=l[l.length-c],o.push({command:zt.addImport,args:[a[d],u]}),l.splice(l.length-c,0,d));for(const t of i){const i=n[t.id];i&&(delete i.data,e.bv(i,t)||o.push({command:zt.updateImport,args:[t.id,t]}));}}(t.imports,i.imports,o),e.bv(t.transition,i.transition)||o.push({command:zt.setTransition,args:[i.transition]}),e.bv(t.light,i.light)||o.push({command:zt.setLight,args:[i.light]}),e.bv(t.fog,i.fog)||o.push({command:zt.setFog,args:[i.fog]}),e.bv(t.snow,i.snow)||o.push({command:zt.setSnow,args:[i.snow]}),e.bv(t.rain,i.rain)||o.push({command:zt.setRain,args:[i.rain]}),e.bv(t.projection,i.projection)||o.push({command:zt.setProjection,args:[i.projection]}),e.bv(t.lights,i.lights)||o.push({command:zt.setLights,args:[i.lights]}),e.bv(t.camera,i.camera)||o.push({command:zt.setCamera,args:[i.camera]}),e.bv(t.iconsets,i.iconsets)||function(t,i,o){let r;for(r in i=i||{},t=t||{})t.hasOwnProperty(r)&&(i.hasOwnProperty(r)||o.push({command:zt.removeIconset,args:[r]}));for(r in i){if(!i.hasOwnProperty(r))continue;const s=i[r];t.hasOwnProperty(r)?e.bv(t[r],s)||(o.push({command:zt.removeIconset,args:[r]}),o.push({command:zt.addIconset,args:[r,s]})):o.push({command:zt.addIconset,args:[r,s]});}}(t.iconsets,i.iconsets,o),!e.bv(t["color-theme"],i["color-theme"]))return [{command:zt.setStyle,args:[i]}];const r={},s=[];!function(t,i,o,r){let s;for(s in i=i||{},t=t||{})t.hasOwnProperty(s)&&(i.hasOwnProperty(s)||Ot(s,o,r));for(s in i){if(!i.hasOwnProperty(s))continue;const n=i[s];t.hasOwnProperty(s)?e.bv(t[s],n)||("geojson"===t[s].type&&"geojson"===n.type&&Bt(t,i,s)?o.push({command:zt.setGeoJSONSourceData,args:[s,n.data]}):Ft(s,i,o,r)):Mt(s,i,o);}}(t.sources,i.sources,s,r);const n=[];t.layers&&t.layers.forEach((e=>{e.source&&r[e.source]?o.push({command:zt.removeLayer,args:[e.id]}):n.push(e);}));let a=t.terrain;a&&r[a.source]&&(o.push({command:zt.setTerrain,args:[void 0]}),a=void 0),o=o.concat(s),e.bv(a,i.terrain)||o.push({command:zt.setTerrain,args:[i.terrain]}),function(t,i,o){i=i||[];const r=(t=t||[]).map(Nt),s=i.map(Nt),n=t.reduce(Ut,{}),a=i.reduce(Ut,{}),l=r.slice(),c=Object.create(null);let h,d,u,_,p,f,m;for(h=0,d=0;h<r.length;h++)u=r[h],a.hasOwnProperty(u)?d++:(o.push({command:zt.removeLayer,args:[u]}),l.splice(l.indexOf(u,d),1));for(h=0,d=0;h<s.length;h++)u=s[s.length-1-h],l[l.length-1-h]!==u&&(n.hasOwnProperty(u)?(o.push({command:zt.removeLayer,args:[u]}),l.splice(l.lastIndexOf(u,l.length-d),1)):d++,f=l[l.length-h],o.push({command:zt.addLayer,args:[a[u],f]}),l.splice(l.length-h,0,u),c[u]=!0);for(h=0;h<s.length;h++)if(u=s[h],_=n[u],p=a[u],!c[u]&&!e.bv(_,p))if(e.bv(_.source,p.source)&&e.bv(_["source-layer"],p["source-layer"])&&e.bv(_.type,p.type)){for(m in kt(_.layout,p.layout,o,u,null,zt.setLayoutProperty),kt(_.paint,p.paint,o,u,null,zt.setPaintProperty),e.bv(_.slot,p.slot)||o.push({command:zt.setSlot,args:[u,p.slot]}),e.bv(_.filter,p.filter)||o.push({command:zt.setFilter,args:[u,p.filter]}),e.bv(_.minzoom,p.minzoom)&&e.bv(_.maxzoom,p.maxzoom)||o.push({command:zt.setLayerZoomRange,args:[u,p.minzoom,p.maxzoom]}),_)_.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?kt(_[m],p[m],o,u,m.slice(6),zt.setPaintProperty):e.bv(_[m],p[m])||o.push({command:zt.setLayerProperty,args:[u,m,p[m]]}));for(m in p)p.hasOwnProperty(m)&&!_.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?kt(_[m],p[m],o,u,m.slice(6),zt.setPaintProperty):e.bv(_[m],p[m])||o.push({command:zt.setLayerProperty,args:[u,m,p[m]]}));}else o.push({command:zt.removeLayer,args:[u]}),f=l[l.lastIndexOf(u)+1],o.push({command:zt.addLayer,args:[p,f]});}(n,i.layers,o);}catch(e){console.warn("Unable to compute style diff:",e),o=[{command:zt.setStyle,args:[i]}];}return o}(this.serialize(),t).filter((e=>!(e.command in wo)));if(0===o.length)return !1;const r=o.filter((e=>!(e.command in bo)));if(r.length>0)throw new Error(`Unimplemented: ${r.map((e=>e.command)).join(", ")}.`);const s=[];return o.forEach((e=>{s.push(this[e.command](...e.args));})),i&&Promise.all(s).then(i).catch(i),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages});}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels});}addImages(t){if(0===t.size)return this;for(const[i,o]of t.entries()){if(this.getImage(i))return this.fire(new e.z(new Error(`An image with the name "${i.name}" already exists.`)));this.imageManager.addImage(i,this.scope,o),this._changes.updateImage(i,this.scope);}return this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this}addImage(t,i){return this.getImage(t)?this.fire(new e.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,i),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this)}updateImage(t,i,o=!1){this.imageManager.updateImage(t,this.scope,i),o&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})));}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new e.A("data",{dataType:"style"})),this}addModel(t,i,o={}){return this._checkLoaded(),this._validate(Re,`models.${t}`,i,null,o)||(this.modelManager.addModel(t,i,this.scope),this.fire(new e.A("data",{dataType:"style"}))),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new e.A("data",{dataType:"style"})),this):this.fire(new e.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i,o={}){if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error(`There is already a source with ID "${t}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(ge,`sources.${t}`,i,null,o))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const r=nt(t,i,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id})));const s=t=>{const i=(t?"symbol:":"other:")+r.id,o=e.C(i,this.scope),s=this._sourceCaches[i]=new It(o,r,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=s,s.onAdd(this.map);};s(!1),"vector"!==i.type&&"geojson"!==i.type||s(!0),r.onAdd&&r.onAdd(this.map),o.isInitialLoad||(this.mergeSources(),this._changes.setDirty());}removeSource(t){this._checkLoaded();const i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.z(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const i=Object.entries(this.stylesheet.iconsets).find((([e,i])=>"source"===i.type&&i.source===t));if(i)return this.fire(new e.z(new Error(`Source "${t}" cannot be removed while iconset "${i[0]}" is using it.`)))}const o=this.getOwnSourceCaches(t);for(const t of o){const i=e.dj(t.id);delete this._sourceCaches[i],this._changes.discardSourceCacheUpdate(t.id),t.fire(new e.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:t.getSource().id})),t.setEventedParent(null),t.clearTiles();}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty();}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const i=this.getOwnSourceCache(t);i&&e.push(i.getSource());}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return !1}}return !0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const o of t){if(this._validate(ye,"lights",o))return;switch(o.type){case "ambient":if(this.ambientLight){const e=this.ambientLight;e.set(o),e.updateTransitions(i);}else this.ambientLight=new $e(o,qe||(qe=new e.a7({color:new e.a8(e.a5.properties_light_ambient.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case "directional":if(this.directionalLight){const e=this.directionalLight;e.set(o),e.updateTransitions(i);}else this.directionalLight=new $e(o,He||(He=new e.a7({direction:new e.an(e.a5.properties_light_directional.direction),color:new e.a8(e.a5.properties_light_directional.color),"color-use-theme":new e.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.a8(e.a5.properties_light_directional.intensity),"cast-shadows":new e.a8(e.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new e.a8(e.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new e.a8(e.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options);}}const o=Object.assign(i,{worldview:this.map.getWorldview()}),r=new e.aa(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness);}calculateLightsBrightness(){const t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;const o=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),r=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),s=t.properties.get("intensity"),n=t.properties.get("direction"),a=1-e.d1(n.x,n.y,n.z)[2]/90,l=o(r)*s*a,c=i.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),h=i.properties.get("intensity"),d=o(c)*h;return Number(((l+d)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return !!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(null==t||""===t&&this.isRootStyle())return this;if(e.dk(t)){const i=e.dl(t),o=this.fragments.find((({id:e})=>e===i));if(!o)return;const r=e.dj(t);return o.style.getFragmentStyle(r)}{const e=this.fragments.find((({id:e})=>e===t));return e?e.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const i={},o=(e,t="")=>`${e}::${t}`;this._featuresetSelectors={};for(const r in t){const s=this._featuresetSelectors[r]=[];for(const n of t[r].selectors){if(n.featureNamespace){const t=this.getOwnLayer(n.layer);if(!t){e.w(`Layer is undefined for selector: ${n.layer}`);continue}const s=o(t.source,t.sourceLayer);if(s in i&&i[s]!==n.featureNamespace){e.w(`"featureNamespace ${n.featureNamespace} of featureset ${r}'s selector is not associated to the same source, skip this selector`);continue}i[s]=n.featureNamespace;}let t;if(n.properties)for(const i in n.properties){const o=e.X(n.properties[i]);"success"===o.result&&(t=t||{},t[i]=o.value);}s.push({layerId:n.layer,namespace:n.featureNamespace,properties:t,uniqueFeatureID:n._uniqueFeatureID});}}}getFeaturesetDescriptors(e){const t=this.getFragmentStyle(e);if(!t||!t.stylesheet.featuresets)return [];const i=[];for(const e in t.stylesheet.featuresets)i.push({featuresetId:e,importId:t.scope?t.scope:void 0});return i}getFeaturesetLayers(t,i){const o=this.getFragmentStyle(i),r=o.stylesheet.featuresets;if(!r||!r[t])return this.fire(new e.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const s=[];for(const e of r[t].selectors){const t=o.getOwnLayer(e.layer);t&&s.push(t);}return s}getConfigProperty(t,i){const o=this.getFragmentStyle(t);if(!o)return null;const r=e.C(i,o.scope),s=o.options.get(r),n=s?s.value||s.default:null;return n?n.serialize():null}setConfigProperty(t,i,o){const r=this.getFragmentStyle(t);if(!r)return;const s=r.stylesheet.indoor?fo(r.stylesheet.schema):r.stylesheet.schema;if(!s||!s[i])return;const n=e.X(o);if("success"!==n.result)return void xo(this,n.value);const a=n.value.expression,l=e.C(i,r.scope),c=r.options.get(l);if(!c)return;let h;const{minValue:d,maxValue:u,stepValue:_,type:p,values:f}=s[i],m=e.X(s[i].default);"success"===m.result&&(h=m.value.expression),h?(this.options.set(l,Object.assign({},c,{value:a,default:h,minValue:d,maxValue:u,stepValue:_,type:p,values:f})),this.updateConfigDependencies(i)):this.fire(new e.z(new Error(`No schema defined for the config option "${i}" in the "${t}" fragment.`)));}getConfig(t){const i=this.getFragmentStyle(t);if(!i)return null;const o=i.stylesheet.schema;if(!o)return null;const r={};for(const t in o){const o=e.C(t,i.scope),s=i.options.get(o),n=s?s.value||s.default:null;r[t]=n?n.serialize():null;}return r}setConfig(e,t){const i=this.getFragmentStyle(e);i&&(i.updateConfig(t,i.stylesheet.schema),this.updateConfigDependencies());}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const i=this.getFragmentStyle(e);i&&(i.stylesheet.schema=t,i.updateConfig(i._config,t),this.updateConfigDependencies());}updateConfig(t,i){if(this._config=t,t||i)if(i)for(const o in i){let r,s;const n=e.X(i[o].default);if("success"===n.result&&(r=n.value.expression),t&&void 0!==t[o]){const i=e.X(t[o]);"success"===i.result&&(s=i.value.expression);}const{minValue:a,maxValue:l,stepValue:c,type:h,values:d}=i[o];if(r){const t=e.C(o,this.scope);this.options.set(t,{default:r,value:s,minValue:a,maxValue:l,stepValue:c,type:h,values:d});}else this.fire(new e.z(new Error(`No schema defined for config option "${o}".`)));}else this.fire(new e.z(new Error("Attempting to set config for a style without schema.")));}updateConfigDependencies(e){for(const t of this._configDependentLayers){const i=this.getLayer(t);if(i){if(e&&!i.configDependencies.has(e))continue;i.possiblyEvaluateVisibility(),this._updateLayer(i);}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((e=>{const t=e._styleColorTheme.colorThemeOverride?e._styleColorTheme.colorThemeOverride:e._styleColorTheme.colorTheme;if(t){const i=e._evaluateColorThemeData(t);(!e._styleColorTheme.lut&&""!==i||e._styleColorTheme.lut&&i!==e._styleColorTheme.lut.data)&&e.setColorTheme(t);}})),this._changes.setDirty();}addLayer(t,i,o={}){this._checkLoaded();const r=t.id;if(this._layers[r])return void this.fire(new e.z(new Error(`Layer with id "${r}" already exists on this map`)));let s;if("custom"===t.type){if(xo(this,e.dm(t)))return;s=e.dn(t,this.scope,this._styleColorTheme.lut,this.options);}else {if("object"==typeof t.source&&(this.addSource(r,t.source),t=e.di(t),t=e.h(t,{source:r})),this._validate(Ee,`layers.${r}`,t,{arrayIndex:-1},o))return;s=e.dn(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(s),s.setEventedParent(this,{layer:{id:r}});}0!==s.configDependencies.size&&this._configDependentLayers.add(s.fqid);let n=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.z(new Error(`Layer with id "${i}" does not exist on this map.`)));s.slot===this._layers[i].slot?n=t:e.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`);}this._order.splice(n,0,r),this._layerOrderChanged=!0,this._layers[r]=s;const a=this.getOwnLayerSourceCache(s),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&s.canCastShadows()&&l&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(s);if(c&&s.source&&a&&"custom"!==s.type){this._changes.discardLayerRemoval(s);const t=e.C(s.source,s.scope);c.type!==s.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),a.pause());}this._updateLayer(s),s.onAdd&&s.onAdd(this.map),s.scope=this.scope,this.mergeLayers();}moveLayer(t,i){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;if(t===i)return;const r=this._order.indexOf(t);this._order.splice(r,1);let s=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.z(new Error(`Layer with id "${i}" does not exist on this map.`)));o.slot===this._layers[i].slot?s=t:e.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`);}this._order.splice(s,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers();}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),delete this._layers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const o=this.getOwnLayerSourceCache(t);if(o&&o.castsShadows){let e=!1;for(const i in this._layers)if(this._layers[i].source===t.source&&this._layers[i].canCastShadows()){e=!0;break}o.castsShadows=e;}t.onRemove&&t.onRemove(this.map),this.mergeLayers();}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return !0;return !1}setLayerZoomRange(e,t,i){this._checkLoaded();const o=this._checkLayer(e);o&&(o.minzoom===t&&o.maxzoom===i||(null!=t&&(o.minzoom=t),null!=i&&(o.maxzoom=i),this._updateLayer(o)));}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(e,t){this._checkLoaded();const i=this._checkLayer(e);i&&i.slot!==t&&(i.slot=t,this._updateLayer(i));}setFilter(t,i,o={}){this._checkLoaded();const r=this._checkLayer(t);if(r&&!e.bv(r.filter,i))return null==i?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(Se,`layers.${r.id}.filter`,i,{layerType:r.type},o)||(r.filter=e.di(i),this._updateLayer(r)))}getFilter(t){const i=this._checkLayer(t);if(i)return e.di(i.filter)}setLayoutProperty(t,i,o,r={}){this._checkLoaded();const s=this._checkLayer(t);if(s&&!e.bv(s.getLayoutProperty(i),o)){if(null!=o&&(!r||!1!==r.validate)&&xo(s,Ce.call(me,{key:`layers.${t}.layout.${i}`,layerType:s.type,objectKey:i,value:o,styleSpec:e.a5,style:{glyphs:!0,sprite:!0}})))return;s.setLayoutProperty(i,o),0!==s.configDependencies.size&&this._configDependentLayers.add(s.fqid),this._updateLayer(s);}}getLayoutProperty(e,t){const i=this._checkLayer(e);if(i)return i.getLayoutProperty(t)}setPaintProperty(t,i,o,r={}){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;if(e.bv(s.getPaintProperty(i),o))return;if(null!=o&&(!r||!1!==r.validate)&&xo(s,Ie.call(me,{key:`layers.${t}.paint.${i}`,layerType:s.type,objectKey:i,value:o,styleSpec:e.a5})))return;const n=s.setPaintProperty(i,o);0!==s.configDependencies.size&&this._configDependentLayers.add(s.fqid),n&&this._updateLayer(s),this._changes.updatePaintProperties(s);}getPaintProperty(e,t){const i=this._checkLayer(e);if(i)return i.getPaintProperty(t)}setFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:o}=t.target,r=this.getFragmentStyle(o),s=r.getFeaturesetLayers(e);for(const{source:e,sourceLayer:o}of s)r.setFeatureState({id:t.id,source:e,sourceLayer:o},i);}else if("layerId"in t.target){const{layerId:e}=t.target,o=this.getLayer(e);this.setFeatureState({id:t.id,source:o.source,sourceLayer:o.sourceLayer},i);}return}const o=t.source,r=t.sourceLayer,s=this._checkSource(o);if(!s)return;const n=s.type;if("geojson"===n&&r)return void this.fire(new e.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===n&&!r)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(o);for(const e of a)e.setFeatureState(r,t.id,i);}removeFeatureState(t,i){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:o}=t.target,r=this.getFragmentStyle(o),s=r.getFeaturesetLayers(e);for(const{source:e,sourceLayer:o}of s)r.removeFeatureState({id:t.id,source:e,sourceLayer:o},i);}else if("layerId"in t.target){const{layerId:e}=t.target,o=this.getLayer(e);this.removeFeatureState({id:t.id,source:o.source,sourceLayer:o.sourceLayer},i);}return}const o=t.source,r=this._checkSource(o);if(!r)return;const s=r.type,n="vector"===s?t.sourceLayer:void 0;if("vector"===s&&!n)return void this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.z(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(o);for(const e of a)e.removeFeatureState(n,t.id,i);}getFeatureState(t){if(this._checkLoaded(),"target"in t){let i;if("featuresetId"in t.target){const{featuresetId:o,importId:r}=t.target,s=this.getFragmentStyle(r),n=s.getFeaturesetLayers(o);for(const{source:o,sourceLayer:r}of n){const n=s.getFeatureState({id:t.id,source:o,sourceLayer:r});if(n&&!i)i=n;else if(!e.bv(i,n))return void this.fire(new e.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:e}=t.target,o=this.getLayer(e);i=this.getFeatureState({id:t.id,source:o.source,sourceLayer:o.sourceLayer});}return i}const i=t.source,o=t.sourceLayer,r=this._checkSource(i);if(r){if("vector"!==r.type||o)return void 0===t.id&&this.fire(new e.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(o,t.id);this.fire(new e.z(new Error("The sourceLayer parameter must be provided for vector source types.")));}}setTransition(t){return this.stylesheet.transition=e.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateFilteredLayers(e){for(const t of Object.values(this._mergedLayers))e(t)&&this._updateLayer(t);}_updateLayer(t){this._changes.updateLayer(t);const i=this.getLayerSourceCache(t),o=e.C(t.source,t.scope),r=this._changes.getUpdatedSourceCaches();t.source&&!r[o]&&i&&"raster"!==i.getSource().type&&(this._changes.updateSourceCache(o,"reload"),i.pause()),t.invalidateCompiledFilter();}_flattenAndSortRenderedFeatures(e){const t=e=>this._mergedLayers[e].is3D(!!this.terrain),i=this.order,o={},r=[];for(let s=i.length-1;s>=0;s--){const n=i[s];if(t(n)){o[n]=s;for(const t of e){const e=t[n];if(e)for(const t of e)r.push(t);}}}r.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const s=[];for(let n=i.length-1;n>=0;n--){const a=i[n];if(t(a))for(let e=r.length-1;e>=0;e--){const t=r[e].feature;if(t.layer&&o[t.layer.id]<n)break;s.push(t),r.pop();}else for(const t of e){const e=t[a];if(e)for(const t of e)s.push(t.feature);}}return s}queryRenderedFeatures(t,i,o){let r;i&&!Array.isArray(i)&&i.filter&&(this._validate(Se,"queryRenderedFeatures.filter",i.filter,null,i),r=e.b3(i.filter));const s={},n=e=>{if(To.has(e.type))return;const t=this.getOwnLayerSourceCache(e),i=s[t.id]=s[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};e.is3D(!!this.terrain)&&(i.has3DLayers=!0),i.layers[e.fqid]=i.layers[e.fqid]||{styleLayer:e,targets:[]},i.layers[e.fqid].targets.push({filter:r});};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.z(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._layers[t];if(!i)return this.fire(new e.z(new Error(`The layer '${t}' does not exist in the map's style and cannot be queried for features.`))),[];n(i);}}else for(const e in this._layers)n(this._layers[e]);const a=this._queryRenderedFeatures(t,s,o),l=this._flattenAndSortRenderedFeatures(a),c=[];for(const t of l)e.dq(t.layer.id)===this.scope&&c.push(t);return c}queryRenderedFeatureset(t,i,o){let r;i&&!Array.isArray(i)&&i.filter&&(this._validate(Se,"queryRenderedFeatures.filter",i.filter,null,i),r=e.b3(i.filter));const s="mock",n=[];if(i&&i.target)n.push(Object.assign({},i,{targetId:s,filter:r}));else {const e=this.getFeaturesetDescriptors();for(const t of e)n.push({targetId:s,filter:r,target:t});for(const{style:e}of this.fragments){const t=e.getFeaturesetDescriptors();for(const e of t)n.push({targetId:s,filter:r,target:e});}}const a=this.queryRenderedTargets(t,n,o),l=[],c=new Set;for(const t of a)for(const i of t.variants[s])lt(i,t,c)||l.push(new e.dr(t,i));return l}queryRenderedTargets(t,i,o){const r={},s=(e,t,i,o)=>{const s=r[t.id]=r[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};if(s.layers[e.fqid]=s.layers[e.fqid]||{styleLayer:e,targets:[]},e.is3D(!!this.terrain)&&(s.has3DLayers=!0),!o)return i.uniqueFeatureID=!1,void s.layers[e.fqid].targets.push(i);s.layers[e.fqid].targets.push(Object.assign({},i,{namespace:o.namespace,properties:o.properties,uniqueFeatureID:o.uniqueFeatureID}));};for(const t of i)if("featuresetId"in t.target){const{featuresetId:i,importId:o}=t.target,r=this.getFragmentStyle(o);if(!r||!r._featuresetSelectors)continue;const n=r._featuresetSelectors[i];if(!n){this.fire(new e.z(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const e of n){const i=r.getOwnLayer(e.layerId);i&&!To.has(i.type)&&s(i,r.getOwnLayerSourceCache(i),t,e);}}else if("layerId"in t.target){const{layerId:e}=t.target,i=this.getLayer(e);if(!i||To.has(i.type))continue;s(i,this.getLayerSourceCache(i),t);}const n=this._queryRenderedFeatures(t,r,o);return this._flattenAndSortRenderedFeatures(n)}_queryRenderedFeatures(e,t,i){const o=[],r=!!this.map._showQueryGeometry,s=Xe.createFromScreenPoints(e,i);for(const e in t){const n=ct(s,t[e],this._availableImages,i,r);Object.keys(n).length&&o.push(n);}if(this.placement)for(const e in t){if(!t[e].sourceCache._onlySymbols)continue;const i=ht(s.screenGeometry,t[e],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(i).length&&o.push(i);}return o}querySourceFeatures(e,t){const i=t&&t.filter;i&&this._validate(Se,"querySourceFeatures.filter",i,null,t);let o=[];const r=this.getOwnSourceCaches(e);for(const e of r)o=o.concat(dt(e,t));return o}addSourceType(e,t,i){return Io.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(Io.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,i,o={}){this._checkLoaded();const r=this.light.getLight();let s=!1;for(const i in t)if(!e.bv(t[i],r[i])){s=!0;break}if(!s)return;const n=this._getTransitionParameters();this.light.setLight(t,i,o),this.light.updateTransitions(n);}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0);}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."));}setTerrain(t,i=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===i&&delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let o=t;const r=null==t.source;if(1===i){if(this.disableElevatedTerrain)return;if("object"==typeof o.source){const t="terrain-dem-src";this.addSource(t,o.source),o=e.di(o),o=e.h(o,{source:t});}const t=e.h({},o),i={};if(this.terrain&&r){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(i.style=e.serialize());}if(this._validate(xe,"terrain",t,i))return}if(!this.terrain||this.terrain.scope!==this.scope&&!r||this.terrain&&i!==this.terrain.drapeRenderMode){if(!o)return;this._createTerrain(o,i),this.fire(new e.A("data",{dataType:"style"}));}else {const i=this.terrain,r=i.get();for(const t of Object.keys(e.a5.terrain))!o.hasOwnProperty(t)&&e.a5.terrain[t].default&&(o[t]=e.a5.terrain[t].default);for(const o in t)if(!e.bv(t[o],r[o])){i.set(t,this.options),this.stylesheet.terrain=t;const o=this._getTransitionParameters({duration:0});i.updateTransitions(o),this.fire(new e.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0;}_createFog(e){const t=this.fog=new je(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const i=this._getTransitionParameters({duration:0});t.updateTransitions(i);}_createSnow(e){const t=this.snow=new Ze(e,this.map.transform,this.scope,this.options);this.stylesheet.snow=t.get();const i=this._getTransitionParameters({duration:0});t.updateTransitions(i);}_createRain(e){const t=this.rain=new We(e,this.map.transform,this.scope,this.options);this.stylesheet.rain=t.get();const i=this._getTransitionParameters({duration:0});t.updateTransitions(i);}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity();}));}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!e.bv(i.get(),t)){i.set(t,this.options),this.stylesheet.fog=i.get();const e=this._getTransitionParameters({duration:0});i.updateTransitions(e);}}else this._createFog(t);this._markersNeedUpdate=!0;}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const i=this.snow;if(!e.bv(i.get(),t)){i.set(t,this.options),this.stylesheet.snow=i.get();const e=this._getTransitionParameters({duration:0});i.updateTransitions(e);}}else this._createSnow(t);this._markersNeedUpdate=!0;}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const i=this.rain;if(!e.bv(i.get(),t)){i.set(t,this.options),this.stylesheet.rain=i.get();const e=this._getTransitionParameters({duration:0});i.updateTransitions(e);}}else this._createRain(t);this._markersNeedUpdate=!0;}_reloadColorTheme(){const t=()=>{for(const e in this._layers)this._layers[e].lut=this._styleColorTheme.lut;for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles();},i=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!i)return this._styleColorTheme.lut=null,void t();const o=this._evaluateColorThemeData(i);this._loadColorTheme(o).then((()=>{this.fire(new e.A("colorthemeset")),t();})).catch((t=>{e.w(`Couldn't set color theme: ${t}`);}));}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&e.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme();}setImportColorTheme(e,t){const i=this.getFragmentStyle(e);i&&(i._styleColorTheme.colorThemeOverride=t,i._reloadColorTheme());}_getTransitionParameters(t){return {now:e.q.now(),transition:e.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const i of this._mergedOrder)this.isLayerDraped(this._mergedLayers[i])?e.push(i):t.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t);}_createTerrain(e,t){const i=this.terrain=new ze(e,t,this.scope,this.options,this.map.getWorldview());1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const o=this._getTransitionParameters({duration:0});i.updateTransitions(o);}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t);}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t);}}_validate(t,i,o,r,s={}){if(s&&!1===s.validate)return !1;const n=e.h({},this.serialize());return xo(this,t.call(me,e.h({key:i,style:n,value:o,styleSpec:e.a5},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove());}clearSource(e){const t=this.getSourceCaches(e);for(const e of t)e.clearTiles();}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles();}clearLayers(){for(const e in this._mergedLayers){const t=this._mergedLayers[e];t._clear&&t._clear();}}reloadSource(e){const t=this.getSourceCaches(e);for(const e of t)e.resume(),e.reload();}reloadSources(){for(const e of this.getSources())e.reload&&e.reload();}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((e=>{e.modelManager.reloadModels(e.scope);}));}updateSources(e){let t;this.directionalLight&&(t=no(this.directionalLight));const i=new Set;for(const e in this._mergedLayers){const t=this._mergedLayers[e];t.hasElevation()&&!i.has(t.source)&&i.add(t.source);}for(const o in this._mergedSourceCaches){const r=this._mergedSourceCaches[o],s=i.has(r._source.id);r.update(e,void 0,void 0,t,s);}}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload();}}_updatePlacement(t,i,o,r,s,n,a=!1){let l=!1,c=!1;const h={},d={};for(const t of this._mergedOrder){const o=this._mergedLayers[t];if("symbol"!==o.type)continue;const r=e.C(o.source,o.scope);let s=h[r];if(!s){const e=this.getLayerSourceCache(o);if(!e)continue;const t=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));d[r]=t.slice(),s=h[r]=t.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)));}const n=this.crossTileSymbolIndex.addLayer(o,s,i.center.lng,i.projection);l=l||n;}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),a=a||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new e.A("neworder")),(a||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.q.now(),i.zoom))&&(this.pauseablePlacement=new Pi(i,this._mergedOrder,a,o,r,s,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,h,d,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.q.now()),c=!0),l&&this.pauseablePlacement.placement.setStale()),c||l){this._buildingIndex.onNewFrame(i.zoom);for(let t=0;t<this._mergedOrder.length;t++){const i=this._mergedLayers[this._mergedOrder[t]];if("symbol"!==i.type)continue;const o=this.isLayerClipped(i);this.placement.updateLayerOpacities(i,h[e.C(i.source,i.scope)],t,o?n:null);}}return {needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.q.now())}}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles();}addImport(t,i){this._checkLoaded();const o=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==o.findIndex((({id:e})=>e===t.id)))return void this.fire(new e.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!i)return o.push(t),this._loadImports([t],!0);const r=o.findIndex((({id:e})=>e===i));return -1===r&&this.fire(new e.z(new Error(`Import with id "${i}" does not exist on this map.`))),this.stylesheet.imports=o.slice(0,r).concat(t).concat(o.slice(r)),this._loadImports([t],!0,i)}updateImport(t,i){this._checkLoaded();const o=this.stylesheet.imports||[],r=this.getImportIndex(t);return -1===r?this:"string"==typeof i?(this.setImportUrl(t,i),this):(i.url&&i.url!==o[r].url&&this.setImportUrl(t,i.url),e.bv(i.config,o[r].config)||this.setImportConfig(t,i.config,i.data.schema),e.bv(i.data,o[r].data)||this.setImportData(t,i.data),this)}moveImport(e,t){this._checkLoaded();let i=this.stylesheet.imports||[];const o=this.getImportIndex(e);if(-1===o)return this;const r=this.getImportIndex(t);if(-1===r)return this;const s=i[o],n=this.fragments[o];return i=i.filter((({id:t})=>t!==e)),this.fragments=this.fragments.filter((({id:t})=>t!==e)),this.stylesheet.imports=i.slice(0,r).concat(s).concat(i.slice(r)),this.fragments=this.fragments.slice(0,r).concat(n).concat(this.fragments.slice(r)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const i=this.stylesheet.imports||[],o=this.getImportIndex(e);if(-1===o)return this;i[o].url=t;const r=this.fragments[o];return r.style=this._createFragmentStyle(i[o]),r.style.on("style.import.load",(()=>this.mergeAll())),r.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const i=this.getImportIndex(e),o=this.stylesheet.imports||[];return -1===i?this:t?(this.fragments[i].style.setState(t),this._reloadImports(),this):(delete o[i].data,this.setImportUrl(e,o[i].url))}setImportConfig(e,t,i){this._checkLoaded();const o=this.getImportIndex(e),r=this.stylesheet.imports||[];if(-1===o)return this;t?r[o].config=t:delete r[o].config;const s=this.fragments[o];i&&s.style.stylesheet&&(s.style.stylesheet.schema=i);const n=s.style.stylesheet&&s.style.stylesheet.schema;return s.config=t,s.style.updateConfig(t,n),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],i=this.getImportIndex(e);-1!==i&&(t.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports());}getImportIndex(t){const i=(this.stylesheet.imports||[]).findIndex((e=>e.id===t));return -1===i&&this.fire(new e.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),i}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[t];i&&e.push(i.getSource());}return e}getSource(e,t){const i=this.getSourceCache(e,t);return i&&i.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,i){const o=e.C(t,i);return this._mergedOtherSourceCaches[o]}getLayerSourceCache(t){const i=e.C(t.source,t.scope);return "symbol"===t.type?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const i=e[t];"reload"===i?this.reloadSource(t):"clear"===i&&this.clearSource(t);}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const i of t){const t=this.getLayer(i);t&&t.updateTransitions(e);}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(e){this.stylesheet.glyphs=e,this.glyphManager.setURL(e);}getImages(t,i,o){this.imageManager.getImages(i.images,i.scope,o),this._updateTilesForChangedImages();const r=t=>{if(t){const o=i.images.map((t=>e.I.toString(t)));t.setDependencies(i.tileID.key,i.type,o);}},s=e.C(i.source,i.scope);r(this._mergedOtherSourceCaches[s]),r(this._mergedSymbolSourceCaches[s]),i.images.some((e=>e.iconsetId))&&this.fire(new e.A("data",{dataType:"style"}));}rasterizeImages(e,t,i){this.imageManager.rasterizeImages(t,i);}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,i);}getResource(t,i,o){return e.dt(i,o)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return "symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this.getOwnSourceCaches(t);return 0===i.length?(this.fire(new e.z(new Error(`There is no source with ID '${t}'`))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,t){if(!this._clipLayerPresent&&"fill-extrusion"!==e.type&&"building"!==e.type)return !1;const i="fill-extrusion"===e.type&&("building"===e.sourceLayer||"procedural_buildings"===e.sourceLayer),o="building"===e.type;if(e.is3D(!!this.terrain)){if(i||o||t&&"batched-model"===t.type)return !0;if("model"===e.type)return !0}else if("symbol"===e.type)return !0;return !1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches");}destroy(){this._clearWorkerCaches(),this.fragments.forEach((e=>{e.style._remove();})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain);}}Io.getSourceType=function(e){return st[e]},Io.setSourceType=function(e,t){st[e]=t;},Io.registerForPluginStateChange=e.du;var Co="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Ro="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",Ao="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Do="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Po="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",Lo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",zo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Mo="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Oo="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Fo="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Bo="#ifdef RENDER_SHADOWS\nprecision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {\n#ifdef CLIP_ZERO_TO_ONE\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);\n#else\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);\n#endif\nreturn texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;\n#ifdef SHADOWS_SINGLE_CASCADE\nvec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);\n#else\nlight_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const ko=[];qo(Co,ko),qo(Ao,ko),qo(Ro,ko);const No={"_prelude_fog.vertex.glsl":Lo,"_prelude_terrain.vertex.glsl":Po,"_prelude_shadow.vertex.glsl":Fo,"_prelude_fog.fragment.glsl":zo,"_prelude_shadow.fragment.glsl":Bo,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Mo,"_prelude_raster_particle.glsl":Oo},Uo={};Ho("",Po),Ho(zo,Lo),Ho(Bo,Fo),Ho(Mo,""),Ho(Oo,"");const jo=Ho(Ro,Ao),Go=Co;var Vo={background:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),building:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nconst float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nin lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;\n#endif\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\nuniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}\n#ifdef BUILDING_FAUX_FACADE\nfloat hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;\n#if 0\nif (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;\n#else\nif (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;\n#endif\nreturn out_color;}\n#endif\nvec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;\n#ifdef BUILDING_FAUX_FACADE\nif (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}\n#endif\nvec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;\n#ifdef RENDER_SHADOWS\nshadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nshadowed_lighting_factor=dot(normal,u_lighting_directional_dir);\n#endif\ncolor.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));\n#endif\ncolor.rgb=linearTosRGB(color.rgb);color*=u_opacity;\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_pos.z);\n#endif\nglFragColor=color; \n#ifdef DEBUG_SHOW_NORMALS\ncolor.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nout lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nconst float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#ifdef BUILDING_FAUX_FACADE\nmat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}\n#endif\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive\nvoid main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;\n#ifdef BUILDING_FAUX_FACADE\nv_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}\n#endif\nv_pos=a_pos_3f;\n#ifdef RENDER_CUTOFF\nvec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=v_pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(v_pos);\n#endif\ngl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}'),buildingBloom:Ho("in vec4 v_color_emissive;\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\nfloat saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;\n#ifdef HAS_ATTRIBUTE_a_bloom_attenuation\nfloat distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);\n#endif\nglFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}","in vec3 a_pos_3f;\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\nout vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\n#ifdef HAS_ATTRIBUTE_a_part_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);\n#else\nv_color_emissive=vec4(1.0);\n#endif\ngl_Position=u_matrix*vec4(a_pos_3f,1.0);}"),buildingDepth:Ho("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Ho("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ho('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Ho("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ho("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;\n#endif\nout float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);\n#ifdef PROJECTION_GLOBE_VIEW\n#ifndef PROJECTED_POS_ON_VIEWPORT\nvec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);\n#endif\n#endif\nvec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Ho("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ho("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:Ho("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ho("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)\n{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nvec3 color=structure_color.xyz;\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,transformed_normal);\n#endif\ncolor=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nv_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef FLIP_Y\nv_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FLIP_Y\nv_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\n#ifdef FEATURE_CUTOUT\ncolor=apply_feature_cutout(color,gl_FragCoord);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\n#ifdef CLIP_ZERO_TO_ONE\ncutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);\n#else\ncutoff=cutoff_opacity(u_cutoff_params,ground.z);\n#endif\nif (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Ho("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Ho('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Ho("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Ho("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nfloat left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;\n#ifdef LINE_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nuniform float u_emissive_strength;\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LINE_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Ho("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Ho("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ho('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ho('#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nin highp float v_z_offset;\n#endif\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef TERRAIN\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#else\nout_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef ELEVATED_ROADS\nin vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nout highp float v_z_offset;\n#endif\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;\n#else\nz+=u_pitch_with_map ? z_offset : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\n#ifdef ELEVATED_ROADS\nvec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\npos=vec3(projected_pos.xy/projected_pos.w+offset,z);\n#endif\n#endif\ngl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#else\n#ifdef RENDER_SHADOWS\nv_z_offset=e;\n#endif\n#endif\n}'),terrainRaster:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Ho("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Ho('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Do),skyboxGradient:Ho('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Do),skyboxCapture:Ho("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Ho('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Ho('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\n#ifdef FLIP_Y\nT=-T;B=-B;\n#endif\nhighp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));\n#ifdef FLIP_Y\nn=normalize(cross(fdx,fdy));\n#else\nn=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\n#ifdef FEATURE_CUTOUT\nfinalColor=apply_feature_cutout(finalColor,gl_FragCoord);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Ho("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Ho("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:Ho("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:Ho("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:Ho("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ho("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function qo(e,t){const i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let e of i)if(e=e.trim(),"#"===e[0]&&e.includes("if")&&!e.includes("endif")){e=e.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=e.split(" ");for(const e of i)t.includes(e)||t.push(e);}}function Ho(e,t){const i=/#include\s+"([^"]+)"/g,o=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let r=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);r&&(r=r.map((e=>{const t=e.split(" ");return t[t.length-1]})),r=[...new Set(r)]);const s={},n=[],a=[];if(e=e.replace(i,((e,t)=>(a.push(t),""))),(t=t.replace(i,((e,t)=>(n.push(t),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...ko];qo(e,l),qo(t,l);for(const e of [...n,...a])No[e]||console.error(`Undefined include: ${e}`),Uo[e]||(Uo[e]=[],qo(No[e],Uo[e])),l=[...l,...Uo[e]];return {fragmentSource:e=e.replace(o,((e,t,i,o,r)=>(s[r]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nin ${i} ${o} ${r};\n#else\nuniform ${i} ${o} u_${r};\n#endif\n`:"initialize"===t?`\n#ifdef HAS_UNIFORM_u_${r}\n    ${i} ${o} ${r} = u_${r};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    in ${i} ${o} ${r};\n#endif\n`:"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(o,((e,t,i,o,r)=>{const n="float"===o?"vec2":o,a=r.match(/color/)?"color":n;return "define-attribute-vertex-shader-only"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\nin ${i} ${o} a_${r};\n#endif\n`:s[r]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${i} ${n} a_${r};\nout ${i} ${o} ${r};\n#else\nuniform ${i} ${o} u_${r};\n#endif\n`:"initialize"===t?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${i} ${o} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${a}(a_${r}, u_${r}_t);\n#else\n    ${i} ${o} ${r} = u_${r};\n#endif\n`:"define-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    in ${i} ${o} a_${r};\n    out ${i} ${o} ${r};\n#endif\n`:"initialize-attribute"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    ${r} = a_${r};\n#endif\n`:void 0:"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nin ${i} ${n} a_${r};\n#else\nuniform ${i} ${o} u_${r};\n#endif\n`:"define-instanced"===t?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${r}0;\nin vec4 a_${r}1;\nin vec4 a_${r}2;\nin vec4 a_${r}3;\n#else\nuniform ${i} ${o} u_${r};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${i} ${n} a_${r};\n#else\nuniform ${i} ${o} u_${r};\n#endif\n`:"initialize-attribute-custom"===t?`\n#ifdef HAS_ATTRIBUTE_a_${r}\n    ${i} ${o} ${r} = a_${r};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${o} ${r} = a_${r};\n#else\n    ${i} ${o} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${i} ${o} ${r} = unpack_mix_${a}(a_${r}, u_${r}_t);\n#else\n    ${i} ${o} ${r} = u_${r};\n#endif\n`})),staticAttributes:r,usedDefines:l,vertexIncludes:n,fragmentIncludes:a}}class Zo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null;}bind(e,t,i,o,r,s,n,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==o.length;for(let e=0;!l&&e<o.length;e++)this.boundPaintVertexBuffers[e]!==o[e]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==n.length;for(let e=0;!c&&e<n.length;e++)this.boundDynamicVertexBuffers[e]!==n[e]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||l||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==s)this.freshBind(t,i,o,r,s,n,a);else {e.bindVertexArrayOES.set(this.vao);for(const i of n)i&&(i.bind(),a&&i.instanceCount&&i.setVertexAttribDivisor(e.gl,t,a));r&&r.dynamicDraw&&r.bind();}}freshBind(e,t,i,o,r,s,n){const a=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=o,this.boundVertexOffset=r,this.boundDynamicVertexBuffers=s,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const t of i)t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r);for(const t of s)t&&(t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,r),n&&t.instanceCount&&t.setVertexAttribDivisor(c,e,n));o&&o.bind(),l.currentNumAttributes=a;}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null);}}function Wo(t,i){const o=Math.pow(2,i.canonical.z),r=i.canonical.y;return [new e.ac(0,r/o).toLngLat().lat,new e.ac(0,(r+1)/o).toLngLat().lat]}function $o(t,i,o,r,s,n,a){const l=t.context,c=l.gl,h=o.hillshadeFBO;if(!h)return;t.prepareDrawTile();const d=t.isTileAffectedByFog(i),u=t.getOrCreateProgram("hillshade",{overrideFog:d});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,h.colorAttachment.get());const _=((t,i,o,r)=>{const s=o.paint.get("hillshade-shadow-color"),n="none"===o.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),a=o.paint.get("hillshade-highlight-color"),l="none"===o.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),c=o.paint.get("hillshade-accent-color"),h="none"===o.paint.get("hillshade-accent-color-use-theme").constantOr("default"),d=o.paint.get("hillshade-emissive-strength");let u=e.al(o.paint.get("hillshade-illumination-direction"));if("viewport"===o.paint.get("hillshade-illumination-anchor"))u-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const i=t.style.directionalLight.properties.get("direction"),o=e.d1(i.x,i.y,i.z);u=e.al(o[1]);}const _=!t.options.moving;return {u_matrix:r||t.transform.calculateProjMatrix(i.tileID.toUnwrapped(),_),u_image:0,u_latrange:Wo(0,i.tileID),u_light:[o.paint.get("hillshade-exaggeration"),u],u_shadow:s.toPremultipliedRenderColor(n?null:o.lut),u_highlight:a.toPremultipliedRenderColor(l?null:o.lut),u_emissive_strength:d,u_accent:c.toPremultipliedRenderColor(h?null:o.lut)}})(t,o,r,t.terrain?i.projMatrix:null);t.uploadCommonUniforms(l,u,i.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=t.getTileBoundsBuffers(o);u.draw(t,c.TRIANGLES,s,n,a,qi.disabled,_,r.id,p,f,m);}function Xo(t,i,o){if(!i.needsDEMTextureUpload)return;const r=t.context,s=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(o.stride);const n=o.getPixels();i.demTexture?i.demTexture.update(n,{premultiply:!1}):i.demTexture=new e.T(r,n,s.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1;}function Yo(t,i,o){const r=t.context,s=r.gl;if(!i.dem)return;const n=i.dem;if(r.activeTexture.set(s.TEXTURE1),Xo(t,i,n),!i.demTexture)return;i.demTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE);const a=n.dim;r.activeTexture.set(s.TEXTURE0);let l=i.hillshadeFBO;if(!l){const t=new e.T(r,{width:a,height:a,data:null},s.RGBA8);t.bind(s.LINEAR,s.CLAMP_TO_EDGE),l=i.hillshadeFBO=r.createFramebuffer(a,a,!0,"renderbuffer"),l.colorAttachment.set(t.texture);}r.bindFramebuffer.set(l.framebuffer),r.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:h,tileBoundsSegments:d}=t.getMercatorTileBoundsBuffers(),u=[];t.linearFloatFilteringSupported()&&u.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:u}).draw(t,s.TRIANGLES,Ni.disabled,ji.disabled,ki.unblended,qi.disabled,((t,i)=>{const o=i.stride,r=e.bz();return e.ca(r,0,e.aj,-e.aj,0,0,1),e.bo(r,r,[0,-e.aj,0]),{u_matrix:r,u_image:1,u_dimension:[o,o],u_zoom:t.overscaledZ}})(i.tileID,n),o.id,c,h,d),i.needsHillshadePrepare=!1;}class Ko{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1;}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default);}}class Jo extends Ko{getDefault(){return e.am.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1);}}class Qo extends Ko{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1);}}class er extends Ko{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1);}}class tr extends Ko{getDefault(){return [!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1);}}class ir extends Ko{getDefault(){return !0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1);}}class or extends Ko{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1);}}class rr extends Ko{getDefault(){return {func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1);}}class sr extends Ko{getDefault(){const e=this.gl;return [e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1);}}class nr extends Ko{getDefault(){return !1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1;}}class ar extends Ko{getDefault(){return [0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1);}}class lr extends Ko{getDefault(){return !1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1;}}class cr extends Ko{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1);}}class hr extends Ko{getDefault(){return !1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1;}}class dr extends Ko{getDefault(){const e=this.gl;return [e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1);}}class ur extends Ko{getDefault(){return e.am.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1);}}class _r extends Ko{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1);}}class pr extends Ko{getDefault(){return !1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1;}}class fr extends Ko{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1);}}class mr extends Ko{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1);}}let gr=class extends Ko{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1);}};class vr extends Ko{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1);}}class yr extends Ko{getDefault(){const e=this.gl;return [0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1);}}class xr extends Ko{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1;}}class br extends Ko{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1;}}class wr extends Ko{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1;}}class Tr extends Ko{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1;}}class Er extends Ko{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1;}}class Sr extends Ko{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1);}}class Ir extends Ko{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1;}}class Cr extends Ko{getDefault(){return !1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1;}}class Rr extends Ko{getDefault(){return !1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1;}}class Ar extends Ko{constructor(e,t){super(e),this.context=e,this.parent=t;}getDefault(){return null}}class Dr extends Ar{setDirty(){this.dirty=!0;}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1;}}class Pr extends Ar{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1;}}class Lr extends Ar{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1;}}class zr extends Pr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Mr=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),Or=(e,t,i,o,r,s,n,a,l,c,h,d,u,_,p,f)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(o),u_merc_matrix:i,u_zoom_transition:r,u_merc_center:s,u_image0:0,u_frustum_tl:n,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:h,u_globe_radius:d,u_viewport:u,u_grid_matrix:f?Float32Array.from(f):new Float32Array(9),u_skirt_height:_,u_far_z_cutoff:p});function Fr(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const Br=new class{constructor(){this.operations={};}newMorphing(e,t,i,o,r){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i);}else this.operations[e]={startTime:o,phase:0,duration:r,from:t,to:i,queued:null};}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return {from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return !!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},kr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Nr(e,t,i){if(0===t)return 0;const o=t<1&&514===i?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*o}function Ur(e,t){const i=1<<e.z;return !t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const jr=e=>({u_matrix:e});function Gr(t,i,o,r,s){if(s>0){const n=e.q.now(),a=(n-t.timeAdded)/s,l=i?(n-i.timeAdded)/s:-1,c=o.getSource(),h=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),d=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),u=d&&t.refreshedUponExpiration?1:e.ay(d?a:1-l,0,1);return t.refreshedUponExpiration&&a>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-u}:{opacity:u,mix:0}}return {opacity:1,mix:0}}class Vr extends It{constructor(e){const t=nt("mock-dem",{type:"raster-dem",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("mock-dem",t,!1),t.setEventedParent(this),this._sourceLoaded=!0;}_loadTile(e,t){e.state="loaded",t(null);}}class qr extends It{constructor(e){const t=nt("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={};}update(e,t,i){if(e.freezeTileCoverage)return;this.transform=e;const o=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((t,i)=>{if(t[i.key]="",!this._tiles[i.key]){const t=new wt(i,this._source.tileSize*i.overscaleFactor(),e.tileZoom,void 0,void 0,this._source.worldview);t.state="loaded",this._tiles[i.key]=t;}return t}),{});for(const e in this._tiles)e in o||(this.freeFBO(e),this._tiles[e].unloadVectorData(),delete this._tiles[e]);}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e];}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={};}}class Hr extends e.aM{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i;}}class Zr extends e.dF{constructor(t,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint();})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint();})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint();})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[o,r,s]=function(t){const i=new e.ba,o=new e.a_,r=131;i.reserve(17161),o.reserve(33800);const s=e.aj/128,n=e.aj+s/2,a=n+s;for(let t=-s;t<a;t+=s)for(let o=-s;o<a;o+=s){const r=o<0||o>n||t<0||t>n?24575:0,s=e.ay(Math.round(o),0,e.aj),a=e.ay(Math.round(t),0,e.aj);i.emplaceBack(s+r,a);}const l=(e,t)=>{const i=t*r+e;o.emplaceBack(i+1,i,i+r),o.emplaceBack(i+r,i+r+1,i+1);};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return [0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t);})),[i,o,32768]}(),n=t.context;this.gridBuffer=n.createVertexBuffer(o,e.bc.members),this.gridIndexBuffer=n.createIndexBuffer(r),this.gridSegments=e.bd.simpleSegment(0,0,o.length,r.length),this.gridNoSkirtSegments=e.bd.simpleSegment(0,0,o.length,s),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new qr(i.map),this.orthoMatrix=e.bz(),e.ca(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.aj,0,e.aj,0,1);const a=n.gl;this._overlapStencilMode=new ji({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Vr(i.map),this._pendingGroundEffectLayers=[];}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache();}));}update(t,i,o){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const r=t.terrain.properties,s=0===t.terrain.drapeRenderMode,n=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.q.now();const a=t.terrain&&t.terrain.scope,l=r.get("source"),c=s?this._mockSourceCache:t.getSourceCache(l,a);if(!c)return void e.w(`Couldn't find terrain source "${l}".`);if(this.sourceCache=c,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=n?this.calculateExaggeration(i):r.get("exaggeration"),!i.projection.requiresDraping&&n&&0===this._exaggeration)return void this._disable();this.enabled=!0;const h=()=>{this.sourceCache.used&&e.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id);};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,h(),this._initializing=!0),h(),i.updateElevation(!0,o),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom;}else this._disable();}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const i=this._previousCameraAltitude,o=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=o;const r=null!=i?o-i:Number.MAX_VALUE;if(Math.abs(r)<2)return this._exaggeration;const s=t.zoom,n=this._style.terrain;if(!this._previousUpdateTimestamp)return n.getExaggeration(s);let a=s-this._previousZoom;const l=this._previousUpdateTimestamp;let c=s;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(s-c)>.5&&(a=.5*(s-c+a)),a*r<0&&(c+=a)),this._evaluationZoom=c;const h=n.getExaggeration(c),d=h===n.getExaggeration(Math.max(0,c-.1));if(d&&Math.abs(h-this._exaggeration)<.01)return h;let u=Math.min(.1,.00375*(this._updateTimestamp-l));return (d||h<.1||Math.abs(a)<1e-4)&&(u=Math.min(.2,4*u)),e.ai(this._exaggeration,h,u)}resetTileLookupCache(e){this._findCoveringTileCache[e]={};}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0);}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1;}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy();}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return [e,e]}set useVertexMorphing(e){this._useVertexMorphing=e;}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,o=this.painter.transform;this._initializing&&(this._initializing=0===o._centerAltitude&&-1===this.getAtPointOrZero(e.ac.fromLngLat(o.center),-1),this._emptyDEMTextureDirty=!this._initializing);const r=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=o.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const o=i.transform.pointCoordinate(i.transform.getCameraPoint()),r=new e.P(o.x,o.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const o=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),s=new e.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),n=r.mult(1<<t.canonical.z);return n.x-=.5,n.y-=.5,n.distSqr(o)-n.distSqr(s)}));}(r,this.painter);const s=this.proxyToSource||{};this.proxyToSource={},r.forEach((e=>{this.proxyToSource[e.key]={};})),this.terrainTileForTile={};const n=this._style._mergedSourceCaches;for(const e in n){const i=n[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],s),i.usedForTerrain)continue;const o=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(o);}this.proxiedCoords[i.id]=r.map((e=>new Hr(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(s),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in a||(this._visibleDemTiles.push(t),a[i]=i);}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t);}));}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const o=this.terrainTileForTile[i],r=o.dem;!r||o.demTexture&&!o.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Xo(this.painter,o,r));}}_prepareDemTileUniforms(e,t,i,o){if(!t||null==t.demTexture)return !1;const r=e.tileID.canonical,s=Math.pow(2,t.tileID.canonical.z-r.z),n=o||"";return i[`u_dem_tl${n}`]=[r.x*s%1,r.y*s%1],i[`u_dem_scale${n}`]=s,!0}get emptyDEMTexture(){return !this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const o=i.dem.tree.minimums[0];return o>0&&e++,t+o}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const o=this._getLoadedAreaMinimum(),r=new e.dG({width:1,height:1},new Float32Array([o]));this._emptyDEMTextureDirty=!1;let s=this._emptyDEMTexture;return s?s.update(r,{premultiply:!1}):s=this._emptyDEMTexture=new e.T(t,r,i.R32F,{premultiply:!1}),s}setupElevationDraw(t,i,o){const r=this.painter.context,s=r.gl,n={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};n.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(o&&o.morphing&&this._useVertexMorphing){const e=o.morphing.srcDemTile,i=o.morphing.dstDemTile;c=o.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,n,"_prev")&&(l=e),this._prepareDemTileUniforms(t,i,n)&&(a=i));}const h=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?s.LINEAR:s.NEAREST;let d=null;var u;if(this.enabled?l&&a?(d=a.demTexture,r.activeTexture.set(s.TEXTURE4),l.demTexture.bind(h(l),s.CLAMP_TO_EDGE),n.u_dem_lerp=c):(a=this.terrainTileForTile[t.tileID.key],d=this._prepareDemTileUniforms(t,a,n)?a.demTexture:this.emptyDEMTexture):d=this.emptyDEMTexture,r.activeTexture.set(s.TEXTURE2),d&&(n.u_dem_size=1===(u=d).size[0]?1:u.size[0]-2,d.bind(h(a),s.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(o&&o.useDepthForOcclusion,i,n),o&&o.useMeterToDem&&a){const t=(1<<a.tileID.canonical.z)*e.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;n.u_meter_to_dem=t;}if(o&&o.labelPlaneMatrixInv&&(n.u_label_plane_matrix_inv=o.labelPlaneMatrixInv),i.setTerrainUniformValues(r,n),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,o&&o.useDenormalizedUpVectorScale);i.setGlobeUniformValues(r,e);}}globeUniformValues(t,i,o){const r=t.projection;return {u_tile_tl_up:r.upVector(i,0,0),u_tile_tr_up:r.upVector(i,e.aj,0),u_tile_br_up:r.upVector(i,e.aj,e.aj),u_tile_bl_up:r.upVector(i,0,e.aj),u_tile_up_scale:o?e.dH(1):r.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,o=this.painter.context;0!==t.length&&(o.bindFramebuffer.set(null),o.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,o,r,s){if("globe"===t.transform.projection.name)!function(t,i,o,r,s){const n=t.context,a=n.gl;let l,c;const h=t.transform,d=e.dy(t,n,h),u=(e,i)=>{if(c===i)return;const o=[kr[i],"PROJECTION_GLOBE_VIEW"];d&&o.push("CUSTOM_ANTIALIASING");const r=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:o,overrideFog:r}),c=i;},_=t.colorModeForRenderPass(),p=new Ni(a.LEQUAL,Ni.ReadWrite,t.depthRangeFor3D);Br.update(s);const f=e.dz(h),m=[e.aD(h.center.lng),e.aH(h.center.lat)],g=t.globeSharedBuffers,v=[h.width*e.q.devicePixelRatio,h.height*e.q.devicePixelRatio],y=Float32Array.from(h.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const h=t.transform,d=Nr(h.zoom,i.exaggeration(),i.sourceCache._source.tileSize);c=-1;const b=a.TRIANGLES;for(const c of r){const r=o.getTile(c),w=ji.disabled,T=i.prevTerrainTileForTile[c.key],E=i.terrainTileForTile[c.key];Fr(T,E)&&Br.newMorphing(c.key,T,E,s,250),n.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const S=Br.getMorphValuesForProxy(c.key),I=S?1:0;S&&e.L(x,{morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:e.dx(S.phase)}});const C=e.dA(c.canonical),R=e.dB(C.getCenter().lat),A=e.dC(c.canonical,C,R,h.worldSize/h._pixelsPerMercatorPixel),D=e.bh(e.dD(c.canonical)),P=Or(h.expandedFarZProjMatrix,y,f,D,e.ah(h.zoom),m,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,d,h._farZ,A);if(u(c,I),l&&(i.setupElevationDraw(r,l,x),t.uploadCommonUniforms(n,l,c.toUnwrapped()),g)){const[e,i,o]=g.getGridBuffers(R,0!==d);l.draw(t,b,p,w,_,qi.backCCW,P,"globe_raster",e,i,o);}}}if(g&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const s=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];d&&s.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:s});for(const s of r){const{x:r,y:c,z:d}=s.canonical,u=0===c,f=c===(1<<d)-1,[y,b,w,T]=g.getPoleBuffers(d,!1);if(T&&(u||f)){const c=o.getTile(s);n.activeTexture.set(a.TEXTURE0),c.texture&&c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let g=e.dE(d,r,h);const E=e.bh(e.dD(s.canonical)),S=(e,i)=>e.draw(t,a.TRIANGLES,p,ji.disabled,_,qi.disabled,Or(h.expandedFarZProjMatrix,g,g,E,0,m,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,v,0,h._farZ),"globe_pole_raster",i,w,T);i.setupElevationDraw(c,l,x),t.uploadCommonUniforms(n,l,s.toUnwrapped()),u&&t.renderDefaultNorthPole&&S(l,y),f&&t.renderDefaultSouthPole&&(g=e.cP(e.bz(),g,[1,-1,1]),S(l,b));}}}}(t,i,o,r,s);else {const n=t.context,a=n.gl;let l,c;const h=t.shadowRenderer,d=eo(t,t.longestCutoffRange),u=e=>{if(c===e)return;const i=[];i.push(kr[e]),d.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),h&&(i.push("RENDER_SHADOWS","DEPTH_TEXTURE"),h.useNormalOffset&&i.push("NORMAL_OFFSET")),l=t.getOrCreateProgram("terrainRaster",{defines:i}),c=e;},_=t.colorModeForRenderPass(),p=new Ni(a.LEQUAL,Ni.ReadWrite,t.depthRangeFor3D);Br.update(s);const f=t.transform,m=Nr(f.zoom,i.exaggeration(),i.sourceCache._source.tileSize);let g=[0,0,0];if(h){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(g=ao(t.style,e,i));}{c=-1;const v=a.TRIANGLES,[y,x]=[i.gridIndexBuffer,i.gridSegments];for(const c of r){const r=o.getTile(c),b=ji.disabled,w=i.prevTerrainTileForTile[c.key],T=i.terrainTileForTile[c.key];Fr(w,T)&&Br.newMorphing(c.key,w,T,s,250),n.activeTexture.set(a.TEXTURE0),r.texture&&r.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const E=Br.getMorphValuesForProxy(c.key),S=E?1:0;let I;E&&(I={morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:e.dx(E.phase)}});const C=Mr(c.projMatrix,Ur(c.canonical,f.renderWorldCopies)?m/10:m,g);if(u(S),!l)continue;i.setupElevationDraw(r,l,I);const R=c.toUnwrapped();h&&h.setupShadows(R,l),t.uploadCommonUniforms(n,l,R,null,d),l.draw(t,v,p,b,_,qi.backCCW,C,"terrain_raster",i.gridBuffer,y,x);}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length));}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,o=this.painter.context,r=this.proxySourceCache,s=this.proxiedCoords[r.id],n=this._drapedRenderBatches.shift(),a=i.style.order,l=[];let c=0;for(const h of s){const s=r.getTileByID(h.proxyTileKey),d=r.proxyCachedFBO[h.key]?r.proxyCachedFBO[h.key][t]:void 0,u=void 0!==d?r.renderCache[d]:this.pool[c++],_=void 0!==d;if(s.texture=u.tex,_&&!u.dirty){l.push(s.tileID);continue}let p;o.bindFramebuffer.set(u.fb.framebuffer),this.renderedToTile=!1,u.dirty&&(o.clear({color:e.am.transparent,stencil:0}),u.dirty=!1);for(let e=n.start;e<=n.end;++e){const t=i.style._mergedLayers[a[e]];if(t.isHidden(i.transform.zoom))continue;const r=i.style.getLayerSourceCache(t),s=r?this.proxyToSource[h.key][r.id]:[h];if(!s)continue;const n=s;o.viewport.set([0,0,u.fb.width,u.fb.height]),p!==(r?r.id:null)&&(this._setupStencil(u,s,t,r),p=r?r.id:null),i.renderLayer(i,r,t,n);}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=i.style._mergedLayers[a[e]];if(t.isHidden(i.transform.zoom))continue;const r=i.style.getLayerSourceCache(t),s=r?this.proxyToSource[h.key][r.id]:[h];if(!s)continue;const n=s;o.viewport.set([0,0,u.fb.width,u.fb.height]),p!==(r?r.id:null)&&(this._setupStencil(u,s,t,r),p=r?r.id:null),i.renderLayer(i,r,t,n);}this.renderedToTile?(u.dirty=!0,l.push(s.tileID)):_||--c,5===c&&(c=0,this.renderToBackBuffer(l));}return this.renderToBackBuffer(l),this.renderingToTexture=!1,o.bindFramebuffer.set(null),o.viewport.set([0,0,i.width,i.height]),n.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let i=-1,o=t;for(let r=0;r<t;++r)this._style.isLayerDraped(e._mergedLayers[e.order[r]])?i=Math.max(i,r):o=Math.min(o,r);return o>i}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0]);})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const o=this._visibleDemTiles.filter((e=>e.dem)).map((o=>{const r=o.tileID,s=1<<r.overscaledZ,{x:n,y:a}=r.canonical,l=n/s,c=(n+1)/s,h=a/s,d=(a+1)/s;return {minx:l,miny:h,maxx:c,maxy:d,t:o.dem.tree.raycastRoot(l,h,c,d,e,t,i),tile:o}}));o.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const r of o){if(null==r.t)return null;const o=r.tile.dem.tree.raycast(r.minx,r.miny,r.maxx,r.maxy,e,t,i);if(null!=o)return o}return null}_createFBO(){const t=this.painter.context,i=t.gl,o=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const r=new e.T(t,{width:o[0],height:o[1],data:null},i.RGBA8);r.bind(i.LINEAR,i.CLAMP_TO_EDGE);const s=t.createFramebuffer(o[0],o[1],!0,null);return s.colorAttachment.set(r.texture),s.depthAttachment=new zr(t,s.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,o[0],o[1]),this._stencilRef=0,s.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):s.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:s,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO());}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return !0;if(this._style.hasLightTransitions())return !0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return !0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],i=t.isHidden(this.painter.transform.zoom);return "hillshade"===t.type||"custom"===t.type?!i&&t.shouldRedrape():!i&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof it){t=!0;break}if(!t)return;const i={};for(let t=0;t<this._style.order.length;++t){const o=this._style._mergedLayers[this._style.order[t]],r=this._style.getLayerSourceCache(o);if(r&&!i[r.id]&&!o.isHidden(this.painter.transform.zoom)&&"line"===o.type&&o.widthExpression()instanceof e.ab){i[r.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t)this._clearRenderCacheForTile(r.id,e);}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t]._source instanceof ot){e=!0;break}if(!e)return;const t={};for(let e=0;e<this._style.order.length;++e){const i=this._style._mergedLayers[this._style.order[e]],o=this._style.getLayerSourceCache(i);if(!o||t[o.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const r=i.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][o.id];if(t)for(const e of t){const t=Gr(o.getTile(e),o.findLoadedParent(e,0),o,this.painter.transform,r);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(o.id,e);}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,i=t.length;if(0===i)return;const o=[];this._pendingGroundEffectLayers=[];let r,s=0,n=this._style._mergedLayers[t[s]];for(;!this._style.isLayerDraped(n)&&n.isHidden(this.painter.transform.zoom)&&++s<i;)n=this._style._mergedLayers[t[s]];for(;s<i;++s){const e=this._style._mergedLayers[t[s]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===r&&(r=s):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(s),void 0!==r&&(o.push({start:r,end:s-1}),r=void 0)));}if(void 0!==r&&o.push({start:r,end:s-1}),0!==o.length){const t=o[o.length-1];this._pendingGroundEffectLayers.every((e=>e>t.end))||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.");}this._drapedRenderBatches=o;}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const o=Object.values(e[i]);t.renderCachePool.push(...o);}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,o=this._tilesDirty;for(let r=i.length-1;r>=0;r--){const s=i[r];if(t.getTileByID(s.key),void 0!==t.proxyCachedFBO[s.key]){const i=e[s.key],r=this.proxyToSource[s.key];let n=0;for(const e in r){const t=r[e],s=i[e];if(!s||s.length!==t.length||t.some(((t,i)=>t!==s[i]||o[e]&&o[e].hasOwnProperty(t.key)))){n=-1;break}++n;}for(const e in t.proxyCachedFBO[s.key])t.renderCache[t.proxyCachedFBO[s.key][e]].dirty=n<0||n!==Object.values(i).length;}}const r=[...this._drapedRenderBatches];r.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const e of r)for(const o of i){if(t.proxyCachedFBO[o.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[o.key]={},t.proxyCachedFBO[o.key][e.start]=i,t.renderCache[i].dirty=!0);}this._tilesDirty={};}_setupStencil(e,t,i,o){if(!o||!this._sourceTilesOverlap[o.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const r=this.painter.context,s=r.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let n;if(i.isTileClipped())n=t.length,this._overlapStencilMode.test={func:s.EQUAL,mask:255},this._overlapStencilType="Clip";else {if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);n=1,this._overlapStencilMode.test={func:s.GREATER,mask:255},this._overlapStencilType="Mask";}this._stencilRef+n>255&&(r.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=n,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref);}clipOrMaskOverlapStencilType(){return "Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):ji.disabled}_renderTileClippingMasks(e,t){const i=this.painter,o=this.painter.context,r=o.gl;i._tileClippingMaskIDs={},o.setColorMode(ki.disabled),o.setDepthMode(Ni.disabled);const s=i.getOrCreateProgram("clippingMask");for(const o of e){const e=i._tileClippingMaskIDs[o.key]=--t;s.draw(i,r.TRIANGLES,Ni.disabled,new ji({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),ki.disabled,qi.disabled,jr(o.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments);}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const o=[t.x,t.y,1,1];e.aA(o,o,i.pixelMatrixInverse),e.cH(o,o,1/o[3]),o[0]/=i.worldSize,o[1]/=i.worldSize;const r=i._camera.position,s=e.cb(1,i.center.lat),n=[r[0],r[1],r[2]/s,0],a=e.d7([],o.slice(0,3),n);e.au(a,a);const l=this.raycast(n,a,this._exaggeration);return null!==l&&l?(e.bE(n,n,a,l),n[3]=n[2],n[2]*=s,n):null}_setupProxiedCoordsForOrtho(t,i,o){if(t.getSource()instanceof e.aP)return this._setupProxiedCoordsForImageSource(t,i,o);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const r=this.proxiedCoords[t.id]=[],s=this.proxyCoords;for(let e=0;e<s.length;e++){const i=s[e],n=this._findTileCoveringTileID(i,t);if(n){const e=this._createProxiedId(i,n,o[i.key]&&o[i.key][t.id]);r.push(e),this.proxyToSource[i.key][t.id]=[e];}}let n=!1;const a=new Set;for(let e=0;e<i.length;e++){const s=t.getTile(i[e]);if(!s||!s.hasData())continue;const l=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==s.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],i=this._createProxiedId(l.tileID,s,o[l.tileID.key]&&o[l.tileID.key][t.id]);e?e.splice(e.length-1,0,i):this.proxyToSource[l.tileID.key][t.id]=[i];const c=this.proxyToSource[l.tileID.key][t.id];a.has(c)||a.add(c),r.push(i),n=!0;}}if(this._sourceTilesOverlap[t.id]=n,n&&this._debugParams.sortTilesHiZFirst)for(const e of a)e.sort(((e,t)=>t.overscaledZ-e.overscaledZ));}_setupProxiedCoordsForImageSource(t,i,o){if(!t.getSource().loaded())return;const r=this.proxiedCoords[t.id]=[],s=this.proxyCoords,n=t.getSource(),a=n.tileID;if(!a)return;const l=new e.P(a.x,a.y)._div(1<<a.z),c=n.coordinates.map(e.ac.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e)),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),h=(t,i)=>{const o=t.wrap+t.canonical.x/(1<<t.canonical.z),r=t.canonical.y/(1<<t.canonical.z),s=e.aj/(1<<t.canonical.z),n=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return o+s<n+c.min.x||o>n+c.max.x||r+s<a+c.min.y||r>a+c.max.y};for(let e=0;e<s.length;e++){const n=s[e];for(let e=0;e<i.length;e++){const s=t.getTile(i[e]);if(!s||!s.hasData())continue;if(h(n,s.tileID))continue;const a=this._createProxiedId(n,s,o[n.key]&&o[n.key][t.id]),l=this.proxyToSource[n.key][t.id];l?l.push(a):this.proxyToSource[n.key][t.id]=[a],r.push(a);}}}_createProxiedId(t,i,o){let r=this.orthoMatrix;if(o){const e=o.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const o=t.canonical.z-i.tileID.canonical.z;let s,n,a;r=e.bz();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;o>0?(s=e.aj>>o,n=s*((i.tileID.canonical.x<<o)-t.canonical.x+l),a=s*((i.tileID.canonical.y<<o)-t.canonical.y)):(s=e.aj<<-o,n=e.aj*(i.tileID.canonical.x-(t.canonical.x+l<<-o)),a=e.aj*(i.tileID.canonical.y-(t.canonical.y<<-o))),e.ca(r,0,s,0,s,0,1),e.bo(r,r,[n,a,0]);}return new Hr(i.tileID,t.key,r)}_findTileCoveringTileID(t,i){let o=i.getTile(t);if(o&&o.hasData())return o;const r=this._findCoveringTileCache[i.id],s=r[t.key];if(o=s?i.getTileByID(s):null,o&&o.hasData()||null===s)return o;let n=o?o.tileID:t,a=n.overscaledZ;const l=i.getSource().minzoom,c=[];if(!s){const r=i.getSource().maxzoom;if(t.canonical.z>=r){const o=t.canonical.z-r;i.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,i.transform.tileZoom),n=new e.aM(a,t.wrap,r,t.canonical.x>>o,t.canonical.y>>o)):0!==o&&(a=r,n=new e.aM(a,t.wrap,r,t.canonical.x>>o,t.canonical.y>>o));}n.key!==t.key&&(c.push(n.key),o=i.getTile(n));}const h=e=>{c.forEach((t=>{r[t]=e;})),c.length=0;};for(a-=1;a>=l&&(!o||!o.hasData());a--){o&&h(o.tileID.key);const e=n.calculateScaledKey(a);if(o=i.getTileByID(e),o&&o.hasData())break;const t=r[e];if(null===t)break;void 0===t?c.push(e):o=i.getTileByID(t);}return h(o?o.tileID.key:null),o&&o.hasData()?o:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0;}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0;}}function Wr(t,i,o){const r=function(t,i,o){const r=e.bG(i,t),s=e.bG(o,[.2126,.7152,.0722]),n=(e,t,i)=>(1-i)*e+i*t,a=n(1-.3*Math.min(s,1),1,Math.min(r+1,1));return n(.92,1,Math.asin(e.ay(i[2],-1,1))/Math.PI+.5)*a}(t,[0,0,1],i),s=[0,0,0];e.c1(s,o.slice(0,3),r);const n=[0,0,0];e.c1(n,i.slice(0,3),t[2]);const a=[0,0,0];return e.d5(a,s,n),e.d8(a)}const $r=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Xr=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Yr{static cacheKey(e,t,i,o){let r=`${t}${o?o.cacheKey:""}`;for(const t of i)e.usedDefines.includes(t)&&(r+=`/${t}`);return r}constructor(t,i,o,r,s,n){const a=t.gl;this.program=a.createProgram(),this.configuration=r,this.name=i,this.fixedDefines=[...n];const l=r?r.getBinderAttributes():[],c=(o.staticAttributes||[]).concat(l);let h=r?r.defines():[];h=h.concat(n.map((e=>`#define ${e}`)));const d="#version 300 es\n";let u=d+h.concat("precision mediump float;",Go,jo.fragmentSource).join("\n");for(const e of o.fragmentIncludes)u+=`\n${No[e]}`;u+=`\n${o.fragmentSource}`;let _=d+h.concat("precision highp float;",Go,jo.vertexSource).join("\n");for(const e of o.vertexIncludes)_+=`\n${No[e]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&-1!==o.vertexSource.indexOf("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&(_+="\nuniform int u_instanceID;\n"),_+=`\n${o.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(_=_.replaceAll("gl_InstanceID","u_instanceID"));const p=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(p,u),a.compileShader(p),a.attachShader(this.program,p);const f=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else {a.shaderSource(f,_),a.compileShader(f),a.attachShader(this.program,f),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:`a_${c[e]}`;a.bindAttribLocation(this.program,e,t),this.attributes[t]=e;}a.linkProgram(this.program),a.deleteShader(f),a.deleteShader(p),this.fixedUniforms=s(t),this.binderUniforms=r?r.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(t=>({u_instanceID:new e.cd(t)}))(t)),(n.includes("TERRAIN")||-1!==i.indexOf("symbol")||-1!==i.indexOf("circle"))&&(this.terrainUniforms=(t=>({u_dem:new e.cd(t),u_dem_prev:new e.cd(t),u_dem_tl:new e.cg(t),u_dem_scale:new e.cf(t),u_dem_tl_prev:new e.cg(t),u_dem_scale_prev:new e.cf(t),u_dem_size:new e.cf(t),u_dem_lerp:new e.cf(t),u_exaggeration:new e.cf(t),u_depth:new e.cd(t),u_depth_size_inv:new e.cg(t),u_depth_range_unpack:new e.cg(t),u_occluder_half_size:new e.cf(t),u_occlusion_depth_offset:new e.cf(t),u_meter_to_dem:new e.cf(t),u_label_plane_matrix_inv:new e.ch(t)}))(t)),n.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.ce(t),u_tile_tr_up:new e.ce(t),u_tile_br_up:new e.ce(t),u_tile_bl_up:new e.ce(t),u_tile_up_scale:new e.cf(t)}))(t)),n.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.ch(t),u_fog_range:new e.cg(t),u_fog_color:new e.d0(t),u_fog_horizon_blend:new e.cf(t),u_fog_vertical_limit:new e.cg(t),u_fog_temporal_offset:new e.cf(t),u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_globe_pos:new e.ce(t),u_globe_radius:new e.cf(t),u_globe_transition:new e.cf(t),u_is_globe:new e.cd(t),u_viewport:new e.cg(t)}))(t)),n.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.d0(t)}))(t)),n.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.ce(t),u_lighting_directional_dir:new e.ce(t),u_lighting_directional_color:new e.ce(t),u_ground_radiance:new e.ce(t)}))(t)),n.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.ch(t),u_light_matrix_1:new e.ch(t),u_fade_range:new e.cg(t),u_shadow_normal_offset:new e.ce(t),u_shadow_intensity:new e.cf(t),u_shadow_texel_size:new e.cf(t),u_shadow_map_resolution:new e.cf(t),u_shadow_direction:new e.ce(t),u_shadow_bias:new e.ce(t),u_shadowmap_0:new e.cd(t),u_shadowmap_1:new e.cd(t)}))(t));}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e]);}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e]);}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e]);}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e]);}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e]);}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e]);}_drawDebugWireframe(t,i,o,r,s,n,a,l,c,h){const d=t.options.wireframe;if(!1===d.terrain&&!1===d.layers2D&&!1===d.layers3D)return;const u=t.context;if(!(()=>!(!d.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!d.layers2D||t._terrain&&t._terrain.renderingToTexture||!$r.includes(this.name))||!(!d.layers3D||!Xr.includes(this.name)))())return;const _=u.gl,p=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,s,u);if(!p)return;const f=[...this.fixedDefines];f.push("DEBUG_WIREFRAME");const m=t.getOrCreateProgram(this.name,{config:this.configuration,defines:f});u.program.set(m.program);const g=(e,t,i)=>{if(t[e]&&i[e])for(const o in t[e])i[e][o]&&i[e][o].set(i.program,o,t[e][o].current);};c&&c.setUniforms(m.program,u,m.binderUniforms,a,{zoom:l}),g("fixedUniforms",this,m),g("terrainUniforms",this,m),g("globeUniforms",this,m),g("fogUniforms",this,m),g("lightsUniforms",this,m),g("shadowUniforms",this,m),p.bind(),u.setColorMode(new ki([_.ONE,_.ONE_MINUS_SRC_ALPHA,_.ZERO,_.ONE],e.am.transparent,[!0,!0,!0,!1])),u.setDepthMode(new Ni(i.func===_.LESS?_.LEQUAL:i.func,Ni.ReadOnly,i.range)),u.setStencilMode(ji.disabled);const v=3*n.primitiveLength*2,y=3*n.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const e=h||1;for(let t=0;t<e;++t)m.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",t),_.drawElements(_.LINES,v,_.UNSIGNED_SHORT,y);}else h&&h>1?_.drawElementsInstanced(_.LINES,v,_.UNSIGNED_SHORT,y,h):_.drawElements(_.LINES,v,_.UNSIGNED_SHORT,y);s.bind(),u.program.set(this.program),u.setDepthMode(i),u.setStencilMode(o),u.setColorMode(r);}checkUniforms(e,t,i){if(this.fixedDefines.includes(t))for(const o of Object.keys(i))if(!i[o].initialized)throw new Error(`Program '${this.name}', from draw '${e}': uniform ${o} not set but required by ${t} being defined`)}draw(e,t,i,o,r,s,n,a,l,c,h,d,u,_,p,f){const m=e.context,g=m.gl;if(this.failedToCreate)return;m.program.set(this.program),m.setDepthMode(i),m.setStencilMode(o),m.setColorMode(r),m.setCullFace(s);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(this.program,e,n[e]);_&&_.setUniforms(this.program,m,this.binderUniforms,d,{zoom:u});const v={[g.POINTS]:1,[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[t];this.checkUniforms(a,"RENDER_SHADOWS",this.shadowUniforms);const y=f&&f>0?1:void 0;for(const s of h.get()){const n=s.vaos||(s.vaos={});if((n[a]||(n[a]=new Zo)).bind(m,this,l,_?_.getPaintVertexBuffers():[],c,s.vertexOffset,p||[],y),this.forceManualRenderingForInstanceIDShaders){const e=f||1;for(let i=0;i<e;++i)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",i),c?g.drawElements(t,s.primitiveLength*v,g.UNSIGNED_SHORT,s.primitiveOffset*v*2):g.drawArrays(t,s.vertexOffset,s.vertexLength);}else f&&f>1?g.drawElementsInstanced(t,s.primitiveLength*v,g.UNSIGNED_SHORT,s.primitiveOffset*v*2,f):c?g.drawElements(t,s.primitiveLength*v,g.UNSIGNED_SHORT,s.primitiveOffset*v*2):g.drawArrays(t,s.vertexOffset,s.vertexLength);t===g.TRIANGLES&&c&&this._drawDebugWireframe(e,i,o,r,c,s,d,u,_,f);}}}function Kr(t,i,o=0){const r=Math.pow(2,i.tileID.overscaledZ),s=i.tileSize*Math.pow(2,t.transform.tileZoom)/r,n=s*(i.tileID.canonical.x+i.tileID.wrap*r),a=s*i.tileID.canonical.y;return {u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.aw(i,1,t.transform.tileZoom),u_pixel_coord_upper:[n>>16,a>>16],u_pixel_coord_lower:[65535&n,65535&a],u_pattern_transition:o}}const Jr={terrain:0,flat:1},Qr=e.bz(),es=(t,i,o,r,s,n,a,l,c,h,d,u,_,p,f,m,g,v)=>{const y=i.style.light,x=y.properties.get("position"),b=[x.x,x.y,x.z],w=e.dJ();"viewport"===y.properties.get("anchor")&&(e.dK(w,-i.transform.angle),e.dL(b,b,w));const T=y.properties.get("color").toPremultipliedRenderColor(null),E=i.transform,S={u_matrix:t,u_lightpos:b,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+o,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Jr[h],u_base_type:Jr[d],u_ao:s,u_edge_radius:n,u_width_scale:a,u_flood_light_color:f,u_vertical_scale:m,u_flood_light_intensity:g,u_ground_shadow_factor:v};return "globe"===E.projection.name&&(S.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],S.u_zoom_transition=u,S.u_inv_rot_matrix=p,S.u_merc_center=_,S.u_up_dir=E.projection.upVector(new e.cA(0,0,0),_[0]*e.aj,_[1]*e.aj),S.u_height_lift=c),S},ts=(e,t,i,o,r,s)=>({u_matrix:e,u_edge_radius:t,u_width_scale:i,u_vertical_scale:o,u_height_type:Jr[r],u_base_type:Jr[s]}),is=(t,i,o,r,s,n,a,l,c,h,d,u,_,p,f,m,g,v)=>{const y=es(t,i,o,r,s,n,a,l,h,d,u,_,p,f,m,g,1,[0,0,0]),x={u_height_factor:-Math.pow(2,l.overscaledZ)/c.tileSize/8};return e.h(y,Kr(i,c,v),x)},os=(e,t,i)=>({u_matrix:e,u_emissive_strength:t,u_ground_shadow_factor:i}),rs=(t,i,o,r,s,n=0)=>e.h(os(t,i,s),Kr(o,r,n)),ss=(e,t,i,o)=>({u_matrix:e,u_world:i,u_emissive_strength:t,u_ground_shadow_factor:o}),ns=(t,i,o,r,s,n,a=0)=>e.h(rs(t,i,o,r,n,a),{u_world:s}),as=(e,t)=>({u_matrix:e,u_ground_shadow_factor:t}),ls=(e,t,i,o,r)=>({u_matrix:e,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:i,u_height_scale:o,u_reset_depth:r}),cs=(e,t)=>({u_matrix:e,u_normal_matrix:t,u_opacity:1}),hs=e=>({u_matrix:e}),ds=e=>({u_matrix:e}),us=(t,i,o,r,s,n,a,l)=>{const c=e.aj/n.tileSize;return {u_matrix:t,u_inv_rot_matrix:i,u_camera_to_center_distance:o.getCameraToCenterDistance(l),u_extrude_scale:[o.pixelsToGLUnits[0]/c,o.pixelsToGLUnits[1]/c],u_zoom_transition:r,u_tile_id:a,u_merc_center:s}},_s=(e,t,i=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:i}),ps=e.bz(),fs=(t,i,o,r,s,n,a)=>{const l=t.transform,c="globe"===l.projection.name,h=c?e.dM(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:e.aw(o,1,n),d={u_matrix:i.projMatrix,u_extrude_scale:h,u_intensity:a,u_inv_rot_matrix:ps,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){d.u_inv_rot_matrix=r,d.u_merc_center=s,d.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],d.u_zoom_transition=e.ah(l.zoom);const t=s[0]*e.aj,o=s[1]*e.aj;d.u_up_dir=l.projection.upVector(new e.cA(0,0,0),t,o);}return d};function ms(e,[t,i,o,r],[s,n]){if(s===n)return [0,0,0,0];const a=255*(e-1)/(e*(n-s));return [t*a,i*a,o*a,r*a]}function gs(e,t,[i,o]){return i===o?0:.5/e+(t-i)*(e-1)/(e*(o-i))}const vs=(t,i,o,r,s,n,a,l,c,h,d,u,_,p,f,m,g,v,y,x,b)=>({u_matrix:t,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:r,u_grid_matrix:s,u_tl_parent:n,u_scale_parent:h,u_fade_t:d.mix,u_opacity:d.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:e.dO(u.paint.get("raster-saturation")),u_contrast_factor:e.dN(u.paint.get("raster-contrast")),u_spin_weights:ys(u.paint.get("raster-hue-rotate")),u_perspective_transform:_,u_raster_elevation:p,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:ms(e.dP,m,v),u_colorization_offset:gs(e.dP,g,v),u_color_ramp:f,u_texture_offset:[x/(y+2*x),y/(y+2*x)],u_texture_res:[y+2*x,y+2*x],u_emissive_strength:b});function ys(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return [(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const xs=.05,bs=(e,t,i,o,r,s,n,a,l,c,h,d)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:o,u_grid_matrix:r,u_tl_parent:s,u_scale_parent:c,u_fade_t:h.mix,u_opacity:h.opacity,u_image0:0,u_image1:1,u_raster_elevation:d,u_zoom_transition:n,u_merc_center:a,u_cutoff_params:l}),ws=(e,t,i,o,r,s,n,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:i,u_velocity:o,u_color_ramp:s,u_velocity_res:r,u_max_speed:n,u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[xs,xs]}),Ts=(e,t,i,o,r,s,n,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:i,u_velocity_res:o,u_max_speed:r,u_speed_factor:s,u_reset_rate:n,u_rand_seed:Math.random(),u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[xs,xs]}),Es=e.bz(),Ss=(t,i,o,r,s,n,a,l,c,h,d,u,_,p,f,m,g,v,y,x,b,w,T,E)=>{const S=s.transform,I={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:S.getCameraToCenterDistance(y),u_rotate_symbol:+o,u_aspect_ratio:S.width/S.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:n,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+h,u_elevation_from_sea:c?1:0,u_pitch_with_map:+r,u_texsize:d,u_texsize_icon:u,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Es,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Es,u_up_vector:[0,-1,0],u_color_adj_mat:w,u_icon_transition:T||0,u_gamma_scale:r?s.transform.getCameraToCenterDistance(y)*Math.cos(s.terrain?0:s.transform._pitch):1,u_device_pixel_ratio:e.q.devicePixelRatio,u_is_halo:1,u_scale_factor:E||1,u_ground_shadow_factor:x,u_inv_matrix:e.bi(e.bz(),a),u_normal_scale:b};return "globe"===y.name&&(I.u_tile_id=[p.canonical.x,p.canonical.y,1<<p.canonical.z],I.u_zoom_transition=f,I.u_inv_rot_matrix=g,I.u_merc_center=m,I.u_camera_forward=S._camera.forward(),I.u_ecef_origin=e.dQ(S.globeMatrix,p.toUnwrapped()),I.u_tile_matrix=Float32Array.from(S.globeMatrix),I.u_up_vector=v),I},Is=(e,t,i,o)=>({u_matrix:e,u_emissive_strength:t,u_opacity:i,u_color:o}),Cs=(t,i,o,r,s,n,a,l,c)=>e.h(function(t,i,o,r,s,n){const{width:a,height:l}=r.imageManager.getPixelSize(i),c=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,r.transform.tileZoom)/c,d=h*(n.tileID.canonical.x+n.tileID.wrap*c),u=h*n.tileID.canonical.y;return {u_image:0,u_pattern_tl:o.tl,u_pattern_br:o.br,u_texsize:[a,l],u_pattern_size:o.displaySize,u_pattern_units_to_pixels:s?[r.transform.width,-1*r.transform.height]:[1/e.aw(n,1,r.transform.tileZoom),1/e.aw(n,1,r.transform.tileZoom)],u_pixel_coord_upper:[d>>16,u>>16],u_pixel_coord_lower:[65535&d,65535&u]}}(0,n,a,r,l,c),{u_matrix:t,u_emissive_strength:i,u_opacity:o}),Rs=new Float32Array(e.bx([])),As=(t,i,o,r,s,n,a,l,c,h,d,u,_,p=[0,0,0],f)=>{const m=s.style.light,g=m.properties.get("position"),v=[-g.x,-g.y,g.z],y=e.dJ();"viewport"===m.properties.get("anchor")&&(e.dK(y,-s.transform.angle),e.dL(v,v,y));const x="MASK"===d.alphaMode,b=m.properties.get("color").toNonPremultipliedRenderColor(null),w=_.paint.get("model-ambient-occlusion-intensity"),T=_.paint.get("model-color").constantOr(e.am.white).toNonPremultipliedRenderColor(null);return T.a=_.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:t,u_lighting_matrix:i,u_normal_matrix:o,u_node_matrix:r||Rs,u_lightpos:v,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_camera_pos:p,u_opacity:n,u_baseTextureIsAlpha:0,u_alphaMask:+x,u_alphaCutoff:d.alphaCutoff,u_baseColorFactor:a.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:l.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:c,u_roughnessFactor:h,u_baseColorTexture:Yi.BaseColor,u_metallicRoughnessTexture:Yi.MetallicRoughness,u_normalTexture:Yi.Normal,u_occlusionTexture:Yi.Occlusion,u_emissionTexture:Yi.Emission,u_lutTexture:Yi.LUT,u_color_mix:T.toArray01(),u_aoIntensity:w,u_emissive_strength:u,u_occlusionTextureTransform:f||[0,0,0,0]}},Ds=(e,t=Rs,i=Rs)=>({u_matrix:e,u_instance:t,u_node_matrix:i}),Ps={fillExtrusion:t=>({u_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_vertical_gradient:new e.cf(t),u_opacity:new e.cf(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_ao:new e.cg(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_up_dir:new e.ce(t),u_height_lift:new e.cf(t),u_flood_light_color:new e.ce(t),u_vertical_scale:new e.cf(t),u_flood_light_intensity:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),fillExtrusionDepth:t=>({u_matrix:new e.ch(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_vertical_scale:new e.cf(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t)}),fillExtrusionPattern:t=>({u_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_vertical_gradient:new e.cf(t),u_height_factor:new e.cf(t),u_edge_radius:new e.cf(t),u_width_scale:new e.cf(t),u_ao:new e.cg(t),u_height_type:new e.cd(t),u_base_type:new e.cd(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_up_dir:new e.ce(t),u_height_lift:new e.cf(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_opacity:new e.cf(t),u_pattern_transition:new e.cf(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.ch(t),u_opacity:new e.cf(t),u_ao_pass:new e.cf(t),u_meter_to_tile:new e.cf(t),u_ao:new e.cg(t),u_flood_light_intensity:new e.cf(t),u_flood_light_color:new e.ce(t),u_attenuation:new e.cf(t),u_edge_radius:new e.cf(t),u_fb:new e.cd(t),u_fb_size:new e.cf(t),u_dynamic_offset:new e.cf(t)}),fill:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),fillPattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_pattern_transition:new e.cf(t)}),fillOutline:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_world:new e.cg(t),u_ground_shadow_factor:new e.ce(t)}),fillOutlinePattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_world:new e.cg(t),u_image:new e.cd(t),u_texsize:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_tile_units_to_pixels:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_pattern_transition:new e.cf(t)}),building:t=>({u_matrix:new e.ch(t),u_normal_matrix:new e.ch(t),u_opacity:new e.cf(t)}),buildingBloom:t=>({u_matrix:new e.ch(t)}),buildingDepth:t=>({u_matrix:new e.ch(t)}),elevatedStructuresDepth:t=>({u_matrix:new e.ch(t),u_depth_bias:new e.cf(t)}),elevatedStructures:t=>({u_matrix:new e.ch(t),u_ground_shadow_factor:new e.ce(t)}),elevatedStructuresDepthReconstruct:t=>({u_matrix:new e.ch(t),u_camera_pos:new e.ce(t),u_depth_bias:new e.cf(t),u_height_scale:new e.cf(t),u_reset_depth:new e.cf(t)}),circle:e.dT,collisionBox:t=>({u_matrix:new e.ch(t),u_inv_rot_matrix:new e.ch(t),u_camera_to_center_distance:new e.cf(t),u_extrude_scale:new e.cg(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_tile_id:new e.ce(t)}),collisionCircle:t=>({u_matrix:new e.ch(t),u_inv_matrix:new e.ch(t),u_camera_to_center_distance:new e.cf(t),u_viewport_size:new e.cg(t)}),debug:t=>({u_color:new e.dv(t),u_matrix:new e.ch(t),u_overlay:new e.cd(t),u_overlay_scale:new e.cf(t)}),clippingMask:t=>({u_matrix:new e.ch(t)}),heatmap:t=>({u_extrude_scale:new e.cf(t),u_intensity:new e.cf(t),u_matrix:new e.ch(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_up_dir:new e.ce(t)}),heatmapTexture:t=>({u_image:new e.cd(t),u_color_ramp:new e.cd(t),u_opacity:new e.cf(t)}),hillshade:t=>({u_matrix:new e.ch(t),u_image:new e.cd(t),u_latrange:new e.cg(t),u_light:new e.cg(t),u_shadow:new e.dv(t),u_highlight:new e.dv(t),u_emissive_strength:new e.cf(t),u_accent:new e.dv(t)}),hillshadePrepare:t=>({u_matrix:new e.ch(t),u_image:new e.cd(t),u_dimension:new e.cg(t),u_zoom:new e.cf(t)}),line:e.dS,linePattern:e.dR,raster:t=>({u_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_grid_matrix:new e.dw(t),u_tl_parent:new e.cg(t),u_scale_parent:new e.cf(t),u_fade_t:new e.cf(t),u_opacity:new e.cf(t),u_image0:new e.cd(t),u_image1:new e.cd(t),u_brightness_low:new e.cf(t),u_brightness_high:new e.cf(t),u_saturation_factor:new e.cf(t),u_contrast_factor:new e.cf(t),u_spin_weights:new e.ce(t),u_perspective_transform:new e.cg(t),u_raster_elevation:new e.cf(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_cutoff_params:new e.d0(t),u_colorization_mix:new e.d0(t),u_colorization_offset:new e.cf(t),u_color_ramp:new e.cd(t),u_texture_offset:new e.cg(t),u_texture_res:new e.cg(t),u_emissive_strength:new e.cf(t)}),rasterParticle:t=>({u_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_grid_matrix:new e.dw(t),u_tl_parent:new e.cg(t),u_scale_parent:new e.cf(t),u_fade_t:new e.cf(t),u_opacity:new e.cf(t),u_image0:new e.cd(t),u_image1:new e.cd(t),u_raster_elevation:new e.cf(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_cutoff_params:new e.d0(t)}),rasterParticleTexture:t=>({u_texture:new e.cd(t),u_opacity:new e.cf(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.cd(t),u_particle_texture_side_len:new e.cf(t),u_tile_offset:new e.cg(t),u_velocity:new e.cd(t),u_color_ramp:new e.cd(t),u_velocity_res:new e.cg(t),u_max_speed:new e.cf(t),u_uv_offset:new e.cg(t),u_data_scale:new e.cg(t),u_data_offset:new e.cf(t),u_particle_pos_scale:new e.cf(t),u_particle_pos_offset:new e.cg(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.cd(t),u_particle_texture_side_len:new e.cf(t),u_velocity:new e.cd(t),u_velocity_res:new e.cg(t),u_max_speed:new e.cf(t),u_speed_factor:new e.cf(t),u_reset_rate:new e.cf(t),u_rand_seed:new e.cf(t),u_uv_offset:new e.cg(t),u_data_scale:new e.cg(t),u_data_offset:new e.cf(t),u_particle_pos_scale:new e.cf(t),u_particle_pos_offset:new e.cg(t)}),symbol:t=>({u_is_size_zoom_constant:new e.cd(t),u_is_size_feature_constant:new e.cd(t),u_size_t:new e.cf(t),u_size:new e.cf(t),u_camera_to_center_distance:new e.cf(t),u_rotate_symbol:new e.cd(t),u_aspect_ratio:new e.cf(t),u_fade_change:new e.cf(t),u_matrix:new e.ch(t),u_label_plane_matrix:new e.ch(t),u_coord_matrix:new e.ch(t),u_is_text:new e.cd(t),u_elevation_from_sea:new e.cd(t),u_pitch_with_map:new e.cd(t),u_texsize:new e.cg(t),u_texsize_icon:new e.cg(t),u_texture:new e.cd(t),u_texture_icon:new e.cd(t),u_gamma_scale:new e.cf(t),u_device_pixel_ratio:new e.cf(t),u_tile_id:new e.ce(t),u_zoom_transition:new e.cf(t),u_inv_rot_matrix:new e.ch(t),u_merc_center:new e.cg(t),u_camera_forward:new e.ce(t),u_tile_matrix:new e.ch(t),u_up_vector:new e.ce(t),u_ecef_origin:new e.ce(t),u_is_halo:new e.cd(t),u_icon_transition:new e.cf(t),u_color_adj_mat:new e.ch(t),u_scale_factor:new e.cf(t),u_ground_shadow_factor:new e.ce(t),u_inv_matrix:new e.ch(t),u_normal_scale:new e.cf(t)}),background:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_opacity:new e.cf(t),u_color:new e.dv(t)}),backgroundPattern:t=>({u_matrix:new e.ch(t),u_emissive_strength:new e.cf(t),u_opacity:new e.cf(t),u_image:new e.cd(t),u_pattern_tl:new e.cg(t),u_pattern_br:new e.cg(t),u_texsize:new e.cg(t),u_pattern_size:new e.cg(t),u_pixel_coord_upper:new e.cg(t),u_pixel_coord_lower:new e.cg(t),u_pattern_units_to_pixels:new e.cg(t)}),terrainRaster:t=>({u_matrix:new e.ch(t),u_image0:new e.cd(t),u_skirt_height:new e.cf(t),u_ground_shadow_factor:new e.ce(t)}),skybox:t=>({u_matrix:new e.ch(t),u_sun_direction:new e.ce(t),u_cubemap:new e.cd(t),u_opacity:new e.cf(t),u_temporal_offset:new e.cf(t)}),skyboxGradient:t=>({u_matrix:new e.ch(t),u_color_ramp:new e.cd(t),u_center_direction:new e.ce(t),u_radius:new e.cf(t),u_opacity:new e.cf(t),u_temporal_offset:new e.cf(t)}),skyboxCapture:t=>({u_matrix_3f:new e.dw(t),u_sun_direction:new e.ce(t),u_sun_intensity:new e.cf(t),u_color_tint_r:new e.d0(t),u_color_tint_m:new e.d0(t),u_luminance:new e.cf(t)}),globeRaster:t=>({u_proj_matrix:new e.ch(t),u_globe_matrix:new e.ch(t),u_normalize_matrix:new e.ch(t),u_merc_matrix:new e.ch(t),u_zoom_transition:new e.cf(t),u_merc_center:new e.cg(t),u_image0:new e.cd(t),u_grid_matrix:new e.dw(t),u_skirt_height:new e.cf(t),u_far_z_cutoff:new e.cf(t),u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_globe_pos:new e.ce(t),u_globe_radius:new e.cf(t),u_viewport:new e.cg(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.ce(t),u_frustum_tr:new e.ce(t),u_frustum_br:new e.ce(t),u_frustum_bl:new e.ce(t),u_horizon:new e.cf(t),u_transition:new e.cf(t),u_fadeout_range:new e.cf(t),u_color:new e.d0(t),u_high_color:new e.d0(t),u_space_color:new e.d0(t),u_temporal_offset:new e.cf(t),u_horizon_angle:new e.cf(t)}),model:t=>({u_matrix:new e.ch(t),u_lighting_matrix:new e.ch(t),u_normal_matrix:new e.ch(t),u_node_matrix:new e.ch(t),u_lightpos:new e.ce(t),u_lightintensity:new e.cf(t),u_lightcolor:new e.ce(t),u_camera_pos:new e.ce(t),u_opacity:new e.cf(t),u_baseColorFactor:new e.d0(t),u_emissiveFactor:new e.d0(t),u_metallicFactor:new e.cf(t),u_roughnessFactor:new e.cf(t),u_baseTextureIsAlpha:new e.cd(t),u_alphaMask:new e.cd(t),u_alphaCutoff:new e.cf(t),u_baseColorTexture:new e.cd(t),u_metallicRoughnessTexture:new e.cd(t),u_normalTexture:new e.cd(t),u_occlusionTexture:new e.cd(t),u_emissionTexture:new e.cd(t),u_lutTexture:new e.cd(t),u_color_mix:new e.d0(t),u_aoIntensity:new e.cf(t),u_emissive_strength:new e.cf(t),u_occlusionTextureTransform:new e.d0(t)}),modelDepth:t=>({u_matrix:new e.ch(t),u_instance:new e.ch(t),u_node_matrix:new e.ch(t)}),groundShadow:t=>({u_matrix:new e.ch(t),u_ground_shadow_factor:new e.ce(t)}),stars:t=>({u_matrix:new e.ch(t),u_up:new e.ce(t),u_right:new e.ce(t),u_intensity_multiplier:new e.cf(t)}),snowParticle:t=>({u_modelview:new e.ch(t),u_projection:new e.ch(t),u_time:new e.cf(t),u_cam_pos:new e.ce(t),u_velocityConeAperture:new e.cf(t),u_velocity:new e.cf(t),u_horizontalOscillationRadius:new e.cf(t),u_horizontalOscillationRate:new e.cf(t),u_boxSize:new e.cf(t),u_billboardSize:new e.cf(t),u_simpleShapeParameters:new e.cg(t),u_screenSize:new e.cg(t),u_thinningCenterPos:new e.cg(t),u_thinningShape:new e.ce(t),u_thinningAffectedRatio:new e.cf(t),u_thinningParticleOffset:new e.cf(t),u_particleColor:new e.d0(t),u_direction:new e.ce(t)}),rainParticle:t=>({u_modelview:new e.ch(t),u_projection:new e.ch(t),u_time:new e.cf(t),u_cam_pos:new e.ce(t),u_texScreen:new e.cd(t),u_velocityConeAperture:new e.cf(t),u_velocity:new e.cf(t),u_boxSize:new e.cf(t),u_rainDropletSize:new e.cg(t),u_distortionStrength:new e.cf(t),u_rainDirection:new e.ce(t),u_color:new e.d0(t),u_screenSize:new e.cg(t),u_thinningCenterPos:new e.cg(t),u_thinningShape:new e.ce(t),u_thinningAffectedRatio:new e.cf(t),u_thinningParticleOffset:new e.cf(t),u_shapeDirectionalPower:new e.cf(t),u_shapeNormalPower:new e.cf(t),u_mode:new e.cf(t)}),vignette:t=>({u_vignetteShape:new e.ce(t),u_vignetteColor:new e.d0(t)}),occlusion:t=>({u_matrix:new e.ch(t),u_anchorPos:new e.ce(t),u_screenSizePx:new e.cg(t),u_occluderSizePx:new e.cg(t),u_color:new e.d0(t)})};class Ls{constructor(e,t,i,o){this.id=Ls.uniqueIdxCounter,Ls.uniqueIdxCounter++,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||o||t.destroy();}bind(){this.context.bindElementBuffer.set(this.buffer);}updateData(e){this.id=Ls.uniqueIdxCounter,Ls.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer);}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer);}}Ls.uniqueIdxCounter=0;const zs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ms{constructor(e,t,i,o,r,s){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=o,this.instanceCount=s,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),e.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||r||t.destroy();}bind(){this.context.bindVertexBuffer.set(this.buffer);}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer);}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const o=t.attributes[this.attributes[i].name];void 0!==o&&e.enableVertexAttribArray(o);}}setVertexAttribPointers(e,t,i){for(let o=0;o<this.attributes.length;o++){const r=this.attributes[o],s=t.attributes[r.name];void 0!==s&&e.vertexAttribPointer(s,r.components,e[zs[r.type]],!1,this.itemSize,r.offset+this.itemSize*(i||0));}}setVertexAttribDivisor(e,t,i){for(let o=0;o<this.attributes.length;o++){const r=t.attributes[this.attributes[o].name];void 0!==r&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(r,i);}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer);}}class Os{constructor(e,t,i,o,r){this.context=e,this.width=t,this.height=i;const s=this.framebuffer=e.gl.createFramebuffer();o&&(this.colorAttachment=new Dr(e,s)),r&&(this.depthAttachmentType=r,this.depthAttachment="renderbuffer"===r?new Pr(e,s):new Lr(e,s));}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t);}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t);}else {const t=this.depthAttachment.get();t&&e.deleteTexture(t);}e.deleteFramebuffer(this.framebuffer);}}class Fs{constructor(e,t){this.gl=e,this.clearColor=new Jo(this),this.clearDepth=new Qo(this),this.clearStencil=new er(this),this.colorMask=new tr(this),this.depthMask=new ir(this),this.stencilMask=new or(this),this.stencilFunc=new rr(this),this.stencilOp=new sr(this),this.stencilTest=new nr(this),this.depthRange=new ar(this),this.depthTest=new lr(this),this.depthFunc=new cr(this),this.blend=new hr(this),this.blendFunc=new dr(this),this.blendColor=new ur(this),this.blendEquation=new _r(this),this.cullFace=new pr(this),this.cullFaceSide=new fr(this),this.frontFace=new mr(this),this.program=new gr(this),this.activeTexture=new vr(this),this.viewport=new yr(this),this.bindFramebuffer=new xr(this),this.bindRenderbuffer=new br(this),this.bindTexture=new wr(this),this.bindVertexBuffer=new Tr(this),this.bindElementBuffer=new Er(this),this.bindVertexArrayOES=new Sr(this),this.pixelStoreUnpack=new Ir(this),this.pixelStoreUnpackPremultiplyAlpha=new Cr(this),this.pixelStoreUnpackFlipY=new Rr(this),this.options=t?Object.assign({},t):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=t&&!!t.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1];}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault();}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0;}createIndexBuffer(e,t,i){return new Ls(this,e,t,i)}createVertexBuffer(e,t,i,o,r){return new Ms(this,e,t,i,o,r)}createRenderbuffer(e,t,i){const o=this.gl,r=o.createRenderbuffer();return this.bindRenderbuffer.set(r),o.renderbufferStorage(o.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,i,o){return new Os(this,e,t,i,o)}clear({color:e,depth:t,stencil:i,colorMask:o}){const r=this.gl;let s=0;e&&(s|=r.COLOR_BUFFER_BIT,this.clearColor.set(e.toNonPremultipliedRenderColor(null)),this.colorMask.set(o||[!0,!0,!0,!0])),void 0!==t&&(s|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==i&&(s|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),r.clear(s);}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace));}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1);}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1);}setColorMode(t){e.bv(t.blendFunction,ki.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask);}unbindVAO(){this.bindVertexArrayOES.set(null);}}let Bs;function ks(t,i,o,r,s,n,a){const l=t.context,c=l.gl,h=t.transform,d=[e.aD(h.center.lng),e.aH(h.center.lat)],u=o.layout.get("symbol-placement"),_=o.layout.get("text-variable-anchor"),p="map"===o.layout.get("icon-rotation-alignment"),f="map"===o.layout.get("text-rotation-alignment"),m="point"!==u,g=[];let v=0,y=0;for(let l=0;l<r.length;l++){const u=r[l],x=i.getTile(u),b=x.getBucket(o);if(!b)continue;const w=b.getProjection().createInversionMatrix(h,u.canonical),T=[],E=Gt(u,b,h),S=!a&&p&&m,I=a&&f&&m,C=_&&b.hasTextData(),R=b.hasIconTextFit()&&C&&b.hasIconData(),A=S||I||a&&C||R,D="globe"===b.projection.name,P=D?e.ah(h.zoom):0;D&&(T.push("PROJECTION_GLOBE_VIEW"),A&&T.push("PROJECTED_POS_ON_VIEWPORT"));const L=t.getOrCreateProgram("collisionBox",{defines:T});let z=E;0===s[0]&&0===s[1]||(z=t.translatePosMatrix(E,x,s,n));const M=a?b.textCollisionBox:b.iconCollisionBox,O=b.collisionCircleArray;if(O.length>0){const t=e.bz(),i=z;e.cM(t,b.placementInvProjMatrix,h.glCoordMatrix),e.cM(t,t,b.placementViewportMatrix),g.push({circleArray:O,circleOffset:y,transform:i,invTransform:t,projection:b.getProjection()}),v+=O.length/4,y=v;}if(!M)continue;t.terrain&&t.terrain.setupElevationDraw(x,L);const F=D?[u.canonical.x,u.canonical.y,1<<u.canonical.z]:[0,0,0];L.draw(t,c.LINES,Ni.disabled,ji.disabled,t.colorModeForRenderPass(),qi.disabled,us(z,w,h,P,d,x,F,b.getProjection()),o.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,null,h.zoom,null,[M.collisionVertexBuffer,M.collisionVertexBufferExt]);}if(!a||!g.length)return;const x=t.getOrCreateProgram("collisionCircle"),b=new e.dU;b.resize(4*v),b._trim();let w=0;for(const e of g)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,o=e.circleArray[i+0],r=e.circleArray[i+1],s=e.circleArray[i+2],n=e.circleArray[i+3];b.emplace(w++,o,r,s,n,0),b.emplace(w++,o,r,s,n,1),b.emplace(w++,o,r,s,n,2),b.emplace(w++,o,r,s,n,3);}(!Bs||Bs.length<2*v)&&(Bs=function(t){const i=2*t,o=new e.a_;o.resize(i),o._trim();for(let e=0;e<i;e++){const t=6*e;o.uint16[t+0]=4*e+0,o.uint16[t+1]=4*e+1,o.uint16[t+2]=4*e+2,o.uint16[t+3]=4*e+2,o.uint16[t+4]=4*e+3,o.uint16[t+5]=4*e+0;}return o}(v));const T=l.createIndexBuffer(Bs,!0),E=l.createVertexBuffer(b,e.dV.members,!0);for(const i of g){const r={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(S=h).getCameraToCenterDistance(i.projection),u_viewport_size:[S.width,S.height]};x.draw(t,c.TRIANGLES,Ni.disabled,ji.disabled,t.colorModeForRenderPass(),qi.disabled,r,o.id,E,T,e.bd.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,h.zoom);}var S;E.destroy(),T.destroy();}const Ns=e.bz();function Us(t){const i=t._camera.getWorldToCamera(t.worldSize,1),o=e.az([],i,t.globeMatrix);e.bi(o,o);const r=[0,0,0],s=[0,1,0,0];return e.aA(s,s,o),r[0]=s[0],r[1]=s[1],r[2]=s[2],e.au(r,r),r}function js({width:t,height:i,anchor:o,textOffset:r,textScale:s},n){const{horizontalAlign:a,verticalAlign:l}=e.bZ(o),c=-(a-.5)*t,h=-(l-.5)*i,d=e.b_(o,r);return new e.P((c/s+d[0])*n,(h/s+d[1])*n)}function Gs(t,i,o,r,s,n,a,l,c,h){const d=t.text.placedSymbolArray,u=t.text.dynamicLayoutVertexArray,_=t.icon.dynamicLayoutVertexArray,p={},f=t.getProjection(),m=Vt(a,f,s),g=s.elevation,v=f.upVectorScale(a.canonical,s.center.lat,s.worldSize).metersToTile;u.clear();for(let _=0;_<d.length;_++){const y=d.get(_),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=y,T=y.hidden||!y.crossTileID||t.allowVerticalPlacement&&!y.placedOrientation?null:r[y.crossTileID];if(T){let r=0,d=0,_=0;if(g){const e=g?g.getAtTileOffset(a,x,b):0,[t,i,o]=f.upVector(a.canonical,x,b);r=e*t*v,d=e*i*v,_=e*o*v;}let[E,S,I,C]=Kt(y.projectedAnchorX+r,y.projectedAnchorY+d,y.projectedAnchorZ+_,o?m:n);const R=Jt(s.getCameraToCenterDistance(f),C);let A=e.bJ(t.textSizeData,c,y)*R/e.bU;o&&(A*=t.tilePixelRatio/l);const D=js(T,A);o?(({x:E,y:S,z:I}=f.projectTilePoint(x+D.x,b+D.y,a.canonical)),[E,S,I]=Kt(E+r,S+d,I+_,n)):(i&&D._rotate(-s.angle),E+=D.x,S+=D.y,I=0);const P=t.allowVerticalPlacement&&y.placedOrientation===e.bI.vertical?Math.PI/2:0;for(let t=0;t<w;t++)e.bL(u,E,S,I,P);h&&y.associatedIconIndex>=0&&(p[y.associatedIconIndex]={x:E,y:S,z:I,angle:P});}else ai(w,u);}if(h){_.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const o=i.get(t),{numGlyphs:r}=o,s=p[t];if(o.hidden||!s)ai(r,_);else {const{x:t,y:i,z:o,angle:n}=s;for(let s=0;s<r;s++)e.bL(_,t,i,o,n);}}t.icon.dynamicLayoutVertexBuffer.updateData(_);}t.text.dynamicLayoutVertexBuffer.updateData(u);}function Vs(t,i,o,r,s,n,a={}){const l=o.paint.get("icon-translate"),c=o.paint.get("text-translate"),h=o.paint.get("icon-translate-anchor"),d=o.paint.get("text-translate-anchor"),u=o.layout.get("icon-rotation-alignment"),_=o.layout.get("text-rotation-alignment"),p=o.layout.get("icon-pitch-alignment"),f=o.layout.get("text-pitch-alignment"),m=o.layout.get("icon-keep-upright"),g=o.layout.get("text-keep-upright"),v=o.paint.get("icon-color-saturation"),y=o.paint.get("icon-color-contrast"),x=o.paint.get("icon-color-brightness-min"),b=o.paint.get("icon-color-brightness-max"),w="sea"===o.layout.get("symbol-elevation-reference"),T=t.context,E=T.gl,S=t.transform,I="map"===u,C="map"===_,R="map"===p,A="map"===f,D=void 0!==o.layout.get("symbol-sort-key").constantOr(1);let P=!1;const L=t.depthModeForSublayer(0,Ni.ReadOnly),z=new Ni(t.context.gl.LEQUAL,Ni.ReadOnly,t.depthRangeFor3D),M=[e.aD(S.center.lng),e.aH(S.center.lat)],O=o.layout.get("text-variable-anchor"),F="globe"===S.projection.name,B=[],k=[0,-1,0];for(const s of r){const r=i.getTile(s),n=r.getBucket(o);if(!n)continue;if("mercator"===n.projection.name&&F)continue;if(n.fullyClipped)continue;const u="globe"===n.projection.name,_=u?e.ah(S.zoom):0,p=Vt(s,n.getProjection(),S),f=S.calculatePixelsToTileUnitsMatrix(r),T=O&&n.hasTextData(),N=n.hasIconTextFit()&&T&&n.hasIconData(),U=n.getProjection().createInversionMatrix(S,s.canonical),j=(1<<r.tileID.canonical.z)*e.aj/t.transform.worldSize,G=e=>{let i=[0,0,0];if(e){const e=t.style.directionalLight,o=t.style.ambientLight;e&&o&&(i=ao(t.style,e,o));}return i},V=e=>{S.depthOcclusionForSymbolsAndCircles&&(o.hasInitialOcclusionOpacityProperties||t.terrain)&&(e.push("DEPTH_D24"),e.push("DEPTH_OCCLUSION"));},q=()=>{const i=I&&"point"!==o.layout.get("symbol-placement"),a=[];V(a);const c=i||N,d="road"===n.elevationType,g=t.shadowRenderer,T=d&&R&&!!g&&g.enabled,C=G(T),A=d&&R&&!t.terrain?z:L,D=o.paint.get("icon-image-cross-fade");t.terrainRenderModeElevated()&&R&&a.push("PITCH_WITH_MAP_TERRAIN"),u&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),D>0&&n.hasAnySecondaryIcon&&a.push("ICON_TRANSITION"),!n.icon.zOffsetVertexBuffer||d&&t.terrain||a.push("Z_OFFSET"),0===v&&0===y&&0===x&&1===b||a.push("COLOR_ADJUSTMENT"),n.sdfIcons&&a.push("RENDER_SDF"),T&&a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),d&&R&&!t.terrain&&n.icon.orientationVertexBuffer&&a.push("ELEVATED_ROADS");const P=n.icon.programConfigurations.get(o.id),O=t.getOrCreateProgram("symbol",{config:P,defines:a}),B=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],q=n.iconSizeData,H=e.bH(q,S.zoom),Z=R||!S.isOrthographic,W=$t(p,r.tileID.canonical,R,I,S,n.getProjection(),f),$=Yt(p,r.tileID.canonical,R,I,S,n.getProjection(),f),X=t.translatePosMatrix($,r,l,h,!0),Y=t.translatePosMatrix(p,r,l,h),K=c?Ns:W,J=I&&!R&&!i;let Q=k;!F&&!S.mercatorFromTransition||I||(Q=Us(S));const ee=u?Q:k,te=o.getColorAdjustmentMatrix(v,y,x,b),ie=Ss(q.kind,H,J,R,t,Y,K,X,w,!1,B,[0,0],0,s,_,M,U,ee,n.getProjection(),C,j,te,D,null),oe=r.imageAtlasTexture?r.imageAtlasTexture:null,re=1!==o.layout.get("icon-size").constantOr(0)||n.iconsNeedLinear,se=n.sdfIcons||t.options.rotating||t.options.zooming||re||Z?E.LINEAR:E.NEAREST,ne=n.sdfIcons&&0!==o.paint.get("icon-halo-width").constantOr(1),ae=t.terrain&&R&&i?e.bi(e.bz(),W):Ns;if(i&&n.icon){const e=S.elevation,i=e?e.getAtTileOffsetFunc(s,S.center.lat,S.worldSize,n.getProjection()):null,o=Xt(p,r.tileID.canonical,R,I,S,n.getProjection(),f);ei(n,p,t,!1,o,$,R,m,i,s);}return {program:O,buffers:n.icon,uniformValues:ie,atlasTexture:oe,atlasTextureIcon:null,atlasInterpolation:se,atlasInterpolationIcon:null,isSDF:n.sdfIcons,hasHalo:ne,depthMode:A,tile:r,renderWithShadows:T,labelPlaneMatrixInv:ae}},H=()=>{const i=C&&"point"!==o.layout.get("symbol-placement"),a=[],l=i||O||N,h="road"===n.elevationType,m=t.shadowRenderer,v=h&&A&&!!m&&m.enabled,y=G(v),x=h&&A&&!t.terrain?z:L;t.terrainRenderModeElevated()&&A&&a.push("PITCH_WITH_MAP_TERRAIN"),u&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),!n.text.zOffsetVertexBuffer||h&&t.terrain||a.push("Z_OFFSET"),n.iconsInText&&a.push("RENDER_TEXT_AND_SYMBOL"),a.push("RENDER_SDF"),v&&a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),h&&A&&!t.terrain&&n.text.orientationVertexBuffer&&a.push("ELEVATED_ROADS"),V(a);const b=n.text.programConfigurations.get(o.id),T=t.getOrCreateProgram("symbol",{config:b,defines:a});let I,R=[0,0],D=null;const P=n.textSizeData;n.iconsInText&&(R=r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],D=r.imageAtlasTexture?r.imageAtlasTexture:null,I=A||!S.isOrthographic||t.options.rotating||t.options.zooming||"composite"===P.kind||"camera"===P.kind?E.LINEAR:E.NEAREST);const B=r.glyphAtlasTexture?r.glyphAtlasTexture.size:[0,0],q=o.layout.get("text-size-scale-range"),H=e.ay(t.scaleFactor,q[0],q[1]),Z=e.bH(P,S.zoom,H),W=$t(p,r.tileID.canonical,A,C,S,n.getProjection(),f),$=Yt(p,r.tileID.canonical,A,C,S,n.getProjection(),f),X=t.translatePosMatrix($,r,c,d,!0),Y=t.translatePosMatrix(p,r,c,d),K=l?Ns:W,J=C&&!A&&!i;let Q=k;!F&&!S.mercatorFromTransition||C||(Q=Us(S));const ee=Ss(P.kind,Z,J,A,t,Y,K,X,w,!0,B,R,0,s,_,M,U,u?Q:k,n.getProjection(),y,j,null,null,H),te=r.glyphAtlasTexture?r.glyphAtlasTexture:null,ie=E.LINEAR,oe=0!==o.paint.get("text-halo-width").constantOr(1),re=t.terrain&&A&&i?e.bi(e.bz(),W):Ns;if(i&&n.text){const e=S.elevation,i=e?e.getAtTileOffsetFunc(s,S.center.lat,S.worldSize,n.getProjection()):null,o=Xt(p,r.tileID.canonical,A,C,S,n.getProjection(),f);ei(n,p,t,!0,o,$,A,g,i,s);}return {program:T,buffers:n.text,uniformValues:ee,atlasTexture:te,atlasTextureIcon:D,atlasInterpolation:ie,atlasInterpolationIcon:I,isSDF:!0,hasHalo:oe,depthMode:x,tile:r,renderWithShadows:v,labelPlaneMatrixInv:re}},Z=n.icon.segments.get().length,W=n.text.segments.get().length,$=Z&&!a.onlyText?q():null,X=W&&!a.onlyIcons?H():null,Y=o.paint.get("icon-opacity").constantOr(1),K=o.paint.get("text-opacity").constantOr(1);if(D&&n.canOverlap){P=!0;const t=Y&&!a.onlyText?n.icon.segments.get():[],i=K&&!a.onlyIcons?n.text.segments.get():[];for(const i of t)B.push({segments:new e.bd([i]),sortKey:i.sortKey,state:$});for(const t of i)B.push({segments:new e.bd([t]),sortKey:t.sortKey,state:X});}else a.onlyText||B.push({segments:Y?n.icon.segments:new e.bd([]),sortKey:0,state:$}),a.onlyIcons||B.push({segments:K?n.text.segments:new e.bd([]),sortKey:0,state:X});}P&&B.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of B){const i=e.state;if(i)if(t.terrain?t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:S.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:i.labelPlaneMatrixInv}):t.setupDepthForOcclusion(S.depthOcclusionForSymbolsAndCircles,i.program),T.activeTexture.set(E.TEXTURE0),i.atlasTexture&&i.atlasTexture.bind(i.atlasInterpolation,E.CLAMP_TO_EDGE,!0),i.atlasTextureIcon&&(T.activeTexture.set(E.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,E.CLAMP_TO_EDGE,!0)),i.renderWithShadows&&t.shadowRenderer.setupShadows(i.tile.tileID.toUnwrapped(),i.program,"vector-tile"),t.uploadCommonLightUniforms(t.context,i.program),i.hasHalo){const r=i.uniformValues;r.u_is_halo=1,qs(i.buffers,e.segments,o,t,i.program,i.depthMode,s,n,r,2),r.u_is_halo=0;}else {if(i.isSDF){const r=i.uniformValues;i.hasHalo&&(r.u_is_halo=1,qs(i.buffers,e.segments,o,t,i.program,i.depthMode,s,n,r,1)),r.u_is_halo=0;}qs(i.buffers,e.segments,o,t,i.program,i.depthMode,s,n,i.uniformValues,1);}}}function qs(e,t,i,o,r,s,n,a,l,c){const h=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer,e.orientationVertexBuffer];r.draw(o,o.context.gl.TRIANGLES,s,n,a,qi.disabled,l,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,o.transform.zoom,e.programConfigurations.get(i.id),h,c);}function Hs(t,i){const o=1<<t.canonical.z,r=(i.x*o-t.canonical.x-t.wrap*o)*e.aj,s=(i.y*o-t.canonical.y)*e.aj,n=e.e2(i.z,i.y);return e.d2(r,s,n)}function Zs(t,i,o,r,s){if(!o.layout||"none"===o.layout.get("fill-elevation-reference"))return;const n=t.context.gl,a=new Ni(t.context.gl.LEQUAL,Ni.ReadWrite,t.depthRangeFor3D),l=new Ni(t.context.gl.GREATER,Ni.ReadWrite,t.depthRangeFor3D),c=function(t){const i=e.cU(t.pitch);let o=.01;return t.isOrthographic&&(o=e.ai(1e-4,o,e.cZ(i>=Ji?1:i/Ji))),2*o}(t.transform),h=t.transform.getFreeCameraOptions().position,d="elevatedStructuresDepthReconstruct",u=t.getOrCreateProgram(d,{defines:["DEPTH_RECONSTRUCTION"]}),_=t.getOrCreateProgram(d);for(const e of r){const r=i.getTile(e),d=r.getBucket(o);if(!d)continue;const p=d.elevatedStructures;if(!p)continue;const f=d.elevationBufferData.heightRange,m=Hs(e.toUnwrapped(),h),g=t.translatePosMatrix(e.projMatrix,r,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));let v,y,x,b;if("initialize"===s){if(!f||f.min>=1||0===p.depthSegments.segments[0].primitiveLength)continue;v=ls(g,m,c,1,0),y=a,x=p.depthSegments,b=u;}else if("reset"===s){if(!f||f.min>=0||0===p.maskSegments.segments[0].primitiveLength)continue;v=ls(g,m,0,0,1),y=l,x=p.maskSegments,b=u;}else if("geometry"===s){if(0===p.depthSegments.segments[0].primitiveLength)continue;v=ls(g,m,c,1,0),y=a,x=p.depthSegments,b=_;}b.draw(t,n.TRIANGLES,y,ji.disabled,ki.disabled,qi.disabled,v,o.id,p.vertexBuffer,p.indexBuffer,x,o.paint,t.transform.zoom);}}function Ws(t,i,o){const{painter:r,sourceCache:s,layer:n,coords:a,colorMode:l,elevationType:c,terrainEnabled:h,pass:d}=t,u=r.context.gl,_=n.paint.get("fill-pattern"),p=n.paint.get("fill-pattern-cross-fade"),f=_.constantOr(null);let m=c;"road"!==c||i&&!h||(m="none");const g="road"===m,v=t.painter.shadowRenderer,y=g&&!!v&&v.enabled,x=new Ni(r.context.gl.LEQUAL,Ni.ReadOnly,r.depthRangeFor3D);let b=[0,0,0];if(y){const e=r.style.directionalLight,t=r.style.ambientLight;e&&t&&(b=ao(r.style,e,t));}const w=_&&_.constantOr(1),T=(t,d)=>{let _,m,T,E,S;d?(_=w&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",T=u.LINES):(_=w?"fillPattern":"fill",T=u.TRIANGLES);for(const I of a){const a=s.getTile(I);if(w&&!a.patternsLoaded())continue;const C=a.getBucket(n);if(!C)continue;const R=i?C.elevationBufferData:C.bufferData;if(R.isEmpty())continue;r.prepareDrawTile();const A=R.programConfigurations.get(n.id),D=r.isTileAffectedByFog(I),P=[],L=[];g&&(P.push("ELEVATED_ROADS"),L.push(R.elevatedLayoutVertexBuffer)),y&&P.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),w&&(r.context.activeTexture.set(u.TEXTURE0),a.imageAtlasTexture&&a.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),A.updatePaintBuffers());let z=!1;if(f&&a.imageAtlas){const t=a.imageAtlas,i=e.dZ.from(f),o=i.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),r=i.getSecondary(),s=t.patternPositions.get(o),n=r?t.patternPositions.get(r.scaleSelf(e.q.devicePixelRatio).toString()):null;z=!!s&&!!n,s&&A.setConstantPatternPositions(s,n);}p>0&&(z||A.getPatternTransitionVertexBuffer("fill-pattern"))&&P.push("FILL_PATTERN_TRANSITION");const M=r.getOrCreateProgram(_,{config:A,overrideFog:D,defines:P}),O=r.translatePosMatrix(I.projMatrix,a,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));y&&v.setupShadows(a.tileID.toUnwrapped(),M,"vector-tile");const F=n.paint.get("fill-emissive-strength");if(d){E=R.lineIndexBuffer,S=R.lineSegments;const e=r.terrain&&r.terrain.renderingToTexture?r.terrain.drapeBufferSize:[u.drawingBufferWidth,u.drawingBufferHeight];m="fillOutlinePattern"===_&&w?ns(O,F,r,a,e,b,p):ss(O,F,e,b);}else E=R.indexBuffer,S=R.triangleSegments,m=w?rs(O,F,r,a,b,p):os(O,F,b);r.uploadCommonUniforms(r.context,M,I.toUnwrapped());let B=t;("road"===c&&!h||"offset"===c)&&(B=x),M.draw(r,T,B,o||r.stencilModeForClipping(I),l,qi.disabled,m,n.id,R.layoutVertexBuffer,E,S,n.paint,r.transform.zoom,A,L);}};r.renderPass===d&&T(r.depthModeForSublayer(1,"opaque"===r.renderPass?Ni.ReadWrite:Ni.ReadOnly),!1),"none"===m&&"translucent"===r.renderPass&&n.paint.get("fill-antialias")&&T(r.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Ni.ReadOnly),!0);}function $s(t,i,o,r,s,n,a,l){o.resetLayerRenderingStats(t);const c=t.context,h=c.gl,d=t.transform,u=o.paint.get("fill-extrusion-pattern"),_=o.paint.get("fill-extrusion-pattern-cross-fade"),p=u.constantOr(null),f=u.constantOr(1),m=o.paint.get("fill-extrusion-opacity"),g=t.style.enable3dLights(),v=o.paint.get(g&&!f?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),y=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),v],x=o.layout.get("fill-extrusion-edge-radius"),b=x>0&&!o.paint.get("fill-extrusion-rounded-roof"),w=b?0:x,T="globe"===d.projection.name?e.e5():0,E="globe"===d.projection.name,S=E?e.ah(d.zoom):0,I=[e.aD(d.center.lng),e.aH(d.center.lat)],C="none"===o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),R=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(C?null:o.lut).toArray01().slice(0,3),A=o.paint.get("fill-extrusion-flood-light-intensity"),D=o.paint.get("fill-extrusion-vertical-scale"),P=0!==o.paint.get("fill-extrusion-line-width").constantOr(1),L=o.paint.get("fill-extrusion-height-alignment"),z=o.paint.get("fill-extrusion-base-alignment"),M=eo(t,o.paint.get("fill-extrusion-cutoff-fade-range")),O=[];let F;E&&O.push("PROJECTION_GLOBE_VIEW"),y[0]>0&&O.push("FAUX_AO"),b&&O.push("ZERO_ROOF_RADIUS"),l&&O.push("HAS_CENTROID"),A>0&&O.push("FLOOD_LIGHT"),M.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),P&&O.push("RENDER_WALL_MODE");const B="shadow"===t.renderPass,k=t.shadowRenderer,N=B&&!!k,U=B?qi.disabled:qi.backCCW;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let j=[0,0,0];if(k){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(j=ao(t.style,e,i)),B||(O.push("RENDER_SHADOWS","DEPTH_TEXTURE"),k.useNormalOffset&&O.push("NORMAL_OFFSET")),F=O.concat(["SHADOWS_SINGLE_CASCADE"]);}const G=N?"fillExtrusionDepth":f?"fillExtrusionPattern":"fillExtrusion",V=o.getLayerRenderingStats();for(const u of r){const r=i.getTile(u),g=r.getBucket(o);if(!g||g.projection.name!==d.projection.name)continue;let v=!1;k&&(v=0===k.getMaxCascadeForTile(u.toUnwrapped()));const x=t.isTileAffectedByFog(u),b=g.programConfigurations.get(o.id);let C=!1;if(p&&r.imageAtlas){const t=r.imageAtlas,i=e.dZ.from(p),o=i.getPrimary().scaleSelf(e.q.devicePixelRatio).toString(),s=i.getSecondary(),n=t.patternPositions.get(o),a=s?t.patternPositions.get(s.scaleSelf(e.q.devicePixelRatio).toString()):null;C=!!n&&!!a,n&&b.setConstantPatternPositions(n,a);}_>0&&(C||b.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&O.push("FILL_EXTRUSION_PATTERN_TRANSITION");const N=t.getOrCreateProgram(G,{config:b,defines:v?F:O,overrideFog:x});if(t.terrain&&t.terrain.setupElevationDraw(r,N,{useMeterToDem:!0}),!g.centroidVertexBuffer){const e=N.attributes.a_centroid_pos;void 0!==e&&h.vertexAttrib2f(e,0,0);}!B&&k&&k.setupShadows(r.tileID.toUnwrapped(),N,"vector-tile"),f&&(t.context.activeTexture.set(h.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),b.updatePaintBuffers());const q=o.paint.get("fill-extrusion-vertical-gradient"),H=1/g.tileToMeter;let Z;if(B&&k){if(tn(r.tileID,g.maxHeight,t))continue;const e=k.calculateShadowPassMatrixFromTile(r.tileID.toUnwrapped());Z=ts(e,w,H,D,L,z);}else {const e=t.translatePosMatrix(u.expandedProjMatrix,r,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),i=d.projection.createInversionMatrix(d,u.canonical);Z=f?is(e,t,q,m,y,w,H,u,r,T,L,z,S,I,i,R,D,_):es(e,t,q,m,y,w,H,u,T,L,z,S,I,i,R,D,A,j);}t.uploadCommonUniforms(c,N,u.toUnwrapped(),null,M);let W=g.segments;if("mercator"===d.projection.name&&!B&&(W=g.getVisibleSegments(r.tileID,t.terrain,t.transform.getFrustum(0)),!W.get().length))continue;if(V)if(B)for(const e of W.get())V.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of W.get())V.numRenderedVerticesInTransparentPass+=e.primitiveLength;const $=[];(t.terrain||l)&&$.push(g.centroidVertexBuffer),E&&$.push(g.layoutVertexExtBuffer),P&&$.push(g.wallVertexBuffer),N.draw(t,c.gl.TRIANGLES,s,n,a,U,Z,o.id,g.layoutVertexBuffer,g.indexBuffer,W,o.paint,t.transform.zoom,b,$);}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1);}class Xs{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0;}}function Ys(t,i,o,r,s,n,a,l,c,h,d,u,_,p,f,m,g,v,y,x){const b=i.context,w=b.gl,T=i.transform,E=i.transform.zoom,S=[],I=t.translate,C=t.translateAnchor,R=t.edgeRadius,A=eo(i,t.cutoffFadeRange);"clear"===d?(S.push("CLEAR_SUBPASS"),x&&(S.push("CLEAR_FROM_TEXTURE"),b.activeTexture.set(w.TEXTURE0),x.bind(w.LINEAR,w.CLAMP_TO_EDGE))):"sdf"===d&&S.push("SDF_SUBPASS"),v&&S.push("HAS_CENTROID"),A.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const D=(e,t,o,s,d)=>{const y=t.programConfigurations.get(r.id),w=i.isTileAffectedByFog(e),T=i.getOrCreateProgram("fillExtrusionGroundEffect",{config:y,defines:S,overrideFog:w}),I=((e,t,i,o,r,s,n,a,l,c,h)=>({u_matrix:t,u_opacity:i,u_ao_pass:o?1:0,u_meter_to_tile:r,u_ao:s,u_flood_light_intensity:n,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:h,u_dynamic_offset:1}))(0,s,u,h,d,[_,p*d],f,m,g,E>=17?0:R*d,x?x.size[0]:0),C=[];v&&C.push(t.hiddenByLandmarkVertexBuffer),i.uploadCommonUniforms(b,T,e.toUnwrapped(),null,A),T.draw(i,b.gl.TRIANGLES,n,a,l,c,I,r.id,t.vertexBuffer,t.indexBuffer,o,r.paint,E,y,C);};for(const t of s){const s=o.getTile(t),n=s.getBucket(r);if(!n||n.projection.name!==T.projection.name||!n.groundEffect||n.groundEffect&&!n.groundEffect.hasData())continue;const a=n.groundEffect,l=1/n.tileToMeter;{const e=i.translatePosMatrix(t.projMatrix,s,I,C),o=a.getDefaultSegment();D(t,a,o,e,l);}if(y)for(let n=0;n<4;n++){const a=e.e3[n](t),c=o.getTile(a);if(!c)continue;const h=c.getBucket(r);if(!h||h.projection.name!==T.projection.name||!h.groundEffect||h.groundEffect&&!h.groundEffect.hasData())continue;const d=h.groundEffect;let u,_;0===n?(u=[-e.aj,0,0],_=1):1===n?(u=[e.aj,0,0],_=0):2===n?(u=[0,-e.aj,0],_=3):(u=[0,e.aj,0],_=2);const p=d.regionSegments[_];if(!p)continue;const f=new Float32Array(16);e.bo(f,t.projMatrix,u),D(t,d,p,i.translatePosMatrix(f,s,I,C),l);}}}function Ks(t,i,o,r,s,n,a){0===r.centroidVertexArray.length&&r.createCentroidsBuffer();const l=n?n.findDEMTileFor(o):null;if(!(l&&l.dem||a))return;n&&l&&l.dem&&r.selfDEMTileTimestamp!==l.dem._timestamp&&(r.borderDoneWithNeighborZ=[-1,-1,-1,-1],r.selfDEMTileTimestamp=l.dem._timestamp);const c=t=>new e.P(Math.ceil((t+e.e7)*e.e8),0),h=e=>{const t=i.getSource().minzoom,o=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(s)},r=[0,-1,1];for(const i of r){if(e.overscaledZ+i<t)continue;const r=o(e.calculateScaledKey(e.overscaledZ+i));if(r)return r}},d=[0,0,0],u=(t,i)=>(d[0]=Math.min(t.min.y,i.min.y),d[1]=Math.max(t.max.y,i.max.y),d[2]=e.aj-i.min.x>t.max.x?i.min.x-e.aj:t.max.x,d),_=(t,i)=>(d[0]=Math.min(t.min.x,i.min.x),d[1]=Math.max(t.max.x,i.max.x),d[2]=e.aj-i.min.y>t.max.y?i.min.y-e.aj:t.max.y,d),p=[(e,t)=>u(e,t),(e,t)=>u(t,e),(e,t)=>_(e,t),(e,t)=>_(t,e)],f=(t,i,r,s,a,c,h)=>{if(!n)return 0;const d=[[c?r:t,c?t:r,0],[c?r:i,c?i:r,0]],u=h<0?e.aj+h:h,_=[c?u:(t+i)/2,c?(t+i)/2:u,0];return 0===r&&h<0||0!==r&&h>0?n.getForTilePoints(a,[_],!0,s):d.push(_),n.getForTilePoints(o,d,!0,l),Math.max(d[0][2],d[1][2],_[2])/n.exaggeration()};for(let t=0;t<4;t++){const i=r.borderFeatureIndices[t];if(0===i.length)continue;const s=e.e3[t](o),l=h(s);if(!(l&&l instanceof e.e4))continue;const d=n?n.findDEMTileFor(s):null;if(!(d&&d.dem||a))continue;if(n&&d&&d.dem&&r.borderDEMTileTimestamp[t]!==d.dem._timestamp&&(r.borderDoneWithNeighborZ[t]=-1,r.borderDEMTileTimestamp[t]=d.dem._timestamp),r.borderDoneWithNeighborZ[t]===l.canonical.z)continue;0===l.centroidVertexArray.length&&l.createCentroidsBuffer();const u=(t<2?1:5)-t,_=l.borderDoneWithNeighborZ[u]!==r.canonical.z,v=l.borderFeatureIndices[u];let y=0;if(r.canonical.z!==l.canonical.z){for(const e of i)r.showCentroid(r.featuresOnBorder[e]);if(_)for(const e of v)l.showCentroid(l.featuresOnBorder[e]);r.borderDoneWithNeighborZ[t]=l.canonical.z,l.borderDoneWithNeighborZ[u]=r.canonical.z;}for(const o of i){const i=r.featuresOnBorder[o],n=r.centroidData[i.centroidDataIndex],h=i.borders[t];let _;for(;y<v.length;){_=l.featuresOnBorder[v[y]];const e=_.borders[u];if(e[1]>h[0]+3||e[0]>h[0]-3)break;l.showCentroid(_),y++;}if(_&&y<v.length){const o=y;let x=0;for(;!(_.borders[u][0]>h[1]-3)&&(x++,++y!==v.length);)_=l.featuresOnBorder[v[y]];_=l.featuresOnBorder[v[o]];let b=!1;if(x>=1){const e=_.borders[u];Math.abs(h[0]-e[0])<3&&Math.abs(h[1]-e[1])<3&&(x=1,b=!0,y=o+1);}else if(0===x){r.showCentroid(i);continue}const w=l.centroidData[_.centroidDataIndex];a&&b&&(((m=n).flags|(g=w).flags)&e.e6?(m.flags|=e.e6,g.flags|=e.e6):(m.flags&=~e.e6,g.flags&=~e.e6));const T=i.intersectsCount()>1||_.intersectsCount()>1;if(x>1)y=o,n.centroidXY=w.centroidXY=new e.P(0,0);else if(d&&d.dem&&!T){const i=p[t](n,w),o=t%2?e.aj-1:0,r=f(i[0],Math.min(e.aj-1,i[1]),o,d,s,t<2,i[2]);n.centroidXY=w.centroidXY=c(r);}else T?n.centroidXY=w.centroidXY=new e.P(0,0):(n.centroidXY=r.encodeBorderCentroid(i),w.centroidXY=l.encodeBorderCentroid(_));r.writeCentroidToBuffer(n),l.writeCentroidToBuffer(w);}else r.showCentroid(i);}r.borderDoneWithNeighborZ[t]=l.canonical.z,l.borderDoneWithNeighborZ[u]=r.canonical.z;}var m,g;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&0!==r.centroidVertexArray.length)&&r.uploadCentroid(t);}const Js=[1,0,0],Qs=[0,1,0],en=[0,0,1];function tn(t,i,o){const r=o.transform,s=o.shadowRenderer;if(!s)return !0;const n=t.toUnwrapped(),a=r.tileSize*s._cascades[o.currentShadowCascade].scale;let l=i;if(r.elevation){const e=r.elevation.getMinMaxForTile(t);e&&(l+=e.max);}const c=[...s.shadowDirection];c[2]=-c[2];const h=s.computeSimplifiedTileShadowVolume(n,l,a,c);if(!h)return !1;const d=[Js,Qs,en,c,[c[0],0,c[2]],[0,c[1],c[2]]],u="globe"===r.projection.name,_=r.scaleZoom(a),p=e.cy.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,_,!u),f=s.getCurrentCascadeFrustum();return 0===p.intersectsPrecise(h.vertices,h.planes,d)||0===f.intersectsPrecise(h.vertices,h.planes,d)}function on(t){const{painter:i,source:o,layer:r,coords:s}=t,n=t.defines,a=i.context,l="shadow"===i.renderPass,c="light-beam"===i.renderPass,h=i.shadowRenderer;let d;h&&(d=n.concat(["SHADOWS_SINGLE_CASCADE"]));const u=e.e9(i.transform.center.lat,i.transform.zoom);for(const _ of s){const s=o.getTile(_),p=s.getBucket(r);if(!p)continue;let f=!1;h&&(f=0===h.getMaxCascadeForTile(_.toUnwrapped()));const m=p.programConfigurations.get(r.id);let g,v,y=i.translatePosMatrix(_.expandedProjMatrix,s,[0,0],"map");if(y=e.cP(e.bz(),y,[1,1,t.verticalScale]),l&&h){if(tn(s.tileID,p.maxHeight*u,i))continue;let o=h.calculateShadowPassMatrixFromTile(s.tileID.toUnwrapped());o=e.cP(e.bz(),o,[1,1,t.verticalScale]),v=ds(o),g=i.getOrCreateProgram("buildingDepth",{config:m,defines:f?d:n,overrideFog:!1});}else if(c)g=i.getOrCreateProgram("buildingBloom",{config:m,defines:f?d:n,overrideFog:!1}),v=hs(y);else {const o=i.transform.calculatePosMatrix(_.toUnwrapped(),i.transform.worldSize);e.cP(o,o,[1,1,t.verticalScale]);const r=e.bz();e.cP(r,o,[1,-1,1/u]),e.bi(r,r),e.ea(r,r),v=cs(y,r),g=i.getOrCreateProgram("building",{config:m,defines:f?d:n,overrideFog:!1}),h&&h.setupShadowsFromMatrix(o,g,!0);}if(i.uploadCommonUniforms(a,g,_.toUnwrapped(),null,null),c){const e=p.bloomGeometry;g.draw(i,a.gl.TRIANGLES,t.depthMode,ji.disabled,t.blendMode,qi.disabled,v,r.id,e.layoutVertexBuffer,e.indexBuffer,e.segmentsBucket,r.paint,i.transform.zoom,m,[e.layoutAttenuationBuffer,e.layoutColorBuffer]);}else g.draw(i,a.gl.TRIANGLES,t.depthMode,ji.disabled,t.blendMode,l?qi.disabled:qi.backCW,v,r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,r.paint,i.transform.zoom,m,[p.layoutNormalBuffer,p.layoutColorBuffer]);}}function rn(t){return [t[0]*e.eb,t[1]*e.eb,t[2]*e.eb,0]}function sn(t,i,o,r,s,n,a,l,c){const h=r.getSource(),d=o.globeSharedBuffers;if(!d)return;let u,_,p;if(i&&(u=r.getTile(i)),h instanceof e.aP?(_=h.texture,p=e.dE(0,0,o.transform)):u&&i&&(_=u.texture,p=e.dE(i.canonical.z,i.canonical.x,o.transform)),!_||!p)return;t||(p=e.cP(e.bz(),p,[1,-1,1]));const f=o.context,m=f.gl,g="nearest"===s.paint.get("raster-resampling")?m.NEAREST:m.LINEAR,v=o.colorModeForDrapableLayerRenderPass(n),y=a.defines;y.push("GLOBE_POLES");const x=new Ni(m.LEQUAL,Ni.ReadWrite,o.depthRangeFor3D),b=Float32Array.from(o.transform.expandedFarZProjMatrix),w=Float32Array.from(e.bh(e.dD(new e.cA(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),f.activeTexture.set(m.TEXTURE0),_.bind(g,m.CLAMP_TO_EDGE),f.activeTexture.set(m.TEXTURE1),_.bind(g,m.CLAMP_TO_EDGE),"useMipmap"in _&&f.extTextureFilterAnisotropic&&o.transform.pitch>20&&m.texParameterf(m.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax);const[T,E,S,I]=i?d.getPoleBuffers(i.canonical.z,!1):d.getPoleBuffers(0,!0),C=s.paint.get("raster-elevation");let R;t?(R=T,o.renderDefaultNorthPole=0!==C):(R=E,o.renderDefaultSouthPole=0!==C);const A=rn(a.mix),D=((e,t,i,o,r,s,n,a,l,c,h,d,u)=>vs(e,t,i,new Float32Array(16),new Float32Array(9),[0,0],o,[0,0],[0,0,0,0],1,{opacity:1,mix:0},s,[0,0]||[0,0],a,2,c,h,d,1,0,u))(b,w,p,e.ah(o.transform.zoom),0,s,0,C,0,A,a.offset,a.range,n),P=o.getOrCreateProgram("raster",{defines:y});o.uploadCommonUniforms(f,P,null),P.draw(o,m.TRIANGLES,x,c,v,l,D,s.id,R,S,I);}function nn(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),o=i-t,r=.2*e.height,s=t+r;return [t,i,(s-r-t)/o,(s-t)/o]}function an(e,t,i,o){if(e)return t instanceof rt&&e instanceof Tt?t.getTextureDescriptor(e,i,!0):{texture:e.texture,mix:rn(o.mix),offset:o.offset,buffer:0,tileSize:1}}var ln=e.ec([{name:"a_index",type:"Int16",components:1}]);class cn{constructor(t,i,o,r){const s={width:o[0],height:o[1],data:null},n=t.gl;this.targetColorTexture=new e.T(t,s,n.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,s,n.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(i,r),this.lastInvalidatedAt=0;}updateParticleTexture(t,i){if(this.particleTextureDimension===i.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const o=this.context.gl,r=i.width*i.height;this.particleTexture0=new e.T(this.context,i,o.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,i,o.RGBA8,{premultiply:!1,useMipmap:!1});const s=new e.ed;s.reserve(r);for(let e=0;e<r;e++)s.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(s,ln.members,!0),this.particleSegment=e.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i.width;}update(t){return !(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy();}}function hn(t,i,o){if(!t)return null;const r=i.getTextureDescriptor(t,o,!0);if(!r)return null;let{texture:s,mix:n,offset:a,tileSize:l,buffer:c,format:h}=r;if(!s||!h)return null;let d=!1;return "uint32"===h&&(d=!0,n[3]=0,n=ms(e.ee,n,[0,o.paint.get("raster-particle-max-speed")]),a=gs(e.ee,a,[0,o.paint.get("raster-particle-max-speed")])),{texture:s,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:d,scale:n,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[h]]}}function dn(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),o=i-t,r=.2*e.height,s=t+r;return [t,i,(s-r-t)/o,(s-t)/o]}const un=new e.am(1,0,0,1),_n=new e.am(0,1,0,1),pn=new e.am(0,0,1,1),fn=new e.am(1,0,1,1),mn=new e.am(0,1,1,1);function gn(t,i,o,r,s,n){for(let a=0;a<o.length;a++)if(s){const s=1,l=.8,c=new e.am(r.r*l,r.g*l,r.b*l,1);vn(t,i,o[a],r,-s,-s,n),vn(t,i,o[a],r,-s,s,n),vn(t,i,o[a],r,s,s,n),vn(t,i,o[a],r,s,-s,n),vn(t,i,o[a],c,0,0,n);}else vn(t,i,o[a],r,0,0,n);}function vn(t,i,o,r,s,n,a){const l=t.context,c=t.transform,h=l.gl,d="globe"===c.projection.name,u=d?["PROJECTION_GLOBE_VIEW"]:[];let _=e.bw(o.projMatrix);if(d&&e.ah(c.zoom)>0){const t=e.bg(o.canonical,c),i=e.ef(t);_=e.az(new Float32Array(16),c.globeMatrix,i),e.az(_,c.projMatrix,_);}const p=e.bz();p[12]+=2*s/(e.q.devicePixelRatio*c.width),p[13]+=2*n/(e.q.devicePixelRatio*c.height),e.az(_,p,_);const f=t.getOrCreateProgram("debug",{defines:u}),m=i.getTileByID(o.key);t.terrain&&t.terrain.setupElevationDraw(m,f);const g=Ni.disabled,v=ji.disabled,y=t.colorModeForRenderPass(),x="$debug";l.activeTexture.set(h.TEXTURE0),t.emptyTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),d?m._makeGlobeTileDebugBuffers(t.context,c):m._makeDebugTileBoundsBuffers(t.context,c.projection);const b=m._tileDebugBuffer||t.debugBuffer,w=m._tileDebugIndexBuffer||t.debugIndexBuffer,T=m._tileDebugSegments||t.debugSegments;if(f.draw(t,h.LINE_STRIP,g,v,y,qi.disabled,_s(_,r.toPremultipliedRenderColor(null)),x,b,w,T,null,null,null,[m._globeTileDebugBorderBuffer]),a){const e=m.latestRawTileData,i=Math.floor((e&&e.byteLength||0)/1024);let r=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(r+=` => ${o.overscaledZ}`),r+=` ${m.state}`,r+=` ${i}kb`,function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,o=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,i.width,i.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE);}(t,r);}const E=i.getTile(o).tileSize,S=512/Math.min(E,512)*(o.overscaledZ/c.zoom)*.5,I=m._tileDebugTextBuffer||t.debugBuffer,C=m._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,R=m._tileDebugTextSegments||t.debugSegments;f.draw(t,h.TRIANGLES,g,v,ki.alphaBlended,qi.disabled,_s(_,e.am.transparent.toPremultipliedRenderColor(null),S),x,I,C,R,null,null,null,[m._globeTileDebugTextBuffer]);}function yn(e,t,i,o){bn(e,0,t+i/2,e.transform.width,i,o);}function xn(e,t,i,o){bn(e,t-i/2,0,i,e.transform.height,o);}function bn(t,i,o,r,s,n){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.q.devicePixelRatio,o*e.q.devicePixelRatio,r*e.q.devicePixelRatio,s*e.q.devicePixelRatio),a.clear({color:n}),l.disable(l.SCISSOR_TEST);}const wn=e.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Tn}=wn;function En(e,t,i,o){e.emplaceBack(t,i,o);}class Sn{constructor(t){this.vertexArray=new e.eg,this.indices=new e.a_,En(this.vertexArray,-1,-1,1),En(this.vertexArray,1,-1,1),En(this.vertexArray,-1,1,1),En(this.vertexArray,1,1,1),En(this.vertexArray,-1,-1,-1),En(this.vertexArray,1,-1,-1),En(this.vertexArray,-1,1,-1),En(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Tn),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.bd.simpleSegment(0,0,36,12);}}function In(t,i,o,r,s,n){const a=t.context.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),h=i.paint.get("sky-atmosphere-sun-intensity"),d=((e,t,i,o,r)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[o.r,o.g,o.b,o.a],u_color_tint_m:[r.r,r.g,r.b,r.a],u_luminance:5e-5}))(e.ei(e.dJ(),r),s,h,l.toPremultipliedRenderColor(null),c.toPremultipliedRenderColor(null));a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+n,i.skyboxTexture,0),o.draw(t,a.TRIANGLES,Ni.disabled,ji.disabled,ki.unblended,qi.frontCW,d,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment);}const Cn=e.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Rn{constructor(t){const i=new e.ej;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const o=new e.a_;o.emplaceBack(0,1,2),o.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,Cn.members),this.indexBuffer=t.createIndexBuffer(o),this.segments=e.bd.simpleSegment(0,0,4,2);}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy();}}const An=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Dn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200;}}class Pn{constructor(t){this.colorModeAlphaBlendedWriteRGB=new ki([1,Bi,1,Bi],e.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ki([1,0,1,0],e.am.transparent,[!1,!1,!1,!0]),this.params=new Dn,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0;})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0;})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0;}));}update(t){const i=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Rn(i);const t=this.params.sizeRange,o=this.params.intensityRange,r=function(t){const i=e.el(30),o=[];for(let r=0;r<t;++r){const t=2*Math.PI*i(),r=Math.acos(1-2*i())-.5*Math.PI;o.push(e.d2(Math.cos(r)*Math.cos(t),Math.cos(r)*Math.sin(t),Math.sin(r)));}return o}(this.params.starsCount),s=e.el(300),n=new e.ek,a=new e.a_;let l=0;for(let i=0;i<r.length;++i){const c=e.c1([],r[i],200),h=Math.max(0,1+.01*t*(1*s()-.5)),d=Math.max(0,1+.01*o*(1*s()-.5));n.emplaceBack(c[0],c[1],c[2],-1,-1,h,d),n.emplaceBack(c[0],c[1],c[2],1,-1,h,d),n.emplaceBack(c[0],c[1],c[2],1,1,h,d),n.emplaceBack(c[0],c[1],c[2],-1,1,h,d),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4;}this.starsVx=i.createVertexBuffer(n,An.members),this.starsIdx=i.createIndexBuffer(a),this.starsSegments=e.bd.simpleSegment(0,0,n.length,a.length);}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy();}drawAtmosphereGlow(t,i){const o=t.context,r=o.gl,s=t.transform,n=new Ni(r.LEQUAL,Ni.ReadOnly,[0,1]),a=e.ah(s.zoom),l=t.style.getLut(i.scope),c="none"===i.properties.get("color-use-theme"),h=i.properties.get("color").toNonPremultipliedRenderColor(c?null:l).toArray01(),d="none"===i.properties.get("high-color-use-theme"),u=i.properties.get("high-color").toNonPremultipliedRenderColor(d?null:l).toArray01(),_="none"===i.properties.get("space-color-use-theme"),p=i.properties.get("space-color").toNonPremultipliedRenderColor(_?null:l).toArray01(),f=5e-4,m=e.em(i.properties.get("horizon-blend"),0,1,f,.25),g=e.dy(t,o,s)&&m===f?s.worldSize/(2*Math.PI*1.025)-1:s.globeRadius,v=t.frameCounter/1e3%1,y=e.ae(s.globeCenterInViewSpace),x=Math.sqrt(Math.pow(y,2)-Math.pow(g,2)),b=Math.acos(x/y),w=e=>{const i="globe"===s.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&i.push("ALPHA_PASS");const l=t.getOrCreateProgram("globeAtmosphere",{defines:i}),c=((e,t,i,o,r,s,n,a,l,c,h,d)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:i,u_frustum_bl:o,u_horizon:r,u_transition:s,u_fadeout_range:n,u_color:a,u_high_color:l,u_space_color:c,u_temporal_offset:h,u_horizon_angle:d}))(s.frustumCorners.TL,s.frustumCorners.TR,s.frustumCorners.BR,s.frustumCorners.BL,s.frustumCorners.horizon,a,m,h,u,p,v,b);t.uploadCommonUniforms(o,l);const d=this.atmosphereBuffer;d&&l.draw(t,r.TRIANGLES,n,ji.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,qi.backCW,c,e?"atmosphere_glow_alpha":"atmosphere_glow",d.vertexBuffer,d.indexBuffer,d.segments);};w(!1),w(!0);}drawStars(t,i){const o=e.ay(i.properties.get("star-intensity"),0,1);if(0===o)return;const r=t.context,s=r.gl,n=t.transform,a=t.getOrCreateProgram("stars"),l=e.c3([]);e.c5(l,l,-n._pitch),e.c4(l,l,-n.angle),e.c5(l,l,e.al(n._center.lat)),e.en(l,l,-e.al(n._center.lng));const c=e.c8(new Float32Array(16),l),h=e.az([],n.starsProjMatrix,c),d=e.ei([],c),u=e.eo([],d),_=[0,1,0];e.dL(_,_,u),e.c1(_,_,this.params.sizeMultiplier);const p=[1,0,0];e.dL(p,p,u),e.c1(p,p,this.params.sizeMultiplier);const f=(m=_,g=p,v=o,{u_matrix:Float32Array.from(h),u_up:m,u_right:g,u_intensity_multiplier:v});var m,g,v;t.uploadCommonUniforms(r,a),this.starsVx&&this.starsIdx&&a.draw(t,s.TRIANGLES,Ni.disabled,ji.disabled,this.colorModeAlphaBlendedWriteRGB,qi.disabled,f,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments);}}class Ln{constructor(){this.visibleTiles=[];}updateBorders(t,i){const o=[],r=[],s=t._getRenderableCoordinates(!1,!0);for(const e of s){const s=t.getTile(e);if(!s.hasData())continue;const n=s.getBucket(i);n&&(n.isEmpty()||(o.push(e.key),r.push({bucket:n,tileID:e.canonical})));}let n=o.length!==this.visibleTiles.length;if(!n){o.sort();for(let e=0;e<o.length;e++)if(o[e]!==this.visibleTiles[e]){n=!0;break}}if(!n)return;const a=new Set;this.visibleTiles=o,r.sort(((e,t)=>e.tileID.z-t.tileID.z||e.tileID.x-t.tileID.x||e.tileID.y-t.tileID.y));for(const t of r){const i=new Array,o=new Array,r=t.bucket;for(const e of r.featuresOnBorder)a.has(e.featureId)?o.push(e.footprintIndex):(a.add(e.featureId),i.push(e.footprintIndex));r.updateFootprintHiddenFlags(i,e.ep,!1),r.updateFootprintHiddenFlags(o,e.ep,!0);}}}function zn(t,i){const o=[...t],r=i.cameraWorldSizeForFog/i.worldSize,s=e.bx([]);return e.cP(s,s,[r,r,1]),e.az(o,s,o),e.az(o,i.worldToFogMatrix,o),o}function Mn(t,i,o,r,s){const n=o.material,a=r.context,{baseColorTexture:l,metallicRoughnessTexture:c}=n.pbrMetallicRoughness,{normalTexture:h,occlusionTexture:d,emissionTexture:u}=n;function _(e,i,o){if(e&&(t.push(i),a.activeTexture.set(a.gl.TEXTURE0+o),e.gfxTexture)){const{minFilter:t,magFilter:i,wrapS:o,wrapT:r}=e.sampler;e.gfxTexture.bindExtraParam(t,i,o,r);}}_(l,"HAS_TEXTURE_u_baseColorTexture",Yi.BaseColor),_(c,"HAS_TEXTURE_u_metallicRoughnessTexture",Yi.MetallicRoughness),_(h,"HAS_TEXTURE_u_normalTexture",Yi.Normal),_(d,"HAS_TEXTURE_u_occlusionTexture",Yi.Occlusion),_(u,"HAS_TEXTURE_u_emissionTexture",Yi.Emission),s&&(s.texture||(s.texture=new e.et(r.context,s.image,[s.image.height,s.image.height,s.image.height],a.gl.RGBA8)),a.activeTexture.set(a.gl.TEXTURE0+Yi.LUT),s.texture&&s.texture.bind(a.gl.LINEAR,a.gl.CLAMP_TO_EDGE),t.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(o.texcoordBuffer)),o.colorBuffer&&(t.push(12===o.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(o.colorBuffer)),o.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(o.normalBuffer)),o.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(o.pbrBuffer)),"OPAQUE"!==n.alphaMode&&"MASK"!==n.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),n.defined||t.push("DIFFUSE_SHADED");const p=r.shadowRenderer;p&&(t.push("RENDER_SHADOWS","DEPTH_TEXTURE"),p.useNormalOffset&&t.push("NORMAL_OFFSET"));}function On(t,i,o,r,s,n){const a=o.paint.get("model-opacity").constantOr(1),l=i.context,c=new Ni(i.context.gl.LEQUAL,Ni.ReadWrite,i.depthRangeFor3D),h=i.transform,d=t.mesh,u=d.material,_=u.pbrMetallicRoughness,p=i.style.fog;let f;f="pixels"===i.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.az([],r.zScaleMatrix,t.nodeModelMatrix),e.az(f,r.negCameraPosMatrix,f);const m=e.bi([],f);e.ea(m,m);const g="none"===o.paint.get("model-color-use-theme").constantOr("default"),v=o.paint.get("model-emissive-strength").constantOr(0),y=As(new Float32Array(t.worldViewProjection),new Float32Array(f),new Float32Array(m),null,i,a,_.baseColorFactor,u.emissiveFactor,_.metallicFactor,_.roughnessFactor,u,v,o),x={defines:[]},b=[],w=i.shadowRenderer;w&&(w.useNormalOffset=!1),Mn(x.defines,b,d,i,g?null:o.lut);let T=null;if(p){const e=zn(t.nodeModelMatrix,i.transform);if(T=new Float32Array(e),"globe"!==h.projection.name){const t=d.aabb.min,i=d.aabb.max,[o,r]=p.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);x.overrideFog=o>=Fe||r>=Fe;}}const E=eo(i,o.paint.get("model-cutoff-fade-range"));E.shouldRenderCutoff&&x.defines.push("RENDER_CUTOFF");const S=i.getOrCreateProgram("model",x);i.uploadCommonUniforms(l,S,null,T,E),"shadow"!==i.renderPass&&w&&w.setupShadowsFromMatrix(t.nodeModelMatrix,S),S.draw(i,l.gl.TRIANGLES,c,s,n,d.material.doubleSided?qi.disabled:qi.backCCW,y,o.id,d.vertexBuffer,d.indexBuffer,d.segments,o.paint,i.transform.zoom,void 0,b);}function Fn(t,i,o,r,s,n,a){let l;l="globe"===t.projection.name?e.er(o,t):[...o],e.az(l,l,i.matrix);const c=e.az([],r,l);if(i.meshes)for(const o of i.meshes){if("BLEND"!==o.material.alphaMode){a.push({mesh:o,depth:0,modelIndex:s,worldViewProjection:c,nodeModelMatrix:l});continue}const i=e.ad([],o.centroid,c);!t.isOrthographic&&i[2]<=0||n.push({mesh:o,depth:i[2],modelIndex:s,worldViewProjection:c,nodeModelMatrix:l});}if(i.children)for(const e of i.children)Fn(t,e,o,r,s,n,a);}function Bn(e,t,i,o){const r=i.shadowRenderer;if(!r)return;const s=r.getShadowPassDepthMode(),n=r.getShadowPassColorMode(),a=r.calculateShadowPassMatrixFromMatrix(t),l=Ds(a);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,s,ji.disabled,n,qi.backCCW,l,o.id,e.vertexBuffer,e.indexBuffer,e.segments,o.paint,i.transform.zoom,void 0,void 0);}function kn(t,i,o){const r=i.updateZoomBasedPaintProperties(),s=function(t,i,o){let r,s,n,a=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&a>0){const i=t.terrain,s=i.findDEMTileFor(o);s&&s.dem?r=e.eu.create(i,o,s):a=0;}if(0===a&&(i.terrainElevationMin=0,i.terrainElevationMax=0),a===i.validForExaggeration&&(0===a||r&&r._demTile&&r._demTile.tileID===i.validForDEMTile.id&&r._dem._timestamp===i.validForDEMTile.timestamp))return !1;for(const e in i.instancesPerModel){const t=i.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const o=(r?a*r.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=o,s=s?Math.min(i.terrainElevationMin,o):o,n=n?Math.max(i.terrainElevationMax,o):o;}}return i.terrainElevationMin=s||0,i.terrainElevationMax=n||0,i.validForExaggeration=a,i.validForDEMTile=r&&r._demTile?{id:r._demTile.tileID,timestamp:r._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,i,o);(r||s)&&(i.uploaded=!1,i.upload(t.context));}const Nn={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.d6([0,0,0],[e.aj,e.aj,0])};function Un(t,i){const o=1<<t.canonical.z,r=i.getFreeCameraOptions().position,s=i.elevation,n=t.canonical.x/o,a=(t.canonical.x+1)/o,l=t.canonical.y/o,c=(t.canonical.y+1)/o;let h=i._centerAltitude;if(s){const e=s.getMinMaxForTile(t);e&&e.max>h&&(h=e.max);}const d=e.ay(r.x,n,a)-r.x,u=e.ay(r.y,l,c)-r.y,_=e.cb(h,i.center.lat)-r.z;return i._zoomFromMercatorZ(Math.sqrt(d*d+u*u+_*_))}function jn(e,t,i,o,r,s,n){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,h=l&&c?c.getShadowPassDepthMode():new Ni(a.gl.LEQUAL,Ni.ReadWrite,e.depthRangeFor3D),d=e.isTileAffectedByFog(s);if(i.meshes)for(const u of i.meshes){const _=["MODEL_POSITION_ON_GPU"],p=[];let f,m,g;o.instancedDataArray.length>20&&_.push("INSTANCED_ARRAYS");const v=eo(e,t.paint.get("model-cutoff-fade-range"));if(v.shouldRenderCutoff&&_.push("RENDER_CUTOFF"),l&&c)f=e.getOrCreateProgram("modelDepth",{defines:_}),m=Ds(n.shadowTileMatrix,n.shadowTileMatrix,Float32Array.from(i.matrix)),g=c.getShadowPassColorMode();else {Mn(_,p,u,e,"none"===t.paint.get("model-color-use-theme").constantOr("default")?null:t.lut),f=e.getOrCreateProgram("model",{defines:_,overrideFog:d});const o=u.material,l=o.pbrMetallicRoughness,h=t.paint.get("model-opacity").constantOr(1),y=t.paint.get("model-emissive-strength").constantOr(0);m=As(s.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),null,e,h,l.baseColorFactor,o.emissiveFactor,l.metallicFactor,l.roughnessFactor,o,y,t,r),c&&(n.shadowUniformsInitialized?f.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(s.toUnwrapped(),f,"model-tile"),n.shadowUniformsInitialized=!0)),g=v.shouldRenderCutoff||h<1||"OPAQUE"!==o.alphaMode?ki.alphaBlended:ki.unblended;}e.uploadCommonUniforms(a,f,s.toUnwrapped(),null,v);const y=u.material.doubleSided?qi.disabled:qi.backCCW;if(o.instancedDataArray.length>20)p.push(o.instancedDataBuffer),f.draw(e,a.gl.TRIANGLES,h,ji.disabled,g,y,m,t.id,u.vertexBuffer,u.indexBuffer,u.segments,t.paint,e.transform.zoom,void 0,p,o.instancedDataArray.length);else {const i=l?"u_instance":"u_normal_matrix";for(let r=0;r<o.instancedDataArray.length;++r)m[i]=new Float32Array(o.instancedDataArray.arrayBuffer,64*r,16),f.draw(e,a.gl.TRIANGLES,h,ji.disabled,g,y,m,t.id,u.vertexBuffer,u.indexBuffer,u.segments,t.paint,e.transform.zoom,void 0,p);}}if(i.children)for(const a of i.children)jn(e,t,a,o,r,s,n);}const Gn=[1,-1,1];function Vn(t,i,o,r){if(!o.modelManager)return !0;const s=o.modelManager;if(!o.shadowRenderer)return !0;const n=o.shadowRenderer,a=i.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const i in t.instancesPerModel){const t=s.getModel(i,r);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1;}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c);}a.max[2]=c,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,e.ad(a.min,a.min,i.tileMatrix),e.ad(a.max,a.max,i.tileMatrix);const h=a.intersects(n.getCurrentCascadeFrustum());return 0===o.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===h),0===h}function qn(t,i){const o=t.uniformValues.u_cutoff_params[0],r=t.uniformValues.u_cutoff_params[1],s=t.uniformValues.u_cutoff_params[2],n=t.uniformValues.u_cutoff_params[3];return r===o||n===s?1:e.ay(((i-o)/(r-o)-s)/(n-s),0,1)}function Hn(t,i,o,r){if(i.pitch<20)return 1;const s=i.getWorldToCameraMatrix();e.az(s,s,t);const n=e.bR(o.min[0],o.min[1],o.min[2],1);let a=e.aA(e.ev(),n,s),l=a,c=a;n[1]=o.max[1],a=e.aA(e.ev(),n,s),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,n[0]=o.max[0],a=e.aA(e.ev(),n,s),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,n[1]=o.min[1],a=e.aA(e.ev(),n,s),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c;const h=e.ay(r[0],0,1),d=100*i.pixelsPerMeter*e.ay(r[1],0,1),u=e.ay(r[2],0,1),_=e.ew(e.ev(),l,c,h),p=Math.tan(.5*i.fovX),f=-_[2]*p;if(0===d)return _[1]<-Math.abs(f)?u:1;const m=(-Math.abs(f)-_[1])/d,g=(e,t,i)=>(1-i)*e+i*t,v=e.ay(g(1,u,m),u,1);return g(1,v,e.ay((i.pitch-20)/20,0,1))}class Zn{}class Wn{constructor(){this._storage=new Map;}getLinesFromTrianglesBuffer(t,i,o){{const e=this._storage.get(i.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const r=o.gl,s=r.getBufferParameter(r.ELEMENT_ARRAY_BUFFER,r.BUFFER_SIZE),n=new ArrayBuffer(s),a=new Int16Array(n);r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,0,new Int16Array(n));const l=new e.ey;for(let e=0;e<s/2;e+=3){const t=a[e],i=a[e+1],o=a[e+2];l.emplaceBack(t,i),l.emplaceBack(i,o),l.emplaceBack(o,t);}const c=o.bindVertexArrayOES.current,h=new Zn;return h.buf=new Ls(o,l),h.lastUsedFrameIdx=t,this._storage.set(i.id,h),o.bindVertexArrayOES.set(c),h.buf}update(e){for(const[t,i]of this._storage)e-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(t));}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e);}}class $n{constructor(e){this.occluderSize=30,this.depthOffset=-1e-4,e.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),e.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5});}}const Xn=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Yn{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Kn{constructor(e,t){this.revealStart=11,this.revealRange=2,e.registerParameter(this,[...t,"Reveal"],"revealStart",{min:0,max:17,step:.05}),e.registerParameter(this,[...t,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05});}}const Jn=e.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class Qn{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy();}draw(t,i){const o=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const i=new e.ez,o=new e.a_;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(1,1),i.emplaceBack(-1,1),o.emplaceBack(0,1,2),o.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(i,Jn.members),this.vignetteIdx=t.context.createIndexBuffer(o);}const r=e.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,o);const e={u_vignetteShape:(s={vignetteShape:[i.start,i.range,Math.pow(10,i.fadePower)],vignetteColor:[i.color.r,i.color.g,i.color.b,i.color.a*i.strength]}).vignetteShape,u_vignetteColor:s.vignetteColor};o.draw(t,t.context.gl.TRIANGLES,Ni.disabled,ji.disabled,ki.alphaBlended,qi.disabled,e,"vignette",this.vignetteVx,this.vignetteIdx,r);}var s;}}class ea{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;}update(t,i){const o=t.getFreeCameraOptions().position,r=o.toAltitude(),s=o.toLngLat(),n=e.al(s.lng),a=e.al(s.lat),l=t.pixelsPerMeter/i,c=n*e.eB,h=e.eB*Math.log(Math.tan(Math.PI/4+a/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else {const e=-this._offsetYPrev+h,t=-this._elevationPrev+r;this._accumulatedOffsetX+=(-this._offsetXPrev+c)*l,this._accumulatedOffsetY+=e*l,this._accumulatedElevation+=t*l,this._offsetXPrev=c,this._offsetYPrev=h,this._elevationPrev=r;}}getPosition(){return [this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ta(e,t){return [-(e[0]-Math.floor(e[0]/t)*t),-(e[1]-Math.floor(e[1]/t)*t),-(e[2]-Math.floor(e[2]/t)*t)]}function ia(t){const i=e.el(1323123451230),o=[];for(let r=0;r<t;++r){const t=2*i()-1,r=2*i()-1,s=2*i()-1;o.push(e.d2(t,r,s));}return o}function oa(t,i,o,r,s){const n=e.ay((s-o)/(r-o),0,1);return (1-n)*t+n*i}class ra{constructor(e){this._movement=new ea,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Qn,this._ppmScaleFactor=e;}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy();}updateOnRender(t,i){const o=t.transform;this._movement.update(o,this._ppmScaleFactor);const r=o.starsProjMatrix,s=e.c3([]);e.c5(s,s,e.al(90)-o._pitch),e.c4(s,s,-o.angle);const n=e.c8(new Float32Array(16),s),a=e.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),l=e.ea([],a),c=e.az([],l,n),h=Date.now()/1e3;return this._accumulatedTimeFromStart+=(h-this._prevTime)*i,this._prevTime=h,{projectionMatrix:r,modelviewMatrix:c}}}class sa extends ra{constructor(e){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Kn(e.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3;}update(t){const i=t.context;if(!this.particlesVx){const t=ia(this.particlesCount),o=new e.eC,r=new e.a_;let s=0;const n=e.el(1323123451230);for(let e=0;e<t.length;++e){const i=t[e],a=[2*n()-1,n(),n(),n()];o.emplaceBack(i[0],i[1],i[2],-1,-1,...a),o.emplaceBack(i[0],i[1],i[2],1,-1,...a),o.emplaceBack(i[0],i[1],i[2],1,1,...a),o.emplaceBack(i[0],i[1],i[2],-1,1,...a),r.emplaceBack(s+0,s+1,s+2),r.emplaceBack(s+0,s+2,s+3),s+=4;}this.particlesVx=i.createVertexBuffer(o,Xn.members),this.particlesIdx=i.createIndexBuffer(r);}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const i=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},o=t.transform.zoom;if(i.revealStart>o)return;const r=oa(0,1,i.revealStart,i.revealStart+i.revealRange,o);if(!this.particlesVx||!this.particlesIdx)return;const s=structuredClone(this._params);let n=[-s.direction.x,s.direction.y,-100];e.au(n,n);const a=structuredClone(this._vignetteParams);a.strength*=r,s.overrideStyleParameters||(s.intensity=t.style.rain.state.density,s.timeFactor=t.style.rain.state.intensity,s.color=structuredClone(t.style.rain.state.color),n=structuredClone(t.style.rain.state.direction),s.screenThinning.intensity=t.style.rain.state.centerThinning,s.dropletSizeX=t.style.rain.state.dropletSize[0],s.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],s.distortionStrength=100*t.style.rain.state.distortionStrength,a.strength=1,a.color=structuredClone(t.style.rain.state.vignetteColor));const l=this.updateOnRender(t,s.timeFactor),c=t.context,h=c.gl,d=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new e.T(c,{width:t.width,height:t.height,data:null},h.RGBA8)),s.distortionStrength>0&&(c.activeTexture.set(h.TEXTURE0),this.screenTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.copyTexSubImage2D(h.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const u=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(c,u),c.activeTexture.set(h.TEXTURE0),this.screenTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE);const _=[s.color.r,s.color.g,s.color.b,s.color.a],p=(i,o)=>{const r=ta(this._movement.getPosition(),i),a=s.dropletSizeX,c=s.dropletSizeX*s.dropletSizeYScale,p=t.width/2,f=t.height/2,m=oa(0,s.screenThinning.start,0,1,s.screenThinning.intensity),g=oa(.001,s.screenThinning.range,0,1,s.screenThinning.intensity),v=oa(0,s.screenThinning.particleOffset,0,1,s.screenThinning.intensity),y=(x={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:r,velocityConeAperture:s.velocityConeAperture,velocity:s.velocity,boxSize:i,rainDropletSize:[a,c],distortionStrength:s.distortionStrength,rainDirection:n,color:_,screenSize:[d.width,d.height],thinningCenterPos:[p,f],thinningShape:[m,g,Math.pow(10,s.screenThinning.fadePower)],thinningAffectedRatio:s.screenThinning.affectedRatio,thinningParticleOffset:v,shapeDirectionalPower:s.shapeDirPower,shapeNormalPower:s.shapeNormalPower,mode:o?0:1},{u_modelview:Float32Array.from(x.modelview),u_projection:Float32Array.from(x.projection),u_time:x.time,u_cam_pos:x.camPos,u_texScreen:0,u_velocityConeAperture:x.velocityConeAperture,u_velocity:x.velocity,u_boxSize:x.boxSize,u_rainDropletSize:x.rainDropletSize,u_distortionStrength:x.distortionStrength,u_rainDirection:x.rainDirection,u_color:x.color,u_screenSize:x.screenSize,u_thinningCenterPos:x.thinningCenterPos,u_thinningShape:x.thinningShape,u_thinningAffectedRatio:x.thinningAffectedRatio,u_thinningParticleOffset:x.thinningParticleOffset,u_shapeDirectionalPower:x.shapeDirectionalPower,u_shapeNormalPower:x.shapeNormalPower,u_mode:x.mode});var x;const b=Math.round(s.intensity*this.particlesCount),w=e.bd.simpleSegment(0,0,4*b,2*b);u.draw(t,h.TRIANGLES,Ni.disabled,ji.disabled,ki.alphaBlended,qi.disabled,y,"rain_particles",this.particlesVx,this.particlesIdx,w);};s.distortionStrength>0&&p(s.boxSize,!0),p(s.boxSize,!1),this._vignette.draw(t,a);}}const na=e.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class aa extends ra{constructor(e){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Kn(e.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3;}update(t){const i=t.context;if(!this.particlesVx){const t=ia(this.particlesCount),o=new e.eD,r=new e.a_;let s=0;const n=e.el(1323123451230);for(let e=0;e<t.length;++e){const i=t[e],a=n(),l=n(),c=n(),h=[e/t.length,a,l,c],d=[n(),n()];o.emplaceBack(i[0],i[1],i[2],-1,-1,...h,...d),o.emplaceBack(i[0],i[1],i[2],1,-1,...h,...d),o.emplaceBack(i[0],i[1],i[2],1,1,...h,...d),o.emplaceBack(i[0],i[1],i[2],-1,1,...h,...d),r.emplaceBack(s+0,s+1,s+2),r.emplaceBack(s+0,s+2,s+3),s+=4;}this.particlesVx=i.createVertexBuffer(o,na.members),this.particlesIdx=i.createIndexBuffer(r);}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const i=structuredClone(this._params);let o=[-i.direction.x,i.direction.y,-100];e.au(o,o);const r=structuredClone(this._vignetteParams),s=i.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},n=t.transform.zoom;if(s.revealStart>n)return;const a=oa(0,1,s.revealStart,s.revealStart+s.revealRange,n);r.strength*=a,i.overrideStyleParameters||(i.intensity=t.style.snow.state.density,i.timeFactor=t.style.snow.state.intensity,i.color=structuredClone(t.style.snow.state.color),o=structuredClone(t.style.snow.state.direction),i.screenThinning.intensity=t.style.snow.state.centerThinning,i.billboardSize=2.79*t.style.snow.state.flakeSize,r.strength=1,r.color=structuredClone(t.style.snow.state.vignetteColor));const l=this.updateOnRender(t,i.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const c=t.context,h=c.gl,d=t.transform,u=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(c,u),((i,r,s)=>{const n=ta(this._movement.getPosition(),i),a=d.width/2,c=d.height/2,_=oa(0,s.screenThinning.start,0,1,s.screenThinning.intensity),p=oa(.001,s.screenThinning.range,0,1,s.screenThinning.intensity),f=oa(0,s.screenThinning.particleOffset,0,1,s.screenThinning.intensity),m=(g={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:n,velocityConeAperture:s.velocityConeAperture,velocity:s.velocity,horizontalOscillationRadius:s.horizontalOscillationRadius,horizontalOscillationRate:s.horizontalOscillationRate,boxSize:i,billboardSize:1*s.billboardSize,simpleShapeParameters:[s.shapeFadeStart,s.shapeFadePower],screenSize:[d.width,d.height],thinningCenterPos:[a,c],thinningShape:[_,p,Math.pow(10,s.screenThinning.fadePower)],thinningAffectedRatio:s.screenThinning.affectedRatio,thinningParticleOffset:f,color:[s.color.r,s.color.g,s.color.b,s.color.a],direction:o},{u_modelview:Float32Array.from(g.modelview),u_projection:Float32Array.from(g.projection),u_time:g.time,u_cam_pos:g.camPos,u_velocityConeAperture:g.velocityConeAperture,u_velocity:g.velocity,u_horizontalOscillationRadius:g.horizontalOscillationRadius,u_horizontalOscillationRate:g.horizontalOscillationRate,u_boxSize:g.boxSize,u_billboardSize:g.billboardSize,u_simpleShapeParameters:g.simpleShapeParameters,u_screenSize:g.screenSize,u_thinningCenterPos:g.thinningCenterPos,u_thinningShape:g.thinningShape,u_thinningAffectedRatio:g.thinningAffectedRatio,u_thinningParticleOffset:g.thinningParticleOffset,u_particleColor:g.color,u_direction:g.direction});var g;const v=Math.round(s.intensity*this.particlesCount),y=e.bd.simpleSegment(0,0,4*v,2*v);this.particlesVx&&this.particlesIdx&&u.draw(t,h.TRIANGLES,Ni.disabled,ji.disabled,ki.alphaBlended,qi.disabled,m,"snow_particles",this.particlesVx,this.particlesIdx,y);})(i.boxSize,0,i),this._vignette.draw(t,r);}}const la={symbol:function(t,i,o,r,s){if("translucent"!==t.renderPass)return;const n=ji.disabled,a=t.colorModeForRenderPass(),l=o.layout.get("text-variable-anchor"),c=o.layout.get("text-size-scale-range"),h=e.ay(t.scaleFactor,c[0],c[1]);l&&function(t,i,o,r,s,n,a,l){const c=i.transform,h="map"===s,d="map"===n;for(const i of t){const t=r.getTile(i),s=t.getBucket(o);if(!s||!s.text||!s.text.segments.get().length)continue;const n=e.bH(s.textSizeData,c.zoom,l),u=Vt(i,s.getProjection(),c),_=c.calculatePixelsToTileUnitsMatrix(t),p=$t(u,t.tileID.canonical,d,h,c,s.getProjection(),_),f=s.hasIconTextFit()&&s.hasIconData();n&&Gs(s,h,d,a,c,p,i,Math.pow(2,c.zoom-t.tileID.overscaledZ),n,f);}}(r,t,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),s,h);const d=0!==o.paint.get("icon-opacity").constantOr(1),u=0!==o.paint.get("text-opacity").constantOr(1);void 0!==o.layout.get("symbol-sort-key").constantOr(1)&&(d||u)?Vs(t,i,o,r,n,a):(d&&Vs(t,i,o,r,n,a,{onlyIcons:!0}),u&&Vs(t,i,o,r,n,a,{onlyText:!0})),i.map.showCollisionBoxes&&(ks(t,i,o,r,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),ks(t,i,o,r,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1));},circle:function(t,i,o,r){if("translucent"!==t.renderPass)return;const s=o.paint.get("circle-opacity"),n=o.paint.get("circle-stroke-width"),a=o.paint.get("circle-stroke-opacity"),l=void 0!==o.layout.get("circle-sort-key").constantOr(1),c=o.paint.get("circle-emissive-strength");if(0===s.constantOr(1)&&(0===n.constantOr(1)||0===a.constantOr(1)))return;const h=t.context,d=h.gl,u=t.transform,_=!(!t.terrain||!t.terrain.enabled),p=o.layout.get("circle-elevation-reference"),f=t.depthModeForSublayer(0,Ni.ReadOnly),m=new Ni(t.context.gl.LEQUAL,Ni.ReadOnly,t.depthRangeFor3D),g="none"===p||_?f:m,v=ji.disabled,y=t.colorModeForDrapableLayerRenderPass(c),x="globe"===u.projection.name,b=[e.aD(u.center.lng),e.aH(u.center.lat)],w=[];for(let s=0;s<r.length;s++){const n=r[s],a=i.getTile(n),c=a.getBucket(o);if(!c||c.projection.name!==u.projection.name)continue;const h=c.programConfigurations.get(o.id),d=c.layoutVertexBuffer,_=c.globeExtVertexBuffer,p=c.indexBuffer,f=e.dW(o),m=[_],g=t.isTileAffectedByFog(n);x&&f.push("PROJECTION_GLOBE_VIEW"),f.push("DEPTH_D24"),t.terrain&&u.depthOcclusionForSymbolsAndCircles&&f.push("DEPTH_OCCLUSION"),c.hasElevation&&!t.terrain&&(f.push("ELEVATED_ROADS"),m.push(c.elevatedLayoutVertexBuffer));const v=t.getOrCreateProgram("circle",{config:h,defines:f,overrideFog:g}),y=u.projection.createInversionMatrix(u,n.canonical),T={programConfiguration:h,program:v,layoutVertexBuffer:d,dynamicBuffers:m,indexBuffer:p,uniformValues:e.dX(t,n,a,y,b,o),tile:a};if(l){const t=c.segments.get();for(const i of t)w.push({segments:new e.bd([i]),sortKey:i.sortKey,state:T});}else w.push({segments:c.segments,sortKey:0,state:T});}l&&w.sort(((e,t)=>e.sortKey-t.sortKey));const T={useDepthForOcclusion:u.depthOcclusionForSymbolsAndCircles};for(const e of w){const{programConfiguration:i,program:r,layoutVertexBuffer:s,dynamicBuffers:n,indexBuffer:a,uniformValues:l,tile:c}=e.state,_=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,r,T),t.uploadCommonUniforms(h,r,c.tileID.toUnwrapped()),r.draw(t,d.TRIANGLES,g,v,y,qi.disabled,l,o.id,s,a,_,o.paint,u.zoom,i,n);}},heatmap:function(t,i,o,r){if(0!==o.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const s=t.context,n=s.gl,a=ji.disabled,l=new ki([n.ONE,n.ONE,n.ONE,n.ONE],e.am.transparent,[!0,!0,!0,!0]);!function(e,t,i,o){const r=e.gl,s=t.width*o,n=t.height*o;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,s,n]);let a=i.heatmapFbo;if(!a||a&&(a.width!==s||a.height!==n)){a&&a.destroy();const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),a=i.heatmapFbo=e.createFramebuffer(s,n,!0,null),function(e,t,i,o,r,s){const n=e.gl;n.texImage2D(n.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?n.RGBA16F:n.RGBA,r,s,0,n.RGBA,e.extRenderToTextureHalfFloat?n.HALF_FLOAT:n.UNSIGNED_BYTE,null),o.colorAttachment.set(i);}(e,0,t,a,s,n);}else r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),e.bindFramebuffer.set(a.framebuffer);}(s,t,o,"globe"===t.transform.projection.name?.5:.25),s.clear({color:e.am.transparent});const c=t.transform,h="globe"===c.projection.name,d=h?["PROJECTION_GLOBE_VIEW"]:[],u=h?qi.frontCCW:qi.disabled,_=[e.aD(c.center.lng),e.aH(c.center.lat)];for(let e=0;e<r.length;e++){const p=r[e];if(i.hasRenderableParent(p))continue;const f=i.getTile(p),m=f.getBucket(o);if(!m||m.projection.name!==c.projection.name)continue;const g=t.isTileAffectedByFog(p),v=m.programConfigurations.get(o.id),y=t.getOrCreateProgram("heatmap",{config:v,defines:d,overrideFog:g}),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(f,y),t.uploadCommonUniforms(s,y,p.toUnwrapped());const b=c.projection.createInversionMatrix(c,p.canonical);y.draw(t,n.TRIANGLES,Ni.disabled,a,l,u,fs(t,p,f,b,_,x,o.paint.get("heatmap-intensity")),o.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,o.paint,t.transform.zoom,v,h?[m.globeExtVertexBuffer]:null);}s.viewport.set([0,0,t.width,t.height]);}else "translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const o=t.context,r=o.gl,s=i.heatmapFbo;if(!s)return;o.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,s.colorAttachment.get()),o.activeTexture.set(r.TEXTURE1);let n=i.colorRampTexture;n||(n=i.colorRampTexture=new e.T(o,i.colorRamp,r.RGBA8)),n.bind(r.LINEAR,r.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,r.TRIANGLES,Ni.disabled,ji.disabled,t.colorModeForRenderPass(),qi.disabled,((e,t,i,o)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom);}(t,o));},line:function(t,i,o,r){if("translucent"!==t.renderPass)return;const s=o.paint.get("line-opacity"),n=o.paint.get("line-width");if(0===s.constantOr(1)||0===n.constantOr(1))return;const a=o.paint.get("line-emissive-strength"),l=o.paint.get("line-occlusion-opacity"),c=o.layout.get("line-elevation-reference"),h="meters"===o.layout.get("line-width-unit"),d="sea"===c,u=!(!t.terrain||!t.terrain.enabled),_=t.context,p=_.gl;if(o.hasElevatedBuckets&&"globe"===t.transform.projection.name)return;const f=o.layout.get("line-cross-slope"),m=void 0!==f,g=f<1,v=t.colorModeForDrapableLayerRenderPass(a),y=t.terrain&&t.terrain.renderingToTexture,x=y?1:e.q.devicePixelRatio,b=o.paint.get("line-dasharray"),w=b.constantOr(1),T=o.layout.get("line-cap"),E=b.constantOr(null),S=T.constantOr(null),I=o.paint.get("line-pattern"),C=I.constantOr(1),R=o.paint.get("line-pattern-cross-fade"),A=I.constantOr(null),D=o.paint.get("line-opacity").constantOr(1);let P=!C&&1!==D||t.depthOcclusion&&l>0&&l<1;const L=o.paint.get("line-gradient"),z=C?"linePattern":"line",M=e.dY(o);let O;if(y&&t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(P=!1),0!==l&&t.depthOcclusion){const t=o.paint._values["line-opacity"];t&&t.value&&"constant"===t.value.kind?O=t.value:e.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`);}"constant"!==n.value.kind&&!1===n.value.isLineProgressConstant&&M.push("VARIABLE_LINE_WIDTH");const F=(r,s,n,a,c,u)=>{for(const f of r){const r=i.getTile(f);if(C&&!r.patternsLoaded())continue;const m=r.getBucket(o);if(!m)continue;if("none"!==m.elevationType&&!c||"none"===m.elevationType&&c)continue;t.prepareDrawTile();const g=[...s],b=t.shadowRenderer,T="road"===m.elevationType&&!!b&&b.enabled;let I=[0,0,0];if(T){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(I=ao(t.style,e,i)),g.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");}const M=m.programConfigurations.get(o.id);let F=!1;if(A&&r.imageAtlas){const t=e.dZ.from(A),i=t.getPrimary().scaleSelf(x).toString(),o=r.imageAtlas.patternPositions.get(i),s=t.getSecondary(),n=s?r.imageAtlas.patternPositions.get(s.scaleSelf(x).toString()):null;F=!!o&&!!n,o&&M.setConstantPatternPositions(o,n);}R>0&&(F||M.getPatternTransitionVertexBuffer("line-pattern"))&&g.push("LINE_PATTERN_TRANSITION");const B=t.isTileAffectedByFog(f),k=t.getOrCreateProgram(z,{config:M,defines:g,overrideFog:B});if(!C&&E&&S&&r.lineAtlas){const e=r.lineAtlas.getDash(E,S);e&&M.setConstantPatternPositions(e);}T&&b.setupShadows(r.tileID.toUnwrapped(),k,"vector-tile");let[N,U]=o.paint.get("line-trim-offset");if("round"===S||"square"===S){const e=1;N!==U&&(0===N&&(N-=e),1===U&&(U+=e));}const j=y?f.projMatrix:null,G=h?1/m.tileToMeter/e.aw(r,1,t.transform.zoom):1,V=h?1/m.tileToMeter/e.aw(r,1,Math.floor(t.transform.zoom)):1,q=C?e.d_(t,r,o,j,x,G,V,[N,U],I,R):e.d$(t,r,o,j,m.lineClipsArray.length,x,G,V,[N,U],I);if(L){const r=m.gradients[o.id];let s=r.texture;if(o.gradientVersion!==r.version){let n=256;if(o.stepInterpolant){const o=i.getSource().maxzoom,r=f.canonical.z===o?Math.ceil(1<<t.transform.maxZoom-f.canonical.z):1;n=e.ay(e.e0(m.maxLineLength/e.aj*1024*r),256,_.maxTextureSize);}r.gradient=e.e1({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:n,image:r.gradient||void 0,clips:m.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new e.T(_,r.gradient,p.RGBA8),r.version=o.gradientVersion,s=r.texture;}_.activeTexture.set(p.TEXTURE1),s.bind(o.stepInterpolant?p.NEAREST:p.LINEAR,p.CLAMP_TO_EDGE);}w&&(_.activeTexture.set(p.TEXTURE0),r.lineAtlasTexture&&r.lineAtlasTexture.bind(p.LINEAR,p.REPEAT),M.updatePaintBuffers()),C&&(_.activeTexture.set(p.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),M.updatePaintBuffers()),c&&!d&&t.terrain.setupElevationDraw(r,k),t.uploadCommonUniforms(_,k,f.toUnwrapped());const H=e=>{null!=O&&(O.value=D*l),k.draw(t,p.TRIANGLES,n,e,v,qi.disabled,q,o.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,o.paint,t.transform.zoom,M,[m.layoutVertexBuffer2,m.patternVertexBuffer,m.zOffsetVertexBuffer]),null!=O&&(O.value=D);};if(P&&!c){const e=t.stencilModeForClipping(f).ref;0===e&&y&&_.clear({stencil:0});const i={func:p.EQUAL,mask:255};q.u_alpha_discard_threshold=.8,H(new ji(i,e,255,p.KEEP,p.KEEP,p.INVERT)),q.u_alpha_discard_threshold=0,H(new ji(i,e,255,p.KEEP,p.KEEP,p.KEEP));}else q.u_alpha_discard_threshold=P&&c&&u?.8:0,H(c?a:t.stencilModeForClipping(f));}};let B=t.depthModeForSublayer(0,Ni.ReadOnly);const k=new Ni(t.depthOcclusion?p.GREATER:p.LEQUAL,Ni.ReadOnly,t.depthRangeFor3D);if(o.hasNonElevatedBuckets){const i=!y&&t.terrain;0!==l&&i?e.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):i?e.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):F(r,M,B,ji.disabled,!1,!0);}if(o.hasElevatedBuckets){"hd-road-markup"===c?u||(B=k,M.push("ELEVATED_ROADS")):(M.push("ELEVATED"),B=k,m&&M.push(g?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),d&&M.push("ELEVATION_REFERENCE_SEA"));const e=P?t.stencilModeFor3D():ji.disabled;t.forceTerrainMode=!0,F(r,M,B,e,!0,!0),P&&F(r,M,B,e,!0,!1),t.forceTerrainMode=!1;}P&&(t.resetStencilClippingMasks(),y&&_.clear({stencil:0})),0===l||t.depthOcclusion||y||t.layersWithOcclusionOpacity.push(t.currentLayer);},fill:function(t,i,o,r){const s=o.paint.get("fill-color"),n=o.paint.get("fill-opacity");if(0===n.constantOr(1))return;const a=o.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=o.paint.get("fill-pattern"),h=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===s.constantOr(e.am.transparent).a&&1===n.constantOr(0)?"opaque":"translucent";let d="none";"none"!==o.layout.get("fill-elevation-reference")?d="road":0!==o.paint.get("fill-z-offset").constantOr(1)&&(d="offset");const u=!(!t.terrain||!t.terrain.enabled),_={painter:t,sourceCache:i,layer:o,coords:r,colorMode:l,elevationType:d,terrainEnabled:u,pass:h};if("shadow"!==t.renderPass)if("offset"!==d){if(Ws(_,!1),"road"===d){const e=!u&&"translucent"===t.renderPass;e&&Zs(t,i,o,r,"geometry"),Ws(_,!0,ji.disabled),e&&function(e){const{painter:t,sourceCache:i,layer:o,coords:r,colorMode:s}=e,n=t.context.gl,a=e.painter.shadowRenderer,l=!!a&&a.enabled,c=new Ni(t.context.gl.LEQUAL,Ni.ReadOnly,t.depthRangeFor3D);let h=[0,0,0];if(l){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(h=ao(t.style,e,i));}const d=e=>{for(const d of r){const r=i.getTile(d),u=r.getBucket(o);if(!u)continue;const _=u.elevatedStructures;if(!_)continue;let p,f;if(e?(p=_.renderableBridgeSegments,f=_.bridgeProgramConfigurations.get(o.id)):(p=_.renderableTunnelSegments,f=_.tunnelProgramConfigurations.get(o.id)),!p||0===p.segments[0].primitiveLength)continue;f.updatePaintBuffers(),t.prepareDrawTile();const m=t.isTileAffectedByFog(d),g=[];l&&g.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const v=t.getOrCreateProgram("elevatedStructures",{config:f,overrideFog:m,defines:g}),y=t.translatePosMatrix(d.projMatrix,r,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));l&&a.setupShadows(r.tileID.toUnwrapped(),v,"vector-tile");const x=as(y,h);t.uploadCommonUniforms(t.context,v,d.toUnwrapped()),v.draw(t,n.TRIANGLES,c,ji.disabled,s,qi.backCCW,x,o.id,_.vertexBuffer,_.indexBuffer,p,o.paint,t.transform.zoom,f,[_.vertexBufferNormal]);}};d(!0),d(!1);}(_);}}else Ws(_,!1,t.stencilModeFor3D());else t.shadowRenderer&&"road"===d&&!u&&function(e){const{painter:t,sourceCache:i,layer:o,coords:r}=e,s=t.context.gl,n=e.painter.shadowRenderer;for(const e of r){const r=i.getTile(e),a=r.getBucket(o);if(!a)continue;const l=a.elevatedStructures;if(!l)continue;if(!l.shadowCasterSegments||0===l.shadowCasterSegments.segments[0].primitiveLength)continue;t.prepareDrawTile();const c=a.bufferData.programConfigurations.get(o.id),h=t.isTileAffectedByFog(e),d=t.getOrCreateProgram("elevatedStructuresDepth",{config:c,overrideFog:h}),u=n.calculateShadowPassMatrixFromTile(r.tileID.toUnwrapped());t.uploadCommonUniforms(t.context,d,e.toUnwrapped());const _={u_matrix:u,u_depth_bias:0};d.draw(t,s.TRIANGLES,n.getShadowPassDepthMode(),ji.disabled,n.getShadowPassColorMode(),qi.disabled,_,o.id,l.vertexBuffer,l.indexBuffer,l.shadowCasterSegments,o.paint,t.transform.zoom,c);}}(_);},"fill-extrusion":function(t,i,o,r){const s=o.paint.get("fill-extrusion-opacity"),n=t.context,a=n.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===s)return;const h=t.conflationActive&&t.style.isLayerClipped(o,i.getSource()),d=t.style.order.indexOf(o.fqid);if(h&&function(e,t,i,o,r){for(const s of o){const o=t.getTile(s).getBucket(i);o&&(o.updateReplacement(s,e.replacementSource,r),o.uploadCentroid(e.context));}}(t,i,o,r,d),l||h)for(const e of r){const r=i.getTile(e).getBucket(o);r&&Ks(t.context,i,e,r,o,l,h);}if("shadow"===t.renderPass&&t.shadowRenderer){const n=t.shadowRenderer;if(l&&s<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.ab)return;const a=n.getShadowPassDepthMode(),c=n.getShadowPassColorMode();$s(t,i,o,r,a,ji.disabled,c,h);}else if("translucent"===t.renderPass){const d=!o.paint.get("fill-extrusion-pattern").constantOr(1),u=o.paint.get("fill-extrusion-color").constantOr(e.am.white);if(!c&&0!==u.a){const e=new Ni(t.context.gl.LEQUAL,Ni.ReadWrite,t.depthRangeFor3D);1===s&&d?$s(t,i,o,r,e,ji.disabled,ki.unblended,h):($s(t,i,o,r,e,ji.disabled,ki.disabled,h),$s(t,i,o,r,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),h),t.resetStencilClippingMasks());}if(t.style.enable3dLights()&&d&&(!l&&"globe"!==t.transform.projection.name||c)){const s=o.paint.get("fill-extrusion-opacity"),d=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),u=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),_=o.paint.get("fill-extrusion-flood-light-intensity"),p="none"===o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),f=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(p?null:o.lut).toArray01().slice(0,3),m=d>0&&u>0,g=_>0,v=(e,t,i)=>(1-i)*e+i*t,y=new Xs;y.translate=o.paint.get("fill-extrusion-translate"),y.translateAnchor=o.paint.get("fill-extrusion-translate-anchor"),y.edgeRadius=o.layout.get("fill-extrusion-edge-radius"),y.cutoffFadeRange=o.paint.get("fill-extrusion-cutoff-fade-range");const x=n=>{const l=t.depthModeForSublayer(1,Ni.ReadOnly,a.LEQUAL,!0),c=o.paint.get(n?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),p=v(.1,3,c),m=t._showOverdrawInspector;if(!m){const c=new ji({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),m=new ki([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!1,!1,!1,!0],a.MIN);Ys(y,t,i,o,r,l,c,m,qi.disabled,n,"sdf",s,d,u,_,f,p,h,!1);}{const c=m?ji.disabled:new ji({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),g=m?t.colorModeForRenderPass():new ki([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],e.am.transparent,[!0,!0,!0,!0]);Ys(y,t,i,o,r,l,c,g,qi.disabled,n,"color",s,d,u,_,f,p,h,!1);}};if(c){const c=(n,l,c)=>{const p=t.depthModeForSublayer(1,Ni.ReadOnly,a.LEQUAL,!1),m=o.paint.get(n?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),g=v(.1,3,m);{const c=new ki([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!1,!1,!1,!0]);Ys(y,t,i,o,r,p,ji.disabled,c,qi.disabled,n,"clear",s,d,u,_,f,g,h,l);}{const c=new ji({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),m=new ki([a.ONE,a.ONE,a.ONE,a.ONE],e.am.transparent,[!1,!1,!1,!0],a.MIN);Ys(y,t,i,o,r,p,c,m,qi.disabled,n,"sdf",s,d,u,_,f,g,h,l);}{const c=n?a.ZERO:a.ONE_MINUS_DST_ALPHA,m=new ji({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),v=new ki([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],e.am.transparent,[!0,!0,!0,!0]);Ys(y,t,i,o,r,p,m,v,qi.disabled,n,"color",s,d,u,_,f,g,h,l);}{const m=new ki([a.ONE,a.ONE,a.ONE,n?a.ZERO:a.ONE],e.am.transparent,[!1,!1,!1,!0],n?a.FUNC_ADD:a.MAX);Ys(y,t,i,o,r,p,ji.disabled,m,qi.disabled,n,"clear",s,d,u,_,f,g,h,l,c);}};if(m||g){let i;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],o=l.drapeBufferSize[1];i=l.framebufferCopyTexture,i&&(!i||i.size[0]===t&&i.size[1]===o)||(i&&i.destroy(),i=l.framebufferCopyTexture=new e.T(n,new e.r({width:t,height:o}),a.RGBA8)),i.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexSubImage2D(a.TEXTURE_2D,0,0,0,0,0,t,o);}m&&c(!0,!1,i),g&&c(!1,!0,i);}}else m&&x(!0),g&&x(!1),(m||g)&&t.resetStencilClippingMasks();}}},building:function(t,i,o,r){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);const s=o.paint.get("building-ambient-occlusion-ground-intensity"),n=o.paint.get("building-ambient-occlusion-ground-radius"),a=o.paint.get("building-ambient-occlusion-ground-attenuation");let l=s>0&&n>0,c=!0;const h=o.paint.get("building-vertical-scale");h<1&&(c=!1);const d=t.conflationActive&&t.style.isLayerClipped(o,i.getSource()),u=t.style.order.indexOf(o.fqid);if(function(e,t,i,o,r,s){for(const n of s){const s=t.getTile(n).getBucket(i);s&&(r&&s.updateReplacement(n,e.replacementSource,o),s.uploadUpdatedIndexBuffer(e.context));}}(t,i,o,u,d,r),function(e,t,i,o){for(const r of o){const o=t.getTile(r).getBucket(i);o&&o.needsEvaluation(e,i)&&(o.evaluate(i),o.uploadUpdatedColorBuffer(e.context));}}(t,i,o,r),o.resetLayerRenderingStats(t),t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0),"shadow"===t.renderPass&&t.shadowRenderer){const e=t.shadowRenderer,s=[],n=e.getShadowPassDepthMode();on({painter:t,source:i,layer:o,coords:r,defines:s,blendMode:e.getShadowPassColorMode(),depthMode:n,verticalScale:h});}else if("translucent"===t.renderPass){l&&function(t,i,o,r,s,n,a,l,c,h,d,u,_){const p=t.context.gl,f=t.depthModeForSublayer(1,Ni.ReadOnly,p.LEQUAL,!0),m=.1*(1-(g=d))+3*g;var g;const v=t._showOverdrawInspector,y=u,x=new Xs;v||Ys(x,t,i,o,r,f,new ji({func:p.ALWAYS,mask:255},255,255,p.KEEP,p.KEEP,p.REPLACE),new ki([p.ONE,p.ONE,p.ONE,p.ONE],e.am.transparent,[!1,!1,!1,!0],p.MIN),qi.disabled,s,"sdf",1,a,l,0,h,m,y,!1);{const n=v?ji.disabled:new ji({func:p.EQUAL,mask:255},255,255,p.KEEP,p.DECR,p.DECR),c=v?t.colorModeForRenderPass():new ki([p.ONE_MINUS_DST_ALPHA,p.DST_ALPHA,p.ONE,p.ONE],e.am.transparent,[!0,!0,!0,!0]);Ys(x,t,i,o,r,f,n,c,qi.disabled,s,"color",1,a,l,0,h,m,y,!1);}}(t,i,o,r,!0,0,s,n,0,[0,0,0],a,d);let u=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];c&&(u=u.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),t.shadowRenderer.useNormalOffset&&(u=u.concat("NORMAL_OFFSET"));const _=new Ni(t.context.gl.LEQUAL,Ni.ReadWrite,t.depthRangeFor3D),p=t.colorModeForRenderPass();on({painter:t,source:i,layer:o,coords:r,defines:u,blendMode:p,depthMode:_,verticalScale:h});}else if("light-beam"===t.renderPass){const e=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],s=new Ni(t.context.gl.LEQUAL,Ni.ReadOnly,t.depthRangeFor3D);on({painter:t,source:i,layer:o,coords:r,defines:e,blendMode:ki.alphaBlended,depthMode:s,verticalScale:h});}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1),t.resetStencilClippingMasks();},hillshade:function(e,t,i,o){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const r=e.context,s=e.terrain&&e.terrain.renderingToTexture,[n,a]="translucent"!==e.renderPass||s?[{},o]:e.stencilConfigForOverlap(o);for(const o of a){const r=t.getTile(o);if(r.needsHillshadePrepare&&"offscreen"===e.renderPass)Yo(e,r,i);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Ni.ReadOnly),a=i.paint.get("hillshade-emissive-strength"),l=e.colorModeForDrapableLayerRenderPass(a),c=s&&e.terrain?e.terrain.stencilModeForRTTOverlap(o):n[o.overscaledZ];$o(e,o,r,i,t,c,l);}}r.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks();},raster:function(t,i,o,r,s,n){if("translucent"!==t.renderPass)return;if(0===o.paint.get("raster-opacity"))return;const a="globe"===t.transform.projection.name,l=0!==o.paint.get("raster-elevation"),c=l&&a;if(t.renderElevatedRasterBackface&&!c)return;const h=t.context,d=h.gl,u=i.getSource(),_=function(t,i,o,r){const s=i.paint.get("raster-color"),n="raster-array"===t.type,a=[],l=i.paint.get("raster-resampling"),c=i.paint.get("raster-color-mix");let h=i.paint.get("raster-color-range");const d=[c[0],c[1],c[2],0],u=c[3];let _="nearest"===l?r.NEAREST:r.LINEAR;if(n&&(a.push("RASTER_ARRAY"),s||a.push("RASTER_COLOR"),"linear"===l&&a.push("RASTER_ARRAY_LINEAR"),_=r.NEAREST,!h&&t.rasterLayers)){const e=t.rasterLayers.find((({id:e})=>e===i.sourceLayer));e&&e.fields&&e.fields.range&&(h=e.fields.range);}if(h=h||[0,1],s){a.push("RASTER_COLOR"),o.activeTexture.set(r.TEXTURE2),i.updateColorRamp(h);let t=i.colorRampTexture;t||(t=i.colorRampTexture=new e.T(o,i.colorRamp,r.RGBA8)),t.bind(r.LINEAR,r.CLAMP_TO_EDGE);}return {mix:d,range:h,offset:u,defines:a,resampling:_}}(u,o,h,d);if(u instanceof e.aP&&!r.length&&!a)return;const p=o.paint.get("raster-emissive-strength"),f=t.colorModeForDrapableLayerRenderPass(p),m=t.terrain&&t.terrain.renderingToTexture,g=!t.options.moving,v="nearest"===o.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;if(u instanceof e.aP&&!r.length&&(u.onNorthPole||u.onSouthPole)){const e=l?t.stencilModeFor3D():ji.disabled;return void sn(!!u.onNorthPole,null,t,i,o,p,_,qi.disabled,e)}if(!r.length)return;const[y,x]=u instanceof e.aP||m?[{},r]:t.stencilConfigForOverlap(r),b=x[x.length-1].overscaledZ;c&&_.defines.push("PROJECTION_GLOBE_VIEW"),l&&_.defines.push("RENDER_CUTOFF");const w=(r,s,x)=>{for(const w of r){const r=w.toUnwrapped(),T=i.getTile(w);if(m&&(!T||!T.hasData()))continue;h.activeTexture.set(d.TEXTURE0);const E=an(T,u,o,_);if(!E||!E.texture)continue;const{texture:S,mix:I,offset:C,tileSize:R,buffer:A}=E;let D,P;m?(D=Ni.disabled,P=w.projMatrix):l?(D=new Ni(d.LEQUAL,Ni.ReadWrite,t.depthRangeFor3D),P=a?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(r,g)):(D=t.depthModeForSublayer(w.overscaledZ-b,1===o.paint.get("raster-opacity")?Ni.ReadWrite:Ni.ReadOnly,d.LESS),P=t.transform.calculateProjMatrix(r,g));const L=t.terrain&&m?t.terrain.stencilModeForRTTOverlap(w):y[w.overscaledZ],z=n?0:o.paint.get("raster-fade-duration");T.registerFadeDuration(z);const M=i.findLoadedParent(w,0),O=Gr(T,M,i,t.transform,z);let F,B;t.terrain&&t.terrain.prepareDrawTile(),h.activeTexture.set(d.TEXTURE0),S.bind(v,d.CLAMP_TO_EDGE),h.activeTexture.set(d.TEXTURE1),M?(M.texture&&M.texture.bind(v,d.CLAMP_TO_EDGE),F=Math.pow(2,M.tileID.overscaledZ-T.tileID.overscaledZ),B=[T.tileID.canonical.x*F%1,T.tileID.canonical.y*F%1]):S.bind(v,d.CLAMP_TO_EDGE),"useMipmap"in S&&h.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const k=t.transform;let N;const U=l?nn(k):[0,0,0,0];let j,G,V,q,H,Z=0;if(c&&u instanceof e.aP&&u.coordinates.length>3)j=Float32Array.from(e.bh(e.dD(new e.cA(0,0,0)))),G=Float32Array.from(k.globeMatrix),V=Float32Array.from(e.dz(k)),q=[e.aD(k.center.lng),e.aH(k.center.lat)],N=u.elevatedGlobePerspectiveTransform,H=u.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.dA(w.canonical);Z=e.dB(t.getCenter().lat),j=Float32Array.from(e.bh(e.dD(w.canonical))),G=Float32Array.from(k.globeMatrix),V=Float32Array.from(e.dz(k)),q=[e.aD(k.center.lng),e.aH(k.center.lat)],N=[0,0],H=Float32Array.from(e.dC(w.canonical,t,Z,k.worldSize/k._pixelsPerMercatorPixel));}else N=u instanceof e.aP?u.perspectiveTransform:[0,0],j=new Float32Array(16),G=new Float32Array(9),V=new Float32Array(16),q=[0,0],H=new Float32Array(9);const W=vs(P,j,G,V,H,B||[0,0],e.ah(t.transform.zoom),q,U,F||1,O,o,N,l?o.paint.get("raster-elevation"):0,2,I,C,_.range,R,A,p),$=t.isTileAffectedByFog(w),X=t.getOrCreateProgram("raster",{defines:_.defines,overrideFog:$});if(t.uploadCommonUniforms(h,X,r),u instanceof e.aP){const i=u.elevatedGlobeVertexBuffer,r=u.elevatedGlobeIndexBuffer;if(m||!a)u.boundsBuffer&&u.boundsSegments&&X.draw(t,d.TRIANGLES,D,ji.disabled,f,qi.disabled,W,o.id,u.boundsBuffer,t.quadTriangleIndexBuffer,u.boundsSegments);else if(i&&r){const n=k.zoom<=e.cX?u.elevatedGlobeSegments:u.getSegmentsForLongitude(k.center.lng);n&&X.draw(t,d.TRIANGLES,D,ji.disabled,f,s,W,o.id,i,r,n);}}else if(c){D=new Ni(d.LEQUAL,Ni.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[i,r,n]=e.getGridBuffers(Z,!1);X.draw(t,d.TRIANGLES,D,x||L,t.colorModeForRenderPass(),s,W,o.id,i,r,n);}}else {const{tileBoundsBuffer:e,tileBoundsIndexBuffer:i,tileBoundsSegments:r}=t.getTileBoundsBuffers(T);X.draw(t,d.TRIANGLES,D,L,f,qi.disabled,W,o.id,e,i,r);}}if(!(u instanceof e.aP)&&c)for(const e of r){const r=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&sn(!0,e,t,i,o,p,_,s,x||ji.disabled),r&&sn(!1,e,t,i,o,p,_,s===qi.frontCW?qi.backCW:qi.frontCW,x||ji.disabled);}};c?w(x,t.renderElevatedRasterBackface?qi.backCW:qi.frontCW,t.stencilModeFor3D()):w(x,qi.disabled,void 0),t.resetStencilClippingMasks();},"raster-particle":function(t,i,o,r,s,n){"offscreen"===t.renderPass&&function(t,i,o,r){if(!r.length)return;const s=t.context,n=s.gl,a=i.getSource();if(!(a instanceof rt))return;const l=Math.ceil(Math.sqrt(o.paint.get("raster-particle-count")));let c=o.particlePositionRGBAImage;if(!c||c.width!==l){const t=function(e){const t=e*e,i=new Uint8Array(4*t),o=function(e){return e|=0,e=Math.imul(2747636419^e,2654435769),e=Math.imul(e^e>>>16,2654435769),((e=Math.imul(e^e>>>16,2654435769))>>>0)/4294967296},r=1/1.1;for(let e=0;e<t;e++){const t=r*(o(2*e+0)+xs),s=r*(o(2*e+1)+xs),n=255*t%1,a=255*s%1,l=n,c=s-a/255,h=a;i[4*e+0]=255*(t-n/255),i[4*e+1]=255*l,i[4*e+2]=255*c,i[4*e+3]=255*h;}return i}(l);c=o.particlePositionRGBAImage=new e.r({width:l,height:l},t);}let h=o.particleFramebuffer;h?h.width!==l&&(h.destroy(),h=o.particleFramebuffer=s.createFramebuffer(l,l,!0,null)):h=o.particleFramebuffer=s.createFramebuffer(l,l,!0,null);const d=[];for(const e of r){const t=i.getTile(e);if(!(t instanceof Tt))continue;const r=hn(t,a,o);if(!r)continue;const n=[t.tileSize,t.tileSize];let h=o.tileFramebuffer;h||(h=o.tileFramebuffer=s.createFramebuffer(n[0],n[1],!0,null));let u=t.rasterParticleState;u||(u=t.rasterParticleState=new cn(s,e,n,c));const _=u.update(o.lastInvalidatedAt);u.particleTextureDimension!==l&&u.updateParticleTexture(e,c);const p=u.targetColorTexture;u.targetColorTexture=u.backgroundColorTexture,u.backgroundColorTexture=p;const f=u.particleTexture0;u.particleTexture0=u.particleTexture1,u.particleTexture1=f,d.push([e,r,u,_]);}if(0===d.length)return;const u=e.q.now(),_=o.previousDrawTimestamp?.001*(u-o.previousDrawTimestamp):.0167;if(o.previousDrawTimestamp=u,o.hasColorMap()){s.activeTexture.set(n.TEXTURE0+2);let t=o.colorRampTexture;t||(t=o.colorRampTexture=new e.T(s,o.colorRamp,n.RGBA8)),t.bind(n.LINEAR,n.CLAMP_TO_EDGE);}s.bindFramebuffer.set(o.tileFramebuffer.framebuffer),function(t,i,o){const r=t.context,s=r.gl,n=i.tileFramebuffer;r.activeTexture.set(s.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=i.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const c of o){const[,,o,h]=c;n.colorAttachment.set(o.targetColorTexture.texture),r.viewport.set([0,0,n.width,n.height]),r.clear({color:e.am.transparent}),h&&(o.backgroundColorTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),l.draw(t,s.TRIANGLES,Ni.disabled,ji.disabled,ki.alphaBlended,qi.disabled,a,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments));}}(t,o,d),function(t,i,o,r){const s=t.context,n=s.gl,a=o.tileFramebuffer,l="globe"===t.transform.projection.name,c=o.paint.get("raster-particle-max-speed");for(const h of r){const[r,d,u]=h;s.activeTexture.set(n.TEXTURE0+0),d.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),a.colorAttachment.set(u.targetColorTexture.texture);const _=t.getOrCreateProgram("rasterParticleDraw",{defines:d.defines,overrideFog:!1});s.activeTexture.set(n.TEXTURE0+1);const p=d.scalarData?[]:[0,1,2,3].map((t=>e.e3[t](r)));p.push(r);const f=r.canonical.x,m=r.canonical.y;for(const e of p){const s=i.getTile(l?e.wrapped():e);if(!s)continue;const a=s.rasterParticleState;if(!a)continue;const h=e.canonical.x+(1<<e.canonical.z)*(e.wrap-r.wrap),u=e.canonical.y;a.particleTexture0.bind(n.NEAREST,n.CLAMP_TO_EDGE);const p=ws(1,a.particleTexture0.size[0],[h-f,u-m],0,d.texture.size,2,c,d.textureOffset,d.scale,d.offset);_.draw(t,n.POINTS,Ni.disabled,ji.disabled,ki.alphaBlended,qi.disabled,p,o.id,a.particleIndexBuffer,void 0,a.particleSegment);}}}(t,i,o,d),s.bindFramebuffer.set(o.particleFramebuffer.framebuffer),function(t,i,o,r){const s=t.context,n=s.gl,a=i.paint.get("raster-particle-max-speed"),l=r*i.paint.get("raster-particle-speed-factor")*.15,c=function(e){return Math.pow(e,6)}(.01+1*i.paint.get("raster-particle-reset-rate-factor")),h=i.particleFramebuffer;s.viewport.set([0,0,h.width,h.height]);for(const r of o){const[,o,d]=r;s.activeTexture.set(n.TEXTURE0+0),o.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),s.activeTexture.set(n.TEXTURE0+1);const u=d.particleTexture0;u.bind(n.NEAREST,n.CLAMP_TO_EDGE);const _=Ts(1,u.size[0],0,o.texture.size,a,l,c,o.textureOffset,o.scale,o.offset);h.colorAttachment.set(d.particleTexture1.texture),s.clear({color:e.am.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:o.defines}).draw(t,n.TRIANGLES,Ni.disabled,ji.disabled,ki.unblended,qi.disabled,_,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments);}}(t,o,d,_);}(t,i,o,r),"translucent"===t.renderPass&&(function(t,i,o,r,s){const n=t.context,a=n.gl,l=i.getSource().tileSize,c=5*(1-e.af(e.cI,e.cI+1,t.transform.zoom))*l+o.paint.get("raster-particle-elevation"),h=!t.options.moving,d="globe"===t.transform.projection.name;if(!r.length)return;const[u,_]=t.stencilConfigForOverlap(r),p=[];d&&p.push("PROJECTION_GLOBE_VIEW");const f=t.stencilModeFor3D();for(const r of _){const s=r.toUnwrapped(),l=i.getTile(r);if(!l.rasterParticleState)continue;const _=l.rasterParticleState,m=100;l.registerFadeDuration(m);const g=i.findLoadedParent(r,0),v=Gr(l,g,i,t.transform,m);let y,x;t.terrain&&t.terrain.prepareDrawTile(),n.activeTexture.set(a.TEXTURE0),_.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),n.activeTexture.set(a.TEXTURE1),g&&g.rasterParticleState?(g.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),y=Math.pow(2,g.tileID.overscaledZ-l.tileID.overscaledZ),x=[l.tileID.canonical.x*y%1,l.tileID.canonical.y*y%1]):_.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=d?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(s,h),w=t.transform,T=dn(w),E=e.dA(r.canonical),S=e.dB(E.getCenter().lat);let I,C,R,A,D;d?(I=Float32Array.from(e.bh(e.dD(r.canonical))),C=Float32Array.from(w.globeMatrix),R=Float32Array.from(e.dz(w)),A=[e.aD(w.center.lng),e.aH(w.center.lat)],D=Float32Array.from(e.dC(r.canonical,E,S,w.worldSize/w._pixelsPerMercatorPixel))):(I=new Float32Array(16),C=new Float32Array(9),R=new Float32Array(16),A=[0,0],D=new Float32Array(9));const P=bs(b,I,C,R,D,x||[0,0],e.ah(t.transform.zoom),A,T,y||1,v,c),L=t.isTileAffectedByFog(r),z=t.getOrCreateProgram("rasterParticle",{defines:p,overrideFog:L});if(t.uploadCommonUniforms(n,z,s),d){const e=new Ni(a.LEQUAL,Ni.ReadOnly,t.depthRangeFor3D),i=0,r=t.globeSharedBuffers;if(r){const[s,n,l]=r.getGridBuffers(S,0!==i);z.draw(t,a.TRIANGLES,e,f,ki.alphaBlended,t.renderElevatedRasterBackface?qi.frontCCW:qi.backCCW,P,o.id,s,n,l);}}else {const e=t.depthModeForSublayer(0,Ni.ReadOnly),i=u[r.overscaledZ],{tileBoundsBuffer:s,tileBoundsIndexBuffer:n,tileBoundsSegments:c}=t.getTileBoundsBuffers(l);z.draw(t,a.TRIANGLES,e,i,ki.alphaBlended,qi.disabled,P,o.id,s,n,c);}}t.resetStencilClippingMasks();}(t,i,o,r),t.style.map.triggerRepaint());},background:function(t,i,o,r){const s=o.paint.get("background-color"),n="none"===o.paint.get("background-color-use-theme").constantOr("default"),a=o.paint.get("background-opacity"),l=o.paint.get("background-emissive-strength"),c="viewport"===o.paint.get("background-pitch-alignment");if(0===a)return;const h=t.context,d=h.gl,u=t.transform,_=u.tileSize,p=o.paint.get("background-pattern");let f;if(void 0!==p){if(null===p)return;if(f=t.imageManager.getPattern(e.I.from(p.toString()),o.scope,t.style.getLut(o.scope)),!f)return}const m=!p&&1===s.a&&1===a&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==m)return;const g=ji.disabled,v=t.depthModeForSublayer(0,"opaque"===m?Ni.ReadWrite:Ni.ReadOnly),y=t.colorModeForDrapableLayerRenderPass(l),x=p?"backgroundPattern":"background";let b,w=r;if(w||(b=t.getBackgroundTiles(),w=Object.values(b).map((e=>e.tileID))),p&&(h.activeTexture.set(d.TEXTURE0),t.imageManager.bind(t.context,o.scope)),c){const i=t.getOrCreateProgram(x,{overrideFog:!1,overrideRtt:!0}),r=new Float32Array(e.bx([])),h=new e.aM(0,0,0,0,0),u=p?Cs(r,l,a,t,0,o.scope,f,c,{tileID:h,tileSize:_}):Is(r,l,a,s.toPremultipliedRenderColor(n?null:o.lut));i.draw(t,d.TRIANGLES,v,g,y,qi.disabled,u,o.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments);}else for(const e of w){const m=t.isTileAffectedByFog(e),w=t.getOrCreateProgram(x,{overrideFog:m}),T=e.toUnwrapped(),E=r?e.projMatrix:t.transform.calculateProjMatrix(T);t.prepareDrawTile();const S=i?i.getTile(e):b?b[e.key]:new wt(e,_,u.zoom,t),I=p?Cs(E,l,a,t,0,o.scope,f,c,{tileID:e,tileSize:_}):Is(E,l,a,s.toPremultipliedRenderColor(n?null:o.lut));t.uploadCommonUniforms(h,w,T);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:R,tileBoundsSegments:A}=t.getTileBoundsBuffers(S);w.draw(t,d.TRIANGLES,v,g,y,qi.disabled,I,o.id,C,R,A);}},sky:function(t,i,o){const r=t._atmosphere?e.ah(t.transform.zoom):1,s=o.paint.get("sky-opacity")*r;if(0===s)return;const n=t.context,a=o.paint.get("sky-type"),l=new Ni(n.gl.LEQUAL,Ni.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===t.renderPass?o.needsSkyboxCapture(t)&&(function(t,i,o,r){const s=t.context,n=s.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=s.createFramebuffer(32,32,!0,null),i.skyboxGeometry=new Sn(s),i.skyboxTexture=s.gl.createTexture(),n.bindTexture(n.TEXTURE_CUBE_MAP,i.skyboxTexture),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR);for(let e=0;e<6;++e)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,n.RGBA,32,32,0,n.RGBA,n.UNSIGNED_BYTE,null);}s.bindFramebuffer.set(a.framebuffer),s.viewport.set([0,0,32,32]);const l=i.getCenter(t,!0),c=t.getOrCreateProgram("skyboxCapture"),h=new Float64Array(16);e.bx(h),e.eh(h,h,.5*-Math.PI),In(t,i,c,h,l,0),e.bx(h),e.eh(h,h,.5*Math.PI),In(t,i,c,h,l,1),e.bx(h),e.cR(h,h,.5*-Math.PI),In(t,i,c,h,l,2),e.bx(h),e.cR(h,h,.5*Math.PI),In(t,i,c,h,l,3),e.bx(h),In(t,i,c,h,l,4),e.bx(h),e.eh(h,h,Math.PI),In(t,i,c,h,l,5),s.viewport.set([0,0,t.width,t.height]);}(t,o),o.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,i,o,r){const s=e.context,n=s.gl,a=e.transform,l=e.getOrCreateProgram("skybox");s.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,i,o,r)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:o,u_temporal_offset:r}))(a.skyboxMatrix,t.getCenter(e,!1),0,o,r);e.uploadCommonUniforms(s,l),l.draw(e,n.TRIANGLES,i,ji.disabled,e.colorModeForRenderPass(),qi.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment);}(t,o,l,s,c):"gradient"===a&&"sky"===t.renderPass&&function(t,i,o,r,s){const n=t.context,a=n.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new Sn(n)),n.activeTexture.set(a.TEXTURE0);let h=i.colorRampTexture;h||(h=i.colorRampTexture=new e.T(n,i.colorRamp,a.RGBA8)),h.bind(a.LINEAR,a.CLAMP_TO_EDGE);const d=((t,i,o,r,s)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.al(o),u_opacity:r,u_temporal_offset:s}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),r,s);t.uploadCommonUniforms(n,c),c.draw(t,a.TRIANGLES,o,ji.disabled,t.colorModeForRenderPass(),qi.backCW,d,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment);}(t,o,l,s,c);},custom:function(t,i,o,r){const s=t.context,n=o.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&o.isDraped(i)){if("offscreen"===t.renderPass){const i=n.prerender;if(i){if(t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const o=t.transform.pointMerc;i.call(n,s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ah(t.transform.zoom),[o.x,o.y],t.transform.pixelsPerMeterRatio);}else i.call(n,s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState();}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const e=n.renderToTile;if(e){const i=r[0].canonical,o={x:i.x+r[0].wrap*(n.wrapTileId?0:1<<i.z),y:i.y,z:i.z};s.setDepthMode(Ni.disabled),s.setStencilMode(ji.disabled),s.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),e.call(n,s.gl,o),s.setDirty(),t.setBaseState();}return}t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),s.setStencilMode(ji.disabled);const i="3d"===n.renderingMode?new Ni(t.context.gl.LEQUAL,Ni.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Ni.ReadOnly);if(s.setDepthMode(i),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;n.render(s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.ah(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio);}else n.render(s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState(),s.bindFramebuffer.set(null);}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.");},model:function(t,i,o,r){if("opaque"===t.renderPass)return;const s=o.paint.get("model-opacity").constantOr(1);if(0===s)return;const n=o.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!n)return;if(t.terrain&&s<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof e.ab)return}const a=t.shadowRenderer,l=o.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,l||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,l||(a.enabled=!0));},h=i.getSource();if("light-beam"===t.renderPass&&"batched-model"!==h.type)return;if("vector"===h.type||"geojson"===h.type)return function(t,i,o,r,s){const n=t.transform;if("mercator"!==n.projection.name)return void e.w(`Drawing 3D models for ${n.projection.name} projection is not yet implemented`);const a=n.getFreeCameraOptions().position;if(!t.modelManager)return;const l=t.modelManager;o.modelManager=l;const c=t.shadowRenderer;if(!o._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const h=o._unevaluatedLayout._values["model-id"],d=Object.assign({},o.layout.get("model-id").parameters),u=t.style.order.indexOf(o.fqid);for(const _ of r){const r=i.getTile(_).getBucket(o);if(!r||r.projection.name!==n.projection.name)continue;const p=r.getModelUris();p&&!r.modelsRequested&&(l.addModelsFromBucket(p,s),r.modelsRequested=!0);const f=Un(_,n);d.zoom=f;const m=h.possiblyEvaluate(d);if(kn(t,r,_),Nn.shadowUniformsInitialized=!1,Nn.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(_.toUnwrapped()),"shadow"===t.renderPass&&c){if(1===t.currentShadowCascade&&r.isInsideFirstShadowMapFrustum)continue;const i=n.calculatePosMatrix(_.toUnwrapped(),n.worldSize);if(Nn.tileMatrix.set(i),Nn.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(i)),Nn.aabb.min.fill(0),Nn.aabb.max[0]=Nn.aabb.max[1]=e.aj,Nn.aabb.max[2]=0,Vn(r,Nn,t,o.scope))continue}const g=1<<_.canonical.z,v=[((a.x-_.wrap)*g-_.canonical.x)*e.aj,(a.y*g-_.canonical.y)*e.aj,a.z*g*e.aj];t.conflationActive&&Object.keys(r.instancesPerModel).length>0&&t.style.isLayerClipped(o,i.getSource())&&r.updateReplacement(_,t.replacementSource,u,s)&&(r.uploaded=!1,r.upload(t.context));for(let e in r.instancesPerModel){const i=r.instancesPerModel[e];i.features.length>0&&(e=m.evaluate(i.features[0].feature,{}));const n=l.getModel(e,s);if(n||l.hasURLBeenRequested(e)||r.modelUris.includes(e)||(r.modelUris.push(e),r.modelsRequested=!1),n&&n.uploaded)for(const e of n.nodes)jn(t,o,e,i,v,_,Nn);}}}(t,i,o,r,"vector"===h.type?o.scope:""),void c();if(!h.loaded())return;if("batched-model"===h.type)return function(t,i,o,r){o.resetLayerRenderingStats(t);const s=t.context,n=t.transform,a=t.style.fog,l=t.shadowRenderer;if("mercator"!==n.projection.name)return void e.w(`Drawing 3D landmark models for ${n.projection.name} projection is not yet implemented`);const c=t.transform.getFreeCameraOptions().position,h=e.c1([],[c.x,c.y,c.z],t.transform.worldSize),d=e.eq([],h),u=e.bx([]),_=e.e9(n.center.lat,n.zoom),p=e.bn([],[1,1,1/_]);e.bo(u,u,d);const f=o.paint.get("model-opacity").constantOr(1),m=new Ni(s.gl.LEQUAL,Ni.ReadWrite,t.depthRangeFor3D),g=new Ni(s.gl.LEQUAL,Ni.ReadOnly,t.depthRangeFor3D),v=new e.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),y="shadow"===t.renderPass,x=y&&l?l.getCurrentCascadeFrustum():n.getFrustum(n.scaleZoom(n.worldSize)),b=o.paint.get("model-front-cutoff"),w=b[2]<1,T=eo(t,o.paint.get("model-cutoff-fade-range")),E=o.getLayerRenderingStats();((function(e,t,i,o){const r=e.terrain?e.terrain.exaggeration():0,s=e.transform.zoom;for(const n of o){const o=t.getTile(n).getBucket(i);o&&(o.setFilter(i.filter),e.conflationActive&&o.updateReplacement(n,e.replacementSource),o.evaluateTransform(e,i),e.terrain&&r>0&&o.elevationUpdate(e.terrain,r,n,i.source),o.needsReEvaluation(e,s,i)&&o.evaluate(i));}}))(t,i,o,r),function(){let c,d,S;w?(c=r.length-1,d=-1,S=-1):(c=0,d=r.length,S=1);const I=new Float64Array(16),C=e.cx(),R=new e.P(0,0);for(let A=c;A!==d;A+=S){const c=r[A],d=i.getTile(c).getBucket(o);if(!d||!d.uploaded)continue;let S=!1;l&&(S=0===l.getMaxCascadeForTile(c.toUnwrapped()));const D=n.calculatePosMatrix(c.toUnwrapped(),n.worldSize),P=d.modelTraits;!y&&w&&(e.bi(I,D),e.ad(C,h,I),R.x=C[0],R.y=C[1]);const L=[];d.setFilter(o.filter);for(const i of d.getNodesInfo()){if(i.hiddenByReplacement)continue;if(!i.node.meshes)continue;const o=i.node;let r=0;t.terrain&&o.elevation&&(r=o.elevation*t.terrain.exaggeration());const s=(()=>{const t=i.aabb;return v.min=[...t.min],v.max=[...t.max],v.min[2]+=r,v.max[2]+=r,e.ad(v.min,v.min,D),e.ad(v.max,v.max,D),v})(),a=i.evaluatedScale;if(a[0]<=1&&a[1]<=1&&a[2]<=1&&0===s.intersects(x))continue;if(!y&&w){const t=1/6;i.cameraCollisionOpacity=h[0]>s.min[0]&&h[0]<s.max[0]&&h[1]>s.min[1]&&h[1]<s.max[1]&&h[2]*_<s.max[2]&&o.footprint&&e.bY(R,o.footprint)?Math.max(i.cameraCollisionOpacity-t,0):Math.min(1,i.cameraCollisionOpacity+t);}const l=[...D],d=1/e.d4(c.canonical),u=o.anchor?o.anchor[0]:0,p=o.anchor?o.anchor[1]:0;e.bo(l,l,[u*(a[0]-1)+i.evaluatedTranslation[0]*d,p*(a[1]-1)+i.evaluatedTranslation[1]*d,r+i.evaluatedTranslation[2]]),e.cn(a,e.es)||e.cP(l,l,a);const m=e.az([],l,o.matrix),g=e.az([],n.expandedFarZProjMatrix,m),E=e.az([],n.expandedFarZProjMatrix,l),S=e.aA([],[u,p,r,1],g)[2];o.hidden=!1;let I=f;y||(w&&(I*=i.cameraCollisionOpacity,I*=Hn(l,n,i.aabb,b)),I*=qn(T,S)),0!==I?L.push({nodeInfo:i,depth:S,opacity:I,wvpForNode:g,wvpForTile:E,nodeModelMatrix:m,tileModelMatrix:l}):o.hidden=!0;}y||L.sort(((e,t)=>!w||1===e.opacity&&1===t.opacity?e.depth<t.depth?-1:1:1===e.opacity?-1:1===t.opacity?1:e.depth>t.depth?-1:1));for(const i of L){const r=i.nodeInfo,c=r.node;let h=e.az([],p,i.tileModelMatrix);e.az(h,u,h);const d=e.bi([],h);e.ea(d,d),e.cP(d,d,Gn),h=e.az(h,h,c.matrix);const _="light-beam"===t.renderPass,f="none"===o.paint.get("model-color-use-theme").constantOr("default"),v=P&e.ex.HasMapboxMeshFeatures,x=v?0:r.evaluatedRMEA[0][2];for(let e=0;e<c.meshes.length;++e){const u=c.meshes[e],p=e===c.lightMeshIndex;let b=i.wvpForNode;if(p){if(!_&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}b=i.wvpForTile;}else if(_)continue;const w={defines:[]},T=[];if(!y&&l&&(l.useNormalOffset=!!u.normalBuffer),Mn(w.defines,T,u,t,f?null:o.lut),v||w.defines.push("DIFFUSE_SHADED"),S&&w.defines.push("SHADOWS_SINGLE_CASCADE"),E&&(y?E.numRenderedVerticesInShadowPass+=u.vertexArray.length:E.numRenderedVerticesInTransparentPass+=u.vertexArray.length),y){Bn(u,i.nodeModelMatrix,t,o);continue}let I=null;if(a){const e=zn(i.nodeModelMatrix,t.transform);if(I=new Float32Array(e),"globe"!==n.projection.name){const t=u.aabb.min,i=u.aabb.max,[o,r]=a.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);w.overrideFog=o>=Fe||r>=Fe;}}const C=u.material;let R;C.occlusionTexture&&C.occlusionTexture.offsetScale&&(R=C.occlusionTexture.offsetScale,w.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const A=t.getOrCreateProgram("model",w);!y&&l&&l.setupShadowsFromMatrix(i.tileModelMatrix,A,l.useNormalOffset),t.uploadCommonUniforms(s,A,null,I);const D=C.pbrMetallicRoughness;D.metallicFactor=.9,D.roughnessFactor=.5;const P=As(new Float32Array(b),new Float32Array(h),new Float32Array(d),new Float32Array(c.matrix),t,i.opacity,D.baseColorFactor,C.emissiveFactor,D.metallicFactor,D.roughnessFactor,C,x,o,[0,0,0],R);!p&&(r.hasTranslucentParts||i.opacity<1)&&A.draw(t,s.gl.TRIANGLES,m,ji.disabled,ki.disabled,qi.backCCW,P,o.id,u.vertexBuffer,u.indexBuffer,u.segments,o.paint,t.transform.zoom,void 0,T),A.draw(t,s.gl.TRIANGLES,p?g:m,ji.disabled,p||i.opacity<1||r.hasTranslucentParts?ki.alphaBlended:ki.unblended,qi.backCCW,P,o.id,u.vertexBuffer,u.indexBuffer,u.segments,o.paint,t.transform.zoom,void 0,T);}}}}();}(t,i,o,r),void c();if("model"!==h.type)return;const d=h.getModels(),u=[],_=t.transform.getFreeCameraOptions().position,p=e.c1([],[_.x,_.y,_.z],t.transform.worldSize);e.eq(p,p);const f=[],m=[];let g=0;for(const i of d){const r=o.paint.get("model-rotation").constantOr(null),s=o.paint.get("model-scale").constantOr(null),n=o.paint.get("model-translation").constantOr(null);i.computeModelMatrix(t,r,s,n,!0,!0,!1);const a=e.bx([]),l=e.e9(i.position.lat,t.transform.zoom),c=e.bn([],[1,1,1/l]);e.bo(a,a,p),u.push({zScaleMatrix:c,negCameraPosMatrix:a});for(const e of i.nodes)Fn(t.transform,e,i.matrix,t.transform.expandedFarZProjMatrix,g,f,m);g++;}if(f.sort(((e,t)=>t.depth-e.depth)),"shadow"!==t.renderPass){if(1===s)for(const e of m)On(e,t,o,u[e.modelIndex],ji.disabled,t.colorModeForRenderPass());else {for(const e of m)On(e,t,o,u[e.modelIndex],ji.disabled,ki.disabled);for(const e of m)On(e,t,o,u[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks();}for(const e of f)On(e,t,o,u[e.modelIndex],ji.disabled,t.colorModeForRenderPass());c();}else {for(const e of m)Bn(e.mesh,e.nodeModelMatrix,t,o);for(const e of f)Bn(e.mesh,e.nodeModelMatrix,t,o);c();}}},ca={line:function(e,t,i){if(e.hasElevatedBuckets=!1,e.hasNonElevatedBuckets=!1,void 0!==e._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==e._unevaluatedLayout.getValue("line-z-offset")){if(t){const i=t.getVisibleCoordinates();for(const o of i){const i=t.getTile(o).getBucket(e);if(i&&("none"!==i.elevationType?e.hasElevatedBuckets=!0:e.hasNonElevatedBuckets=!0,e.hasElevatedBuckets&&e.hasNonElevatedBuckets))break}}}else e.hasNonElevatedBuckets=!0;},model:function(e,t,i){const o=t.getSource();if(!o.loaded())return;if("vector"===o.type||"geojson"===o.type)return void(i.modelManager&&i.modelManager.upload(i,"vector"===o.type?e.scope:""));if("batched-model"===o.type)return;if("model"!==o.type)return;const r=o.getModels();for(const e of r)e.upload(i.context);},raster:function(e,t,i){const o=t.getSource();if(!(o instanceof rt&&o.loaded()))return;const r=e.sourceLayer||o.rasterLayerIds&&o.rasterLayerIds[0];if(!r)return;const s=e.paint.get("raster-array-band")||o.getInitialBand(r);if(null==s)return;const n=t.getIds().map((e=>t.getTileByID(e)));for(const t of n)t.updateNeeded(e.id,s)&&o.prepareTile(t,r,e.id,s);},"raster-particle":function(e,t,i){const o=t.getSource();if(!(o instanceof rt&&o.loaded()))return;const r=e.sourceLayer||o.rasterLayerIds&&o.rasterLayerIds[0];if(!r)return;const s=e.paint.get("raster-particle-array-band")||o.getInitialBand(r);if(null==s)return;const n=t.getIds().map((e=>t.getTileByID(e)));for(const t of n)t.updateNeeded(e.id,s)&&o.prepareTile(t,r,e.id,s);}},ha={fill:Zs},da={fill:function(e,t,i,o){if(!i.layout||"none"===i.layout.get("fill-elevation-reference"))return;const r=e.context.gl,s=new Ni(r.LEQUAL,Ni.ReadOnly,e.depthRangeFor3D),n=new ji({func:r.ALWAYS,mask:255},255,255,r.KEEP,r.KEEP,r.REPLACE),a=e.transform.getFreeCameraOptions().position,l=e.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const c of o){const o=t.getTile(c),h=o.getBucket(i);if(!h)continue;const d=h.elevatedStructures;if(!d||0===d.depthSegments.segments[0].primitiveLength)continue;const u=Hs(c.toUnwrapped(),a),_=e.translatePosMatrix(c.projMatrix,o,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),p=ls(_,u,0,1,0);l.draw(e,r.TRIANGLES,s,n,ki.disabled,qi.disabled,p,i.id,d.vertexBuffer,d.indexBuffer,d.depthSegments,i.paint,e.transform.zoom);}}};class ua{constructor(t,i,o,r,s,n){this.context=new Fs(t,i),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=s,this._timeStamp=e.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const a=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const e of a)this._debugParams.enabledLayers[e]=!0;s.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint();})),s.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),s.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),s.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),s.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),s.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const e of a)s.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],e);this.occlusionParams=new $n(s),this.setup(),this.numSublayers=It.maxUnderzooming+It.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ro(this),this._wireframeDebugCache=new Wn,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const l=new e.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new e.T(this.context,l,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=r,this.worldview=n;}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Zr(this,e));const o=this._terrain;this.transform.elevation=i?o:null,o.update(e,this.transform,t),this.transform.elevation&&!o.enabled&&(this.transform.elevation=null);}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,o]=t.getFovAdjustedRange(this.transform._fov);if(i>o)return void(this.transform.fogCullDistSq=null);const r=i+.78*(o-i);this.transform.fogCullDistSq=r*r;}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(e){e&&!this._terrain&&(this._terrain=new Zr(this,this.style)),this._forceTerrainMode=e;}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*e.q.devicePixelRatio,this.height=i*e.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize();}setup(){const t=this.context,i=new e.ba;i.emplaceBack(0,0),i.emplaceBack(e.aj,0),i.emplaceBack(0,e.aj),i.emplaceBack(e.aj,e.aj),this.tileExtentBuffer=t.createVertexBuffer(i,e.bc.members),this.tileExtentSegments=e.bd.simpleSegment(0,0,4,2);const o=new e.ba;o.emplaceBack(0,0),o.emplaceBack(e.aj,0),o.emplaceBack(0,e.aj),o.emplaceBack(e.aj,e.aj),this.debugBuffer=t.createVertexBuffer(o,e.bc.members),this.debugSegments=e.bd.simpleSegment(0,0,4,5);const r=new e.ba;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,e.bc.members),this.viewportSegments=e.bd.simpleSegment(0,0,4,2);const s=new e.aZ;s.emplaceBack(0,0,0,0),s.emplaceBack(e.aj,0,e.aj,0),s.emplaceBack(0,e.aj,0,e.aj),s.emplaceBack(e.aj,e.aj,e.aj,e.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(s,e.bf.members),this.mercatorBoundsSegments=e.bd.simpleSegment(0,0,4,2);const n=new e.a_;n.emplaceBack(0,1,2),n.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(n);const a=new e.bb;for(const e of [0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.T(t,new e.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=e.bz();const l=this.context.gl;this.stencilClearMode=new ji({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now());}getMercatorTileBoundsBuffers(){return {tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Ni.disabled,this.stencilClearMode,ki.disabled,qi.disabled,jr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments);}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={});}_renderTileClippingMasks(e,t,i){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of i)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const o=this.context,r=o.gl;this.nextStencilID+i.length>256&&this.clearStencil(),o.setColorMode(ki.disabled),o.setDepthMode(Ni.disabled);const s=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of i){const i=t.getTile(e),o=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:n,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(i);s.draw(this,r.TRIANGLES,Ni.disabled,new ji({func:r.ALWAYS,mask:0},o,255,r.KEEP,r.KEEP,r.REPLACE),ki.disabled,qi.disabled,jr(e.projMatrix),"$clipping",n,a,l);}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new ji({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new ji({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,i=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),o=i[i.length-1].overscaledZ,r=i[0].overscaledZ-o+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const e={};for(let i=0;i<r;i++)e[i+o]=new ji({func:t.GEQUAL,mask:255},i+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=r,[e,i]}return [{[o]:ji.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new ki([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.am(i,i,i,0),[!0,!0,!0,!0])}return "opaque"===this.renderPass?ki.unblended:ki.alphaBlended}colorModeForDrapableLayerRenderPass(t){const i=this.context.gl;return (()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new ki([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new e.am(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,i,o=!1){if(this.depthOcclusion)return new Ni(this.context.gl.GREATER,Ni.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!o)return Ni.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ni(i||this.context.gl.LEQUAL,t,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,i=Math.ceil(this.width),o=Math.ceil(this.height),r=this.context.bindFramebuffer.get(),s=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===i&&this.depthFBO.height===o||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==i&&0!==o&&(this.depthFBO=new Os(this.context,i,o,!1,"texture"),this.depthTexture=new e.T(this.context,{width:i,height:o,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(r),t.bindTexture(t.TEXTURE_2D,s),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,i,o,0,0,i,o,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current));}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((e,t)=>e+t/this._fpsHistory.length),0));}render(t,i){const o=e.q.now();this._dt=o-this._timeStamp,this._timeStamp=o,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=i;const r=this.style._mergedLayers,s=!(!this.terrain||!this.terrain.enabled),n=()=>this.style._getOrder(s).filter((e=>{const t=r[e];return !(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]}));let a=n(),l=!1,c=!1,h=null;for(const e of a){const t=r[e];"circle"===t.type?l=!0:"building"===t.type?h=t:"symbol"===t.type&&(t.hasInitialOcclusionOpacityProperties?c=!0:l=!0);}let d=a.map((e=>r[e]));const u=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.q.now()),this.imageManager.beginFrame();let _=0,p=!1;for(const e in u){const t=u[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++_);}let f=!1;for(const e of d)e.isHidden(this.transform.zoom)||("clip"===e.type&&(f=!0),this.prepareLayer(e));const m={},g={},v={},y={},x={};for(const e in u){const t=u[e];m[e]=t.getVisibleCoordinates(),g[e]=m[e].slice().reverse(),v[e]=t.getVisibleCoordinates(!0).reverse(),y[e]=t.getShadowCasterCoordinates(),x[e]=t.sortCoordinatesByDistance(m[e]);}const b=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(_||f||this._clippingActiveLastFrame){const t=[],i=[];let o=0;for(const e of d)this.isSourceForClippingOrConflation(e,b(e))&&(t.push(e),i.push(o)),o++;if(t&&(f||t.length>1)||this._clippingActiveLastFrame){f=!1;const o=[];for(let r=0;r<t.length;r++){const s=t[r],n=i[r],a=this.style.getLayerSourceCache(s);if(!a||!a.used||!a.getSource().usedInConflation&&"clip"!==s.type&&"building"!==s.type)continue;let l=e.eF,c=e.bW.None;const h=[];let d=!0;if("building"===s.type)l=e.eH;else if("clip"===s.type){l=n;for(const t of s.layout.get("clip-layer-types"))c|="model"===t?e.bW.Model:"symbol"===t?e.bW.Symbol:e.bW.FillExtrusion;for(const e of s.layout.get("clip-layer-scope"))h.push(e);s.isHidden(this.transform.zoom)?d=!1:f=!0;}d&&o.push({layer:s.fqid,cache:a,order:l,clipMask:c,clipScope:h});}this.replacementSource.setSources(o),p=!0;}}this._clippingActiveLastFrame=f,p||this.replacementSource.clear(),this.conflationActive=p,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let e=0;e<d.length;e++){const t=d[e],i=t.cutoffRange();if(this.longestCutoffRange=Math.max(i,this.longestCutoffRange),i>0){const e=b(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom));}t.is3D(s)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=e),this._lastOcclusionLayer=e);}const w=this.style&&this.style.fog;w?(this._fogVisible=0!==w.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=w.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(v),this.opaquePassCutoff=0,a=n(),d=a.map((e=>r[e])));const T=this._shadowRenderer;if(T){T.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in u)for(const t of m[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),T.addShadowReceiver(t.toUnwrapped(),e.min,e.max);}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Pn(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const E=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),S=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(E&&!this._snow&&(this._snow=new aa(this)),!E&&this._snow&&(this._snow.destroy(),delete this._snow),S&&!this._rain&&(this._rain=new sa(this)),!S&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),h){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ln);const e=this.style.getLayerSourceCache(h);this.buildingTileBorderManager.updateBorders(e,h);}if(!U.has(this.context.gl))return;this.renderPass="offscreen";for(const e of d){const i=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const o=i?g[i.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||o&&o.length)&&this.renderLayer(this,i,e,o);}this.depthRangeFor3D=[0,1-(d.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,y)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const I="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),C=(()=>{if(i.showOverdrawInspector)return e.am.black;const t=this.style.fog;if(t&&this.transform.projection.supportsFog){const i=this.style.getLut(t.scope);if(!I){const o="none"===t.properties.get("color-use-theme"),r=t.properties.get("color").toNonPremultipliedRenderColor(o?null:i).toArray01();return new e.am(...r)}if(I){const o="none"===t.properties.get("space-color-use-theme"),r=t.properties.get("space-color").toNonPremultipliedRenderColor(o?null:i).toArray01();return new e.am(...r)}}return e.am.transparent})();if(this.context.clear({color:C,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&I&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const e=d[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())continue;const o=i?(e.is3D(s)?x:g)[i.id]:void 0;this._renderTileClippingMasks(e,i,o),this.renderLayer(this,i,e,o);}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&I&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.ah(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const e=d[this.currentLayer],i=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?g[i.id]:void 0);}function R(e,t){let i;return t&&(i=("symbol"===e.type?v:e.is3D(s)?x:g)[t.id]),i}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<a.length;){const e=d[this.currentLayer];if("raster"===e.type||"raster-particle"===e.type){const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,R(e,i));}++this.currentLayer;}this.renderElevatedRasterBackface=!1;}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let A=0;T&&(A=T.getShadowCastingLayerCount());let D=!1,P=-1;for(let e=0;e<a.length;++e){const t=d[e];t.isHidden(this.transform.zoom)||t.is3D(s)&&(P=e);}c&&-1===P&&(l=!0);let L=!1;for(;this.currentLayer<a.length;){const e=d[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer);}else {if(!L&&e.is3D(s)&&!s){const e=this.currentLayer,t=e=>{for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const t=d[this.currentLayer];if(ha[t.type]){const i=this.style.getLayerSourceCache(t);ha[t.type](this,i,t,R(t,i),e);}}};t("initialize"),t("reset"),this.currentLayer=e,L=!0;}if(l&&!D&&this.terrain&&!this.transform.isOrthographic&&(D=!0,this.blitDepth()),c&&-1!==P&&this.currentLayer===P+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(e,i,i?m[i.id]:void 0),this.renderLayer(this,i,e,R(e,i)),!this.terrain&&T&&A>0&&e.hasShadowPass()&&0==--A){{this.clearStencil(),this.resetStencilClippingMasks();const e=this.currentLayer;for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const e=d[this.currentLayer];if(da[e.type]){const t=this.style.getLayerSourceCache(e);da[e.type](this,t,e,R(e,t));}}this.currentLayer=e;}if(T.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=d[this.currentLayer];if(!e.hasLightBeamPass())continue;const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,i?g[i.id]:void 0);}this.currentLayer=e,this.renderPass="translucent";}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const e=this.currentLayer;this.depthOcclusion=!0;for(const e of this.layersWithOcclusionOpacity){this.currentLayer=e;const i=d[this.currentLayer],o=t.getLayerSourceCache(i),r=o?g[o.id]:void 0;this.terrain||this._renderTileClippingMasks(i,o,o?m[o.id]:void 0),this.renderLayer(this,o,i,r);}this.depthOcclusion=!1,this.currentLayer=e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[];}++this.currentLayer;}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;d.forEach((e=>{const o=t.getLayerSourceCache(e);o&&!e.isHidden(this.transform.zoom)&&o.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<o.getSource().maxzoom)&&(i=o);})),i&&this.options.showTileBoundaries&&gn(this,i,i.getVisibleCoordinates(),e.am.red,!1,this.options.showParseStatus);}this.terrain&&this._debugParams.showTerrainProxyTiles&&gn(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;yn(e,e.transform.height-(t.top||0),3,un),yn(e,t.bottom||0,3,_n),xn(e,t.left||0,3,pn),xn(e,e.transform.width-(t.right||0),3,fn);const i=e.transform.centerPoint;!function(e,t,i,o){bn(e,t-1,i-10,2,20,o),bn(e,t-10,i-1,20,2,o);}(e,i.x,e.transform.height-i.y,mn);}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),p||(this.conflationActive=!1);}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,i=!t||!t.includes(e.type);if(ca[e.type]&&(i||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);ca[e.type](e,t,this);}this.gpuTimingEnd();}renderLayer(e,t,i,o){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||o&&o.length)&&(this.id=i.id,this.gpuTimingStart(i),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(i.type)&&(!e.terrain||"custom"!==i.type)||"clip"===i.type||la[i.type](e,t,i,o,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd());}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,i=this.context.gl;let o=this.gpuTimers[e.id];o||(o=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQuery()}),o.calls++,i.beginQuery(t.TIME_ELAPSED_EXT,o.query);}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,i=t.createQuery();this.deferredRenderGpuTimeQueries.push(i),t.beginQuery(e.TIME_ELAPSED_EXT,i);}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT);}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT);}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const o=e[i],r=this.context.extTimerQuery,s=r.getQueryParameter(o.query,this.context.gl.QUERY_RESULT)/1e6;r.deleteQueryEXT(o.query),t[i]=s;}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.gl;let i=0;for(const o of e)i+=t.getQueryParameter(o,t.QUERY_RESULT)/1e6,t.deleteQuery(o);return i}translatePosMatrix(t,i,o,r,s){if(!o[0]&&!o[1])return t;const n=s?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(n){const e=Math.sin(n),t=Math.cos(n);o=[o[0]*t-o[1]*e,o[0]*e+o[1]*t];}const a=[s?o[0]:e.aw(i,o[0],this.transform.zoom),s?o[1]:e.aw(i,o[1],this.transform.zoom),0],l=new Float32Array(16);return e.bo(l,t,a),l}saveTileTexture(e){if(e.context!==this.context)return;const t=e.size[0],i=this._tileTextures[t];i?i.push(e):this._tileTextures[t]=[e];}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,i){const o=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,r=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(r.push("LIGHTING_3D_MODE"),r.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):o||r.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||r.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(r.push("TERRAIN"),this.linearFloatFilteringSupported()&&r.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&r.push("GLOBE"),!this._fogVisible||o||void 0!==t&&!t||r.push("FOG","FOG_DITHERING"),o&&r.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&r.push("OVERDRAW_INSPECTOR"),r}getOrCreateProgram(e,t){this.cache=this.cache||{};const i=t&&t.defines||[],o=t&&t.config,r=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(i),s=Yr.cacheKey(Vo[e],e,r,o);return this.cache[s]||(this.cache[s]=new Yr(this.context,e,Vo[e],o,Ps[e],r)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault();}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD);}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8));}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy();}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile();}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){const o=this.style.directionalLight,r=this.style.ambientLight;if(o&&r){const s=((t,i,o)=>{const r=t.properties.get("direction"),s="none"===t.properties.get("color-use-theme"),n=t.properties.get("color").toNonPremultipliedRenderColor(s?null:o.getLut(t.scope)).toArray01(),a=t.properties.get("intensity"),l="none"===i.properties.get("color-use-theme"),c=i.properties.get("color").toNonPremultipliedRenderColor(l?null:o.getLut(i.scope)).toArray01(),h=i.properties.get("intensity"),d=[r.x,r.y,r.z],u=e.dI(c,h),_=e.dI(n,a);return {u_lighting_ambient_color:u,u_lighting_directional_dir:d,u_lighting_directional_color:_,u_ground_radiance:Wr(d,_,u)}})(o,r,this.style);i.setLightsUniformValues(t,s);}}}uploadCommonUniforms(t,i,o,r,s){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;const n=this.style.fog;if(n){const s=n.getOpacity(this.transform.pitch),a=((t,i,o,r,s,n,a,l,c,h,d,u)=>{const _=t.transform,p="none"===i.properties.get("color-use-theme"),f=i.properties.get("color").toNonPremultipliedRenderColor(p?null:t.style.getLut(i.scope)).toArray01();f[3]=r;const m=t.frameCounter/1e3%1,[g,v]=i.properties.get("vertical-range");return {u_fog_matrix:o?_.calculateFogTileMatrix(o):u||t.identityMat,u_fog_range:i.getFovAdjustedRange(_._fov),u_fog_color:f,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(g,v),v],u_fog_temporal_offset:m,u_frustum_tl:s,u_frustum_tr:n,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:h,u_viewport:d,u_globe_transition:e.ah(_.zoom),u_is_globe:+("globe"===_.projection.name)}})(this,n,o,s,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.q.devicePixelRatio,this.transform.height*e.q.devicePixelRatio],r);i.setFogUniformValues(t,a);}s&&i.setCutoffUniformValues(t,s.uniformValues);}setTileLoadedFlag(e){this.tileLoaded=e;}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1);}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return {canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return !1;const e=this.style&&this.style.fog;return !!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const o of i)t[o.key]=e[o.key]||new wt(o,512,this.transform.tileZoom,this,void 0,this.worldview);return t}clearBackgroundTiles(){this._backgroundTiles={};}isSourceForClippingOrConflation(e,t){return !(!e.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==e.type&&"building"!==e.type&&(e.minzoom&&e.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==e.sourceLayer&&"procedural_buildings"!==e.sourceLayer)&&(!t||"batched-model"!==t.type)))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return !1;if("globe"===this.transform.projection.name)return !0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=Fe||t[1]>=Fe}setupDepthForOcclusion(e,t,i){const o=this.context,r=o.gl,s=!!i;var n;i||(i={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),o.activeTexture.set(r.TEXTURE3),e&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),i.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],i.u_depth_range_unpack=[2/((n=this.depthRangeFor3D)[1]-n[0]),-1-2*n[0]/(n[1]-n[0])],i.u_occluder_half_size=.5*this.occlusionParams.occluderSize,i.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),o.activeTexture.set(r.TEXTURE0),s||t.setTerrainUniformValues(o,i);}}function _a(e,t){let i=!1,o=null;const r=()=>{o=null,i&&(e(),o=setTimeout(r,t),i=!1);};return ()=>(i=!0,o||r(),o)}class pa{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_a(this._updateHashUnthrottled.bind(this),300);}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return "";const t=fa(e);if(this._hashName){const e=this._hashName;let i=!1;const o=location.hash.slice(1).split("&").map((o=>{const r=o.split("=")[0];return r===e?(i=!0,`${r}=${t}`):o})).filter((e=>e));return i||o.push(`${e}=${t}`),`#${o.join("&")}`}return `#${t}`}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e);})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return !1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(Number(e))))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return !1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()));}}function fa(e,t){const i=e.getCenter(),o=Math.round(100*e.getZoom())/100,r=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,r),n=Math.round(i.lng*s)/s,a=Math.round(i.lat*s)/s,l=e.getBearing(),c=e.getPitch();let h=t?`/${n}/${a}/${o}`:`${o}/${a}/${n}`;return (l||c)&&(h+="/"+Math.round(10*l)/10),c&&(h+=`/${Math.round(c)}`),h}const ma={linearity:.3,easing:e.eI(0,0,.3,1)},ga=e.h({deceleration:2500,maxSpeed:1400},ma),va=e.h({deceleration:20,maxSpeed:1400},ma),ya=e.h({deceleration:1e3,maxSpeed:360},ma),xa=e.h({deceleration:1e3,maxSpeed:90},ma);class ba{constructor(e){this._map=e,this.clear();}clear(){this._inertiaBuffer=[];}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.q.now(),settings:t});}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.q.now();for(;t.length>0&&i-t[0].time>160;)t.shift();}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(i.pan.mag()){const s=Ta(i.pan.mag(),o,e.h({},ga,t||{}));r.offset=i.pan.mult(s.amount/i.pan.mag()),r.center=this._map.transform.center,wa(r,s);}if(i.zoom){const e=Ta(i.zoom,o,va);r.zoom=this._map.transform.zoom+e.amount,wa(r,e);}if(i.bearing){const t=Ta(i.bearing,o,ya);r.bearing=this._map.transform.bearing+e.ay(t.amount,-179,179),wa(r,t);}if(i.pitch){const e=Ta(i.pitch,o,xa);r.pitch=this._map.transform.pitch+e.amount,wa(r,e);}if(r.zoom||r.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter();}return this.clear(),r.noMoveStart=!0,r}}function wa(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing);}function Ta(t,i,o){const{maxSpeed:r,linearity:s,deceleration:n}=o,a=e.ay(t*s/(i/1e3),-r,r),l=Math.abs(a)/(n*s);return {easing:o.easing,duration:1e3*l,amount:a*(l/2)}}class Ea extends e.A{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,o,r={}){const s=g(i.getCanvasContainer(),o),n=i.unproject(s);super(t,e.h({point:s,lngLat:n,originalEvent:o},r)),this._defaultPrevented=!1,this.target=i;}}class Sa extends e.A{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,o){const r="touchend"===t?o.changedTouches:o.touches,s=v(i.getCanvasContainer(),r),n=s.map((e=>i.unproject(e))),a=s.reduce(((e,t,i,o)=>e.add(t.div(o.length))),new e.P(0,0));super(t,{points:s,point:a,lngLats:n,lngLat:i.unproject(a),originalEvent:o}),this._defaultPrevented=!1;}}class Ia extends e.A{preventDefault(){this._defaultPrevented=!0;}get defaultPrevented(){return this._defaultPrevented}constructor(e,t){super("wheel",{originalEvent:t}),this._defaultPrevented=!1;}}class Ca{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance;}reset(){this._mousedownPos=void 0;}wheel(e){return this._firePreventable(new Ia(this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Ea(e.type,this._map,e))}mouseup(e){this._map.fire(new Ea(e.type,this._map,e));}preclick(t){const i=e.h({},t);i.type="preclick",this._map.fire(new Ea(i.type,this._map,i));}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Ea(e.type,this._map,e)));}dblclick(e){return this._firePreventable(new Ea(e.type,this._map,e))}mouseover(e){this._map.fire(new Ea(e.type,this._map,e));}mouseout(e){this._map.fire(new Ea(e.type,this._map,e));}touchstart(e){return this._firePreventable(new Sa(e.type,this._map,e))}touchmove(e){this._map.fire(new Sa(e.type,this._map,e));}touchend(e){this._map.fire(new Sa(e.type,this._map,e));}touchcancel(e){this._map.fire(new Sa(e.type,this._map,e));}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return {}}isEnabled(){return !0}isActive(){return !1}enable(){}disable(){}}class Ra{constructor(e){this._map=e;}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0;}mousemove(e){this._map.fire(new Ea(e.type,this._map,e));}mousedown(){this._delayContextMenu=!0;}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ea("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent);}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Ea(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault();}isEnabled(){return !0}isActive(){return !1}enable(){}disable(){}}class Aa{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1;}isEnabled(){return !!this._enabled}isActive(){return !!this._active}enable(){this.isEnabled()||(this._enabled=!0);}disable(){this.isEnabled()&&(this._enabled=!1);}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(_(),this._startPos=this._lastPos=t,this._active=!0);}mousemoveWindow(e,t){if(!this._active)return;const i=t,o=this._startPos,r=this._lastPos;if(!o||!r||r.equals(i)||!this._box&&i.dist(o)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=l("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const s=Math.min(o.x,i.x),n=Math.max(o.x,i.x),a=Math.min(o.y,i.y),c=Math.max(o.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${s}px,${a}px)`,this._box.style.width=n-s+"px",this._box.style.height=c-a+"px");}));}mouseupWindow(t,i){if(!this._active)return;const o=this._startPos,r=i;if(o&&0===t.button){if(this.reset(),m(),o.x!==r.x||o.y!==r.y)return this._map.fire(new e.A("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(o,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t);}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e));}blur(){this.reset();}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),p(),delete this._startPos,delete this._lastPos;}_fireEvent(t,i){return this._map.fire(new e.A(t,{originalEvent:i}))}}function Da(e,t){const i={};for(let o=0;o<e.length;o++)i[e[o].identifier]=t[o];return i}class Pa{constructor(e){this.reset(),this.numTouches=e.numTouches;}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1;}touchstart(t,i,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),o.length===this.numTouches&&(this.centroid=function(t){const i=new e.P(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=Da(o,i)));}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const o=Da(i,t);for(const e in this.touches){const t=o[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0);}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class La{constructor(e){this.singleTap=new Pa(e),this.numTaps=e.numTaps,this.reset();}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset();}touchstart(e,t,i){this.singleTap.touchstart(e,t,i);}touchmove(e,t,i){this.singleTap.touchmove(e,t,i);}touchend(e,t,i){const o=this.singleTap.touchend(e,t,i);if(o){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(o)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=o,this.count===this.numTaps)return this.reset(),o}}}class za{constructor(){this._zoomIn=new La({numTouches:1,numTaps:2}),this._zoomOut=new La({numTouches:2,numTaps:1}),this.reset();}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset();}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i);}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i);}touchend(e,t,i){const o=this._zoomIn.touchend(e,t,i),r=this._zoomOut.touchend(e,t,i);return o?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(o)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset();}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}const Ma={0:1,2:2},Oa={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Fa{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1;}blur(){this.reset();}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0;}_correctButton(e,t){return !1}_move(e,t){return {}}mousedown(e,t){if(this._lastPoint)return;const i=y(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i);}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=Ma[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&y(e)===this._eventButton&&(this._moved&&m(),this.reset());}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class Ba extends Fa{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0);}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return {around:t,panDelta:t.sub(e)}}}class ka extends Fa{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?Oa[e.pitchRotateKey]:void 0;}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){this._pitchRotateKey||e.preventDefault();}}class Na extends Fa{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?Oa[e.pitchRotateKey]:void 0;}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){this._pitchRotateKey||e.preventDefault();}}class Ua{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this);}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0);}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(t,i,o){if(this._active&&!(o.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===o.length&&!e.eJ())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer));}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,o)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset();}touchcancel(){this.reset();}_calculateTransform(t,i,o){o.length>0&&(this._active=!0);const r=Da(o,i),s=new e.P(0,0),n=new e.P(0,0);let a=0;for(const e in r){const t=r[e],i=this._touches[e];i&&(s._add(t),n._add(t.sub(i)),a++,r[e]=t);}if(this._touches=r,a<this._minTouches||!n.mag())return;const l=n.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:s.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"));}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset();}isEnabled(){return !!this._enabled}isActive(){return !!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`);}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role");}),500);}}class ja{constructor(){this.reset();}reset(){this._active=!1,this._firstTwoTouches=void 0;}_start(e){}_move(e,t,i){return {}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]));}touchmove(e,t,i){const o=this._firstTwoTouches;if(!o)return;e.preventDefault();const[r,s]=o,n=Ga(i,t,r),a=Ga(i,t,s);if(!n||!a)return;const l=this._aroundCenter?null:n.add(a).div(2);return this._move([n,a],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[o,r]=this._firstTwoTouches,s=Ga(i,t,o),n=Ga(i,t,r);s&&n||(this._active&&m(),this.reset());}touchcancel(){this.reset();}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}function Ga(e,t,i){for(let o=0;o<e.length;o++)if(e[o].identifier===i)return t[o]}function Va(e,t){return Math.log(e/t)/Math.LN2}class qa extends ja{reset(){super.reset(),this._distance=0,this._startDistance=0;}_start(e){this._startDistance=this._distance=e[0].dist(e[1]);}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Va(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Va(this._distance,i),pinchAround:t}}}function Ha(e,t){return 180*e.angleWith(t)/Math.PI}class Za extends ja{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0;}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1]);}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ha(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return !1;const o=Ha(e,i);return Math.abs(o)<t}}function Wa(e){return Math.abs(e.y)>Math.abs(e.x)}class $a extends ja{constructor(e){super(),this._map=e;}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0;}_start(e){this._lastPoints=e,Wa(e[0].sub(e[1]))&&(this._valid=!1);}_move(t,i,o){const r=this._lastPoints;if(!r)return;const s=t[0].sub(r[0]),n=t[1].sub(r[1]);return this._map._cooperativeGestures&&!e.eJ()&&o.touches.length<3||(this._valid=this.gestureBeginsVertically(s,n,o.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(s.y+n.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const o=e.mag()>=2,r=t.mag()>=2;if(!o&&!r)return;if(!o||!r)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const s=e.y>0==t.y>0;return Wa(e)&&Wa(t)&&s}}const Xa={panStep:100,bearingStep:15,pitchStep:10};class Ya{constructor(){const e=Xa;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1;}blur(){this.reset();}reset(){this._active=!1;}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,o=0,r=0,s=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?o=1:(e.preventDefault(),s=-1);break;case 40:e.shiftKey?o=-1:(e.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(i=0,o=0),{cameraAnimation:n=>{const a=n.getZoom();n.easeTo({duration:300,easeId:"keyboardHandler",easing:Ka,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:n.getBearing()+i*this._bearingStep,pitch:n.getPitch()+o*this._pitchStep,offset:[-r*this._panStep,-s*this._panStep],center:n.getCenter()},{originalEvent:e});}}}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0;}enableRotation(){this._rotationDisabled=!1;}}function Ka(e){return e*(2-e)}const Ja=4.000244140625,Qa=1/450;class el{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Qa,e.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this);}setZoomRate(e){this._defaultZoomRate=e;}setWheelZoomRate(e){this._wheelZoomRate=e;}isEnabled(){return !!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return !!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker());}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()));}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.eJ()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer));}let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const o=e.q.now(),r=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,0!==i&&i%Ja==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=i,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(r*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault();}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e);}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=g(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame());}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Ja?this._wheelZoomRate:this._defaultZoomRate;let o=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==o&&(o=1/o);const r=i(),s=Math.pow(2,r),n="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(n*o))),"wheel"===this._type&&(this._startZoom=r,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0;}const o="number"==typeof this._targetZoom?this._targetZoom:i(),r=this._startZoom,s=this._easing;let n,a=!1;if("wheel"===this._type&&r&&s){const t=Math.min((e.q.now()-this._lastWheelEventTime)/200,1),i=s(t);n=e.ai(r,o,i),t<1?this._frameId||(this._frameId=!0):a=!0;}else n=o,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout;}),200));let l=n-i();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.eK;if(this._prevEase){const t=this._prevEase,o=(e.q.now()-t.start)/t.duration,r=t.easing(o+.01)-t.easing(o),s=.27/Math.sqrt(r*r+1e-4)*.01,n=Math.sqrt(.0729-s*s);i=e.eI(s,n,.25,1);}return this._prevEase={start:e.q.now(),duration:t,easing:i},i}blur(){this.reset();}reset(){this._active=!1;}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`);}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role");}),200);}}class tl{constructor(e,t){this._clickZoom=e,this._tapZoom=t;}enable(){this._clickZoom.enable(),this._tapZoom.enable();}disable(){this._clickZoom.disable(),this._tapZoom.disable();}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class il{constructor(){this.reset();}reset(){this._active=!1;}blur(){this.reset();}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e});}}}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class ol{constructor(){this._tap=new La({numTouches:1,numTaps:1}),this.reset();}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset();}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i));}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const o=t[0],r=o.y-this._swipePoint.y;return this._swipePoint=o,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,i);}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp);}touchcancel(){this.reset();}enable(){this._enabled=!0;}disable(){this._enabled=!1,this.reset();}isEnabled(){return this._enabled}isActive(){return this._active}}class rl{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i;}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan");}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan");}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class sl{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i;}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable();}disable(){this._mouseRotate.disable(),this._mousePitch.disable();}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class nl{constructor(e,t,i,o){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0;}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate");}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate");}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable();}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable();}}const al=e=>e.zoom||e.drag||e.pitch||e.rotate;class ll extends e.A{}class cl{constructor(){this.constants=[1,1,.01],this.radius=0;}setup(t,i){const o=e.at([],i,t);this.radius=e.ae(o[2]<0?e.eM([],o,this.constants):[o[0],o[1],0]);}projectRay(t){e.eM(t,t,this.constants),e.au(t,t),e.eN(t,t,this.constants);const i=e.c1([],t,this.radius);if(i[2]>0){const t=e.c1([],[0,0,1],e.bG(i,[0,0,1])),o=e.c1([],e.au([],[i[0],i[1],0]),this.radius),r=e.d5([],i,e.c1([],e.at([],e.d5([],o,t),i),2));i[0]=r[0],i[1]=r[1];}return i}}function hl(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class dl{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ba(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.aV(["handleEvent","handleWindowEvent"],this);const o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,t,i]of this._listeners){const o=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(t,o,i);}}destroy(){for(const[e,t,i]of this._listeners){const o=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,o,i);}}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new Ca(t,e));const o=t.boxZoom=new Aa(t,e);this._add("boxZoom",o);const r=new za,s=new il;t.doubleClickZoom=new tl(s,r),this._add("tapZoom",r),this._add("clickZoom",s);const n=new ol;this._add("tapDragZoom",n);const a=t.touchPitch=new $a(t);this._add("touchPitch",a);const l=new ka(e),c=new Na(e);t.dragRotate=new sl(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const h=new Ba(e),d=new Ua(t,e);t.dragPan=new rl(i,h,d),this._add("mousePan",h),this._add("touchPan",d,["touchZoom","touchRotate"]);const u=new Za,_=new qa;t.touchZoomRotate=new nl(i,_,u,n),this._add("touchRotate",u,["touchPan","touchZoom"]),this._add("touchZoom",_,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ra(t));const p=t.scrollZoom=new el(t,this);this._add("scrollZoom",p,["mousePan"]);const f=t.keyboard=new Ya;this._add("keyboard",f);for(const i of ["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[i]&&t[i].enable(e[i]);}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t;}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0;}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return !0;return !1}isZooming(){return !!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return !!this._eventsInProgress.rotate}isMoving(){return !!al(this._eventsInProgress)||this.isZooming()}_isDragging(){return !!this._eventsInProgress.drag}_blockedByActive(e,t,i){for(const o in e)if(o!==i&&(!t||t.indexOf(o)<0))return !0;return !1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`);}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,o=i?void 0:e,r={needsRenderFrame:!1},s={},n={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?v(this._el,a):i?void 0:g(this._el,e);for(const{handlerName:i,handler:c,allowed:h}of this._handlers){if(!c.isEnabled())continue;let d;this._blockedByActive(n,h,i)?c.reset():c[t||e.type]&&(d=c[t||e.type](e,l,a),this.mergeHandlerResult(r,s,d,i,o),d&&d.needsRenderFrame&&this._triggerRenderFrame()),(d||c.isActive())&&(n[i]=c);}const c={};for(const e in this._previousActiveHandlers)n[e]||(c[e]=o);this._previousActiveHandlers=n,(Object.keys(c).length||hl(r))&&(this._changes.push([r,s,c]),this._triggerRenderFrame()),(Object.keys(n).length||hl(r))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=r;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map));}mergeHandlerResult(t,i,o,r,s){if(!o)return;e.h(t,o);const n={handlerName:r,originalEvent:o.originalEvent||s};void 0!==o.zoomDelta&&(i.zoom=n),void 0!==o.panDelta&&(i.drag=n),void 0!==o.pitchDelta&&(i.pitch=n),void 0!==o.bearingDelta&&(i.rotate=n);}_applyChanges(){const t={},i={},o={};for(const[r,s,n]of this._changes)r.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(r.panDelta)),r.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(t.around=r.around),void 0!==r.aroundCoord&&(t.aroundCoord=r.aroundCoord),void 0!==r.pinchAround&&(t.pinchAround=r.pinchAround),r.noInertia&&(t.noInertia=r.noInertia),e.h(i,s),e.h(o,n);this._updateMapTransform(t,i,o),this._changes=[];}_updateMapTransform(t,i,o){const r=this._map,s=r.transform,n=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!hl(t)){const e=s.zoom;s.cameraElevationReference="sea",null!=this._originalZoom&&s._orthographicProjectionAtLowPitch&&"globe"!==s.projection.name&&0===s.pitch?(s.cameraElevationReference="ground",s.zoom=this._originalZoom):(s.recenterOnTerrain(),s.cameraElevationReference="ground"),e!==s.zoom&&this._map._update(!0);}if(s._isCameraConstrained&&r._stop(!0),!hl(t))return void this._fireEvents(i,o,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:h,around:d,aroundCoord:u,pinchAround:_}=t;s._isCameraConstrained&&(l>0&&(l=0),s._isCameraConstrained=!1),void 0!==_&&(d=_),(l||(e=>i[e]&&!this._eventsInProgress[e])("drag"))&&d&&(this._dragOrigin=n(s.pointCoordinate3D(d)),this._originalZoom=s.zoom,this._trackingEllipsoid.setup(s._camera.position,this._dragOrigin)),s.cameraElevationReference="sea",r._stop(!0),d=d||r.transform.centerPoint,c&&(s.bearing+=c),h&&(s.pitch+=h),s._updateCameraState();const p=[0,0,0];if(a)if("mercator"===s.projection.name){const e=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(d).dir),t=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(d.sub(a)).dir);p[0]=t[0]-e[0],p[1]=t[1]-e[1];}else {const t=s.pointCoordinate(d);if("globe"===s.projection.name){a=a.rotate(-s.angle);const i=s._pixelsPerMercatorPixel/s.worldSize;p[0]=-a.x*e.eL(e.aY(t.y))*i,p[1]=-a.y*e.eL(s.center.lat)*i;}else {const e=s.pointCoordinate(d.sub(a));t&&e&&(p[0]=e.x-t.x,p[1]=e.y-t.y);}}const f=s.zoom,m=[0,0,0];if(l){const t=n(u||s.pointCoordinate3D(d)),i={dir:e.au([],e.at([],t,s._camera.position))};if(i.dir[2]<0){const o=s.zoomDeltaToMovement(t,l);e.c1(m,i.dir,o);}}const g=e.d5(p,p,m);s._translateCameraConstrained(g),l&&Math.abs(s.zoom-f)>1e-4&&s.recenterOnTerrain(),s.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,o,!0);}_fireEvents(t,i,o){const r=al(this._eventsInProgress),s=al(t),n={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(n[`${e}start`]=i),this._eventsInProgress[e]=t[e];}!r&&s&&this._fireEvent("movestart",s.originalEvent);for(const e in n)this._fireEvent(e,n[e]);s&&this._fireEvent("move",s.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i);}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:o}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||o,a[`${e}end`]=l);}for(const e in a)this._fireEvent(e,a[e]);const c=al(this._eventsInProgress);if(o&&(r||s)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.A("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1;}}_fireEvent(t,i){this._map.fire(new e.A(t,i?{originalEvent:i}:{}));}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new ll("renderFrame",{timeStamp:e})),this._applyChanges();}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame());}}const ul="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class _l extends e.E{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,e.aV(["_renderFrameCallback"],this);}getCenter(){return new e.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,o){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.h({offset:t},i),o)}panTo(t,i,o){return this.easeTo(e.h({center:t},i),o)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,o){return this.easeTo(e.h({zoom:t},i),o)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,o){return this.easeTo(e.h({bearing:t},i),o)}resetNorth(t,i){return this.rotateTo(0,e.h({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.h({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){t=e.aG.convert(t);const o=i&&i.bearing||0,r=i&&i.pitch||0,s=t.getNorthWest(),n=t.getSouthEast();return this._cameraForBounds(this.transform,s,n,o,r,i)}_extendPadding(t){const i={top:0,right:0,bottom:0,left:0};return null==t?e.h({},i,this.transform.padding):"number"==typeof t?{top:t,bottom:t,right:t,left:t}:e.h({},i,t)}_extendCameraOptions(t){return (t=e.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(e,t){const i=t.max[0]-t.min[0],o=t.max[1]-t.min[1];return i/o>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):o/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,i,o,r,s,n){const a=t.clone(),l=this._extendCameraOptions(n);a.bearing=r,a.pitch=s;const c=e.ci.convert(i),h=e.ci.convert(o),d=.5*(c.lat+h.lat),u=.5*(c.lng+h.lng),_=e.eO(d,u),p=e.au([],_),f=e.au([],e.bF([],p,[0,1,0])),m=e.bF([],f,p),g=[f[0],f[1],f[2],0,m[0],m[1],m[2],0,p[0],p[1],p[2],0,0,0,0,1],v=[_,e.eO(c.lat,c.lng),e.eO(h.lat,c.lng),e.eO(h.lat,h.lng),e.eO(c.lat,h.lng),e.eO(d,c.lng),e.eO(d,h.lng),e.eO(c.lat,u),e.eO(h.lat,u)];let y=e.d6.fromPoints(v.map((t=>[e.bG(f,t),e.bG(m,t),e.bG(p,t)])));const x=e.ad([],y.center,g);0===e.eP(x)&&e.eQ(x,0,0,1),e.au(x,x),e.c1(x,x,e.aB),a.center=e.eR(x);const b=a.getWorldToCameraMatrix(),w=e.bi(new Float64Array(16),b);y=e.d6.applyTransform(y,e.az([],b,g));const T=this._extendAABB(y,a,l,r);if(!T)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");y=T,e.ad(x,x,b);const E=.5*(y.max[2]-y.min[2]),S=this._minimumAABBFrustumDistance(a,y),I=e.c1([],[0,0,1],E),C=e.d5(I,x,I),R=S+(0===a.pitch?0:e.bD(x,C)),A=a.globeCenterInViewSpace,D=e.at([],x,[A[0],A[1],A[2]]);e.au(D,D),e.c1(D,D,R);const P=e.d5([],x,D);e.ad(P,P,w);const L=e.eB/e.aB,z=e.ae(P),M=e.cb(Math.max(z*L-e.eB,Number.EPSILON),0),O=Math.min(a.zoomFromMercatorZAdjusted(M),l.maxZoom);return O>.5*(e.cX+e.cI)?(a.setProjection({name:"mercator"}),a.zoom=O,this._cameraForBounds(a,i,o,r,s,n)):{center:a.center,zoom:O,bearing:r,pitch:s}}_extendAABB(t,i,o,r){const s=.5*((o.padding.left||0)+(o.padding.right||0)),n=.5*((o.padding.top||0)+(o.padding.bottom||0)),a=n,l=s,c=s,h=n,d=i.width-(l+c),u=i.height-(a+h),_=e.at([],t.max,t.min),p=Math.min(d/_[0],u/_[1]),f=Math.min(i.scaleZoom(i.scale*p),o.maxZoom);if(isNaN(f))return null;const m=i.scale/i.zoomScale(f),g=new e.d6([t.min[0]-l*m,t.min[1]-h*m,t.min[2]],[t.max[0]+c*m,t.max[1]+a*m,t.max[2]]),v=("number"==typeof o.offset.x&&"number"==typeof o.offset.y?new e.P(o.offset.x,o.offset.y):e.P.convert(o.offset)).rotate(-e.al(r));return g.center[0]-=v.x*m,g.center[1]+=v.y*m,g}queryTerrainElevation(t,i){const o=this.transform.elevation;return o?(i=e.h({},{exaggerated:!0},i),o.getAtPoint(e.ac.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,o,r,s,n){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,i,o,r,s,n);const a=t.clone(),l=this._extendCameraOptions(n);a.bearing=r,a.pitch=s;const c=e.ci.convert(i),h=e.ci.convert(o),d=new e.ci(c.lng,h.lat),u=new e.ci(h.lng,c.lat),_=a.project(c),p=a.project(h),f=this.queryTerrainElevation(c),m=this.queryTerrainElevation(h),g=this.queryTerrainElevation(d),v=this.queryTerrainElevation(u),y=[[_.x,_.y,Math.min(f||0,m||0,g||0,v||0)],[p.x,p.y,Math.max(f||0,m||0,g||0,v||0)]];let x=e.d6.fromPoints(y);const b=a.getWorldToCameraMatrix(),w=e.bi(new Float64Array(16),b);x=e.d6.applyTransform(x,b);const T=this._extendAABB(x,a,l,r);if(!T)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");x=T;const E=.5*e.at([],x.max,x.min)[2],S=this._minimumAABBFrustumDistance(a,x),I=[0,0,1,0];e.aA(I,I,b),e.eS(I,I);const C=e.c1([],I,S+E),R=e.d5([],x.center,C);e.ad(x.center,x.center,w),e.ad(R,R,w);const A=a.unproject(new e.P(x.center[0],x.center[1])),D=e.eT(a.projection,A),P=Math.pow(2,D),L=Math.min(a._zoomFromMercatorZ(R[2]*a.pixelsPerMeter*P/a.worldSize),l.maxZoom);return a.mercatorFromTransition&&L<.5*(e.cX+e.cI)?(a.setProjection({name:"globe"}),a.zoom=L,this._cameraForBounds(a,i,o,r,s,n)):{center:A,zoom:L,bearing:r,pitch:s}}fitBounds(e,t,i){const o=this.cameraForBounds(e,t);return this._fitInternal(o,t,i)}fitScreenCoordinates(t,i,o,r,s){const n=e.P.convert(t),a=e.P.convert(i),l=new e.P(Math.min(n.x,a.x),Math.min(n.y,a.y)),c=new e.P(Math.max(n.x,a.x),Math.max(n.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(n,a))return this;const h=this.transform.pointLocation3D(l),d=this.transform.pointLocation3D(c),u=this.transform.pointLocation3D(new e.P(l.x,c.y)),_=this.transform.pointLocation3D(new e.P(c.x,l.y)),p=[Math.min(h.lng,d.lng,u.lng,_.lng),Math.min(h.lat,d.lat,u.lat,_.lat)],f=[Math.max(h.lng,d.lng,u.lng,_.lng),Math.max(h.lat,d.lat,u.lat,_.lat)],m=r&&r.pitch?r.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,p,f,o,m,r);return this._fitInternal(g,r,s)}_fitInternal(t,i,o){return t?(i=e.h(t,i)).linear?this.easeTo(i,o):this.flyTo(i,o):this}jumpTo(t,i){this.stop();const o=t.preloadOnly?this.transform.clone():this.transform;let r=!1,s=!1,n=!1;"zoom"in t&&o.zoom!==+t.zoom&&(r=!0,o.zoom=+t.zoom),void 0!==t.center&&(o.center=e.ci.convert(t.center)),"bearing"in t&&o.bearing!==+t.bearing&&(s=!0,o.bearing=+t.bearing),"pitch"in t&&o.pitch!==+t.pitch&&(n=!0,o.pitch=+t.pitch);const a="number"==typeof t.padding?this._extendPadding(t.padding):t.padding;if(null!=t.padding&&!o.isPaddingEqual(a))if(!1===t.retainPadding){const e=o.clone();e.padding=a,o.setLocationAtPoint(o.center,e.centerPoint);}else o.padding=a;return t.preloadOnly?(this._preloadTiles(o),this):(this.fire(new e.A("movestart",i)).fire(new e.A("move",i)),r&&this.fire(new e.A("zoomstart",i)).fire(new e.A("zoom",i)).fire(new e.A("zoomend",i)),s&&this.fire(new e.A("rotatestart",i)).fire(new e.A("rotate",i)).fire(new e.A("rotateend",i)),n&&this.fire(new e.A("pitchstart",i)).fire(new e.A("pitch",i)).fire(new e.A("pitchend",i)),this.fire(new e.A("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(ul),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const o=this.transform;if(!o.projection.supportsFreeCamera)return e.w(ul),this;this.stop();const r=o.zoom,s=o.pitch,n=o.bearing;o.setFreeCameraOptions(t);const a=r!==o.zoom,l=s!==o.pitch,c=n!==o.bearing;return this.fire(new e.A("movestart",i)).fire(new e.A("move",i)),a&&this.fire(new e.A("zoomstart",i)).fire(new e.A("zoom",i)).fire(new e.A("zoomend",i)),c&&this.fire(new e.A("rotatestart",i)).fire(new e.A("rotate",i)).fire(new e.A("rotateend",i)),l&&this.fire(new e.A("pitchstart",i)).fire(new e.A("pitch",i)).fire(new e.A("pitchend",i)),this.fire(new e.A("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.h({offset:[0,0],duration:500,easing:e.eK},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const o=this.transform,r=this.getZoom(),s=this.getBearing(),n=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:r,c="bearing"in t?this._normalizeBearing(t.bearing,s):s,h="pitch"in t?+t.pitch:n,d=this._extendPadding(t.padding),u=e.P.convert(t.offset);let _,p,f;if("globe"===o.projection.name){const i=e.ac.fromLngLat(o.center),r=u.rotate(-o.angle);i.x+=r.x/o.worldSize,i.y+=r.y/o.worldSize;const s=i.toLngLat(),n=e.ci.convert(t.center||s);this._normalizeCenter(n),_=o.centerPoint.add(r),p=new e.P(i.x,i.y).mult(o.worldSize),f=new e.P(e.aD(n.lng),e.aH(n.lat)).mult(o.worldSize).sub(p);}else {_=o.centerPoint.add(u);const i=o.pointLocation(_),r=e.ci.convert(t.center||i);this._normalizeCenter(r),p=o.project(i),f=o.project(r).sub(p);}const m=o.zoomScale(l-r);let g,v;t.around&&(g=e.ci.convert(t.around),v=o.locationPoint(g));const y=this._zooming||l!==r,x=this._rotating||s!==c,b=this._pitching||h!==n,w=!o.isPaddingEqual(d),T=!1===t.retainPadding?o.clone():o,E=o=>E=>{if(y&&(o.zoom=e.ai(r,l,E)),x&&(o.bearing=e.ai(s,c,E)),b&&(o.pitch=e.ai(n,h,E)),w&&(T.interpolatePadding(a,d,E),_=T.centerPoint.add(u)),g)o.setLocationAtPoint(g,v);else {const e=o.zoomScale(o.zoom-r),t=l>r?Math.min(2,m):Math.max(.5,m),i=Math.pow(t,1-E),s=o.unproject(p.add(f.mult(E*i)).mult(e));o.setLocationAtPoint(o.renderWorldCopies?s.wrap():s,_);}return t.preloadOnly||this._fireMoveEvents(i),o};if(t.preloadOnly){const e=this._emulate(E,t.duration,o);return this._preloadTiles(e),this}const S={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=y,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,S),this._ease(E(o),(e=>{"sea"===o.cameraElevationReference&&o.recenterOnTerrain(),this._afterEase(i,e);}),t),this}_prepareEase(t,i,o={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),i||o.moving||this.fire(new e.A("movestart",t)),this._zooming&&!o.zooming&&this.fire(new e.A("zoomstart",t)),this._rotating&&!o.rotating&&this.fire(new e.A("rotatestart",t)),this._pitching&&!o.pitching&&this.fire(new e.A("pitchstart",t));}_fireMoveEvents(t){this.fire(new e.A("move",t)),this._zooming&&this.fire(new e.A("zoom",t)),this._rotating&&this.fire(new e.A("rotate",t)),this._pitching&&this.fire(new e.A("pitch",t));}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const o=this._zooming,r=this._rotating,s=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,o&&this.fire(new e.A("zoomend",t)),r&&this.fire(new e.A("rotateend",t)),s&&this.fire(new e.A("pitchend",t)),this.fire(new e.A("moveend",t));}flyTo(t,i){if(this._prefersReducedMotion(t)){const o=e.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(o,i)}this.stop(),t=e.h({offset:[0,0],speed:1.2,curve:1.42,easing:e.eK},t);const o=this.transform,r=this.getZoom(),s=this.getBearing(),n=this.getPitch(),a=this.getPadding(),l="zoom"in t?e.ay(+t.zoom,o.minZoom,o.maxZoom):r,c="bearing"in t?this._normalizeBearing(t.bearing,s):s,h="pitch"in t?+t.pitch:n,d=this._extendPadding(t.padding),u=o.zoomScale(l-r),_=e.P.convert(t.offset);let p=o.centerPoint.add(_);const f=o.pointLocation(p),m=e.ci.convert(t.center||f);this._normalizeCenter(m);const g=o.project(f),v=o.project(m).sub(g);let y=t.curve;const x=Math.max(o.width,o.height),b=x/u,w=v.mag();if("minZoom"in t){const i=e.ay(Math.min(t.minZoom,r,l),o.minZoom,o.maxZoom),s=x/o.zoomScale(i-r);y=Math.sqrt(s/w*2);}const T=y*y;function E(e){const t=(b*b-x*x+(e?-1:1)*T*T*w*w)/(2*(e?b:x)*T*w);return Math.log(Math.sqrt(t*t+1)-t)}function S(e){return (Math.exp(e)-Math.exp(-e))/2}function I(e){return (Math.exp(e)+Math.exp(-e))/2}const C=E(0);let R=function(e){return I(C)/I(C+y*e)},A=function(e){return x*((I(C)*(S(t=C+y*e)/I(t))-S(C))/T)/w;var t;},D=(E(1)-C)/y;if(Math.abs(w)<1e-6||!isFinite(D)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,i);const e=b<x?-1:1;D=Math.abs(Math.log(b/x))/y,A=function(){return 0},R=function(t){return Math.exp(e*y*t)};}t.duration="duration"in t?+t.duration:1e3*D/("screenSpeed"in t?+t.screenSpeed/y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const P=s!==c,L=h!==n,z=!o.isPaddingEqual(d),M=!1===t.retainPadding?o.clone():o,O=o=>u=>{const f=u*D,y=1/R(f);o.zoom=1===u?l:r+o.scaleZoom(y),P&&(o.bearing=e.ai(s,c,u)),L&&(o.pitch=e.ai(n,h,u)),z&&(M.interpolatePadding(a,d,u),p=M.centerPoint.add(_));const x=1===u?m:o.unproject(g.add(v.mult(A(f))).mult(y));return o.setLocationAtPoint(o.renderWorldCopies?x.wrap():x,p),o._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),o};if(t.preloadOnly){const e=this._emulate(O,t.duration,o);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=P,this._pitching=L,this._padding=z,this._prepareEase(i,!1),this._ease(O(o),(()=>this._afterEase(i)),t),this}isEasing(){return !!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t);}if(!e){const e=this.handlers;e&&e.stop(!1);}return this}_ease(t,i,o){!1===o.animate||0===o.duration?(t(1),i()):(this._easeStart=e.q.now(),this._easeOptions=o,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback));}_renderFrameCallback(){const t=Math.min((e.q.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop();}_normalizeBearing(t,i){t=e.bQ(t,-180,180);const o=Math.abs(t-i);return Math.abs(t-360-i)<o&&(t-=360),Math.abs(t+360-i)<o&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0;}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,i){const o=Math.ceil(15*t/1e3),r=[],s=e(i.clone());for(let e=0;e<=o;e++){const t=s(e/o);r.push(t.clone());}return r}_preloadTiles(e,t){}}class pl{constructor(t={}){this.options=t,e.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this);}getDefaultPosition(){return "bottom-right"}onAdd(e){const t=this.options&&this.options.compact,i=e._getUIString("AttributionControl.ToggleAttribution");this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=l("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",i);const o=l("span","mapboxgl-ctrl-icon",this._compactButton);return o.setAttribute("aria-hidden","true"),o.setAttribute("title",i),this._innerContainer=l("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0;}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"));}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.e.ACCESS_TOKEN}];if(t){const o=i.reduce(((e,t,o)=>(t.value&&(e+=`${t.key}=${t.value}${o<i.length-1?"&":""}`),e)),"?");t.href=`${e.e.FEEDBACK_URL}/${o}#${fa(this._map,!0)}`,t.rel="noopener nofollow";}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink());}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id;}const t=this._map.style._mergedSourceCaches;for(const i in t){const o=t[i];if(o.used){const t=o.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution);}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let o=i+1;o<e.length;o++)if(e[o].indexOf(t)>=0)return !1;return !0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null);}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show");}}class fl{constructor(){e.aV(["_updateLogo","_updateCompact"],this);}onAdd(e){this._map=e,this._container=l("div","mapboxgl-ctrl");const t=l("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact);}getDefaultPosition(){return "bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none");}_logoRequired(){if(!this._map.style)return !0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return !0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return !1}return !0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact");}}}class ml{constructor(){e.aV(["_onIndoorUpdate"],this);}onAdd(e){return this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(e=>this._onIndoorUpdate({selectedFloorId:e.selectedFloorId,floors:e.floors}))),this._container}_createButton(e,t){const i=l("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){this._map&&(e.setAttribute("aria-label",t),e.innerHTML=`<strong>${t}</strong>`,e.firstElementChild&&e.firstElementChild.setAttribute("title",t));}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null);}getDefaultPosition(){return "right"}_onIndoorUpdate(e){if(!e||!e.floors)return void(this._container.style.display="none");const t=this._model;this._model=e,this._container.style.display="inline-block";const i=e.floors.sort(((e,t)=>e.levelOrder-t.levelOrder));t?(Array.from(this._container.children).forEach((e=>e.remove())),this.addCurrentFloors(i)):this.addCurrentFloors(i);}addCurrentFloors(e){for(const t of e){const e=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(t.id),Array.from(this._container.children).forEach((e=>{e.classList.remove("mapboxgl-ctrl-level-button-selected");})),e.classList.add("mapboxgl-ctrl-level-button-selected");}));this._setButtonTitle(e,t.shortName),this._model&&t.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(t.id),e.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(e);}}}class gl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1;}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const t of i)if(t.id===e)return void(t.cancelled=!0)}run(e=0){const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1;}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[];}}class vl{constructor(e){this.jumpTo(e);}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.dx((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e;}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i;}}const yl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class xl extends e.A{constructor(e,t,i,o){const{point:r,lngLat:s,originalEvent:n,target:a}=e;super(e.type,{point:r,lngLat:s,originalEvent:n,target:a}),this.preventDefault=()=>{e.preventDefault();},this.id=t,this.interaction=i,this.feature=o;}}class bl{constructor(e){this.map=e,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map;}add(t,i){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const o=i.filter;let r=i.type;o&&this.filters.set(t,e.b3(o)),"mouseover"===r&&(r="mouseenter"),"mouseout"===r&&(r="mouseleave");const s=this.interactionsByType.get(r)||new Map;"mouseenter"===r||"mouseleave"===r?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,i)):0===s.size&&this.map.on(r,this.handleType),0===s.size&&this.interactionsByType.set(r,s),s.set(t,i),this.typeById.set(t,r);}get(e){const t=this.typeById.get(e);if(!t)return;const i=this.interactionsByType.get(t);return i?i.get(e):void 0}remove(e){const t=this.typeById.get(e);if(!t)return;this.typeById.delete(e),this.filters.delete(e);const i=this.interactionsByType.get(t);i&&(i.delete(e),"mouseenter"===t||"mouseleave"===t?(this.delegatedInteractions.delete(e),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===i.size&&this.map.off(t,this.handleType));}queryTargets(e,t){const i=[];for(const[e,o]of t)o.target&&i.push({targetId:e,target:o.target,filter:this.filters.get(e)});return this.map.style.queryRenderedTargets(e,i,this.map.transform)}handleMove(e){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const t=this.queryTargets(e.point,Array.from(this.delegatedInteractions).reverse());t.length&&(e.type="mouseenter",this.handleType(e,t));const i=new Map;for(const[e,{feature:t}]of this.prevHoveredFeatures)this.hoveredFeatures.has(e)||i.set(t.id,t);i.size&&(e.type="mouseleave",this.handleType(e,Array.from(i.values())));}handleOut(e){const t=Array.from(this.hoveredFeatures.values()).map((({feature:e})=>e));t.length&&(e.type="mouseleave",this.handleType(e,t)),this.hoveredFeatures.clear();}handleType(t,i){const o="mouseenter"===t.type;if(o&&!this.interactionsByType.has(t.type))return void e.w("mouseenter interaction required for mouseleave to work.");const r=Array.from(this.interactionsByType.get(t.type)).reverse(),s=!!i;i=i||this.queryTargets(t.point,r);let n=!1;const a=new Set;for(const l of i){for(const[i,c]of r){if(!c.target)continue;const r=l.variants?l.variants[i]:null;if(r){for(const h of r){if(lt(h,l,a,i))continue;const r=new e.dr(l,h),d=at(h,l,i);s&&(r.state=this.map.getFeatureState(r));const u=o?this.prevHoveredFeatures.get(d):null,_=new xl(t,i,c,r),p=u?u.stop:c.handler(_);if(o&&this.hoveredFeatures.set(d,{feature:l,stop:p}),!1!==p){n=!0;break}}if(n)break}}if(n)break}if(!n)for(const[e,i]of r){const{handler:o,target:r}=i;if(!r&&!1!==o(new xl(t,e,i,null)))break}}}function wl(t,i){if(Array.isArray(t)&&Array.isArray(i)){const e=new Set(t),o=new Set(i);return e.size===o.size&&t.every((e=>o.has(e)))}return e.bv(t,i)}const Tl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},El={showCompass:!0,showZoom:!0,visualizePitch:!1};class Sl{constructor(t,i,o=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new ka({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,o&&(this.mousePitch=new Na({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset);}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),_();}move(e,t){const i=this.map,o=this.mouseRotate.mousemoveWindow(e,t),r=o&&o.bearingDelta;if(r&&i.setBearing(i.getBearing()+r),this.mousePitch){const o=this.mousePitch.mousemoveWindow(e,t),r=o&&o.pitchDelta;r&&i.setPitch(i.getPitch()+r);}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp();}offTemp(){p(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup);}mousedown(t){this.down(e.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),g(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup);}mousemove(e){this.move(e,g(this.element,e));}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp();}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=v(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos));}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=v(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos));}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset();}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp();}}function Il(t,i,o){if(t=new e.ci(t.lng,t.lat),i){const r=new e.ci(t.lng-360,t.lat),s=new e.ci(t.lng+360,t.lat),n=360*Math.ceil(Math.abs(t.lng-o.center.lng)/360),a=o.locationPoint3D(t).distSqr(i),l=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint3D(r).distSqr(i)<a&&(l||Math.abs(r.lng-o.center.lng)<n)?t=r:o.locationPoint3D(s).distSqr(i)<a&&(l||Math.abs(s.lng-o.center.lng)<n)&&(t=s);}for(;Math.abs(t.lng-o.center.lng)>180;){const e=o.locationPoint3D(t);if(e.x>=0&&e.y>=0&&e.x<=o.width&&e.y<=o.height)break;t.lng>o.center.lng?t.lng-=360:t.lng+=360;}return t}const Cl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Rl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Al extends e.E{constructor(t,i){super(),(t instanceof HTMLElement||i)&&(t=e.h({element:t},i)),e.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:o="center",color:r="#3FB1CE",scale:s=1,draggable:n=!1,clickTolerance:a=0,rotation:l=Rl.rotation,rotationAlignment:c=Rl.rotationAlignment,pitchAlignment:h=Rl.pitchAlignment,occludedOpacity:d=Rl.occludedOpacity,altitude:u=Rl.altitude}=t||{};this._anchor=o,this._color=r,this._scale=s,this._draggable=n,this._clickTolerance=a,this._rotation=l,this._rotationAlignment=c,this._pitchAlignment=h,this._occludedOpacity=d,this._altitude=u,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=e.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault();})),this._element.addEventListener("mousedown",(e=>{e.preventDefault();}));const _=this._element.classList;for(const e in Cl)_.remove(`mapboxgl-marker-anchor-${e}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);const p=t&&t.className?t.className.trim().split(/\s+/):[];_.add(...p),this._popup=null;}_createDefaultMarker(){const e=l("div"),t=c("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},e);if(0===this._altitude){const e=c("radialGradient",{id:"shadowGradient"},c("defs",{},t));c("stop",{offset:"10%","stop-opacity":.4},e),c("stop",{offset:"100%","stop-opacity":.05},e),c("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},t);}return c("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},t),c("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},t),c("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},t),e}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.ci.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(e){return e===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==e||0!==this._altitude&&0===e)&&(this._element=this._createDefaultMarker()),this._altitude=e||Rl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,o=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[o,-1*(t-i+o)],"bottom-right":[-o,-1*(t-i+o)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset;}this._popup=e,e._marker=this,e._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false");}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup();}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup();}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return !1;const i=e.unproject(t,this._altitude),o=e.getFreeCameraOptions();if(!o.position)return !1;const r=o.position.toLngLat();return r.distanceTo(i)<.9*r.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const o=t.unproject(i,this._altitude);let r;t._showingGlobe()&&e.eW(t.transform,this._lngLat)?r=0:(r=1-t._queryFogOpacity(o),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity=`${r}`,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null;}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null);}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${e.x}px,${e.y}px)\n            ${Cl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${t.x}px,${t.y}px)\n        `;}_calculateXYTransform(){const t=this._pos,i=this._map,o=this.getPitchAlignment();if(!i||!t||"map"!==o)return "";if(!i._showingGlobe()){const e=i.getPitch();return e?`rotateX(${e}deg)`:""}const r=e.cU(e.eX(i.transform,this._lngLat)),s=t.sub(e.eY(i.transform)),n=Math.abs(s.x)+Math.abs(s.y);if(0===n)return "";const a=r/n;return `rotateX(${-s.y*a}deg) rotateY(${s.x*a}deg)`}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return "";let o=0;const r=this.getRotationAlignment();if("map"===r)if(i._showingGlobe()){const t=i.project(new e.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),r=i.project(new e.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(t);o=e.cU(Math.atan2(r.y,r.x))-90;}else o=-i.getBearing();else if("horizon"===r){const r=e.af(4,6,i.getZoom()),s=e.eY(i.transform);s.y+=r*i.transform.height;const n=t.sub(s),a=e.cU(Math.atan2(n.y,n.x));o=(a>90?a-270:a+90)*(1-r);}return o+=this._rotation,o?`rotateZ(${o}deg)`:""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=Il(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat,this._altitude),!0===e?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM());})):this._pos=this._pos.round(),t._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)));})));}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const i=this._map;if(!i)return;const o=this._pointerdownPos,r=this._positionDelta;if(o&&r){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;if(t.point.dist(o)<e)return;this._isDragging=!0;}this._pos=t.point.sub(r),this._lngLat=i.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.A("dragstart"))),this.fire(new e.A("drag"));}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.A("dragend")),this._state="inactive";}_addDragHandler(e){const t=this._map,i=this._pos;t&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp));}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||Rl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||Rl.rotationAlignment,this._update(),this}getRotationAlignment(){return "auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||Rl.pitchAlignment,this._update(),this}getPitchAlignment(){return "auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||Rl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Dl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Pl={maxWidth:100,unit:"metric"},Ll={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},zl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ml=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ol(t=new e.P(0,0),i="bottom"){if("number"==typeof t){const o=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case "top":return new e.P(0,t);case "top-left":return new e.P(o,o);case "top-right":return new e.P(-o,o);case "bottom":return new e.P(0,-t);case "bottom-left":return new e.P(o,-o);case "bottom-right":return new e.P(-o,-o);case "left":return new e.P(t,0);case "right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[i]||[0,0])}const Fl={version:t,supported:a.supported,setRTLTextPlugin:e.f0,getRTLTextPluginStatus:e.e$,Map:class extends _l{constructor(t){o.mark(i.create);const r=t;if(null!=(t=e.h({},Tl,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.eU(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Qi(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies,null,null),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new gl,this._domRenderTaskQueue=new gl,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.a$(),this._locale=e.h({},yl,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._tessellationStep=t.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=t.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new vl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=t.scaleFactor,this._requestManager=new T(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?Object.assign({},t.contextCreateOptions):{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error(`Container '${t.container.toString()}' not found.`);this._container=e;}else {if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container;}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),this._spriteFormat=t.spriteFormat,e.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Yn),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update();})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor);})),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new dl(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.e.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),this.indoor=new mo(this),t.hash&&(this._hash=new pa("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==r.center&&null==r.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const i=t.bounds;i&&(this.resize(),this.fitBounds(i,e.h({},t.fitBoundsOptions,{duration:0})));}this.resize(),t.attributionControl&&this.addControl(new pl({customAttribution:t.customAttribution})),this._logoControl=new fl,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent();})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.A(`${t.dataType}data`,t));})),this.on("dataloading",(t=>{this.fire(new e.A(`${t.dataType}dataloading`,t));})),this._interactions=new bl(this);}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=t.onAdd(this);this._controls.push(t);const r=this._controlPositions[i];return -1!==i.indexOf("bottom")?r.insertBefore(o,r.firstChild):r.appendChild(o),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.A("movestart",t)).fire(new e.A("move",t)),this.fire(new e.A("resize",t)),i&&this.fire(new e.A("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.aG.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.A("zoomstart")).fire(new e.A("zoom")).fire(new e.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.A("pitchstart")).fire(new e.A("pitch")).fire(new e.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(e){return this._scaleFactor=e,this.painter.scaleFactor=e,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((e=>"symbol"===e.type)),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return "auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return "globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,i=t.projection.name;let o;"globe"===i&&t.zoom>=e.cI?(t.setMercatorFromTransition(),o=!0):"mercator"===i&&t.zoom<e.cI&&(t.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0));}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let i;return i="globe"===t.name&&this.transform.zoom>=e.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t,i){return this.transform.locationPoint3D(e.ci.convert(t),i)}unproject(t,i){return this.transform.pointLocation3D(e.P.convert(t),i)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){const o=e=>{let i=[];if(Array.isArray(t)){const o=t.filter((e=>this.getLayer(e)));i=o.length?this.queryRenderedFeatures(e,{layers:o}):[];}else i=this.queryRenderedFeatures(e,{target:t});return i};if("mouseenter"===e||"mouseover"===e){let r=!1;const s=t=>{const s=o(t.point);s.length?r||(r=!0,i.call(this,new Ea(e,this,t.originalEvent,{features:s}))):r=!1;};return {listener:i,targets:t,delegates:{mousemove:s,mouseout:()=>{r=!1;}}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const s=t=>{o(t.point).length?r=!0:r&&(r=!1,i.call(this,new Ea(e,this,t.originalEvent)));},n=t=>{r&&(r=!1,i.call(this,new Ea(e,this,t.originalEvent)));};return {listener:i,targets:t,delegates:{mousemove:s,mouseout:n}}}{const r=e=>{const t=o(e.point);t.length&&(e.features=t,i.call(this,e),delete e.features);};return {listener:i,targets:t,delegates:{[e]:r}}}}on(e,t,i){if("function"==typeof t||void 0===i)return super.on(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const o=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(o);for(const e in o.delegates)this.on(e,o.delegates[e]);return this}once(e,t,i){if("function"==typeof t||void 0===i)return super.once(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const o=this._createDelegatedListener(e,t,i);for(const e in o.delegates)this.once(e,o.delegates[e]);return this}off(e,t,i){if("function"==typeof t||void 0===i)return super.off(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const o=this._delegatedListeners?this._delegatedListeners[e]:void 0;return o&&(e=>{for(let o=0;o<e.length;o++){const r=e[o];if(r.listener===i&&wl(r.targets,t)){for(const e in r.delegates)this.off(e,r.delegates[e]);return e.splice(o,1),this}}})(o),this}queryRenderedFeatures(t,i){if(!this.style)return [];if(void 0===t||t instanceof e.P||Array.isArray(t)||void 0!==i||(i=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],!i){const e=this.style.queryRenderedFeatures(t,void 0,this.transform),i=this.style.queryRenderedFeatureset(t,void 0,this.transform);return e.concat(i)}let o=!0;if(i.target&&(o=this._isTargetValid(i.target),o&&!i.layers))return this.style.queryRenderedFeatureset(t,i,this.transform);let r=!0;if(i.layers&&Array.isArray(i.layers)){for(const e of i.layers)if(!this._isValidId(e)){r=!1;break}if(r&&!i.target)return this.style.queryRenderedFeatures(t,i,this.transform)}let s=[];return r&&(s=s.concat(this.style.queryRenderedFeatures(t,i,this.transform))),o&&(s=s.concat(this.style.queryRenderedFeatureset(t,i,this.transform))),s}querySourceFeatures(e,t){return !e||"string"==typeof e&&!this._isValidId(e)?[]:this.style.querySourceFeatures(e,t)}isPointOnSurface(t){const{name:i}=this.transform.projection;return "globe"!==i&&"mercator"!==i&&e.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(e.P.convert(t))}addInteraction(e,t){return this._interactions.add(e,t),this}removeInteraction(e){return this._interactions.remove(e),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this}setStyle(t,i){return i=e.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&t&&!1!==i.diff&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(t,((o,r)=>{if(o){const r="string"==typeof o?o:o instanceof Error?o.message:o.error;e.w(`Unable to perform style diff: ${r}. Rebuilding the style from scratch.`),this._updateStyle(t,i);}else r&&this._update(!0);}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(t,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t){const o=e.h({},i);i&&i.config&&(o.initialConfig=i.config,delete o.config),this.style=new Io(this,o).load(t),this.style.setEventedParent(this,{style:this.style});}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Io(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty());}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.z(new Error("IDs can't be empty."))),!1):!e.dk(t)||(this.fire(new e.z(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}_isTargetValid(e){return "featuresetId"in e?this._isValidId("importId"in e?e.importId:e.featuresetId):"layerId"in e&&this._isValidId(e.layerId)}_areTargetsValid(e){if(Array.isArray(e)){for(const t of e)if(!this._isValidId(t))return !1;return !0}return this._isTargetValid(e)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return !!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i);}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,i,{pixelRatio:o=1,sdf:r=!1,stretchX:s,stretchY:n,content:a}={}){this._lazyInitEmptyStyle();const l=e.I.from(t);if(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:t,height:c,data:h}=e.q.getImageData(i);this.style.addImage(l,{data:new e.r({width:t,height:c},h),pixelRatio:o,stretchX:s,stretchY:n,content:a,sdf:r,version:0,usvg:!1});}else if(void 0===i.width||void 0===i.height)this.fire(new e.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else {const{width:c,height:h}=i,d=i;this.style.addImage(l,{data:new e.r({width:c,height:h},new Uint8Array(d.data)),pixelRatio:o,stretchX:s,stretchY:n,content:a,sdf:r,usvg:!1,version:0,userImage:d}),d.onAdd&&d.onAdd(this,t);}}updateImage(t,i){this._lazyInitEmptyStyle();const o=e.I.from(t),r=this.style.getImage(o);if(!r)return void this.fire(new e.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const s=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?e.q.getImageData(i):i,{width:n,height:a,data:l}=s;if(void 0===n||void 0===a)return void this.fire(new e.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(n!==(r.usvg?r.icon.usvg_tree.width:r.data.width)||a!==(r.usvg?r.icon.usvg_tree.height:r.data.height))return void this.fire(new e.z(new Error(`The width and height of the updated image (${n}, ${a})\n                must be that same as the previous version of the image\n                (${r.data.width}, ${r.data.height})`)));const c=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let h=!1;r.usvg?(r.data=new e.r({width:n,height:a},new Uint8Array(l)),r.usvg=!1,r.icon=void 0,h=!0):r.data.replace(l,c),this.style.updateImage(o,r,h);}hasImage(t){return t?!!this.style&&!!this.style.getImage(e.I.from(t)):(this.fire(new e.z(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(e.I.from(t));}loadImage(t,i){e.o(this._requestManager.transformRequest(t,e.R.Image),((t,o)=>{i(t,o instanceof HTMLImageElement?e.q.getImageData(o):o);}));}listImages(){return this.style.listImages().map((e=>e.name))}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t);}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.z(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e);}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(t,i){return this.style.addImport(t,i).catch((t=>this.fire(new e.z(new Error("Failed to add import",t))))),this}updateImport(e,t){return "string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){if(!this._isValidId(e))return null;const t=this.style.getOwnLayer(e);return t?"custom"===t.type?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t,i={}){return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i,o={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,o),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i,o={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,o),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(e){return this.style.setGlyphsUrl(e),this._update(!0)}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}getFeaturesetDescriptors(e){return this.style.getFeaturesetDescriptors(e)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat");}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(e){return this._lazyInitEmptyStyle(),this.style.setSnow(e),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(e){return this._lazyInitEmptyStyle(),this.style.setRain(e),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(e){return this._lazyInitEmptyStyle(),this.style.setColorTheme(e),this._update(!0)}setImportColorTheme(e,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(e,t),this._update(!0)}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.ci.convert(t),this.transform):0}setFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.setFeatureState(e,t),this._update())}removeFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.removeFeatureState(e,t),this._update())}getFeatureState(e){return e.source&&!this._isValidId(e.source)?null:this.style.getFeatureState(e)}_selectIndoorFloor(e){this.indoor.selectFloor(e);}_addIndoorControl(){this._indoorControl||(this._indoorControl=new ml),this.addControl(this._indoorControl,"right");}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl);}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let i,o,r,s=this._container;for(;s&&(!o||!r);){const e=window.getComputedStyle(s).transform;e&&"none"!==e&&(i=e.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(o=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(r=i[3])),s=s.parentElement;}this._containerWidth=o?Math.abs(e/o):e,this._containerHeight=r?Math.abs(t/r):t;}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.");}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=l("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=l("div","mapboxgl-canvas-container",e);this._canvas=l("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=l("div","mapboxgl-control-container",e),o=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((e=>{o[e]=l("div",`mapboxgl-ctrl-${e}`,i);})),this._container.addEventListener("scroll",this._onMapScroll,!1);}_resizeCanvas(t,i){const o=e.q.devicePixelRatio||1;this._canvas.width=o*Math.ceil(t),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${i}px`;}_addMarker(e){this._markers.push(e);}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1);}_addPopup(e){this._popups.push(e);}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1);}_setupPainter(){const t=e.h({},a.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",t);i?(j(i,!0),this.painter=new ua(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0);})),e.l.testSupport(i)):this.fire(new e.z(new Error("Failed to initialize WebGL")));}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.A("webglcontextlost",{originalEvent:t}));}_contextRestored(t){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new e.A("webglcontextrestored",{originalEvent:t}));}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return !this.isMoving()&&this.loaded()}loaded(){return !this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e);}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e);}_render(t){let r;this.fire(new e.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,n=e.q.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=a.createQuery(),a.beginQuery(s.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,o=e.q.now(),r=new e.aa(t,{now:o,fadeDuration:l,pitch:i,transition:this.style.transition,worldview:this._worldview});this.style.update(r);}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let c=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),c=this._updateAverageElevation(n),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):c=this._updateAverageElevation(n);const h=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),h&&(this._placementDirty=h.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.mark(i.load),this.fire(new e.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const t=e.q.now()-n;a.endQuery(s.TIME_ELAPSED_EXT),setTimeout((()=>{const i=a.getQueryParameter(r,a.QUERY_RESULT)/1e6;a.deleteQuery(r),this.fire(new e.A("gpu-timing-frame",{cpuTime:t,gpuTime:i}));}),50);}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.A("gpu-timing-layer",{layerTimes:i}));}),50);}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.A("gpu-timing-deferred-render",{gpuTime:i}));}),50);}const d=this._sourcesDirty||this._styleDirty||this._placementDirty||c;if(d||this._repaint)this.triggerRepaint();else {const t=this.idle();if(t&&(c=this._updateAverageElevation(n,!0)),c)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.A("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1;}}!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,o.mark(i.fullLoad),this._performanceMetricsCollection&&B(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate());}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update();}_updateAverageElevation(e,t=!1){const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const o=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(o||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let r=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=e;const s=Math.abs(t-r);if(s>1){if(this._isInitialLoad||o)return this._averageElevation.jumpTo(r),i(r);this._averageElevation.easeTo(r,e,300);}else if(s>1e-4)return this._averageElevation.jumpTo(r),i(r)}return !!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){N(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===w||401===t.status)){const t=this.painter.context.gl;j(t,!1),this._logoControl instanceof fl&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")));}})),z(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}));}_postStyleLoadEvent(){this.style.globalId&&O(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()});}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e);}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,o=i.createFramebuffer();function r(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,o),this._canvasPixelComparison(r(e),t.canvasCopies.map(r),t.timeStamps)}_canvasPixelComparison(e,t,i){let o=i[1]-i[0];const r=e.length/4;for(let s=0;s<t.length;s++){const n=t[s];let a=0;for(let t=0;t<n.length;t+=4)n[t]===e[t]&&n[t+1]===e[t+1]&&n[t+2]===e[t+2]&&n[t+3]===e[t+3]&&(a+=1);o+=(i[s+2]-i[s+1])*(1-a/r);}return o}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),U.delete(this.painter.context.gl),k.remove(),L.remove(),this._removed=!0,this.fire(new e.A("remove"));}triggerRepaint(){this._triggerFrame(!0);}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.q.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e);})));}_preloadTiles(t){const i=this.style?this.style.getSourceCaches():[];return e.bt(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint();})),this}_onWindowOnline(){this._update();}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update();}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++;}get showTileBoundaries(){return !!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._tp.refreshUI(),this._update());}get showParseStatus(){return !!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._tp.refreshUI(),this._update());}get showTerrainWireframe(){return !!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._tp.refreshUI(),this._update());}get showLayers2DWireframe(){return !!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._tp.refreshUI(),this._update());}get showLayers3DWireframe(){return !!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._tp.refreshUI(),this._update());}get speedIndexTiming(){return !!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update());}get showPadding(){return !!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._tp.refreshUI(),this._update());}get showCollisionBoxes(){return !!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this._tp.refreshUI(),e?this.style._generateCollisionBoxes():this._update());}get showOverdrawInspector(){return !!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._tp.refreshUI(),this._update());}get repaint(){return !!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this._tp.refreshUI(),this.triggerRepaint());}get vertices(){return !!this._vertices}set vertices(e){this._vertices=e,this._update();}get showTileAABBs(){return !!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,this._tp.refreshUI(),e&&this._update());}_setCacheLimits(t,i){e.eV(t,i);}get version(){return t}},NavigationControl:class{constructor(t={}){this.options=e.h({},El,t),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e});})),l("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e});})),l("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}));})),this._compassIcon=l("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"));}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),o=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString());}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t);}));}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Sl(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0);}_createButton(e,t){const i=l("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i);}},GeolocateControl:class extends e.E{constructor(t={}){super();const i=navigator.geolocation;this.options=e.h({geolocation:i},Dl,t),e.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=_a(this._updateMarkerRotation,20),this._numberOfWatches=0;}onAdd(e){return this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1;}_checkGeolocationSupport(e){const t=(t=!!this.options.geolocation)=>{this._supportsGeolocation=t,e(t);};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((e=>t("denied"!==e.state))).catch((()=>t())):t();}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return !!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case "WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case "ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case "BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.A("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case "WAITING_ACTIVE":case "ACTIVE_LOCK":case "ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case "BACKGROUND":case "BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("geolocate",t)),this._finish();}}_updateCamera(t){const i=new e.ci(t.coords.longitude,t.coords.latitude),o=t.coords.accuracy,r=this._map.getBearing(),s=e.h({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),s,{geolocateSource:!0});}_updateMarker(t){if(t){const i=new e.ci(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius();}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove();}_updateCircleRadius(){const t=this._map.transform,i=e.cb(1,t._center.lat)*t.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`;}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius();}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0));}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch();}else {if(3===t.code&&this._noTimeout)return;this._setErrorState();}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.A("error",t)),this._finish();}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0;}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=l("button","mapboxgl-ctrl-geolocate",this._container),l("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t);}else {const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e);}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=l("div","mapboxgl-user-location"),this._dotElement.appendChild(l("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(l("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Al({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=l("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.A("trackuserlocationend")));}));}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled());}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case "OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.A("trackuserlocationstart"));break;case "WAITING_ACTIVE":case "ACTIVE_LOCK":case "ACTIVE_ERROR":case "BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.A("trackuserlocationend"));break;case "BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.A("trackuserlocationstart"));}switch(this._watchState){case "WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case "ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case "ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case "BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case "BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error");}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener();}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return !0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation);};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e();})).catch(console.error):e();}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null);}},AttributionControl:pl,ScaleControl:class{constructor(t={}){this.options=e.h({},Pl,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return !1}}(),e.aV(["_update","_setScale","setUnit"],this);}getDefaultPosition(){return "bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,o=t._containerWidth/2-e/2,r=t.unproject([o,i]),s=t.unproject([o+e,i]),n=r.distanceTo(s);if("imperial"===this.options.unit){const t=3.2808*n;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot");}else "nautical"===this.options.unit?this._setScale(e,n/1852,"nautical-mile"):n>=1e3?this._setScale(e,n/1e3,"kilometer"):this._setScale(e,n,"meter");}_setScale(e,t,i){this._map._requestDomTask((()=>{const o=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(t),r=o/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(o):`${o}&nbsp;${Ll[i]}`,this._container.style.width=e*r+"px";}));}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0;}_setLanguage(e){this._language=e,this._update();}setUnit(e){this.options.unit=e,this._update();}},FullscreenControl:class{constructor(t={}){this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange");}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon);}_checkFullscreenSupport(){return !(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=l("button","mapboxgl-ctrl-fullscreen",this._controlContainer);l("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon);}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e);}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle());}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen();}},IndoorControl:ml,Popup:class extends e.E{constructor(t){super(),this.options=e.h(Object.create(zl),t),this._altitude=this.options.altitude,e.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[]);}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.A("open")),this}isOpen(){return !!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.A("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.ci.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(e){return this._altitude=e,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),i=document.createElement("body");let o;for(i.innerHTML=e;o=i.firstChild,o;)t.appendChild(o);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=l("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=l("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.innerHTML='<span aria-hidden="true">&#215;</span>',e.addEventListener("click",this._onClose);}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point);}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,o=this._pos;if(!t||!i||!o)return "bottom";const r=i.offsetWidth,s=i.offsetHeight,n=o.x<r/2,a=o.x>t.transform.width-r/2;if(o.y+e<s)return n?"top-left":a?"top-right":"top";if(o.y>t.transform.height-s){if(n)return "bottom-left";if(a)return "bottom-right"}return n?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ");}_update(t){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let r=this._container;if(r||(r=this._container=l("div","mapboxgl-popup",i.getContainer()),this._tip=l("div","mapboxgl-popup-tip",r),r.appendChild(o)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Il(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const o=this._pos=this._trackPointer&&t instanceof e.P?t:i.project(this._lngLat,this._altitude),r=Ol(this.options.offset),s=this._anchor=this._getAnchor(r.y),n=Ol(this.options.offset,s),a=o.add(n).round();i._requestDomTask((()=>{this._container&&s&&(this._container.style.transform=`${Cl[s]} translate(${a.x}px,${a.y}px)`);}));}if(!this._marker&&i._showingGlobe()){const t=e.eW(i.transform,this._lngLat)?0:1;this._setOpacity(t);}this._updateClassList();}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(Ml);e&&e.focus();}_onClose(){this.remove();}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none");}},Marker:Al,Style:Io,LngLat:e.ci,LngLatBounds:e.aG,Point:e.P,MercatorCoordinate:e.ac,FreeCameraOptions:$i,Evented:e.E,config:e.e,prewarm:e.e_,clearPrewarmedResources:e.eZ,get accessToken(){return e.e.ACCESS_TOKEN},set accessToken(t){e.e.ACCESS_TOKEN=t;},get baseApiUrl(){return e.e.API_URL},set baseApiUrl(t){e.e.API_URL=t;},get workerCount(){return e.f7.workerCount},set workerCount(t){e.f7.workerCount=t;},get maxParallelImageRequests(){return e.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.e.MAX_PARALLEL_IMAGE_REQUESTS=t;},clearStorage(t){e.f6(t);},get workerUrl(){return e.f5.workerUrl},set workerUrl(t){e.f5.workerUrl=t;},get workerClass(){return e.f5.workerClass},set workerClass(t){e.f5.workerClass=t;},get workerParams(){return e.f5.workerParams},set workerParams(t){e.f5.workerParams=t;},get dracoUrl(){return e.f4()},set dracoUrl(t){e.f3(t);},get meshoptUrl(){return e.f2()},set meshoptUrl(t){e.f1(t);},setNow:e.q.setNow,restoreNow:e.q.restoreNow};return Fl}));

//
// Our custom intro provides a specialized "define()" function, called by the
// AMD modules below, that sets up the worker blob URL and then executes the
// main module, storing its exported value as 'mapboxgl'


var mapboxgl$1 = mapboxgl;

return mapboxgl$1;

}));
//# sourceMappingURL=mapbox-gl.js.map
</script>
<script>!function r(s,h,u){function a(t,e){if(!h[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var o=h[t]={exports:{}};s[t][0].call(o.exports,function(e){return a(s[t][1][e]||e)},o,o.exports,r,s,h,u)}return h[t].exports}for(var c="function"==typeof require&&require,e=0;e<u.length;e++)a(u[e]);return a}({1:[function(e,t,n){"use strict";var s=e("@mapbox/mapbox-gl-sync-move"),h=e("events").EventEmitter;function i(e,t,n,i){if(this.options=i||{},this._mapA=e,this._mapB=t,this._horizontal="horizontal"===this.options.orientation,this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new h,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"mapboxgl-compare mapboxgl-compare-horizontal":"mapboxgl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),"string"==typeof n&&document.body.querySelectorAll){var o=document.body.querySelectorAll(n)[0];if(!o)throw new Error("Cannot find element with specified container selector.");o.appendChild(this._controlContainer)}else{if(!(n instanceof Element&&n.appendChild))throw new Error("Invalid container specified. Must be CSS selector or HTML element.");n.appendChild(this._controlContainer)}this._bounds=t.getContainer().getBoundingClientRect();var r=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(r),this._clearSync=s(e,t),this._onResize=function(){this._bounds=t.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}.bind(this),t.on("resize",this._onResize),this.options&&this.options.mousemove&&(e.getContainer().addEventListener("mousemove",this._onMove),t.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}i.prototype={_setPointerEvents:function(e){this._controlContainer.style.pointerEvents=e,this._swiper.style.pointerEvents=e},_onDown:function(e){e.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(e){e=Math.min(e,this._horizontal?this._bounds.height:this._bounds.width);var t=this._horizontal?"translate(0, "+e+"px)":"translate("+e+"px, 0)";this._controlContainer.style.transform=t,this._controlContainer.style.WebkitTransform=t;var n=this._horizontal?"rect(0, 999em, "+e+"px, 0)":"rect(0, "+e+"px, "+this._bounds.height+"px, 0)",i=this._horizontal?"rect("+e+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+e+"px)";this._mapA.getContainer().style.clip=n,this._mapB.getContainer().style.clip=i,this.currentPosition=e},_onMove:function(e){this.options&&this.options.mousemove&&this._setPointerEvents(e.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(e)):this._setPosition(this._getX(e))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd)},_getX:function(e){var t=(e=e.touches?e.touches[0]:e).clientX-this._bounds.left;return t<0&&(t=0),t>this._bounds.width&&(t=this._bounds.width),t},_getY:function(e){var t=(e=e.touches?e.touches[0]:e).clientY-this._bounds.top;return t<0&&(t=0),t>this._bounds.height&&(t=this._bounds.height),t},setSlider:function(e){this._setPosition(e)},on:function(e,t){return this._ev.on(e,t),this},fire:function(e,t){return this._ev.emit(e,t),this},off:function(e,t){return this._ev.removeListener(e,t),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var e=this._mapA.getContainer();e&&(e.style.clip=null,e.removeEventListener("mousemove",this._onMove));var t=this._mapB.getContainer();t&&(t.style.clip=null,t.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.mapboxgl?mapboxgl.Compare=i:void 0!==t&&(t.exports=i)},{"@mapbox/mapbox-gl-sync-move":2,events:3}],2:[function(e,t,n){t.exports=function(){var t,e=arguments.length;if(1===e)t=arguments[0];else{t=[];for(var n=0;n<e;n++)t.push(arguments[n])}var i=[];function o(){t.forEach(function(e,t){e.on("move",i[t])})}function r(){t.forEach(function(e,t){e.off("move",i[t])})}return t.forEach(function(e,n){i[n]=function(e,t){r(),function(e,t){var n=e.getCenter(),i=e.getZoom(),o=e.getBearing(),r=e.getPitch();t.forEach(function(e){e.jumpTo({center:n,zoom:i,bearing:o,pitch:r})})}(e,t),o()}.bind(null,e,t.filter(function(e,t){return t!==n}))}),o(),function(){r(),i=[]}}},{}],3:[function(e,t,n){var u=Object.create||function(e){function t(){}return t.prototype=e,new t},s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return n},r=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function i(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=u(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=i).EventEmitter=i).prototype._events=void 0,i.prototype._maxListeners=void 0;var o,h=10;try{var a={};Object.defineProperty&&Object.defineProperty(a,"x",{value:0}),o=0===a.x}catch(e){o=!1}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function l(e,t,n,i){var o,r,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((r=e._events)?(r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),s=r[t]):(r=e._events=u(null),e._eventsCount=0),s){if("function"==typeof s?s=r[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),!s.warned&&(o=c(e))&&0<o&&s.length>o){s.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",h.name,h.message)}}else s=r[t]=n,++e._eventsCount;return e}function f(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function p(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=r.call(f,i);return o.listener=n,i.wrapFn=o}function v(e,t,n){var i=e._events;if(!i)return[];var o=i[t];return o?"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):_(o,o.length):[]}function m(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function _(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}o?Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');h=e}}):i.defaultMaxListeners=h,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e,t,n,i){var o,r,s,h,u,a,c="error"===e;if(a=this._events)c=c&&null==a.error;else if(!c)return!1;if(c){if(1<arguments.length&&(o=t),o instanceof Error)throw o;var l=new Error('Unhandled "error" event. ('+o+")");throw l.context=o,l}if(!(r=a[e]))return!1;var f="function"==typeof r;switch(s=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var i=e.length,o=_(e,i),r=0;r<i;++r)o[r].call(n)}(r,f,this);break;case 2:!function(e,t,n,i){if(t)e.call(n,i);else for(var o=e.length,r=_(e,o),s=0;s<o;++s)r[s].call(n,i)}(r,f,this,t);break;case 3:!function(e,t,n,i,o){if(t)e.call(n,i,o);else for(var r=e.length,s=_(e,r),h=0;h<r;++h)s[h].call(n,i,o)}(r,f,this,t,n);break;case 4:!function(e,t,n,i,o,r){if(t)e.call(n,i,o,r);else for(var s=e.length,h=_(e,s),u=0;u<s;++u)h[u].call(n,i,o,r)}(r,f,this,t,n,i);break;default:for(h=new Array(s-1),u=1;u<s;u++)h[u-1]=arguments[u];!function(e,t,n,i){if(t)e.apply(n,i);else for(var o=e.length,r=_(e,o),s=0;s<o;++s)r[s].apply(n,i)}(r,f,this,h)}return!0},i.prototype.on=i.prototype.addListener=function(e,t){return l(this,e,t,!1)},i.prototype.prependListener=function(e,t){return l(this,e,t,!0)},i.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,p(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,p(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,i,o,r,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=u(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,r=n.length-1;0<=r;r--)if(n[r]===t||n[r].listener===t){s=n[r].listener,o=r;break}if(o<0)return this;0===o?n.shift():function(e,t){for(var n=t,i=n+1,o=e.length;i<o;n+=1,i+=1)e[n]=e[i];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.removeAllListeners=function(e){var t,n,i;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=u(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=u(null):delete n[e]),this;if(0===arguments.length){var o,r=s(n);for(i=0;i<r.length;++i)"removeListener"!==(o=r[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=u(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)for(i=t.length-1;0<=i;i--)this.removeListener(e,t[i]);return this},i.prototype.listeners=function(e){return v(this,e,!0)},i.prototype.rawListeners=function(e){return v(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},i.prototype.listenerCount=m,i.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}]},{},[1]);
</script>
<style type="text/css">

.mapbox-gl-draw_ctrl-bottom-left,
.mapbox-gl-draw_ctrl-top-left {
margin-left:0;
border-radius:0 4px 4px 0;
}
.mapbox-gl-draw_ctrl-top-right,
.mapbox-gl-draw_ctrl-bottom-right {
margin-right:0;
border-radius:4px 0 0 4px;
}
.mapbox-gl-draw_ctrl-draw-btn {
border-color:rgba(0,0,0,0.9);
color:rgba(255,255,255,0.5);
width:30px;
height:30px;
}
.mapbox-gl-draw_ctrl-draw-btn.active,
.mapbox-gl-draw_ctrl-draw-btn.active:hover {
background-color:rgb(0 0 0/5%);
}
.mapbox-gl-draw_ctrl-draw-btn {
background-repeat: no-repeat;
background-position: center;
}
.mapbox-gl-draw_point {
background-image: url('data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m10 2c-3.3 0-6 2.7-6 6s6 9 6 9 6-5.7 6-9-2.7-6-6-6zm0 2c2.1 0 3.8 1.7 3.8 3.8 0 1.5-1.8 3.9-2.9 5.2h-1.7c-1.1-1.4-2.9-3.8-2.9-5.2-.1-2.1 1.6-3.8 3.7-3.8z"/>%3C/svg>');
}
.mapbox-gl-draw_polygon {
background-image: url('data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m15 12.3v-4.6c.6-.3 1-1 1-1.7 0-1.1-.9-2-2-2-.7 0-1.4.4-1.7 1h-4.6c-.3-.6-1-1-1.7-1-1.1 0-2 .9-2 2 0 .7.4 1.4 1 1.7v4.6c-.6.3-1 1-1 1.7 0 1.1.9 2 2 2 .7 0 1.4-.4 1.7-1h4.6c.3.6 1 1 1.7 1 1.1 0 2-.9 2-2 0-.7-.4-1.4-1-1.7zm-8-.3v-4l1-1h4l1 1v4l-1 1h-4z"/>%3C/svg>');
}
.mapbox-gl-draw_line {
background-image: url('data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m13.5 3.5c-1.4 0-2.5 1.1-2.5 2.5 0 .3 0 .6.2.9l-3.8 3.8c-.3-.1-.6-.2-.9-.2-1.4 0-2.5 1.1-2.5 2.5s1.1 2.5 2.5 2.5 2.5-1.1 2.5-2.5c0-.3 0-.6-.2-.9l3.8-3.8c.3.1.6.2.9.2 1.4 0 2.5-1.1 2.5-2.5s-1.1-2.5-2.5-2.5z"/>%3C/svg>');
}
.mapbox-gl-draw_trash {
background-image: url('data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="M10,3.4 c-0.8,0-1.5,0.5-1.8,1.2H5l-1,1v1h12v-1l-1-1h-3.2C11.5,3.9,10.8,3.4,10,3.4z M5,8v7c0,1,1,2,2,2h6c1,0,2-1,2-2V8h-2v5.5h-1.5V8h-3 v5.5H7V8H5z"/>%3C/svg>');
}
.mapbox-gl-draw_uncombine {
background-image: url('data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="m12 2c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l1 1c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-1-1c-.2-.2-.4-.3-.7-.3zm4 4c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l1 1c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-1-1c-.2-.2-.4-.3-.7-.3zm-7 1c-1 0-1 1-.5 1.5.3.3 1 1 1 1l-1 1s-.5.5 0 1 1 0 1 0l1-1 1 1c.5.5 1.5.5 1.5-.5v-4zm-5 3c-.3 0-.5.1-.7.3l-1 1c-.4.4-.4 1 0 1.4l4.9 4.9c.4.4 1 .4 1.4 0l1-1c.4-.4.4-1 0-1.4l-4.9-4.9c-.1-.2-.4-.3-.7-.3z"/>%3C/svg>');
}
.mapbox-gl-draw_combine {
background-image: url('data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20">%3Cpath d="M12.1,2c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l4.9,4.9c0.4,0.4,1,0.4,1.4,0l1-1 c0.4-0.4,0.4-1,0-1.4l-4.9-4.9C12.6,2.1,12.3,2,12.1,2z M8,8C7,8,7,9,7.5,9.5c0.3,0.3,1,1,1,1l-1,1c0,0-0.5,0.5,0,1s1,0,1,0l1-1l1,1 C11,13,12,13,12,12V8H8z M4,10c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l1,1c0.4,0.4,1,0.4,1.4,0l1-1c0.4-0.4,0.4-1,0-1.4 l-1-1C4.5,10.1,4.3,10,4,10z M8,14c-0.3,0-0.5,0.1-0.7,0.3l-1,1c-0.4,0.4-0.4,1,0,1.4l1,1c0.4,0.4,1,0.4,1.4,0l1-1 c0.4-0.4,0.4-1,0-1.4l-1-1C8.5,14.1,8.3,14,8,14z"/>%3C/svg>');
}
.mapboxgl-map.mouse-pointer .mapboxgl-canvas-container.mapboxgl-interactive {
cursor: pointer;
}
.mapboxgl-map.mouse-move .mapboxgl-canvas-container.mapboxgl-interactive {
cursor: move;
}
.mapboxgl-map.mouse-add .mapboxgl-canvas-container.mapboxgl-interactive {
cursor: crosshair;
}
.mapboxgl-map.mouse-move.mode-direct_select .mapboxgl-canvas-container.mapboxgl-interactive {
cursor: grab;
cursor: -moz-grab;
cursor: -webkit-grab;
}
.mapboxgl-map.mode-direct_select.feature-vertex.mouse-move .mapboxgl-canvas-container.mapboxgl-interactive {
cursor: move;
}
.mapboxgl-map.mode-direct_select.feature-midpoint.mouse-pointer .mapboxgl-canvas-container.mapboxgl-interactive {
cursor: cell;
}
.mapboxgl-map.mode-direct_select.feature-feature.mouse-move .mapboxgl-canvas-container.mapboxgl-interactive {
cursor: move;
}
.mapboxgl-map.mode-static.mouse-pointer .mapboxgl-canvas-container.mapboxgl-interactive {
cursor: grab;
cursor: -moz-grab;
cursor: -webkit-grab;
}
.mapbox-gl-draw_boxselect {
pointer-events: none;
position: absolute;
top: 0;
left: 0;
width: 0;
height: 0;
background: rgba(0,0,0,.1);
border: 2px dotted #fff;
opacity: 0.5;
}
</style>
<script>!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).MapboxDraw=e()}(this,(function(){"use strict";var t=function(t,e){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on:function(t,e,o){if(void 0===n[t])throw new Error("Invalid event type: "+t);n[t].push({selector:e,fn:o})},render:function(t){e.store.featureChanged(t)}},r=function(t,r){for(var i=n[t],a=i.length;a--;){var s=i[a];if(s.selector(r)){s.fn.call(o,r)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(o),{render:t.render,stop:function(){t.stop&&t.stop()},trash:function(){t.trash&&(t.trash(),e.store.render())},combineFeatures:function(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures:function(){t.uncombineFeatures&&t.uncombineFeatures()},drag:function(t){r("drag",t)},click:function(t){r("click",t)},mousemove:function(t){r("mousemove",t)},mousedown:function(t){r("mousedown",t)},mouseup:function(t){r("mouseup",t)},mouseout:function(t){r("mouseout",t)},keydown:function(t){r("keydown",t)},keyup:function(t){r("keyup",t)},touchstart:function(t){r("touchstart",t)},touchmove:function(t){r("touchmove",t)},touchend:function(t){r("touchend",t)},tap:function(t){r("tap",t)}}};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){if(this instanceof t){var n=[null];n.push.apply(n,arguments);var o=Function.bind.apply(e,n);return new o}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var o=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,o.get?o:{enumerable:!0,get:function(){return t[e]}})})),n}var o={},r={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142},i=r;function a(t){var e=0;if(t&&t.length>0){e+=Math.abs(s(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(s(t[n]))}return e}function s(t){var e,n,o,r,a,s,c=0,l=t.length;if(l>2){for(s=0;s<l;s++)s===l-2?(o=l-2,r=l-1,a=0):s===l-1?(o=l-1,r=0,a=1):(o=s,r=s+1,a=s+2),e=t[o],n=t[r],c+=(u(t[a][0])-u(e[0]))*Math.sin(u(n[1]));c=c*i.RADIUS*i.RADIUS/2}return c}function u(t){return t*Math.PI/180}o.geometry=function t(e){var n,o=0;switch(e.type){case"Polygon":return a(e.coordinates);case"MultiPolygon":for(n=0;n<e.coordinates.length;n++)o+=a(e.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<e.geometries.length;n++)o+=t(e.geometries[n]);return o}},o.ring=s;var c={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},l={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},d={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},p={POLYGON:"polygon",LINE:"line_string",POINT:"point"},f={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},h={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},g={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},y={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},v={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},m={ACTIVE:"true",INACTIVE:"false"},_=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],b=-85,E=Object.freeze({__proto__:null,classes:c,sources:l,cursors:d,types:p,geojsonTypes:f,modes:h,events:g,updateActions:y,meta:v,activeStates:m,interactions:_,LAT_MIN:-90,LAT_RENDERED_MIN:b,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),T={Point:0,LineString:1,MultiLineString:1,Polygon:2};function C(t,e){var n=T[t.geometry.type]-T[e.geometry.type];return 0===n&&t.geometry.type===f.POLYGON?t.area-e.area:n}function O(t){return t.map((function(t){return t.geometry.type===f.POLYGON&&(t.area=o.geometry({type:f.FEATURE,property:{},geometry:t.geometry})),t})).sort(C).map((function(t){return delete t.area,t}))}function S(t,e){return void 0===e&&(e=0),[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}function I(t){if(this._items={},this._nums={},this._length=t?t.length:0,t)for(var e=0,n=t.length;e<n;e++)this.add(t[e]),void 0!==t[e]&&("string"==typeof t[e]?this._items[t[e]]=e:this._nums[t[e]]=e)}I.prototype.add=function(t){return this.has(t)||(this._length++,"string"==typeof t?this._items[t]=this._length:this._nums[t]=this._length),this},I.prototype.delete=function(t){return!1===this.has(t)||(this._length--,delete this._items[t],delete this._nums[t]),this},I.prototype.has=function(t){return("string"==typeof t||"number"==typeof t)&&(void 0!==this._items[t]||void 0!==this._nums[t])},I.prototype.values=function(){var t=this,e=[];return Object.keys(this._items).forEach((function(n){e.push({k:n,v:t._items[n]})})),Object.keys(this._nums).forEach((function(n){e.push({k:JSON.parse(n),v:t._nums[n]})})),e.sort((function(t,e){return t.v-e.v})).map((function(t){return t.k}))},I.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var x=[v.FEATURE,v.MIDPOINT,v.VERTEX],M={click:function(t,e,n){return L(t,e,n,n.options.clickBuffer)},touch:function(t,e,n){return L(t,e,n,n.options.touchBuffer)}};function L(t,e,n,o){if(null===n.map)return[];var r=t?S(t,o):e,i={};n.options.styles&&(i.layers=n.options.styles.map((function(t){return t.id})).filter((function(t){return null!=n.map.getLayer(t)})));var a=n.map.queryRenderedFeatures(r,i).filter((function(t){return-1!==x.indexOf(t.properties.meta)})),s=new I,u=[];return a.forEach((function(t){var e=t.properties.id;s.has(e)||(s.add(e),u.push(t))})),O(u)}function N(t,e){var n=M.click(t,null,e),o={mouse:d.NONE};return n[0]&&(o.mouse=n[0].properties.active===m.ACTIVE?d.MOVE:d.POINTER,o.feature=n[0].properties.meta),-1!==e.events.currentModeName().indexOf("draw")&&(o.mouse=d.ADD),e.ui.queueMapClasses(o),e.ui.updateMapClasses(),n[0]}function A(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}function P(t,e,n){void 0===n&&(n={});var o=null!=n.fineTolerance?n.fineTolerance:4,r=null!=n.grossTolerance?n.grossTolerance:12,i=null!=n.interval?n.interval:500;t.point=t.point||e.point,t.time=t.time||e.time;var a=A(t.point,e.point);return a<o||a<r&&e.time-t.time<i}function F(t,e,n){void 0===n&&(n={});var o=null!=n.tolerance?n.tolerance:25,r=null!=n.interval?n.interval:250;return t.point=t.point||e.point,t.time=t.time||e.time,A(t.point,e.point)<o&&e.time-t.time<r}var w={exports:{}},R=w.exports=function(t,e){if(e||(e=16),void 0===t&&(t=128),t<=0)return"0";for(var n=Math.log(Math.pow(2,t))/Math.log(e),o=2;n===1/0;o*=2)n=Math.log(Math.pow(2,t/o))/Math.log(e)*o;var r=n-Math.floor(n),i="";for(o=0;o<Math.floor(n);o++){i=Math.floor(Math.random()*e).toString(e)+i}if(r){var a=Math.pow(e,r);i=Math.floor(Math.random()*a).toString(e)+i}var s=parseInt(i,e);return s!==1/0&&s>=Math.pow(2,t)?R(t,e):i};R.rack=function(t,e,n){var o=function(o){var i=0;do{if(i++>10){if(!n)throw new Error("too many ID collisions, use more bits");t+=n}var a=R(t,e)}while(Object.hasOwnProperty.call(r,a));return r[a]=o,a},r=o.hats={};return o.get=function(t){return o.hats[t]},o.set=function(t,e){return o.hats[t]=e,o},o.bits=t||128,o.base=e||16,o};var k=e(w.exports),D=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||k(),this.type=e.geometry.type};D.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},D.prototype.incomingCoords=function(t){this.setCoordinates(t)},D.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},D.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},D.prototype.setProperty=function(t,e){this.properties[t]=e},D.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:f.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},D.prototype.internal=function(t){var e={id:this.id,meta:v.FEATURE,"meta:type":this.type,active:m.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(var n in this.properties)e["user_"+n]=this.properties[n];return{type:f.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var U=function(t,e){D.call(this,t,e)};(U.prototype=Object.create(D.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},U.prototype.updateCoordinate=function(t,e,n){this.coordinates=3===arguments.length?[e,n]:[t,e],this.changed()},U.prototype.getCoordinate=function(){return this.getCoordinates()};var j=function(t,e){D.call(this,t,e)};(j.prototype=Object.create(D.prototype)).isValid=function(){return this.coordinates.length>1},j.prototype.addCoordinate=function(t,e,n){this.changed();var o=parseInt(t,10);this.coordinates.splice(o,0,[e,n])},j.prototype.getCoordinate=function(t){var e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},j.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)},j.prototype.updateCoordinate=function(t,e,n){var o=parseInt(t,10);this.coordinates[o]=[e,n],this.changed()};var V=function(t,e){D.call(this,t,e),this.coordinates=this.coordinates.map((function(t){return t.slice(0,-1)}))};(V.prototype=Object.create(D.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every((function(t){return t.length>2}))},V.prototype.incomingCoords=function(t){this.coordinates=t.map((function(t){return t.slice(0,-1)})),this.changed()},V.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()},V.prototype.addCoordinate=function(t,e,n){this.changed();var o=t.split(".").map((function(t){return parseInt(t,10)}));this.coordinates[o[0]].splice(o[1],0,[e,n])},V.prototype.removeCoordinate=function(t){this.changed();var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];n&&(n.splice(e[1],1),n.length<3&&this.coordinates.splice(e[0],1))},V.prototype.getCoordinate=function(t){var e=t.split(".").map((function(t){return parseInt(t,10)})),n=this.coordinates[e[0]];return JSON.parse(JSON.stringify(n[e[1]]))},V.prototype.getCoordinates=function(){return this.coordinates.map((function(t){return t.concat([t[0]])}))},V.prototype.updateCoordinate=function(t,e,n){this.changed();var o=t.split("."),r=parseInt(o[0],10),i=parseInt(o[1],10);void 0===this.coordinates[r]&&(this.coordinates[r]=[]),this.coordinates[r][i]=[e,n]};var B={MultiPoint:U,MultiLineString:j,MultiPolygon:V},G=function(t,e,n,o,r){var i=n.split("."),a=parseInt(i[0],10),s=i[1]?i.slice(1).join("."):null;return t[a][e](s,o,r)},J=function(t,e){if(D.call(this,t,e),delete this.coordinates,this.model=B[e.geometry.type],void 0===this.model)throw new TypeError(e.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(e.geometry.coordinates)};function z(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}(J.prototype=Object.create(D.prototype))._coordinatesToFeatures=function(t){var e=this,n=this.model.bind(this);return t.map((function(t){return new n(e.ctx,{id:k(),type:f.FEATURE,properties:{},geometry:{coordinates:t,type:e.type.replace("Multi","")}})}))},J.prototype.isValid=function(){return this.features.every((function(t){return t.isValid()}))},J.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()},J.prototype.getCoordinate=function(t){return G(this.features,"getCoordinate",t)},J.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map((function(t){return t.type===f.POLYGON?t.getCoordinates():t.coordinates}))))},J.prototype.updateCoordinate=function(t,e,n){G(this.features,"updateCoordinate",t,e,n),this.changed()},J.prototype.addCoordinate=function(t,e,n){G(this.features,"addCoordinate",t,e,n),this.changed()},J.prototype.removeCoordinate=function(t){G(this.features,"removeCoordinate",t),this.changed()},J.prototype.getFeatures=function(){return this.features},z.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)},z.prototype.setSelectedCoordinates=function(t){var e=this;this._ctx.store.setSelectedCoordinates(t),t.reduce((function(t,n){return void 0===t[n.feature_id]&&(t[n.feature_id]=!0,e._ctx.store.get(n.feature_id).changed()),t}),{})},z.prototype.getSelected=function(){return this._ctx.store.getSelected()},z.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},z.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)},z.prototype.getFeature=function(t){return this._ctx.store.get(t)},z.prototype.select=function(t){return this._ctx.store.select(t)},z.prototype.deselect=function(t){return this._ctx.store.deselect(t)},z.prototype.deleteFeature=function(t,e){return void 0===e&&(e={}),this._ctx.store.delete(t,e)},z.prototype.addFeature=function(t){return this._ctx.store.add(t)},z.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},z.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},z.prototype.setActionableState=function(t){void 0===t&&(t={});var e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)},z.prototype.changeMode=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),this._ctx.events.changeMode(t,e,n)},z.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)},z.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)},z.prototype.featuresAt=function(t,e,n){if(void 0===n&&(n="click"),"click"!==n&&"touch"!==n)throw new Error("invalid buffer type");return M[n](t,e,this._ctx)},z.prototype.newFeature=function(t){var e=t.geometry.type;return e===f.POINT?new U(this._ctx,t):e===f.LINE_STRING?new j(this._ctx,t):e===f.POLYGON?new V(this._ctx,t):new J(this._ctx,t)},z.prototype.isInstanceOf=function(t,e){if(t===f.POINT)return e instanceof U;if(t===f.LINE_STRING)return e instanceof j;if(t===f.POLYGON)return e instanceof V;if("MultiFeature"===t)return e instanceof J;throw new Error("Unknown feature class: "+t)},z.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)},z.prototype.onSetup=function(){},z.prototype.onDrag=function(){},z.prototype.onClick=function(){},z.prototype.onMouseMove=function(){},z.prototype.onMouseDown=function(){},z.prototype.onMouseUp=function(){},z.prototype.onMouseOut=function(){},z.prototype.onKeyUp=function(){},z.prototype.onKeyDown=function(){},z.prototype.onTouchStart=function(){},z.prototype.onTouchMove=function(){},z.prototype.onTouchEnd=function(){},z.prototype.onTap=function(){},z.prototype.onStop=function(){},z.prototype.onTrash=function(){},z.prototype.onCombineFeature=function(){},z.prototype.onUncombineFeature=function(){},z.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Y={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},$=Object.keys(Y);function q(t){var e=Object.keys(t);return function(n,o){void 0===o&&(o={});var r={},i=e.reduce((function(e,n){return e[n]=t[n],e}),new z(n));return{start:function(){var e=this;r=i.onSetup(o),$.forEach((function(n){var o,a=Y[n],s=function(){return!1};t[a]&&(s=function(){return!0}),e.on(n,s,(o=a,function(t){return i[o](r,t)}))}))},stop:function(){i.onStop(r)},trash:function(){i.onTrash(r)},combineFeatures:function(){i.onCombineFeatures(r)},uncombineFeatures:function(){i.onUncombineFeatures(r)},render:function(t,e){i.toDisplayFeatures(r,t,e)}}}}function H(t){return[].concat(t).filter((function(t){return void 0!==t}))}function X(){var t=this;if(!(t.ctx.map&&void 0!==t.ctx.map.getSource(l.HOT)))return u();var e=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:e});var n=[],o=[];t.isDirty?o=t.getAllIds():(n=t.getChangedIds().filter((function(e){return void 0!==t.get(e)})),o=t.sources.hot.filter((function(e){return e.properties.id&&-1===n.indexOf(e.properties.id)&&void 0!==t.get(e.properties.id)})).map((function(t){return t.properties.id}))),t.sources.hot=[];var r=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter((function(t){var e=t.properties.id||t.properties.parent;return-1===n.indexOf(e)}));var i=r!==t.sources.cold.length||o.length>0;function a(n,o){var r=t.get(n).internal(e);t.ctx.events.currentModeRender(r,(function(e){t.sources[o].push(e)}))}if(n.forEach((function(t){return a(t,"hot")})),o.forEach((function(t){return a(t,"cold")})),i&&t.ctx.map.getSource(l.COLD).setData({type:f.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(l.HOT).setData({type:f.FEATURE_COLLECTION,features:t.sources.hot}),t._emitSelectionChange&&(t.ctx.map.fire(g.SELECTION_CHANGE,{features:t.getSelected().map((function(t){return t.toGeoJSON()})),points:t.getSelectedCoordinates().map((function(t){return{type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:t.coordinates}}}))}),t._emitSelectionChange=!1),t._deletedFeaturesToEmit.length){var s=t._deletedFeaturesToEmit.map((function(t){return t.toGeoJSON()}));t._deletedFeaturesToEmit=[],t.ctx.map.fire(g.DELETE,{features:s})}function u(){t.isDirty=!1,t.clearChangedIds()}u(),t.ctx.map.fire(g.RENDER,{})}function Z(t){var e,n=this;this._features={},this._featureIds=new I,this._selectedFeatureIds=new I,this._selectedCoordinates=[],this._changedFeatureIds=new I,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]},this.render=function(){e||(e=requestAnimationFrame((function(){e=null,X.call(n)})))},this.isDirty=!1}function W(t,e){var n=t._selectedCoordinates.filter((function(e){return t._selectedFeatureIds.has(e.feature_id)}));t._selectedCoordinates.length===n.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=n}Z.prototype.createRenderBatch=function(){var t=this,e=this.render,n=0;return this.render=function(){n++},function(){t.render=e,n>0&&t.render()}},Z.prototype.setDirty=function(){return this.isDirty=!0,this},Z.prototype.featureChanged=function(t){return this._changedFeatureIds.add(t),this},Z.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Z.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Z.prototype.getAllIds=function(){return this._featureIds.values()},Z.prototype.add=function(t){return this.featureChanged(t.id),this._features[t.id]=t,this._featureIds.add(t.id),this},Z.prototype.delete=function(t,e){var n=this;return void 0===e&&(e={}),H(t).forEach((function(t){n._featureIds.has(t)&&(n._featureIds.delete(t),n._selectedFeatureIds.delete(t),e.silent||-1===n._deletedFeaturesToEmit.indexOf(n._features[t])&&n._deletedFeaturesToEmit.push(n._features[t]),delete n._features[t],n.isDirty=!0)})),W(this,e),this},Z.prototype.get=function(t){return this._features[t]},Z.prototype.getAll=function(){var t=this;return Object.keys(this._features).map((function(e){return t._features[e]}))},Z.prototype.select=function(t,e){var n=this;return void 0===e&&(e={}),H(t).forEach((function(t){n._selectedFeatureIds.has(t)||(n._selectedFeatureIds.add(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),this},Z.prototype.deselect=function(t,e){var n=this;return void 0===e&&(e={}),H(t).forEach((function(t){n._selectedFeatureIds.has(t)&&(n._selectedFeatureIds.delete(t),n._changedFeatureIds.add(t),e.silent||(n._emitSelectionChange=!0))})),W(this,e),this},Z.prototype.clearSelected=function(t){return void 0===t&&(t={}),this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this},Z.prototype.setSelected=function(t,e){var n=this;return void 0===e&&(e={}),t=H(t),this.deselect(this._selectedFeatureIds.values().filter((function(e){return-1===t.indexOf(e)})),{silent:e.silent}),this.select(t.filter((function(t){return!n._selectedFeatureIds.has(t)})),{silent:e.silent}),this},Z.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this},Z.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Z.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Z.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map((function(e){return t.get(e)}))},Z.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map((function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}}))},Z.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)},Z.prototype.setFeatureProperty=function(t,e,n){this.get(t).setProperty(e,n),this.featureChanged(t)},Z.prototype.storeMapConfig=function(){var t=this;_.forEach((function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())}))},Z.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach((function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()}))},Z.prototype.getInitialConfigValue=function(t){return void 0===this._mapInitialConfig[t]||this._mapInitialConfig[t]};var K=function(){for(var t=arguments,e={},n=0;n<arguments.length;n++){var o=t[n];for(var r in o)Q.call(o,r)&&(e[r]=o[r])}return e},Q=Object.prototype.hasOwnProperty;var tt=e(K),et=["mode","feature","mouse"];function nt(e){var n=null,o=null,r={onRemove:function(){return e.map.off("load",r.connect),clearInterval(o),r.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,n&&n.parentNode&&n.parentNode.removeChild(n),n=null,this},connect:function(){e.map.off("load",r.connect),clearInterval(o),r.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(i){var a=i.fire;return i.fire=function(t,e){var n=arguments;return 1===a.length&&1!==arguments.length&&(n=[tt({},{type:t},e)]),a.apply(i,n)},e.map=i,e.events=function(e){var n=Object.keys(e.options.modes).reduce((function(t,n){return t[n]=q(e.options.modes[n]),t}),{}),o={},r={},i={},a=null,s=null;i.drag=function(t,n){n({point:t.point,time:(new Date).getTime()})?(e.ui.queueMapClasses({mouse:d.DRAG}),s.drag(t)):t.originalEvent.stopPropagation()},i.mousedrag=function(t){i.drag(t,(function(t){return!P(o,t)}))},i.touchdrag=function(t){i.drag(t,(function(t){return!F(r,t)}))},i.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return i.mousedrag(t);var n=N(t,e);t.featureTarget=n,s.mousemove(t)},i.mousedown=function(t){o={time:(new Date).getTime(),point:t.point};var n=N(t,e);t.featureTarget=n,s.mousedown(t)},i.mouseup=function(t){var n=N(t,e);t.featureTarget=n,P(o,{point:t.point,time:(new Date).getTime()})?s.click(t):s.mouseup(t)},i.mouseout=function(t){s.mouseout(t)},i.touchstart=function(t){if(e.options.touchEnabled){r={time:(new Date).getTime(),point:t.point};var n=M.touch(t,null,e)[0];t.featureTarget=n,s.touchstart(t)}},i.touchmove=function(t){if(e.options.touchEnabled)return s.touchmove(t),i.touchdrag(t)},i.touchend=function(t){if(t.originalEvent.preventDefault(),e.options.touchEnabled){var n=M.touch(t,null,e)[0];t.featureTarget=n,F(r,{time:(new Date).getTime(),point:t.point})?s.tap(t):s.touchend(t)}};var u=function(t){return!(8===t||46===t||t>=48&&t<=57)};function c(o,r,i){void 0===i&&(i={}),s.stop();var u=n[o];if(void 0===u)throw new Error(o+" is not valid");a=o;var c=u(e,r);s=t(c,e),i.silent||e.map.fire(g.MODE_CHANGE,{mode:o}),e.store.setDirty(),e.store.render()}i.keydown=function(t){(t.srcElement||t.target).classList.contains("mapboxgl-canvas")&&(8!==t.keyCode&&46!==t.keyCode||!e.options.controls.trash?u(t.keyCode)?s.keydown(t):49===t.keyCode&&e.options.controls.point?c(h.DRAW_POINT):50===t.keyCode&&e.options.controls.line_string?c(h.DRAW_LINE_STRING):51===t.keyCode&&e.options.controls.polygon&&c(h.DRAW_POLYGON):(t.preventDefault(),s.trash()))},i.keyup=function(t){u(t.keyCode)&&s.keyup(t)},i.zoomend=function(){e.store.changeZoom()},i.data=function(t){if("style"===t.dataType){var n=e.setup,o=e.map,r=e.options,i=e.store;r.styles.some((function(t){return o.getLayer(t.id)}))||(n.addLayers(),i.setDirty(),i.render())}};var l={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){a=e.options.defaultMode,s=t(n[a](e),e)},changeMode:c,actionable:function(t){var n=!1;Object.keys(t).forEach((function(e){if(void 0===l[e])throw new Error("Invalid action type");l[e]!==t[e]&&(n=!0),l[e]=t[e]})),n&&e.map.fire(g.ACTIONABLE,{actions:l})},currentModeName:function(){return a},currentModeRender:function(t,e){return s.render(t,e)},fire:function(t,e){i[t]&&i[t](e)},addEventListeners:function(){e.map.on("mousemove",i.mousemove),e.map.on("mousedown",i.mousedown),e.map.on("mouseup",i.mouseup),e.map.on("data",i.data),e.map.on("touchmove",i.touchmove),e.map.on("touchstart",i.touchstart),e.map.on("touchend",i.touchend),e.container.addEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",i.keydown),e.container.addEventListener("keyup",i.keyup))},removeEventListeners:function(){e.map.off("mousemove",i.mousemove),e.map.off("mousedown",i.mousedown),e.map.off("mouseup",i.mouseup),e.map.off("data",i.data),e.map.off("touchmove",i.touchmove),e.map.off("touchstart",i.touchstart),e.map.off("touchend",i.touchend),e.container.removeEventListener("mouseout",i.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",i.keydown),e.container.removeEventListener("keyup",i.keyup))},trash:function(t){s.trash(t)},combineFeatures:function(){s.combineFeatures()},uncombineFeatures:function(){s.uncombineFeatures()},getMode:function(){return a}}}(e),e.ui=function(t){var e={},n=null,o={mode:null,feature:null,mouse:null},r={mode:null,feature:null,mouse:null};function i(t){r=tt(r,t)}function a(){var e,n;if(t.container){var i=[],a=[];et.forEach((function(t){r[t]!==o[t]&&(i.push(t+"-"+o[t]),null!==r[t]&&a.push(t+"-"+r[t]))})),i.length>0&&(e=t.container.classList).remove.apply(e,i),a.length>0&&(n=t.container.classList).add.apply(n,a),o=tt(o,r)}}function s(t,e){void 0===e&&(e={});var o=document.createElement("button");return o.className=c.CONTROL_BUTTON+" "+e.className,o.setAttribute("title",e.title),e.container.appendChild(o),o.addEventListener("click",(function(o){if(o.preventDefault(),o.stopPropagation(),o.target===n)return u(),void e.onDeactivate();l(t),e.onActivate()}),!0),o}function u(){n&&(n.classList.remove(c.ACTIVE_BUTTON),n=null)}function l(t){u();var o=e[t];o&&o&&"trash"!==t&&(o.classList.add(c.ACTIVE_BUTTON),n=o)}return{setActiveButton:l,queueMapClasses:i,updateMapClasses:a,clearMapClasses:function(){i({mode:null,feature:null,mouse:null}),a()},addButtons:function(){var n=t.options.controls,o=document.createElement("div");return o.className=c.CONTROL_GROUP+" "+c.CONTROL_BASE,n?(n[p.LINE]&&(e[p.LINE]=s(p.LINE,{container:o,className:c.CONTROL_BUTTON_LINE,title:"LineString tool "+(t.options.keybindings?"(l)":""),onActivate:function(){return t.events.changeMode(h.DRAW_LINE_STRING)},onDeactivate:function(){return t.events.trash()}})),n[p.POLYGON]&&(e[p.POLYGON]=s(p.POLYGON,{container:o,className:c.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(t.options.keybindings?"(p)":""),onActivate:function(){return t.events.changeMode(h.DRAW_POLYGON)},onDeactivate:function(){return t.events.trash()}})),n[p.POINT]&&(e[p.POINT]=s(p.POINT,{container:o,className:c.CONTROL_BUTTON_POINT,title:"Marker tool "+(t.options.keybindings?"(m)":""),onActivate:function(){return t.events.changeMode(h.DRAW_POINT)},onDeactivate:function(){return t.events.trash()}})),n.trash&&(e.trash=s("trash",{container:o,className:c.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){t.events.trash()}})),n.combine_features&&(e.combine_features=s("combineFeatures",{container:o,className:c.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){t.events.combineFeatures()}})),n.uncombine_features&&(e.uncombine_features=s("uncombineFeatures",{container:o,className:c.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){t.events.uncombineFeatures()}})),o):o},removeButtons:function(){Object.keys(e).forEach((function(t){var n=e[t];n.parentNode&&n.parentNode.removeChild(n),delete e[t]}))}}}(e),e.container=i.getContainer(),e.store=new Z(e),n=e.ui.addButtons(),e.options.boxSelect&&(e.boxZoomInitial=i.boxZoom.isEnabled(),i.boxZoom.disable(),i.dragPan.disable(),i.dragPan.enable()),i.loaded()?r.connect():(i.on("load",r.connect),o=setInterval((function(){i.loaded()&&r.connect()}),16)),e.events.start(),n},addLayers:function(){e.map.addSource(l.COLD,{data:{type:f.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(l.HOT,{data:{type:f.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach((function(t){e.map.addLayer(t)})),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach((function(t){e.map.getLayer(t.id)&&e.map.removeLayer(t.id)})),e.map.getSource(l.COLD)&&e.map.removeSource(l.COLD),e.map.getSource(l.HOT)&&e.map.removeSource(l.HOT)}};return e.setup=r,r}var ot=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function rt(t){return function(e){var n=e.featureTarget;return!!n&&(!!n.properties&&n.properties.meta===t)}}function it(t){return!!t.originalEvent&&(!!t.originalEvent.shiftKey&&0===t.originalEvent.button)}function at(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&(t.featureTarget.properties.active===m.ACTIVE&&t.featureTarget.properties.meta===v.FEATURE))}function st(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&(t.featureTarget.properties.active===m.INACTIVE&&t.featureTarget.properties.meta===v.FEATURE))}function ut(t){return void 0===t.featureTarget}function ct(t){return!!t.featureTarget&&(!!t.featureTarget.properties&&t.featureTarget.properties.meta===v.FEATURE)}function lt(t){var e=t.featureTarget;return!!e&&(!!e.properties&&e.properties.meta===v.VERTEX)}function dt(t){return!!t.originalEvent&&!0===t.originalEvent.shiftKey}function pt(t){return 27===t.keyCode}function ft(t){return 13===t.keyCode}var ht=Object.freeze({__proto__:null,isOfMetaType:rt,isShiftMousedown:it,isActiveFeature:at,isInactiveFeature:st,noTarget:ut,isFeature:ct,isVertex:lt,isShiftDown:dt,isEscapeKey:pt,isEnterKey:ft,isTrue:function(){return!0}}),gt=yt;function yt(t,e){this.x=t,this.y=e}yt.prototype={clone:function(){return new yt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),o=e*this.x-n*this.y,r=n*this.x+e*this.y;return this.x=o,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),o=Math.sin(t),r=e.x+n*(this.x-e.x)-o*(this.y-e.y),i=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=r,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yt.convert=function(t){return t instanceof yt?t:Array.isArray(t)?new yt(t[0],t[1]):t};var vt=e(gt);function mt(t,e){var n=e.getBoundingClientRect();return new vt(t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0))}function _t(t,e,n,o){return{type:f.FEATURE,properties:{meta:v.VERTEX,parent:t,coord_path:n,active:o?m.ACTIVE:m.INACTIVE},geometry:{type:f.POINT,coordinates:e}}}function bt(t,e,n){var o=e.geometry.coordinates,r=n.geometry.coordinates;if(o[1]>85||o[1]<b||r[1]>85||r[1]<b)return null;var i={lng:(o[0]+r[0])/2,lat:(o[1]+r[1])/2};return{type:f.FEATURE,properties:{meta:v.MIDPOINT,parent:t,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:f.POINT,coordinates:[i.lng,i.lat]}}}function Et(t,e,n){void 0===e&&(e={}),void 0===n&&(n=null);var o,r=t.geometry,i=r.type,a=r.coordinates,s=t.properties&&t.properties.id,u=[];function c(t,n){var o="",r=null;t.forEach((function(t,i){var a=null!=n?n+"."+i:String(i),c=_t(s,t,a,l(a));if(e.midpoints&&r){var d=bt(s,r,c);d&&u.push(d)}r=c;var p=JSON.stringify(t);o!==p&&u.push(c),0===i&&(o=p)}))}function l(t){return!!e.selectedPaths&&-1!==e.selectedPaths.indexOf(t)}return i===f.POINT?u.push(_t(s,a,n,l(n))):i===f.POLYGON?a.forEach((function(t,e){c(t,null!==n?n+"."+e:String(e))})):i===f.LINE_STRING?c(a,n):0===i.indexOf(f.MULTI_PREFIX)&&(o=i.replace(f.MULTI_PREFIX,""),a.forEach((function(n,r){var i={type:f.FEATURE,properties:t.properties,geometry:{type:o,coordinates:n}};u=u.concat(Et(i,e,r))}))),u}var Tt={enable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()}),0)},disable:function(t){setTimeout((function(){t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()}),0)}},Ct={exports:{}},Ot=function(t){if(!t||!t.type)return null;var e=St[t.type];if(!e)return null;if("geometry"===e)return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]};if("feature"===e)return{type:"FeatureCollection",features:[t]};if("featurecollection"===e)return t},St={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};var It=e(Ot);var xt=Object.freeze({__proto__:null,default:function t(e){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.reduce((function(e,n){return e.concat(t(n))}),[]),e;case"Feature":return e.geometry?t(e.geometry).map((function(t){var n={type:"Feature",properties:JSON.parse(JSON.stringify(e.properties)),geometry:t};return void 0!==e.id&&(n.id=e.id),n})):[e];case"MultiPoint":return e.coordinates.map((function(t){return{type:"Point",coordinates:t}}));case"MultiPolygon":return e.coordinates.map((function(t){return{type:"Polygon",coordinates:t}}));case"MultiLineString":return e.coordinates.map((function(t){return{type:"LineString",coordinates:t}}));case"GeometryCollection":return e.geometries.map(t).reduce((function(t,e){return t.concat(e)}),[]);case"Point":case"Polygon":case"LineString":return[e]}}}),Mt=Ot,Lt=n(xt),Nt=function(t){return function t(e){if(Array.isArray(e)&&e.length&&"number"==typeof e[0])return[e];return e.reduce((function(e,n){return Array.isArray(n)&&Array.isArray(n[0])?e.concat(t(n)):(e.push(n),e)}),[])}(t)};Lt instanceof Function||(Lt=Lt.default);var At={exports:{}},Pt=At.exports=function(t){return new Ft(t)};function Ft(t){this.value=t}function wt(t,e,n){var o=[],r=[],i=!0;return function t(a){var s=n?Rt(a):a,u={},c=!0,l={node:s,node_:a,path:[].concat(o),parent:r[r.length-1],parents:r,key:o.slice(-1)[0],isRoot:0===o.length,level:o.length,circular:null,update:function(t,e){l.isRoot||(l.parent.node[l.key]=t),l.node=t,e&&(c=!1)},delete:function(t){delete l.parent.node[l.key],t&&(c=!1)},remove:function(t){Ut(l.parent.node)?l.parent.node.splice(l.key,1):delete l.parent.node[l.key],t&&(c=!1)},keys:null,before:function(t){u.before=t},after:function(t){u.after=t},pre:function(t){u.pre=t},post:function(t){u.post=t},stop:function(){i=!1},block:function(){c=!1}};if(!i)return l;function d(){if("object"==typeof l.node&&null!==l.node){l.keys&&l.node_===l.node||(l.keys=kt(l.node)),l.isLeaf=0==l.keys.length;for(var t=0;t<r.length;t++)if(r[t].node_===a){l.circular=r[t];break}}else l.isLeaf=!0,l.keys=null;l.notLeaf=!l.isLeaf,l.notRoot=!l.isRoot}d();var p=e.call(l,l.node);return void 0!==p&&l.update&&l.update(p),u.before&&u.before.call(l,l.node),c?("object"!=typeof l.node||null===l.node||l.circular||(r.push(l),d(),jt(l.keys,(function(e,r){o.push(e),u.pre&&u.pre.call(l,l.node[e],e);var i=t(l.node[e]);n&&Vt.call(l.node,e)&&(l.node[e]=i.node),i.isLast=r==l.keys.length-1,i.isFirst=0==r,u.post&&u.post.call(l,i),o.pop()})),r.pop()),u.after&&u.after.call(l,l.node),l):l}(t).node}function Rt(t){if("object"==typeof t&&null!==t){var e;if(Ut(t))e=[];else if("[object Date]"===Dt(t))e=new Date(t.getTime?t.getTime():t);else if(function(t){return"[object RegExp]"===Dt(t)}(t))e=new RegExp(t);else if(function(t){return"[object Error]"===Dt(t)}(t))e={message:t.message};else if(function(t){return"[object Boolean]"===Dt(t)}(t))e=new Boolean(t);else if(function(t){return"[object Number]"===Dt(t)}(t))e=new Number(t);else if(function(t){return"[object String]"===Dt(t)}(t))e=new String(t);else if(Object.create&&Object.getPrototypeOf)e=Object.create(Object.getPrototypeOf(t));else if(t.constructor===Object)e={};else{var n=t.constructor&&t.constructor.prototype||t.__proto__||{},o=function(){};o.prototype=n,e=new o}return jt(kt(t),(function(n){e[n]=t[n]})),e}return t}Ft.prototype.get=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!Vt.call(e,o)){e=void 0;break}e=e[o]}return e},Ft.prototype.has=function(t){for(var e=this.value,n=0;n<t.length;n++){var o=t[n];if(!e||!Vt.call(e,o))return!1;e=e[o]}return!0},Ft.prototype.set=function(t,e){for(var n=this.value,o=0;o<t.length-1;o++){var r=t[o];Vt.call(n,r)||(n[r]={}),n=n[r]}return n[t[o]]=e,e},Ft.prototype.map=function(t){return wt(this.value,t,!0)},Ft.prototype.forEach=function(t){return this.value=wt(this.value,t,!1),this.value},Ft.prototype.reduce=function(t,e){var n=1===arguments.length,o=n?this.value:e;return this.forEach((function(e){this.isRoot&&n||(o=t.call(this,o,e))})),o},Ft.prototype.paths=function(){var t=[];return this.forEach((function(e){t.push(this.path)})),t},Ft.prototype.nodes=function(){var t=[];return this.forEach((function(e){t.push(this.node)})),t},Ft.prototype.clone=function(){var t=[],e=[];return function n(o){for(var r=0;r<t.length;r++)if(t[r]===o)return e[r];if("object"==typeof o&&null!==o){var i=Rt(o);return t.push(o),e.push(i),jt(kt(o),(function(t){i[t]=n(o[t])})),t.pop(),e.pop(),i}return o}(this.value)};var kt=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};function Dt(t){return Object.prototype.toString.call(t)}var Ut=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},jt=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n++)e(t[n],n,t)};jt(kt(Ft.prototype),(function(t){Pt[t]=function(e){var n=[].slice.call(arguments,1),o=new Ft(e);return o[t].apply(o,n)}}));var Vt=Object.hasOwnProperty||function(t,e){return e in t},Bt=At.exports,Gt=Jt;function Jt(t){if(!(this instanceof Jt))return new Jt(t);this._bbox=t||[1/0,1/0,-1/0,-1/0],this._valid=!!t}Jt.prototype.include=function(t){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[0]),this._bbox[3]=Math.max(this._bbox[3],t[1]),this},Jt.prototype.equals=function(t){var e;return e=t instanceof Jt?t.bbox():t,this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},Jt.prototype.center=function(t){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Jt.prototype.union=function(t){var e;return this._valid=!0,e=t instanceof Jt?t.bbox():t,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},Jt.prototype.bbox=function(){return this._valid?this._bbox:null},Jt.prototype.contains=function(t){if(!t)return this._fastContains();if(!this._valid)return null;var e=t[0],n=t[1];return this._bbox[0]<=e&&this._bbox[1]<=n&&this._bbox[2]>=e&&this._bbox[3]>=n},Jt.prototype.intersect=function(t){return this._valid?(e=t instanceof Jt?t.bbox():t,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null;var e},Jt.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var t="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",t)},Jt.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var zt=function(t){if(!t)return[];var e=Lt(Mt(t)),n=[];return e.features.forEach((function(t){t.geometry&&(n=n.concat(Nt(t.geometry.coordinates)))})),n},Yt=Bt,$t=Gt,qt={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ht=Object.keys(qt);function Xt(t){for(var e=$t(),n=zt(t),o=0;o<n.length;o++)e.include(n[o]);return e}Ct.exports=function(t){return Xt(t).bbox()},Ct.exports.polygon=function(t){return Xt(t).polygon()},Ct.exports.bboxify=function(t){return Yt(t).map((function(t){t&&(Ht.some((function(e){return!!t[e]&&-1!==qt[e].indexOf(t.type)}))&&(t.bbox=Xt(t).bbox(),this.update(t)))}))};var Zt=e(Ct.exports),Wt=-90;function Kt(t,e){var n=Wt,o=90,r=Wt,i=90,a=270,s=-270;t.forEach((function(t){var e=Zt(t),u=e[1],c=e[3],l=e[0],d=e[2];u>n&&(n=u),c<o&&(o=c),c>r&&(r=c),u<i&&(i=u),l<a&&(a=l),d>s&&(s=d)}));var u=e;return n+u.lat>85&&(u.lat=85-n),r+u.lat>90&&(u.lat=90-r),o+u.lat<-85&&(u.lat=-85-o),i+u.lat<Wt&&(u.lat=Wt-i),a+u.lng<=-270&&(u.lng+=360*Math.ceil(Math.abs(u.lng)/360)),s+u.lng>=270&&(u.lng-=360*Math.ceil(Math.abs(u.lng)/360)),u}function Qt(t,e){var n=Kt(t.map((function(t){return t.toGeoJSON()})),e);t.forEach((function(t){var e,o=t.getCoordinates(),r=function(t){var e={lng:t[0]+n.lng,lat:t[1]+n.lat};return[e.lng,e.lat]},i=function(t){return t.map((function(t){return r(t)}))};t.type===f.POINT?e=r(o):t.type===f.LINE_STRING||t.type===f.MULTI_POINT?e=o.map(r):t.type===f.POLYGON||t.type===f.MULTI_LINE_STRING?e=o.map(i):t.type===f.MULTI_POLYGON&&(e=o.map((function(t){return t.map((function(t){return i(t)}))}))),t.incomingCoords(e)}))}var te={onSetup:function(t){var e=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter((function(t){return void 0!==e.getFeature(t)}))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(g.UPDATE,{action:y.MOVE,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(){var t=this,e=this.getSelected(),n=e.filter((function(e){return t.isInstanceOf("MultiFeature",e)})),o=!1;if(e.length>1){o=!0;var r=e[0].type.replace("Multi","");e.forEach((function(t){t.type.replace("Multi","")!==r&&(o=!1)}))}var i=n.length>0,a=e.length>0;this.setActionableState({combineFeatures:o,uncombineFeatures:i,trash:a})},getUniqueIds:function(t){return t.length?t.map((function(t){return t.properties.id})).filter((function(t){return void 0!==t})).reduce((function(t,e){return t.add(e),t}),new I).values():[]},stopExtendedInteractions:function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1},onStop:function(){Tt.enable(this)},onMouseMove:function(t,e){return ct(e)&&t.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(t),!0},onMouseOut:function(t){return!t.dragMoving||this.fireUpdate()}};te.onTap=te.onClick=function(t,e){return ut(e)?this.clickAnywhere(t,e):rt(v.VERTEX)(e)?this.clickOnVertex(t,e):ct(e)?this.clickOnFeature(t,e):void 0},te.clickAnywhere=function(t){var e=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach((function(t){return e.doRender(t)}))),Tt.enable(this),this.stopExtendedInteractions(t)},te.clickOnVertex=function(t,e){this.changeMode(h.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:d.MOVE})},te.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},te.clickOnFeature=function(t,e){var n=this;Tt.disable(this),this.stopExtendedInteractions(t);var o=dt(e),r=this.getSelectedIds(),i=e.featureTarget.properties.id,a=this.isSelected(i);if(!o&&a&&this.getFeature(i).type!==f.POINT)return this.changeMode(h.DIRECT_SELECT,{featureId:i});a&&o?(this.deselect(i),this.updateUIClasses({mouse:d.POINTER}),1===r.length&&Tt.enable(this)):!a&&o?(this.select(i),this.updateUIClasses({mouse:d.MOVE})):a||o||(r.forEach((function(t){return n.doRender(t)})),this.setSelected(i),this.updateUIClasses({mouse:d.MOVE})),this.doRender(i)},te.onMouseDown=function(t,e){return at(e)?this.startOnActiveFeature(t,e):this.drawConfig.boxSelect&&it(e)?this.startBoxSelect(t,e):void 0},te.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=mt(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0},te.onTouchStart=function(t,e){if(at(e))return this.startOnActiveFeature(t,e)},te.onDrag=function(t,e){return t.canDragMove?this.dragMove(t,e):this.drawConfig.boxSelect&&t.canBoxSelect?this.whileBoxSelect(t,e):void 0},te.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:d.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(c.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));var n=mt(e.originalEvent,this.map.getContainer()),o=Math.min(t.boxSelectStartLocation.x,n.x),r=Math.max(t.boxSelectStartLocation.x,n.x),i=Math.min(t.boxSelectStartLocation.y,n.y),a=Math.max(t.boxSelectStartLocation.y,n.y),s="translate("+o+"px, "+i+"px)";t.boxSelectElement.style.transform=s,t.boxSelectElement.style.WebkitTransform=s,t.boxSelectElement.style.width=r-o+"px",t.boxSelectElement.style.height=a-i+"px"},te.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Qt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},te.onTouchEnd=te.onMouseUp=function(t,e){var n=this;if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){var o=[t.boxSelectStartLocation,mt(e.originalEvent,this.map.getContainer())],r=this.featuresAt(null,o,"click"),i=this.getUniqueIds(r).filter((function(t){return!n.isSelected(t)}));i.length&&(this.select(i),i.forEach((function(t){return n.doRender(t)})),this.updateUIClasses({mouse:d.MOVE}))}this.stopExtendedInteractions(t)},te.toDisplayFeatures=function(t,e,n){e.properties.active=this.isSelected(e.properties.id)?m.ACTIVE:m.INACTIVE,n(e),this.fireActionable(),e.properties.active===m.ACTIVE&&e.geometry.type!==f.POINT&&Et(e).forEach(n)},te.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},te.onCombineFeatures=function(){var t=this.getSelected();if(!(0===t.length||t.length<2)){for(var e=[],n=[],o=t[0].type.replace("Multi",""),r=0;r<t.length;r++){var i=t[r];if(i.type.replace("Multi","")!==o)return;i.type.includes("Multi")?i.getCoordinates().forEach((function(t){e.push(t)})):e.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){var a=this.newFeature({type:f.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+o,coordinates:e}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(g.COMBINE_FEATURES,{createdFeatures:[a.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},te.onUncombineFeatures=function(){var t=this,e=this.getSelected();if(0!==e.length){for(var n=[],o=[],r=function(r){var i=e[r];t.isInstanceOf("MultiFeature",i)&&(i.getFeatures().forEach((function(e){t.addFeature(e),e.properties=i.properties,n.push(e.toGeoJSON()),t.select([e.id])})),t.deleteFeature(i.id,{silent:!0}),o.push(i.toGeoJSON()))},i=0;i<e.length;i++)r(i);n.length>1&&this.map.fire(g.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:o}),this.fireActionable()}};var ee=rt(v.VERTEX),ne=rt(v.MIDPOINT),oe={fireUpdate:function(){this.map.fire(g.UPDATE,{action:y.CHANGE_COORDINATES,features:this.getSelected().map((function(t){return t.toGeoJSON()}))})},fireActionable:function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})},startDragging:function(t,e){this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat},stopDragging:function(t){this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null},onVertex:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties,o=t.selectedCoordPaths.indexOf(n.coord_path);dt(e)||-1!==o?dt(e)&&-1===o&&t.selectedCoordPaths.push(n.coord_path):t.selectedCoordPaths=[n.coord_path];var r=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(r)},onMidpoint:function(t,e){this.startDragging(t,e);var n=e.featureTarget.properties;t.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),t.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(t,e){return e.map((function(e){return{feature_id:t,coord_path:e}}))},onFeature:function(t,e){0===t.selectedCoordPaths.length?this.startDragging(t,e):this.stopDragging(t)},dragFeature:function(t,e,n){Qt(this.getSelected(),n),t.dragMoveLocation=e.lngLat},dragVertex:function(t,e,n){for(var o=t.selectedCoordPaths.map((function(e){return t.feature.getCoordinate(e)})),r=Kt(o.map((function(t){return{type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:t}}})),n),i=0;i<o.length;i++){var a=o[i];t.feature.updateCoordinate(t.selectedCoordPaths[i],a[0]+r.lng,a[1]+r.lat)}},clickNoTarget:function(){this.changeMode(h.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(h.SIMPLE_SELECT)},clickActiveFeature:function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()},onSetup:function(t){var e=t.featureId,n=this.getFeature(e);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===f.POINT)throw new TypeError("direct_select mode doesn't handle point features");var o={featureId:e,feature:n,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,o.selectedCoordPaths)),this.setSelected(e),Tt.disable(this),this.setActionableState({trash:!0}),o},onStop:function(){Tt.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(t,e,n){t.featureId===e.properties.id?(e.properties.active=m.ACTIVE,n(e),Et(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(n)):(e.properties.active=m.INACTIVE,n(e)),this.fireActionable(t)},onTrash:function(t){t.selectedCoordPaths.sort((function(t,e){return e.localeCompare(t,"en",{numeric:!0})})).forEach((function(e){return t.feature.removeCoordinate(e)})),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),!1===t.feature.isValid()&&(this.deleteFeature([t.featureId]),this.changeMode(h.SIMPLE_SELECT,{}))},onMouseMove:function(t,e){var n=at(e),o=ee(e),r=ne(e),i=0===t.selectedCoordPaths.length;return n&&i||o&&!i?this.updateUIClasses({mouse:d.MOVE}):this.updateUIClasses({mouse:d.NONE}),(o||n||r)&&t.dragMoving&&this.fireUpdate(),this.stopDragging(t),!0},onMouseOut:function(t){return t.dragMoving&&this.fireUpdate(),!0}};oe.onTouchStart=oe.onMouseDown=function(t,e){return ee(e)?this.onVertex(t,e):at(e)?this.onFeature(t,e):ne(e)?this.onMidpoint(t,e):void 0},oe.onDrag=function(t,e){if(!0===t.canDragMove){t.dragMoving=!0,e.originalEvent.stopPropagation();var n={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,n):this.dragFeature(t,e,n),t.dragMoveLocation=e.lngLat}},oe.onClick=function(t,e){return ut(e)?this.clickNoTarget(t,e):at(e)?this.clickActiveFeature(t,e):st(e)?this.clickInactive(t,e):void this.stopDragging(t)},oe.onTap=function(t,e){return ut(e)?this.clickNoTarget(t,e):at(e)?this.clickActiveFeature(t,e):st(e)?this.clickInactive(t,e):void 0},oe.onTouchEnd=oe.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var re={};function ie(t,e){return!!t.lngLat&&(t.lngLat.lng===e[0]&&t.lngLat.lat===e[1])}re.onSetup=function(){var t=this.newFeature({type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:d.ADD}),this.activateUIButton(p.POINT),this.setActionableState({trash:!0}),{point:t}},re.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)},re.onTap=re.onClick=function(t,e){this.updateUIClasses({mouse:d.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(g.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(h.SIMPLE_SELECT,{featureIds:[t.point.id]})},re.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},re.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.point.id;if(e.properties.active=o?m.ACTIVE:m.INACTIVE,!o)return n(e)},re.onTrash=re.stopDrawingAndRemove,re.onKeyUp=function(t,e){if(pt(e)||ft(e))return this.stopDrawingAndRemove(t,e)};var ae={onSetup:function(){var t=this.newFeature({type:f.FEATURE,properties:{},geometry:{type:f.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),Tt.disable(this),this.updateUIClasses({mouse:d.ADD}),this.activateUIButton(p.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ie(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(h.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:d.ADD}),t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(h.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate("0."+t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),lt(e)&&this.updateUIClasses({mouse:d.POINTER})}};ae.onTap=ae.onClick=function(t,e){return lt(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},ae.onKeyUp=function(t,e){pt(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)):ft(e)&&this.changeMode(h.SIMPLE_SELECT,{featureIds:[t.polygon.id]})},ae.onStop=function(t){this.updateUIClasses({mouse:d.NONE}),Tt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.polygon.id)&&(t.polygon.removeCoordinate("0."+t.currentVertexPosition),t.polygon.isValid()?this.map.fire(g.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT,{},{silent:!0})))},ae.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.polygon.id;if(e.properties.active=o?m.ACTIVE:m.INACTIVE,!o)return n(e);if(0!==e.geometry.coordinates.length){var r=e.geometry.coordinates[0].length;if(!(r<3)){if(e.properties.meta=v.FEATURE,n(_t(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),r>3){var i=e.geometry.coordinates[0].length-3;n(_t(t.polygon.id,e.geometry.coordinates[0][i],"0."+i,!1))}if(r<=4){var a=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:f.FEATURE,properties:e.properties,geometry:{coordinates:a,type:f.LINE_STRING}}),3===r)return}return n(e)}}},ae.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)};var se={onSetup:function(t){var e,n,o=(t=t||{}).featureId,r="forward";if(o){if(!(e=this.getFeature(o)))throw new Error("Could not find a feature with the provided featureId");var i=t.from;if(i&&"Feature"===i.type&&i.geometry&&"Point"===i.geometry.type&&(i=i.geometry),i&&"Point"===i.type&&i.coordinates&&2===i.coordinates.length&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=e.coordinates.length-1;if(e.coordinates[a][0]===i[0]&&e.coordinates[a][1]===i[1])n=a+1,e.addCoordinate.apply(e,[n].concat(e.coordinates[a]));else{if(e.coordinates[0][0]!==i[0]||e.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");r="backwards",n=0,e.addCoordinate.apply(e,[n].concat(e.coordinates[0]))}}else e=this.newFeature({type:f.FEATURE,properties:{},geometry:{type:f.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(e);return this.clearSelectedFeatures(),Tt.disable(this),this.updateUIClasses({mouse:d.ADD}),this.activateUIButton(p.LINE),this.setActionableState({trash:!0}),{line:e,currentVertexPosition:n,direction:r}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&ie(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&ie(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(h.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:d.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(h.SIMPLE_SELECT,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),lt(e)&&this.updateUIClasses({mouse:d.POINTER})}};se.onTap=se.onClick=function(t,e){if(lt(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},se.onKeyUp=function(t,e){ft(e)?this.changeMode(h.SIMPLE_SELECT,{featureIds:[t.line.id]}):pt(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT))},se.onStop=function(t){Tt.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(""+t.currentVertexPosition),t.line.isValid()?this.map.fire(g.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT,{},{silent:!0})))},se.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)},se.toDisplayFeatures=function(t,e,n){var o=e.properties.id===t.line.id;if(e.properties.active=o?m.ACTIVE:m.INACTIVE,!o)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=v.FEATURE,n(_t(t.line.id,e.geometry.coordinates["forward"===t.direction?e.geometry.coordinates.length-2:1],""+("forward"===t.direction?e.geometry.coordinates.length-2:1),!1)),n(e))};var ue={simple_select:te,direct_select:oe,draw_point:re,draw_polygon:ae,draw_line_string:se},ce={defaultMode:h.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:ot,modes:ue,controls:{},userProperties:!1},le={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},de={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function pe(t,e){return t.map((function(t){return t.source?t:tt(t,{id:t.id+"."+e,source:"hot"===e?l.HOT:l.COLD})}))}var fe={exports:{}};!function(t,e){var n="__lodash_hash_undefined__",o=9007199254740991,r="[object Arguments]",i="[object Array]",a="[object Boolean]",s="[object Date]",u="[object Error]",c="[object Function]",l="[object Map]",d="[object Number]",p="[object Object]",f="[object Promise]",h="[object RegExp]",g="[object Set]",y="[object String]",v="[object Symbol]",m="[object WeakMap]",_="[object ArrayBuffer]",b="[object DataView]",E=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,C={};C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C[r]=C[i]=C[_]=C[a]=C[b]=C[s]=C[u]=C[c]=C[l]=C[d]=C[p]=C[h]=C[g]=C[y]=C[m]=!1;var O="object"==typeof global&&global&&global.Object===Object&&global,S="object"==typeof self&&self&&self.Object===Object&&self,I=O||S||Function("return this")(),x=e&&!e.nodeType&&e,M=x&&t&&!t.nodeType&&t,L=M&&M.exports===x,N=L&&O.process,A=function(){try{return N&&N.binding&&N.binding("util")}catch(t){}}(),P=A&&A.isTypedArray;function F(t,e){for(var n=-1,o=null==t?0:t.length;++n<o;)if(e(t[n],n,t))return!0;return!1}function w(t){var e=-1,n=Array(t.size);return t.forEach((function(t,o){n[++e]=[o,t]})),n}function R(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var k,D,U,j=Array.prototype,V=Function.prototype,B=Object.prototype,G=I["__core-js_shared__"],J=V.toString,z=B.hasOwnProperty,Y=(k=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||""))?"Symbol(src)_1."+k:"",$=B.toString,q=RegExp("^"+J.call(z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),H=L?I.Buffer:void 0,X=I.Symbol,Z=I.Uint8Array,W=B.propertyIsEnumerable,K=j.splice,Q=X?X.toStringTag:void 0,tt=Object.getOwnPropertySymbols,et=H?H.isBuffer:void 0,nt=(D=Object.keys,U=Object,function(t){return D(U(t))}),ot=At(I,"DataView"),rt=At(I,"Map"),it=At(I,"Promise"),at=At(I,"Set"),st=At(I,"WeakMap"),ut=At(Object,"create"),ct=Rt(ot),lt=Rt(rt),dt=Rt(it),pt=Rt(at),ft=Rt(st),ht=X?X.prototype:void 0,gt=ht?ht.valueOf:void 0;function yt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function vt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function mt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var o=t[e];this.set(o[0],o[1])}}function _t(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new mt;++e<n;)this.add(t[e])}function bt(t){var e=this.__data__=new vt(t);this.size=e.size}function Et(t,e){var n=Ut(t),o=!n&&Dt(t),r=!n&&!o&&jt(t),i=!n&&!o&&!r&&zt(t),a=n||o||r||i,s=a?function(t,e){for(var n=-1,o=Array(t);++n<t;)o[n]=e(n);return o}(t.length,String):[],u=s.length;for(var c in t)!e&&!z.call(t,c)||a&&("length"==c||r&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||wt(c,u))||s.push(c);return s}function Tt(t,e){for(var n=t.length;n--;)if(kt(t[n][0],e))return n;return-1}function Ct(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Q&&Q in Object(t)?function(t){var e=z.call(t,Q),n=t[Q];try{t[Q]=void 0;var o=!0}catch(t){}var r=$.call(t);o&&(e?t[Q]=n:delete t[Q]);return r}(t):function(t){return $.call(t)}(t)}function Ot(t){return Jt(t)&&Ct(t)==r}function St(t,e,n,o,c){return t===e||(null==t||null==e||!Jt(t)&&!Jt(e)?t!=t&&e!=e:function(t,e,n,o,c,f){var m=Ut(t),E=Ut(e),T=m?i:Ft(t),C=E?i:Ft(e),O=(T=T==r?p:T)==p,S=(C=C==r?p:C)==p,I=T==C;if(I&&jt(t)){if(!jt(e))return!1;m=!0,O=!1}if(I&&!O)return f||(f=new bt),m||zt(t)?Mt(t,e,n,o,c,f):function(t,e,n,o,r,i,c){switch(n){case b:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case _:return!(t.byteLength!=e.byteLength||!i(new Z(t),new Z(e)));case a:case s:case d:return kt(+t,+e);case u:return t.name==e.name&&t.message==e.message;case h:case y:return t==e+"";case l:var p=w;case g:var f=1&o;if(p||(p=R),t.size!=e.size&&!f)return!1;var m=c.get(t);if(m)return m==e;o|=2,c.set(t,e);var E=Mt(p(t),p(e),o,r,i,c);return c.delete(t),E;case v:if(gt)return gt.call(t)==gt.call(e)}return!1}(t,e,T,n,o,c,f);if(!(1&n)){var x=O&&z.call(t,"__wrapped__"),M=S&&z.call(e,"__wrapped__");if(x||M){var L=x?t.value():t,N=M?e.value():e;return f||(f=new bt),c(L,N,n,o,f)}}if(!I)return!1;return f||(f=new bt),function(t,e,n,o,r,i){var a=1&n,s=Lt(t),u=s.length,c=Lt(e).length;if(u!=c&&!a)return!1;var l=u;for(;l--;){var d=s[l];if(!(a?d in e:z.call(e,d)))return!1}var p=i.get(t);if(p&&i.get(e))return p==e;var f=!0;i.set(t,e),i.set(e,t);var h=a;for(;++l<u;){var g=t[d=s[l]],y=e[d];if(o)var v=a?o(y,g,d,e,t,i):o(g,y,d,t,e,i);if(!(void 0===v?g===y||r(g,y,n,o,i):v)){f=!1;break}h||(h="constructor"==d)}if(f&&!h){var m=t.constructor,_=e.constructor;m==_||!("constructor"in t)||!("constructor"in e)||"function"==typeof m&&m instanceof m&&"function"==typeof _&&_ instanceof _||(f=!1)}return i.delete(t),i.delete(e),f}(t,e,n,o,c,f)}(t,e,n,o,St,c))}function It(t){return!(!Gt(t)||function(t){return!!Y&&Y in t}(t))&&(Vt(t)?q:E).test(Rt(t))}function xt(t){if(n=(e=t)&&e.constructor,o="function"==typeof n&&n.prototype||B,e!==o)return nt(t);var e,n,o,r=[];for(var i in Object(t))z.call(t,i)&&"constructor"!=i&&r.push(i);return r}function Mt(t,e,n,o,r,i){var a=1&n,s=t.length,u=e.length;if(s!=u&&!(a&&u>s))return!1;var c=i.get(t);if(c&&i.get(e))return c==e;var l=-1,d=!0,p=2&n?new _t:void 0;for(i.set(t,e),i.set(e,t);++l<s;){var f=t[l],h=e[l];if(o)var g=a?o(h,f,l,e,t,i):o(f,h,l,t,e,i);if(void 0!==g){if(g)continue;d=!1;break}if(p){if(!F(e,(function(t,e){if(a=e,!p.has(a)&&(f===t||r(f,t,n,o,i)))return p.push(e);var a}))){d=!1;break}}else if(f!==h&&!r(f,h,n,o,i)){d=!1;break}}return i.delete(t),i.delete(e),d}function Lt(t){return function(t,e,n){var o=e(t);return Ut(t)?o:function(t,e){for(var n=-1,o=e.length,r=t.length;++n<o;)t[r+n]=e[n];return t}(o,n(t))}(t,Yt,Pt)}function Nt(t,e){var n,o,r=t.__data__;return("string"==(o=typeof(n=e))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function At(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return It(n)?n:void 0}yt.prototype.clear=function(){this.__data__=ut?ut(null):{},this.size=0},yt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},yt.prototype.get=function(t){var e=this.__data__;if(ut){var o=e[t];return o===n?void 0:o}return z.call(e,t)?e[t]:void 0},yt.prototype.has=function(t){var e=this.__data__;return ut?void 0!==e[t]:z.call(e,t)},yt.prototype.set=function(t,e){var o=this.__data__;return this.size+=this.has(t)?0:1,o[t]=ut&&void 0===e?n:e,this},vt.prototype.clear=function(){this.__data__=[],this.size=0},vt.prototype.delete=function(t){var e=this.__data__,n=Tt(e,t);return!(n<0)&&(n==e.length-1?e.pop():K.call(e,n,1),--this.size,!0)},vt.prototype.get=function(t){var e=this.__data__,n=Tt(e,t);return n<0?void 0:e[n][1]},vt.prototype.has=function(t){return Tt(this.__data__,t)>-1},vt.prototype.set=function(t,e){var n=this.__data__,o=Tt(n,t);return o<0?(++this.size,n.push([t,e])):n[o][1]=e,this},mt.prototype.clear=function(){this.size=0,this.__data__={hash:new yt,map:new(rt||vt),string:new yt}},mt.prototype.delete=function(t){var e=Nt(this,t).delete(t);return this.size-=e?1:0,e},mt.prototype.get=function(t){return Nt(this,t).get(t)},mt.prototype.has=function(t){return Nt(this,t).has(t)},mt.prototype.set=function(t,e){var n=Nt(this,t),o=n.size;return n.set(t,e),this.size+=n.size==o?0:1,this},_t.prototype.add=_t.prototype.push=function(t){return this.__data__.set(t,n),this},_t.prototype.has=function(t){return this.__data__.has(t)},bt.prototype.clear=function(){this.__data__=new vt,this.size=0},bt.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},bt.prototype.get=function(t){return this.__data__.get(t)},bt.prototype.has=function(t){return this.__data__.has(t)},bt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof vt){var o=n.__data__;if(!rt||o.length<199)return o.push([t,e]),this.size=++n.size,this;n=this.__data__=new mt(o)}return n.set(t,e),this.size=n.size,this};var Pt=tt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,o=null==t?0:t.length,r=0,i=[];++n<o;){var a=t[n];e(a,n,t)&&(i[r++]=a)}return i}(tt(t),(function(e){return W.call(t,e)})))}:function(){return[]},Ft=Ct;function wt(t,e){return!!(e=null==e?o:e)&&("number"==typeof t||T.test(t))&&t>-1&&t%1==0&&t<e}function Rt(t){if(null!=t){try{return J.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function kt(t,e){return t===e||t!=t&&e!=e}(ot&&Ft(new ot(new ArrayBuffer(1)))!=b||rt&&Ft(new rt)!=l||it&&Ft(it.resolve())!=f||at&&Ft(new at)!=g||st&&Ft(new st)!=m)&&(Ft=function(t){var e=Ct(t),n=e==p?t.constructor:void 0,o=n?Rt(n):"";if(o)switch(o){case ct:return b;case lt:return l;case dt:return f;case pt:return g;case ft:return m}return e});var Dt=Ot(function(){return arguments}())?Ot:function(t){return Jt(t)&&z.call(t,"callee")&&!W.call(t,"callee")},Ut=Array.isArray;var jt=et||function(){return!1};function Vt(t){if(!Gt(t))return!1;var e=Ct(t);return e==c||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Bt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=o}function Gt(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Jt(t){return null!=t&&"object"==typeof t}var zt=P?function(t){return function(e){return t(e)}}(P):function(t){return Jt(t)&&Bt(t.length)&&!!C[Ct(t)]};function Yt(t){return null!=(e=t)&&Bt(e.length)&&!Vt(e)?Et(t):xt(t);var e}t.exports=function(t,e){return St(t,e)}}(fe,fe.exports);var he=e(fe.exports);function ge(t,e){return t.length===e.length&&JSON.stringify(t.map((function(t){return t})).sort())===JSON.stringify(e.map((function(t){return t})).sort())}var ye={Polygon:V,LineString:j,Point:U,MultiPolygon:J,MultiLineString:J,MultiPoint:J};var ve=Object.freeze({__proto__:null,CommonSelectors:ht,constrainFeatureMovement:Kt,createMidPoint:bt,createSupplementaryPoints:Et,createVertex:_t,doubleClickZoom:Tt,euclideanDistance:A,featuresAt:M,getFeatureAtAndSetCursors:N,isClick:P,isEventAtCoordinates:ie,isTap:F,mapEventToBoundingBox:S,ModeHandler:t,moveFeatures:Qt,sortFeatures:O,stringSetsAreEqual:ge,StringSet:I,theme:ot,toDenseArray:H}),me=function(t,e){var n={options:t=function(t){void 0===t&&(t={});var e=tt(t);return t.controls||(e.controls={}),!1===t.displayControlsDefault?e.controls=tt(de,t.controls):e.controls=tt(le,t.controls),(e=tt(ce,e)).styles=pe(e.styles,"cold").concat(pe(e.styles,"hot")),e}(t)};e=function(t,e){return e.modes=h,e.getFeatureIdsAt=function(e){return M.click({point:e},null,t).map((function(t){return t.properties.id}))},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:f.FEATURE_COLLECTION,features:t.store.getSelectedIds().map((function(e){return t.store.get(e)})).map((function(t){return t.toGeoJSON()}))}},e.getSelectedPoints=function(){return{type:f.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map((function(t){return{type:f.FEATURE,properties:{},geometry:{type:f.POINT,coordinates:t.coordinates}}}))}},e.set=function(n){if(void 0===n.type||n.type!==f.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");var o=t.store.createRenderBatch(),r=t.store.getAllIds().slice(),i=e.add(n),a=new I(i);return(r=r.filter((function(t){return!a.has(t)}))).length&&e.delete(r),o(),i},e.add=function(e){var n=JSON.parse(JSON.stringify(It(e))).features.map((function(e){if(e.id=e.id||k(),null===e.geometry)throw new Error("Invalid geometry: null");if(void 0===t.store.get(e.id)||t.store.get(e.id).type!==e.geometry.type){var n=ye[e.geometry.type];if(void 0===n)throw new Error("Invalid geometry type: "+e.geometry.type+".");var o=new n(t,e);t.store.add(o)}else{var r=t.store.get(e.id);r.properties=e.properties,he(r.properties,e.properties)||t.store.featureChanged(r.id),he(r.getCoordinates(),e.geometry.coordinates)||r.incomingCoords(e.geometry.coordinates)}return e.id}));return t.store.render(),n},e.get=function(e){var n=t.store.get(e);if(n)return n.toGeoJSON()},e.getAll=function(){return{type:f.FEATURE_COLLECTION,features:t.store.getAll().map((function(t){return t.toGeoJSON()}))}},e.delete=function(n){return t.store.delete(n,{silent:!0}),e.getMode()!==h.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(h.SIMPLE_SELECT,void 0,{silent:!0}),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),e.getMode()===h.DIRECT_SELECT?t.events.changeMode(h.SIMPLE_SELECT,void 0,{silent:!0}):t.store.render(),e},e.changeMode=function(n,o){return void 0===o&&(o={}),n===h.SIMPLE_SELECT&&e.getMode()===h.SIMPLE_SELECT?(ge(o.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(o.featureIds,{silent:!0}),t.store.render()),e):(n===h.DIRECT_SELECT&&e.getMode()===h.DIRECT_SELECT&&o.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(n,o,{silent:!0}),e)},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:!0}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),e},e.setFeatureProperty=function(n,o,r){return t.store.setFeatureProperty(n,o,r),e},e}(n,e),n.api=e;var o=nt(n);return e.onAdd=o.onAdd,e.onRemove=o.onRemove,e.types=p,e.options=t,e};function _e(t){me(t,this)}return _e.modes=ue,_e.constants=E,_e.lib=ve,_e}));
//# sourceMappingURL=mapbox-gl-draw.js.map
</script>
<script>// This code is derived from the ISC-licensed "mapbox-gl-draw-freehand-mode" plugin
// by Ben Ehmke, Eric Dong, and Joe Woodhouse.
// Source: https://github.com/bemky/mapbox-gl-draw-freehand-mode
(function (MapboxDraw) {
    const { geojsonTypes, cursors, types, updateActions, modes, events } =
        MapboxDraw.constants;

    const FreehandMode = {};

    FreehandMode.onSetup = function () {
        const polygon = this.newFeature({
            type: geojsonTypes.FEATURE,
            properties: {},
            geometry: {
                type: geojsonTypes.POLYGON,
                coordinates: [[]],
            },
        });

        this.addFeature(polygon);
        this.clearSelectedFeatures();

        // Disable map dragging
        setTimeout(() => {
            if (!this.map || !this.map.dragPan) return;
            this.map.dragPan.disable();
        }, 0);

        this.updateUIClasses({ mouse: cursors.ADD });
        this.activateUIButton(types.POLYGON);
        this.setActionableState({
            trash: true,
        });

        return {
            polygon,
            currentVertexPosition: 0,
            dragMoving: false,
            isDrawing: false,
        };
    };

    FreehandMode.onDrag = FreehandMode.onTouchMove = function (state, e) {
        state.dragMoving = true;
        state.isDrawing = true;
        this.updateUIClasses({ mouse: cursors.ADD });
        state.polygon.updateCoordinate(
            `0.${state.currentVertexPosition}`,
            e.lngLat.lng,
            e.lngLat.lat,
        );
        state.currentVertexPosition++;
        state.polygon.updateCoordinate(
            `0.${state.currentVertexPosition}`,
            e.lngLat.lng,
            e.lngLat.lat,
        );
    };

    FreehandMode.onMouseUp = function (state) {
        if (state.dragMoving) {
            this.simplify(state.polygon);
            this.updateUIClasses({ mouse: cursors.MOVE });
            this.fireUpdate();
            this.changeMode(modes.SIMPLE_SELECT, {
                featureIds: [state.polygon.id],
            });
        }
    };

    FreehandMode.fireCreate = function (polygon) {
        this.map.fire(events.CREATE, {
            features: [polygon.toGeoJSON()],
        });
    };

    FreehandMode.fireUpdate = function () {
        this.map.fire(events.UPDATE, {
            action: updateActions.MOVE,
            features: this.getSelected().map((f) => f.toGeoJSON()),
        });
    };

    FreehandMode.simplify = function (polygon) {
        if (!this.map.simplify_freehand) return;

        const tolerance = 1 / Math.pow(1.05, 10 * this.map.getZoom());
        const simplifiedCoords = simplifyGeometry(
            polygon.coordinates[0],
            tolerance,
        );
        polygon.setCoordinates([simplifiedCoords]);
    };

    function simplifyGeometry(points, tolerance) {
        if (points.length <= 2) return points;

        const sqTolerance = tolerance * tolerance;
        const last = points.length - 1;
        const simplified = [points[0]];
        simplifyDPStep(points, 0, last, sqTolerance, simplified);
        simplified.push(points[last]);

        return simplified;
    }

    function simplifyDPStep(points, first, last, sqTolerance, simplified) {
        let maxSqDist = sqTolerance;
        let index;

        for (let i = first + 1; i < last; i++) {
            const sqDist = getSquareSegmentDistance(
                points[i],
                points[first],
                points[last],
            );
            if (sqDist > maxSqDist) {
                index = i;
                maxSqDist = sqDist;
            }
        }

        if (maxSqDist > sqTolerance) {
            if (index - first > 1)
                simplifyDPStep(points, first, index, sqTolerance, simplified);
            simplified.push(points[index]);
            if (last - index > 1)
                simplifyDPStep(points, index, last, sqTolerance, simplified);
        }
    }

    function getSquareSegmentDistance(p, p1, p2) {
        let x = p1[0],
            y = p1[1];
        let dx = p2[0] - x,
            dy = p2[1] - y;

        if (dx !== 0 || dy !== 0) {
            const t = ((p[0] - x) * dx + (p[1] - y) * dy) / (dx * dx + dy * dy);
            if (t > 1) {
                x = p2[0];
                y = p2[1];
            } else if (t > 0) {
                x += dx * t;
                y += dy * t;
            }
        }

        dx = p[0] - x;
        dy = p[1] - y;

        return dx * dx + dy * dy;
    }

    FreehandMode.onStop = function (state) {
        this.updateUIClasses({ mouse: cursors.NONE });
        this.activateUIButton();

        // Enable map dragging
        setTimeout(() => {
            if (!this.map || !this.map.dragPan) return;
            this.map.dragPan.enable();
        }, 0);
    };

    FreehandMode.toDisplayFeatures = function (state, geojson, display) {
        const isActivePolygon = geojson.properties.id === state.polygon.id;
        geojson.properties.active = isActivePolygon ? "true" : "false";
        if (!isActivePolygon) return display(geojson);

        // Only render the polygon if it has at least three points
        if (geojson.geometry.coordinates[0].length < 3) return;

        const coordinateCount = geojson.geometry.coordinates[0].length;

        // If we have fewer than three coordinates, we need to create a LineString instead of a Polygon
        if (coordinateCount < 3) {
            const lineCoordinates = [
                [
                    geojson.geometry.coordinates[0][0][0],
                    geojson.geometry.coordinates[0][0][1],
                ],
                [
                    geojson.geometry.coordinates[0][1][0],
                    geojson.geometry.coordinates[0][1][1],
                ],
            ];
            return display({
                type: geojsonTypes.FEATURE,
                properties: geojson.properties,
                geometry: {
                    coordinates: lineCoordinates,
                    type: geojsonTypes.LINE_STRING,
                },
            });
        }

        return display(geojson);
    };

    FreehandMode.onTrash = function (state) {
        this.deleteFeature([state.polygon.id], { silent: true });
        this.changeMode(modes.SIMPLE_SELECT);
    };

    MapboxDraw.modes.draw_freehand = FreehandMode;
})(MapboxDraw);
</script>
<style type="text/css">
.mapboxgl-ctrl-geocoder,
.mapboxgl-ctrl-geocoder *,
.mapboxgl-ctrl-geocoder *:after,
.mapboxgl-ctrl-geocoder *:before {
box-sizing: border-box;
}
.mapboxgl-ctrl-geocoder {
font-size: 18px;
line-height: 24px;
font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, Helvetica, sans-serif;
position: relative;
background-color: #fff;
width: 100%;
min-width: 240px;
z-index: 1;
border-radius: 4px;
transition: width .25s, min-width .25s;
}
.mapboxgl-ctrl-geocoder--input {
font: inherit;
width: 100%;
border: 0;
background-color: transparent;
margin: 0;
height: 50px;
color: #404040; 
color: rgba(0, 0, 0, 0.75);
padding: 6px 45px;
text-overflow: ellipsis;
white-space: nowrap;
overflow: hidden;
}
.mapboxgl-ctrl-geocoder--input::-ms-clear {
display: none; 
}
.mapboxgl-ctrl-geocoder--input:focus {
color: #404040; 
color: rgba(0, 0, 0, 0.75);
outline: 0;
box-shadow: none;
outline: thin dotted;
}
.mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--pin-right > * {
z-index: 2;
position: absolute;
right: 8px;
top: 7px;
display: none;
}
.mapboxgl-ctrl-geocoder,
.mapboxgl-ctrl-geocoder .suggestions {
box-shadow: 0 0 10px 2px rgba(0,0,0,.1);
}

.mapboxgl-ctrl-geocoder.mapboxgl-ctrl-geocoder--collapsed {
width: 50px;
min-width: 50px;
transition: width .25s, min-width .25s;
}

.mapboxgl-ctrl-geocoder .suggestions {
background-color: #fff;
border-radius: 4px;
left: 0;
list-style: none;
margin: 0;
padding: 0;
position: absolute;
width: 100%;
top: 110%; 
top: calc(100% + 6px);
z-index: 1000;
overflow: hidden;
font-size: 15px;
}
.mapboxgl-ctrl-bottom-left .suggestions,
.mapboxgl-ctrl-bottom-right .suggestions {
top: auto;
bottom: 100%;
}
.mapboxgl-ctrl-geocoder .suggestions > li > a {
cursor: default;
display: block;
padding: 6px 12px;
color: #404040;
}
.mapboxgl-ctrl-geocoder .suggestions > .active > a,
.mapboxgl-ctrl-geocoder .suggestions > li > a:hover {
color: #404040;
background-color: #f3f3f3;
text-decoration: none;
cursor: pointer;
}
.mapboxgl-ctrl-geocoder--suggestion-title {
font-weight: bold;
}
.mapboxgl-ctrl-geocoder--suggestion-title,
.mapboxgl-ctrl-geocoder--suggestion-address {
text-overflow: ellipsis;
overflow: hidden;
white-space: nowrap;
}

.mapboxgl-ctrl-geocoder--icon {
display: inline-block;
vertical-align: middle;
speak: none;
fill: #757575;
top: 15px;
}
.mapboxgl-ctrl-geocoder--icon-search {
position: absolute;
top: 13px;
left: 12px;
width: 23px;
height: 23px;
}
.mapboxgl-ctrl-geocoder--button {
padding: 0;
margin: 0;
border: none;
cursor: pointer;
background: #fff;
line-height: 1;
}
.mapboxgl-ctrl-geocoder--icon-close {
width: 20px;
height: 20px;
margin-top: 8px;
margin-right: 3px;
}
.mapboxgl-ctrl-geocoder--button:hover .mapboxgl-ctrl-geocoder--icon-close {
fill: #909090;
}
.mapboxgl-ctrl-geocoder--icon-geolocate {
width: 22px;
height: 22px;
margin-top: 6px;
margin-right: 3px;
}
.mapboxgl-ctrl-geocoder--icon-loading {
width: 26px;
height: 26px;
margin-top: 5px;
margin-right: 0px;
-moz-animation: rotate 0.8s infinite cubic-bezier(0.45, 0.05, 0.55, 0.95);
-webkit-animation: rotate 0.8s infinite cubic-bezier(0.45, 0.05, 0.55, 0.95);
animation: rotate 0.8s infinite cubic-bezier(0.45, 0.05, 0.55, 0.95);
}
.mapboxgl-ctrl-geocoder--powered-by {
display: block;
float: left;
padding: 6px 12px;
padding-bottom: 9px;
font-size: 13px;
}
.mapboxgl-ctrl-geocoder--powered-by a {
color: #909090;
}
.mapboxgl-ctrl-geocoder--powered-by a:not(:hover) {
text-decoration: none; }

@-webkit-keyframes rotate {
from {
-webkit-transform: rotate(0);
transform: rotate(0);
}
to {
-webkit-transform: rotate(360deg);
transform: rotate(360deg);
}
}
@keyframes rotate {
from {
-webkit-transform: rotate(0);
transform: rotate(0);
}
to {
-webkit-transform: rotate(360deg);
transform: rotate(360deg);
}
}

@media screen and (min-width: 640px) {
.mapboxgl-ctrl-geocoder.mapboxgl-ctrl-geocoder--collapsed {
width: 36px;
min-width: 36px;
}
.mapboxgl-ctrl-geocoder {
width: 33.3333%;
font-size: 15px;
line-height: 20px;
max-width: 360px;
}
.mapboxgl-ctrl-geocoder .suggestions {
font-size: 13px;
}
.mapboxgl-ctrl-geocoder--icon {
top: 8px;
}
.mapboxgl-ctrl-geocoder--icon-close {
width: 16px;
height: 16px;
margin-top: 3px;
margin-right: 0;
}
.mapboxgl-ctrl-geocoder--icon-geolocate {
width: 18px;
height: 18px;
margin-top: 2px;
margin-right: 0;
}
.mapboxgl-ctrl-geocoder--icon-search {
left: 7px;
width: 20px;
height: 20px;
}
.mapboxgl-ctrl-geocoder--input {
height: 36px;
padding: 6px 35px;
}
.mapboxgl-ctrl-geocoder--icon-loading {
width: 26px;
height: 26px;
margin-top: -2px;
margin-right: -5px;
}
.mapbox-gl-geocoder--error{
color:#909090;
padding: 6px 12px;
font-size: 16px;
text-align: center;
}
.mapboxgl-ctrl-geocoder--powered-by {
font-size: 11px !important;
}
}
</style>
<script>!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.MapboxGeocoder=t()}}(function(){var t;return function(){function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){return r(e[s][1][t]||t)},l,l.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}return t}()({1:[function(t,e,n){"use strict";function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}var o=t("nanoid").nanoid;r.prototype={select:function(t,e){var n=this.getSelectedIndex(t,e),i=this.getEventPayload("search.select",e);if(i.resultIndex=n,i.resultPlaceName=t.place_name,i.resultId=t.id,(n!==this.lastSentIndex||i.queryString!==this.lastSentInput)&&-1!=n&&(this.lastSentIndex=n,this.lastSentInput=i.queryString,i.queryString))return this.push(i)},start:function(t){var e=this.getEventPayload("search.start",t);if(e.queryString)return this.push(e)},keyevent:function(t,e){if(t.key&&!t.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(t.keyCode)){var n=this.getEventPayload("search.keystroke",e);if(n.lastAction=t.key,n.queryString)return this.push(n)}},send:function(t,e){if(this.enableEventLogging){var n=this.getRequestOptions(t);this.request(n,function(t){return t?this.handleError(t,e):e?e():void 0}.bind(this))}else if(e)return e()},getRequestOptions:function(t){return Array.isArray(t)||(t=[t]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}},getEventPayload:function(t,e){var n;n=e.options.proximity?"object"===i(e.options.proximity)?[e.options.proximity.longitude,e.options.proximity.latitude]:"ip"===e.options.proximity?[999,999]:e.options.proximity:null;var r=e._map?e._map.getZoom():void 0,o={event:t,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:e.options.autocomplete,fuzzyMatch:e.options.fuzzyMatch,proximity:n,limit:e.options.limit,routing:e.options.routing,worldview:e.options.worldview,mapZoom:r,keyboardLocale:this.locale};return"search.select"===t?o.queryString=e.inputString:"search.select"!=t&&e._inputEl?o.queryString=e._inputEl.value:o.queryString=e.inputString,o},request:function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState)return e(204==this.status?null:this.statusText)},n.open(t.method,t.host+"/"+t.path,!0);for(var i in t.headers){var r=t.headers[i];n.setRequestHeader(i,r)}n.send(t.body)},handleError:function(t,e){if(e)return e(t)},generateSessionID:function(){return o()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,e){if(e._typeahead){var n=e._typeahead.data,i=t.id;return n.map(function(t){return t.id}).indexOf(i)}},shouldEnableLogging:function(t){return!1!==t.enableEventLogging&&((!t.origin||-1!=t.origin.indexOf("api.mapbox.com"))&&(!t.localGeocoder&&!t.filter))},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,e){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||e)&&this.flush()},remove:function(){this.flush()}},e.exports=r},{nanoid:32}],2:[function(t,e,n){"use strict";e.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},{}],3:[function(t,e,n){"use strict";function i(){}i.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){var t={enableHighAccuracy:!0};return new Promise(function(e,n){window.navigator.geolocation.getCurrentPosition(e,n,t)})}},e.exports=i},{}],4:[function(t,e,n){"use strict";function i(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function r(t){this._eventEmitter=new u,this.options=a({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new g}var o=t("suggestions"),s=t("lodash.debounce"),a=t("xtend"),u=t("events").EventEmitter,c=t("./exceptions"),l=t("@mapbox/mapbox-sdk"),h=t("@mapbox/mapbox-sdk/services/geocoding"),p=t("./events"),f=t("./localization"),d=t("subtag"),g=t("./geolocation"),m=t("./utils"),y={FORWARD:0,LOCAL:1,REVERSE:2};r.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(t){return t.place_name},render:function(t){var e=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},addTo:function(t){function e(t,e){if(!document.body.contains(e))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var n=t.onAdd();e.appendChild(n)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)e(this,t);else{if("string"!=typeof t)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");var n=document.querySelectorAll(t);if(0===n.length)throw new Error("Element ",t,"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,n[0])}},onAdd:function(t){if(t&&"string"!=typeof t&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=h(l({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new p(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",s(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(t){this.eventManager.keyevent(t,this)}.bind(this));var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var a=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(a),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),e.appendChild(n),e.appendChild(this._inputEl),e.appendChild(r),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var u=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(u),r.appendChild(this._geolocateEl),this._showGeolocateButton()}var c=this._typeahead=new o(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),c.getItemValue=this.options.getItemValue;var f=c.list.draw,d=this._footerNode=i();return c.list.draw=function(){f.call(this),d.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),d.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(d)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(t){this._hideLoadingIcon();var e={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(e),this._fly(e),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(e),this._showClearButton(),this.fresh=!1;var n={limit:1,language:[this.options.language],query:e.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){var i=e.geometry.coordinates[0]+","+e.geometry.coordinates[1];this._setInputValue(i),this._eventEmitter.emit("result",{result:e})}else this.geocoderService.reverseGeocode(n).send().then(function(t){var n=t.body.features[0];if(n){var i=m.transformFeatureToGeolocationText(n,this.options.addressAccuracy);this._setInputValue(i),n.user_coordinates=e.geometry.coordinates,this._eventEmitter.emit("result",{result:n})}else this._eventEmitter.emit("result",{result:{user_coordinates:e.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(t){1===t.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width",18),n.setAttribute("height",18),n.innerHTML=e,n},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(t){var e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(t){if(27===t.keyCode&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var e=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target;if(!(e?e.value:""))return this.fresh=!0,9!==t.keyCode&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),t.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(t.keyCode)||e.value.length>=this.options.minLength&&this._geocode(e.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var e;if(t.properties&&c[t.properties.short_code])e=a({},this.options.flyTo),this._map&&this._map.fitBounds(c[t.properties.short_code].bbox,e);else if(t.bbox){var n=t.bbox;e=a({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],e)}else{var i={zoom:this.options.zoom};e=a({},i,this.options.flyTo),t.center?e.center=t.center:t.geometry&&t.geometry.type&&"Point"===t.geometry.type&&t.geometry.coordinates&&(e.center=t.geometry.coordinates),this._map&&this._map.flyTo(e)}},_requestType:function(t,e){var n=/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;return t.localGeocoderOnly?y.LOCAL:t.reverseGeocode&&n.test(e)?y.REVERSE:y.FORWARD},_setupConfig:function(t,e){var n=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],i=/[\s,]+/,r=this,o=n.reduce(function(t,e){if(void 0===r.options[e]||null===r.options[e])return t;["countries","types","language"].indexOf(e)>-1?t[e]=r.options[e].split(i):t[e]=r.options[e];var n="number"==typeof r.options[e].longitude&&"number"==typeof r.options[e].latitude;if("proximity"===e&&n){var o=r.options[e].longitude,s=r.options[e].latitude;t[e]=[o,s]}return t},{});switch(t){case y.REVERSE:var s=e.split(i).map(function(t){return parseFloat(t,10)});r.options.flipCoordinates||s.reverse(),o.types&&o.types[0],o=a(o,{query:s,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(t){t in o&&delete o[t]});break;case y.FORWARD:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(e)&&(e=e.replace(/,/g," ")),o=a(o,{query:e})}return o},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});var e,n=this._requestType(this.options,t),i=this._setupConfig(n,t);switch(n){case y.LOCAL:e=Promise.resolve();break;case y.FORWARD:e=this.geocoderService.forwardGeocode(i).send();break;case y.REVERSE:e=this.geocoderService.reverseGeocode(i).send()}var r=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],o=[],s=null;return e.catch(function(t){s=t}.bind(this)).then(function(e){this._hideLoadingIcon();var n={};return e?"200"==e.statusCode&&(n=e.body,n.request=e.request,n.headers=e.headers):n={type:"FeatureCollection",features:[]},n.config=i,this.fresh&&(this.eventManager.start(this),this.fresh=!1),n.features=n.features?r.concat(n.features):r,this.options.externalGeocoder?(o=this.options.externalGeocoder(t,n.features)||Promise.resolve([]),o.then(function(t){return n.features=n.features?t.concat(n.features):t,n},function(){return n})):n}.bind(this)).then(function(t){if(s)throw s;this.options.filter&&t.features.length&&(t.features=t.features.filter(this.options.filter)),t.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",t),this._typeahead.update(t.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",t))}.bind(this)).catch(function(t){this._hideLoadingIcon(),this._hideAttribution(),r.length&&this.options.localGeocoder||o.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(r)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:r}),this._eventEmitter.emit("error",{error:t})}.bind(this)),e},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var e=this;t.relatedTarget&&e._clear(t)},_onQueryResult:function(t){var e=t.body;if(e.features.length){var n=e.features[0];this._typeahead.selected=n,this._inputEl.value=n.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){this._inputEl.value||this._inputEl===document.activeElement||this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],e=d.language(t),n=f.placeholder[e];if(n)return n}return"Search"},setInput:function(t){return this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&this._geocode(t),this},setProximity:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.options.proximity=t,e&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&"function"==typeof t&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=h(l({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=h(l({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var e={color:"#4668F2"},n=a({},e,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(n),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&"Point"===t.geometry.type&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,e){return this._eventEmitter.on(t,e),this},off:function(t,e){return this._eventEmitter.removeListener(t,e),this.eventManager.remove(),this}},e.exports=r},{"./events":1,"./exceptions":2,"./geolocation":3,"./localization":5,"./utils":6,"@mapbox/mapbox-sdk":8,"@mapbox/mapbox-sdk/services/geocoding":19,events:28,"lodash.debounce":31,subtag:35,suggestions:36,xtend:39}],5:[function(t,e,n){"use strict";var i={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""};e.exports={placeholder:i}},{}],6:[function(t,e,n){"use strict";function i(t,e){var n,i=r(t),o=["address","street","place","country"];if("function"==typeof e)return e(i);var s=o.indexOf(e);return n=-1===s?o:o.slice(s),n.reduce(function(t,e){return i[e]?(""!==t&&(t+=", "),t+i[e]):t},"")}function r(t){var e=t.address||"",n=t.text||"",i=t.place_name||"",r=i.split(",")[0],o={address:r,houseNumber:e,street:n,placeName:i};return t.context.forEach(function(t){var e=t.id.split(".")[0];o[e]=t.text}),o}e.exports={transformFeatureToGeolocationText:i,getAddressInfo:r}},{}],7:[function(t,e,n){"use strict";function i(t){var e=Array.isArray(t),n=function(n){return e?t[n]:t};return function(i){var o=r(g.plainArray,i);if(o)return o;if(e&&i.length!==t.length)return"an array with "+t.length+" items";for(var s=0;s<i.length;s++)if(o=r(n(s),i[s]))return[s].concat(o)}}function r(t,e){if(null!=e||t.hasOwnProperty("__required")){var n=t(e);return n?Array.isArray(n)?n:[n]:void 0}}function o(t,e){var n=t.length,i=t[n-1],r=t.slice(0,n-1);return 0===r.length&&(r=[d]),e=f(e,{path:r}),"function"==typeof i?i(e):c(e,a(i))}function s(t){return t.length<2?t[0]:2===t.length?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function a(t){return"must be "+u(t)+"."}function u(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function c(t,e){var n=l(t.path),i=t.path.join(".")+" "+e;return(n?"Item at position ":"")+i}function l(t){return"number"==typeof t[t.length-1]||"number"==typeof t[0]}function h(t){return Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}})}var p=t("is-plain-obj"),f=t("xtend"),d="value",g={};g.assert=function(t,e){return e=e||{},function(n){var i=r(t,n);if(i){var s=o(i,e);throw e.apiName&&(s=e.apiName+": "+s),new Error(s)}}},g.shape=function(t){var e=h(t);return function(t){var n=r(g.plainObject,t);if(n)return n;for(var i,s,a=[],u=0;u<e.length;u++)i=e[u].key,s=e[u].value,(n=r(s,t[i]))&&a.push([i].concat(n));return a.length<2?a[0]:function(t){a=a.map(function(e){return"- "+e[0]+": "+o(e,t).split("\n").join("\n  ")});var e=t.path.join(".");return"The following properties"+(e===d?"":" of "+e)+" have invalid values:\n  "+a.join("\n  ")}}},g.strictShape=function(t){var e=g.shape(t);return function(n){var i=e(n);if(i)return i;var r=Object.keys(n).reduce(function(e,n){return void 0===t[n]&&e.push(n),e},[]);return 0!==r.length?function(){return"The following keys are invalid: "+r.join(", ")}:void 0}},g.arrayOf=function(t){return i(t)},g.tuple=function(){return i(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},g.required=function(t){function e(e){return null==e?function(t){return c(t,l(t.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return e.__required=!0,e},g.oneOfType=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(e){var n=t.map(function(t){return r(t,e)}).filter(Boolean);if(n.length===t.length)return n.every(function(t){return 1===t.length&&"string"==typeof t[0]})?s(n.map(function(t){return t[0]})):n.reduce(function(t,e){return e.length>t.length?e:t})}},g.equal=function(t){return function(e){if(e!==t)return JSON.stringify(t)}},g.oneOf=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),e=t.map(function(t){return g.equal(t)});return g.oneOfType.apply(this,e)},g.range=function(t){var e=t[0],n=t[1];return function(t){if(r(g.number,t)||t<e||t>n)return"number between "+e+" & "+n+" (inclusive)"}},g.any=function(){},g.boolean=function(t){if("boolean"!=typeof t)return"boolean"},g.number=function(t){if("number"!=typeof t)return"number"},g.plainArray=function(t){if(!Array.isArray(t))return"array"},g.plainObject=function(t){if(!p(t))return"object"},g.string=function(t){if("string"!=typeof t)return"string"},g.func=function(t){if("function"!=typeof t)return"function"},g.validate=r,g.processMessage=o,e.exports=g},{"is-plain-obj":30,xtend:39}],8:[function(t,e,n){"use strict";var i=t("./lib/client");e.exports=i},{"./lib/client":9}],9:[function(t,e,n){"use strict";function i(t){s.call(this,t)}function r(t){return new i(t)}var o=t("./browser-layer"),s=t("../classes/mapi-client");i.prototype=Object.create(s.prototype),i.prototype.constructor=i,i.prototype.sendRequest=o.browserSend,i.prototype.abortRequest=o.browserAbort,e.exports=r},{"../classes/mapi-client":11,"./browser-layer":10}],10:[function(t,e,n){"use strict";function i(t){var e=f[t.id];e&&(e.abort(),delete f[t.id])}function r(t,e){return new c(t,{body:e.response,headers:p(e.getAllResponseHeaders()),statusCode:e.status})}function o(t){var e=t.total,n=t.loaded;return{total:e,transferred:n,percent:100*n/e}}function s(t,e){return new Promise(function(n,i){e.onprogress=function(e){t.emitter.emit(h.EVENT_PROGRESS_DOWNLOAD,o(e))};var r=t.file;r&&(e.upload.onprogress=function(e){t.emitter.emit(h.EVENT_PROGRESS_UPLOAD,o(e))}),e.onerror=function(t){i(t)},e.onabort=function(){var e=new l({request:t,type:h.ERROR_REQUEST_ABORTED});i(e)},e.onload=function(){if(delete f[t.id],e.status<200||e.status>=400){var r=new l({request:t,body:e.response,statusCode:e.status});return void i(r)}n(e)};var s=t.body;"string"==typeof s?e.send(s):s?e.send(JSON.stringify(s)):r?e.send(r):e.send(),f[t.id]=e}).then(function(e){return r(t,e)})}function a(t,e){var n=t.url(e),i=new window.XMLHttpRequest;return i.open(t.method,n),Object.keys(t.headers).forEach(function(e){i.setRequestHeader(e,t.headers[e])}),i}function u(t){return Promise.resolve().then(function(){var e=a(t,t.client.accessToken);return s(t,e)})}var c=t("../classes/mapi-response"),l=t("../classes/mapi-error"),h=t("../constants"),p=t("../helpers/parse-headers"),f={};e.exports={browserAbort:i,sendRequestXhr:s,browserSend:u,createRequestXhr:a}},{"../classes/mapi-error":12,"../classes/mapi-response":14,"../constants":15,"../helpers/parse-headers":16}],11:[function(t,e,n){"use strict";function i(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");r(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||s.API_ORIGIN}var r=t("@mapbox/parse-mapbox-token"),o=t("./mapi-request"),s=t("../constants");i.prototype.createRequest=function(t){return new o(this,t)},e.exports=i},{"../constants":15,"./mapi-request":13,"@mapbox/parse-mapbox-token":25}],12:[function(t,e,n){"use strict";function i(t){var e,n=t.type||r.ERROR_HTTP;if(t.body)try{e=JSON.parse(t.body)}catch(n){e=t.body}else e=null;var i=t.message||null
;i||("string"==typeof e?i=e:e&&"string"==typeof e.message?i=e.message:n===r.ERROR_REQUEST_ABORTED&&(i="Request aborted")),this.message=i,this.type=n,this.statusCode=t.statusCode||null,this.request=t.request,this.body=e}var r=t("../constants");e.exports=i},{"../constants":15}],13:[function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var n={};e.body&&(n["content-type"]="application/json");var i=o(n,e.headers),r=Object.keys(i).reduce(function(t,e){return t[e.toLowerCase()]=i[e],t},{});this.id=c++,this._options=e,this.emitter=new s,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||t.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=r}var r=t("@mapbox/parse-mapbox-token"),o=t("xtend"),s=t("eventemitter3"),a=t("../helpers/url-utils"),u=t("../constants"),c=1;i.prototype.url=function(t){var e=a.prependOrigin(this.path,this.origin);e=a.appendQueryObject(e,this.query);var n=this.params,i=null==t?this.client.accessToken:t;if(i){e=a.appendQueryParam(e,"access_token",i);var s=r(i).user;n=o({ownerId:s},n)}return e=a.interpolateRouteParams(e,n),e},i.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(e){return t.response=e,t.emitter.emit(u.EVENT_RESPONSE,e),e},function(e){throw t.error=e,t.emitter.emit(u.EVENT_ERROR,e),e})},i.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),this.response||this.error||this.aborted||(this.aborted=!0,this.client.abortRequest(this))},i.prototype.eachPage=function(t){function e(e){function n(){delete r._nextPageRequest;var t=e.nextPage();t&&(r._nextPageRequest=t,i(t))}t(null,e,n)}function n(e){t(e,null,function(){})}function i(t){t.send().then(e,n)}var r=this;i(this)},i.prototype.clone=function(){return this._extend()},i.prototype._extend=function(t){var e=o(this._options,t);return new i(this.client,e)},e.exports=i},{"../constants":15,"../helpers/url-utils":18,"@mapbox/parse-mapbox-token":25,eventemitter3:27,xtend:39}],14:[function(t,e,n){"use strict";function i(t,e){this.request=t,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch(t){this.body=e.body}this.links=r(this.headers.link)}var r=t("../helpers/parse-link-header");i.prototype.hasNextPage=function(){return!!this.links.next},i.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},e.exports=i},{"../helpers/parse-link-header":17}],15:[function(t,e,n){"use strict";e.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},{}],16:[function(t,e,n){"use strict";function i(t){var e=t.indexOf(":");return{name:t.substring(0,e).trim().toLowerCase(),value:t.substring(e+1).trim()}}function r(t){var e={};return t?(t.trim().split(/[\r|\n]+/).forEach(function(t){var n=i(t);e[n.name]=n.value}),e):e}e.exports=r},{}],17:[function(t,e,n){"use strict";function i(t){var e=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function r(t){var e=t.match(/<?([^>]*)>(.*)/);if(!e)return null;var n=e[1],r=e[2].split(";"),o=null,s=r.reduce(function(t,e){var n=i(e);return n?"rel"===n.key?(o||(o=n.value),t):(t[n.key]=n.value,t):t},{});return o?{url:n,rel:o,params:s}:null}function o(t){return t?t.split(/,\s*</).reduce(function(t,e){var n=r(e);return n?(n.rel.split(/\s+/).forEach(function(e){t[e]||(t[e]={url:n.url,params:n.params})}),t):t},{}):{}}e.exports=o},{}],18:[function(t,e,n){"use strict";function i(t){return t.map(encodeURIComponent).join(",")}function r(t){return Array.isArray(t)?i(t):encodeURIComponent(String(t))}function o(t,e,n){if(!1===n||null===n)return t;var i=/\?/.test(t)?"&":"?",o=encodeURIComponent(e);return void 0!==n&&""!==n&&!0!==n&&(o+="="+r(n)),""+t+i+o}function s(t,e){if(!e)return t;var n=t;return Object.keys(e).forEach(function(t){var i=e[t];void 0!==i&&(Array.isArray(i)&&(i=i.filter(function(t){return null!==t&&void 0!==t}).join(",")),n=o(n,t,i))}),n}function a(t,e){if(!e)return t;if("http"===t.slice(0,4))return t;var n="/"===t[0]?"":"/";return""+e.replace(/\/$/,"")+n+t}function u(t,e){return e?t.replace(/\/:([a-zA-Z0-9]+)/g,function(t,n){var i=e[n];if(void 0===i)throw new Error("Unspecified route parameter "+n);return"/"+r(i)}):t}e.exports={appendQueryObject:s,appendQueryParam:o,prependOrigin:a,interpolateRouteParams:u}},{}],19:[function(t,e,n){"use strict";var i=t("xtend"),r=t("./service-helpers/validator"),o=t("./service-helpers/pick"),s=t("./service-helpers/stringify-booleans"),a=t("./service-helpers/create-service-factory"),u={},c=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];u.forwardGeocode=function(t){r.assertShape({query:r.required(r.string),mode:r.oneOf("mapbox.places","mapbox.places-permanent"),countries:r.arrayOf(r.string),proximity:r.oneOf(r.coordinates,"ip"),types:r.arrayOf(r.oneOf(c)),autocomplete:r.boolean,bbox:r.arrayOf(r.number),limit:r.number,language:r.arrayOf(r.string),routing:r.boolean,fuzzyMatch:r.boolean,worldview:r.string})(t),t.mode=t.mode||"mapbox.places";var e=s(i({country:t.countries},o(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(t,["mode","query"]),query:e})},u.reverseGeocode=function(t){r.assertShape({query:r.required(r.coordinates),mode:r.oneOf("mapbox.places","mapbox.places-permanent"),countries:r.arrayOf(r.string),types:r.arrayOf(r.oneOf(c)),bbox:r.arrayOf(r.number),limit:r.number,language:r.arrayOf(r.string),reverseMode:r.oneOf("distance","score"),routing:r.boolean,worldview:r.string})(t),t.mode=t.mode||"mapbox.places";var e=s(i({country:t.countries},o(t,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:o(t,["mode","query"]),query:e})},e.exports=a(u)},{"./service-helpers/create-service-factory":20,"./service-helpers/pick":22,"./service-helpers/stringify-booleans":23,"./service-helpers/validator":24,xtend:39}],20:[function(t,e,n){"use strict";function i(t){return function(e){var n;n=r.prototype.isPrototypeOf(e)?e:o(e);var i=Object.create(t);return i.client=n,i}}var r=t("../../lib/classes/mapi-client"),o=t("../../lib/client");e.exports=i},{"../../lib/classes/mapi-client":11,"../../lib/client":9}],21:[function(t,e,n){"use strict";function i(t,e){return Object.keys(t).reduce(function(n,i){return n[i]=e(i,t[i]),n},{})}e.exports=i},{}],22:[function(t,e,n){"use strict";function i(t,e){var n=function(t,n){return-1!==e.indexOf(t)&&void 0!==n};return"function"==typeof e&&(n=e),Object.keys(t).filter(function(e){return n(e,t[e])}).reduce(function(e,n){return e[n]=t[n],e},{})}e.exports=i},{}],23:[function(t,e,n){"use strict";function i(t){return r(t,function(t,e){return"boolean"==typeof e?JSON.stringify(e):e})}var r=t("./object-map");e.exports=i},{"./object-map":21}],24:[function(t,e,n){(function(n){(function(){"use strict";function i(t){if("undefined"!=typeof window){if(t instanceof n.Blob||t instanceof n.ArrayBuffer)return;return"Blob or ArrayBuffer"}if("string"!=typeof t&&void 0===t.pipe)return"Filename or Readable stream"}function r(t,e){return u.assert(u.strictShape(t),e)}function o(t){if("boolean"==typeof t)return"date";try{var e=new Date(t);if(e.getTime&&isNaN(e.getTime()))return"date"}catch(t){return"date"}}function s(t){return u.tuple(u.number,u.number)(t)}var a=t("xtend"),u=t("@mapbox/fusspot");e.exports=a(u,{file:i,date:o,coordinates:s,assertShape:r})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"@mapbox/fusspot":7,xtend:39}],25:[function(t,e,n){"use strict";function i(t){if(a[t])return a[t];var e=t.split("."),n=e[0],i=e[1];if(!i)throw new Error("Invalid token");var s=r(i),u={usage:n,user:s.u};return o(s,"a")&&(u.authorization=s.a),o(s,"exp")&&(u.expires=1e3*s.exp),o(s,"iat")&&(u.created=1e3*s.iat),o(s,"scopes")&&(u.scopes=s.scopes),o(s,"client")&&(u.client=s.client),o(s,"ll")&&(u.lastLogin=s.ll),o(s,"iu")&&(u.impersonator=s.iu),a[t]=u,u}function r(t){try{return JSON.parse(s.decode(t))}catch(t){throw new Error("Invalid token")}}function o(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var s=t("base-64"),a={};e.exports=i},{"base-64":26}],26:[function(e,n,i){(function(e){(function(){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(o){var s="object"==(void 0===i?"undefined":r(i))&&i,a="object"==(void 0===n?"undefined":r(n))&&n&&n.exports==s&&n,u="object"==(void 0===e?"undefined":r(e))&&e;u.global!==u&&u.window!==u||(o=u);var c=function(t){this.message=t};c.prototype=new Error,c.prototype.name="InvalidCharacterError";var l=function(t){throw new c(t)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=/[\t\n\f\r ]/g,f=function(t){t=String(t).replace(p,"");var e=t.length;e%4==0&&(t=t.replace(/==?$/,""),e=t.length),(e%4==1||/[^+a-zA-Z0-9\/]/.test(t))&&l("Invalid character: the string to be decoded is not correctly encoded.");for(var n,i,r=0,o="",s=-1;++s<e;)i=h.indexOf(t.charAt(s)),n=r%4?64*n+i:i,r++%4&&(o+=String.fromCharCode(255&n>>(-2*r&6)));return o},d=function(t){t=String(t),/[^\0-\xFF]/.test(t)&&l("The string to be encoded contains characters outside of the Latin1 range.");for(var e,n,i,r,o=t.length%3,s="",a=-1,u=t.length-o;++a<u;)e=t.charCodeAt(a)<<16,n=t.charCodeAt(++a)<<8,i=t.charCodeAt(++a),r=e+n+i,s+=h.charAt(r>>18&63)+h.charAt(r>>12&63)+h.charAt(r>>6&63)+h.charAt(63&r);return 2==o?(e=t.charCodeAt(a)<<8,n=t.charCodeAt(++a),r=e+n,s+=h.charAt(r>>10)+h.charAt(r>>4&63)+h.charAt(r<<2&63)+"="):1==o&&(r=t.charCodeAt(a),s+=h.charAt(r>>2)+h.charAt(r<<4&63)+"=="),s},g={encode:d,decode:f,version:"0.1.0"};if("function"==typeof t&&"object"==r(t.amd)&&t.amd)t(function(){return g});else if(s&&!s.nodeType)if(a)a.exports=g;else for(var m in g)g.hasOwnProperty(m)&&(s[m]=g[m]);else o.base64=g}(void 0)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(t,e,n){"use strict";function i(){}function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,n,i,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new r(n,i||t,o),a=c?c+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}var u=Object.prototype.hasOwnProperty,c="~";Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(c=!1)),a.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)u.call(t,e)&&n.push(c?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=c?c+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,r=n.length,o=new Array(r);i<r;i++)o[i]=n[i].fn;return o},a.prototype.listenerCount=function(t){var e=c?c+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,i,r,o){var s=c?c+t:t;if(!this._events[s])return!1;var a,u,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,i),!0;case 5:return l.fn.call(l.context,e,n,i,r),!0;case 6:return l.fn.call(l.context,e,n,i,r,o),!0}for(u=1,a=new Array(h-1);u<h;u++)a[u-1]=arguments[u];l.fn.apply(l.context,a)}else{var p,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,n);break;case 4:l[u].fn.call(l[u].context,e,n,i);break;default:if(!a)for(p=1,a=new Array(h-1);p<h;p++)a[p-1]=arguments[p];l[u].fn.apply(l[u].context,a)}}return!0},a.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,n,i){var r=c?c+t:t;if(!this._events[r])return this;if(!e)return s(this,r),this;var o=this._events[r];if(o.fn)o.fn!==e||i&&!o.once||n&&o.context!==n||s(this,r);else{for(var a=0,u=[],l=o.length;a<l;a++)(o[a].fn!==e||i&&!o[a].once||n&&o[a].context!==n)&&u.push(o[a]);u.length?this._events[r]=1===u.length?u[0]:u:s(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=c?c+t:t,this._events[e]&&s(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=c,a.EventEmitter=a,void 0!==e&&(e.exports=a)},{}],28:[function(t,e,n){"use strict";function i(t){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=x(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function o(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function s(t,e,n){if(e)t.call(n);else for(var i=t.length,r=y(t,i),o=0;o<i;++o)r[o].call(n)}function a(t,e,n,i){if(e)t.call(n,i);else for(var r=t.length,o=y(t,r),s=0;s<r;++s)o[s].call(n,i)}function u(t,e,n,i,r){if(e)t.call(n,i,r);else for(var o=t.length,s=y(t,o),a=0;a<o;++a)s[a].call(n,i,r)}function c(t,e,n,i,r,o){if(e)t.call(n,i,r,o);else for(var s=t.length,a=y(t,s),u=0;u<s;++u)a[u].call(n,i,r,o)}function l(t,e,n,i){if(e)t.apply(n,i);else for(var r=t.length,o=y(t,r),s=0;s<r;++s)o[s].apply(n,i)}function h(t,e,n,r){var s,a,u;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(a=t._events,a?(a.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),a=t._events),u=a[e]):(a=t._events=x(null),t._eventsCount=0),u){if("function"==typeof u?u=a[e]=r?[n,u]:[u,n]:r?u.unshift(n):u.push(n),!u.warned&&(s=o(t))&&s>0&&u.length>s){u.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+u.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=u.length,"object"===("undefined"==typeof console?"undefined":i(console))&&console.warn&&console.warn("%s: %s",c.name,c.message)}}else u=a[e]=n,++t._eventsCount;return t}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function f(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=L.call(p,i);return r.listener=n,i.wrapFn=r,r}function d(t,e,n){var i=t._events;if(!i)return[];var r=i[e];return r?"function"==typeof r?n?[r.listener||r]:[r]:n?v(r):y(r,r.length):[]}function g(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function m(t,e){for(var n=e,i=n+1,r=t.length;i<r;n+=1,i+=1)t[n]=t[i];t.pop()}function y(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}function v(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function b(t){var e=function(){};return e.prototype=t,new e}function _(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return n}function w(t){var e=this;return function(){return e.apply(t,arguments)}}var x=Object.create||b,E=Object.keys||_,L=Function.prototype.bind||w;e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0;var O,k=10;try{var A={};Object.defineProperty&&Object.defineProperty(A,"x",{value:0}),O=0===A.x}catch(t){O=!1}O?Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return k},set:function(t){if("number"!=typeof t||t<0||t!==t)throw new TypeError('"defaultMaxListeners" must be a positive number');k=t}}):r.defaultMaxListeners=k,r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return o(this)},r.prototype.emit=function(t){var e,n,i,r,o,h,p="error"===t;if(h=this._events)p=p&&null==h.error;else if(!p)return!1;if(p){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var f=new Error('Unhandled "error" event. ('+e+")");throw f.context=e,f}if(!(n=h[t]))return!1;var d="function"==typeof n;switch(i=arguments.length){case 1:s(n,d,this);break;case 2:a(n,d,this,arguments[1]);break;case 3:u(n,d,this,arguments[1],arguments[2]);break;case 4:c(n,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];l(n,d,this,r)}return!0},r.prototype.addListener=function(t,e){return h(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return h(this,t,e,!0)},r.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,f(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,f(this,t,e)),this},r.prototype.removeListener=function(t,e){var n,i,r,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=x(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():m(n,r),1===n.length&&(i[t]=n[0]),i.removeListener&&this.emit("removeListener",t,s||e)}return this},r.prototype.removeAllListeners=function(t){var e,n,i;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=x(null),this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=x(null):delete n[t]),this;if(0===arguments.length){var r,o=E(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=x(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},r.prototype.listeners=function(t){return d(this,t,!0)},r.prototype.rawListeners=function(t){return d(this,t,!1)},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):g.call(t,e)},r.prototype.listenerCount=g,r.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],29:[function(t,e,n){"use strict";!function(){var t=this,i={};void 0!==n?e.exports=i:t.fuzzy=i,i.simpleFilter=function(t,e){return e.filter(function(e){return i.test(t,e)})},i.test=function(t,e){return null!==i.match(t,e)},i.match=function(t,e,n){n=n||{};var i,r=0,o=[],s=e.length,a=0,u=0,c=n.pre||"",l=n.post||"",h=n.caseSensitive&&e||e.toLowerCase();t=n.caseSensitive&&t||t.toLowerCase();for(var p=0;p<s;p++)i=e[p],h[p]===t[r]?(i=c+i+l,r+=1,u+=1+u):u=0,a+=u,o[o.length]=i;return r===t.length?(a=h===t?1/0:a,{rendered:o.join(""),score:a}):null},i.filter=function(t,e,n){return e&&0!==e.length?"string"!=typeof t?e:(n=n||{},e.reduce(function(e,r,o,s){var a=r;n.extract&&(a=n.extract(r));var u=i.match(t,a,n);return null!=u&&(e[e.length]={string:u.rendered,score:u.score,index:o,original:r}),e},[]).sort(function(t,e){var n=e.score-t.score;return n||t.index-e.index})):[]}}()},{}],30:[function(t,e,n){"use strict";var i=Object.prototype.toString;e.exports=function(t){var e;return"[object Object]"===i.call(t)&&(null===(e=Object.getPrototypeOf(t))||e===Object.getPrototypeOf({}))}},{}],31:[function(t,e,n){(function(t){(function(){"use strict";function n(t){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e,n){function i(e){var n=g,i=m;return g=m=void 0,L=e,v=t.apply(i,n)}function o(t){return L=t,b=setTimeout(l,e),O?i(t):v}function s(t){var n=t-_,i=t-L,r=e-n;return k?x(r,y-i):r}function c(t){var n=t-_,i=t-L;return void 0===_||n>=e||n<0||k&&i>=y}function l(){var t=E();if(c(t))return h(t);b=setTimeout(l,s(t))}function h(t){return b=void 0,A&&g?i(t):(g=m=void 0,v)}function p(){void 0!==b&&clearTimeout(b),L=0,g=_=m=b=void 0}function f(){return void 0===b?v:h(E())}function d(){var t=E(),n=c(t);if(g=arguments,m=this,_=t,n){if(void 0===b)return o(_);if(k)return b=setTimeout(l,e),i(_)}return void 0===b&&(b=setTimeout(l,e)),v}var g,m,y,v,b,_,L=0,O=!1,k=!1,A=!0;if("function"!=typeof t)throw new TypeError(u);return e=a(e)||0,r(n)&&(O=!!n.leading,k="maxWait"in n,y=k?w(a(n.maxWait)||0,e):y,A="trailing"in n?!!n.trailing:A),d.cancel=p,d.flush=f,d}function r(t){var e=n(t);return!!t&&("object"==e||"function"==e)}function o(t){return!!t&&"object"==n(t)}function s(t){return"symbol"==n(t)||o(t)&&_.call(t)==l}function a(t){if("number"==typeof t)return t;if(s(t))return c;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(h,"");var n=f.test(t);return n||d.test(t)?g(t.slice(2),n?2:8):p.test(t)?c:+t}var u="Expected a function",c=NaN,l="[object Symbol]",h=/^\s+|\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,d=/^0o[0-7]+$/i,g=parseInt,m="object"==(void 0===t?"undefined":n(t))&&t&&t.Object===Object&&t,y="object"==("undefined"==typeof self?"undefined":n(self))&&self&&self.Object===Object&&self,v=m||y||Function("return this")(),b=Object.prototype,_=b.toString,w=Math.max,x=Math.min,E=function(){return v.Date.now()};e.exports=i}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],32:[function(t,e,n){(function(n){(function(){"use strict";var i=t("./url-alphabet/index.cjs"),r=i.urlAlphabet;if("production"!==n.env.NODE_ENV){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product&&"undefined"==typeof crypto)throw new Error("React Native does not have a built-in secure random generator. If you dont need unpredictable IDs use `nanoid/non-secure`. For secure IDs, import `react-native-get-random-values` before Nano ID.");if("undefined"!=typeof msCrypto&&"undefined"==typeof crypto)throw new Error("Import file with `if (!window.crypto) window.crypto = window.msCrypto` before importing Nano ID to fix IE 11 support");if("undefined"==typeof crypto)throw new Error("Your browser does not have secure random generator. If you dont need unpredictable IDs, you can use nanoid/non-secure.")}var o=function(t){return crypto.getRandomValues(new Uint8Array(t))},s=function(t,e,n){var i=(2<<Math.log(t.length-1)/Math.LN2)-1,r=-~(1.6*i*e/t.length);return function(){for(var o="";;)for(var s=n(r),a=r;a--;)if(o+=t[s[a]&i]||"",o.length===e)return o}},a=function(t,e){return s(t,e,o)},u=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,e="",n=crypto.getRandomValues(new Uint8Array(t));t--;){var i=63&n[t];e+=i<36?i.toString(36):i<62?(i-26).toString(36).toUpperCase():i<63?"_":"-"}return e};e.exports={nanoid:u,customAlphabet:a,customRandom:s,urlAlphabet:r,random:o}}).call(this)}).call(this,t("_process"))},{"./url-alphabet/index.cjs":33,_process:34}],33:[function(t,e,n){"use strict";e.exports={urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"}},{}],34:[function(t,e,n){"use strict";function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(h===setTimeout)return setTimeout(t,0);if((h===i||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function s(t){if(p===clearTimeout)return clearTimeout(t);if((p===r||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(e){return p.call(this,t)}}}function a(){m&&d&&(m=!1,d.length?g=d.concat(g):y=-1,g.length&&u())}function u(){if(!m){var t=o(a);m=!0;for(var e=g.length;e;){for(d=g,g=[];++y<e;)d&&d[y].run();y=-1,e=g.length}d=null,m=!1,s(t)}}function c(t,e){this.fun=t,this.array=e}function l(){}var h,p,f=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:i}catch(t){h=i}try{p="function"==typeof clearTimeout?clearTimeout:r}catch(t){p=r}}();var d,g=[],m=!1,y=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];g.push(new c(t,e)),1!==g.length||m||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.prependListener=l,f.prependOnceListener=l,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],35:[function(t,e,n){"use strict";!function(t,n,i){void 0!==e&&e.exports?e.exports=i():t.subtag=i()}(void 0,0,function(){function t(t){return t.match(s)||[]}function e(e){return t(e).filter(function(t,e){return t&&e})}function n(e){return e=t(e),{language:e[1]||o,extlang:e[2]||o,script:e[3]||o,region:e[4]||o}}function i(t,e,n){Object.defineProperty(t,e,{value:n,enumerable:!0})}function r(e,r,s){function a(n){return t(n)[e]||o}i(a,"pattern",r),i(n,s,a)}var o="",s=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;return r(1,/^[a-zA-Z]{2,3}$/,"language"),r(2,/^[a-zA-Z]{3}$/,"extlang"),r(3,/^[a-zA-Z]{4}$/,"script"),r(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),i(n,"split",e),n})},{}],36:[function(t,e,n){"use strict";var i=t("./src/suggestions");e.exports=i,"undefined"!=typeof window&&(window.Suggestions=i)},{"./src/suggestions":38}],37:[function(t,e,n){"use strict";var i=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};i.prototype.show=function(){this.element.style.display="block"},i.prototype.hide=function(){this.element.style.display="none"},i.prototype.add=function(t){this.items.push(t)},i.prototype.clear=function(){this.items=[],this.active=0},i.prototype.isEmpty=function(){return!this.items.length},i.prototype.isVisible=function(){return"block"===this.element.style.display},i.prototype.draw=function(){if(this.element.innerHTML="",0===this.items.length)return void this.hide();for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()},i.prototype.drawItem=function(t,e){var n=document.createElement("li"),i=document.createElement("a");e&&(n.className+=" active"),i.innerHTML=t.string,n.appendChild(i),this.element.appendChild(n),n.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),n.addEventListener("mouseup",function(){this.handleMouseUp.call(this,t)}.bind(this))},i.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()},i.prototype.move=function(t){this.active=t,this.draw()},i.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},i.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},i.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()},e.exports=i},{}],38:[function(t,e,n){"use strict";var i=t("xtend"),r=t("fuzzy"),o=t("./list"),s=function(t,e,n){return n=n||{},this.options=i({minLength:2,limit:5,filter:!0,hideOnBlur:!0},n),this.el=t,this.data=e||[],this.list=new o(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(t){this.handleKeyUp(t.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(t){this.handleKeyDown(t)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(t){this.handlePaste(t)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};s.prototype.handleKeyUp=function(t){40!==t&&38!==t&&27!==t&&13!==t&&9!==t&&this.handleInputChange(this.el.value)},s.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},s.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},s.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(t.target.value)},100)}},s.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength)return void this.list.draw();this.getCandidates(function(t){for(var e=0;e<t.length&&(this.list.add(t[e]),e!==this.options.limit-1);e++);this.list.draw()}.bind(this))},s.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},s.prototype.update=function(t){this.data=t,this.handleKeyUp()},s.prototype.clear=function(){this.data=[],this.list.clear()},s.prototype.normalize=function(t){return t=t.toLowerCase()},s.prototype.match=function(t,e){return t.indexOf(e)>-1},s.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),
document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")},s.prototype.getCandidates=function(t){var e,n={pre:"<strong>",post:"</strong>",extract:function(t){return this.getItemValue(t)}.bind(this)};this.options.filter?(e=r.filter(this.query,this.data,n),e=e.map(function(t){return{original:t.original,string:this.render(t.original,t.string)}}.bind(this))):e=this.data.map(function(t){return{original:t,string:this.render(t)}}.bind(this)),t(e)},s.prototype.getItemValue=function(t){return t},s.prototype.render=function(t,e){if(e)return e;for(var n=t.original?this.getItemValue(t.original):this.getItemValue(t),i=this.normalize(n),r=i.lastIndexOf(this.query);r>-1;){var o=r+this.query.length;n=n.slice(0,r)+"<strong>"+n.slice(r,o)+"</strong>"+n.slice(o),r=i.slice(0,r).lastIndexOf(this.query)}return n},s.prototype.renderError=function(t){this.list.drawError(t)},e.exports=s},{"./list":37,fuzzy:29,xtend:39}],39:[function(t,e,n){"use strict";function i(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];for(var i in n)r.call(n,i)&&(t[i]=n[i])}return t}e.exports=i;var r=Object.prototype.hasOwnProperty},{}]},{},[4])(4)});
</script>
<script>var MapboxGLGlobeMinimap=function(){"use strict";class t{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let e=0;for(let r=0;r<this._n&&r<32;r++){const i=n[r],o=t+i,u=Math.abs(t)<Math.abs(i)?t-(o-i):i-(o-t);u&&(n[e++]=u),t=o}return n[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let n,e,r,i=this._n,o=0;if(i>0){for(o=t[--i];i>0&&(n=o,e=t[--i],o=n+e,r=e-(o-n),!r););i>0&&(r<0&&t[i-1]<0||r>0&&t[i-1]>0)&&(e=2*r,n=o+e,e==n-o&&(o=n))}return o}}function n(t){return Array.from(function*(t){for(const n of t)yield*n}(t))}var e={value:()=>{}};function r(){for(var t,n=0,e=arguments.length,r={};n<e;++n){if(!(t=arguments[n]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new i(r)}function i(t){this._=t}function o(t,n){for(var e,r=0,i=t.length;r<i;++r)if((e=t[r]).name===n)return e.value}function u(t,n,r){for(var i=0,o=t.length;i<o;++i)if(t[i].name===n){t[i]=e,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=r&&t.push({name:n,value:r}),t}i.prototype=r.prototype={constructor:i,on:function(t,n){var e,r,i=this._,a=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var n="",e=t.indexOf(".");if(e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}}))),l=-1,s=a.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++l<s;)if(e=(t=a[l]).type)i[e]=u(i[e],t.name,n);else if(null==n)for(e in i)i[e]=u(i[e],t.name,null);return this}for(;++l<s;)if((e=(t=a[l]).type)&&(e=o(i[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new i(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,r,i=new Array(e),o=0;o<e;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,e=(r=this._[t]).length;o<e;++o)r[o].value.apply(n,i)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(n,e)}};var a="http://www.w3.org/1999/xhtml",l={svg:"http://www.w3.org/2000/svg",xhtml:a,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function s(t){var n=t+="",e=n.indexOf(":");return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),l.hasOwnProperty(n)?{space:l[n],local:t}:t}function c(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===a&&n.documentElement.namespaceURI===a?n.createElement(t):n.createElementNS(e,t)}}function f(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function h(t){var n=s(t);return(n.local?f:c)(n)}function p(){}function d(t){return null==t?p:function(){return this.querySelector(t)}}function v(){return[]}function g(t){return null==t?v:function(){return this.querySelectorAll(t)}}function y(t){return function(){return null==(n=t.apply(this,arguments))?[]:Array.isArray(n)?n:Array.from(n);var n}}function _(t){return function(){return this.matches(t)}}function m(t){return function(n){return n.matches(t)}}var w=Array.prototype.find;function b(){return this.firstElementChild}var x=Array.prototype.filter;function E(){return Array.from(this.children)}function S(t){return new Array(t.length)}function N(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}function k(t,n,e,r,i,o){for(var u,a=0,l=n.length,s=o.length;a<s;++a)(u=n[a])?(u.__data__=o[a],r[a]=u):e[a]=new N(t,o[a]);for(;a<l;++a)(u=n[a])&&(i[a]=u)}function M(t,n,e,r,i,o,u){var a,l,s,c=new Map,f=n.length,h=o.length,p=new Array(f);for(a=0;a<f;++a)(l=n[a])&&(p[a]=s=u.call(l,l.__data__,a,n)+"",c.has(s)?i[a]=l:c.set(s,l));for(a=0;a<h;++a)s=u.call(t,o[a],a,o)+"",(l=c.get(s))?(r[a]=l,l.__data__=o[a],c.delete(s)):e[a]=new N(t,o[a]);for(a=0;a<f;++a)(l=n[a])&&c.get(p[a])===l&&(i[a]=l)}function A(t){return t.__data__}function $(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function C(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function P(t){return function(){this.removeAttribute(t)}}function j(t){return function(){this.removeAttributeNS(t.space,t.local)}}function R(t,n){return function(){this.setAttribute(t,n)}}function T(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function q(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}}function O(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function L(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function X(t){return function(){this.style.removeProperty(t)}}function z(t,n,e){return function(){this.style.setProperty(t,n,e)}}function D(t,n,e){return function(){var r=n.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,e)}}function H(t,n){return t.style.getPropertyValue(n)||L(t).getComputedStyle(t,null).getPropertyValue(n)}function I(t){return function(){delete this[t]}}function Y(t,n){return function(){this[t]=n}}function B(t,n){return function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}}function F(t){return t.trim().split(/^|\s+/)}function V(t){return t.classList||new G(t)}function G(t){this._node=t,this._names=F(t.getAttribute("class")||"")}function U(t,n){for(var e=V(t),r=-1,i=n.length;++r<i;)e.add(n[r])}function Z(t,n){for(var e=V(t),r=-1,i=n.length;++r<i;)e.remove(n[r])}function W(t){return function(){U(this,t)}}function K(t){return function(){Z(this,t)}}function J(t,n){return function(){(n.apply(this,arguments)?U:Z)(this,t)}}function Q(){this.textContent=""}function tt(t){return function(){this.textContent=t}}function nt(t){return function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}}function et(){this.innerHTML=""}function rt(t){return function(){this.innerHTML=t}}function it(t){return function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}}function ot(){this.nextSibling&&this.parentNode.appendChild(this)}function ut(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function at(){return null}function lt(){var t=this.parentNode;t&&t.removeChild(this)}function st(){var t=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function ct(){var t=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function ft(t){return function(){var n=this.__on;if(n){for(var e,r=0,i=-1,o=n.length;r<o;++r)e=n[r],t.type&&e.type!==t.type||e.name!==t.name?n[++i]=e:this.removeEventListener(e.type,e.listener,e.options);++i?n.length=i:delete this.__on}}}function ht(t,n,e){return function(){var r,i=this.__on,o=function(t){return function(n){t.call(this,n,this.__data__)}}(n);if(i)for(var u=0,a=i.length;u<a;++u)if((r=i[u]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=e),void(r.value=n);this.addEventListener(t.type,o,e),r={type:t.type,name:t.name,value:n,listener:o,options:e},i?i.push(r):this.__on=[r]}}function pt(t,n,e){var r=L(t),i=r.CustomEvent;"function"==typeof i?i=new i(n,e):(i=r.document.createEvent("Event"),e?(i.initEvent(n,e.bubbles,e.cancelable),i.detail=e.detail):i.initEvent(n,!1,!1)),t.dispatchEvent(i)}function dt(t,n){return function(){return pt(this,t,n)}}function vt(t,n){return function(){return pt(this,t,n.apply(this,arguments))}}N.prototype={constructor:N,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},G.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var gt=[null];function yt(t,n){this._groups=t,this._parents=n}function _t(){return new yt([[document.documentElement]],gt)}function mt(t){return"string"==typeof t?new yt([[document.querySelector(t)]],[document.documentElement]):new yt([[t]],gt)}function wt(t,n,e){t.prototype=n.prototype=e,e.constructor=t}function bt(t,n){var e=Object.create(t.prototype);for(var r in n)e[r]=n[r];return e}function xt(){}yt.prototype=_t.prototype={constructor:yt,select:function(t){"function"!=typeof t&&(t=d(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o,u,a=n[i],l=a.length,s=r[i]=new Array(l),c=0;c<l;++c)(o=a[c])&&(u=t.call(o,o.__data__,c,a))&&("__data__"in o&&(u.__data__=o.__data__),s[c]=u);return new yt(r,this._parents)},selectAll:function(t){t="function"==typeof t?y(t):g(t);for(var n=this._groups,e=n.length,r=[],i=[],o=0;o<e;++o)for(var u,a=n[o],l=a.length,s=0;s<l;++s)(u=a[s])&&(r.push(t.call(u,u.__data__,s,a)),i.push(u));return new yt(r,i)},selectChild:function(t){return this.select(null==t?b:function(t){return function(){return w.call(this.children,t)}}("function"==typeof t?t:m(t)))},selectChildren:function(t){return this.selectAll(null==t?E:function(t){return function(){return x.call(this.children,t)}}("function"==typeof t?t:m(t)))},filter:function(t){"function"!=typeof t&&(t=_(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o,u=n[i],a=u.length,l=r[i]=[],s=0;s<a;++s)(o=u[s])&&t.call(o,o.__data__,s,u)&&l.push(o);return new yt(r,this._parents)},data:function(t,n){if(!arguments.length)return Array.from(this,A);var e,r=n?M:k,i=this._parents,o=this._groups;"function"!=typeof t&&(e=t,t=function(){return e});for(var u=o.length,a=new Array(u),l=new Array(u),s=new Array(u),c=0;c<u;++c){var f=i[c],h=o[c],p=h.length,d=$(t.call(f,f&&f.__data__,c,i)),v=d.length,g=l[c]=new Array(v),y=a[c]=new Array(v);r(f,h,g,y,s[c]=new Array(p),d,n);for(var _,m,w=0,b=0;w<v;++w)if(_=g[w]){for(w>=b&&(b=w+1);!(m=y[b])&&++b<v;);_._next=m||null}}return(a=new yt(a,i))._enter=l,a._exit=s,a},enter:function(){return new yt(this._enter||this._groups.map(S),this._parents)},exit:function(){return new yt(this._exit||this._groups.map(S),this._parents)},join:function(t,n,e){var r=this.enter(),i=this,o=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=n&&(i=n(i))&&(i=i.selection()),null==e?o.remove():e(o),r&&i?r.merge(i).order():i},merge:function(t){for(var n=t.selection?t.selection():t,e=this._groups,r=n._groups,i=e.length,o=r.length,u=Math.min(i,o),a=new Array(i),l=0;l<u;++l)for(var s,c=e[l],f=r[l],h=c.length,p=a[l]=new Array(h),d=0;d<h;++d)(s=c[d]||f[d])&&(p[d]=s);for(;l<i;++l)a[l]=e[l];return new yt(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var r,i=t[n],o=i.length-1,u=i[o];--o>=0;)(r=i[o])&&(u&&4^r.compareDocumentPosition(u)&&u.parentNode.insertBefore(r,u),u=r);return this},sort:function(t){function n(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}t||(t=C);for(var e=this._groups,r=e.length,i=new Array(r),o=0;o<r;++o){for(var u,a=e[o],l=a.length,s=i[o]=new Array(l),c=0;c<l;++c)(u=a[c])&&(s[c]=u);s.sort(n)}return new yt(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],i=0,o=r.length;i<o;++i){var u=r[i];if(u)return u}return null},size:function(){let t=0;for(const n of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var i,o=n[e],u=0,a=o.length;u<a;++u)(i=o[u])&&t.call(i,i.__data__,u,o);return this},attr:function(t,n){var e=s(t);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((null==n?e.local?j:P:"function"==typeof n?e.local?O:q:e.local?T:R)(e,n))},style:function(t,n,e){return arguments.length>1?this.each((null==n?X:"function"==typeof n?D:z)(t,n,null==e?"":e)):H(this.node(),t)},property:function(t,n){return arguments.length>1?this.each((null==n?I:"function"==typeof n?B:Y)(t,n)):this.node()[t]},classed:function(t,n){var e=F(t+"");if(arguments.length<2){for(var r=V(this.node()),i=-1,o=e.length;++i<o;)if(!r.contains(e[i]))return!1;return!0}return this.each(("function"==typeof n?J:n?W:K)(e,n))},text:function(t){return arguments.length?this.each(null==t?Q:("function"==typeof t?nt:tt)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?et:("function"==typeof t?it:rt)(t)):this.node().innerHTML},raise:function(){return this.each(ot)},lower:function(){return this.each(ut)},append:function(t){var n="function"==typeof t?t:h(t);return this.select((function(){return this.appendChild(n.apply(this,arguments))}))},insert:function(t,n){var e="function"==typeof t?t:h(t),r=null==n?at:"function"==typeof n?n:d(n);return this.select((function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(lt)},clone:function(t){return this.select(t?ct:st)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,n,e){var r,i,o=function(t){return t.trim().split(/^|\s+/).map((function(t){var n="",e=t.indexOf(".");return e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),{type:t,name:n}}))}(t+""),u=o.length;if(!(arguments.length<2)){for(a=n?ht:ft,r=0;r<u;++r)this.each(a(o[r],n,e));return this}var a=this.node().__on;if(a)for(var l,s=0,c=a.length;s<c;++s)for(r=0,l=a[s];r<u;++r)if((i=o[r]).type===l.type&&i.name===l.name)return l.value},dispatch:function(t,n){return this.each(("function"==typeof n?vt:dt)(t,n))},[Symbol.iterator]:function*(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r,i=t[n],o=0,u=i.length;o<u;++o)(r=i[o])&&(yield r)}};var Et=.7,St=1/Et,Nt="\\s*([+-]?\\d+)\\s*",kt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Mt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",At=/^#([0-9a-f]{3,8})$/,$t=new RegExp(`^rgb\\(${Nt},${Nt},${Nt}\\)$`),Ct=new RegExp(`^rgb\\(${Mt},${Mt},${Mt}\\)$`),Pt=new RegExp(`^rgba\\(${Nt},${Nt},${Nt},${kt}\\)$`),jt=new RegExp(`^rgba\\(${Mt},${Mt},${Mt},${kt}\\)$`),Rt=new RegExp(`^hsl\\(${kt},${Mt},${Mt}\\)$`),Tt=new RegExp(`^hsla\\(${kt},${Mt},${Mt},${kt}\\)$`),qt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ot(){return this.rgb().formatHex()}function Lt(){return this.rgb().formatRgb()}function Xt(t){var n,e;return t=(t+"").trim().toLowerCase(),(n=At.exec(t))?(e=n[1].length,n=parseInt(n[1],16),6===e?zt(n):3===e?new It(n>>8&15|n>>4&240,n>>4&15|240&n,(15&n)<<4|15&n,1):8===e?Dt(n>>24&255,n>>16&255,n>>8&255,(255&n)/255):4===e?Dt(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|240&n,((15&n)<<4|15&n)/255):null):(n=$t.exec(t))?new It(n[1],n[2],n[3],1):(n=Ct.exec(t))?new It(255*n[1]/100,255*n[2]/100,255*n[3]/100,1):(n=Pt.exec(t))?Dt(n[1],n[2],n[3],n[4]):(n=jt.exec(t))?Dt(255*n[1]/100,255*n[2]/100,255*n[3]/100,n[4]):(n=Rt.exec(t))?Ut(n[1],n[2]/100,n[3]/100,1):(n=Tt.exec(t))?Ut(n[1],n[2]/100,n[3]/100,n[4]):qt.hasOwnProperty(t)?zt(qt[t]):"transparent"===t?new It(NaN,NaN,NaN,0):null}function zt(t){return new It(t>>16&255,t>>8&255,255&t,1)}function Dt(t,n,e,r){return r<=0&&(t=n=e=NaN),new It(t,n,e,r)}function Ht(t,n,e,r){return 1===arguments.length?((i=t)instanceof xt||(i=Xt(i)),i?new It((i=i.rgb()).r,i.g,i.b,i.opacity):new It):new It(t,n,e,null==r?1:r);var i}function It(t,n,e,r){this.r=+t,this.g=+n,this.b=+e,this.opacity=+r}function Yt(){return`#${Gt(this.r)}${Gt(this.g)}${Gt(this.b)}`}function Bt(){const t=Ft(this.opacity);return`${1===t?"rgb(":"rgba("}${Vt(this.r)}, ${Vt(this.g)}, ${Vt(this.b)}${1===t?")":`, ${t})`}`}function Ft(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Vt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Gt(t){return((t=Vt(t))<16?"0":"")+t.toString(16)}function Ut(t,n,e,r){return r<=0?t=n=e=NaN:e<=0||e>=1?t=n=NaN:n<=0&&(t=NaN),new Wt(t,n,e,r)}function Zt(t){if(t instanceof Wt)return new Wt(t.h,t.s,t.l,t.opacity);if(t instanceof xt||(t=Xt(t)),!t)return new Wt;if(t instanceof Wt)return t;var n=(t=t.rgb()).r/255,e=t.g/255,r=t.b/255,i=Math.min(n,e,r),o=Math.max(n,e,r),u=NaN,a=o-i,l=(o+i)/2;return a?(u=n===o?(e-r)/a+6*(e<r):e===o?(r-n)/a+2:(n-e)/a+4,a/=l<.5?o+i:2-o-i,u*=60):a=l>0&&l<1?0:u,new Wt(u,a,l,t.opacity)}function Wt(t,n,e,r){this.h=+t,this.s=+n,this.l=+e,this.opacity=+r}function Kt(t){return(t=(t||0)%360)<0?t+360:t}function Jt(t){return Math.max(0,Math.min(1,t||0))}function Qt(t,n,e){return 255*(t<60?n+(e-n)*t/60:t<180?e:t<240?n+(e-n)*(240-t)/60:n)}wt(xt,Xt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Ot,formatHex:Ot,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Zt(this).formatHsl()},formatRgb:Lt,toString:Lt}),wt(It,Ht,bt(xt,{brighter(t){return t=null==t?St:Math.pow(St,t),new It(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?Et:Math.pow(Et,t),new It(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new It(Vt(this.r),Vt(this.g),Vt(this.b),Ft(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yt,formatHex:Yt,formatHex8:function(){return`#${Gt(this.r)}${Gt(this.g)}${Gt(this.b)}${Gt(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Bt,toString:Bt})),wt(Wt,(function(t,n,e,r){return 1===arguments.length?Zt(t):new Wt(t,n,e,null==r?1:r)}),bt(xt,{brighter(t){return t=null==t?St:Math.pow(St,t),new Wt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Et:Math.pow(Et,t),new Wt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),n=isNaN(t)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*n,i=2*e-r;return new It(Qt(t>=240?t-240:t+120,i,r),Qt(t,i,r),Qt(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Wt(Kt(this.h),Jt(this.s),Jt(this.l),Ft(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ft(this.opacity);return`${1===t?"hsl(":"hsla("}${Kt(this.h)}, ${100*Jt(this.s)}%, ${100*Jt(this.l)}%${1===t?")":`, ${t})`}`}}));var tn=t=>()=>t;function nn(t){return 1==(t=+t)?en:function(n,e){return e-n?function(t,n,e){return t=Math.pow(t,e),n=Math.pow(n,e)-t,e=1/e,function(r){return Math.pow(t+r*n,e)}}(n,e,t):tn(isNaN(n)?e:n)}}function en(t,n){var e=n-t;return e?function(t,n){return function(e){return t+e*n}}(t,e):tn(isNaN(t)?n:t)}var rn=function t(n){var e=nn(n);function r(t,n){var r=e((t=Ht(t)).r,(n=Ht(n)).r),i=e(t.g,n.g),o=e(t.b,n.b),u=en(t.opacity,n.opacity);return function(n){return t.r=r(n),t.g=i(n),t.b=o(n),t.opacity=u(n),t+""}}return r.gamma=t,r}(1);function on(t,n){n||(n=[]);var e,r=t?Math.min(n.length,t.length):0,i=n.slice();return function(o){for(e=0;e<r;++e)i[e]=t[e]*(1-o)+n[e]*o;return i}}function un(t,n){var e,r=n?n.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),u=new Array(r);for(e=0;e<i;++e)o[e]=pn(t[e],n[e]);for(;e<r;++e)u[e]=n[e];return function(t){for(e=0;e<i;++e)u[e]=o[e](t);return u}}function an(t,n){var e=new Date;return t=+t,n=+n,function(r){return e.setTime(t*(1-r)+n*r),e}}function ln(t,n){return t=+t,n=+n,function(e){return t*(1-e)+n*e}}function sn(t,n){var e,r={},i={};for(e in null!==t&&"object"==typeof t||(t={}),null!==n&&"object"==typeof n||(n={}),n)e in t?r[e]=pn(t[e],n[e]):i[e]=n[e];return function(t){for(e in r)i[e]=r[e](t);return i}}var cn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fn=new RegExp(cn.source,"g");function hn(t,n){var e,r,i,o=cn.lastIndex=fn.lastIndex=0,u=-1,a=[],l=[];for(t+="",n+="";(e=cn.exec(t))&&(r=fn.exec(n));)(i=r.index)>o&&(i=n.slice(o,i),a[u]?a[u]+=i:a[++u]=i),(e=e[0])===(r=r[0])?a[u]?a[u]+=r:a[++u]=r:(a[++u]=null,l.push({i:u,x:ln(e,r)})),o=fn.lastIndex;return o<n.length&&(i=n.slice(o),a[u]?a[u]+=i:a[++u]=i),a.length<2?l[0]?function(t){return function(n){return t(n)+""}}(l[0].x):function(t){return function(){return t}}(n):(n=l.length,function(t){for(var e,r=0;r<n;++r)a[(e=l[r]).i]=e.x(t);return a.join("")})}function pn(t,n){var e,r,i=typeof n;return null==n||"boolean"===i?tn(n):("number"===i?ln:"string"===i?(e=Xt(n))?(n=e,rn):hn:n instanceof Xt?rn:n instanceof Date?an:(r=n,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(n)?un:"function"!=typeof n.valueOf&&"function"!=typeof n.toString||isNaN(n)?sn:ln:on))(t,n)}var dn,vn=180/Math.PI,gn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function yn(t,n,e,r,i,o){var u,a,l;return(u=Math.sqrt(t*t+n*n))&&(t/=u,n/=u),(l=t*e+n*r)&&(e-=t*l,r-=n*l),(a=Math.sqrt(e*e+r*r))&&(e/=a,r/=a,l/=a),t*r<n*e&&(t=-t,n=-n,l=-l,u=-u),{translateX:i,translateY:o,rotate:Math.atan2(n,t)*vn,skewX:Math.atan(l)*vn,scaleX:u,scaleY:a}}function _n(t,n,e,r){function i(t){return t.length?t.pop()+" ":""}return function(o,u){var a=[],l=[];return o=t(o),u=t(u),function(t,r,i,o,u,a){if(t!==i||r!==o){var l=u.push("translate(",null,n,null,e);a.push({i:l-4,x:ln(t,i)},{i:l-2,x:ln(r,o)})}else(i||o)&&u.push("translate("+i+n+o+e)}(o.translateX,o.translateY,u.translateX,u.translateY,a,l),function(t,n,e,o){t!==n?(t-n>180?n+=360:n-t>180&&(t+=360),o.push({i:e.push(i(e)+"rotate(",null,r)-2,x:ln(t,n)})):n&&e.push(i(e)+"rotate("+n+r)}(o.rotate,u.rotate,a,l),function(t,n,e,o){t!==n?o.push({i:e.push(i(e)+"skewX(",null,r)-2,x:ln(t,n)}):n&&e.push(i(e)+"skewX("+n+r)}(o.skewX,u.skewX,a,l),function(t,n,e,r,o,u){if(t!==e||n!==r){var a=o.push(i(o)+"scale(",null,",",null,")");u.push({i:a-4,x:ln(t,e)},{i:a-2,x:ln(n,r)})}else 1===e&&1===r||o.push(i(o)+"scale("+e+","+r+")")}(o.scaleX,o.scaleY,u.scaleX,u.scaleY,a,l),o=u=null,function(t){for(var n,e=-1,r=l.length;++e<r;)a[(n=l[e]).i]=n.x(t);return a.join("")}}}var mn,wn,bn=_n((function(t){const n=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return n.isIdentity?gn:yn(n.a,n.b,n.c,n.d,n.e,n.f)}),"px, ","px)","deg)"),xn=_n((function(t){return null==t?gn:(dn||(dn=document.createElementNS("http://www.w3.org/2000/svg","g")),dn.setAttribute("transform",t),(t=dn.transform.baseVal.consolidate())?yn((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):gn)}),", ",")",")"),En=0,Sn=0,Nn=0,kn=1e3,Mn=0,An=0,$n=0,Cn="object"==typeof performance&&performance.now?performance:Date,Pn="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function jn(){return An||(Pn(Rn),An=Cn.now()+$n)}function Rn(){An=0}function Tn(){this._call=this._time=this._next=null}function qn(t,n,e){var r=new Tn;return r.restart(t,n,e),r}function On(){An=(Mn=Cn.now())+$n,En=Sn=0;try{!function(){jn(),++En;for(var t,n=mn;n;)(t=An-n._time)>=0&&n._call.call(void 0,t),n=n._next;--En}()}finally{En=0,function(){var t,n,e=mn,r=1/0;for(;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:mn=n);wn=t,Xn(r)}(),An=0}}function Ln(){var t=Cn.now(),n=t-Mn;n>kn&&($n-=n,Mn=t)}function Xn(t){En||(Sn&&(Sn=clearTimeout(Sn)),t-An>24?(t<1/0&&(Sn=setTimeout(On,t-Cn.now()-$n)),Nn&&(Nn=clearInterval(Nn))):(Nn||(Mn=Cn.now(),Nn=setInterval(Ln,kn)),En=1,Pn(On)))}function zn(t,n,e){var r=new Tn;return n=null==n?0:+n,r.restart((e=>{r.stop(),t(e+n)}),n,e),r}Tn.prototype=qn.prototype={constructor:Tn,restart:function(t,n,e){if("function"!=typeof t)throw new TypeError("callback is not a function");e=(null==e?jn():+e)+(null==n?0:+n),this._next||wn===this||(wn?wn._next=this:mn=this,wn=this),this._call=t,this._time=e,Xn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Xn())}};var Dn=r("start","end","cancel","interrupt"),Hn=[],In=0,Yn=1,Bn=2,Fn=3,Vn=4,Gn=5,Un=6;function Zn(t,n,e,r,i,o){var u=t.__transition;if(u){if(e in u)return}else t.__transition={};!function(t,n,e){var r,i=t.__transition;function o(t){e.state=Yn,e.timer.restart(u,e.delay,e.time),e.delay<=t&&u(t-e.delay)}function u(o){var s,c,f,h;if(e.state!==Yn)return l();for(s in i)if((h=i[s]).name===e.name){if(h.state===Fn)return zn(u);h.state===Vn?(h.state=Un,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[s]):+s<n&&(h.state=Un,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[s])}if(zn((function(){e.state===Fn&&(e.state=Vn,e.timer.restart(a,e.delay,e.time),a(o))})),e.state=Bn,e.on.call("start",t,t.__data__,e.index,e.group),e.state===Bn){for(e.state=Fn,r=new Array(f=e.tween.length),s=0,c=-1;s<f;++s)(h=e.tween[s].value.call(t,t.__data__,e.index,e.group))&&(r[++c]=h);r.length=c+1}}function a(n){for(var i=n<e.duration?e.ease.call(null,n/e.duration):(e.timer.restart(l),e.state=Gn,1),o=-1,u=r.length;++o<u;)r[o].call(t,i);e.state===Gn&&(e.on.call("end",t,t.__data__,e.index,e.group),l())}function l(){for(var r in e.state=Un,e.timer.stop(),delete i[n],i)return;delete t.__transition}i[n]=e,e.timer=qn(o,0,e.time)}(t,e,{name:n,index:r,group:i,on:Dn,tween:Hn,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:In})}function Wn(t,n){var e=Jn(t,n);if(e.state>In)throw new Error("too late; already scheduled");return e}function Kn(t,n){var e=Jn(t,n);if(e.state>Fn)throw new Error("too late; already running");return e}function Jn(t,n){var e=t.__transition;if(!e||!(e=e[n]))throw new Error("transition not found");return e}function Qn(t,n){var e,r;return function(){var i=Kn(this,t),o=i.tween;if(o!==e)for(var u=0,a=(r=e=o).length;u<a;++u)if(r[u].name===n){(r=r.slice()).splice(u,1);break}i.tween=r}}function te(t,n,e){var r,i;if("function"!=typeof e)throw new Error;return function(){var o=Kn(this,t),u=o.tween;if(u!==r){i=(r=u).slice();for(var a={name:n,value:e},l=0,s=i.length;l<s;++l)if(i[l].name===n){i[l]=a;break}l===s&&i.push(a)}o.tween=i}}function ne(t,n,e){var r=t._id;return t.each((function(){var t=Kn(this,r);(t.value||(t.value={}))[n]=e.apply(this,arguments)})),function(t){return Jn(t,r).value[n]}}function ee(t,n){var e;return("number"==typeof n?ln:n instanceof Xt?rn:(e=Xt(n))?(n=e,rn):hn)(t,n)}function re(t){return function(){this.removeAttribute(t)}}function ie(t){return function(){this.removeAttributeNS(t.space,t.local)}}function oe(t,n,e){var r,i,o=e+"";return function(){var u=this.getAttribute(t);return u===o?null:u===r?i:i=n(r=u,e)}}function ue(t,n,e){var r,i,o=e+"";return function(){var u=this.getAttributeNS(t.space,t.local);return u===o?null:u===r?i:i=n(r=u,e)}}function ae(t,n,e){var r,i,o;return function(){var u,a,l=e(this);if(null!=l)return(u=this.getAttribute(t))===(a=l+"")?null:u===r&&a===i?o:(i=a,o=n(r=u,l));this.removeAttribute(t)}}function le(t,n,e){var r,i,o;return function(){var u,a,l=e(this);if(null!=l)return(u=this.getAttributeNS(t.space,t.local))===(a=l+"")?null:u===r&&a===i?o:(i=a,o=n(r=u,l));this.removeAttributeNS(t.space,t.local)}}function se(t,n){var e,r;function i(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&function(t,n){return function(e){this.setAttributeNS(t.space,t.local,n.call(this,e))}}(t,i)),e}return i._value=n,i}function ce(t,n){var e,r;function i(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&function(t,n){return function(e){this.setAttribute(t,n.call(this,e))}}(t,i)),e}return i._value=n,i}function fe(t,n){return function(){Wn(this,t).delay=+n.apply(this,arguments)}}function he(t,n){return n=+n,function(){Wn(this,t).delay=n}}function pe(t,n){return function(){Kn(this,t).duration=+n.apply(this,arguments)}}function de(t,n){return n=+n,function(){Kn(this,t).duration=n}}var ve=_t.prototype.constructor;function ge(t){return function(){this.style.removeProperty(t)}}var ye=0;function _e(t,n,e,r){this._groups=t,this._parents=n,this._name=e,this._id=r}function me(t){return _t().transition(t)}function we(){return++ye}var be=_t.prototype;_e.prototype=me.prototype={constructor:_e,select:function(t){var n=this._name,e=this._id;"function"!=typeof t&&(t=d(t));for(var r=this._groups,i=r.length,o=new Array(i),u=0;u<i;++u)for(var a,l,s=r[u],c=s.length,f=o[u]=new Array(c),h=0;h<c;++h)(a=s[h])&&(l=t.call(a,a.__data__,h,s))&&("__data__"in a&&(l.__data__=a.__data__),f[h]=l,Zn(f[h],n,e,h,f,Jn(a,e)));return new _e(o,this._parents,n,e)},selectAll:function(t){var n=this._name,e=this._id;"function"!=typeof t&&(t=g(t));for(var r=this._groups,i=r.length,o=[],u=[],a=0;a<i;++a)for(var l,s=r[a],c=s.length,f=0;f<c;++f)if(l=s[f]){for(var h,p=t.call(l,l.__data__,f,s),d=Jn(l,e),v=0,y=p.length;v<y;++v)(h=p[v])&&Zn(h,n,e,v,p,d);o.push(p),u.push(l)}return new _e(o,u,n,e)},selectChild:be.selectChild,selectChildren:be.selectChildren,filter:function(t){"function"!=typeof t&&(t=_(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o,u=n[i],a=u.length,l=r[i]=[],s=0;s<a;++s)(o=u[s])&&t.call(o,o.__data__,s,u)&&l.push(o);return new _e(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var n=this._groups,e=t._groups,r=n.length,i=e.length,o=Math.min(r,i),u=new Array(r),a=0;a<o;++a)for(var l,s=n[a],c=e[a],f=s.length,h=u[a]=new Array(f),p=0;p<f;++p)(l=s[p]||c[p])&&(h[p]=l);for(;a<r;++a)u[a]=n[a];return new _e(u,this._parents,this._name,this._id)},selection:function(){return new ve(this._groups,this._parents)},transition:function(){for(var t=this._name,n=this._id,e=we(),r=this._groups,i=r.length,o=0;o<i;++o)for(var u,a=r[o],l=a.length,s=0;s<l;++s)if(u=a[s]){var c=Jn(u,n);Zn(u,t,e,s,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new _e(r,this._parents,t,e)},call:be.call,nodes:be.nodes,node:be.node,size:be.size,empty:be.empty,each:be.each,on:function(t,n){var e=this._id;return arguments.length<2?Jn(this.node(),e).on.on(t):this.each(function(t,n,e){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||"start"===t}))}(n)?Wn:Kn;return function(){var u=o(this,t),a=u.on;a!==r&&(i=(r=a).copy()).on(n,e),u.on=i}}(e,t,n))},attr:function(t,n){var e=s(t),r="transform"===e?xn:ee;return this.attrTween(t,"function"==typeof n?(e.local?le:ae)(e,r,ne(this,"attr."+t,n)):null==n?(e.local?ie:re)(e):(e.local?ue:oe)(e,r,n))},attrTween:function(t,n){var e="attr."+t;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(null==n)return this.tween(e,null);if("function"!=typeof n)throw new Error;var r=s(t);return this.tween(e,(r.local?se:ce)(r,n))},style:function(t,n,e){var r="transform"==(t+="")?bn:ee;return null==n?this.styleTween(t,function(t,n){var e,r,i;return function(){var o=H(this,t),u=(this.style.removeProperty(t),H(this,t));return o===u?null:o===e&&u===r?i:i=n(e=o,r=u)}}(t,r)).on("end.style."+t,ge(t)):"function"==typeof n?this.styleTween(t,function(t,n,e){var r,i,o;return function(){var u=H(this,t),a=e(this),l=a+"";return null==a&&(this.style.removeProperty(t),l=a=H(this,t)),u===l?null:u===r&&l===i?o:(i=l,o=n(r=u,a))}}(t,r,ne(this,"style."+t,n))).each(function(t,n){var e,r,i,o,u="style."+n,a="end."+u;return function(){var l=Kn(this,t),s=l.on,c=null==l.value[u]?o||(o=ge(n)):void 0;s===e&&i===c||(r=(e=s).copy()).on(a,i=c),l.on=r}}(this._id,t)):this.styleTween(t,function(t,n,e){var r,i,o=e+"";return function(){var u=H(this,t);return u===o?null:u===r?i:i=n(r=u,e)}}(t,r,n),e).on("end.style."+t,null)},styleTween:function(t,n,e){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==n)return this.tween(r,null);if("function"!=typeof n)throw new Error;return this.tween(r,function(t,n,e){var r,i;function o(){var o=n.apply(this,arguments);return o!==i&&(r=(i=o)&&function(t,n,e){return function(r){this.style.setProperty(t,n.call(this,r),e)}}(t,o,e)),r}return o._value=n,o}(t,n,null==e?"":e))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var n=t(this);this.textContent=null==n?"":n}}(ne(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;return this.tween(n,function(t){var n,e;function r(){var r=t.apply(this,arguments);return r!==e&&(n=(e=r)&&function(t){return function(n){this.textContent=t.call(this,n)}}(r)),n}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var n=this.parentNode;for(var e in this.__transition)if(+e!==t)return;n&&n.removeChild(this)}}(this._id))},tween:function(t,n){var e=this._id;if(t+="",arguments.length<2){for(var r,i=Jn(this.node(),e).tween,o=0,u=i.length;o<u;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==n?Qn:te)(e,t,n))},delay:function(t){var n=this._id;return arguments.length?this.each(("function"==typeof t?fe:he)(n,t)):Jn(this.node(),n).delay},duration:function(t){var n=this._id;return arguments.length?this.each(("function"==typeof t?pe:de)(n,t)):Jn(this.node(),n).duration},ease:function(t){var n=this._id;return arguments.length?this.each(function(t,n){if("function"!=typeof n)throw new Error;return function(){Kn(this,t).ease=n}}(n,t)):Jn(this.node(),n).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,n){return function(){var e=n.apply(this,arguments);if("function"!=typeof e)throw new Error;Kn(this,t).ease=e}}(this._id,t))},end:function(){var t,n,e=this,r=e._id,i=e.size();return new Promise((function(o,u){var a={value:u},l={value:function(){0==--i&&o()}};e.each((function(){var e=Kn(this,r),i=e.on;i!==t&&((n=(t=i).copy())._.cancel.push(a),n._.interrupt.push(a),n._.end.push(l)),e.on=n})),0===i&&o()}))},[Symbol.iterator]:be[Symbol.iterator]};var xe={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Ee(t,n){for(var e;!(e=t.__transition)||!(e=e[n]);)if(!(t=t.parentNode))throw new Error(`transition ${n} not found`);return e}_t.prototype.interrupt=function(t){return this.each((function(){!function(t,n){var e,r,i,o=t.__transition,u=!0;if(o){for(i in n=null==n?null:n+"",o)(e=o[i]).name===n?(r=e.state>Bn&&e.state<Gn,e.state=Un,e.timer.stop(),e.on.call(r?"interrupt":"cancel",t,t.__data__,e.index,e.group),delete o[i]):u=!1;u&&delete t.__transition}}(this,t)}))},_t.prototype.transition=function(t){var n,e;t instanceof _e?(n=t._id,t=t._name):(n=we(),(e=xe).time=jn(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var u,a=r[o],l=a.length,s=0;s<l;++s)(u=a[s])&&Zn(u,t,n,s,a,e||Ee(u,n));return new _e(r,this._parents,t,n)};var Se=1e-6,Ne=1e-12,ke=Math.PI,Me=ke/2,Ae=ke/4,$e=2*ke,Ce=180/ke,Pe=ke/180,je=Math.abs,Re=Math.atan,Te=Math.atan2,qe=Math.cos,Oe=Math.sin,Le=Math.sign||function(t){return t>0?1:t<0?-1:0},Xe=Math.sqrt;function ze(t){return t>1?Me:t<-1?-Me:Math.asin(t)}function De(){}function He(t,n){t&&Ye.hasOwnProperty(t.type)&&Ye[t.type](t,n)}var Ie={Feature:function(t,n){He(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,i=e.length;++r<i;)He(e[r].geometry,n)}},Ye={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)t=e[r],n.point(t[0],t[1],t[2])},LineString:function(t,n){Be(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)Be(e[r],n,0)},Polygon:function(t,n){Fe(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,i=e.length;++r<i;)Fe(e[r],n)},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,i=e.length;++r<i;)He(e[r],n)}};function Be(t,n,e){var r,i=-1,o=t.length-e;for(n.lineStart();++i<o;)r=t[i],n.point(r[0],r[1],r[2]);n.lineEnd()}function Fe(t,n){var e=-1,r=t.length;for(n.polygonStart();++e<r;)Be(t[e],n,1);n.polygonEnd()}function Ve(t,n){t&&Ie.hasOwnProperty(t.type)?Ie[t.type](t,n):He(t,n)}function Ge(t){return[Te(t[1],t[0]),ze(t[2])]}function Ue(t){var n=t[0],e=t[1],r=qe(e);return[r*qe(n),r*Oe(n),Oe(e)]}function Ze(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function We(t,n){return[t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0]]}function Ke(t,n){t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]}function Je(t,n){return[t[0]*n,t[1]*n,t[2]*n]}function Qe(t){var n=Xe(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=n,t[1]/=n,t[2]/=n}function tr(t,n){function e(e,r){return e=t(e,r),n(e[0],e[1])}return t.invert&&n.invert&&(e.invert=function(e,r){return(e=n.invert(e,r))&&t.invert(e[0],e[1])}),e}function nr(t,n){return je(t)>ke&&(t-=Math.round(t/$e)*$e),[t,n]}function er(t){return function(n,e){return je(n+=t)>ke&&(n-=Math.round(n/$e)*$e),[n,e]}}function rr(t){var n=er(t);return n.invert=er(-t),n}function ir(t,n){var e=qe(t),r=Oe(t),i=qe(n),o=Oe(n);function u(t,n){var u=qe(n),a=qe(t)*u,l=Oe(t)*u,s=Oe(n),c=s*e+a*r;return[Te(l*i-c*o,a*e-s*r),ze(c*i+l*o)]}return u.invert=function(t,n){var u=qe(n),a=qe(t)*u,l=Oe(t)*u,s=Oe(n),c=s*i-l*o;return[Te(l*i+s*o,a*e+c*r),ze(c*e-a*r)]},u}function or(t,n){(n=Ue(n))[0]-=t,Qe(n);var e,r=(e=-n[1])>1?0:e<-1?ke:Math.acos(e);return((-n[2]<0?-r:r)+$e-Se)%$e}function ur(){var t,n=[];return{point:function(n,e,r){t.push([n,e,r])},lineStart:function(){n.push(t=[])},lineEnd:De,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function ar(t,n){return je(t[0]-n[0])<Se&&je(t[1]-n[1])<Se}function lr(t,n,e,r){this.x=t,this.z=n,this.o=e,this.e=r,this.v=!1,this.n=this.p=null}function sr(t,n,e,r,i){var o,u,a=[],l=[];if(t.forEach((function(t){if(!((n=t.length-1)<=0)){var n,e,r=t[0],u=t[n];if(ar(r,u)){if(!r[2]&&!u[2]){for(i.lineStart(),o=0;o<n;++o)i.point((r=t[o])[0],r[1]);return void i.lineEnd()}u[0]+=2*Se}a.push(e=new lr(r,t,null,!0)),l.push(e.o=new lr(r,null,e,!1)),a.push(e=new lr(u,t,null,!1)),l.push(e.o=new lr(u,null,e,!0))}})),a.length){for(l.sort(n),cr(a),cr(l),o=0,u=l.length;o<u;++o)l[o].e=e=!e;for(var s,c,f=a[0];;){for(var h=f,p=!0;h.v;)if((h=h.n)===f)return;s=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(p)for(o=0,u=s.length;o<u;++o)i.point((c=s[o])[0],c[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(p)for(s=h.p.z,o=s.length-1;o>=0;--o)i.point((c=s[o])[0],c[1]);else r(h.x,h.p.x,-1,i);h=h.p}s=(h=h.o).z,p=!p}while(!h.v);i.lineEnd()}}}function cr(t){if(n=t.length){for(var n,e,r=0,i=t[0];++r<n;)i.n=e=t[r],e.p=i,i=e;i.n=e=t[0],e.p=i}}function fr(t){return je(t[0])<=ke?t[0]:Le(t[0])*((je(t[0])+ke)%$e-ke)}function hr(e,r,i,o){return function(u){var a,l,s,c=r(u),f=ur(),h=r(f),p=!1,d={point:v,lineStart:y,lineEnd:_,polygonStart:function(){d.point=m,d.lineStart=w,d.lineEnd=b,l=[],a=[]},polygonEnd:function(){d.point=v,d.lineStart=y,d.lineEnd=_,l=n(l);var e=function(n,e){var r=fr(e),i=e[1],o=Oe(i),u=[Oe(r),-qe(r),0],a=0,l=0,s=new t;1===o?i=Me+Se:-1===o&&(i=-Me-Se);for(var c=0,f=n.length;c<f;++c)if(p=(h=n[c]).length)for(var h,p,d=h[p-1],v=fr(d),g=d[1]/2+Ae,y=Oe(g),_=qe(g),m=0;m<p;++m,v=b,y=E,_=S,d=w){var w=h[m],b=fr(w),x=w[1]/2+Ae,E=Oe(x),S=qe(x),N=b-v,k=N>=0?1:-1,M=k*N,A=M>ke,$=y*E;if(s.add(Te($*k*Oe(M),_*S+$*qe(M))),a+=A?N+k*$e:N,A^v>=r^b>=r){var C=We(Ue(d),Ue(w));Qe(C);var P=We(u,C);Qe(P);var j=(A^N>=0?-1:1)*ze(P[2]);(i>j||i===j&&(C[0]||C[1]))&&(l+=A^N>=0?1:-1)}}return(a<-Se||a<Se&&s<-Ne)^1&l}(a,o);l.length?(p||(u.polygonStart(),p=!0),sr(l,dr,e,i,u)):e&&(p||(u.polygonStart(),p=!0),u.lineStart(),i(null,null,1,u),u.lineEnd()),p&&(u.polygonEnd(),p=!1),l=a=null},sphere:function(){u.polygonStart(),u.lineStart(),i(null,null,1,u),u.lineEnd(),u.polygonEnd()}};function v(t,n){e(t,n)&&u.point(t,n)}function g(t,n){c.point(t,n)}function y(){d.point=g,c.lineStart()}function _(){d.point=v,c.lineEnd()}function m(t,n){s.push([t,n]),h.point(t,n)}function w(){h.lineStart(),s=[]}function b(){m(s[0][0],s[0][1]),h.lineEnd();var t,n,e,r,i=h.clean(),o=f.result(),c=o.length;if(s.pop(),a.push(s),s=null,c)if(1&i){if((n=(e=o[0]).length-1)>0){for(p||(u.polygonStart(),p=!0),u.lineStart(),t=0;t<n;++t)u.point((r=e[t])[0],r[1]);u.lineEnd()}}else c>1&&2&i&&o.push(o.pop().concat(o.shift())),l.push(o.filter(pr))}return d}}function pr(t){return t.length>1}function dr(t,n){return((t=t.x)[0]<0?t[1]-Me-Se:Me-t[1])-((n=n.x)[0]<0?n[1]-Me-Se:Me-n[1])}nr.invert=nr;var vr=hr((function(){return!0}),(function(t){var n,e=NaN,r=NaN,i=NaN;return{lineStart:function(){t.lineStart(),n=1},point:function(o,u){var a=o>0?ke:-ke,l=je(o-e);je(l-ke)<Se?(t.point(e,r=(r+u)/2>0?Me:-Me),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),t.point(o,r),n=0):i!==a&&l>=ke&&(je(e-i)<Se&&(e-=i*Se),je(o-a)<Se&&(o-=a*Se),r=function(t,n,e,r){var i,o,u=Oe(t-e);return je(u)>Se?Re((Oe(n)*(o=qe(r))*Oe(e)-Oe(r)*(i=qe(n))*Oe(t))/(i*o*u)):(n+r)/2}(e,r,o,u),t.point(i,r),t.lineEnd(),t.lineStart(),t.point(a,r),n=0),t.point(e=o,r=u),i=a},lineEnd:function(){t.lineEnd(),e=r=NaN},clean:function(){return 2-n}}}),(function(t,n,e,r){var i;if(null==t)i=e*Me,r.point(-ke,i),r.point(0,i),r.point(ke,i),r.point(ke,0),r.point(ke,-i),r.point(0,-i),r.point(-ke,-i),r.point(-ke,0),r.point(-ke,i);else if(je(t[0]-n[0])>Se){var o=t[0]<n[0]?ke:-ke;i=e*o/2,r.point(-o,i),r.point(0,i),r.point(o,i)}else r.point(n[0],n[1])}),[-ke,-Me]);function gr(t){var n=qe(t),e=2*Pe,r=n>0,i=je(n)>Se;function o(t,e){return qe(t)*qe(e)>n}function u(t,e,r){var i=[1,0,0],o=We(Ue(t),Ue(e)),u=Ze(o,o),a=o[0],l=u-a*a;if(!l)return!r&&t;var s=n*u/l,c=-n*a/l,f=We(i,o),h=Je(i,s);Ke(h,Je(o,c));var p=f,d=Ze(h,p),v=Ze(p,p),g=d*d-v*(Ze(h,h)-1);if(!(g<0)){var y=Xe(g),_=Je(p,(-d-y)/v);if(Ke(_,h),_=Ge(_),!r)return _;var m,w=t[0],b=e[0],x=t[1],E=e[1];b<w&&(m=w,w=b,b=m);var S=b-w,N=je(S-ke)<Se;if(!N&&E<x&&(m=x,x=E,E=m),N||S<Se?N?x+E>0^_[1]<(je(_[0]-w)<Se?x:E):x<=_[1]&&_[1]<=E:S>ke^(w<=_[0]&&_[0]<=b)){var k=Je(p,(-d+y)/v);return Ke(k,h),[_,Ge(k)]}}}function a(n,e){var i=r?t:ke-t,o=0;return n<-i?o|=1:n>i&&(o|=2),e<-i?o|=4:e>i&&(o|=8),o}return hr(o,(function(t){var n,e,l,s,c;return{lineStart:function(){s=l=!1,c=1},point:function(f,h){var p,d=[f,h],v=o(f,h),g=r?v?0:a(f,h):v?a(f+(f<0?ke:-ke),h):0;if(!n&&(s=l=v)&&t.lineStart(),v!==l&&(!(p=u(n,d))||ar(n,p)||ar(d,p))&&(d[2]=1),v!==l)c=0,v?(t.lineStart(),p=u(d,n),t.point(p[0],p[1])):(p=u(n,d),t.point(p[0],p[1],2),t.lineEnd()),n=p;else if(i&&n&&r^v){var y;g&e||!(y=u(d,n,!0))||(c=0,r?(t.lineStart(),t.point(y[0][0],y[0][1]),t.point(y[1][0],y[1][1]),t.lineEnd()):(t.point(y[1][0],y[1][1]),t.lineEnd(),t.lineStart(),t.point(y[0][0],y[0][1],3)))}!v||n&&ar(n,d)||t.point(d[0],d[1]),n=d,l=v,e=g},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return c|(s&&l)<<1}}}),(function(n,r,i,o){!function(t,n,e,r,i,o){if(e){var u=qe(n),a=Oe(n),l=r*e;null==i?(i=n+r*$e,o=n-l/2):(i=or(u,i),o=or(u,o),(r>0?i<o:i>o)&&(i+=r*$e));for(var s,c=i;r>0?c>o:c<o;c-=l)s=Ge([u,-a*qe(c),-a*Oe(c)]),t.point(s[0],s[1])}}(o,t,e,i,n,r)}),r?[0,-t]:[-ke,t-ke])}var yr=1e9,_r=-yr;function mr(t,e,r,i){function o(n,o){return t<=n&&n<=r&&e<=o&&o<=i}function u(n,o,u,l){var c=0,f=0;if(null==n||(c=a(n,u))!==(f=a(o,u))||s(n,o)<0^u>0)do{l.point(0===c||3===c?t:r,c>1?i:e)}while((c=(c+u+4)%4)!==f);else l.point(o[0],o[1])}function a(n,i){return je(n[0]-t)<Se?i>0?0:3:je(n[0]-r)<Se?i>0?2:1:je(n[1]-e)<Se?i>0?1:0:i>0?3:2}function l(t,n){return s(t.x,n.x)}function s(t,n){var e=a(t,1),r=a(n,1);return e!==r?e-r:0===e?n[1]-t[1]:1===e?t[0]-n[0]:2===e?t[1]-n[1]:n[0]-t[0]}return function(a){var s,c,f,h,p,d,v,g,y,_,m,w=a,b=ur(),x={point:E,lineStart:function(){x.point=S,c&&c.push(f=[]);_=!0,y=!1,v=g=NaN},lineEnd:function(){s&&(S(h,p),d&&y&&b.rejoin(),s.push(b.result()));x.point=E,y&&w.lineEnd()},polygonStart:function(){w=b,s=[],c=[],m=!0},polygonEnd:function(){var e=function(){for(var n=0,e=0,r=c.length;e<r;++e)for(var o,u,a=c[e],l=1,s=a.length,f=a[0],h=f[0],p=f[1];l<s;++l)o=h,u=p,h=(f=a[l])[0],p=f[1],u<=i?p>i&&(h-o)*(i-u)>(p-u)*(t-o)&&++n:p<=i&&(h-o)*(i-u)<(p-u)*(t-o)&&--n;return n}(),r=m&&e,o=(s=n(s)).length;(r||o)&&(a.polygonStart(),r&&(a.lineStart(),u(null,null,1,a),a.lineEnd()),o&&sr(s,l,e,u,a),a.polygonEnd());w=a,s=c=f=null}};function E(t,n){o(t,n)&&w.point(t,n)}function S(n,u){var a=o(n,u);if(c&&f.push([n,u]),_)h=n,p=u,d=a,_=!1,a&&(w.lineStart(),w.point(n,u));else if(a&&y)w.point(n,u);else{var l=[v=Math.max(_r,Math.min(yr,v)),g=Math.max(_r,Math.min(yr,g))],s=[n=Math.max(_r,Math.min(yr,n)),u=Math.max(_r,Math.min(yr,u))];!function(t,n,e,r,i,o){var u,a=t[0],l=t[1],s=0,c=1,f=n[0]-a,h=n[1]-l;if(u=e-a,f||!(u>0)){if(u/=f,f<0){if(u<s)return;u<c&&(c=u)}else if(f>0){if(u>c)return;u>s&&(s=u)}if(u=i-a,f||!(u<0)){if(u/=f,f<0){if(u>c)return;u>s&&(s=u)}else if(f>0){if(u<s)return;u<c&&(c=u)}if(u=r-l,h||!(u>0)){if(u/=h,h<0){if(u<s)return;u<c&&(c=u)}else if(h>0){if(u>c)return;u>s&&(s=u)}if(u=o-l,h||!(u<0)){if(u/=h,h<0){if(u>c)return;u>s&&(s=u)}else if(h>0){if(u<s)return;u<c&&(c=u)}return s>0&&(t[0]=a+s*f,t[1]=l+s*h),c<1&&(n[0]=a+c*f,n[1]=l+c*h),!0}}}}}(l,s,t,e,r,i)?a&&(w.lineStart(),w.point(n,u),m=!1):(y||(w.lineStart(),w.point(l[0],l[1])),w.point(s[0],s[1]),a||w.lineEnd(),m=!1)}v=n,g=u,y=a}return x}}var wr,br,xr,Er,Sr=t=>t,Nr=new t,kr=new t,Mr={point:De,lineStart:De,lineEnd:De,polygonStart:function(){Mr.lineStart=Ar,Mr.lineEnd=Pr},polygonEnd:function(){Mr.lineStart=Mr.lineEnd=Mr.point=De,Nr.add(je(kr)),kr=new t},result:function(){var n=Nr/2;return Nr=new t,n}};function Ar(){Mr.point=$r}function $r(t,n){Mr.point=Cr,wr=xr=t,br=Er=n}function Cr(t,n){kr.add(Er*t-xr*n),xr=t,Er=n}function Pr(){Cr(wr,br)}var jr=1/0,Rr=jr,Tr=-jr,qr=Tr,Or={point:function(t,n){t<jr&&(jr=t);t>Tr&&(Tr=t);n<Rr&&(Rr=n);n>qr&&(qr=n)},lineStart:De,lineEnd:De,polygonStart:De,polygonEnd:De,result:function(){var t=[[jr,Rr],[Tr,qr]];return Tr=qr=-(Rr=jr=1/0),t}};var Lr,Xr,zr,Dr,Hr=0,Ir=0,Yr=0,Br=0,Fr=0,Vr=0,Gr=0,Ur=0,Zr=0,Wr={point:Kr,lineStart:Jr,lineEnd:ni,polygonStart:function(){Wr.lineStart=ei,Wr.lineEnd=ri},polygonEnd:function(){Wr.point=Kr,Wr.lineStart=Jr,Wr.lineEnd=ni},result:function(){var t=Zr?[Gr/Zr,Ur/Zr]:Vr?[Br/Vr,Fr/Vr]:Yr?[Hr/Yr,Ir/Yr]:[NaN,NaN];return Hr=Ir=Yr=Br=Fr=Vr=Gr=Ur=Zr=0,t}};function Kr(t,n){Hr+=t,Ir+=n,++Yr}function Jr(){Wr.point=Qr}function Qr(t,n){Wr.point=ti,Kr(zr=t,Dr=n)}function ti(t,n){var e=t-zr,r=n-Dr,i=Xe(e*e+r*r);Br+=i*(zr+t)/2,Fr+=i*(Dr+n)/2,Vr+=i,Kr(zr=t,Dr=n)}function ni(){Wr.point=Kr}function ei(){Wr.point=ii}function ri(){oi(Lr,Xr)}function ii(t,n){Wr.point=oi,Kr(Lr=zr=t,Xr=Dr=n)}function oi(t,n){var e=t-zr,r=n-Dr,i=Xe(e*e+r*r);Br+=i*(zr+t)/2,Fr+=i*(Dr+n)/2,Vr+=i,Gr+=(i=Dr*t-zr*n)*(zr+t),Ur+=i*(Dr+n),Zr+=3*i,Kr(zr=t,Dr=n)}function ui(t){this._context=t}ui.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._context.moveTo(t,n),this._point=1;break;case 1:this._context.lineTo(t,n);break;default:this._context.moveTo(t+this._radius,n),this._context.arc(t,n,this._radius,0,$e)}},result:De};var ai,li,si,ci,fi,hi=new t,pi={point:De,lineStart:function(){pi.point=di},lineEnd:function(){ai&&vi(li,si),pi.point=De},polygonStart:function(){ai=!0},polygonEnd:function(){ai=null},result:function(){var n=+hi;return hi=new t,n}};function di(t,n){pi.point=vi,li=ci=t,si=fi=n}function vi(t,n){ci-=t,fi-=n,hi.add(Xe(ci*ci+fi*fi)),ci=t,fi=n}let gi,yi,_i,mi;class wi{constructor(t){this._append=null==t?bi:function(t){const n=Math.floor(t);if(!(n>=0))throw new RangeError(`invalid digits: ${t}`);if(n>15)return bi;if(n!==gi){const t=10**n;gi=n,yi=function(n){let e=1;this._+=n[0];for(const r=n.length;e<r;++e)this._+=Math.round(arguments[e]*t)/t+n[e]}}return yi}(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:this._append`M${t},${n}`,this._point=1;break;case 1:this._append`L${t},${n}`;break;default:if(this._append`M${t},${n}`,this._radius!==_i||this._append!==yi){const t=this._radius,n=this._;this._="",this._append`m0,${t}a${t},${t} 0 1,1 0,${-2*t}a${t},${t} 0 1,1 0,${2*t}z`,_i=t,yi=this._append,mi=this._,this._=n}this._+=mi}}result(){const t=this._;return this._="",t.length?t:null}}function bi(t){let n=1;this._+=t[0];for(const e=t.length;n<e;++n)this._+=arguments[n]+t[n]}function xi(t){return function(n){var e=new Ei;for(var r in t)e[r]=t[r];return e.stream=n,e}}function Ei(){}function Si(t,n,e){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),null!=r&&t.clipExtent(null),Ve(e,t.stream(Or)),n(Or.result()),null!=r&&t.clipExtent(r),t}function Ni(t,n,e){return Si(t,(function(e){var r=n[1][0]-n[0][0],i=n[1][1]-n[0][1],o=Math.min(r/(e[1][0]-e[0][0]),i/(e[1][1]-e[0][1])),u=+n[0][0]+(r-o*(e[1][0]+e[0][0]))/2,a=+n[0][1]+(i-o*(e[1][1]+e[0][1]))/2;t.scale(150*o).translate([u,a])}),e)}Ei.prototype={constructor:Ei,point:function(t,n){this.stream.point(t,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var ki=16,Mi=qe(30*Pe);function Ai(t,n){return+n?function(t,n){function e(r,i,o,u,a,l,s,c,f,h,p,d,v,g){var y=s-r,_=c-i,m=y*y+_*_;if(m>4*n&&v--){var w=u+h,b=a+p,x=l+d,E=Xe(w*w+b*b+x*x),S=ze(x/=E),N=je(je(x)-1)<Se||je(o-f)<Se?(o+f)/2:Te(b,w),k=t(N,S),M=k[0],A=k[1],$=M-r,C=A-i,P=_*$-y*C;(P*P/m>n||je((y*$+_*C)/m-.5)>.3||u*h+a*p+l*d<Mi)&&(e(r,i,o,u,a,l,M,A,N,w/=E,b/=E,x,v,g),g.point(M,A),e(M,A,N,w,b,x,s,c,f,h,p,d,v,g))}}return function(n){var r,i,o,u,a,l,s,c,f,h,p,d,v={point:g,lineStart:y,lineEnd:m,polygonStart:function(){n.polygonStart(),v.lineStart=w},polygonEnd:function(){n.polygonEnd(),v.lineStart=y}};function g(e,r){e=t(e,r),n.point(e[0],e[1])}function y(){c=NaN,v.point=_,n.lineStart()}function _(r,i){var o=Ue([r,i]),u=t(r,i);e(c,f,s,h,p,d,c=u[0],f=u[1],s=r,h=o[0],p=o[1],d=o[2],ki,n),n.point(c,f)}function m(){v.point=g,n.lineEnd()}function w(){y(),v.point=b,v.lineEnd=x}function b(t,n){_(r=t,n),i=c,o=f,u=h,a=p,l=d,v.point=_}function x(){e(c,f,s,h,p,d,i,o,r,u,a,l,ki,n),v.lineEnd=m,m()}return v}}(t,n):function(t){return xi({point:function(n,e){n=t(n,e),this.stream.point(n[0],n[1])}})}(t)}var $i,Ci=xi({point:function(t,n){this.stream.point(t*Pe,n*Pe)}});function Pi(t,n,e,r,i,o){if(!o)return function(t,n,e,r,i){function o(o,u){return[n+t*(o*=r),e-t*(u*=i)]}return o.invert=function(o,u){return[(o-n)/t*r,(e-u)/t*i]},o}(t,n,e,r,i);var u=qe(o),a=Oe(o),l=u*t,s=a*t,c=u/t,f=a/t,h=(a*e-u*n)/t,p=(a*n+u*e)/t;function d(t,o){return[l*(t*=r)-s*(o*=i)+n,e-s*t-l*o]}return d.invert=function(t,n){return[r*(c*t-f*n+h),i*(p-f*t-c*n)]},d}function ji(t){return function(t){var n,e,r,i,o,u,a,l,s,c,f=150,h=480,p=250,d=0,v=0,g=0,y=0,_=0,m=0,w=1,b=1,x=null,E=vr,S=null,N=Sr,k=.5;function M(t){return l(t[0]*Pe,t[1]*Pe)}function A(t){return(t=l.invert(t[0],t[1]))&&[t[0]*Ce,t[1]*Ce]}function $(){var t=Pi(f,0,0,w,b,m).apply(null,n(d,v)),r=Pi(f,h-t[0],p-t[1],w,b,m);return e=function(t,n,e){return(t%=$e)?n||e?tr(rr(t),ir(n,e)):rr(t):n||e?ir(n,e):nr}(g,y,_),a=tr(n,r),l=tr(e,a),u=Ai(a,k),C()}function C(){return s=c=null,M}return M.stream=function(t){return s&&c===t?s:s=Ci(function(t){return xi({point:function(n,e){var r=t(n,e);return this.stream.point(r[0],r[1])}})}(e)(E(u(N(c=t)))))},M.preclip=function(t){return arguments.length?(E=t,x=void 0,C()):E},M.postclip=function(t){return arguments.length?(N=t,S=r=i=o=null,C()):N},M.clipAngle=function(t){return arguments.length?(E=+t?gr(x=t*Pe):(x=null,vr),C()):x*Ce},M.clipExtent=function(t){return arguments.length?(N=null==t?(S=r=i=o=null,Sr):mr(S=+t[0][0],r=+t[0][1],i=+t[1][0],o=+t[1][1]),C()):null==S?null:[[S,r],[i,o]]},M.scale=function(t){return arguments.length?(f=+t,$()):f},M.translate=function(t){return arguments.length?(h=+t[0],p=+t[1],$()):[h,p]},M.center=function(t){return arguments.length?(d=t[0]%360*Pe,v=t[1]%360*Pe,$()):[d*Ce,v*Ce]},M.rotate=function(t){return arguments.length?(g=t[0]%360*Pe,y=t[1]%360*Pe,_=t.length>2?t[2]%360*Pe:0,$()):[g*Ce,y*Ce,_*Ce]},M.angle=function(t){return arguments.length?(m=t%360*Pe,$()):m*Ce},M.reflectX=function(t){return arguments.length?(w=t?-1:1,$()):w<0},M.reflectY=function(t){return arguments.length?(b=t?-1:1,$()):b<0},M.precision=function(t){return arguments.length?(u=Ai(a,k=t*t),C()):Xe(k)},M.fitExtent=function(t,n){return Ni(M,t,n)},M.fitSize=function(t,n){return function(t,n,e){return Ni(t,[[0,0],n],e)}(M,t,n)},M.fitWidth=function(t,n){return function(t,n,e){return Si(t,(function(e){var r=+n,i=r/(e[1][0]-e[0][0]),o=(r-i*(e[1][0]+e[0][0]))/2,u=-i*e[0][1];t.scale(150*i).translate([o,u])}),e)}(M,t,n)},M.fitHeight=function(t,n){return function(t,n,e){return Si(t,(function(e){var r=+n,i=r/(e[1][1]-e[0][1]),o=-i*e[0][0],u=(r-i*(e[1][1]+e[0][1]))/2;t.scale(150*i).translate([o,u])}),e)}(M,t,n)},function(){return n=t.apply(this,arguments),M.invert=n.invert&&A,$()}}((function(){return t}))()}function Ri(t,n){return[qe(n)*Oe(t),Oe(n)]}function Ti(t,n,e){this.k=t,this.x=n,this.y=e}function qi(t){return t}function Oi(t,n){var e=n.id,r=n.bbox,i=null==n.properties?{}:n.properties,o=function(t,n){var e=function(t){if(null==t)return qi;var n,e,r=t.scale[0],i=t.scale[1],o=t.translate[0],u=t.translate[1];return function(t,a){a||(n=e=0);var l=2,s=t.length,c=new Array(s);for(c[0]=(n+=t[0])*r+o,c[1]=(e+=t[1])*i+u;l<s;)c[l]=t[l],++l;return c}}(t.transform),r=t.arcs;function i(t,n){n.length&&n.pop();for(var i=r[t<0?~t:t],o=0,u=i.length;o<u;++o)n.push(e(i[o],o));t<0&&function(t,n){for(var e,r=t.length,i=r-n;i<--r;)e=t[i],t[i++]=t[r],t[r]=e}(n,u)}function o(t){return e(t)}function u(t){for(var n=[],e=0,r=t.length;e<r;++e)i(t[e],n);return n.length<2&&n.push(n[0]),n}function a(t){for(var n=u(t);n.length<4;)n.push(n[0]);return n}function l(t){return t.map(a)}function s(t){var n,e=t.type;switch(e){case"GeometryCollection":return{type:e,geometries:t.geometries.map(s)};case"Point":n=o(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(o);break;case"LineString":n=u(t.arcs);break;case"MultiLineString":n=t.arcs.map(u);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:e,coordinates:n}}return s(n)}(t,n);return null==e&&null==r?{type:"Feature",properties:i,geometry:o}:null==r?{type:"Feature",id:e,properties:i,geometry:o}:{type:"Feature",id:e,bbox:r,properties:i,geometry:o}}Ri.invert=($i=ze,function(t,n){var e=Xe(t*t+n*n),r=$i(e),i=Oe(r),o=qe(r);return[Te(t*i,e*o),ze(e&&n*i/e)]}),Ti.prototype={constructor:Ti,scale:function(t){return 1===t?this:new Ti(this.k*t,this.x,this.y)},translate:function(t,n){return 0===t&0===n?this:new Ti(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},Ti.prototype;const Li={type:"Topology",objects:{land:{type:"MultiPolygon",arcs:[[[540,266,539],[123,542,536],[592,399,564,457,565,439,78,350,483,355,359,405,532,507,533,18,482,20,481,595,531,379,247,538,254,229,552,554,389,575,445,597,461,8,200,10,203,283,303,191,467,67,563,291,184,412,550,295,301,544,299,543,453,530,428,242,571,416,250,369,410,561,572,288,521,578,511,81,573,305,15,441,323,558,375,281,257,506,255,282,66,470,227,234,222,498,514,422,425,259,523,269,559,473,524,504,400,505,169],[386,520,55,358,567]],[[24,164]],[[556,275],[579,28,165,486,245,206,484,211,468,317,551,309,433,586,139,590,141,585,432,98,311,319,469,213,485,208,591,314,555,277,111]],[[36]],[[37]],[[38]],[[39]],[[40]],[[41]],[[42]],[[43]],[[44]],[[45]],[[46]],[[86]],[[87]],[[88]],[[459,113,460,346]],[[128]],[[129]],[[130]],[[131]],[[132]],[[133]],[[134]],[[135]],[[136]],[[137]],[[142]],[[143]],[[144]],[[145]],[[146]],[[147]],[[148]],[[149]],[[150]],[[151]],[[152]],[[153]],[[154]],[[155]],[[156]],[[157]],[[158]],[[159]],[[160]],[[167]],[[215]],[[216,218]],[[233]],[[235,326]],[[272]],[[273]],[[274]],[[278]],[[286,352]],[[287]],[[304]],[[308]],[[332]],[[334,569]],[[335]],[[336]],[[337]],[[338]],[[339]],[[340]],[[342,496]],[[343]],[[344]],[[347]],[[365]],[[372]],[[373]],[[376]],[[381]],[[382]],[[383]],[[419]],[[431]],[[464]],[[474]],[[475]],[[476]],[[477]],[[478]],[[487]],[[488]],[[489]],[[490]],[[491]],[[492]],[[493]],[[494]],[[495]],[[497]],[[502]],[[513]],[[515]],[[516]],[[517]],[[518]],[[519]],[[525]],[[526]],[[527]],[[545]],[[546]],[[547]],[[548]],[[549]],[[570]],[[574]],[[580]],[[581]],[[582]],[[583]],[[584]],[[587]],[[588]],[[589]],[[593]],[[594]]]}},arcs:[[[67002,72360],[284,-219],[209,77],[58,261],[219,87],[157,175],[55,460],[234,112],[44,205],[131,-154],[84,-18]],[[68477,73346],[154,-4],[210,-122]],[[68841,73220],[85,-70],[201,185],[93,-111],[90,264],[166,-12],[43,84],[29,233],[120,200],[150,-131],[-30,-176],[84,-27],[-26,-484],[110,-189],[97,121],[123,57],[173,258],[192,-42],[286,-1]],[[70827,73379],[50,-165]],[[70877,73214],[-162,-65],[-141,-106],[-319,-67],[-298,-121],[-163,-251],[66,-244],[32,-287],[-139,-242],[12,-221],[-76,-207],[-265,18],[110,-381],[-177,-146],[-118,-347],[15,-346],[-108,-162],[-103,53],[-212,-75],[-31,-161],[-207,1],[-154,-326],[-10,-490],[-361,-239],[-194,50],[-56,-126],[-166,74],[-278,-87],[-465,294]],[[66909,69007],[252,523],[-23,370],[-210,97],[-22,366],[-91,460],[119,315],[-121,85],[76,419],[113,718]],[[56642,45537],[29,-179],[-32,-279],[49,-270],[-41,-216],[24,-199],[-579,7],[-13,-1832],[188,-471],[181,-360]],[[56448,41738],[-510,-235],[-673,82],[-192,276],[-1126,-25],[-42,-40],[-166,260],[-180,17],[-166,-98],[-134,-110]],[[53259,41865],[-26,363],[38,506],[96,527],[15,247],[90,519],[66,236],[159,377],[90,256],[29,427],[-15,326],[-83,206],[-74,350],[-68,345],[15,120],[85,228],[-84,557],[-57,385],[-139,364],[26,112]],[[53422,48316],[115,78],[80,-11],[98,69],[820,-7],[68,-430],[80,-345],[64,-186],[106,-301],[184,46],[91,81],[154,-81],[42,144],[69,336],[172,22],[15,100],[142,2],[-24,-207],[337,5],[5,-363],[56,-222],[-41,-347],[21,-354],[93,-214],[-15,-685],[68,53],[121,-15],[172,87],[127,-34]],[[53383,48495],[-74,433]],[[53309,48928],[112,249],[84,97],[104,-198]],[[53609,49076],[-101,-121],[-45,-148],[-9,-251],[-71,-61]],[[55719,75933],[-35,-196],[39,-247],[115,-140]],[[55838,75350],[-5,-151],[-91,-84],[-16,-187],[-129,-279]],[[55597,74649],[-48,40],[-5,127],[-154,193],[-24,274],[23,393],[38,179],[-47,91]],[[55380,75946],[-18,183],[120,284],[18,-109],[75,51]],[[55575,76355],[59,-154],[66,-59],[19,-209]],[[64327,65792],[49,28],[11,-158],[217,91],[230,-15],[168,-17],[190,389],[207,369],[176,355]],[[65575,66834],[52,-196]],[[65627,66638],[38,-455]],[[65665,66183],[-142,-2],[-23,-375],[50,-80],[-126,-114],[-1,-235],[-81,-238],[-7,-232]],[[65335,64907],[-56,-122],[-835,290],[-106,584],[-11,133]],[[31400,20215],[-168,16],[-297,0],[0,1286]],[[30935,21517],[106,-267],[139,-432],[361,-345],[389,-144],[-125,-288],[-264,-29],[-141,203]],[[32587,39017],[511,-940],[227,-88],[339,-425],[286,-225],[40,-254],[-273,-876],[280,-156],[312,-88],[220,92],[252,441],[45,509]],[[34826,37007],[138,110],[139,-332],[-6,-460],[-234,-318],[-186,-234],[-314,-559],[-370,-786]],[[33993,34428],[-70,-461],[-74,-592],[3,-573],[-61,-128],[-21,-372]],[[33770,32302],[-19,-301],[353,-493],[-38,-397],[173,-251],[-14,-282],[-267,-738],[-412,-309],[-557,-120],[-305,58],[59,-343],[-57,-431],[51,-291],[-167,-202],[-284,-80],[-267,210],[-108,-151],[39,-572],[188,-173],[152,181],[82,-299],[-255,-179],[-223,-358],[-41,-579],[-66,-309],[-262,-1],[-218,-295],[-80,-432],[273,-422],[266,-116],[-96,-517],[-328,-325],[-180,-675],[-254,-227],[-113,-270],[89,-598],[185,-333],[-117,29]],[[30952,21711],[-257,90],[-672,77],[-115,336],[6,431],[-185,-37],[-98,209],[-24,611],[213,253],[88,365],[-33,292],[148,491],[101,763],[-30,338],[122,109],[-30,217],[-129,115],[92,242],[-126,218],[-65,665],[112,117],[-47,702],[65,590],[75,513],[166,209],[-84,563],[-1,529],[210,376],[-7,481],[159,562],[1,530],[-72,105],[-128,994],[171,592],[-27,558],[100,523],[182,540],[196,358],[-83,226],[58,186],[-9,960],[302,284],[96,598],[-34,144]],[[31359,38736],[231,521],[364,-141],[163,-416],[109,464],[316,-24],[45,-123]],[[62106,75494],[386,89]],[[62492,75583],[57,-151],[106,-100],[-56,-144],[148,-198],[-78,-183],[118,-157],[124,-94],[7,-399]],[[62918,74157],[-101,-17]],[[62817,74140],[-113,333],[1,89],[-123,-2],[-82,155],[-58,-16]],[[62442,74699],[-109,168],[-207,144],[27,280],[-47,203]],[[33452,5736],[-82,-294],[-81,-259],[-582,79],[-621,-34],[-348,192],[0,22],[-152,170],[625,-23],[599,-56],[207,237],[147,203],[288,-237]],[[5775,6048],[-533,-79],[-364,204],[-163,203],[-11,34],[-180,158],[169,214],[517,-90],[277,-181],[212,-203],[76,-260]],[[37457,6883],[342,-248],[120,-350],[33,-248],[11,-293],[-430,-181],[-452,-146],[-522,-136],[-582,-113],[-658,34],[-365,192],[49,237],[593,158],[239,192],[174,248],[126,214],[168,203],[180,238],[0,-1],[141,0],[414,125],[419,-125]],[[16330,9501],[359,-90],[332,102],[-158,-203],[-261,-147],[-386,45],[-278,203],[60,192],[332,-102]],[[15122,9513],[425,-226],[-164,23],[-359,56],[-381,158],[202,124],[277,-135]],[[22505,10404],[305,-79],[304,68],[163,-327],[-217,45],[-337,-23],[-343,23],[-376,-34],[-283,113],[-146,237],[174,101],[353,-79],[403,-45]],[[30985,10967],[33,-259],[-49,-226],[-76,-214],[-326,-79],[-311,-113],[-364,11],[136,226],[-327,-79],[-310,-79],[-212,169],[-16,237],[305,226],[190,67],[321,-22],[82,293],[16,215],[-6,462],[158,271],[256,90],[147,-214],[65,-214],[120,-260],[92,-248],[76,-260]],[[0,3044],[16,-4],[245,335],[501,-181],[32,21],[294,183],[38,-6],[32,-5],[402,-239],[352,239],[63,33],[816,102],[265,-135],[130,-68],[419,-192],[789,-147],[625,-180],[1072,-136],[800,158],[1181,-113],[669,-180],[734,169],[773,158],[60,271],[-1094,22],[-898,136],[-234,225],[-745,125],[49,259],[103,237],[104,214],[-55,237],[-462,158],[-212,204],[-430,180],[675,-34],[642,91],[402,-192],[495,169],[457,214],[223,192],[-98,237],[-359,158],[-408,169],[-571,34],[-500,79],[-539,57],[-180,214],[-359,181],[-217,203],[-87,654],[136,-56],[250,-181],[457,57],[441,79],[228,-249],[441,57],[370,124],[348,158],[315,192],[419,56],[-11,215],[-97,214],[81,203],[359,102],[163,-192],[425,113],[321,146],[397,12],[375,56],[376,136],[299,124],[337,124],[218,-34],[190,-45],[414,79],[370,-102],[381,12],[364,79],[375,-57],[414,-56],[386,22],[403,-11],[413,-11],[381,22],[283,170],[337,90],[349,-124],[331,101],[300,203],[179,-180],[98,-203],[180,-192],[288,169],[332,-214],[375,-68],[321,-158],[392,34],[354,101],[418,-22],[376,-79],[381,-102],[147,249],[-180,191],[-136,204],[-359,45],[-158,214],[-60,214],[-98,429],[213,-79],[364,-34],[359,34],[327,-90],[283,-169],[119,-203],[376,-34],[359,79],[381,113],[342,67],[283,-135],[370,45],[239,440],[224,-259],[321,-102],[348,56],[228,-225],[365,-23],[337,-68],[332,-124],[218,215],[108,203],[278,-226],[381,57],[283,-125],[190,-191],[370,56],[288,124],[283,147],[337,79],[392,68],[354,79],[272,124],[163,180],[65,249],[-32,236],[-87,226],[-98,226],[-87,226],[-71,203],[-16,225],[27,226],[130,214],[109,237],[44,226],[-55,248],[-32,226],[136,260],[152,169],[180,214],[190,181],[223,169],[109,248],[152,158],[174,147],[267,34],[174,180],[196,113],[228,68],[202,147],[157,180],[218,68],[163,-147],[-103,-192],[-283,-169],[-120,-124],[-206,90],[-229,-56],[-190,-136],[-202,-146],[-136,-170],[-38,-225],[17,-215],[130,-191],[-190,-136],[-261,-45],[-153,-192],[-163,-180],[-174,-249],[-44,-214],[98,-237],[147,-181],[229,-135],[212,-181],[114,-225],[60,-215],[82,-225],[130,-192],[82,-215],[38,-530],[81,-214],[22,-226],[87,-226],[-38,-304],[-152,-237],[-163,-192],[-370,-79],[-125,-203],[-169,-192],[-419,-215],[-370,-90],[-348,-124],[-376,-124],[-223,-237],[-446,-23],[-489,23],[-441,-45],[-468,0],[87,-226],[424,-101],[311,-158],[174,-204],[-310,-180],[-479,56],[-397,-146],[-17,-237],[-11,-226],[327,-192],[60,-214],[353,-215],[588,-90],[500,-158],[398,-180],[506,-181],[690,-90],[681,-158],[473,-170],[517,-191],[272,-271],[136,-215],[337,204],[457,169],[484,180],[577,147],[495,158],[691,11],[680,-79],[560,-135],[180,248],[386,169],[702,12],[550,124],[522,124],[577,79],[614,102],[430,146],[-196,203],[-119,203],[0,215],[-539,-23],[-571,-90],[-544,0],[-77,214],[39,429],[125,124],[397,136],[468,135],[337,169],[337,170],[251,225],[380,102],[376,79],[190,45],[430,23],[408,79],[343,112],[337,136],[305,135],[386,181],[245,192],[261,169],[82,226],[-294,135],[98,237],[185,181],[288,112],[305,136],[283,180],[217,226],[136,271],[202,158],[331,-34],[136,-192],[332,-22],[11,214],[142,226],[299,-57],[71,-214],[331,-34],[360,102],[348,67],[315,-34],[120,-237],[305,192],[283,102],[315,79],[310,79],[283,135],[310,91],[240,124],[168,203],[207,-147],[288,79],[202,-271],[157,-203],[316,113],[125,226],[283,158],[365,-34],[108,-215],[229,215],[299,68],[326,22],[294,-11],[310,-68],[300,-34],[130,-192],[180,-169],[304,102],[327,22],[315,0],[310,12],[278,79],[294,67],[245,158],[261,102],[283,56],[212,158],[152,316],[158,192],[288,-90],[109,-203],[239,-136],[289,45],[196,-203],[206,-146],[283,135],[98,248],[250,102],[289,192],[272,79],[326,112],[218,125],[228,135],[218,124],[261,-68],[250,203],[180,158],[261,-11],[229,136],[54,203],[234,158],[228,113],[278,90],[256,45],[244,-34],[262,-56],[223,-158],[27,-249],[245,-191],[168,-158],[332,-68],[185,-158],[229,-158],[266,-34],[223,113],[240,237],[261,-124],[272,-68],[261,-68],[272,-45],[277,0],[229,-598],[-11,-147],[-33,-259],[-266,-147],[-218,-214],[38,-226],[310,11],[-38,-225],[-141,-215],[-131,-237],[212,-180],[321,-57],[321,102],[153,226],[92,214],[153,181],[174,169],[70,203],[147,282],[174,57],[316,22],[277,68],[283,90],[136,226],[82,214],[190,215],[272,146],[234,113],[153,192],[157,101],[202,91],[277,-57],[250,57],[272,67],[305,-33],[201,158],[142,383],[103,-158],[131,-271],[234,-112],[266,-46],[267,68],[283,-45],[261,-11],[174,56],[234,-34],[212,-124],[250,79],[300,0],[255,79],[289,-79],[185,192],[141,192],[191,158],[348,429],[179,-79],[212,-158],[185,-203],[354,-350],[272,-12],[256,0],[299,68],[299,79],[229,158],[190,169],[310,23],[207,124],[218,-113],[141,-180],[196,-181],[305,23],[190,-147],[332,-147],[348,-56],[288,45],[218,181],[185,180],[250,45],[251,-79],[288,-56],[261,90],[250,0],[245,-56],[256,-57],[250,102],[299,90],[283,23],[316,0],[255,56],[251,45],[76,282],[11,237],[174,-158],[49,-259],[92,-237],[115,-192],[234,-102],[315,34],[365,12],[250,33],[364,0],[262,12],[364,-23],[310,-45],[196,-181],[-54,-214],[179,-169],[299,-136],[310,-146],[360,-102],[375,-90],[283,-90],[315,-12],[180,192],[245,-158],[212,-180],[245,-136],[337,-56],[321,-68],[136,-226],[316,-135],[212,-203],[310,-90],[321,11],[299,-34],[332,11],[332,-45],[310,-79],[288,-135],[289,-113],[195,-169],[-32,-226],[-147,-203],[-125,-260],[-98,-203],[-131,-237],[-364,-90],[-163,-203],[-360,-124],[-125,-226],[-190,-214],[-201,-181],[-115,-237],[-70,-214],[-28,-260],[6,-214],[158,-226],[60,-214],[130,-204],[517,-78],[109,-249],[-501,-90],[-424,-124],[-528,-23],[-234,-327],[-49,-271],[-119,-214],[-147,-215],[370,-191],[141,-237],[239,-215],[338,-192],[386,-180],[419,-181],[636,-180],[142,-282],[800,-125],[53,-44],[208,-170],[767,147],[636,-181],[-99520,-139]],[[69148,23827],[179,-181],[263,-72],[9,-110],[-77,-262],[-427,-37],[-7,306],[41,238],[19,118]],[[90387,28338],[269,-199],[151,79],[217,111],[166,-39],[20,-684],[-95,-198],[-29,-463],[-97,157],[-193,-401],[-57,31],[-171,18],[-171,493],[-38,380],[-160,502],[7,264],[181,-51]],[[89877,43903],[100,-452],[179,217],[92,-243],[133,-225],[-29,-255],[60,-494],[42,-288],[70,-70],[75,-492],[-27,-299],[90,-390],[301,-301],[197,-274],[186,-251],[-37,-139],[159,-361],[108,-623],[111,126],[113,-249],[68,88],[48,-610],[197,-354],[129,-220],[217,-466],[78,-463],[7,-328],[-19,-356],[132,-490],[-16,-509],[-48,-267],[-75,-514],[6,-330],[-55,-413],[-123,-524],[-205,-283],[-102,-446],[-93,-284],[-82,-497],[-107,-287],[-70,-431],[-36,-397],[14,-182],[-159,-200],[-311,-21],[-257,-236],[-127,-223],[-168,-248],[-230,255],[-170,101],[43,301],[-152,-109],[-243,-417],[-240,156],[-158,91],[-159,41],[-269,167],[-179,355],[-52,437],[-64,291],[-137,233],[-267,70],[91,279],[-67,428],[-136,-399],[-247,-106],[146,319],[42,332],[107,282],[-22,427],[-226,-491],[-174,-197],[-106,-458],[-217,237],[9,305],[-174,418],[-147,216],[52,133],[-356,349],[-195,16],[-267,280],[-498,-54],[-359,-206],[-317,-192],[-265,38],[-294,-296],[-241,-132],[-53,-302],[-103,-234],[-236,-14],[-174,-52],[-246,105],[-199,-62],[-191,-27],[-165,-307],[-81,26],[-140,-163],[-133,-183],[-203,23],[-186,0],[-295,368],[-149,109],[6,330],[138,79],[47,131],[-10,207],[34,400],[-31,341],[-147,582],[-45,329],[12,328],[-111,375],[-7,169],[-123,230],[-35,451],[-158,456],[-39,245],[122,-249],[-93,535],[137,-167],[83,-223],[-5,294],[-138,454],[-26,181],[-65,173],[31,333],[56,141],[38,289],[-29,336],[114,415],[21,-439],[118,396],[225,193],[136,245],[212,212],[126,45],[77,-71],[219,214],[168,64],[42,126],[74,53],[153,-14],[292,169],[151,256],[71,307],[163,293],[13,229],[7,314],[194,489],[117,-497],[119,115],[-99,272],[87,279],[122,-125],[34,439],[152,283],[67,227],[140,98],[4,161],[122,-67],[5,145],[122,82],[134,78],[205,-264],[155,-342],[173,-3],[177,-54],[-59,316],[133,462],[126,150],[-44,144],[121,329],[168,203],[142,-68],[234,108],[-5,294],[-204,190],[148,84],[184,-143],[148,-236],[234,-148],[79,59],[172,-177],[162,164],[105,-50],[65,111],[127,-285],[-74,-308],[-105,-233],[-96,-19],[32,-230],[-81,-288],[-99,-283],[20,-163],[221,-318],[214,-184],[143,-199],[201,-341],[78,1],[145,-148],[43,-178],[265,-195],[183,197],[55,309],[56,255],[34,316],[85,458],[-39,279],[20,167],[-32,330],[37,434],[53,117],[-43,192],[67,305],[52,317],[7,164],[104,216],[78,-282],[19,-361],[70,-70],[11,-242],[101,-293],[21,-326],[-10,-209]],[[54716,79543],[-21,-236],[-156,-1],[53,-125],[-92,-370]],[[54500,78811],[-53,-97],[-243,-15],[-140,-130],[-229,44]],[[53835,78613],[-398,149],[-62,200],[-274,-100],[-32,-109],[-169,81]],[[52900,78834],[-142,16],[-125,105],[42,141],[-10,102]],[[52665,79198],[83,32],[141,-160],[39,152],[245,-25],[199,104],[133,-18],[87,-118],[26,98],[-40,375],[100,73],[98,266]],[[53776,79977],[206,-186],[157,236],[98,43],[215,-176],[131,30],[128,-109]],[[54711,79815],[-23,-73],[28,-199]],[[62817,74140],[-190,76],[-141,266],[-44,217]],[[63495,75906],[146,-303],[141,-408],[130,-27],[85,-156],[-228,-46],[-49,-447],[-48,-202],[-101,-135],[7,-285]],[[63578,73897],[-69,-28],[-173,301],[95,285],[-82,169],[-104,-43],[-327,-424]],[[62492,75583],[68,94],[207,-165],[149,-34],[38,67],[-136,312],[72,79]],[[62890,75936],[78,-19],[191,-350],[122,-39],[48,146],[166,232]],[[58149,49238],[-17,694],[-70,262]],[[58062,50194],[169,-45],[85,328],[147,-38]],[[58463,50439],[16,-227],[60,-130],[3,-187],[-69,-121],[-108,-300],[-101,-209],[-115,-27]],[[50920,81398],[204,-45],[257,120],[176,-252],[153,-135]],[[51710,81086],[-32,-389]],[[51678,80697],[-72,-22],[-30,-323]],[[51576,80352],[-243,263],[-143,-45],[-194,272],[-129,231],[-129,9],[-40,203]],[[50698,81285],[222,113]],[[50747,55434],[-229,-68]],[[50518,55366],[-69,398],[13,1322],[-56,119],[-11,283],[-96,201],[-85,170],[35,303]],[[50249,58162],[96,66],[56,251],[136,54],[61,172]],[[50598,58705],[93,169],[100,2],[212,-332]],[[51003,58544],[-11,-191],[62,-342],[-54,-232],[29,-154],[-135,-357],[-86,-176],[-52,-364],[7,-366],[-16,-928]],[[49214,57382],[-190,149],[-130,-22],[-97,-145],[-125,122],[-49,190],[-125,126]],[[48498,57802],[-18,334],[76,244],[-7,195],[221,477],[41,395],[76,141],[134,-78],[116,117],[38,148],[216,259],[53,180],[259,238],[153,82],[70,-110],[178,3]],[[50104,60427],[-22,-280],[37,-262],[156,-376],[9,-279],[320,-130],[-6,-395]],[[50249,58162],[-243,13]],[[50006,58175],[-128,46],[-90,-93],[-123,42],[-482,-27],[-7,-327],[38,-434]],[[75742,64522],[-6,-413],[-97,88],[18,-464]],[[75657,63733],[-79,301],[-16,293],[-53,277],[-116,335],[-256,23],[25,-237],[-87,-321],[-118,117],[-41,-105],[-78,63],[-108,52]],[[74730,64531],[-43,474],[-96,433],[47,347],[-171,154],[62,210],[173,215],[-200,305],[98,390],[220,-248],[133,-29],[24,-400],[265,-79],[257,8],[160,-98],[-128,-487],[-124,-34],[-86,-327],[152,-299],[46,368],[76,2],[147,-914]],[[56293,77303],[80,-236],[108,42],[213,-90],[408,-30],[138,147],[327,133],[202,-209],[163,-60]],[[57932,77e3],[-144,-239],[-101,-412],[89,-328]],[[57776,76021],[-239,77],[-283,-181]],[[57254,75917],[-3,-287],[-252,-55],[-196,202],[-222,-159],[-206,17]],[[56375,75635],[-20,381],[-139,185]],[[56216,76201],[46,81],[-30,69],[47,183],[105,180],[-135,248],[-24,211],[68,130]],[[28462,65512],[-68,-29],[-70,332],[-104,167],[60,365],[84,-23],[97,-478],[1,-334]],[[28383,67136],[-303,-92],[-19,213],[130,46],[184,-17],[8,-150]],[[28611,67142],[-48,-409],[-51,73],[4,301],[-124,228],[-1,66],[220,-259]],[[55279,77663],[100,2],[-69,-253],[134,-222],[-41,-271],[-65,-25]],[[55338,76894],[-52,-53],[-90,-134],[-41,-316]],[[55155,76391],[-246,218],[-105,240],[-106,128],[-127,215],[-61,178],[-136,270],[59,239],[99,-133],[60,120],[130,13],[239,-96],[192,8],[126,-128]],[[56523,82877],[268,-4],[302,217],[64,325],[228,184],[-26,258]],[[57359,83857],[169,97],[298,222]],[[57826,84176],[293,-144],[39,-143],[146,68],[272,-137],[27,-270],[-60,-156],[174,-377],[113,-105],[-16,-104],[187,-101],[80,-154],[-108,-126],[-224,20],[-54,-53],[66,-192],[68,-368]],[[58829,81834],[-239,-34],[-85,-127],[-18,-290],[-111,56],[-250,-28],[-73,135],[-104,-100],[-105,83],[-218,11],[-310,139],[-281,45],[-215,-13],[-152,-156],[-133,-23]],[[56535,81532],[-6,257],[-85,267],[166,117],[2,230],[-77,219],[-12,255]],[[25238,62085],[-2,85],[33,26],[51,-68],[99,348],[53,7]],[[25472,62483],[1,-84],[53,-3],[-5,-157],[-45,-249],[24,-89],[-29,-206],[18,-55],[-32,-291],[-55,-153],[-50,-18],[-55,-199]],[[25297,60979],[-83,-1],[22,650],[2,457]],[[31359,38736],[-200,-79],[-109,794],[-150,646],[88,557],[-146,244],[-37,416],[-136,391]],[[30669,41705],[175,622],[-119,484],[63,194],[-49,213],[108,288],[6,490],[13,405],[60,195],[-240,926]],[[30686,45522],[206,-48],[143,12],[62,174],[243,234],[147,216],[363,98],[-29,-432],[34,-221],[-23,-386],[302,-516],[311,-95],[109,-216],[188,-114],[115,-167],[175,6],[161,-171],[12,-333],[55,-168],[3,-248],[-81,-10],[107,-671],[533,-23],[-41,-333],[30,-227],[151,-162],[66,-358],[-49,-453],[-77,-253],[27,-328],[-87,-119]],[[33842,40210],[-4,177],[-259,295],[-258,8],[-484,-167],[-133,-507],[-7,-310],[-110,-689]],[[34826,37007],[54,332],[38,340],[0,317],[-100,105],[-104,-94],[-103,26],[-33,222],[-26,527],[-52,172],[-187,156],[-114,-113],[-293,111],[18,782],[-82,320]],[[30686,45522],[-157,-99],[-126,66],[18,875],[-228,-339],[-245,15],[-105,307],[-184,33],[59,247],[-155,351],[-115,518],[73,106],[0,243],[168,166],[-28,312],[71,200],[20,269],[318,392],[227,111],[37,86],[251,-27]],[[30585,49354],[125,1579],[6,250],[-43,330],[-123,210],[1,418],[156,95],[56,-60],[9,221],[-162,60],[-4,360],[541,-13],[92,198],[77,-182],[55,-340],[52,71]],[[31423,52551],[153,-304],[216,37],[54,176],[206,135],[115,94],[32,244],[198,164],[-15,121],[-235,49],[-39,363],[12,386],[-125,149],[52,53],[206,-73],[221,-144],[80,136],[200,89],[310,216],[102,220],[-37,162]],[[33129,54824],[145,26],[64,-133],[-36,-253],[96,-87],[63,-268],[-77,-203],[-44,-490],[71,-291],[20,-267],[171,-270],[137,-28],[30,112],[88,25],[126,101],[90,153],[154,-48],[67,20]],[[34294,52923],[151,-47],[25,118],[-46,114],[28,167],[112,-51],[131,59],[159,-122]],[[34854,53161],[121,-119],[86,156],[62,-24],[38,-162],[133,41],[107,219],[85,424],[164,527]],[[35650,54223],[95,27],[69,-318],[155,-1008],[149,-95],[7,-397],[-208,-474],[86,-174],[491,-90],[10,-578],[211,378],[349,-207],[462,-351],[135,-338],[-45,-319],[323,178],[540,-305],[415,23],[411,-477],[355,-645],[214,-166],[237,-23],[101,-182],[94,-733],[46,-348],[-110,-953],[-142,-376],[-391,-801],[-177,-651],[-206,-499],[-69,-11],[-78,-424],[20,-1079],[-77,-888],[-30,-379],[-88,-228],[-49,-769],[-282,-752],[-47,-595],[-225,-250],[-65,-345],[-302,2],[-437,-222],[-195,-256],[-311,-168],[-327,-459],[-235,-571],[-41,-430],[46,-318],[-51,-582],[-63,-281],[-195,-317],[-308,-1013],[-244,-457],[-189,-269],[-127,-548],[-183,-329]],[[35174,32383],[-77,326],[122,273],[-160,392],[-218,318],[-286,369],[-103,-17],[-279,446],[-180,-62]],[[81723,54436],[110,215],[236,316]],[[82069,54967],[-13,-284],[-16,-368],[-133,18],[-58,-196],[-126,299]],[[75471,67823],[113,-184],[-20,-354],[-227,-17],[-234,39],[-175,-90],[-252,218],[-6,115]],[[74670,67550],[184,429],[150,146],[198,-134],[147,-14],[122,-154]],[[58175,39107],[-393,-424],[-249,-430],[-93,-383],[-83,-217],[-152,-46],[-48,-275],[-28,-180],[-178,-134],[-226,28],[-133,162],[-117,70],[-135,-134],[-68,-276],[-132,-173],[-139,-257],[-199,-59],[-62,202],[26,351],[-165,548],[-75,86]],[[55526,37566],[0,1681],[274,20],[8,2051],[207,19],[428,202],[106,-238],[177,226],[85,1],[156,130]],[[56967,41658],[50,-43]],[[57017,41615],[107,-460],[56,-103],[87,-333],[315,-633],[119,-62],[0,-203],[82,-365],[215,-88],[177,-261]],[[54244,56103],[229,44],[52,148],[46,-11],[69,-131],[350,221],[118,224],[145,202],[-28,202],[78,53],[269,-35],[261,266],[201,629],[141,233],[176,98]],[[56351,58246],[31,-246],[160,-360],[1,-235],[-45,-240],[18,-179],[96,-166]],[[56612,56820],[212,-252]],[[56824,56568],[152,-232],[2,-188],[187,-299],[116,-250],[70,-345],[208,-228],[44,-183]],[[57603,54843],[-91,-61],[-178,14],[-209,60],[-104,-49],[-41,-140],[-90,-17],[-110,121],[-309,-287],[-127,58],[-38,-45],[-83,-347],[-207,112],[-203,57],[-177,212],[-229,196],[-149,-186],[-108,-292],[-25,-402]],[[55125,53847],[-178,33],[-188,96],[-166,-305],[-146,-536]],[[54447,53135],[-29,167],[-12,263],[-127,185],[-103,297],[-23,207],[-132,301],[23,171],[-28,243],[21,446],[67,105],[140,583]],[[32315,78637],[202,-78],[257,16],[-137,-236],[-102,-37],[-353,244],[-69,193],[105,177],[97,-279]],[[32831,80108],[-135,-10],[-360,180],[-258,272],[96,49],[365,-145],[284,-240],[8,-106]],[[15692,79765],[-140,-80],[-456,262],[-84,204],[-248,202],[-50,164],[-286,103],[-107,314],[24,133],[291,-125],[171,-88],[261,-61],[94,-198],[138,-274],[277,-238],[115,-318]],[[34407,81019],[-184,-504],[181,195],[187,-124],[-98,-200],[247,-158],[128,140],[277,-177],[-86,-422],[194,99],[36,-306],[86,-358],[-117,-507],[-125,-21],[-183,109],[60,471],[-77,73],[-322,-499],[-166,20],[196,270],[-267,140],[-298,-34],[-539,17],[-43,171],[173,202],[-121,157],[234,347],[287,917],[172,328],[241,198],[129,-25],[-54,-156],[-148,-363]],[[13005,83025],[131,-75],[267,46],[-84,-654],[242,-463],[-111,1],[-167,264],[-103,265],[-140,179],[-51,253],[16,184]],[[27981,87625],[-108,-302],[-123,49],[-73,171],[13,40],[107,173],[114,-13],[70,-118]],[[27250,87943],[-325,-317],[-196,13],[-61,156],[207,265],[381,-5],[-6,-112]],[[26344,89640],[51,-253],[143,89],[161,-151],[304,-198],[318,-179],[25,-274],[204,45],[199,-191],[-247,-181],[-432,138],[-156,259],[-275,-306],[-396,-298],[-95,337],[-377,-55],[242,284],[35,454],[95,527],[201,-47]],[[28926,90499],[-312,-29],[-69,282],[118,323],[255,80],[217,-160],[3,-246],[-32,-80],[-180,-170]],[[23431,91627],[-173,-202],[-374,175],[-226,-63],[-380,259],[245,178],[194,250],[295,-164],[166,-103],[84,-110],[169,-220]],[[31350,77823],[-181,326],[0,785],[-123,166],[-187,-98],[-92,152],[-212,-435],[-84,-448],[-99,-262],[-118,-89],[-89,-29],[-28,-142],[-512,-1],[-422,-4],[-125,-106],[-294,-414],[-34,-45],[-89,-225],[-255,0],[-273,-2],[-125,-91],[44,-113],[25,-176],[-5,-58],[-363,-287],[-286,-90],[-323,-308],[-70,0],[-94,91],[-31,82],[6,60],[61,202],[131,317],[81,340],[-56,500],[-59,523],[-290,270],[35,103],[-41,70],[-76,0],[-56,91],[-14,137],[-54,-60],[-75,18],[17,57],[-65,57],[-27,151],[-216,185],[-224,191],[-272,223],[-261,209],[-248,-163],[-91,-6],[-342,150],[-225,-75],[-269,179],[-284,91],[-194,36],[-86,97],[-49,317],[-94,-3],[-1,-221],[-575,0],[-951,0],[-944,-1],[-833,1],[-834,0],[-819,0],[-847,0],[-273,0],[-825,0],[-788,0]],[[15878,80048],[-38,1],[-537,566],[-199,248],[-503,239],[-155,510],[40,353],[-356,245],[-48,464],[-336,419],[-6,296]],[[13740,83389],[154,278],[-7,363],[-473,367],[-284,657],[-173,413],[-255,259],[-187,236],[-147,298],[-279,-187],[-270,-321],[-247,378],[-194,252],[-271,160],[-273,17],[1,3279],[2,2137]],[[10837,91975],[518,-139],[438,-277],[289,-53],[244,241],[336,179],[413,-70],[416,253],[455,144],[191,-239],[207,134],[62,272],[192,-62],[470,-516],[369,390],[38,-437],[341,95],[105,168],[337,-33],[424,-242],[650,-211],[383,-98],[272,37],[374,-292],[-390,-286],[502,-123],[750,68],[236,100],[296,-345],[302,291],[-283,245],[179,197],[338,26],[223,58],[224,-138],[279,-312],[310,46],[491,-260],[431,91],[405,-13],[-32,358],[247,100],[431,-195],[-2,-545],[177,459],[223,-15],[126,579],[-298,355],[-324,233],[22,636],[329,418],[366,-92],[281,-255],[378,-649],[-247,-283],[517,-116],[-1,-589],[371,451],[332,-371],[-83,-427],[269,-388],[290,416],[202,497],[16,632],[394,-44],[411,-85],[373,-286],[17,-285],[-207,-307],[196,-309],[-36,-280],[-544,-403],[-386,-88],[-287,173],[-83,-289],[-268,-486],[-81,-252],[-322,-389],[-397,-38],[-220,-244],[-18,-374],[-323,-72],[-340,-467],[-301,-648],[-108,-454],[-16,-669],[409,-96],[125,-539],[130,-437],[388,114],[517,-250],[277,-219],[199,-272],[348,-158],[294,-243],[459,-33],[302,-56],[-45,-499],[86,-578],[201,-645],[414,-547],[214,188],[150,592],[-145,909],[-196,303],[445,270],[314,404],[154,401],[-23,385],[-188,489],[-338,434],[328,603],[-121,522],[-93,899],[194,133],[476,-157],[286,-56],[230,152],[258,-196],[342,-333],[85,-224],[495,-44],[-8,-483],[92,-728],[254,-90],[201,-339],[402,319],[266,636],[184,267],[216,-514],[362,-734],[307,-691],[-112,-362],[370,-325],[250,-329],[442,-149],[179,-183],[110,-488],[216,-76],[112,-217],[20,-647],[-202,-217],[-199,-202],[-458,-205],[-349,-473],[-470,-93],[-594,121],[-417,4],[-287,-40],[-233,-413],[-354,-255],[-401,-762],[-320,-532],[236,95],[446,756],[583,480],[415,58],[246,-283],[-262,-387],[88,-620],[91,-435],[361,-287],[459,83],[278,647],[19,-417],[180,-209],[-344,-377],[-615,-343],[-276,-233],[-310,-415],[-211,43],[-11,487],[483,476],[-445,-19],[-309,-70]],[[18287,93939],[-139,-270],[618,174],[386,-291],[314,294],[254,-188],[227,-566],[140,238],[-197,590],[244,85],[276,-93],[311,-232],[175,-561],[86,-406],[466,-285],[502,-273],[-31,-253],[-456,-47],[178,-221],[-94,-211],[-503,90],[-478,156],[-322,-35],[-522,-196],[-704,-86],[-494,-54],[-151,271],[-379,157],[-246,-64],[-343,456],[185,61],[429,99],[392,-26],[362,100],[-537,135],[-594,-46],[-394,11],[-146,213],[644,230],[-428,-8],[-485,152],[233,431],[193,229],[744,351],[284,-111]],[[20972,94111],[-244,-381],[-434,404],[95,80],[372,23],[211,-126]],[[28794,93928],[25,-159],[-296,16],[-299,13],[-304,-78],[-80,35],[-306,306],[12,207],[133,38],[636,-62],[479,-316]],[[25955,93959],[219,-359],[256,465],[704,236],[477,-596],[-42,-377],[550,168],[263,228],[616,-291],[383,-274],[36,-252],[515,131],[290,-367],[670,-228],[242,-232],[263,-539],[-510,-268],[654,-376],[441,-127],[400,-529],[437,-38],[-87,-404],[-487,-669],[-342,246],[-437,554],[-359,-72],[-35,-330],[292,-335],[377,-265],[114,-153],[181,-570],[-96,-414],[-350,156],[-697,461],[393,-496],[289,-348],[45,-201],[-753,230],[-596,334],[-337,281],[97,162],[-414,296],[-405,280],[5,-167],[-803,-92],[-235,198],[183,424],[522,10],[571,74],[-92,205],[96,287],[360,561],[-77,255],[-107,197],[-425,280],[-563,196],[178,145],[-294,358],[-245,33],[-219,196],[-149,-170],[-503,-74],[-1011,129],[-588,169],[-450,87],[-231,202],[290,263],[-394,2],[-88,583],[213,515],[286,235],[717,154],[-204,-373]],[[22123,94355],[331,-122],[496,73],[72,-167],[-259,-276],[420,-248],[-50,-518],[-455,-223],[-268,48],[-192,220],[-690,444],[5,185],[567,-72],[-306,377],[329,279]],[[24112,93737],[-298,-430],[-317,21],[-173,506],[4,287],[145,244],[276,157],[579,-20],[530,-140],[-415,-513],[-331,-112]],[[16539,92938],[-731,-278],[-147,253],[-641,304],[119,244],[192,421],[241,378],[-272,353],[939,90],[397,-119],[709,-32],[270,-167],[298,-243],[-349,-145],[-681,-405],[-344,-403],[0,-251]],[[23996,95009],[-151,-223],[-403,43],[-337,150],[148,259],[399,155],[243,-202],[101,-182]],[[22639,96011],[212,-267],[9,-295],[-127,-429],[-458,-59],[-298,92],[5,336],[-455,-44],[-18,445],[299,-18],[419,197],[390,-34],[22,76]],[[19941,95712],[109,-205],[247,97],[291,-25],[49,-282],[-169,-274],[-940,-89],[-701,-249],[-423,-13],[-35,187],[577,255],[-1255,-69],[-389,103],[379,563],[262,161],[782,-194],[493,-341],[485,-44],[-397,551],[255,210],[286,-67],[94,-275]],[[23699,96229],[308,-186],[547,2],[240,-190],[-64,-216],[319,-130],[177,-137],[374,-26],[406,-48],[441,125],[566,49],[451,-40],[298,-218],[62,-238],[-174,-153],[-414,-124],[-355,70],[-797,-88],[-570,-11],[-449,71],[-738,186],[-96,316],[-34,286],[-279,251],[-574,70],[-322,179],[104,236],[573,-36]],[[17722,96544],[-38,-443],[-214,-199],[-259,-29],[-517,-246],[-444,-88],[-377,124],[472,431],[570,373],[426,-8],[381,85]],[[23933,96472],[-126,-17],[-521,37],[-74,161],[559,-9],[195,-107],[-33,-65]],[[19392,96574],[-518,-166],[-411,186],[224,183],[406,59],[392,-90],[-93,-172]],[[19538,97095],[-339,-113],[-461,1],[5,82],[285,173],[149,-27],[361,-116]],[[23380,96781],[-411,-119],[-226,134],[-119,216],[-22,238],[360,-23],[162,-38],[332,-200],[-76,-208]],[[22205,96935],[108,-240],[-453,64],[-457,187],[-619,21],[268,171],[-335,139],[-21,221],[546,-79],[751,-210],[212,-274]],[[25828,97704],[334,-186],[-381,-171],[-513,-434],[-492,-41],[-575,74],[-299,235],[4,208],[220,154],[-508,-5],[-306,192],[-176,261],[193,256],[192,175],[285,41],[-122,132],[646,29],[355,-308],[468,-123],[455,-109],[220,-380]],[[30972,99689],[742,-45],[597,-74],[508,-156],[-12,-154],[-678,-250],[-672,-117],[-251,-129],[605,3],[-656,-349],[-452,-163],[-476,-470],[-573,-96],[-177,-117],[-841,-62],[383,-72],[-192,-103],[230,-284],[-264,-198],[-429,-163],[-132,-225],[-388,-172],[39,-130],[475,22],[6,-141],[-742,-345],[-726,159],[-816,-89],[-414,69],[-525,30],[-35,277],[514,130],[-137,415],[170,41],[742,-249],[-379,370],[-450,110],[225,223],[492,137],[79,201],[-392,225],[-118,297],[759,-25],[220,-63],[433,210],[-625,67],[-972,-37],[-491,196],[-232,232],[-324,169],[-61,197],[413,110],[324,18],[545,94],[409,214],[344,-30],[300,-161],[211,311],[367,92],[498,64],[849,24],[148,-63],[802,98],[601,-37],[602,-36]],[[52900,78834],[-22,-236],[-122,-97],[-206,72],[-60,-232],[-132,-18],[-48,91],[-156,-195],[-134,-28],[-120,124]],[[51900,78315],[-95,252],[-133,-90],[5,261],[203,323],[-9,147],[126,-53],[77,98]],[[52074,79253],[236,-4],[57,125],[298,-176]],[[31400,20215],[-92,-233],[-238,-178],[-137,18],[-164,46],[-202,174],[-291,83],[-350,322],[-283,309],[-383,645],[229,-121],[390,-384],[369,-207],[143,264],[90,394],[256,238],[198,-68]],[[30952,21711],[-247,4],[-134,-141],[-250,-208],[-45,-538],[-118,-14],[-313,188],[-318,401],[-346,329],[-87,365],[79,337],[-140,383],[-36,982],[119,554],[293,445],[-422,168],[265,509],[94,956],[309,-202],[145,1193],[-186,153],[-87,-719],[-175,81],[87,823],[95,1067],[127,394],[-80,562],[-22,649],[117,18],[170,930],[192,922],[118,858],[-64,863],[83,475],[-34,711],[163,703],[50,1114],[89,1196],[87,1287],[-20,943],[-58,811]],[[30452,41263],[143,147],[74,295]],[[80649,62586],[-240,-277],[-228,179],[-8,495],[137,261],[304,161],[159,-13],[62,-220],[-122,-254],[-64,-332]],[[86288,76244],[-179,340],[-111,-323],[-429,-248],[44,-304],[-241,21],[-131,181],[-191,-409],[-306,-309],[-227,-370]],[[84517,74823],[-388,-167],[-204,-269],[-300,-157],[148,267],[-58,224],[220,387],[-147,302],[-242,-204],[-314,-400],[-171,-372],[-272,-28],[-142,-268],[147,-390],[227,-94],[9,-259],[220,-168],[311,411],[247,-224],[179,-15],[45,-302],[-393,-161],[-130,-311],[-270,-289],[-142,-403],[299,-316],[109,-567],[169,-527],[189,-443],[-5,-428],[-174,-157],[66,-307],[164,-179],[-43,-469],[-71,-456],[-155,-52],[-203,-623],[-225,-756],[-258,-687],[-382,-532],[-386,-484],[-313,-67],[-170,-255],[-96,186],[-157,-286],[-388,-288],[-294,-88],[-95,-609],[-154,-33],[-73,418],[66,222],[-373,185],[-131,-94]],[[80013,64241],[-280,149],[-132,234],[44,332],[-254,105],[-134,216],[-236,-307],[-271,-66],[-221,3],[-149,-141]],[[78380,64766],[-144,-84],[42,-659],[-148,16],[-25,135]],[[78105,64174],[-9,238],[-203,-167],[-121,106],[-206,216],[81,478],[-176,112],[-66,530],[-293,-96],[33,684],[263,480],[11,475],[-8,441],[-121,137],[-93,339],[-162,-42]],[[77035,68105],[-300,86],[94,242],[-130,358],[-198,-243],[-233,142],[-321,-367],[-252,-428],[-224,-72]],[[74670,67550],[-23,454],[-170,-121]],[[74477,67883],[-324,56],[-314,132],[-225,253],[-216,114],[-93,276],[-157,83],[-280,375],[-223,177],[-115,-138]],[[72530,69211],[-386,403],[-273,365],[-78,635],[200,-78],[9,294],[-111,295],[28,470],[-298,675]],[[71621,72270],[-457,233],[-82,442],[-205,269]],[[70827,73379],[-42,328],[10,224],[-169,131],[-91,-58],[-70,533]],[[70465,74537],[79,132],[-39,135],[266,272],[192,112],[294,-77],[105,368],[356,68],[99,229],[438,312],[39,130]],[[72294,76218],[-22,328],[190,150],[-250,1e3],[550,231],[143,128],[200,1031],[551,-190],[155,261],[13,577],[230,54],[212,383]],[[74266,80171],[109,48]],[[74375,80219],[73,-402],[233,-306],[396,-216],[192,-464],[-107,-673],[100,-249],[330,-99],[374,-80],[336,-359],[171,-64],[127,-531],[163,-342],[306,14],[574,-129],[369,80],[274,-86],[411,-350],[336,1],[123,-179],[324,309],[448,200],[417,21],[324,203],[200,309],[194,193],[-45,190],[-89,222],[146,371],[156,-52],[286,-117],[277,306],[423,223],[204,380],[195,164],[404,77],[219,-65],[30,204],[-251,403],[-223,184],[-214,-212],[-274,89],[-157,-73],[-72,236],[197,575],[135,434]],[[82410,80559],[333,-217],[392,364],[-3,253],[251,611],[155,184],[-4,318],[-152,137],[229,287],[345,104],[369,15],[415,-171],[244,-212],[172,-581],[104,-248],[97,-354],[103,-564],[483,-184],[329,-409],[112,-541],[423,-1],[240,227],[459,170],[-146,-518],[-107,-211],[-96,-631],[-186,-560],[-338,102],[-238,-203],[73,-494],[-40,-680],[-142,-16],[2,-292]],[[49206,54706],[-126,-6],[-194,112],[-178,-6],[-329,-101],[-193,-166],[-275,-211],[-54,15]],[[47857,54343],[22,474],[26,72],[-8,227],[-118,241],[-88,39],[-81,158],[60,256],[-28,278],[13,168]],[[47655,56256],[44,0],[17,251],[-22,112],[27,80],[103,69],[-69,461],[-64,238],[23,195],[55,45]],[[47769,57707],[36,52],[77,-86],[215,-5],[51,168],[48,-11],[80,65],[43,-246],[65,72],[114,86]],[[49214,57382],[74,-819],[-117,-484],[-73,-650],[121,-496],[-13,-227]],[[53632,53135],[-35,31],[-164,-74],[-169,77],[-132,-38]],[[53132,53131],[-452,14]],[[52680,53145],[40,454],[-108,381],[-127,98],[-56,258],[-72,82],[4,159]],[[52361,54577],[71,408],[132,556],[81,5],[165,337],[105,9],[156,-236],[191,194],[26,239],[63,232],[43,291],[148,238],[56,403],[59,128],[39,299],[74,368],[234,446],[14,191],[31,104],[-110,229]],[[53939,59018],[9,184],[78,33]],[[54026,59235],[111,-369],[18,-382],[-10,-383],[151,-523],[-155,6],[-78,-41],[-127,57],[-60,-271],[164,-336],[121,-98],[39,-239],[87,-397],[-43,-156]],[[54447,53135],[-20,-311],[-220,136],[-225,152],[-350,23]],[[58564,53850],[-16,-673],[111,-78],[-89,-205],[-107,-153],[-106,-300],[-59,-268],[-15,-462],[-65,-220],[-2,-434]],[[58216,51057],[-80,-161],[-10,-342],[-38,-45],[-26,-315]],[[58149,49238],[50,-530],[-27,-299],[55,-334],[161,-323],[150,-726]],[[58538,47026],[-109,59],[-373,-97],[-75,-69],[-79,-368],[62,-254],[-49,-681],[-34,-578],[75,-103],[194,-224],[76,105],[23,-621],[-212,4],[-114,317],[-103,246],[-213,80],[-62,302],[-170,-182],[-222,81],[-93,261],[-176,53],[-131,-14],[-15,179],[-96,15]],[[53422,48316],[-39,179]],[[53609,49076],[73,-59],[95,221],[152,-6],[17,-163],[104,-102],[164,361],[161,281],[71,185],[-10,473],[121,560],[127,296],[183,278],[32,184],[7,211],[45,200],[-14,326],[34,510],[55,360],[83,308],[16,347]],[[57603,54843],[169,-475],[124,-70],[75,97],[128,-38],[155,122],[66,-246],[244,-383]],[[53309,48928],[-228,610]],[[53081,49538],[212,318],[-105,381],[95,144],[187,71],[23,255],[148,-276],[245,-25],[85,273],[36,382],[-31,450],[-131,341],[120,667],[-69,114],[-207,-47],[-78,298],[21,251]],[[29063,51742],[-119,136],[-137,191],[-79,-92],[-235,80],[-68,248],[-52,-9],[-278,329]],[[28095,52625],[-37,178],[103,44],[-12,288],[65,209],[138,38],[117,362],[106,302],[-102,137],[52,335],[-62,526],[59,152],[-44,487],[-112,306]],[[28366,55989],[36,280],[89,-41],[52,171],[-64,339],[34,85]],[[28513,56823],[143,-19],[209,402],[114,62],[3,190],[51,487],[159,267],[175,11],[22,120],[218,-48],[218,291],[109,128],[134,278],[98,-36],[73,-151],[-54,-194]],[[30185,58611],[-178,-96],[-71,-288],[-107,-165],[-81,-215],[-34,-410],[-77,-337],[144,-39],[35,-265],[62,-126],[21,-232],[-33,-213],[10,-120],[69,-48],[66,-201],[357,55],[161,-73],[196,-496],[112,62],[200,-31],[158,66],[99,-99],[-50,-311],[-62,-193],[-22,-413],[56,-383],[79,-171],[9,-129],[-140,-286],[100,-127],[74,-202],[85,-574]],[[30585,49354],[-139,306],[-83,14],[179,586],[-213,270],[-166,-50],[-101,100],[-153,-152],[-207,72],[-163,603],[-129,149],[-89,272],[-184,272],[-74,-54]],[[26954,56566],[-151,128],[-56,121],[32,100],[-11,127],[-77,138],[-109,113],[-95,74],[-19,168],[-73,103],[18,-167],[-55,-138],[-64,160],[-89,57],[-38,116],[2,175],[36,182],[-78,81],[64,111]],[[26191,58215],[42,74],[183,-152],[63,75],[89,-48],[46,-119],[82,-38],[66,122]],[[26762,58129],[70,-313],[108,-232],[130,-246]],[[27070,57338],[-107,-51],[1,-232],[58,-86],[-41,-68],[10,-104],[-23,-117],[-14,-114]],[[27147,65183],[240,-41],[219,-6],[261,-197],[110,-210],[260,65],[98,-136],[235,-356],[173,-260],[92,8],[165,-118],[-20,-162],[205,-23],[210,-236],[-33,-135],[-185,-73],[-187,-29],[-191,46],[-398,-56],[186,321],[-113,150],[-179,38],[-96,166],[-66,328],[-157,-22],[-259,154],[-83,121],[-362,89],[-97,113],[104,144],[-273,29],[-199,-299],[-115,-8],[-40,-141],[-138,-63],[-118,55],[146,178],[60,208],[126,128],[142,112],[210,55],[67,63]],[[59092,72066],[19,3],[40,139],[200,-8],[253,172],[-188,-245],[21,-108]],[[59437,72019],[-30,20],[-53,-44],[-42,12],[-14,-22],[-5,59],[-20,35],[-54,6],[-75,-49],[-52,30]],[[59437,72019],[8,-46],[-285,-234],[-136,74],[-64,232],[132,21]],[[53776,79977],[-157,247],[-141,139],[-30,243],[-49,171],[202,125],[103,144],[200,111],[70,110],[73,-66],[124,60]],[[54171,81261],[132,-186],[207,-50],[-17,-158],[151,-119],[41,148],[191,-64],[26,-180],[207,-35],[127,-284]],[[55236,80333],[-82,0],[-43,-104],[-64,-25],[-18,-131],[-54,-28],[-7,-53],[-95,-60],[-123,10],[-39,-127]],[[52756,83493],[4,-222],[281,-135],[-3,-204],[283,108],[156,158],[313,-228],[132,-183]],[[53922,82787],[64,-293],[-77,-154],[101,-205],[69,-308],[-22,-199],[114,-367]],[[52074,79253],[35,410],[140,395],[-400,106],[-131,151]],[[51718,80315],[16,252],[-56,130]],[[51710,81086],[-47,604],[167,0],[70,217],[69,527],[-51,195]],[[51918,82629],[54,122],[232,31],[52,-127],[188,284],[-63,216],[-13,326]],[[52368,83481],[210,-76],[178,88]],[[61966,59143],[66,-178],[-9,-240],[-158,-137],[119,-158]],[[61984,58430],[-102,-308]],[[61882,58122],[-62,103],[-67,-41],[-155,9],[-4,176],[-22,159],[94,269],[98,255]],[[61764,59052],[119,-50],[83,141]],[[53524,83854],[-166,-466],[-291,325],[-39,239],[408,191],[88,-289]],[[52368,83481],[-113,320],[-8,589],[46,155],[80,173],[244,36],[98,159],[223,162],[-9,-296],[-82,-188],[33,-161],[151,-87],[-68,-217],[-83,62],[-200,-415],[76,-280]],[[30080,63183],[34,98],[217,-3],[165,-148],[73,14],[50,-204],[152,11],[-9,-171],[124,-21],[136,-211],[-103,-235],[-132,126],[-127,-25],[-92,28],[-50,-105],[-106,-36],[-43,140],[-92,-83],[-111,-394],[-71,92],[-14,165]],[[30081,62221],[5,157],[-71,172],[68,97],[21,222],[-24,314]],[[53333,65346],[-952,-1097],[-804,-1132],[-392,-257]],[[51185,62860],[-308,-56],[-3,366],[-129,94],[-173,165],[-66,270],[-937,1256],[-937,1257]],[[48632,66212],[-1045,1394]],[[47587,67606],[6,112],[-1,38]],[[47592,67756],[-2,682],[449,425],[277,88],[227,155],[107,288],[324,228],[12,427],[161,50],[126,213],[363,97],[51,224],[-73,122],[-96,608],[-17,350],[-104,369]],[[49397,72082],[267,315],[300,100],[175,238],[268,175],[471,102],[459,47],[140,-85],[262,227],[297,4],[113,-134],[190,35]],[[52339,73106],[-57,-295],[44,-549],[-65,-475],[-171,-322],[24,-433],[227,-344],[3,-139],[171,-232],[118,-1034]],[[52633,69283],[90,-509],[15,-267],[-49,-470],[21,-263],[-36,-315],[24,-362],[-110,-240],[164,-420],[11,-247],[99,-321],[130,105],[219,-267],[122,-361]],[[27693,49869],[148,430],[-60,251],[-106,-267],[-166,252],[56,163],[-47,522],[97,87],[52,359],[105,371],[-20,235],[153,123],[190,230]],[[29063,51742],[38,-438],[-86,-374],[-303,-603],[-334,-227],[-170,-501],[-53,-389],[-157,-237],[-116,291],[-113,62],[-114,-45],[-8,211],[79,137],[-33,240]],[[59700,68819],[-78,-232],[-60,-435],[-75,-300],[-65,-100],[-93,186],[-125,257],[-198,825],[-29,-52],[115,-608],[171,-579],[210,-897],[102,-313],[90,-325],[249,-638],[-55,-100],[9,-374],[323,-517],[49,-118]],[[60240,64499],[-1102,0],[-1077,0],[-1117,0]],[[56944,64499],[0,2120],[0,2048],[-83,464],[71,356],[-43,246],[101,276]],[[56990,70009],[369,10],[268,-152],[275,-171],[129,-89],[214,182],[114,165],[245,48],[198,-73],[75,-286],[65,189],[222,-136],[217,-33],[137,145]],[[59518,69808],[182,-989]],[[61764,59052],[-95,187],[-114,337],[-124,185],[-71,199],[-242,231],[-191,7],[-67,120],[-163,-135],[-168,261],[-87,-430],[-323,121]],[[60119,60135],[-30,230],[120,847],[27,382],[88,177],[204,95],[141,328]],[[60669,62194],[161,-666],[77,-529],[152,-281],[379,-544],[154,-328],[151,-332],[87,-198],[136,-173]],[[47490,75948],[14,410],[-114,250],[393,415],[340,-104],[373,4],[296,-98],[230,30],[449,-19]],[[49471,76836],[111,-224],[511,-262],[101,125],[313,-261],[322,75]],[[50829,76289],[15,-335],[-263,-383],[-356,-122],[-25,-194],[-171,-319],[-107,-469],[108,-329],[-160,-257],[-60,-374],[-210,-115],[-197,-443],[-352,-8],[-265,10],[-174,-203],[-106,-218],[-136,48],[-103,195],[-79,331],[-259,89]],[[47929,73193],[-23,191],[103,216],[38,156],[-96,172],[77,378],[-111,345],[120,48],[11,272],[45,84],[3,449],[129,156],[-78,289],[-162,20],[-47,-72],[-164,-1],[-70,282],[-113,-84],[-101,-146]],[[56753,85111],[32,340],[-102,-72],[-176,204],[-24,331],[351,161],[350,83],[301,-95],[287,17]],[[57772,86080],[42,-100],[-198,-332],[83,-537],[-120,-183]],[[57579,84928],[-229,1],[-239,214],[-121,70],[-237,-102]],[[61882,58122],[-61,-204],[103,-317],[102,-277],[106,-206],[909,-683],[233,3]],[[63274,56438],[-785,-1728],[-362,-26],[-247,-406],[-178,-10],[-76,-182]],[[61626,54086],[-190,0],[-112,195],[-254,-241],[-82,-240],[-185,45],[-62,67],[-65,-16],[-87,6],[-352,489],[-193,0],[-95,189],[0,324],[-145,96]],[[59804,55e3],[-164,627],[-127,133],[-48,231],[-141,280],[-171,42],[95,328],[147,14],[42,176]],[[59437,56831],[-4,517]],[[59433,57348],[82,603],[132,161],[28,236],[119,440],[168,285],[112,567],[45,495]],[[57942,91602],[-41,-403],[425,-383],[-256,-435],[323,-655],[-187,-494],[250,-429],[-113,-375],[411,-394],[-105,-294],[-258,-333],[-594,-735]],[[57797,86672],[-504,-46],[-489,-211],[-452,-121],[-161,314],[-269,189],[62,567],[-135,520],[133,335],[252,362],[635,624],[185,121],[-28,243],[-387,272]],[[56639,89841],[-93,225],[-8,886],[-433,392],[-371,282]],[[55734,91626],[167,152],[309,-304],[362,29],[298,-140],[265,255],[137,422],[431,196],[356,-229],[-117,-405]],[[99547,41844],[96,-167],[-46,-300],[-172,-79],[-153,71],[-27,253],[107,198],[126,-71],[69,95]],[[0,42577],[57,26],[-34,-277],[-23,-31],[99822,-141],[-177,-122],[-36,215],[139,118],[88,32],[-99836,180]],[[33e3,21970],[333,345],[236,-144],[167,231],[222,-259],[-83,-202],[-375,-173],[-125,202],[-236,-259],[-139,259]],[[34854,53161],[70,246],[24,262],[48,246],[-107,340]],[[34889,54255],[-22,394],[144,495]],[[35011,55144],[95,-63],[204,-136],[294,-486],[46,-236]],[[52655,76104],[-92,-445],[-126,118],[-64,387],[56,214],[179,220],[47,-494]],[[51576,80352],[62,-50],[80,13]],[[51900,78315],[-11,-163],[82,-216],[-97,-176],[72,-445],[151,-73],[-32,-250]],[[52065,76992],[-252,-326],[-548,156],[-404,-186],[-32,-347]],[[49471,76836],[144,345],[53,1147],[-287,605],[-205,291],[-424,222],[-28,420],[360,125],[466,-148],[-88,652],[263,-247],[646,449],[84,472],[243,116]],[[53081,49538],[-285,581],[-184,475],[-169,595],[9,192],[61,184],[67,419],[56,427]],[[52636,52411],[94,33],[404,-6],[-2,693]],[[48278,82851],[-210,118],[-172,-8],[57,309],[-57,309]],[[47896,83579],[233,23],[298,-356],[-149,-395]],[[49165,85596],[-297,-623],[283,79],[304,-3],[-72,-469],[-250,-516],[287,-37],[22,-61],[248,-679],[190,-93],[171,-656],[79,-227],[337,-110],[-34,-368],[-142,-169],[111,-298],[-250,-302],[-371,6],[-473,-159],[-130,114],[-183,-270],[-257,65],[-195,-220],[-148,115],[407,605],[249,125],[-2,0],[-434,96],[-79,229],[291,179],[-152,310],[52,377],[413,-52],[1,0],[40,334],[-186,355],[-4,8],[-337,101],[-66,156],[101,258],[-92,158],[-149,-272],[-17,555],[-140,294],[101,595],[216,467],[222,-45],[335,48]],[[61542,75749],[42,246],[-70,393],[-160,212],[-154,66],[-102,177]],[[61098,76843],[34,68],[235,-99],[409,-93],[378,-276],[48,-107],[169,90],[259,-120],[85,-236],[175,-134]],[[62106,75494],[-268,282],[-296,-27]],[[50294,55244],[-436,-337],[-154,-198],[-250,-167],[-248,164]],[[50006,58175],[-20,-180],[116,-297],[-1,-418],[27,-454],[69,-210],[-61,-518],[22,-287],[74,-365],[62,-202]],[[47655,56256],[-78,14],[-57,-232],[-78,3],[-55,123],[19,231],[-116,353],[-73,-65],[-59,-13]],[[47158,56670],[-77,-33],[3,211],[-44,151],[9,168],[-60,242],[-78,206],[-222,0],[-65,-108],[-76,-13],[-48,-125],[-32,-159],[-148,-254]],[[46320,56956],[-122,341],[-108,226],[-71,74],[-69,115],[-32,254],[-41,127],[-80,94]],[[45797,58187],[123,281],[84,-11],[73,97],[61,1],[44,76],[-24,191],[31,60],[5,195]],[[46194,59077],[134,-5],[200,-141],[61,13],[21,64],[151,-45],[40,32]],[[46801,58995],[16,-211],[44,1],[73,77],[46,-20],[77,-146],[119,-46],[76,125],[90,77],[67,80],[55,-15],[62,-126],[33,-159],[114,-241],[-57,-149],[-11,-187],[59,57],[35,-67],[-15,-172],[85,-166]],[[45321,59403],[36,255]],[[45357,59658],[302,17],[63,136],[88,10],[110,-142],[86,-3],[92,97],[56,-166],[-120,-130],[-121,11],[-119,121],[-103,-133],[-50,-5],[-67,-80],[-253,12]],[[45797,58187],[-149,241],[-117,38],[-63,162],[1,88],[-84,122],[-18,124]],[[45367,58962],[147,93],[92,-18],[75,65],[513,-25]],[[52636,52411],[-52,87],[96,647]],[[56583,72391],[152,-194],[216,33],[207,-41],[-7,-100],[151,69],[-35,-170],[-400,-49],[3,95],[-339,112],[52,245]],[[57237,75339],[-169,17],[-145,54],[-336,-150],[192,-323],[-141,-94],[-154,-1],[-147,297],[-52,-127],[62,-344],[139,-270],[-105,-126],[155,-265],[137,-167],[4,-326],[-257,153],[82,-294],[-176,-60],[105,-509],[-184,-7],[-228,251],[-104,460],[-49,384],[-108,264],[-143,329],[-18,164]],[[55838,75350],[182,51],[106,126],[150,-11],[46,100],[53,19]],[[57254,75917],[135,-153],[-86,-360],[-66,-65]],[[37010,99413],[932,344],[975,-26],[354,213],[982,55],[2219,-72],[1737,-457],[-513,-222],[-1062,-25],[-1496,-56],[140,-103],[984,63],[836,-198],[540,176],[231,-206],[-305,-335],[707,214],[1348,223],[833,-111],[156,-246],[-1132,-410],[-157,-133],[-888,-99],[643,-28],[-324,-420],[-224,-373],[9,-641],[333,-376],[-434,-24],[-457,-182],[513,-305],[65,-490],[-297,-53],[360,-495],[-617,-42],[322,-234],[-91,-203],[-391,-89],[-388,-2],[348,-390],[4,-256],[-549,238],[-143,-154],[375,-144],[364,-352],[105,-464],[-495,-111],[-214,222],[-344,331],[95,-391],[-322,-303],[732,-24],[383,-31],[-745,-502],[-755,-454],[-813,-199],[-306,-2],[-288,-222],[-386,-608],[-597,-404],[-192,-23],[-370,-142],[-399,-134],[-238,-357],[-4,-403],[-141,-378],[-453,-461],[112,-450],[-125,-476],[-142,-563],[-391,-35],[-410,471],[-556,3],[-269,315],[-186,563],[-481,716],[-141,375],[-38,517],[-384,532],[100,424],[-186,203],[275,673],[418,214],[110,241],[58,450],[-318,-204],[-151,-85],[-249,-83],[-341,188],[-19,392],[109,306],[258,8],[567,-153],[-478,366],[-249,197],[-276,-81],[-232,143],[310,536],[-169,215],[-220,398],[-335,611],[-353,223],[3,241],[-745,337],[-590,42],[-743,-23],[-677,-42],[-323,183],[-482,362],[729,181],[559,31],[-1188,149],[-627,236],[39,223],[1051,277],[1018,277],[107,210],[-750,206],[243,230],[961,402],[404,62],[-115,258],[658,152],[854,90],[853,6],[303,-180],[737,317],[663,-215],[390,-45],[577,-188],[-660,311],[38,246]],[[24973,59739],[-142,101],[-174,10],[-127,114],[-149,238]],[[24381,60202],[7,168],[32,135],[-39,107],[133,470],[357,1],[7,197],[-45,35],[-31,124],[-103,133],[-103,193],[125,1],[1,324],[259,1],[257,-6]],[[25297,60979],[90,-105],[24,86],[82,-73]],[[25493,60887],[-127,-220],[-131,-161],[-20,-111],[22,-113],[-58,-146]],[[25179,60136],[-65,-36],[15,-67],[-52,-64],[-95,-145],[-9,-85]],[[33400,56648],[183,-212],[171,-375],[8,-297],[105,-13],[149,-281],[109,-201]],[[34125,55269],[-44,-518],[-169,-150],[15,-136],[-51,-297],[123,-418],[89,-1],[37,-325],[169,-501]],[[33129,54824],[-188,437],[75,159],[-5,265],[171,93],[69,108],[-95,213],[24,210],[220,339]],[[25745,59307],[-48,180],[-84,50]],[[25613,59537],[19,231],[-38,62],[-57,41],[-122,-68],[-10,77],[-84,93],[-60,114],[-82,49]],[[25493,60887],[29,-23],[61,101],[79,9],[26,-47],[43,28],[129,-52],[128,15],[90,64],[32,65],[89,-30],[66,-39],[73,13],[55,50],[127,-80],[44,-13],[85,-107],[80,-129],[101,-88],[73,-159]],[[26903,60465],[-95,12],[-38,-79],[-97,-75],[-70,0],[-61,-73],[-56,26],[-47,88],[-29,-17],[-36,-138],[-27,5],[-4,-118],[-97,-159],[-51,-68],[-29,-72],[-82,117],[-60,-154],[-58,4],[-65,-14],[6,-283],[-41,-5],[-35,-131],[-86,-24]],[[55230,78267],[67,-223],[89,-164],[-107,-217]],[[55155,76391],[-31,-98]],[[55124,76293],[-261,213],[-161,207],[-254,171],[-233,424],[56,43],[-127,242],[-5,195],[-179,91],[-85,-249],[-82,193],[6,200],[10,9]],[[53809,78032],[194,-20],[51,98],[94,-94],[109,-12],[-1,161],[97,59],[27,233],[221,153]],[[54601,78610],[88,-71],[208,-247],[229,-111],[104,86]],[[30081,62221],[-185,98],[-131,-40],[-169,42],[-130,-108],[-149,179],[24,186],[256,-80],[210,-46],[100,128],[-127,250],[2,220],[-175,89],[62,159],[170,-25],[241,-90]],[[54716,79543],[141,-148],[103,-62],[233,70],[22,116],[111,17],[135,89],[30,-37],[130,72],[66,136],[91,35],[297,-175],[59,59]],[[56134,79715],[155,-157],[19,-154]],[[56308,79404],[-170,-121],[-131,-391],[-168,-390],[-223,-109]],[[55616,78393],[-173,26],[-213,-152]],[[54601,78610],[-54,194],[-47,7]],[[83531,45933],[-117,-11],[-368,403],[259,113],[146,-175],[97,-175],[-17,-155]],[[84713,46708],[28,-113],[5,-175]],[[84746,46420],[-181,-430],[-238,-127],[-33,69],[25,196],[119,351],[275,229]],[[82749,47167],[100,-153],[172,47],[69,-245],[-321,-116],[-193,-77],[-149,4],[95,332],[153,5],[74,203]],[[84139,47168],[-41,-320],[-417,-163],[-370,71],[0,210],[220,120],[174,-173],[185,44],[249,211]],[[80172,47926],[533,-57],[61,237],[515,-277],[101,-373],[417,-105],[341,-342],[-317,-220],[-306,232],[-251,-15],[-288,42],[-260,104],[-322,220],[-204,57],[-116,-72],[-506,237],[-48,247],[-255,43],[191,550],[337,-34],[224,-225],[115,-44],[38,-205]],[[87423,48251],[-143,-393],[-27,434],[49,207],[58,195],[63,-169],[0,-274]],[[85346,49837],[-104,-191],[-192,106],[-54,248],[281,27],[69,-190]],[[86241,50048],[101,-441],[-234,238],[-232,48],[-157,-38],[-192,20],[65,317],[344,24],[305,-168]],[[89166,50332],[5,-1877],[4,-1876]],[[89175,46579],[-247,472],[-282,116],[-69,-164],[-352,-18],[118,469],[175,160],[-72,626],[-134,483],[-538,488],[-229,48],[-417,532],[-82,-279],[-107,-51],[-63,211],[-1,250],[-212,283],[299,207],[198,-11],[-23,153],[-407,1],[-110,343],[-248,106],[-117,285],[374,140],[142,188],[446,-237],[44,-214],[78,-931],[287,-345],[232,611],[319,347],[247,1],[238,-201],[206,-206],[298,-110]],[[84788,52647],[-223,-571],[-209,-111],[-267,113],[-463,-29],[-243,-83],[-39,-436],[248,-512],[150,261],[518,196],[-22,-265],[-121,83],[-121,-337],[-245,-223],[263,-738],[-50,-198],[249,-665],[-2,-378],[-148,-170],[-109,203],[134,471],[-273,-222],[-69,159],[36,222],[-200,338],[21,561],[-186,-175],[24,-671],[11,-824],[-176,-84],[-119,169],[79,530],[-43,556],[-117,4],[-86,395],[115,377],[40,457],[139,868],[58,238],[237,427],[217,-170],[350,-80],[319,24],[275,419],[48,-129]],[[85746,52481],[-15,-503],[-143,57],[-42,-351],[114,-304],[-78,-69],[-112,365],[-82,736],[56,460],[92,210],[20,-315],[164,-50],[26,-236]],[[80461,52985],[47,-385],[190,-325],[179,117],[177,-42],[162,291],[133,51],[263,-162],[226,123],[143,801],[107,200],[96,655],[319,0],[241,-97]],[[82744,54212],[-158,-520],[204,-545],[-48,-265],[312,-533],[-329,-68],[-93,-393],[12,-522],[-267,-393],[-7,-574],[-107,-881],[-41,205],[-316,-259],[-110,352],[-198,33],[-139,184],[-330,-207],[-101,279],[-182,-32],[-229,67],[-43,772],[-138,160],[-134,493],[-38,504],[32,533],[165,383]],[[79393,48459],[-308,-12],[-234,481],[-356,471],[-119,349],[-210,469],[-138,432],[-212,806],[-244,480],[-81,495],[-103,449],[-250,363],[-145,493],[-209,322],[-290,635],[-24,293],[178,-23],[430,-111],[246,-564],[215,-390],[153,-240],[263,-619],[283,-9],[233,-394],[161,-482],[211,-263],[-111,-471],[159,-200],[100,-14],[47,-402],[97,-321],[204,-51],[135,-365],[-70,-716],[-11,-891]],[[72530,69211],[-176,-261],[-108,-538],[269,-218],[262,-283],[362,-323],[381,-75],[160,-293],[215,-54],[334,-135],[231,10],[32,228],[-36,366],[21,248]],[[77035,68105],[20,-219],[-97,-105],[23,-355],[-199,104],[-359,-397],[8,-330],[-153,-483],[-14,-281],[-124,-474],[-217,131],[-11,-596],[-63,-196],[30,-245],[-137,-137]],[[74730,64531],[-39,-210],[-189,7],[-343,-120],[16,-433],[-148,-341],[-400,-387],[-311,-678],[-209,-363],[-276,-377],[-1,-265],[-138,-142],[-251,-206],[-129,-31],[-84,-439],[58,-749],[15,-478],[-118,-547],[-1,-978],[-144,-28],[-126,-439],[84,-190],[-253,-163],[-93,-392],[-112,-165],[-263,537],[-128,807],[-107,581],[-97,272],[-148,553],[-69,720],[-48,360],[-253,791],[-115,1116],[-83,737],[1,698],[-54,539],[-404,-345],[-196,69],[-362,698],[133,208],[-82,226],[-326,489]],[[68937,65473],[185,384],[612,-1],[-56,494],[-156,292],[-31,444],[-182,258],[306,604],[323,-44],[290,604],[174,584],[270,578],[-4,411],[236,333],[-224,284],[-96,390],[-99,504],[137,249],[421,-141],[310,86],[268,484]],[[48278,82851],[46,-412],[-210,-514],[-493,-340],[-393,87],[225,601],[-145,586],[378,451],[210,269]],[[64978,73251],[244,112],[197,329],[186,-17],[122,108],[197,-53],[308,-292],[221,-63],[318,-510],[207,-21],[24,-484]],[[66909,69007],[137,-302],[112,-348],[266,-253],[7,-508],[133,-93],[23,-265],[-400,-298],[-105,-669]],[[67082,66271],[-523,174],[-303,133],[-313,74],[-118,707],[-133,102],[-214,-103],[-280,-279],[-339,191],[-281,443],[-267,164],[-186,546],[-205,768],[-149,-93],[-177,190],[-104,-224]],[[63490,69064],[-153,302],[-3,307],[-89,0],[46,417],[-143,438],[-340,315],[-193,548],[65,449],[139,199],[-21,336],[-182,173],[-180,687]],[[62436,73235],[-152,461],[55,179],[-87,660],[190,164]],[[63578,73897],[88,-424],[263,-120],[193,-289],[395,-100],[434,153],[27,134]],[[63490,69064],[-164,28]],[[63326,69092],[-187,48],[-204,-553]],[[62935,68587],[-516,46],[-784,1158],[-413,403],[-335,156]],[[60887,70350],[-112,701]],[[60775,71051],[615,600],[105,696],[-26,421],[152,142],[142,359]],[[61763,73269],[119,90],[324,-75],[97,-146],[133,97]],[[45969,90100],[-64,-373],[314,-392],[-361,-440],[-801,-394],[-240,-105],[-365,85],[-775,182],[273,254],[-605,282],[492,112],[-12,169],[-583,134],[188,375],[421,85],[433,-391],[422,314],[349,-163],[453,307],[461,-41]],[[59922,70666],[-49,-182]],[[59873,70484],[-100,80],[-58,-383],[69,-65],[-71,-79],[-12,-152],[131,78]],[[59832,69963],[7,-224],[-139,-920]],[[59518,69808],[80,190],[-19,32],[74,270],[56,434],[40,146],[8,6]],[[59757,70886],[93,-1],[25,101],[75,7]],[[59950,70993],[4,-236],[-38,-87],[6,-4]],[[54311,73846],[-100,-453],[41,-179],[-58,-296],[-213,217],[-141,62],[-387,293],[38,296],[325,-53],[284,63],[211,50]],[[52558,75561],[166,-408],[-39,-762],[-126,36],[-113,-192],[-105,153],[-11,694],[-64,330],[153,-29],[139,178]],[[53835,78613],[-31,-283],[67,-246]],[[53871,78084],[-221,84],[-226,-204],[15,-286],[-34,-164],[91,-293],[261,-290],[140,-476],[309,-464],[217,3],[68,-127],[-78,-115],[249,-208],[204,-174],[238,-301],[29,-107],[-52,-206],[-154,268],[-242,95],[-116,-372],[200,-214],[-33,-300],[-116,-34],[-148,-494],[-116,-45],[1,176],[57,309],[60,123],[-108,334],[-85,290],[-115,72],[-82,249],[-179,104],[-120,232],[-206,37],[-217,260],[-254,375],[-189,332],[-86,569],[-138,67],[-226,190],[-128,-78],[-161,-267],[-115,-42]],[[28453,62478],[187,-52],[147,-138],[46,-158],[-195,-11],[-84,-96],[-156,92],[-159,210],[34,132],[116,40],[64,-19]],[[59922,70666],[309,-228],[544,613]],[[60887,70350],[-53,-87],[-556,-289],[277,-575],[-92,-98],[-46,-193],[-212,-80],[-66,-207],[-120,-177],[-310,91]],[[59709,68735],[-9,84]],[[59832,69963],[41,169],[0,352]],[[87399,71495],[35,-197],[-156,-349],[-114,185],[-143,-134],[-73,-337],[-181,164],[2,273],[154,344],[158,-67],[114,242],[204,-124]],[[89159,73219],[-104,-460],[48,-288],[-145,-406],[-355,-271],[-488,-36],[-396,-657],[-186,221],[-12,431],[-483,-127],[-329,-271],[-325,-11],[282,-424],[-186,-979],[-179,-242],[-135,224],[69,519],[-176,167],[-113,395],[263,177],[145,362],[280,298],[203,394],[553,171],[297,-117],[291,1024],[185,-275],[408,575],[158,224],[174,704],[-47,648],[117,364],[295,105],[152,-798],[-9,-467],[-256,-580],[4,-594]],[[89974,77268],[195,-122],[197,244],[62,-647],[-412,-157],[-244,-572],[-436,393],[-152,-630],[-308,-9],[-39,573],[138,443],[296,32],[81,797],[83,449],[326,-600],[213,-194]],[[69711,76170],[-159,-107],[-367,-401],[-121,-412],[-104,-4],[-76,273],[-353,18],[-57,472],[-135,4],[21,578],[-333,421],[-476,-45],[-326,-84],[-265,519],[-227,218],[-431,412],[-52,50],[-715,-340],[11,-2124]],[[65546,75618],[-142,-28],[-195,452],[-188,161],[-315,-120],[-123,-191]],[[64583,75892],[-15,140],[68,240],[-53,201],[-322,196],[-125,517],[-154,146],[-9,187],[270,-54],[11,421],[236,93],[243,-86],[50,562],[-50,356],[-278,-28],[-236,141],[-321,-253],[-259,-121]],[[63639,78550],[-142,93],[29,296],[-177,385],[-207,-16],[-235,391],[160,436],[-81,118],[222,632],[285,-334],[35,421],[573,626],[434,15],[612,-399],[329,-233],[295,243],[440,12],[356,-298],[80,170],[391,-24],[69,272],[-450,396],[267,281],[-52,157],[266,150],[-200,394],[127,197],[1039,200],[136,142],[695,213],[250,239],[499,-124],[88,-597],[290,140],[356,-197],[-23,-314],[267,33],[696,543],[-102,-180],[355,-445],[620,-1463],[148,302],[383,-332],[399,148],[154,-104],[133,-332],[194,-112],[119,-244],[358,77],[147,-353]],[[72294,76218],[-171,84],[-140,207],[-412,61],[-461,15],[-100,-63],[-396,242],[-158,-119],[-43,-340],[-457,198],[-183,-81],[-62,-252]],[[61551,50860],[-195,-230],[-68,-240],[-104,-42],[-40,-406],[-89,-233],[-54,-383],[-112,-190]],[[60889,49136],[-399,576],[-19,334],[-1007,1173],[-47,63]],[[59417,51282],[-3,611],[80,233],[137,381],[101,420],[-123,661],[-32,289],[-132,400]],[[59445,54277],[171,344],[188,379]],[[61626,54086],[-243,-653],[3,-2098],[165,-475]],[[70465,74537],[-526,-87],[-343,187],[-301,-45],[26,332],[303,-96],[101,177]],[[69725,75005],[212,-56],[355,414],[-329,304],[-198,-144],[-205,217],[234,373],[-83,57]],[[78495,58847],[-66,696],[178,479],[359,110],[261,-83]],[[79227,60049],[229,-226],[126,397],[246,-212]],[[79828,60008],[64,-384],[-34,-690],[-467,-443],[122,-349],[-292,-42],[-240,-232]],[[78981,57868],[-233,84],[-112,301],[-141,594]],[[85652,74065],[240,-679],[68,-373],[3,-664],[-105,-316],[-252,-111],[-222,-239],[-250,-49],[-31,313],[51,432],[-122,600],[206,97],[-190,493]],[[85048,73569],[17,52],[124,-21],[108,260],[197,28],[118,38],[40,139]],[[55575,76355],[52,129]],[[55627,76484],[66,42],[38,191],[50,32],[40,-81],[52,-36],[36,-92],[46,-27],[54,-107],[39,3],[-31,-140],[-33,-68],[9,-43]],[[55993,76158],[-62,-23],[-164,-89],[-13,-118],[-35,5]],[[63326,69092],[58,-254],[-25,-132],[89,-434]],[[63448,68272],[-196,-15],[-69,274],[-248,56]],[[79227,60049],[90,260],[12,487],[-224,502],[-18,568],[-211,468],[-210,40],[-56,-201],[-163,-17],[-83,102],[-293,-344],[-6,517],[68,606],[-188,27],[-16,346],[-120,178]],[[77809,63588],[59,212],[237,374]],[[78380,64766],[162,-454],[125,-524],[342,-4],[108,-502],[-178,-151],[-80,-207],[333,-345],[231,-680],[175,-508],[210,-400],[70,-407],[-50,-576]],[[59757,70886],[99,469],[138,406],[5,20]],[[59999,71781],[125,-30],[45,-226],[-151,-217],[-68,-315]],[[47857,54343],[-73,-5],[-286,274],[-252,439],[-237,315],[-187,371]],[[46822,55737],[66,184],[15,168],[126,313],[129,268]],[[54125,64996],[-197,-214],[-156,316],[-439,248]],[[52633,69283],[136,133],[24,244],[-30,238],[191,222],[86,185],[135,165],[16,442]],[[53191,70912],[326,-198],[117,50],[232,-96],[368,-258],[130,-512],[250,-111],[391,-242],[296,-286],[136,150],[133,264],[-65,442],[87,280],[200,270],[192,78],[375,-118],[95,-257],[104,-3],[88,-98],[276,-67],[68,-191]],[[56944,64499],[0,-1150],[-320,-2],[-3,-242]],[[56621,63105],[-1108,1103],[-1108,1103],[-280,-315]],[[72718,56162],[-42,-600],[-116,-164],[-242,-132],[-132,458],[-49,828],[126,935],[192,-320],[129,-406],[134,-599]],[[58049,35154],[96,-173],[-85,-281],[-47,-187],[-155,-90],[-51,-184],[-99,-58],[-209,443],[148,365],[151,225],[130,118],[121,-178]],[[56314,83116],[-23,147],[30,157],[-123,92],[-291,100]],[[55907,83612],[-59,485]],[[55848,84097],[318,176],[466,-37],[273,57],[39,-120],[148,-37],[267,-279]],[[56523,82877],[-67,177],[-142,62]],[[55848,84097],[10,433],[136,362],[262,196],[221,-430],[223,11],[53,442]],[[57579,84928],[134,-133],[24,-279],[89,-340]],[[47592,67756],[-42,0],[7,-308],[-172,-19],[-90,-131],[-126,0],[-100,75],[-234,-62],[-91,-449],[-86,-42],[-131,-726],[-386,-621],[-92,-796],[-114,-258],[-33,-208],[-625,-46],[-5,1]],[[45272,64166],[13,267],[106,157],[91,300],[-18,195],[96,406],[155,366],[93,93],[74,336],[6,307],[100,356],[185,210],[177,588],[5,8],[139,221],[259,64],[218,393],[140,154],[232,481],[-70,716],[106,495],[37,304],[179,389],[278,263],[206,238],[186,596],[87,354],[205,-3],[167,-244],[264,39],[288,-127],[121,-6]],[[57394,79599],[66,85],[185,57],[204,-180],[115,-21],[125,-155],[-20,-195],[101,-95],[40,-240],[97,-147],[-19,-86],[52,-58],[-74,-43],[-164,17],[-27,80],[-58,-46],[20,-103],[-76,-184],[-49,-197],[-70,-63]],[[57842,78025],[-50,263],[30,246],[-9,253],[-160,342],[-89,243],[-86,171],[-84,56]],[[63761,44648],[74,-245],[69,-380],[45,-693],[72,-269],[-28,-277],[-49,-169],[-94,338],[-53,-171],[53,-427],[-24,-244],[-77,-133],[-18,-488],[-109,-671],[-137,-793],[-172,-1092],[-106,-800],[-125,-668],[-226,-136],[-243,-244],[-160,147],[-220,206],[-77,304],[-18,510],[-98,460],[-26,414],[50,415],[128,100],[1,191],[133,437],[25,367],[-65,272],[-52,364],[-23,530],[97,322],[38,366],[138,21],[155,118],[103,104],[122,8],[158,328],[229,355],[83,289],[-38,247],[118,-70],[153,401],[6,346],[92,257],[96,-247]],[[23016,66727],[-107,-505],[-49,-415],[-20,-771],[-27,-281],[48,-315],[86,-280],[56,-447],[184,-429],[65,-328],[109,-284],[295,-153],[114,-241],[244,161],[212,58],[208,104],[175,99],[176,235],[67,336],[22,483],[48,169],[188,151],[294,133],[246,-20],[169,49],[66,-122],[-9,-278],[-149,-342],[-66,-351],[51,-100],[-42,-249],[-69,-449],[-71,148],[-58,-10]],[[24381,60202],[-314,620],[-144,187],[-226,150],[-156,-42],[-223,-216],[-140,-57],[-196,152],[-208,109],[-260,264],[-208,81],[-314,268],[-233,275],[-70,154],[-155,34],[-284,183],[-116,262],[-299,327],[-139,363],[-66,281],[93,56],[-29,164],[64,150],[1,199],[-93,259],[-25,229],[-94,290],[-244,573],[-280,450],[-135,359],[-238,235],[-51,140],[42,356],[-142,135],[-164,279],[-69,402],[-149,47],[-162,303],[-130,281],[-12,180],[-149,434],[-99,441],[5,221],[-201,229],[-93,-26],[-159,159],[-44,-234],[46,-276],[27,-433],[95,-237],[206,-397],[46,-135],[42,-41],[37,-198],[49,8],[56,-372],[85,-146],[59,-204],[174,-293],[92,-536],[83,-252],[77,-270],[15,-304],[134,-19],[112,-261],[100,-257],[-6,-104],[-117,-211],[-49,3],[-74,350],[-181,328],[-201,278],[-142,147],[9,421],[-42,312],[-132,179],[-191,257],[-37,-75],[-70,151],[-171,139],[-164,334],[20,44],[115,-33],[103,215],[10,260],[-214,411],[-163,159],[-102,360],[-103,377],[-129,461],[-113,518]],[[17464,70566],[316,44],[353,63],[-26,-113],[419,-280],[634,-406],[552,5],[221,0],[0,237],[481,0],[102,-204],[142,-182],[165,-253],[92,-301],[69,-317],[144,-174],[230,-172],[175,455],[227,11],[196,-230],[139,-394],[96,-338],[164,-328],[61,-403],[78,-271],[217,-178],[197,-127],[108,17]],[[55993,76158],[95,33],[128,10]],[[46619,60247],[93,105],[47,339],[88,13],[194,-160],[157,114],[107,-38],[42,128],[1114,8],[62,404],[-48,71],[-134,2485],[-134,2485],[425,11]],[[51185,62860],[1,-1326],[-152,-384],[-24,-355],[-247,-92],[-379,-49],[-102,-205],[-178,-22]],[[46801,58995],[13,179],[-24,223],[-104,162],[-54,330],[-13,358]],[[77375,57550],[-27,427],[86,441],[-94,341],[23,627],[-113,299],[-90,689],[-50,727],[-121,477],[-183,-289],[-315,-410],[-156,51],[-172,135],[96,714],[-58,539],[-218,664],[34,208],[-163,74],[-197,469]],[[77809,63588],[-159,-134],[-162,-249],[-196,-26],[-127,-623],[-117,-104],[134,-506],[177,-420],[113,-380],[-101,-501],[-96,-106],[66,-289],[185,-458],[32,-321],[-4,-268],[108,-525],[-152,-537],[-135,-591]],[[55380,75946],[-58,44],[-78,188],[-120,115]],[[55338,76894],[74,-99],[40,-80],[91,-62],[106,-119],[-22,-50]],[[74375,80219],[292,99],[530,496],[423,271],[242,-176],[289,-9],[186,-269],[277,-21],[402,-144],[270,401],[-113,339],[288,596],[311,-238],[252,-67],[327,-148],[53,-432],[394,-242],[263,107],[351,75],[279,-76],[272,-276],[168,-295],[258,6],[350,-94],[255,143],[366,96],[407,405],[166,-62],[146,-193],[331,48]],[[59599,45195],[209,47],[334,-163],[73,73],[193,15],[99,173],[167,-10],[303,224],[221,334]],[[61198,45888],[45,-258],[-11,-574],[34,-505],[11,-900],[49,-282],[-83,-412],[-108,-400],[-177,-357],[-254,-219],[-313,-279],[-313,-618],[-107,-106],[-194,-409],[-115,-133],[-23,-411],[132,-436],[54,-337],[4,-173],[49,29],[-8,-565],[-45,-267],[65,-99],[-41,-239],[-116,-205],[-229,-195],[-334,-312],[-122,-213],[24,-242],[71,-39],[-24,-303]],[[59119,36429],[-211,5]],[[58908,36434],[-24,254],[-41,259]],[[58843,36947],[-23,206],[49,642],[-72,410],[-133,810]],[[58664,39015],[292,654],[74,415],[42,52],[31,339],[-45,171],[12,430],[54,400],[0,728],[-145,185],[-132,42],[-60,143],[-128,121],[-232,-11],[-18,215]],[[58409,42899],[-26,410],[843,474]],[[59226,43783],[159,-276],[77,53],[110,-146],[16,-231],[-59,-268],[21,-405],[181,-356],[85,399],[120,122],[-24,740],[-116,417],[-100,185],[-97,-8],[-77,748],[77,438]],[[46619,60247],[-184,395],[-168,424],[-184,153],[-133,169],[-155,-6],[-135,-126],[-138,50],[-96,-185]],[[45426,61121],[-24,311],[78,283],[34,543],[-30,569],[-34,286],[28,287],[-72,274],[-146,249]],[[45260,63923],[60,192],[1088,-4],[-53,832],[68,296],[261,51],[-9,1474],[911,-30],[1,872]],[[59226,43783],[-147,149],[85,535],[87,201],[-53,477],[56,467],[47,156],[-71,489],[-131,257]],[[59099,46514],[273,-108],[55,-159],[95,-269],[77,-783]],[[78372,55412],[64,-54],[164,-347],[116,-386],[16,-388],[-29,-262],[27,-198],[20,-340],[98,-159],[109,-509],[-5,-195],[-197,-38],[-263,426],[-329,457],[-32,294],[-161,385],[-38,477],[-100,314],[30,419],[-61,244]],[[77801,55552],[48,103],[227,-252],[22,-296],[183,69],[91,236]],[[80461,52985],[204,-198],[214,108],[56,488],[119,108],[333,125],[199,456],[137,364]],[[82069,54967],[214,400],[140,450],[112,2],[143,-291],[13,-251],[183,-160],[231,-173],[-20,-226],[-186,-29],[50,-281],[-205,-196]],[[54540,35373],[-207,435],[-108,420],[-62,561],[-68,417],[-93,887],[-7,689],[-35,314],[-108,237],[-144,476],[-146,691],[-60,361],[-226,563],[-17,441]],[[56448,41738],[228,131],[180,-33],[109,-130],[2,-48]],[[55526,37566],[0,-2127],[-248,-294],[-149,-42],[-175,108],[-125,42],[-47,247],[-109,157],[-133,-284]],[[96049,39690],[228,-357],[144,-265],[-105,-138],[-153,155],[-199,259],[-179,306],[-184,406],[-38,195],[119,-8],[156,-196],[122,-196],[89,-161]],[[54125,64996],[68,-895],[104,-150],[4,-183],[116,-198],[-60,-248],[-107,-1168],[-15,-749],[-354,-543],[-120,-759],[115,-213],[0,-371],[178,-13],[-28,-271]],[[53939,59018],[-52,-12],[-188,630],[-65,23],[-217,-322],[-215,168],[-150,34],[-80,-81],[-163,17],[-164,-245],[-141,-14],[-337,298],[-131,-142],[-142,10],[-104,218],[-279,214],[-298,-68],[-72,-124],[-39,-331],[-80,-233],[-19,-514]],[[52361,54577],[-289,-207],[-105,30],[-107,-129],[-222,13],[-149,360],[-91,417],[-197,379],[-209,-7],[-245,1]],[[26191,58215],[-96,181],[-130,233],[-61,194],[-117,181],[-140,260],[31,89],[46,-87],[21,41]],[[26903,60465],[-24,-55],[-14,-129],[29,-210],[-64,-197],[-30,-231],[-9,-254],[15,-148],[7,-260],[-43,-56],[-26,-247],[19,-152],[-56,-147],[12,-156],[43,-94]],[[50920,81398],[143,159],[244,847],[380,241],[231,-16]],[[58639,91887],[-473,-231],[-224,-54]],[[55734,91626],[-172,-23],[-41,-379],[-523,92],[-74,-321],[-267,2],[-183,-409],[-278,-639],[-431,-810],[101,-197],[-97,-228],[-275,10],[-180,-540],[17,-765],[177,-292],[-92,-677],[-231,-395],[-122,-332]],[[53063,85723],[-187,354],[-548,-666],[-371,-135],[-384,293],[-99,619],[-88,1329],[256,371],[733,483],[549,595],[508,802],[668,1112],[465,434],[763,722],[610,252],[457,-31],[423,477],[506,-25],[499,115],[869,-422],[-358,-154],[305,-361]],[[56867,96664],[-620,-236],[-490,134],[191,149],[-167,184],[575,115],[110,-216],[401,-130]],[[55069,97728],[915,-429],[-699,-227],[-155,-424],[-243,-108],[-132,-478],[-335,-22],[-598,351],[252,205],[-416,166],[-541,487],[-216,451],[757,206],[152,-202],[396,8],[105,197],[408,20],[350,-201]],[[57068,98134],[545,-202],[-412,-310],[-806,-68],[-819,96],[-50,159],[-398,10],[-304,264],[858,161],[403,-138],[281,172],[702,-144]],[[98060,28265],[63,-238],[198,233],[80,-243],[0,-242],[-103,-267],[-182,-424],[-142,-232],[103,-277],[-214,-7],[-238,-217],[-75,-377],[-157,-583],[-219,-257],[-138,-164],[-256,12],[-180,190],[-302,40],[-46,212],[149,427],[349,568],[179,109],[200,219],[238,301],[167,299],[123,429],[106,146],[41,321],[195,267],[61,-245]],[[98502,31008],[202,-607],[5,394],[126,-158],[41,-435],[224,-188],[188,-46],[158,220],[141,-67],[-67,-511],[-85,-336],[-212,12],[-74,-175],[26,-248],[-41,-107],[-105,-310],[-138,-395],[-214,-229],[-48,151],[-116,83],[160,474],[-91,317],[-299,230],[8,209],[201,200],[47,444],[-13,372],[-113,386],[8,102],[-133,237],[-218,510],[-117,408],[104,45],[151,-320],[216,-149],[78,-513]],[[64752,61418],[-91,403],[-217,950]],[[64444,62771],[833,576],[185,1152],[-127,408]],[[65665,66183],[125,-393],[155,-209],[203,-76],[165,-105],[125,-330],[75,-191],[100,-73],[-1,-128],[-101,-344],[-44,-161],[-117,-184],[-104,-395],[-126,30],[-58,-137],[-44,-292],[34,-385],[-26,-71],[-128,2],[-174,-215],[-27,-281],[-63,-121],[-173,4],[-109,-145],[1,-232],[-134,-160],[-153,54],[-186,-194],[-128,-33]],[[65575,66834],[80,196],[35,-50],[-26,-238],[-37,-104]],[[68937,65473],[-203,146],[-83,414],[-215,438],[-512,-108],[-451,-11],[-391,-81]],[[28366,55989],[-93,166],[-59,311],[68,154],[-70,40],[-52,190],[-138,160],[-122,-37],[-56,-200],[-112,-145],[-61,-20],[-27,-120],[132,-312],[-75,-74],[-40,-85],[-130,-29],[-48,344],[-36,-98],[-92,33],[-56,232],[-114,38],[-72,68],[-119,-1],[-8,-125],[-32,87]],[[27070,57338],[100,-206],[-6,-122],[111,-26],[26,47],[77,-142],[136,42],[119,145],[168,116],[95,172],[153,-33],[-10,-57],[155,-20],[124,-99],[90,-173],[105,-159]],[[30452,41263],[-279,331],[-24,236],[-551,578],[-498,630],[-214,355],[-115,476],[46,166],[-236,755],[-274,1063],[-262,1147],[-114,262],[-87,424],[-216,376],[-198,233],[90,257],[-134,550],[86,403],[221,364]],[[85104,56675],[28,-382],[16,-323],[-94,-527],[-102,587],[-130,-292],[89,-425],[-79,-270],[-327,335],[-78,416],[84,274],[-176,273],[-87,-239],[-131,22],[-205,-321],[-46,168],[109,486],[175,161],[151,217],[98,-260],[212,157],[45,257],[196,16],[-16,445],[225,-273],[23,-290],[20,-212]],[[84439,57749],[-100,-190],[-87,-363],[-87,-171],[-171,398],[57,154],[70,162],[30,357],[153,34],[-44,-388],[205,556],[-26,-549]],[[82917,57194],[-369,-546],[136,403],[200,355],[167,399],[146,572],[49,-470],[-183,-317],[-146,-396]],[[83856,58678],[166,-179],[177,1],[-5,-240],[-129,-245],[-176,-173],[-10,268],[20,293],[-43,275]],[[84861,58834],[78,-643],[-214,152],[5,-193],[68,-355],[-132,-129],[-11,405],[-84,30],[-43,348],[163,-46],[-4,218],[-169,440],[266,-13],[77,-214]],[[83757,59356],[-74,-498],[-119,288],[-142,438],[238,-21],[97,-207]],[[83700,62485],[171,-164],[85,150],[26,-146],[-46,-239],[95,-413],[-73,-478],[-164,-191],[-43,-465],[62,-458],[147,-64],[123,68],[347,-319],[-27,-313],[91,-139],[-29,-265],[-216,283],[-103,302],[-71,-211],[-177,345],[-253,-86],[-138,128],[14,238],[87,146],[-83,133],[-36,-207],[-137,331],[-41,251],[-11,551],[112,-190],[29,901],[90,522],[169,-1]],[[93299,47902],[-78,-58],[-120,221],[-122,366],[-59,439],[38,55],[30,-171],[84,-130],[135,-366],[131,-195],[-39,-161]],[[92217,48675],[-146,-48],[-44,-161],[-152,-140],[-142,-135],[-148,1],[-228,167],[-158,161],[23,178],[249,-84],[152,45],[42,276],[40,14],[27,-306],[158,44],[78,197],[155,206],[-30,339],[166,11],[56,-94],[-5,-320],[-93,-351]],[[89166,50332],[482,-397],[513,-329],[192,-295],[154,-290],[43,-339],[462,-356],[68,-306],[-256,-62],[62,-383],[248,-378],[180,-611],[159,19],[-11,-255],[215,-98],[-84,-108],[295,-243],[-30,-166],[-184,-40],[-69,149],[-238,65],[-281,86],[-216,368],[-158,316],[-144,504],[-362,252],[-235,-164],[-170,-190],[35,-425],[-218,-198],[-155,96],[-288,25]],[[92538,49238],[-87,-154],[-52,340],[-65,223],[-126,189],[-158,245],[-200,170],[77,139],[150,-162],[94,-126],[117,-139],[111,-241],[106,-185],[33,-299]],[[53922,82787],[189,169],[434,266],[350,195],[277,-97],[21,-140],[268,-8]],[[55461,83172],[342,-65],[511,9]],[[56535,81532],[139,-502],[-29,-162],[-138,-67],[-252,-479],[71,-259],[-60,34]],[[56266,80097],[-264,221],[-200,-81],[-131,59],[-165,-123],[-140,204],[-114,-78],[-16,34]],[[31588,62492],[142,-51],[50,-114],[-71,-146],[-209,4],[-163,-21],[-16,247],[40,84],[227,-3]],[[86288,76244],[39,-101]],[[86327,76143],[-106,35],[-120,-195],[-83,-196],[10,-414],[-143,-127],[-50,-102],[-104,-170],[-185,-95],[-121,-154],[-9,-250],[-32,-63],[111,-94],[157,-253]],[[85048,73569],[-135,109],[-34,-108],[-81,-48],[-10,109],[-72,52],[-75,92],[76,254],[66,67],[-25,105],[71,311],[-18,94],[-163,63],[-131,154]],[[47929,73193],[-112,-149],[-146,81],[-143,-64],[42,451],[-26,354],[-124,53],[-67,218],[22,377],[111,210],[20,232],[58,347],[-6,244],[-56,206],[-12,195]],[[64113,66085],[-18,419],[75,302],[76,62],[84,-180],[5,-337],[-61,-339]],[[64274,66012],[-77,-41],[-84,114]],[[56308,79404],[120,123],[172,-64],[178,-2],[129,-141],[95,89],[205,55],[69,135],[118,0]],[[57842,78025],[124,-106],[131,93],[126,-99]],[[58223,77913],[6,-149],[-135,-124],[-84,54],[-78,-694]],[[56293,77303],[-51,101],[65,97],[-69,72],[-87,-129],[-162,167],[-22,237],[-169,136],[-31,183],[-151,226]],[[89901,81054],[280,-1020],[-411,190],[-171,-832],[271,-590],[-8,-403],[-211,347],[-182,-445],[-51,483],[31,561],[-32,621],[64,436],[13,770],[-163,566],[24,787],[257,265],[-110,267],[123,81],[73,-381],[96,-555],[-7,-567],[114,-581]],[[55461,83172],[63,254],[383,186]],[[99999,92620],[-305,-29],[-49,183],[-99645,240],[36,24],[235,-1],[402,-165],[-24,-79],[-286,-138],[-363,-35],[99999,0]],[[89889,93991],[-421,-4],[-569,64],[-49,31],[263,227],[348,54],[394,-221],[34,-151]],[[91869,95069],[-321,-228],[-444,52],[-516,227],[66,187],[518,-87],[697,-151]],[[90301,95344],[-219,-427],[-1023,16],[-461,-136],[-550,374],[149,396],[366,108],[734,-25],[1004,-306]],[[65981,92556],[-164,-51],[-907,75],[-74,256],[-503,154],[-40,311],[284,124],[-10,314],[551,491],[-255,70],[665,506],[-75,261],[621,304],[917,370],[925,108],[475,214],[541,74],[193,-227],[-187,-179],[-984,-286],[-848,-274],[-863,-548],[-414,-563],[-435,-553],[56,-479],[531,-472]],[[63639,78550],[-127,-342],[-269,-95],[-276,-594],[252,-547],[-27,-388],[303,-678]],[[61098,76843],[-354,486],[-317,218],[-240,338],[202,92],[231,482],[-156,227],[410,236],[-8,125],[-249,-92]],[[60617,78955],[9,255],[143,161],[269,42],[44,192],[-62,318],[113,302],[-3,169],[-410,187],[-162,-6],[-172,270],[-213,-92],[-352,203],[6,113],[-99,250],[-222,28],[-23,178],[70,117],[-178,326],[-288,-56],[-84,29],[-70,-131],[-104,24]],[[57772,86080],[316,318],[-291,274]],[[58639,91887],[286,200],[456,-348],[761,-137],[1050,-652],[213,-273],[18,-384],[-308,-302],[-454,-154],[-1240,438],[-204,-73],[453,-422],[18,-267],[18,-589],[358,-175],[217,-150],[36,279],[-168,248],[177,218],[672,-358],[233,140],[-186,422],[647,564],[256,-33],[260,-202],[161,396],[-231,343],[136,345],[-204,357],[777,-185],[158,-322],[-351,-71],[1,-321],[219,-197],[429,125],[68,367],[580,274],[970,495],[209,-28],[-273,-350],[344,-60],[199,197],[521,16],[412,239],[317,-347],[315,381],[-291,334],[145,190],[820,-175],[385,-180],[1006,-658],[186,302],[-282,304],[-8,122],[-335,57],[92,273],[-149,449],[-8,185],[512,521],[183,523],[206,114],[736,-152],[57,-320],[-263,-468],[173,-183],[89,-403],[-63,-789],[307,-353],[-120,-384],[-544,-818],[318,-85],[110,207],[306,148],[74,285],[240,274],[-162,328],[130,380],[-304,47],[-67,321],[222,578],[-361,469],[497,389],[-64,409],[139,13],[145,-319],[-109,-556],[297,-105],[-127,415],[465,227],[577,30],[513,-328],[-247,479],[-28,614],[483,116],[669,-25],[602,75],[-226,301],[321,378],[319,16],[540,286],[734,77],[93,157],[729,54],[227,-129],[624,306],[510,-10],[77,249],[265,245],[656,236],[476,-186],[-378,-142],[629,-89],[75,-284],[254,140],[812,-8],[626,-281],[223,-215],[-69,-300],[-307,-170],[-730,-320],[-209,-171],[345,-80],[410,-146],[251,109],[141,-369],[122,149],[444,91],[892,-95],[67,-269],[1162,-86],[15,440],[590,-101],[443,3],[449,-303],[128,-369],[-165,-241],[349,-453],[437,-234],[268,605],[446,-260],[473,155],[538,-177],[204,162],[455,-81],[-201,534],[367,250],[2509,-374],[236,-342],[727,-440],[1122,109],[553,-95],[231,-238],[-33,-421],[342,-164],[372,118],[492,15],[525,-113],[526,64],[484,-512],[344,184],[-224,368],[123,256],[886,-161],[578,34],[799,-275],[-99610,-251],[681,-440],[728,-572],[-24,-358],[187,-143],[-64,418],[754,-86],[544,-539],[-276,-251],[-455,-59],[-7,-563],[-111,-120],[-260,17],[-212,201],[-369,168],[-62,250],[-283,94],[-315,-74],[-151,201],[60,214],[-333,-137],[126,-271],[-158,-244],[0,-3],[99640,-253],[-360,42],[250,-307],[166,-474],[128,-155],[32,-238],[-71,-153],[-518,126],[-777,-434],[-247,-67],[-425,-405],[-403,-353],[-102,-262],[-397,399],[-724,-453],[-126,214],[-268,-246],[-371,79],[-90,-379],[-333,-557],[10,-233],[316,-129],[-37,-839],[-258,-21],[-119,-482],[116,-248],[-486,-294],[-96,-657],[-415,-141],[-83,-585],[-400,-536],[-103,396],[-119,841],[-155,1279],[134,799],[234,344],[14,269],[432,129],[496,725],[479,592],[499,459],[223,812],[-337,-49],[-167,-474],[-705,-632],[-227,708],[-717,-196],[-696,-965],[230,-353],[-620,-151],[-430,-59],[20,417],[-431,87],[-344,-283],[-850,99],[-914,-171],[-899,-1124],[-1065,-1358],[438,-73],[136,-360],[270,-128],[178,288],[305,-38],[401,-633],[9,-490],[-217,-576],[-23,-687],[-126,-921],[-418,-833],[-94,-399],[-377,-670],[-374,-665],[-179,-340],[-370,-338],[-175,-8],[-175,280],[-373,-421],[-43,-192]],[[79187,96925],[-1566,-222],[507,756],[229,64],[208,-37],[704,-327],[-82,-234]],[[64204,98215],[-373,-76],[-250,-44],[-39,-94],[-324,-95],[-301,136],[158,180],[-618,17],[542,105],[422,7],[57,-155],[159,138],[262,95],[412,-126],[-107,-88]],[[77760,97255],[-606,-71],[-773,166],[-462,220],[-213,413],[-379,113],[722,394],[600,130],[540,-290],[640,-557],[-69,-518]],[[58449,51176],[110,-325],[-16,-339],[-80,-73]],[[58216,51057],[67,-59],[166,178]],[[45260,63923],[12,243]],[[61883,61244],[-37,246],[-83,173],[-22,230],[-143,206],[-148,483],[-79,469],[-192,397],[-124,94],[-184,549],[-32,400],[12,342],[-159,638],[-130,225],[-150,119],[-92,330],[15,130],[-77,299],[-81,128],[-108,429],[-170,464],[-141,395],[-139,-2],[44,316],[12,201],[34,230]],[[63448,68272],[109,-497],[137,-131],[47,-203],[190,-242],[16,-237],[-27,-192],[35,-193],[80,-162],[37,-189],[41,-141]],[[64274,66012],[53,-220]],[[64444,62771],[-801,-221],[-259,-259],[-199,-604],[-130,-96],[-70,191],[-106,-28],[-269,57],[-50,58],[-321,-13],[-75,-52],[-114,149],[-74,-283],[28,-243],[-121,-183]],[[59434,57280],[-39,11],[5,287],[-33,197],[-143,228],[-34,415],[34,425],[-129,40],[-19,-129],[-167,-29],[67,-169],[23,-346],[-152,-316],[-138,-415],[-144,-59],[-233,336],[-105,-119],[-29,-168],[-143,-109],[-9,-118],[-277,0],[-38,118],[-200,20],[-100,-99],[-77,50],[-143,336],[-48,158],[-200,-79],[-76,-267],[-72,-514],[-95,-109],[-85,-63]],[[56635,56793],[-23,27]],[[56351,58246],[3,140],[-102,169],[-3,335],[-58,222],[-98,-33],[28,211],[72,240],[-32,239],[92,176],[-58,135],[73,355],[127,425],[240,-41],[-14,2286]],[[60240,64499],[90,-565],[-61,-105],[40,-593],[102,-687],[106,-142],[152,-213]],[[59433,57348],[1,-68]],[[59434,57280],[3,-449]],[[59445,54277],[-171,-265],[-195,1],[-224,-135],[-176,129],[-115,-157]],[[56824,56568],[-189,225]],[[45357,59658],[-115,449],[-138,205],[122,109],[134,404],[66,296]],[[45367,58962],[-46,441]],[[95032,45793],[78,-198],[-194,3],[-106,355],[166,-140],[56,-20]],[[94680,46144],[-108,-13],[-170,58],[-58,89],[17,228],[183,-90],[91,-121],[45,-151]],[[94910,46301],[-42,-106],[-206,499],[-57,344],[94,0],[100,-461],[111,-276]],[[94409,47028],[12,-116],[-218,245],[-152,206],[-104,192],[41,59],[128,-138],[228,-265],[65,-183]],[[93760,47598],[-56,-33],[-121,131],[-114,237],[14,96],[166,-243],[111,-188]],[[46822,55737],[-75,43],[-200,232],[-144,308],[-49,211],[-34,425]],[[25613,59537],[-31,-135],[-161,8],[-100,55],[-115,115],[-154,36],[-79,123]],[[61984,58430],[91,-106],[54,-238],[125,-241],[138,-2],[262,147],[302,68],[245,179],[138,38],[99,105],[158,20]],[[63596,58400],[-2,-9],[-1,-237],[0,-581],[0,-301],[-125,-353],[-194,-481]],[[63596,58400],[89,12],[128,85],[147,58],[132,198],[105,1],[6,-159],[-25,-335],[1,-303],[-59,-208],[-78,-622],[-134,-644],[-172,-735],[-238,-844],[-237,-645],[-327,-785],[-278,-467],[-415,-571],[-259,-438],[-304,-698],[-64,-304],[-63,-136]],[[34125,55269],[333,-115],[30,104],[225,41],[298,-155]],[[34889,54255],[109,-341],[-49,-248],[-24,-263],[-71,-242]],[[56266,80097],[-77,-150],[-55,-232]],[[53809,78032],[62,52]],[[56639,89841],[-478,-163],[-269,-401],[43,-353],[-441,-463],[-537,-495],[-202,-811],[198,-406],[265,-320],[-255,-649],[-289,-135],[-106,-967],[-157,-539],[-337,55],[-158,-456],[-321,-27],[-89,545],[-232,653],[-211,814]],[[58908,36434],[-56,-256],[-163,-62],[-166,312],[-2,199],[76,216],[26,168],[80,41],[140,-105]],[[59999,71781],[-26,440],[68,237]],[[60041,72458],[74,126],[75,127],[15,321],[91,-112],[306,160],[147,-108],[229,1],[320,217],[149,-10],[316,89]],[[50518,55366],[-224,-122]],[[78495,58847],[-249,265],[-238,-11],[41,452],[-245,-3],[-22,-633],[-150,-841],[-90,-509],[19,-417],[181,-18],[113,-526],[50,-498],[155,-330],[168,-67],[144,-299]],[[77801,55552],[-110,221],[-47,285],[-148,325],[-135,274],[-45,-339],[-53,320],[30,359],[82,553]],[[68841,73220],[156,583],[-60,429],[-204,137],[72,254],[232,-27],[132,318],[89,370],[371,134],[-58,-267],[40,-161],[114,15]],[[64978,73251],[-52,408],[40,602],[-216,195],[71,394],[-184,34],[61,485],[262,-141],[244,184],[-202,346],[-80,329],[-224,-147],[-28,-422],[-87,374]],[[65546,75618],[313,8],[-45,290],[237,199],[234,334],[374,-304],[30,-460],[106,-118],[301,27],[93,-105],[137,-593],[317,-398],[181,-271],[291,-282],[369,-247],[-7,-352]],[[84713,46708],[32,136],[239,129],[194,20],[87,72],[105,-72],[-102,-156],[-289,-252],[-233,-165]],[[32866,58026],[160,75],[58,-20],[-11,-430],[-232,-63],[-50,52],[81,158],[-6,228]],[[52339,73106],[302,232],[195,-69],[-9,-291],[236,212],[20,-111],[-139,-282],[-2,-266],[96,-143],[-36,-499],[-183,-289],[53,-314],[143,-10],[70,-274],[106,-90]],[[60041,72458],[-102,261],[105,217],[-169,-49],[-233,132],[-191,-331],[-421,-65],[-225,309],[-300,19],[-64,-238],[-192,-69],[-268,307],[-303,-11],[-165,573],[-203,320],[135,447],[-176,276],[308,550],[428,23],[117,438],[529,-76],[334,373],[324,163],[459,13],[485,-406],[399,-223],[323,89],[239,-52],[328,301]],[[57776,76021],[33,-222],[243,-186],[-51,-141],[-330,-32],[-118,-178],[-232,-310],[-87,268],[3,119]],[[83826,65878],[-167,-924],[-119,-472],[-146,486],[-32,427],[163,566],[223,436],[127,-172],[-49,-347]],[[60889,49136],[-128,-710],[16,-326],[178,-210],[8,-149],[-76,-348],[16,-175],[-18,-275],[97,-361],[115,-568],[101,-126]],[[59099,46514],[-157,172],[-177,97],[-111,97],[-116,146]],[[58449,51176],[98,69],[304,-7],[566,44]],[[60617,78955],[-222,-46],[-185,-187],[-260,-30],[-239,-215],[16,-358],[136,-139],[284,35],[-55,-206],[-304,-100],[-377,-333],[-154,117],[61,271],[-304,169],[50,110],[265,191],[-80,132],[-432,146],[-19,215],[-257,-71],[-103,-317],[-215,-426]],[[35174,32383],[-121,-362],[-313,-320],[-205,115],[-151,-62],[-256,247],[-189,-18],[-169,319]],[[6794,62819],[-41,-96],[-69,82],[8,161],[-46,210],[14,64],[48,94],[-19,113],[16,54],[21,-11],[107,-97],[49,-50],[45,-77],[71,-202],[-7,-32],[-108,-123],[-89,-90]],[[6645,63718],[-94,-41],[-47,121],[-32,47],[-3,36],[27,49],[99,-55],[73,-88],[-23,-69]],[[6456,64025],[-9,-63],[-149,17],[21,70],[137,-24]],[[6207,64108],[-15,-33],[-19,8],[-97,20],[-35,130],[-11,23],[74,80],[23,-37],[80,-191]],[[5737,64488],[-33,-57],[-93,105],[14,42],[43,57],[64,-13],[5,-134]],[[31350,77823],[48,-189],[-296,-279],[-286,-198],[-293,-171],[-147,-342],[-47,-129],[-3,-306],[92,-305],[115,-14],[-29,210],[83,-128],[-22,-165],[-188,-93],[-133,11],[-205,-100],[-121,-29],[-162,-28],[-231,-167],[408,108],[82,-109],[-389,-173],[-177,-1],[8,71],[-84,-160],[82,-26],[-60,-414],[-203,-443],[-20,148],[-61,30],[-91,144],[57,-310],[69,-103],[5,-217],[-89,-224],[-157,-460],[-25,23],[86,392],[-142,220],[-33,478],[-53,-249],[59,-365],[-183,90],[191,-185],[12,-548],[79,-40],[29,-199],[39,-577],[-176,-427],[-288,-171],[-182,-338],[-139,-37],[-141,-211],[-39,-193],[-305,-374],[-157,-274],[-131,-342],[-43,-409],[50,-400],[92,-492],[124,-408],[1,-249],[132,-668],[-9,-388],[-12,-224],[-69,-352],[-83,-73],[-137,70],[-44,253],[-105,132],[-148,496],[-129,440],[-42,225],[57,383],[-77,316],[-217,482],[-108,89],[-281,-262],[-49,29],[-135,269],[-174,142],[-314,-72],[-247,63],[-212,-39],[-114,-90],[50,-153],[-5,-234],[59,-113],[-53,-76],[-103,85],[-104,-109],[-202,17],[-207,305],[-242,-72],[-202,133],[-173,-40],[-234,-135],[-253,-427],[-276,-248],[-152,-275],[-63,-259],[-3,-397],[14,-277],[52,-196]],[[17464,70566],[-46,294],[-180,331],[-130,69],[-30,165],[-156,29],[-100,156],[-258,57],[-71,93],[-33,316],[-270,578],[-231,801],[10,133],[-123,190],[-215,483],[-38,469],[-148,315],[61,477],[-10,494],[-89,441],[109,543],[34,523],[33,522],[-50,773],[-88,492],[-80,268],[33,112],[402,-195],[148,-544],[69,152],[-45,472],[-94,473]],[[7498,84721],[-277,-219],[-142,148],[-43,270],[252,205],[148,88],[185,-39],[117,-179],[-240,-274]],[[4006,86330],[-171,-89],[-182,107],[-168,157],[274,98],[220,-52],[27,-221]],[[2297,88560],[171,-109],[173,59],[225,-152],[276,-77],[-23,-63],[-211,-121],[-211,125],[-106,104],[-245,-33],[-66,51],[17,216]],[[13740,83389],[-153,217],[-245,183],[-78,503],[-358,466],[-150,543],[-267,38],[-441,14],[-326,165],[-574,598],[-266,109],[-486,206],[-385,-49],[-546,264],[-330,246],[-309,-122],[58,-400],[-154,-37],[-321,-120],[-245,-195],[-308,-122],[-39,339],[125,565],[295,177],[-76,145],[-354,-321],[-190,-383],[-400,-410],[203,-280],[-262,-413],[-299,-241],[-278,-176],[-69,-255],[-434,-297],[-87,-271],[-325,-246],[-191,44],[-259,-160],[-282,-196],[-231,-193],[-477,-164],[-43,96],[304,270],[271,177],[296,315],[345,65],[137,236],[385,345],[62,115],[205,204],[48,437],[141,340],[-320,-175],[-90,99],[-150,-209],[-181,292],[-75,-207],[-104,287],[-278,-230],[-170,0],[-24,343],[50,211],[-179,205],[-361,-110],[-235,270],[-190,138],[-1,327],[-214,245],[108,331],[226,322],[99,295],[225,42],[191,-92],[224,278],[201,-50],[212,179],[-52,263],[-155,104],[205,222],[-170,-7],[-295,-125],[-85,-127],[-219,127],[-392,-65],[-407,138],[-117,232],[-351,334],[390,241],[620,282],[228,0],[-38,-288],[586,22],[-225,357],[-342,219],[-197,288],[-267,246],[-381,182],[155,302],[493,19],[350,262],[66,280],[284,274],[271,66],[526,256],[256,-39],[427,307],[421,-121],[201,-260],[123,112],[469,-35],[-16,-132],[425,-98],[283,57],[585,-182],[534,-54],[214,-75],[370,94],[421,-173],[302,-81]],[[30185,58611],[-8,-136],[-163,-67],[91,-262],[-3,-301],[-123,-334],[105,-457],[120,37],[62,417],[-86,202],[-14,436],[346,234],[-38,272],[97,181],[100,-404],[195,-10],[180,-321],[11,-190],[249,-6],[297,60],[159,-258],[213,-71],[155,180],[4,145],[344,34],[333,8],[-236,-170],[95,-272],[222,-43],[210,-283],[45,-462],[144,13],[109,-135]],[[80013,64241],[-371,-493],[-231,-544],[-61,-399],[212,-607],[260,-753],[252,-356],[169,-462],[127,-1066],[-37,-1013],[-232,-379],[-318,-371],[-227,-480],[-346,-536],[-101,369],[78,390],[-206,327]],[[96623,42347],[-92,-76],[-93,252],[10,155],[175,-331]],[[96418,43229],[45,-464],[-75,72],[-58,-31],[-39,159],[-6,441],[133,-177]],[[64752,61418],[-201,-154],[-54,-256],[-6,-196],[-277,-244],[-444,-268],[-249,-406],[-122,-32],[-83,34],[-163,-239],[-177,-111],[-233,-30],[-70,-33],[-61,-152],[-73,-42],[-43,-146],[-137,12],[-89,-78],[-192,30],[-72,336],[8,315],[-46,170],[-54,426],[-80,236],[56,28],[-29,264],[34,111],[-12,251]],[[58175,39107],[113,-6],[134,-97],[94,69],[148,-58]],[[59119,36429],[-70,-419],[-32,-479],[-72,-260],[-190,-290],[-54,-84],[-118,-292],[-77,-296],[-158,-413],[-314,-594],[-196,-345],[-210,-262],[-290,-224],[-141,-30],[-36,-160],[-169,85],[-138,-109],[-301,111],[-168,-71],[-115,31],[-286,-228],[-238,-91],[-171,-218],[-127,-13],[-117,205],[-94,10],[-120,258],[-13,-80],[-37,155],[2,337],[-90,386],[89,105],[-7,442],[-182,539],[-139,488],[-1,1],[-199,749]],[[58409,42899],[-210,-79],[-159,-230],[-33,-199],[-100,-46],[-241,-473],[-154,-373],[-94,-13],[-90,66],[-311,63]]],transform:{scale:[.0036000360003600037,.0017364686646866468],translate:[-180,-90]}},Xi=".mapboxgl-ctrl-globe-minimap";function zi(t){Object.assign(this.options,t),this._parentMap=null}return zi.prototype={options:{id:"mapboxgl-globe-minimap",globeSize:82,landColor:"white",waterColor:"rgba(30 40 70/60%)",markerColor:"#ff2233",markerSize:1},onAdd:function(t){return this._parentMap=t,this._container=this._createContainer(t),this._load(),this._container},initialTween:!0,_load:async function(){const{globeSize:t}=this.options,n=this._parentMap,e=this.canvas=mt(Xi).append("canvas").node(),r=this.context=e.getContext("2d"),i=window.devicePixelRatio||1;var o,u;e.width=t*i,e.height=t*i,e.style.width=t+"px",e.style.height=t+"px",r.scale(i,i),this.projection=ji(Ri).scale(249.5).clipAngle(90+Se).fitExtent([[0,0],[t,t]],{type:"Sphere"}),this.path=function(t,n){let e,r,i=3,o=4.5;function u(t){return t&&("function"==typeof o&&r.pointRadius(+o.apply(this,arguments)),Ve(t,e(r))),r.result()}return u.area=function(t){return Ve(t,e(Mr)),Mr.result()},u.measure=function(t){return Ve(t,e(pi)),pi.result()},u.bounds=function(t){return Ve(t,e(Or)),Or.result()},u.centroid=function(t){return Ve(t,e(Wr)),Wr.result()},u.projection=function(n){return arguments.length?(e=null==n?(t=null,Sr):(t=n).stream,u):t},u.context=function(t){return arguments.length?(r=null==t?(n=null,new wi(i)):new ui(n=t),"function"!=typeof o&&r.pointRadius(o),u):n},u.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(r.pointRadius(+t),+t),u):o},u.digits=function(t){if(!arguments.length)return i;if(null==t)i=null;else{const n=Math.floor(t);if(!(n>=0))throw new RangeError(`invalid digits: ${t}`);i=n}return null===n&&(r=new wi(i)),u},u.projection(t).digits(i).context(n)}(this.projection,r),this.globe={type:"Sphere"},this.land=(o=Li,"GeometryCollection"===(u=Li.objects.land).type?{type:"FeatureCollection",features:u.geometries.map((function(t){return Oi(o,t)}))}:Oi(o,u)),this._update(),n.on("move",this._update.bind(this))},_draw_marker:function(){const{globeSize:t,markerSize:n,markerColor:e}=this.options;mt(Xi).append("svg").attr("width",t).attr("height",t).attr("style","position: absolute; left: 0; top: 0;").append("path").attr("opacity",0).attr("d","M5.36018 5.33333C5.36018 4.59722 5.61972 3.96875 6.13881 3.44792C6.65789 2.92708 7.28426 2.66667 8.0179 2.66667C8.75154 2.66667 9.3779 2.92708 9.89699 3.44792C10.4161 3.96875 10.6756 4.59722 10.6756 5.33333C10.6756 6.06944 10.4161 6.69792 9.89699 7.21875C9.3779 7.73958 8.75154 8 8.0179 8C7.28426 8 6.65789 7.73958 6.13881 7.21875C5.61972 6.69792 5.36018 6.06944 5.36018 5.33333ZM2.70246 5.33333C2.70246 6.09028 2.81666 6.7118 3.04506 7.19792L6.824 15.2604C6.93474 15.4896 7.09911 15.6701 7.31713 15.8021C7.53515 15.934 7.76874 16 8.0179 16C8.26706 16 8.50065 15.934 8.71866 15.8021C8.93668 15.6701 9.09759 15.4896 9.20141 15.2604L12.9907 7.19792C13.2191 6.71181 13.3333 6.09028 13.3333 5.33333C13.3333 3.86111 12.8142 2.60417 11.7761 1.5625C10.7379 0.520833 9.48518 -8.13254e-07 8.0179 -9.41527e-07C6.55062 -1.0698e-06 5.29789 0.520832 4.25972 1.5625C3.22155 2.60417 2.70246 3.86111 2.70246 5.33333Z").attr("transform",`scale(${n}, ${n}), translate(${t*(1/n)/2-8}, ${t*(1/n)/2-16})`).attr("style","fill:"+e).transition().duration(100).attr("opacity",1)},_update:function(){const t=this,n=this._parentMap.getCenter();me().duration(this.initialTween?1e3:1).tween("rotate",(function(){const e=pn(t.projection.rotate(),[-n.lng,-n.lat]);return function(n){t.projection.rotate(e(n)),t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.context.fillStyle=t.options.waterColor,t.context.beginPath(),t.path(t.globe),t.context.fill(),t.context.fillStyle=t.options.landColor,t.context.beginPath(),t.path(t.land),t.context.fill()}})).on("end",(()=>{t.initialTween&&(t._draw_marker(),t.initialTween=!1)}))},_createContainer:function(t){const{globeSize:n,id:e}=this.options,r=document.createElement("div");return r.className="mapboxgl-ctrl-globe-minimap mapboxgl-ctrl",r.setAttribute("style","width: "+n+"; height: "+n+";"),r.addEventListener("contextmenu",this._preventDefault),t.getContainer().appendChild(r),""!==e&&(r.id=e),r},_preventDefault:function(t){t.preventDefault()}},window.GlobeMinimap=zi,zi}();
</script>
<script>"use strict";var pmtiles=(()=>{var k=Object.defineProperty;var Je=Object.getOwnPropertyDescriptor;var Ye=Object.getOwnPropertyNames;var Qe=Object.prototype.hasOwnProperty;var U=Math.pow;var f=(r,e)=>k(r,"name",{value:e,configurable:!0});var Xe=(r,e)=>{for(var t in e)k(r,t,{get:e[t],enumerable:!0})},_e=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ye(e))!Qe.call(r,i)&&i!==t&&k(r,i,{get:()=>e[i],enumerable:!(n=Je(e,i))||n.enumerable});return r};var et=r=>_e(k({},"__esModule",{value:!0}),r);var m=(r,e,t)=>new Promise((n,i)=>{var a=h=>{try{u(t.next(h))}catch(l){i(l)}},s=h=>{try{u(t.throw(h))}catch(l){i(l)}},u=h=>h.done?n(h.value):Promise.resolve(h.value).then(a,s);u((t=t.apply(r,e)).next())});var Dt={};Xe(Dt,{Compression:()=>Oe,EtagMismatch:()=>B,FetchSource:()=>K,FileSource:()=>oe,PMTiles:()=>P,Protocol:()=>ie,ResolvedValueCache:()=>ue,SharedPromiseCache:()=>G,TileType:()=>se,bytesToHeader:()=>$e,findTile:()=>Fe,getUint64:()=>b,leafletRasterLayer:()=>wt,readVarint:()=>R,tileIdToZxy:()=>Tt,tileTypeExt:()=>Ze,zxyToTileId:()=>Ie});var w=Uint8Array,E=Uint16Array,tt=Int32Array,Me=new w([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ue=new w([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),rt=new w([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ee=f(function(r,e){for(var t=new E(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new tt(t[30]),n=1;n<30;++n)for(var a=t[n];a<t[n+1];++a)i[a]=a-t[n]<<5|n;return{b:t,r:i}},"freb"),Le=Ee(Me,2),Pe=Le.b,nt=Le.r;Pe[28]=258,nt[258]=28;var Se=Ee(Ue,0),it=Se.b,Ut=Se.r,re=new E(32768);for(g=0;g<32768;++g)T=(g&43690)>>1|(g&21845)<<1,T=(T&52428)>>2|(T&13107)<<2,T=(T&61680)>>4|(T&3855)<<4,re[g]=((T&65280)>>8|(T&255)<<8)>>1;var T,g,F=f(function(r,e,t){for(var n=r.length,i=0,a=new E(e);i<n;++i)r[i]&&++a[r[i]-1];var s=new E(e);for(i=1;i<e;++i)s[i]=s[i-1]+a[i-1]<<1;var u;if(t){u=new E(1<<e);var h=15-e;for(i=0;i<n;++i)if(r[i])for(var l=i<<4|r[i],c=e-r[i],o=s[r[i]-1]++<<c,v=o|(1<<c)-1;o<=v;++o)u[re[o]>>h]=l}else for(u=new E(n),i=0;i<n;++i)r[i]&&(u[i]=re[s[r[i]-1]++]>>15-r[i]);return u},"hMap"),$=new w(288);for(g=0;g<144;++g)$[g]=8;var g;for(g=144;g<256;++g)$[g]=9;var g;for(g=256;g<280;++g)$[g]=7;var g;for(g=280;g<288;++g)$[g]=8;var g,Re=new w(32);for(g=0;g<32;++g)Re[g]=5;var g;var at=F($,9,1);var st=F(Re,5,1),ee=f(function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},"max"),z=f(function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},"bits"),te=f(function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},"bits16"),ot=f(function(r){return(r+7)/8|0},"shft"),ut=f(function(r,e,t){return(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length),new w(r.subarray(e,t))},"slc");var ft=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],y=f(function(r,e,t){var n=new Error(e||ft[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,y),!t)throw n;return n},"err"),ne=f(function(r,e,t,n){var i=r.length,a=n?n.length:0;if(!i||e.f&&!e.l)return t||new w(0);var s=!t,u=s||e.i!=2,h=e.i;s&&(t=new w(i*3));var l=f(function(Te){var Ce=t.length;if(Te>Ce){var De=new w(Math.max(Ce*2,Te));De.set(t),t=De}},"cbuf"),c=e.f||0,o=e.p||0,v=e.b||0,d=e.l,p=e.d,H=e.m,I=e.n,q=i*8;do{if(!d){c=z(r,o,1);var j=z(r,o+1,3);if(o+=3,j)if(j==1)d=at,p=st,H=9,I=5;else if(j==2){var J=z(r,o,31)+257,me=z(r,o+10,15)+4,de=J+z(r,o+5,31)+1;o+=14;for(var O=new w(de),Y=new w(19),x=0;x<me;++x)Y[rt[x]]=z(r,o+x*3,7);o+=me*3;for(var ye=ee(Y),Ge=(1<<ye)-1,qe=F(Y,ye,1),x=0;x<de;){var we=qe[z(r,o,Ge)];o+=we&15;var A=we>>4;if(A<16)O[x++]=A;else{var D=0,V=0;for(A==16?(V=3+z(r,o,3),o+=2,D=O[x-1]):A==17?(V=3+z(r,o,7),o+=3):A==18&&(V=11+z(r,o,127),o+=7);V--;)O[x++]=D}}var xe=O.subarray(0,J),C=O.subarray(J);H=ee(xe),I=ee(C),d=F(xe,H,1),p=F(C,I,1)}else y(1);else{var A=ot(o)+4,W=r[A-4]|r[A-3]<<8,N=A+W;if(N>i){h&&y(0);break}u&&l(v+W),t.set(r.subarray(A,N),v),e.b=v+=W,e.p=o=N*8,e.f=c;continue}if(o>q){h&&y(0);break}}u&&l(v+131072);for(var je=(1<<H)-1,We=(1<<I)-1,Q=o;;Q=o){var D=d[te(r,o)&je],M=D>>4;if(o+=D&15,o>q){h&&y(0);break}if(D||y(2),M<256)t[v++]=M;else if(M==256){Q=o,d=null;break}else{var be=M-254;if(M>264){var x=M-257,Z=Me[x];be=z(r,o,(1<<Z)-1)+Pe[x],o+=Z}var X=p[te(r,o)&We],_=X>>4;X||y(3),o+=X&15;var C=it[_];if(_>3){var Z=Ue[_];C+=te(r,o)&(1<<Z)-1,o+=Z}if(o>q){h&&y(0);break}u&&l(v+131072);var ze=v+be;if(v<C){var Ae=a-C,Ne=Math.min(C,ze);for(Ae+v<0&&y(3);v<Ne;++v)t[v]=n[Ae+v]}for(;v<ze;++v)t[v]=t[v-C]}}e.l=d,e.p=Q,e.b=v,e.f=c,d&&(c=1,e.m=H,e.d=p,e.n=I)}while(!c);return v!=t.length&&s?ut(t,0,v):t.subarray(0,v)},"inflt");var lt=new w(0);var ht=f(function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&y(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},"gzs"),ct=f(function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},"gzl");var vt=f(function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&y(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&y(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2},"zls");function gt(r,e){return ne(r,{i:2},e&&e.out,e&&e.dictionary)}f(gt,"inflateSync");function pt(r,e){var t=ht(r);return t+8>r.length&&y(6,"invalid gzip data"),ne(r.subarray(t,-8),{i:2},e&&e.out||new w(ct(r)),e&&e.dictionary)}f(pt,"gunzipSync");function mt(r,e){return ne(r.subarray(vt(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}f(mt,"unzlibSync");function Be(r,e){return r[0]==31&&r[1]==139&&r[2]==8?pt(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?gt(r,e):mt(r,e)}f(Be,"decompressSync");var dt=typeof TextDecoder!="undefined"&&new TextDecoder,yt=0;try{dt.decode(lt,{stream:!0}),yt=1}catch(r){}var wt=f((r,e)=>{let t=!1,n="",i=L.GridLayer.extend({createTile:f((a,s)=>{let u=document.createElement("img"),h=new AbortController,l=h.signal;return u.cancel=()=>{h.abort()},t||(r.getHeader().then(c=>{c.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):c.tileType===2?n="image/png":c.tileType===3?n="image/jpeg":c.tileType===4?n="image/webp":c.tileType===5&&(n="image/avif")}),t=!0),r.getZxy(a.z,a.x,a.y,l).then(c=>{if(c){let o=new Blob([c.data],{type:n}),v=window.URL.createObjectURL(o);u.src=v,u.cancel=void 0,s(void 0,u)}}).catch(c=>{if(c.name!=="AbortError")throw c}),u},"createTile"),_removeTile:f(function(a){let s=this._tiles[a];s&&(s.el.cancel&&s.el.cancel(),s.el.width=0,s.el.height=0,s.el.deleted=!0,L.DomUtil.remove(s.el),delete this._tiles[a],this.fire("tileunload",{tile:s.el,coords:this._keyToTileCoords(a)}))},"_removeTile")});return new i(e)},"leafletRasterLayer"),xt=f(r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:f(()=>n.abort(),"cancel")}},"v3compat"),ae=class ae{constructor(e){this.tilev4=f((e,t)=>m(this,null,function*(){if(e.type==="json"){let v=e.url.substr(10),d=this.tiles.get(v);if(d||(d=new P(v),this.tiles.set(v,d)),this.metadata)return{data:yield d.getTileJson(e.url)};let p=yield d.getHeader();return(p.minLon>=p.maxLon||p.minLat>=p.maxLat)&&console.error(`Bounds of PMTiles archive ${p.minLon},${p.minLat},${p.maxLon},${p.maxLat} are not valid.`),{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:p.minZoom,maxzoom:p.maxZoom,bounds:[p.minLon,p.minLat,p.maxLon,p.maxLat]}}}let n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),i=e.url.match(n);if(!i)throw new Error("Invalid PMTiles protocol URL");let a=i[1],s=this.tiles.get(a);s||(s=new P(a),this.tiles.set(a,s));let u=i[2],h=i[3],l=i[4],c=yield s.getHeader(),o=yield s==null?void 0:s.getZxy(+u,+h,+l,t.signal);if(o)return{data:new Uint8Array(o.data),cacheControl:o.cacheControl,expires:o.expires};if(c.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4");this.tile=xt(this.tilev4);this.tiles=new Map,this.metadata=(e==null?void 0:e.metadata)||!1,this.errorOnMissingTile=(e==null?void 0:e.errorOnMissingTile)||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};f(ae,"Protocol");var ie=ae;function S(r,e){return(e>>>0)*4294967296+(r>>>0)}f(S,"toNum");function bt(r,e){let t=e.buf,n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return S(r,i);throw new Error("Expected varint not more than 10 bytes")}f(bt,"readVarintRemainder");function R(r){let e=r.buf,t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,bt(n,r))}f(R,"readVarint");function He(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let i=e[0];e[0]=e[1],e[1]=i}}f(He,"rotate");function zt(r,e){let t=U(2,r),n=e,i=e,a=e,s=[0,0],u=1;for(;u<t;)n=1&a/2,i=1&(a^n),He(u,s,n,i),s[0]+=u*n,s[1]+=u*i,a=a/4,u*=2;return[r,s[0],s[1]]}f(zt,"idOnLevel");var At=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ie(r,e,t){if(r>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>U(2,r)-1||t>U(2,r)-1)throw new Error("tile x/y outside zoom level bounds");let n=At[r],i=U(2,r),a=0,s=0,u=0,h=[e,t],l=i/2;for(;l>0;)a=(h[0]&l)>0?1:0,s=(h[1]&l)>0?1:0,u+=l*l*(3*a^s),He(l,h,a,s),l=l/2;return n+u}f(Ie,"zxyToTileId");function Tt(r){let e=0,t=0;for(let n=0;n<27;n++){let i=(1<<n)*(1<<n);if(e+i>r)return zt(n,r-e);e+=i}throw new Error("Tile zoom level exceeds max safe number limit (26)")}f(Tt,"tileIdToZxy");var Oe=(a=>(a[a.Unknown=0]="Unknown",a[a.None=1]="None",a[a.Gzip=2]="Gzip",a[a.Brotli=3]="Brotli",a[a.Zstd=4]="Zstd",a))(Oe||{});function fe(r,e){return m(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream=="undefined")return Be(new Uint8Array(r));let t=new Response(r).body;if(!t)throw new Error("Failed to read response stream");let n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}f(fe,"defaultDecompress");var se=(s=>(s[s.Unknown=0]="Unknown",s[s.Mvt=1]="Mvt",s[s.Png=2]="Png",s[s.Jpeg=3]="Jpeg",s[s.Webp=4]="Webp",s[s.Avif=5]="Avif",s))(se||{});function Ze(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}f(Ze,"tileTypeExt");var Ct=127;function Fe(r,e){let t=0,n=r.length-1;for(;t<=n;){let i=n+t>>1,a=e-r[i].tileId;if(a>0)t=i+1;else if(a<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}f(Fe,"findTile");var le=class le{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return m(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};f(le,"FileSource");var oe=le,he=class he{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let i=n.indexOf("Windows")>-1,a=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,i&&a&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,i){return m(this,null,function*(){let a,s;n?s=n:(a=new AbortController,s=a.signal);let u=new Headers(this.customHeaders);u.set("range",`bytes=${e}-${e+t-1}`);let h;this.mustReload?h="reload":this.chromeWindowsNoCache&&(h="no-store");let l=yield fetch(this.url,{signal:s,cache:h,headers:u});if(e===0&&l.status===416){let d=l.headers.get("Content-Range");if(!d||!d.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let p=+d.substr(8);l=yield fetch(this.url,{signal:s,cache:"reload",headers:{range:`bytes=0-${p-1}`}})}let c=l.headers.get("Etag");if(c!=null&&c.startsWith("W/")&&(c=null),l.status===416||i&&c&&c!==i)throw this.mustReload=!0,new B(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(l.status>=300)throw new Error(`Bad response code: ${l.status}`);let o=l.headers.get("Content-Length");if(l.status===200&&(!o||+o>t))throw a&&a.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield l.arrayBuffer(),etag:c||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}})}};f(he,"FetchSource");var K=he;function b(r,e){let t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*U(2,32)+n}f(b,"getUint64");function $e(r,e){let t=new DataView(r),n=t.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:b(t,8),rootDirectoryLength:b(t,16),jsonMetadataOffset:b(t,24),jsonMetadataLength:b(t,32),leafDirectoryOffset:b(t,40),leafDirectoryLength:b(t,48),tileDataOffset:b(t,56),tileDataLength:b(t,64),numAddressedTiles:b(t,72),numTileEntries:b(t,80),numTileContents:b(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}f($e,"bytesToHeader");function Ve(r){let e={buf:new Uint8Array(r),pos:0},t=R(e),n=[],i=0;for(let a=0;a<t;a++){let s=R(e);n.push({tileId:i+s,offset:0,length:0,runLength:1}),i+=s}for(let a=0;a<t;a++)n[a].runLength=R(e);for(let a=0;a<t;a++)n[a].length=R(e);for(let a=0;a<t;a++){let s=R(e);s===0&&a>0?n[a].offset=n[a-1].offset+n[a-1].length:n[a].offset=s-1}return n}f(Ve,"deserializeIndex");var ce=class ce extends Error{};f(ce,"EtagMismatch");var B=ce;function ke(r,e){return m(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let i=t.data.slice(0,Ct),a=$e(i,t.etag),s=t.data.slice(a.rootDirectoryOffset,a.rootDirectoryOffset+a.rootDirectoryLength),u=`${r.getKey()}|${a.etag||""}|${a.rootDirectoryOffset}|${a.rootDirectoryLength}`,h=Ve(yield e(s,a.internalCompression));return[a,[u,h.length,h]]})}f(ke,"getHeaderAndRoot");function Ke(r,e,t,n,i){return m(this,null,function*(){let a=yield r.getBytes(t,n,void 0,i.etag),s=yield e(a.data,i.internalCompression),u=Ve(s);if(u.length===0)throw new Error("Empty directory is invalid");return u})}f(Ke,"getDirectory");var ve=class ve{constructor(e=100,t=!0,n=fe){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return m(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,n.data;let i=yield ke(e,this.decompress);return i[1]&&this.cache.set(i[1][0],{lastUsed:this.counter++,data:i[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:i[0]}),this.prune(),i[0]})}getDirectory(e,t,n,i){return m(this,null,function*(){let a=`${e.getKey()}|${i.etag||""}|${t}|${n}`,s=this.cache.get(a);if(s)return s.lastUsed=this.counter++,s.data;let u=yield Ke(e,this.decompress,t,n,i);return this.cache.set(a,{lastUsed:this.counter++,data:u}),this.prune(),u})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return m(this,null,function*(){this.cache.delete(e.getKey())})}};f(ve,"ResolvedValueCache");var ue=ve,ge=class ge{constructor(e=100,t=!0,n=fe){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return m(this,null,function*(){let t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;let i=new Promise((a,s)=>{ke(e,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),a(u[0]),this.prune()}).catch(u=>{s(u)})});return this.cache.set(t,{lastUsed:this.counter++,data:i}),i})}getDirectory(e,t,n,i){return m(this,null,function*(){let a=`${e.getKey()}|${i.etag||""}|${t}|${n}`,s=this.cache.get(a);if(s)return s.lastUsed=this.counter++,yield s.data;let u=new Promise((h,l)=>{Ke(e,this.decompress,t,n,i).then(c=>{h(c),this.prune()}).catch(c=>{l(c)})});return this.cache.set(a,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((n,i)=>{n.lastUsed<e&&(e=n.lastUsed,t=i)}),t&&this.cache.delete(t)}}invalidate(e){return m(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let n=new Promise((i,a)=>{this.getHeader(e).then(s=>{i(),this.invalidations.delete(t)}).catch(s=>{a(s)})});this.invalidations.set(t,n)})}};f(ge,"SharedPromiseCache");var G=ge,pe=class pe{constructor(e,t,n){typeof e=="string"?this.source=new K(e):this.source=e,n?this.decompress=n:this.decompress=fe,t?this.cache=t:this.cache=new G}getHeader(){return m(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,n,i){return m(this,null,function*(){let a=Ie(e,t,n),s=yield this.cache.getHeader(this.source);if(e<s.minZoom||e>s.maxZoom)return;let u=s.rootDirectoryOffset,h=s.rootDirectoryLength;for(let l=0;l<=3;l++){let c=yield this.cache.getDirectory(this.source,u,h,s),o=Fe(c,a);if(o){if(o.runLength>0){let v=yield this.source.getBytes(s.tileDataOffset+o.offset,o.length,i,s.etag);return{data:yield this.decompress(v.data,s.tileCompression),cacheControl:v.cacheControl,expires:v.expires}}u=s.leafDirectoryOffset+o.offset,h=o.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,n,i){return m(this,null,function*(){try{return yield this.getZxyAttempt(e,t,n,i)}catch(a){if(a instanceof B)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,i);throw a}})}getMetadataAttempt(){return m(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(n))})}getMetadata(){return m(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof B)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return m(this,null,function*(){let t=yield this.getHeader(),n=yield this.getMetadata(),i=Ze(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${i}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};f(pe,"PMTiles");var P=pe;return et(Dt);})();
//# sourceMappingURL=pmtiles.js.map</script>
<script>/**
 * mapbox-pmtiles v1.1.0 - Optimized Version with Lifecycle Management
 * Original source: https://github.com/am2222/mapbox-pmtiles by Majid Hojati
 * License: MIT
 *
 * This is an optimized version of the mapbox-pmtiles library that provides
 * better performance for large datasets through:
 * - Configurable resource management
 * - Instance-scoped worker pools and caches
 * - Proper lifecycle management and cleanup
 * - Reference counting for shared resources
 * - Enhanced error handling and timeouts
 * - Memory optimization with size-based LRU caches
 *
 * Last updated: 2025
 */

// Note: This version assumes mapboxgl and pmtiles are already loaded as globals
(function (global) {
  "use strict";

  // Helper functions
  var __pow = Math.pow;
  var __async = (__this, __arguments, generator) => {
    return new Promise((resolve, reject) => {
      var fulfilled = (value) => {
        try {
          step(generator.next(value));
        } catch (e) {
          reject(e);
        }
      };
      var rejected = (value) => {
        try {
          step(generator.throw(value));
        } catch (e) {
          reject(e);
        }
      };
      var step = (x2) =>
        x2.done
          ? resolve(x2.value)
          : Promise.resolve(x2.value).then(fulfilled, rejected);
      step((generator = generator.apply(__this, __arguments)).next());
    });
  };

  // Check dependencies
  if (typeof mapboxgl === "undefined") {
    console.error("mapbox-pmtiles: Mapbox GL JS is not loaded");
    return;
  }
  if (typeof pmtiles === "undefined") {
    console.error("mapbox-pmtiles: PMTiles library is not loaded");
    return;
  }

  const VectorTileSourceImpl = mapboxgl.Style.getSourceType("vector");
  const SOURCE_TYPE = "pmtile-source";

  // Global shared resources with reference counting
  const GLOBAL_SHARED_RESOURCES = {
    // Protocol cache - expensive to duplicate, shared with reference counting
    protocolCache: new Map(), // url -> { protocol, instance, refCount }

    // Metadata cache - small and shareable
    metadataCache: new Map(), // cacheKey -> data

    // Pre-calculated world sizes for common zoom levels (static, no cleanup needed)
    worldSizeCache: new Array(25).fill(null).map((_, z) => Math.pow(2, z)),

    // Global cleanup registry
    activeManagers: new Set(),

    // Debug/development features
    debug: false,
    performanceMetrics: new Map(),
  };

  /**
   * Default configuration options
   */
  const DEFAULT_OPTIONS = {
    workerPoolSize: 4,
    tileCacheSize: 1000,
    tileCacheMaxMemoryMB: 100,
    metadataCacheSize: 100,
    enableSharedProtocols: true,
    requestTimeoutMs: 30000,
    enableDebugLogging: false,
    enablePerformanceMetrics: false,
  };

  /**
   * LRU Cache implementation with size-based eviction
   */
  class LRUCache {
    constructor(maxSize, maxMemoryBytes = Infinity) {
      this.maxSize = maxSize;
      this.maxMemoryBytes = maxMemoryBytes;
      this.cache = new Map();
      this.currentMemoryBytes = 0;
    }

    get(key) {
      if (this.cache.has(key)) {
        // Move to end (most recently used)
        const value = this.cache.get(key);
        this.cache.delete(key);
        this.cache.set(key, value);
        return value.data;
      }
      return undefined;
    }

    set(key, data, estimatedSize = 0) {
      // Remove if exists
      if (this.cache.has(key)) {
        const existing = this.cache.get(key);
        this.currentMemoryBytes -= existing.size;
        this.cache.delete(key);
      }

      // Evict old entries if necessary
      while (
        this.cache.size >= this.maxSize ||
        this.currentMemoryBytes + estimatedSize > this.maxMemoryBytes
      ) {
        const firstKey = this.cache.keys().next().value;
        if (!firstKey) break;

        const firstValue = this.cache.get(firstKey);
        this.currentMemoryBytes -= firstValue.size;
        this.cache.delete(firstKey);
      }

      // Add new entry
      this.cache.set(key, { data, size: estimatedSize });
      this.currentMemoryBytes += estimatedSize;
    }

    has(key) {
      return this.cache.has(key);
    }

    delete(key) {
      if (this.cache.has(key)) {
        const value = this.cache.get(key);
        this.currentMemoryBytes -= value.size;
        this.cache.delete(key);
        return true;
      }
      return false;
    }

    clear() {
      this.cache.clear();
      this.currentMemoryBytes = 0;
    }

    get size() {
      return this.cache.size;
    }

    getMemoryUsage() {
      return {
        entries: this.cache.size,
        memoryBytes: this.currentMemoryBytes,
        memoryMB: this.currentMemoryBytes / (1024 * 1024),
      };
    }
  }

  /**
   * Resource Manager - handles per-instance resources and lifecycle
   */
  class PMTilesResourceManager {
    constructor(options = {}) {
      this.config = { ...DEFAULT_OPTIONS, ...options };
      this.destroyed = false;
      this.paused = false;
      this.dispatcher = null;

      // Instance-scoped resources
      this.workerPool = [];
      this.workerPoolIndex = 0;
      this.tileCache = new LRUCache(
        this.config.tileCacheSize,
        this.config.tileCacheMaxMemoryMB * 1024 * 1024,
      );
      this.pendingRequests = new Map();
      this.activeRequests = new Set();

      // Performance tracking
      this.metrics = {
        tilesLoaded: 0,
        cacheHits: 0,
        cacheMisses: 0,
        memoryPeakMB: 0,
        averageLoadTimeMs: 0,
      };

      // Register for global cleanup
      GLOBAL_SHARED_RESOURCES.activeManagers.add(this);

      if (this.config.enableDebugLogging) {
        console.log("[PMTiles] Resource manager created", this.config);
      }
    }

    /**
     * Initialize worker pool
     */
    initializeWorkerPool(dispatcher) {
      if (this.destroyed) return;

      // Store dispatcher reference
      if (dispatcher) {
        this.dispatcher = dispatcher;
      }

      if (this.workerPool.length === 0 && this.dispatcher) {
        for (let i = 0; i < this.config.workerPoolSize; i++) {
          try {
            this.workerPool.push(this.dispatcher.getActor());
          } catch (error) {
            console.warn("[PMTiles] Failed to create worker:", error);
          }
        }

        if (this.config.enableDebugLogging) {
          console.log(
            `[PMTiles] Initialized worker pool with ${this.workerPool.length} workers`,
          );
        }
      }
    }

    /**
     * Get next worker from pool (round-robin)
     */
    getWorkerFromPool() {
      if (this.destroyed) {
        return null;
      }

      // Try to initialize workers if not done yet
      if (this.workerPool.length === 0 && this.dispatcher) {
        this.initializeWorkerPool(this.dispatcher);
      }

      if (this.workerPool.length === 0) {
        if (this.config.enableDebugLogging) {
          console.warn(
            "[PMTiles] Worker pool is empty, dispatcher available:",
            !!this.dispatcher,
          );
        }
        return null;
      }

      const worker = this.workerPool[this.workerPoolIndex];
      this.workerPoolIndex =
        (this.workerPoolIndex + 1) % this.workerPool.length;
      return worker;
    }

    /**
     * Get or create protocol instance with reference counting
     */
    getProtocol(url) {
      if (this.destroyed) return null;

      if (!this.config.enableSharedProtocols) {
        // Create instance-specific protocol
        const protocol = new pmtiles.Protocol();
        const instance = new pmtiles.PMTiles(url);
        protocol.add(instance);
        return { protocol, instance };
      }

      // Use shared protocol with reference counting
      if (!GLOBAL_SHARED_RESOURCES.protocolCache.has(url)) {
        const protocol = new pmtiles.Protocol();
        const instance = new pmtiles.PMTiles(url);
        protocol.add(instance);
        GLOBAL_SHARED_RESOURCES.protocolCache.set(url, {
          protocol,
          instance,
          refCount: 0,
        });
      }

      const cached = GLOBAL_SHARED_RESOURCES.protocolCache.get(url);
      cached.refCount++;
      return cached;
    }

    /**
     * Release protocol reference
     */
    releaseProtocol(url) {
      if (!this.config.enableSharedProtocols) return;

      const cached = GLOBAL_SHARED_RESOURCES.protocolCache.get(url);
      if (cached) {
        cached.refCount--;
        if (cached.refCount <= 0) {
          GLOBAL_SHARED_RESOURCES.protocolCache.delete(url);

          if (this.config.enableDebugLogging) {
            console.log(`[PMTiles] Released protocol for ${url}`);
          }
        }
      }
    }

    /**
     * Cache key for tiles
     */
    getTileCacheKey(url, z, x, y) {
      return `${url}:${z}:${x}:${y}`;
    }

    /**
     * Add tile to cache with size estimation
     */
    addToTileCache(key, data) {
      if (this.destroyed) return;

      let estimatedSize = 0;
      if (data instanceof ImageBitmap) {
        // Rough estimation: width * height * 4 bytes per pixel
        estimatedSize = data.width * data.height * 4;
      } else if (data && data.byteLength) {
        estimatedSize = data.byteLength;
      } else {
        estimatedSize = 10000; // Default estimate
      }

      this.tileCache.set(key, data, estimatedSize);

      // Update peak memory usage
      const memoryUsage = this.tileCache.getMemoryUsage();
      this.metrics.memoryPeakMB = Math.max(
        this.metrics.memoryPeakMB,
        memoryUsage.memoryMB,
      );
    }

    /**
     * Get cached metadata
     */
    getCachedMetadata(cacheKey) {
      return GLOBAL_SHARED_RESOURCES.metadataCache.get(cacheKey);
    }

    /**
     * Set cached metadata
     */
    setCachedMetadata(cacheKey, data) {
      GLOBAL_SHARED_RESOURCES.metadataCache.set(cacheKey, data);
    }

    /**
     * Pause all operations
     */
    pause() {
      this.paused = true;

      // Cancel all pending requests
      for (const [key, request] of this.pendingRequests) {
        if (request.cancel) {
          request.cancel();
        }
      }
      this.pendingRequests.clear();

      if (this.config.enableDebugLogging) {
        console.log("[PMTiles] Resource manager paused");
      }
    }

    /**
     * Resume operations
     */
    resume() {
      this.paused = false;

      if (this.config.enableDebugLogging) {
        console.log("[PMTiles] Resource manager resumed");
      }
    }

    /**
     * Get performance metrics
     */
    getMetrics() {
      return {
        ...this.metrics,
        tileCache: this.tileCache.getMemoryUsage(),
        workerPoolSize: this.workerPool.length,
        pendingRequests: this.pendingRequests.size,
        isPaused: this.paused,
        isDestroyed: this.destroyed,
      };
    }

    /**
     * Destroy and cleanup all resources
     */
    destroy() {
      if (this.destroyed) return;

      this.destroyed = true;
      this.paused = true;

      // Cancel all pending requests
      for (const [key, request] of this.pendingRequests) {
        if (request.cancel) {
          request.cancel();
        }
      }
      this.pendingRequests.clear();

      // Clear caches
      this.tileCache.clear();

      // Clear worker pool references
      this.workerPool.length = 0;

      // Remove from global registry
      GLOBAL_SHARED_RESOURCES.activeManagers.delete(this);

      if (this.config.enableDebugLogging) {
        console.log("[PMTiles] Resource manager destroyed", this.getMetrics());
      }
    }
  }

  /**
   * Global cleanup function
   */
  const cleanup = () => {
    for (const manager of GLOBAL_SHARED_RESOURCES.activeManagers) {
      manager.destroy();
    }
    GLOBAL_SHARED_RESOURCES.protocolCache.clear();
    GLOBAL_SHARED_RESOURCES.metadataCache.clear();
  };

  // Register global cleanup
  if (typeof window !== "undefined") {
    window.addEventListener("beforeunload", cleanup);
  }

  const extend = (dest, ...sources) => {
    for (const src of sources) {
      for (const k in src) {
        dest[k] = src[k];
      }
    }
    return dest;
  };

  const mercatorXFromLng = (lng) => {
    return (180 + lng) / 360;
  };

  const mercatorYFromLat = (lat) => {
    return (
      (180 -
        (180 / Math.PI) *
          Math.log(Math.tan(Math.PI / 4 + (lat * Math.PI) / 360))) /
      360
    );
  };

  class TileBounds {
    constructor(bounds, minzoom, maxzoom) {
      this.bounds = mapboxgl.LngLatBounds.convert(this.validateBounds(bounds));
      this.minzoom = minzoom || 0;
      this.maxzoom = maxzoom || 24;

      // Pre-calculate mercator bounds
      this._mercatorBounds = {
        west: mercatorXFromLng(this.bounds.getWest()),
        north: mercatorYFromLat(this.bounds.getNorth()),
        east: mercatorXFromLng(this.bounds.getEast()),
        south: mercatorYFromLat(this.bounds.getSouth()),
      };
    }

    validateBounds(bounds) {
      if (!Array.isArray(bounds) || bounds.length !== 4)
        return [-180, -90, 180, 90];
      return [
        Math.max(-180, bounds[0]),
        Math.max(-90, bounds[1]),
        Math.min(180, bounds[2]),
        Math.min(90, bounds[3]),
      ];
    }

    contains(tileID) {
      // Use pre-calculated world size
      const worldSize =
        GLOBAL_SHARED_RESOURCES.worldSizeCache[tileID.z] ||
        Math.pow(2, tileID.z);

      // Use pre-calculated mercator bounds
      const level = {
        minX: Math.floor(this._mercatorBounds.west * worldSize),
        minY: Math.floor(this._mercatorBounds.north * worldSize),
        maxX: Math.ceil(this._mercatorBounds.east * worldSize),
        maxY: Math.ceil(this._mercatorBounds.south * worldSize),
      };

      const hit =
        tileID.x >= level.minX &&
        tileID.x < level.maxX &&
        tileID.y >= level.minY &&
        tileID.y < level.maxY;
      return hit;
    }
  }

  class Event {
    constructor(type, data = {}) {
      extend(this, data);
      this.type = type;
    }
  }

  class ErrorEvent extends Event {
    constructor(error, data = {}) {
      super("error", extend({ error }, data));
    }
  }

  /**
   * Enhanced PMTiles Source with lifecycle management
   */
  class PmTilesSource extends VectorTileSourceImpl {
    constructor(id, options, _dispatcher, _eventedParent) {
      super(...[id, options, _dispatcher, _eventedParent]);

      // Extract PMTiles-specific options
      const pmtilesOptions = {
        workerPoolSize: options.workerPoolSize,
        tileCacheSize: options.tileCacheSize,
        tileCacheMaxMemoryMB: options.tileCacheMaxMemoryMB,
        metadataCacheSize: options.metadataCacheSize,
        enableSharedProtocols: options.enableSharedProtocols,
        requestTimeoutMs: options.requestTimeoutMs,
        enableDebugLogging: options.enableDebugLogging,
        enablePerformanceMetrics: options.enablePerformanceMetrics,
      };

      // Initialize resource manager
      this.resourceManager = new PMTilesResourceManager(pmtilesOptions);

      // Standard source properties
      this.scheme = "xyz";
      this.roundZoom = true;
      this.type = "vector";
      this.dispatcher = _dispatcher;
      this.reparseOverscaled = true;
      this._loaded = false;
      this._dataType = "vector";
      this.id = id;
      this._implementation = options;

      // Initialize worker pool
      this.resourceManager.initializeWorkerPool(_dispatcher);

      if (!this._implementation) {
        this.fire(
          new ErrorEvent(
            new Error(`Missing options for ${this.id} ${SOURCE_TYPE} source`),
          ),
        );
        return;
      }

      const { url } = options;
      this.url = url;
      this.tileSize = 512;

      // Get protocol instance
      this.protocolInfo = this.resourceManager.getProtocol(url);
      if (!this.protocolInfo) {
        this.fire(
          new ErrorEvent(new Error(`Failed to create protocol for ${url}`)),
        );
        return;
      }

      this._protocol = this.protocolInfo.protocol;
      this._instance = this.protocolInfo.instance;
      this.tiles = [`pmtiles://${url}/{z}/{x}/{y}`];
    }

    static async getMetadata(url) {
      // Check cache first
      const cacheKey = `${url}:metadata`;
      const cached = GLOBAL_SHARED_RESOURCES.metadataCache.get(cacheKey);
      if (cached) {
        return cached;
      }

      const instance = new pmtiles.PMTiles(url);
      const metadata = await instance.getMetadata();
      GLOBAL_SHARED_RESOURCES.metadataCache.set(cacheKey, metadata);
      return metadata;
    }

    static async getHeader(url) {
      // Check cache first
      const cacheKey = `${url}:header`;
      const cached = GLOBAL_SHARED_RESOURCES.metadataCache.get(cacheKey);
      if (cached) {
        return cached;
      }

      const instance = new pmtiles.PMTiles(url);
      const header = await instance.getHeader();
      GLOBAL_SHARED_RESOURCES.metadataCache.set(cacheKey, header);
      return header;
    }

    getExtent() {
      if (!this.header)
        return [
          [-180, -90],
          [180, 90],
        ];
      const { minLon, minLat, maxLon, maxLat } = this.header;
      return [minLon, minLat, maxLon, maxLat];
    }

    hasTile(tileID) {
      return !this.tileBounds || this.tileBounds.contains(tileID.canonical);
    }

    fixTile(tile) {
      if (this.resourceManager.destroyed) return;

      if (!tile.destroy) {
        tile.destroy = () => {};
      }
      if (!tile.abort) {
        tile.abort = () => {
          tile.aborted = true;
          if (tile.request && tile.request.cancel) {
            tile.request.cancel();
          }
        };
      }
    }

    /**
     * Pause tile loading
     */
    pause() {
      this.resourceManager.pause();
    }

    /**
     * Resume tile loading
     */
    resume() {
      this.resourceManager.resume();
    }

    /**
     * Get performance metrics
     */
    getMetrics() {
      return this.resourceManager.getMetrics();
    }

    /**
     * Destroy source and cleanup resources
     */
    destroy() {
      if (this.protocolInfo && this.url) {
        this.resourceManager.releaseProtocol(this.url);
      }

      this.resourceManager.destroy();
      this._loaded = false;
    }

    async load(callback) {
      if (this.resourceManager.destroyed) {
        const error = new Error("Source has been destroyed");
        this.fire(new ErrorEvent(error));
        if (callback) callback(error);
        return;
      }

      this._loaded = false;
      this.fire(new Event("dataloading", { dataType: "source" }));

      // Check metadata cache first
      const headerKey = `${this.url}:header`;
      const metadataKey = `${this.url}:metadata`;

      let header, tileJSON;

      const cachedHeader = this.resourceManager.getCachedMetadata(headerKey);
      const cachedMetadata =
        this.resourceManager.getCachedMetadata(metadataKey);

      if (cachedHeader && cachedMetadata) {
        header = cachedHeader;
        tileJSON = cachedMetadata;
      } else {
        try {
          // Load and cache
          [header, tileJSON] = await Promise.all([
            this._instance.getHeader(),
            this._instance.getMetadata(),
          ]);
          this.resourceManager.setCachedMetadata(headerKey, header);
          this.resourceManager.setCachedMetadata(metadataKey, tileJSON);
        } catch (error) {
          this.fire(new ErrorEvent(error));
          if (callback) callback(error);
          return;
        }
      }

      try {
        extend(this, tileJSON);
        this.header = header;
        const { tileType, minZoom, maxZoom, minLon, minLat, maxLon, maxLat } =
          header;
        const requiredVariables = [
          minZoom,
          maxZoom,
          minLon,
          minLat,
          maxLon,
          maxLat,
        ];

        if (
          !requiredVariables.includes(void 0) &&
          !requiredVariables.includes(null)
        ) {
          this.tileBounds = new TileBounds(
            [minLon, minLat, maxLon, maxLat],
            minZoom,
            maxZoom,
          );
          this.minzoom = minZoom;
          this.maxzoom = maxZoom;
        }

        if (this.maxzoom == void 0) {
          console.warn(
            "The maxzoom parameter is not defined in the source json. This can cause memory leak. So make sure to define maxzoom in the layer",
          );
        }

        this.minzoom = Number.parseInt(this.minzoom.toString()) || 0;
        this.maxzoom = Number.parseInt(this.maxzoom.toString()) || 0;
        this._loaded = true;
        this.tileType = tileType;

        switch (tileType) {
          case pmtiles.TileType.Png:
            this.contentType = "image/png";
            break;
          case pmtiles.TileType.Jpeg:
            this.contentType = "image/jpeg";
            break;
          case pmtiles.TileType.Webp:
            this.contentType = "image/webp";
            break;
          case pmtiles.TileType.Avif:
            this.contentType = "image/avif";
            break;
          case pmtiles.TileType.Mvt:
            this.contentType = "application/vnd.mapbox-vector-tile";
            break;
        }

        if (
          [pmtiles.TileType.Jpeg, pmtiles.TileType.Png].includes(this.tileType)
        ) {
          this.loadTile = this.loadRasterTile;
          this.type = "raster";
        } else if (this.tileType === pmtiles.TileType.Mvt) {
          this.loadTile = this.loadVectorTile;
          this.type = "vector";
        } else {
          this.fire(new ErrorEvent(new Error("Unsupported Tile Type")));
        }

        this.fire(
          new Event("data", { dataType: "source", sourceDataType: "metadata" }),
        );
        this.fire(
          new Event("data", { dataType: "source", sourceDataType: "content" }),
        );
      } catch (err2) {
        this.fire(new ErrorEvent(err2));
        if (callback) callback(err2);
      }
    }

    loaded() {
      return this._loaded && !this.resourceManager.destroyed;
    }

    loadVectorTile(tile, callback) {
      if (this.resourceManager.destroyed || this.resourceManager.paused) {
        return callback(null);
      }

      const startTime = Date.now();
      var _a2, _b2, _c;

      const done = (err2, data) => {
        var _a3, _b3;
        delete tile.request;

        // Update metrics
        this.resourceManager.metrics.tilesLoaded++;
        const loadTime = Date.now() - startTime;
        this.resourceManager.metrics.averageLoadTimeMs =
          (this.resourceManager.metrics.averageLoadTimeMs + loadTime) / 2;

        if (tile.aborted) return callback(null);

        // Handle abort errors gracefully
        if (err2 && err2.name === "AbortError") {
          return callback(null);
        }

        if (err2 && err2.status !== 404) {
          return callback(err2);
        }

        if (data && data.resourceTiming)
          tile.resourceTiming = data.resourceTiming;
        if (
          ((_a3 = this.map) == null ? void 0 : _a3._refreshExpiredTiles) &&
          data
        )
          tile.setExpiryData(data);
        tile.loadVectorData(
          data,
          (_b3 = this.map) == null ? void 0 : _b3.painter,
        );
        callback(null);

        if (tile.reloadCallback) {
          this.loadVectorTile(tile, tile.reloadCallback);
          tile.reloadCallback = null;
        }
      };

      const url =
        (_a2 = this.map) == null
          ? void 0
          : _a2._requestManager.normalizeTileURL(
              tile.tileID.canonical.url(this.tiles, this.scheme),
            );
      const request =
        (_b2 = this.map) == null
          ? void 0
          : _b2._requestManager.transformRequest(url, "Tile");

      const params = {
        request,
        data: {},
        uid: tile.uid,
        tileID: tile.tileID,
        tileZoom: tile.tileZoom,
        zoom: tile.tileID.overscaledZ,
        tileSize: this.tileSize * tile.tileID.overscaleFactor(),
        type: "vector",
        source: this.id,
        scope: this.scope,
        showCollisionBoxes:
          (_c = this.map) == null ? void 0 : _c.showCollisionBoxes,
        promoteId: this.promoteId,
        isSymbolTile: tile.isSymbolTile,
        extraShadowCaster: tile.isExtraShadowCaster,
      };

      const afterLoad = (error, data, cacheControl, expires) => {
        if (error || !data) {
          // Handle abort errors gracefully
          if (error && (error.name === "AbortError" || error.code === 20)) {
            return done.call(this, null);
          }
          done.call(this, error);
          return;
        }

        params.data = {
          cacheControl,
          expires,
          rawData: data,
        };

        if (this.map._refreshExpiredTiles)
          tile.setExpiryData({ cacheControl, expires });
        if (tile.actor)
          tile.actor.send("loadTile", params, done.bind(this), void 0, true);
      };

      this.fixTile(tile);
      if (!tile.actor || tile.state === "expired") {
        // Use shared worker pool
        tile.actor = this.resourceManager.getWorkerFromPool();

        // Fallback to dispatcher if worker pool failed
        if (!tile.actor && this.dispatcher) {
          try {
            tile.actor = this.dispatcher.getActor();
          } catch (error) {
            console.warn("[PMTiles] Failed to get fallback worker:", error);
            return callback(new Error("No workers available"));
          }
        }

        if (!tile.actor) {
          return callback(new Error("No workers available"));
        }

        // Create request with timeout
        const requestPromise = this._protocol.tile({ ...request }, afterLoad);

        // Add timeout if configured
        if (this.resourceManager.config.requestTimeoutMs > 0) {
          const timeoutId = setTimeout(() => {
            if (tile.request && tile.request.cancel) {
              tile.request.cancel();
            }
            done.call(this, new Error("Request timeout"));
          }, this.resourceManager.config.requestTimeoutMs);

          const originalCancel = requestPromise.cancel;
          requestPromise.cancel = () => {
            clearTimeout(timeoutId);
            if (originalCancel) originalCancel();
          };
        }

        tile.request = requestPromise;
      } else if (tile.state === "loading") {
        tile.reloadCallback = callback;
      } else {
        tile.request = this._protocol.tile({ ...tile, url }, afterLoad);
      }
    }

    loadRasterTileData(tile, data) {
      if (this.resourceManager.destroyed) return;
      tile.setTexture(data, this.map.painter);
    }

    loadRasterTile(tile, callback) {
      if (this.resourceManager.destroyed || this.resourceManager.paused) {
        return callback(null);
      }

      var _a2, _b2;

      // Check tile cache first
      const cacheKey = this.resourceManager.getTileCacheKey(
        this.url,
        tile.tileID.canonical.z,
        tile.tileID.canonical.x,
        tile.tileID.canonical.y,
      );

      if (this.resourceManager.tileCache.has(cacheKey)) {
        this.resourceManager.metrics.cacheHits++;
        const cachedData = this.resourceManager.tileCache.get(cacheKey);
        this.loadRasterTileData(tile, cachedData);
        tile.state = "loaded";
        return callback(null);
      }

      this.resourceManager.metrics.cacheMisses++;

      const done = ({ data, cacheControl, expires }) => {
        delete tile.request;
        if (tile.aborted) return callback(null);
        if (data === null || data === void 0) {
          const emptyImage = {
            width: this.tileSize,
            height: this.tileSize,
            data: null,
          };
          this.loadRasterTileData(tile, emptyImage);
          tile.state = "loaded";
          return callback(null);
        }

        if (data && data.resourceTiming)
          tile.resourceTiming = data.resourceTiming;
        if (this.map._refreshExpiredTiles)
          tile.setExpiryData({ cacheControl, expires });

        // Optimized raster tile loading - try direct ArrayBuffer first
        const arrayBuffer = data.buffer || data;
        window
          .createImageBitmap(arrayBuffer)
          .then((imageBitmap) => {
            // Cache the decoded image
            this.resourceManager.addToTileCache(cacheKey, imageBitmap);

            this.loadRasterTileData(tile, imageBitmap);
            tile.state = "loaded";
            callback(null);
          })
          .catch((error) => {
            // Fallback to blob method
            const blob = new window.Blob([new Uint8Array(data)], {
              type: this.contentType,
            });
            window
              .createImageBitmap(blob)
              .then((imageBitmap) => {
                this.resourceManager.addToTileCache(cacheKey, imageBitmap);
                this.loadRasterTileData(tile, imageBitmap);
                tile.state = "loaded";
                callback(null);
              })
              .catch((error) => {
                tile.state = "errored";
                return callback(
                  new Error(`Can't decode image for ${this.id}: ${error}`),
                );
              });
          });
      };

      const url =
        (_a2 = this.map) == null
          ? void 0
          : _a2._requestManager.normalizeTileURL(
              tile.tileID.canonical.url(this.tiles, this.scheme),
            );
      const request =
        (_b2 = this.map) == null
          ? void 0
          : _b2._requestManager.transformRequest(url, "Tile");

      this.fixTile(tile);
      const controller = new AbortController();

      // Add timeout if configured
      let timeoutId;
      if (this.resourceManager.config.requestTimeoutMs > 0) {
        timeoutId = setTimeout(() => {
          controller.abort();
        }, this.resourceManager.config.requestTimeoutMs);
      }

      tile.request = {
        cancel: () => {
          if (timeoutId) clearTimeout(timeoutId);
          controller.abort();
        },
      };

      this._protocol
        .tile(request, controller)
        .then(done.bind(this))
        .catch((error) => {
          if (timeoutId) clearTimeout(timeoutId);

          // Handle abort errors gracefully
          if (error.name === "AbortError" || error.code === 20) {
            delete tile.request;
            return callback(null);
          }
          tile.state = "errored";
          callback(error);
        });
    }
  }

  PmTilesSource.SOURCE_TYPE = SOURCE_TYPE;

  // Expose cleanup function
  PmTilesSource.cleanup = cleanup;

  // Export to global scope
  global.MapboxPmTilesSource = PmTilesSource;
  global.PMTILES_SOURCE_TYPE = SOURCE_TYPE;
  global.PMTilesResourceManager = PMTilesResourceManager;
})(typeof window !== "undefined" ? window : this);
</script>
<script>function evaluateExpression(expression, properties) {
  if (!Array.isArray(expression)) {
    return expression;
  }

  const operator = expression[0];

  switch (operator) {
    case "get":
      return properties[expression[1]];
    case "concat":
      return expression
        .slice(1)
        .map((item) => evaluateExpression(item, properties))
        .join("");
    case "to-string":
      return String(evaluateExpression(expression[1], properties));
    case "to-number":
      return Number(evaluateExpression(expression[1], properties));
    case "number-format":
      const value = evaluateExpression(expression[1], properties);
      const options = expression[2] || {};

      // Handle locale option
      const locale = options.locale || "en-US";

      // Build Intl.NumberFormat options
      const formatOptions = {};

      // Style options
      if (options.style) formatOptions.style = options.style; // 'decimal', 'currency', 'percent', 'unit'
      if (options.currency) formatOptions.currency = options.currency;
      if (options.unit) formatOptions.unit = options.unit;

      // Digit options
      if (options.hasOwnProperty("min-fraction-digits")) {
        formatOptions.minimumFractionDigits = options["min-fraction-digits"];
      }
      if (options.hasOwnProperty("max-fraction-digits")) {
        formatOptions.maximumFractionDigits = options["max-fraction-digits"];
      }
      if (options.hasOwnProperty("min-integer-digits")) {
        formatOptions.minimumIntegerDigits = options["min-integer-digits"];
      }

      // Notation options
      if (options.notation) formatOptions.notation = options.notation; // 'standard', 'scientific', 'engineering', 'compact'
      if (options.compactDisplay)
        formatOptions.compactDisplay = options.compactDisplay; // 'short', 'long'

      // Grouping
      if (options.hasOwnProperty("useGrouping")) {
        formatOptions.useGrouping = options.useGrouping;
      }

      return new Intl.NumberFormat(locale, formatOptions).format(value);
    default:
      // For literals and other simple values
      return expression;
  }
}

function onMouseMoveTooltip(e, map, tooltipPopup, tooltipProperty) {
  map.getCanvas().style.cursor = "pointer";
  if (e.features.length > 0) {
    // Clear any existing active tooltip first to prevent stacking
    if (window._activeTooltip && window._activeTooltip !== tooltipPopup) {
      window._activeTooltip.remove();
    }

    let description;

    // Check if tooltipProperty is an expression (array) or a simple property name (string)
    if (Array.isArray(tooltipProperty)) {
      // It's an expression, evaluate it
      description = evaluateExpression(
        tooltipProperty,
        e.features[0].properties,
      );
    } else {
      // It's a property name, get the value
      description = e.features[0].properties[tooltipProperty];
    }

    tooltipPopup.setLngLat(e.lngLat).setHTML(description).addTo(map);

    // Store reference to currently active tooltip
    window._activeTooltip = tooltipPopup;
  } else {
    tooltipPopup.remove();
    // If this was the active tooltip, clear the reference
    if (window._activeTooltip === tooltipPopup) {
      delete window._activeTooltip;
    }
  }
}

function onMouseLeaveTooltip(map, tooltipPopup) {
  map.getCanvas().style.cursor = "";
  tooltipPopup.remove();
  if (window._activeTooltip === tooltipPopup) {
    delete window._activeTooltip;
  }
}

function onClickPopup(e, map, popupProperty, layerId) {
  let description;

  // Check if popupProperty is an expression (array) or a simple property name (string)
  if (Array.isArray(popupProperty)) {
    // It's an expression, evaluate it
    description = evaluateExpression(popupProperty, e.features[0].properties);
  } else {
    // It's a property name, get the value
    description = e.features[0].properties[popupProperty];
  }

  // Remove any existing popup for this layer
  if (window._mapboxPopups && window._mapboxPopups[layerId]) {
    window._mapboxPopups[layerId].remove();
  }

  // Create and show the popup
  const popup = new mapboxgl.Popup()
    .setLngLat(e.lngLat)
    .setHTML(description)
    .addTo(map);

  // Store reference to this popup
  if (!window._mapboxPopups) {
    window._mapboxPopups = {};
  }
  window._mapboxPopups[layerId] = popup;

  // Remove reference when popup is closed
  popup.on("close", function () {
    if (window._mapboxPopups[layerId] === popup) {
      delete window._mapboxPopups[layerId];
    }
  });
}

HTMLWidgets.widget({
  name: "mapboxgl_compare",

  type: "output",

  factory: function (el, width, height) {
    // Store maps and compare object to allow access during Shiny updates
    let beforeMap, afterMap, compareControl, draw;

    return {
      renderValue: function (x) {
        if (typeof mapboxgl === "undefined") {
          console.error("Mapbox GL JS is not loaded.");
          return;
        }
        if (typeof mapboxgl.Compare === "undefined") {
          console.error("Mapbox GL Compare plugin is not loaded.");
          return;
        }
        
        // Register PMTiles source type if available
        if (typeof MapboxPmTilesSource !== "undefined" && typeof pmtiles !== "undefined") {
          try {
            mapboxgl.Style.setSourceType(PMTILES_SOURCE_TYPE, MapboxPmTilesSource);
            console.log("PMTiles support enabled for Mapbox GL JS Compare");
          } catch (e) {
            console.warn("Failed to register PMTiles source type:", e);
          }
        }

        // Create container divs for the maps
        const beforeContainerId = `${el.id}-before`;
        const afterContainerId = `${el.id}-after`;

        // Different HTML structure based on mode
        if (x.mode === "sync") {
          // Side-by-side sync mode
          const containerStyle =
            x.orientation === "horizontal"
              ? `display: flex; flex-direction: column; width: 100%; height: 100%;`
              : `display: flex; flex-direction: row; width: 100%; height: 100%;`;

          const mapStyle =
            x.orientation === "horizontal"
              ? `width: 100%; height: 50%; position: relative;`
              : `width: 50%; height: 100%; position: relative;`;

          el.innerHTML = `
                      <div style="${containerStyle}">
                        <div id="${beforeContainerId}" class="map" style="${mapStyle}"></div>
                        <div id="${afterContainerId}" class="map" style="${mapStyle}"></div>
                      </div>
                    `;
        } else {
          // Default swipe mode
          el.innerHTML = `
                      <div id="${beforeContainerId}" class="map" style="width: 100%; height: 100%; position: absolute;"></div>
                      <div id="${afterContainerId}" class="map" style="width: 100%; height: 100%; position: absolute;"></div>
                    `;
        }

        beforeMap = new mapboxgl.Map({
          container: beforeContainerId,
          style: x.map1.style,
          center: x.map1.center,
          zoom: x.map1.zoom,
          bearing: x.map1.bearing,
          pitch: x.map1.pitch,
          projection: x.map1.projection,
          accessToken: x.map1.access_token,
          ...x.map1.additional_params,
        });

        afterMap = new mapboxgl.Map({
          container: afterContainerId,
          style: x.map2.style,
          center: x.map2.center,
          zoom: x.map2.zoom,
          bearing: x.map2.bearing,
          pitch: x.map2.pitch,
          projection: x.map2.projection,
          accessToken: x.map2.access_token,
          ...x.map2.additional_params,
        });

        // Set the global access token
        mapboxgl.accessToken = x.map1.access_token;

        if (x.mode === "swipe") {
          // Only create the swiper in swipe mode
          compareControl = new mapboxgl.Compare(
            beforeMap,
            afterMap,
            `#${el.id}`,
            {
              mousemove: x.mousemove,
              orientation: x.orientation,
            },
          );

          // Apply custom swiper color if provided
          if (x.swiper_color) {
            const swiperSelector =
              x.orientation === "vertical"
                ? ".mapboxgl-compare .compare-swiper-vertical"
                : ".mapboxgl-compare .compare-swiper-horizontal";

            const styleEl = document.createElement("style");
            styleEl.innerHTML = `${swiperSelector} { background-color: ${x.swiper_color}; }`;
            document.head.appendChild(styleEl);
          }
        } else {
          // For sync mode, we directly leverage the sync-move module's approach

          // Function to synchronize maps as seen in the mapbox-gl-sync-move module
          const syncMaps = () => {
            // Array of maps to sync
            const maps = [beforeMap, afterMap];
            // Array of move event handlers
            const moveHandlers = [];

            // Setup the sync between maps
            maps.forEach((map, index) => {
              // Create a handler for each map that syncs all other maps
              moveHandlers[index] = (e) => {
                // Disable all move events temporarily
                maps.forEach((m, i) => {
                  m.off("move", moveHandlers[i]);
                });

                // Get the state from the map that triggered the event
                const center = map.getCenter();
                const zoom = map.getZoom();
                const bearing = map.getBearing();
                const pitch = map.getPitch();

                // Apply this state to all other maps
                maps
                  .filter((m, i) => i !== index)
                  .forEach((m) => {
                    m.jumpTo({
                      center: center,
                      zoom: zoom,
                      bearing: bearing,
                      pitch: pitch,
                    });
                  });

                // Re-enable move events
                maps.forEach((m, i) => {
                  m.on("move", moveHandlers[i]);
                });
              };

              // Add the move handler to each map
              map.on("move", moveHandlers[index]);
            });
          };

          // Initialize the sync
          syncMaps();
        }

        // Ensure both maps resize correctly
        beforeMap.on("load", function () {
          beforeMap.resize();
          applyMapModifications(beforeMap, x.map1);

          // Setup Shiny event handlers for the before map
          if (HTMLWidgets.shinyMode) {
            setupShinyEvents(beforeMap, el.id, "before");
          }
        });

        afterMap.on("load", function () {
          afterMap.resize();
          applyMapModifications(afterMap, x.map2);

          // Setup Shiny event handlers for the after map
          if (HTMLWidgets.shinyMode) {
            setupShinyEvents(afterMap, el.id, "after");
          }
          
          // Add compare-level legends after both maps are loaded
          if (x.compare_legends && Array.isArray(x.compare_legends)) {
            x.compare_legends.forEach(function(legendInfo) {
              // Add CSS
              const legendCss = document.createElement("style");
              legendCss.innerHTML = legendInfo.css;
              legendCss.setAttribute("data-mapgl-legend-css", el.id);
              document.head.appendChild(legendCss);
              
              // Create legend element
              const legend = document.createElement("div");
              legend.innerHTML = legendInfo.html;
              legend.classList.add("mapboxgl-legend");
              
              // Append to the appropriate container based on target
              if (legendInfo.target === "compare") {
                // Append to the main compare container
                el.appendChild(legend);
              } else if (legendInfo.target === "before") {
                // Append to the before map container
                beforeMap.getContainer().appendChild(legend);
              } else if (legendInfo.target === "after") {
                // Append to the after map container
                afterMap.getContainer().appendChild(legend);
              }
            });
          }
        });

        // Handle Shiny messages
        if (HTMLWidgets.shinyMode) {
          Shiny.addCustomMessageHandler(
            "mapboxgl-compare-proxy",
            function (data) {
              if (data.id !== el.id) return;

              // Get the message and determine which map to target
              var message = data.message;
              var map = message.map === "before" ? beforeMap : afterMap;

              if (!map) return;

              // Initialize layer state tracking if not already present
              if (!window._mapglLayerState) {
                window._mapglLayerState = {};
              }
              const mapId = map.getContainer().id;
              if (!window._mapglLayerState[mapId]) {
                window._mapglLayerState[mapId] = {
                  filters: {}, // layerId -> filter expression
                  paintProperties: {}, // layerId -> {propertyName -> value}
                  layoutProperties: {}, // layerId -> {propertyName -> value}
                  tooltips: {}, // layerId -> tooltip property
                  popups: {}, // layerId -> popup property
                  legends: {}, // legendId -> {html: string, css: string}
                };
              }
              const layerState = window._mapglLayerState[mapId];

              // Process the message based on type
              if (message.type === "set_filter") {
                map.setFilter(message.layer, message.filter);
                // Track filter state for layer restoration
                layerState.filters[message.layer] = message.filter;
              } else if (message.type === "add_source") {
                if (message.source.type === "vector") {
                  const sourceConfig = {
                    type: "vector",
                    url: message.source.url,
                  };
                  // Add promoteId if provided
                  if (message.source.promoteId) {
                    sourceConfig.promoteId = message.source.promoteId;
                  }
                  // Add any other properties from the source object
                  Object.keys(message.source).forEach(function (key) {
                    if (
                      key !== "id" &&
                      key !== "type" &&
                      key !== "url" &&
                      key !== "promoteId"
                    ) {
                      sourceConfig[key] = message.source[key];
                    }
                  });
                  map.addSource(message.source.id, sourceConfig);
                } else if (message.source.type === "geojson") {
                  const sourceConfig = {
                    type: "geojson",
                    data: message.source.data,
                    generateId: message.source.generateId,
                  };
                  // Add any other properties from the source object
                  Object.keys(message.source).forEach(function (key) {
                    if (
                      key !== "id" &&
                      key !== "type" &&
                      key !== "data" &&
                      key !== "generateId"
                    ) {
                      sourceConfig[key] = message.source[key];
                    }
                  });
                  map.addSource(message.source.id, sourceConfig);
                } else if (message.source.type === "raster") {
                  const sourceConfig = {
                    type: "raster",
                    tileSize: message.source.tileSize,
                  };
                  if (message.source.url) {
                    sourceConfig.url = message.source.url;
                  } else if (message.source.tiles) {
                    sourceConfig.tiles = message.source.tiles;
                  }
                  if (message.source.maxzoom) {
                    sourceConfig.maxzoom = message.source.maxzoom;
                  }
                  // Add any other properties from the source object
                  Object.keys(message.source).forEach(function (key) {
                    if (
                      key !== "id" &&
                      key !== "type" &&
                      key !== "url" &&
                      key !== "tiles" &&
                      key !== "tileSize" &&
                      key !== "maxzoom"
                    ) {
                      sourceConfig[key] = message.source[key];
                    }
                  });
                  map.addSource(message.source.id, sourceConfig);
                } else if (message.source.type === "raster-dem") {
                  const sourceConfig = {
                    type: "raster-dem",
                    url: message.source.url,
                    tileSize: message.source.tileSize,
                  };
                  if (message.source.maxzoom) {
                    sourceConfig.maxzoom = message.source.maxzoom;
                  }
                  // Add any other properties from the source object
                  Object.keys(message.source).forEach(function (key) {
                    if (
                      key !== "id" &&
                      key !== "type" &&
                      key !== "url" &&
                      key !== "tileSize" &&
                      key !== "maxzoom"
                    ) {
                      sourceConfig[key] = message.source[key];
                    }
                  });
                  map.addSource(message.source.id, sourceConfig);
                } else if (message.source.type === "image") {
                  const sourceConfig = {
                    type: "image",
                    url: message.source.url,
                    coordinates: message.source.coordinates,
                  };
                  // Add any other properties from the source object
                  Object.keys(message.source).forEach(function (key) {
                    if (
                      key !== "id" &&
                      key !== "type" &&
                      key !== "url" &&
                      key !== "coordinates"
                    ) {
                      sourceConfig[key] = message.source[key];
                    }
                  });
                  map.addSource(message.source.id, sourceConfig);
                } else if (message.source.type === "video") {
                  const sourceConfig = {
                    type: "video",
                    urls: message.source.urls,
                    coordinates: message.source.coordinates,
                  };
                  // Add any other properties from the source object
                  Object.keys(message.source).forEach(function (key) {
                    if (
                      key !== "id" &&
                      key !== "type" &&
                      key !== "urls" &&
                      key !== "coordinates"
                    ) {
                      sourceConfig[key] = message.source[key];
                    }
                  });
                  map.addSource(message.source.id, sourceConfig);
                } else {
                  // Handle custom source types (like pmtile-source)
                  const sourceConfig = { type: message.source.type };
                  
                  // Copy all properties except id
                  Object.keys(message.source).forEach(function (key) {
                    if (key !== "id") {
                      sourceConfig[key] = message.source[key];
                    }
                  });
                  
                  map.addSource(message.source.id, sourceConfig);
                }
              } else if (message.type === "add_layer") {
                try {
                  if (message.layer.before_id) {
                    map.addLayer(message.layer, message.layer.before_id);
                  } else {
                    map.addLayer(message.layer);
                  }

                  // Add popups or tooltips if provided
                  if (message.layer.popup) {
                    // Initialize popup tracking if it doesn't exist
                    if (!window._mapboxPopups) {
                      window._mapboxPopups = {};
                    }

                    // Create click handler for this layer
                    const clickHandler = function (e) {
                      onClickPopup(
                        e,
                        map,
                        message.layer.popup,
                        message.layer.id,
                      );
                    };

                    // Store these handler references so we can remove them later if needed
                    if (!window._mapboxClickHandlers) {
                      window._mapboxClickHandlers = {};
                    }
                    window._mapboxClickHandlers[message.layer.id] =
                      clickHandler;

                    // Add the click handler
                    map.on("click", message.layer.id, clickHandler);

                    // Change cursor to pointer when hovering over the layer
                    map.on("mouseenter", message.layer.id, function () {
                      map.getCanvas().style.cursor = "pointer";
                    });

                    // Change cursor back to default when leaving the layer
                    map.on("mouseleave", message.layer.id, function () {
                      map.getCanvas().style.cursor = "";
                    });
                  }

                  if (message.layer.tooltip) {
                    const tooltip = new mapboxgl.Popup({
                      closeButton: false,
                      closeOnClick: false,
                    });

                    // Define named handler functions:
                    const mouseMoveHandler = function (e) {
                      onMouseMoveTooltip(
                        e,
                        map,
                        tooltip,
                        message.layer.tooltip,
                      );
                    };

                    const mouseLeaveHandler = function () {
                      onMouseLeaveTooltip(map, tooltip);
                    };

                    // Attach handlers by reference:
                    map.on("mousemove", message.layer.id, mouseMoveHandler);
                    map.on("mouseleave", message.layer.id, mouseLeaveHandler);

                    // Store these handler references for later removal:
                    if (!window._mapboxHandlers) {
                      window._mapboxHandlers = {};
                    }
                    window._mapboxHandlers[message.layer.id] = {
                      mousemove: mouseMoveHandler,
                      mouseleave: mouseLeaveHandler,
                    };
                  }

                  // Add hover effect if provided
                  if (message.layer.hover_options) {
                    const jsHoverOptions = {};
                    for (const [key, value] of Object.entries(
                      message.layer.hover_options,
                    )) {
                      const jsKey = key.replace(/_/g, "-");
                      jsHoverOptions[jsKey] = value;
                    }

                    let hoveredFeatureId = null;

                    map.on("mousemove", message.layer.id, function (e) {
                      if (e.features.length > 0) {
                        if (hoveredFeatureId !== null) {
                          const featureState = {
                            source:
                              typeof message.layer.source === "string"
                                ? message.layer.source
                                : message.layer.id,
                            id: hoveredFeatureId,
                          };
                          if (message.layer.source_layer) {
                            featureState.sourceLayer =
                              message.layer.source_layer;
                          }
                          map.setFeatureState(featureState, {
                            hover: false,
                          });
                        }
                        hoveredFeatureId = e.features[0].id;
                        const featureState = {
                          source:
                            typeof message.layer.source === "string"
                              ? message.layer.source
                              : message.layer.id,
                          id: hoveredFeatureId,
                        };
                        if (message.layer.source_layer) {
                          featureState.sourceLayer = message.layer.source_layer;
                        }
                        map.setFeatureState(featureState, {
                          hover: true,
                        });
                      }
                    });

                    map.on("mouseleave", message.layer.id, function () {
                      if (hoveredFeatureId !== null) {
                        const featureState = {
                          source:
                            typeof message.layer.source === "string"
                              ? message.layer.source
                              : message.layer.id,
                          id: hoveredFeatureId,
                        };
                        if (message.layer.source_layer) {
                          featureState.sourceLayer = message.layer.source_layer;
                        }
                        map.setFeatureState(featureState, {
                          hover: false,
                        });
                      }
                      hoveredFeatureId = null;
                    });

                    Object.keys(jsHoverOptions).forEach(function (key) {
                      const originalPaint =
                        map.getPaintProperty(message.layer.id, key) ||
                        message.layer.paint[key];
                      map.setPaintProperty(message.layer.id, key, [
                        "case",
                        ["boolean", ["feature-state", "hover"], false],
                        jsHoverOptions[key],
                        originalPaint,
                      ]);
                    });
                  }
                } catch (e) {
                  console.error(
                    "Failed to add layer via proxy: ",
                    message.layer,
                    e,
                  );
                }
              } else if (message.type === "remove_layer") {
                // If there's an active tooltip, remove it first
                if (window._activeTooltip) {
                  window._activeTooltip.remove();
                  delete window._activeTooltip;
                }

                // If there's an active popup for this layer, remove it
                if (
                  window._mapboxPopups &&
                  window._mapboxPopups[message.layer_id]
                ) {
                  window._mapboxPopups[message.layer_id].remove();
                  delete window._mapboxPopups[message.layer_id];
                }

                if (map.getLayer(message.layer_id)) {
                  // Remove tooltip handlers
                  if (
                    window._mapboxHandlers &&
                    window._mapboxHandlers[message.layer_id]
                  ) {
                    const handlers = window._mapboxHandlers[message.layer_id];
                    if (handlers.mousemove) {
                      map.off(
                        "mousemove",
                        message.layer_id,
                        handlers.mousemove,
                      );
                    }
                    if (handlers.mouseleave) {
                      map.off(
                        "mouseleave",
                        message.layer_id,
                        handlers.mouseleave,
                      );
                    }
                    // Clean up the reference
                    delete window._mapboxHandlers[message.layer_id];
                  }

                  // Remove click handlers for popups
                  if (
                    window._mapboxClickHandlers &&
                    window._mapboxClickHandlers[message.layer_id]
                  ) {
                    map.off(
                      "click",
                      message.layer_id,
                      window._mapboxClickHandlers[message.layer_id],
                    );
                    delete window._mapboxClickHandlers[message.layer_id];
                  }

                  // Remove the layer
                  map.removeLayer(message.layer_id);
                }
                if (map.getSource(message.layer_id)) {
                  map.removeSource(message.layer_id);
                }

                // Clean up tracked layer state
                const mapId = map.getContainer().id;
                if (window._mapglLayerState && window._mapglLayerState[mapId]) {
                  const layerState = window._mapglLayerState[mapId];
                  delete layerState.filters[message.layer_id];
                  delete layerState.paintProperties[message.layer_id];
                  delete layerState.layoutProperties[message.layer_id];
                  delete layerState.tooltips[message.layer_id];
                  delete layerState.popups[message.layer_id];
                  // Note: legends are not tied to specific layers, so we don't clear them here
                }
              } else if (message.type === "fit_bounds") {
                map.fitBounds(message.bounds, message.options);
              } else if (message.type === "fly_to") {
                map.flyTo(message.options);
              } else if (message.type === "ease_to") {
                map.easeTo(message.options);
              } else if (message.type === "set_center") {
                map.setCenter(message.center);
              } else if (message.type === "set_zoom") {
                map.setZoom(message.zoom);
              } else if (message.type === "jump_to") {
                map.jumpTo(message.options);
              } else if (message.type === "set_layout_property") {
                map.setLayoutProperty(
                  message.layer,
                  message.name,
                  message.value,
                );
                // Track layout property state for layer restoration
                if (!layerState.layoutProperties[message.layer]) {
                  layerState.layoutProperties[message.layer] = {};
                }
                layerState.layoutProperties[message.layer][message.name] =
                  message.value;
              } else if (message.type === "set_paint_property") {
                const layerId = message.layer;
                const propertyName = message.name;
                const newValue = message.value;

                // Check if the layer has hover options
                const layerStyle = map
                  .getStyle()
                  .layers.find((layer) => layer.id === layerId);
                const currentPaintProperty = map.getPaintProperty(
                  layerId,
                  propertyName,
                );

                if (
                  currentPaintProperty &&
                  Array.isArray(currentPaintProperty) &&
                  currentPaintProperty[0] === "case"
                ) {
                  // This property has hover options, so we need to preserve them
                  const hoverValue = currentPaintProperty[2];
                  const newPaintProperty = [
                    "case",
                    ["boolean", ["feature-state", "hover"], false],
                    hoverValue,
                    newValue,
                  ];
                  map.setPaintProperty(layerId, propertyName, newPaintProperty);
                } else {
                  // No hover options, just set the new value directly
                  map.setPaintProperty(layerId, propertyName, newValue);
                }
                // Track paint property state for layer restoration
                if (!layerState.paintProperties[layerId]) {
                  layerState.paintProperties[layerId] = {};
                }
                layerState.paintProperties[layerId][propertyName] = newValue;
              } else if (message.type === "add_legend") {
                if (!message.add) {
                  const existingLegends = document.querySelectorAll(
                    `#${data.id} .mapboxgl-legend`,
                  );
                  existingLegends.forEach((legend) => legend.remove());

                  // Clean up any existing legend styles that might have been added
                  const legendStyles = document.querySelectorAll(
                    `style[data-mapgl-legend-css="${data.id}"]`,
                  );
                  legendStyles.forEach((style) => style.remove());
                }

                const legendCss = document.createElement("style");
                legendCss.innerHTML = message.legend_css;
                legendCss.setAttribute("data-mapgl-legend-css", data.id); // Mark this style for later cleanup
                document.head.appendChild(legendCss);

                const legend = document.createElement("div");
                legend.innerHTML = message.html;
                legend.classList.add("mapboxgl-legend");
                
                // Append legend to the correct map container
                const targetContainer = map.getContainer();
                targetContainer.appendChild(legend);
              } else if (message.type === "set_config_property") {
                map.setConfigProperty(
                  message.importId,
                  message.configName,
                  message.value,
                );
              } else if (message.type === "set_style") {
                // Save the current view state
                const center = map.getCenter();
                const zoom = map.getZoom();
                const bearing = map.getBearing();
                const pitch = map.getPitch();

                // Apply the new style
                // Default preserve_layers to true if not specified
                const preserveLayers = message.preserve_layers !== false;

                // If we should preserve layers and sources
                if (preserveLayers) {
                  // Store the current style before changing it
                  const currentStyle = map.getStyle();
                  const userSourceIds = [];
                  const userLayers = [];

                  // Identify user-added sources (those not in the original style)
                  // We'll assume any source that's not "composite", "mapbox", or starts with "mapbox-" is user-added
                  for (const sourceId in currentStyle.sources) {
                    if (
                      sourceId !== "composite" &&
                      sourceId !== "mapbox" &&
                      !sourceId.startsWith("mapbox-")
                    ) {
                      userSourceIds.push(sourceId);
                      const source = currentStyle.sources[sourceId];
                      // Store layer-specific handler references
                      if (window._mapboxHandlers) {
                        const handlers = window._mapboxHandlers;
                        for (const layerId in handlers) {
                          // Find layers associated with this source
                          const layer = currentStyle.layers.find(
                            (l) => l.id === layerId,
                          );
                          if (layer && layer.source === sourceId) {
                            layer._handlers = handlers[layerId];
                          }
                        }
                      }
                    }
                  }

                  // Identify layers using user-added sources
                  currentStyle.layers.forEach(function (layer) {
                    if (userSourceIds.includes(layer.source)) {
                      userLayers.push(layer);
                    }
                  });

                  // Set up event listener to re-add sources and layers after style loads
                  const onStyleLoad = function () {
                    // Re-add user sources
                    userSourceIds.forEach(function (sourceId) {
                      if (!map.getSource(sourceId)) {
                        const source = currentStyle.sources[sourceId];
                        map.addSource(sourceId, source);
                      }
                    });

                    // Re-add user layers
                    userLayers.forEach(function (layer) {
                      if (!map.getLayer(layer.id)) {
                        map.addLayer(layer);

                        // Re-add event handlers for tooltips and hover effects
                        if (layer._handlers) {
                          const handlers = layer._handlers;

                          if (handlers.mousemove) {
                            map.on("mousemove", layer.id, handlers.mousemove);
                          }

                          if (handlers.mouseleave) {
                            map.on("mouseleave", layer.id, handlers.mouseleave);
                          }
                        }

                        // Recreate hover states if needed
                        if (layer.paint) {
                          for (const key in layer.paint) {
                            const value = layer.paint[key];
                            if (
                              Array.isArray(value) &&
                              value[0] === "case" &&
                              Array.isArray(value[1]) &&
                              value[1][0] === "boolean" &&
                              value[1][1][0] === "feature-state" &&
                              value[1][1][1] === "hover"
                            ) {
                              // This is a hover-enabled paint property
                              map.setPaintProperty(layer.id, key, value);
                            }
                          }
                        }
                      }
                    });

                    // Clear any active tooltips before restoration to prevent stacking
                    if (window._activeTooltip) {
                      window._activeTooltip.remove();
                      delete window._activeTooltip;
                    }

                    // Restore tracked layer modifications
                    const mapId = map.getContainer().id;
                    const savedLayerState =
                      window._mapglLayerState && window._mapglLayerState[mapId];
                    if (savedLayerState) {
                      // Restore filters
                      for (const layerId in savedLayerState.filters) {
                        if (map.getLayer(layerId)) {
                          map.setFilter(
                            layerId,
                            savedLayerState.filters[layerId],
                          );
                        }
                      }

                      // Restore paint properties
                      for (const layerId in savedLayerState.paintProperties) {
                        if (map.getLayer(layerId)) {
                          const properties =
                            savedLayerState.paintProperties[layerId];
                          for (const propertyName in properties) {
                            const savedValue = properties[propertyName];

                            // Check if layer has hover effects that need to be preserved
                            const currentValue = map.getPaintProperty(
                              layerId,
                              propertyName,
                            );
                            if (
                              currentValue &&
                              Array.isArray(currentValue) &&
                              currentValue[0] === "case"
                            ) {
                              // Preserve hover effects while updating base value
                              const hoverValue = currentValue[2];
                              const newPaintProperty = [
                                "case",
                                ["boolean", ["feature-state", "hover"], false],
                                hoverValue,
                                savedValue,
                              ];
                              map.setPaintProperty(
                                layerId,
                                propertyName,
                                newPaintProperty,
                              );
                            } else {
                              map.setPaintProperty(
                                layerId,
                                propertyName,
                                savedValue,
                              );
                            }
                          }
                        }
                      }

                      // Restore layout properties
                      for (const layerId in savedLayerState.layoutProperties) {
                        if (map.getLayer(layerId)) {
                          const properties =
                            savedLayerState.layoutProperties[layerId];
                          for (const propertyName in properties) {
                            map.setLayoutProperty(
                              layerId,
                              propertyName,
                              properties[propertyName],
                            );
                          }
                        }
                      }

                      // Restore tooltips
                      for (const layerId in savedLayerState.tooltips) {
                        if (map.getLayer(layerId)) {
                          const tooltipProperty =
                            savedLayerState.tooltips[layerId];

                          // Remove existing tooltip handlers first
                          map.off("mousemove", layerId);
                          map.off("mouseleave", layerId);

                          const tooltip = new mapboxgl.Popup({
                            closeButton: false,
                            closeOnClick: false,
                          });

                          map.on("mousemove", layerId, function (e) {
                            onMouseMoveTooltip(
                              e,
                              map,
                              tooltip,
                              tooltipProperty,
                            );
                          });

                          map.on("mouseleave", layerId, function () {
                            onMouseLeaveTooltip(map, tooltip);
                          });
                        }
                      }

                      // Restore popups
                      for (const layerId in savedLayerState.popups) {
                        if (map.getLayer(layerId)) {
                          const popupProperty = savedLayerState.popups[layerId];

                          // Remove existing popup handlers first
                          if (
                            window._mapboxClickHandlers &&
                            window._mapboxClickHandlers[layerId]
                          ) {
                            map.off(
                              "click",
                              layerId,
                              window._mapboxClickHandlers[layerId],
                            );
                            delete window._mapboxClickHandlers[layerId];
                          }

                          const clickHandler = function (e) {
                            onClickPopup(e, map, popupProperty, layerId);
                          };

                          map.on("click", layerId, clickHandler);

                          if (!window._mapboxClickHandlers) {
                            window._mapboxClickHandlers = {};
                          }
                          window._mapboxClickHandlers[layerId] = clickHandler;
                        }
                      }
                    }

                    // Remove this listener to avoid adding the same layers multiple times
                    map.off("style.load", onStyleLoad);
                  };

                  map.on("style.load", onStyleLoad);
                }

                // Change the style
                map.setStyle(message.style, {
                  config: message.config,
                  diff: message.diff,
                });

                // Restore the view state after the style has loaded
                map.once("style.load", function () {
                  map.jumpTo({
                    center: center,
                    zoom: zoom,
                    bearing: bearing,
                    pitch: pitch,
                  });

                  // Re-apply map modifications
                  if (map === beforeMap) {
                    applyMapModifications(map, x.map1);
                  } else {
                    applyMapModifications(map, x.map2);
                  }
                });
              } else if (message.type === "add_navigation_control") {
                const nav = new mapboxgl.NavigationControl({
                  showCompass: message.options.show_compass,
                  showZoom: message.options.show_zoom,
                  visualizePitch: message.options.visualize_pitch,
                });
                map.addControl(nav, message.position);

                if (message.orientation === "horizontal") {
                  const navBar = map
                    .getContainer()
                    .querySelector(
                      ".mapboxgl-ctrl.mapboxgl-ctrl-group:not(.mapbox-gl-draw_ctrl-draw-btn)",
                    );
                  if (navBar) {
                    navBar.style.display = "flex";
                    navBar.style.flexDirection = "row";
                  }
                }
              } else if (message.type === "add_reset_control") {
                const resetControl = document.createElement("button");
                resetControl.className =
                  "mapboxgl-ctrl-icon mapboxgl-ctrl-reset";
                resetControl.type = "button";
                resetControl.setAttribute("aria-label", "Reset");
                resetControl.innerHTML = "";
                resetControl.style.fontSize = "30px";
                resetControl.style.fontWeight = "bold";
                resetControl.style.backgroundColor = "white";
                resetControl.style.border = "none";
                resetControl.style.cursor = "pointer";
                resetControl.style.padding = "0";
                resetControl.style.width = "30px";
                resetControl.style.height = "30px";
                resetControl.style.display = "flex";
                resetControl.style.justifyContent = "center";
                resetControl.style.alignItems = "center";
                resetControl.style.transition = "background-color 0.2s";
                resetControl.addEventListener("mouseover", function () {
                  this.style.backgroundColor = "#f0f0f0";
                });
                resetControl.addEventListener("mouseout", function () {
                  this.style.backgroundColor = "white";
                });

                const resetContainer = document.createElement("div");
                resetContainer.className = "mapboxgl-ctrl mapboxgl-ctrl-group";
                resetContainer.appendChild(resetControl);

                const initialView = {
                  center: map.getCenter(),
                  zoom: map.getZoom(),
                  pitch: map.getPitch(),
                  bearing: map.getBearing(),
                  animate: message.animate,
                };

                if (message.duration) {
                  initialView.duration = message.duration;
                }

                resetControl.onclick = function () {
                  map.easeTo(initialView);
                };

                map.addControl(
                  {
                    onAdd: function () {
                      return resetContainer;
                    },
                    onRemove: function () {
                      resetContainer.parentNode.removeChild(resetContainer);
                    },
                  },
                  message.position,
                );
              } else if (message.type === "add_draw_control") {
                let drawOptions = message.options || {};

                // Generate styles if styling parameters provided
                if (message.styling) {
                  const generatedStyles = generateDrawStyles(message.styling);
                  if (generatedStyles) {
                    drawOptions.styles = generatedStyles;
                  }
                }

                if (message.freehand) {
                  drawOptions = Object.assign({}, drawOptions, {
                    modes: Object.assign({}, MapboxDraw.modes, {
                      draw_polygon: MapboxDraw.modes.draw_freehand,
                    }),
                    // defaultMode: 'draw_polygon' # Don't set the default yet
                  });
                }

                draw = new MapboxDraw(drawOptions);
                map.addControl(draw, message.position);
                map.controls.push(draw);

                // Add lasso icon CSS for freehand mode
                if (message.freehand) {
                  if (!document.querySelector("#mapgl-freehand-lasso-styles")) {
                    const style = document.createElement("style");
                    style.id = "mapgl-freehand-lasso-styles";
                    style.textContent = `
                      .mapbox-gl-draw_polygon {
                        background-image: url('data:image/svg+xml;utf8,%3Csvg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"%3E%3Cpath d="M 7 3 C 5 2.5, 3.5 3, 3 5 C 2.5 7, 3 8.5, 4 9.5 C 5 10.5, 5.5 11.5, 5 13 C 4.5 14.5, 5 15.5, 6.5 16 C 8 16.5, 9.5 16, 11 15 C 12.5 14, 13.5 13, 14.5 11.5 C 15.5 10, 16 8.5, 15.5 7 C 15 5.5, 14 4.5, 12.5 3.5 C 11 2.5, 9 2.5, 7 3 Z" fill="none" stroke="%23000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/%3E%3C/svg%3E') !important;
                      }
                    `;
                    document.head.appendChild(style);
                  }

                  // Update tooltip for freehand mode
                  setTimeout(() => {
                    const polygonButton = map.getContainer().querySelector('.mapbox-gl-draw_polygon');
                    if (polygonButton) {
                      polygonButton.title = 'Freehand polygon tool (p)';
                    }
                  }, 100);
                }

                // Add initial features if provided
                if (message.source) {
                  addSourceFeaturesToDraw(draw, message.source, map);
                }

                // Add event listeners
                map.on("draw.create", updateDrawnFeatures);
                map.on("draw.delete", updateDrawnFeatures);
                map.on("draw.update", updateDrawnFeatures);

                if (message.orientation === "horizontal") {
                  const drawBar = map
                    .getContainer()
                    .querySelector(".mapboxgl-ctrl-group");
                  if (drawBar) {
                    drawBar.style.display = "flex";
                    drawBar.style.flexDirection = "row";
                  }
                }

                // Add download button if requested
                if (message.download_button) {
                  // Add CSS for download button if not already added
                  if (!document.querySelector('#mapgl-draw-download-styles')) {
                    const style = document.createElement('style');
                    style.id = 'mapgl-draw-download-styles';
                    style.textContent = `
                      .mapbox-gl-draw_download {
                        background: transparent;
                        border: none;
                        cursor: pointer;
                        display: block;
                        height: 30px;
                        width: 30px;
                        padding: 0;
                        outline: none;
                      }
                      .mapbox-gl-draw_download:hover {
                        background-color: rgba(0, 0, 0, 0.05);
                      }
                      .mapbox-gl-draw_download svg {
                        width: 20px;
                        height: 20px;
                        margin: 5px;
                        fill: #333;
                      }
                    `;
                    document.head.appendChild(style);
                  }

                  // Small delay to ensure Draw control is fully rendered
                  setTimeout(() => {
                    // Find the Draw control button group
                    const drawButtons = map.getContainer().querySelector('.mapboxgl-ctrl-group:has(.mapbox-gl-draw_polygon)');
                    
                    if (drawButtons) {
                      // Create download button
                      const downloadBtn = document.createElement('button');
                      downloadBtn.className = 'mapbox-gl-draw_download';
                      downloadBtn.title = 'Download drawn features as GeoJSON';
                      
                      // Add SVG download icon
                      downloadBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                          <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                        </svg>
                      `;
                      
                      downloadBtn.addEventListener('click', () => {
                        // Get all drawn features
                        const data = draw.getAll();
                        
                        if (data.features.length === 0) {
                          alert('No features to download. Please draw something first!');
                          return;
                        }
                        
                        // Convert to string with nice formatting
                        const dataStr = JSON.stringify(data, null, 2);
                        
                        // Create blob and download
                        const blob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${message.download_filename || 'drawn-features'}.geojson`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                      });
                      
                      // Append to the Draw control button group
                      drawButtons.appendChild(downloadBtn);
                    }
                  }, 100);
                }
              } else if (message.type === "get_drawn_features") {
                if (draw) {
                  const features = draw ? draw.getAll() : null;
                  Shiny.setInputValue(
                    data.id + "_drawn_features",
                    JSON.stringify(features),
                  );
                } else {
                  Shiny.setInputValue(
                    data.id + "_drawn_features",
                    JSON.stringify(null),
                  );
                }
              } else if (message.type === "clear_drawn_features") {
                if (draw) {
                  draw.deleteAll();
                  // Update the drawn features
                  updateDrawnFeatures();
                }
              } else if (message.type === "add_features_to_draw") {
                if (draw) {
                  if (message.data.clear_existing) {
                    draw.deleteAll();
                  }
                  addSourceFeaturesToDraw(draw, message.data.source, map);
                  // Update the drawn features
                  updateDrawnFeatures();
                } else {
                  console.warn("Draw control not initialized");
                }
              } else if (message.type === "add_markers") {
                if (!window.mapboxglMarkers) {
                  window.mapboxglMarkers = [];
                }
                message.markers.forEach(function (marker) {
                  const markerOptions = {
                    color: marker.color,
                    rotation: marker.rotation,
                    draggable: marker.options.draggable || false,
                    ...marker.options,
                  };
                  const mapMarker = new mapboxgl.Marker(markerOptions)
                    .setLngLat([marker.lng, marker.lat])
                    .addTo(map);

                  if (marker.popup) {
                    mapMarker.setPopup(
                      new mapboxgl.Popup({
                        offset: 25,
                      }).setHTML(marker.popup),
                    );
                  }

                  const markerId = marker.id;
                  if (markerId) {
                    const lngLat = mapMarker.getLngLat();
                    Shiny.setInputValue(data.id + "_marker_" + markerId, {
                      id: markerId,
                      lng: lngLat.lng,
                      lat: lngLat.lat,
                    });

                    mapMarker.on("dragend", function () {
                      const lngLat = mapMarker.getLngLat();
                      Shiny.setInputValue(data.id + "_marker_" + markerId, {
                        id: markerId,
                        lng: lngLat.lng,
                        lat: lngLat.lat,
                      });
                    });
                  }

                  window.mapboxglMarkers.push(mapMarker);
                });
              } else if (message.type === "clear_markers") {
                if (window.mapboxglMarkers) {
                  window.mapboxglMarkers.forEach(function (marker) {
                    marker.remove();
                  });
                  window.mapboxglMarkers = [];
                }
              } else if (message.type === "add_fullscreen_control") {
                const position = message.position || "top-right";
                const fullscreen = new mapboxgl.FullscreenControl();
                map.addControl(fullscreen, position);
              } else if (message.type === "add_scale_control") {
                const scaleControl = new mapboxgl.ScaleControl({
                  maxWidth: message.options.maxWidth,
                  unit: message.options.unit,
                });
                map.addControl(scaleControl, message.options.position);
              } else if (message.type === "add_geolocate_control") {
                const geolocate = new mapboxgl.GeolocateControl({
                  positionOptions: message.options.positionOptions,
                  trackUserLocation: message.options.trackUserLocation,
                  showAccuracyCircle: message.options.showAccuracyCircle,
                  showUserLocation: message.options.showUserLocation,
                  showUserHeading: message.options.showUserHeading,
                  fitBoundsOptions: message.options.fitBoundsOptions,
                });
                map.addControl(geolocate, message.options.position);

                if (HTMLWidgets.shinyMode) {
                  geolocate.on("geolocate", function (event) {
                    Shiny.setInputValue(data.id + "_geolocate", {
                      coords: event.coords,
                      time: new Date(),
                    });
                  });

                  geolocate.on("trackuserlocationstart", function () {
                    Shiny.setInputValue(data.id + "_geolocate_tracking", {
                      status: "start",
                      time: new Date(),
                    });
                  });

                  geolocate.on("trackuserlocationend", function () {
                    Shiny.setInputValue(data.id + "_geolocate_tracking", {
                      status: "end",
                      time: new Date(),
                    });
                  });

                  geolocate.on("error", function (error) {
                    if (error.error.code === 1) {
                      Shiny.setInputValue(data.id + "_geolocate_error", {
                        message: "Location permission denied",
                        time: new Date(),
                      });
                    }
                  });
                }
              } else if (message.type === "add_geocoder_control") {
                const geocoderOptions = {
                  accessToken: mapboxgl.accessToken,
                  mapboxgl: mapboxgl,
                  ...message.options,
                };

                // Set default values if not provided
                if (!geocoderOptions.placeholder)
                  geocoderOptions.placeholder = "Search";
                if (typeof geocoderOptions.collapsed === "undefined")
                  geocoderOptions.collapsed = false;

                const geocoder = new MapboxGeocoder(geocoderOptions);

                map.addControl(geocoder, message.position || "top-right");
                map.controls.push(geocoder);

                // Handle geocoder results in Shiny mode
                geocoder.on("result", function (e) {
                  Shiny.setInputValue(data.id + "_geocoder", {
                    result: e.result,
                    time: new Date(),
                  });
                });
              } else if (message.type === "add_layers_control") {
                const layersControl = document.createElement("div");
                layersControl.id = message.control_id;

                // Handle use_icon parameter
                let className = message.collapsible
                  ? "layers-control collapsible"
                  : "layers-control";

                if (message.use_icon) {
                  className += " icon-only";
                }

                layersControl.className = className;
                layersControl.style.position = "absolute";

                // Set the position correctly
                const position = message.position || "top-left";
                if (position === "top-left") {
                  layersControl.style.top = (message.margin_top || 10) + "px";
                  layersControl.style.left = (message.margin_left || 10) + "px";
                } else if (position === "top-right") {
                  layersControl.style.top = (message.margin_top || 10) + "px";
                  layersControl.style.right = (message.margin_right || 10) + "px";
                } else if (position === "bottom-left") {
                  layersControl.style.bottom = (message.margin_bottom || 30) + "px";
                  layersControl.style.left = (message.margin_left || 10) + "px";
                } else if (position === "bottom-right") {
                  layersControl.style.bottom = (message.margin_bottom || 40) + "px";
                  layersControl.style.right = (message.margin_right || 10) + "px";
                }

                // Apply custom colors if provided
                if (message.custom_colors) {
                  const colors = message.custom_colors;

                  // Create a style element for custom colors
                  const styleEl = document.createElement("style");
                  let css = "";

                  if (colors.background) {
                    css += `.layers-control { background-color: ${colors.background} !important; }`;
                  }
                  if (colors.text) {
                    css += `.layers-control a { color: ${colors.text} !important; }`;
                  }
                  if (colors.activeBackground) {
                    css += `.layers-control a.active { background-color: ${colors.activeBackground} !important; }`;
                  }
                  if (colors.activeText) {
                    css += `.layers-control a.active { color: ${colors.activeText} !important; }`;
                  }
                  if (colors.hoverBackground) {
                    css += `.layers-control a:hover { background-color: ${colors.hoverBackground} !important; }`;
                  }
                  if (colors.hoverText) {
                    css += `.layers-control a:hover { color: ${colors.hoverText} !important; }`;
                  }
                  if (colors.toggleButtonBackground) {
                    css += `.layers-control .toggle-button { background-color: ${colors.toggleButtonBackground}
                  !important; }`;
                  }
                  if (colors.toggleButtonText) {
                    css += `.layers-control .toggle-button { color: ${colors.toggleButtonText} !important; }`;
                  }

                  styleEl.innerHTML = css;
                  document.head.appendChild(styleEl);
                }

                document.getElementById(data.id).appendChild(layersControl);

                const layersList = document.createElement("div");
                layersList.className = "layers-list";
                layersControl.appendChild(layersList);

                // Fetch layers to be included in the control
                let layers =
                  message.layers ||
                  map.getStyle().layers.map((layer) => layer.id);

                layers.forEach((layerId, index) => {
                  const link = document.createElement("a");
                  link.id = layerId;
                  link.href = "#";
                  link.textContent = layerId;
                  link.className = "active";

                  // Show or hide layer when the toggle is clicked
                  link.onclick = function (e) {
                    const clickedLayer = this.textContent;
                    e.preventDefault();
                    e.stopPropagation();

                    const visibility = map.getLayoutProperty(
                      clickedLayer,
                      "visibility",
                    );

                    // Toggle layer visibility by changing the layout object's visibility property
                    if (visibility === "visible") {
                      map.setLayoutProperty(clickedLayer, "visibility", "none");
                      this.className = "";
                    } else {
                      this.className = "active";
                      map.setLayoutProperty(
                        clickedLayer,
                        "visibility",
                        "visible",
                      );
                    }
                  };

                  layersList.appendChild(link);
                });

                // Handle collapsible behavior
                if (message.collapsible) {
                  const toggleButton = document.createElement("div");
                  toggleButton.className = "toggle-button";
                  toggleButton.textContent = "Layers";
                  toggleButton.onclick = function () {
                    layersControl.classList.toggle("open");
                  };
                  layersControl.insertBefore(toggleButton, layersList);
                }
              } else if (message.type === "add_globe_minimap") {
                // Add the globe minimap control
                const minimap = new MapboxGlobeMinimap({
                  center: map.getCenter(),
                  zoom: map.getZoom(),
                  bearing: map.getBearing(),
                  pitch: map.getPitch(),
                  globeSize: message.globe_size,
                  landColor: message.land_color,
                  waterColor: message.water_color,
                  markerColor: message.marker_color,
                  markerSize: message.marker_size,
                });

                map.addControl(minimap, message.position);
              } else if (message.type === "set_rain") {
                if (message.rain) {
                  map.setRain(message.rain);
                } else {
                  map.setRain(null);
                }
              } else if (message.type === "set_snow") {
                if (message.snow) {
                  map.setSnow(message.snow);
                } else {
                  map.setSnow(null);
                }
              } else if (message.type === "set_projection") {
                map.setProjection(message.projection);
              } else if (message.type === "set_source") {
                if (map.getLayer(message.layer)) {
                  const sourceId = map.getLayer(message.layer).source;
                  map.getSource(sourceId).setData(JSON.parse(message.source));
                }
              } else if (message.type === "set_tooltip") {
                // Track tooltip state
                layerState.tooltips[message.layer] = message.tooltip;

                if (map.getLayer(message.layer)) {
                  // Remove any existing tooltip handlers
                  map.off("mousemove", message.layer);
                  map.off("mouseleave", message.layer);

                  const tooltip = new mapboxgl.Popup({
                    closeButton: false,
                    closeOnClick: false,
                  });

                  map.on("mousemove", message.layer, function (e) {
                    map.getCanvas().style.cursor = "pointer";
                    if (e.features.length > 0) {
                      const description =
                        e.features[0].properties[message.tooltip];
                      tooltip
                        .setLngLat(e.lngLat)
                        .setHTML(description)
                        .addTo(map);
                    }
                  });

                  map.on("mouseleave", message.layer, function () {
                    map.getCanvas().style.cursor = "";
                    tooltip.remove();
                  });
                }
              } else if (message.type === "set_popup") {
                // Track popup state
                layerState.popups[message.layer] = message.popup;

                if (map.getLayer(message.layer)) {
                  // Remove any existing popup click handlers for this layer
                  if (
                    window._mapboxClickHandlers &&
                    window._mapboxClickHandlers[message.layer]
                  ) {
                    map.off(
                      "click",
                      message.layer,
                      window._mapboxClickHandlers[message.layer],
                    );
                    delete window._mapboxClickHandlers[message.layer];
                  }

                  // Remove any existing popup for this layer
                  if (
                    window._mapboxPopups &&
                    window._mapboxPopups[message.layer]
                  ) {
                    window._mapboxPopups[message.layer].remove();
                    delete window._mapboxPopups[message.layer];
                  }

                  // Create new click handler for popup
                  const clickHandler = function (e) {
                    onClickPopup(e, map, message.popup, message.layer);
                  };

                  // Store handler reference
                  if (!window._mapboxClickHandlers) {
                    window._mapboxClickHandlers = {};
                  }
                  window._mapboxClickHandlers[message.layer] = clickHandler;

                  // Add click handler
                  map.on("click", message.layer, clickHandler);

                  // Change cursor to pointer when hovering over the layer
                  map.on("mouseenter", message.layer, function () {
                    map.getCanvas().style.cursor = "pointer";
                  });

                  // Change cursor back to default when leaving the layer
                  map.on("mouseleave", message.layer, function () {
                    map.getCanvas().style.cursor = "";
                  });
                }
              } else if (message.type === "move_layer") {
                if (map.getLayer(message.layer)) {
                  if (message.before) {
                    map.moveLayer(message.layer, message.before);
                  } else {
                    map.moveLayer(message.layer);
                  }
                }
              } else if (message.type === "set_opacity") {
                // Set opacity for all fill layers
                const style = map.getStyle();
                if (style && style.layers) {
                  style.layers.forEach(function (layer) {
                    if (layer.type === "fill" && map.getLayer(layer.id)) {
                      map.setPaintProperty(
                        layer.id,
                        "fill-opacity",
                        message.opacity,
                      );
                    }
                  });
                }
              } else if (message.type === "query_rendered_features") {
                // Query rendered features
                let queryOptions = {};
                if (message.layers) {
                  // Ensure layers is always an array
                  queryOptions.layers = Array.isArray(message.layers)
                    ? message.layers
                    : [message.layers];
                }
                if (message.filter) queryOptions.filter = message.filter;

                let features;
                if (message.geometry) {
                  features = map.queryRenderedFeatures(message.geometry, queryOptions);
                } else {
                  // No geometry specified - query entire viewport
                  features = map.queryRenderedFeatures(queryOptions);
                }

                // Deduplicate features by id or by properties if no id
                const uniqueFeatures = new Map();
                features.forEach(function (feature) {
                  let key;
                  if (feature.id !== undefined && feature.id !== null) {
                    key = feature.id;
                  } else {
                    // Create a key from properties if no id available
                    key = JSON.stringify(feature.properties);
                  }

                  if (!uniqueFeatures.has(key)) {
                    uniqueFeatures.set(key, feature);
                  }
                });

                // Convert to GeoJSON FeatureCollection
                const deduplicatedFeatures = Array.from(uniqueFeatures.values());
                const featureCollection = {
                  type: "FeatureCollection",
                  features: deduplicatedFeatures,
                };

                Shiny.setInputValue(
                  data.id + "_queried_features",
                  JSON.stringify(featureCollection)
                );
              }
            },
          );
        }

        function setupShinyEvents(map, parentId, mapType) {
          // Set view state on move end
          map.on("moveend", function () {
            const center = map.getCenter();
            const zoom = map.getZoom();
            const bearing = map.getBearing();
            const pitch = map.getPitch();

            if (window.Shiny) {
              Shiny.setInputValue(parentId + "_" + mapType + "_view", {
                center: [center.lng, center.lat],
                zoom: zoom,
                bearing: bearing,
                pitch: pitch,
              });
            }
          });

          // Send clicked point coordinates to Shiny
          map.on("click", function (e) {
            if (window.Shiny) {
              Shiny.setInputValue(parentId + "_" + mapType + "_click", {
                lng: e.lngLat.lng,
                lat: e.lngLat.lat,
                time: Date.now(),
              });
            }
          });

          // Add hover events if enabled for this map
          const mapConfig = (mapType === "before") ? x.map1 : x.map2;
          if (mapConfig.hover_events && mapConfig.hover_events.enabled) {
            map.on("mousemove", function (e) {
              if (window.Shiny) {
                // Feature hover events
                if (mapConfig.hover_events.features) {
                  const options = mapConfig.hover_events.layer_id
                    ? { layers: Array.isArray(mapConfig.hover_events.layer_id) 
                        ? mapConfig.hover_events.layer_id 
                        : mapConfig.hover_events.layer_id.split(',').map(id => id.trim()) }
                    : undefined;
                  const features = map.queryRenderedFeatures(e.point, options);

                  if(features.length > 0) {
                    const feature = features[0];
                    Shiny.setInputValue(
                      parentId + "_" + mapType + "_feature_hover",
                      {
                        id: feature.id,
                        properties: feature.properties,
                        layer: feature.layer.id,
                        lng: e.lngLat.lng,
                        lat: e.lngLat.lat,
                        time: new Date(),
                      }
                    );
                  } else {
                    Shiny.setInputValue(
                      parentId + "_" + mapType + "_feature_hover",
                      null
                    );
                  }
                }

                // Coordinate hover events
                if (mapConfig.hover_events.coordinates) {
                  Shiny.setInputValue(
                    parentId + "_" + mapType + "_hover",
                    {
                      lng: e.lngLat.lng,
                      lat: e.lngLat.lat,
                      time: new Date(),
                    }
                  );
                }
              }
            });
          }
        }

        function applyMapModifications(map, mapData) {
          // Initialize controls array if it doesn't exist
          if (!map.controls) {
            map.controls = [];
          }
          // Note: tooltip handlers are already defined at the top of the file

          // Set config properties if provided
          if (mapData.config_properties) {
            mapData.config_properties.forEach(function (config) {
              map.setConfigProperty(
                config.importId,
                config.configName,
                config.value,
              );
            });
          }

          // Process H3J sources if provided
          if (mapData.h3j_sources) {
            mapData.h3j_sources.forEach(async function (source) {
              await map.addH3JSource(source.id, {
                data: source.url,
              });
            });
          }

          if (mapData.markers) {
            if (!window.mapboxglMarkers) {
              window.mapboxglMarkers = [];
            }
            mapData.markers.forEach(function (marker) {
              const markerOptions = {
                color: marker.color,
                rotation: marker.rotation,
                draggable: marker.options.draggable || false,
                ...marker.options,
              };
              const mapMarker = new mapboxgl.Marker(markerOptions)
                .setLngLat([marker.lng, marker.lat])
                .addTo(map);

              if (marker.popup) {
                mapMarker.setPopup(
                  new mapboxgl.Popup({ offset: 25 }).setText(marker.popup),
                );
              }

              const markerId = marker.id;
              if (markerId) {
                const lngLat = mapMarker.getLngLat();
                if (HTMLWidgets.shinyMode) {
                  Shiny.setInputValue(el.id + "_marker_" + markerId, {
                    id: markerId,
                    lng: lngLat.lng,
                    lat: lngLat.lat,
                  });
                }

                mapMarker.on("dragend", function () {
                  const lngLat = mapMarker.getLngLat();
                  if (HTMLWidgets.shinyMode) {
                    Shiny.setInputValue(el.id + "_marker_" + markerId, {
                      id: markerId,
                      lng: lngLat.lng,
                      lat: lngLat.lat,
                    });
                  }
                });
              }

              window.mapboxglMarkers.push(mapMarker);
            });
          }

          // Add sources if provided
          if (mapData.sources) {
            mapData.sources.forEach(function (source) {
              if (source.type === "vector") {
                const sourceConfig = {
                  type: "vector",
                  url: source.url,
                };
                if (source.promoteId) {
                  sourceConfig.promoteId = source.promoteId;
                }
                map.addSource(source.id, sourceConfig);
              } else if (source.type === "geojson") {
                const geojsonData = source.data;
                map.addSource(source.id, {
                  type: "geojson",
                  data: geojsonData,
                  generateId: true,
                });
              } else if (source.type === "raster") {
                if (source.url) {
                  map.addSource(source.id, {
                    type: "raster",
                    url: source.url,
                    tileSize: source.tileSize,
                    maxzoom: source.maxzoom,
                  });
                } else if (source.tiles) {
                  map.addSource(source.id, {
                    type: "raster",
                    tiles: source.tiles,
                    tileSize: source.tileSize,
                    maxzoom: source.maxzoom,
                  });
                }
              } else if (source.type === "raster-dem") {
                map.addSource(source.id, {
                  type: "raster-dem",
                  url: source.url,
                  tileSize: source.tileSize,
                  maxzoom: source.maxzoom,
                });
              } else if (source.type === "image") {
                map.addSource(source.id, {
                  type: "image",
                  url: source.url,
                  coordinates: source.coordinates,
                });
              } else if (source.type === "video") {
                map.addSource(source.id, {
                  type: "video",
                  urls: source.urls,
                  coordinates: source.coordinates,
                });
              }
            });
          }

          // Add layers if provided
          if (mapData.layers) {
            mapData.layers.forEach(function (layer) {
              try {
                const layerConfig = {
                  id: layer.id,
                  type: layer.type,
                  source: layer.source,
                  layout: layer.layout || {},
                  paint: layer.paint || {},
                };

                // Check if source is an object and set generateId if source type is 'geojson'
                if (
                  typeof layer.source === "object" &&
                  layer.source.type === "geojson"
                ) {
                  layerConfig.source.generateId = true;
                } else if (typeof layer.source === "string") {
                  // Handle string source if needed
                  layerConfig.source = layer.source;
                }

                if (layer.source_layer) {
                  layerConfig["source-layer"] = layer.source_layer;
                }

                if (layer.slot) {
                  layerConfig["slot"] = layer.slot;
                }

                if (layer.minzoom) {
                  layerConfig["minzoom"] = layer.minzoom;
                }
                if (layer.maxzoom) {
                  layerConfig["maxzoom"] = layer.maxzoom;
                }

                if (layer.before_id) {
                  map.addLayer(layerConfig, layer.before_id);
                } else {
                  map.addLayer(layerConfig);
                }

                // Add popups or tooltips if provided
                if (layer.popup) {
                  map.on("click", layer.id, function (e) {
                    const description = e.features[0].properties[layer.popup];

                    new mapboxgl.Popup()
                      .setLngLat(e.lngLat)
                      .setHTML(description)
                      .addTo(map);
                  });
                }

                if (layer.tooltip) {
                  const tooltip = new mapboxgl.Popup({
                    closeButton: false,
                    closeOnClick: false,
                  });

                  // Create a reference to the mousemove handler function
                  const mouseMoveHandler = function (e) {
                    onMouseMoveTooltip(e, map, tooltip, layer.tooltip);
                  };

                  // Create a reference to the mouseleave handler function
                  const mouseLeaveHandler = function () {
                    onMouseLeaveTooltip(map, tooltip);
                  };

                  // Attach the named handler references
                  map.on("mousemove", layer.id, mouseMoveHandler);
                  map.on("mouseleave", layer.id, mouseLeaveHandler);

                  // Store these handler references
                  if (!window._mapboxHandlers) {
                    window._mapboxHandlers = {};
                  }
                  window._mapboxHandlers[layer.id] = {
                    mousemove: mouseMoveHandler,
                    mouseleave: mouseLeaveHandler,
                  };
                }

                // Add hover effect if provided
                if (layer.hover_options) {
                  const jsHoverOptions = {};
                  for (const [key, value] of Object.entries(
                    layer.hover_options,
                  )) {
                    const jsKey = key.replace(/_/g, "-");
                    jsHoverOptions[jsKey] = value;
                  }

                  let hoveredFeatureId = null;

                  map.on("mousemove", layer.id, function (e) {
                    if (e.features.length > 0) {
                      if (hoveredFeatureId !== null) {
                        map.setFeatureState(
                          {
                            source:
                              typeof layer.source === "string"
                                ? layer.source
                                : layer.id,
                            id: hoveredFeatureId,
                          },
                          { hover: false },
                        );
                      }
                      hoveredFeatureId = e.features[0].id;
                      map.setFeatureState(
                        {
                          source:
                            typeof layer.source === "string"
                              ? layer.source
                              : layer.id,
                          id: hoveredFeatureId,
                        },
                        { hover: true },
                      );
                    }
                  });

                  map.on("mouseleave", layer.id, function () {
                    if (hoveredFeatureId !== null) {
                      map.setFeatureState(
                        {
                          source:
                            typeof layer.source === "string"
                              ? layer.source
                              : layer.id,
                          id: hoveredFeatureId,
                        },
                        { hover: false },
                      );
                    }
                    hoveredFeatureId = null;
                  });

                  Object.keys(jsHoverOptions).forEach(function (key) {
                    const originalPaint =
                      map.getPaintProperty(layer.id, key) || layer.paint[key];
                    map.setPaintProperty(layer.id, key, [
                      "case",
                      ["boolean", ["feature-state", "hover"], false],
                      jsHoverOptions[key],
                      originalPaint,
                    ]);
                  });
                }
              } catch (e) {
                console.error("Failed to add layer: ", layer, e);
              }
            });
          }

          // Set terrain if provided
          if (mapData.terrain) {
            map.setTerrain({
              source: mapData.terrain.source,
              exaggeration: mapData.terrain.exaggeration,
            });
          }

          // Set fog
          if (mapData.fog) {
            map.setFog(mapData.fog);
          }

          // Set rain effect if provided
          if (mapData.rain) {
            map.setRain(mapData.rain);
          }

          // Set snow effect if provided
          if (mapData.snow) {
            map.setSnow(mapData.snow);
          }

          if (mapData.fitBounds) {
            map.fitBounds(mapData.fitBounds.bounds, mapData.fitBounds.options);
          }
          if (mapData.flyTo) {
            map.flyTo(mapData.flyTo);
          }
          if (mapData.easeTo) {
            map.easeTo(mapData.easeTo);
          }
          if (mapData.setCenter) {
            map.setCenter(mapData.setCenter);
          }
          if (mapData.setZoom) {
            map.setZoom(mapData.setZoom);
          }
          if (mapData.jumpTo) {
            map.jumpTo(mapData.jumpTo);
          }

          // Add custom images if provided
          if (mapData.images && Array.isArray(mapData.images)) {
            mapData.images.forEach(async function (imageInfo) {
              try {
                const image = await map.loadImage(imageInfo.url);
                if (!map.hasImage(imageInfo.id)) {
                  map.addImage(imageInfo.id, image.data, imageInfo.options);
                }
              } catch (error) {
                console.error("Error loading image:", error);
              }
            });
          } else if (mapData.images) {
            console.error("mapData.images is not an array:", mapData.images);
          }

          // Remove existing legends only from this specific map container
          const mapContainer = map.getContainer();
          const existingLegends = mapContainer.querySelectorAll(".mapboxgl-legend");
          existingLegends.forEach((legend) => legend.remove());

          // Don't remove all legend styles globally - they might belong to other maps
          // Only remove styles when the entire widget is being recreated

          if (mapData.legend_html && mapData.legend_css) {
            const legendCss = document.createElement("style");
            legendCss.innerHTML = mapData.legend_css;
            legendCss.setAttribute("data-mapgl-legend-css", el.id); // Mark this style for later cleanup
            document.head.appendChild(legendCss);

            const legend = document.createElement("div");
            legend.innerHTML = mapData.legend_html;
            legend.classList.add("mapboxgl-legend");
            
            // Append legend to the correct map container instead of main container
            const mapContainer = map.getContainer();
            mapContainer.appendChild(legend);
          }

          // Add fullscreen control if enabled
          if (
            mapData.fullscreen_control &&
            mapData.fullscreen_control.enabled
          ) {
            const position = mapData.fullscreen_control.position || "top-right";
            map.addControl(new mapboxgl.FullscreenControl(), position);
          }

          // Add navigation control if enabled
          if (mapData.navigation_control) {
            const nav = new mapboxgl.NavigationControl({
              showCompass: mapData.navigation_control.show_compass,
              showZoom: mapData.navigation_control.show_zoom,
              visualizePitch: mapData.navigation_control.visualize_pitch,
            });
            map.addControl(nav, mapData.navigation_control.position);
          }

          // Add scale control if enabled
          if (mapData.scale_control) {
            const scaleControl = new mapboxgl.ScaleControl({
              maxWidth: mapData.scale_control.maxWidth,
              unit: mapData.scale_control.unit,
            });
            map.addControl(scaleControl, mapData.scale_control.position);
            map.controls.push(scaleControl);
          }

          // Add geolocate control if enabled
          if (mapData.geolocate_control) {
            const geolocate = new mapboxgl.GeolocateControl({
              positionOptions: mapData.geolocate_control.positionOptions,
              trackUserLocation: mapData.geolocate_control.trackUserLocation,
              showAccuracyCircle: mapData.geolocate_control.showAccuracyCircle,
              showUserLocation: mapData.geolocate_control.showUserLocation,
              showUserHeading: mapData.geolocate_control.showUserHeading,
              fitBoundsOptions: mapData.geolocate_control.fitBoundsOptions,
            });
            map.addControl(geolocate, mapData.geolocate_control.position);

            if (HTMLWidgets.shinyMode) {
              geolocate.on("geolocate", function (event) {
                Shiny.setInputValue(el.id + "_geolocate", {
                  coords: event.coords,
                  time: new Date(),
                });
              });

              geolocate.on("trackuserlocationstart", function () {
                Shiny.setInputValue(el.id + "_geolocate_tracking", {
                  status: "start",
                  time: new Date(),
                });
              });

              geolocate.on("trackuserlocationend", function () {
                Shiny.setInputValue(el.id + "_geolocate_tracking", {
                  status: "end",
                  time: new Date(),
                });
              });

              geolocate.on("error", function (error) {
                if (error.error.code === 1) {
                  Shiny.setInputValue(el.id + "_geolocate_error", {
                    message: "Location permission denied",
                    time: new Date(),
                  });
                }
              });
            }
          }

          // Helper function to generate draw styles based on parameters
          function generateDrawStyles(styling) {
            if (!styling) return null;

            return [
              // Point styles
              {
                id: "gl-draw-point-active",
                type: "circle",
                filter: [
                  "all",
                  ["==", "$type", "Point"],
                  ["==", "meta", "feature"],
                  ["==", "active", "true"],
                ],
                paint: {
                  "circle-radius": styling.vertex_radius + 2,
                  "circle-color": styling.active_color,
                },
              },
              {
                id: "gl-draw-point",
                type: "circle",
                filter: [
                  "all",
                  ["==", "$type", "Point"],
                  ["==", "meta", "feature"],
                  ["==", "active", "false"],
                ],
                paint: {
                  "circle-radius": styling.vertex_radius,
                  "circle-color": styling.point_color,
                },
              },
              // Line styles
              {
                id: "gl-draw-line",
                type: "line",
                filter: ["all", ["==", "$type", "LineString"]],
                layout: {
                  "line-cap": "round",
                  "line-join": "round",
                },
                paint: {
                  "line-color": [
                    "case",
                    ["==", ["get", "active"], "true"],
                    styling.active_color,
                    styling.line_color,
                  ],
                  "line-width": styling.line_width,
                },
              },
              // Polygon fill
              {
                id: "gl-draw-polygon-fill",
                type: "fill",
                filter: ["all", ["==", "$type", "Polygon"]],
                paint: {
                  "fill-color": [
                    "case",
                    ["==", ["get", "active"], "true"],
                    styling.active_color,
                    styling.fill_color,
                  ],
                  "fill-outline-color": [
                    "case",
                    ["==", ["get", "active"], "true"],
                    styling.active_color,
                    styling.fill_color,
                  ],
                  "fill-opacity": styling.fill_opacity,
                },
              },
              // Polygon outline
              {
                id: "gl-draw-polygon-stroke",
                type: "line",
                filter: ["all", ["==", "$type", "Polygon"]],
                layout: {
                  "line-cap": "round",
                  "line-join": "round",
                },
                paint: {
                  "line-color": [
                    "case",
                    ["==", ["get", "active"], "true"],
                    styling.active_color,
                    styling.line_color,
                  ],
                  "line-width": styling.line_width,
                },
              },
              // Midpoints
              {
                id: "gl-draw-polygon-midpoint",
                type: "circle",
                filter: [
                  "all",
                  ["==", "$type", "Point"],
                  ["==", "meta", "midpoint"],
                ],
                paint: {
                  "circle-radius": 3,
                  "circle-color": styling.active_color,
                },
              },
              // Vertex point halos
              {
                id: "gl-draw-vertex-halo-active",
                type: "circle",
                filter: [
                  "all",
                  ["==", "meta", "vertex"],
                  ["==", "$type", "Point"],
                ],
                paint: {
                  "circle-radius": [
                    "case",
                    ["==", ["get", "active"], "true"],
                    styling.vertex_radius + 4,
                    styling.vertex_radius + 2,
                  ],
                  "circle-color": "#FFF",
                },
              },
              // Vertex points
              {
                id: "gl-draw-vertex-active",
                type: "circle",
                filter: [
                  "all",
                  ["==", "meta", "vertex"],
                  ["==", "$type", "Point"],
                ],
                paint: {
                  "circle-radius": [
                    "case",
                    ["==", ["get", "active"], "true"],
                    styling.vertex_radius + 2,
                    styling.vertex_radius,
                  ],
                  "circle-color": styling.active_color,
                },
              },
            ];
          }

          // Helper function to add features from a source to draw
          function addSourceFeaturesToDraw(draw, sourceId, map) {
            const source = map.getSource(sourceId);
            if (source && source._data) {
              draw.add(source._data);
            } else {
              console.warn("Source not found or has no data:", sourceId);
            }
          }

          // Add geocoder control if enabled
          if (mapData.geocoder_control) {
            const geocoderOptions = {
              accessToken: mapboxgl.accessToken,
              mapboxgl: mapboxgl,
              ...mapData.geocoder_control,
            };

            // Set default values if not provided
            if (!geocoderOptions.placeholder)
              geocoderOptions.placeholder = "Search";
            if (typeof geocoderOptions.collapsed === "undefined")
              geocoderOptions.collapsed = false;

            const geocoder = new MapboxGeocoder(geocoderOptions);

            map.addControl(
              geocoder,
              mapData.geocoder_control.position || "top-right",
            );
            map.controls.push(geocoder);

            // Handle geocoder results in Shiny mode
            geocoder.on("result", function (e) {
              Shiny.setInputValue(data.id + "_geocoder", {
                result: e.result,
                time: new Date(),
              });
            });
          }

          // Add draw control if enabled
          if (mapData.draw_control) {
            if (mapData.draw_control && mapData.draw_control.enabled) {
              let drawOptions = mapData.draw_control.options || {};

              // Generate styles if styling parameters provided
              if (mapData.draw_control.styling) {
                const generatedStyles = generateDrawStyles(
                  mapData.draw_control.styling,
                );
                if (generatedStyles) {
                  drawOptions.styles = generatedStyles;
                }
              }

              if (mapData.draw_control.freehand) {
                drawOptions = Object.assign({}, drawOptions, {
                  modes: Object.assign({}, MapboxDraw.modes, {
                    draw_polygon: Object.assign(
                      {},
                      MapboxDraw.modes.draw_freehand,
                      {
                        // Store the simplify_freehand option on the map object
                        onSetup: function (opts) {
                          const state =
                            MapboxDraw.modes.draw_freehand.onSetup.call(
                              this,
                              opts,
                            );
                          this.map.simplify_freehand =
                            mapData.draw_control.simplify_freehand;
                          return state;
                        },
                      },
                    ),
                  }),
                  // defaultMode: 'draw_polygon' # Don't set the default yet
                });
              }

              draw = new MapboxDraw(drawOptions);
              map.addControl(draw, mapData.draw_control.position);
              map.controls.push(draw);

              // Add initial features if provided
              if (mapData.draw_control.source) {
                addSourceFeaturesToDraw(draw, mapData.draw_control.source, map);
              }

              // Process any queued features
              if (mapData.draw_features_queue) {
                mapData.draw_features_queue.forEach(function (data) {
                  if (data.clear_existing) {
                    draw.deleteAll();
                  }
                  addSourceFeaturesToDraw(draw, data.source, map);
                });
              }

              // Apply orientation styling
              if (mapData.draw_control.orientation === "horizontal") {
                const drawBar = map
                  .getContainer()
                  .querySelector(".mapboxgl-ctrl-group");
                if (drawBar) {
                  drawBar.style.display = "flex";
                  drawBar.style.flexDirection = "row";
                }
              }

              // Add download button if requested
              if (mapData.draw_control.download_button) {
                // Add CSS for download button if not already added
                if (!document.querySelector('#mapgl-draw-download-styles')) {
                  const style = document.createElement('style');
                  style.id = 'mapgl-draw-download-styles';
                  style.textContent = `
                    .mapbox-gl-draw_download {
                      background: transparent;
                      border: none;
                      cursor: pointer;
                      display: block;
                      height: 30px;
                      width: 30px;
                      padding: 0;
                      outline: none;
                    }
                    .mapbox-gl-draw_download:hover {
                      background-color: rgba(0, 0, 0, 0.05);
                    }
                    .mapbox-gl-draw_download svg {
                      width: 20px;
                      height: 20px;
                      margin: 5px;
                      fill: #333;
                    }
                  `;
                  document.head.appendChild(style);
                }

                // Small delay to ensure Draw control is fully rendered
                setTimeout(() => {
                  // Find the Draw control button group
                  const drawButtons = map.getContainer().querySelector('.mapboxgl-ctrl-group:has(.mapbox-gl-draw_polygon)');
                  
                  if (drawButtons) {
                    // Create download button
                    const downloadBtn = document.createElement('button');
                    downloadBtn.className = 'mapbox-gl-draw_download';
                    downloadBtn.title = 'Download drawn features as GeoJSON';
                    
                    // Add SVG download icon
                    downloadBtn.innerHTML = `
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                      </svg>
                    `;
                    
                    downloadBtn.addEventListener('click', () => {
                      // Get all drawn features
                      const data = draw.getAll();
                      
                      if (data.features.length === 0) {
                        alert('No features to download. Please draw something first!');
                        return;
                      }
                      
                      // Convert to string with nice formatting
                      const dataStr = JSON.stringify(data, null, 2);
                      
                      // Create blob and download
                      const blob = new Blob([dataStr], { type: 'application/json' });
                      const url = URL.createObjectURL(blob);
                      
                      const a = document.createElement('a');
                      a.href = url;
                      a.download = `${mapData.draw_control.download_filename}.geojson`;
                      document.body.appendChild(a);
                      a.click();
                      document.body.removeChild(a);
                      URL.revokeObjectURL(url);
                    });
                    
                    // Append to the Draw control button group
                    drawButtons.appendChild(downloadBtn);
                  }
                }, 100);
              }
            }

            // Helper function for updating drawn features
            function updateDrawnFeatures() {
              if (HTMLWidgets.shinyMode && draw) {
                const features = draw.getAll();
                Shiny.setInputValue(
                  el.id + "_drawn_features",
                  JSON.stringify(features),
                );
              }
            }

            // Add event listeners
            map.on("draw.create", updateDrawnFeatures);
            map.on("draw.delete", updateDrawnFeatures);
            map.on("draw.update", updateDrawnFeatures);
          }

          // Add reset control if enabled
          if (mapData.reset_control) {
            const resetControl = document.createElement("button");
            resetControl.className = "mapboxgl-ctrl-icon mapboxgl-ctrl-reset";
            resetControl.type = "button";
            resetControl.setAttribute("aria-label", "Reset");
            resetControl.innerHTML = "";
            resetControl.style.fontSize = "30px";
            resetControl.style.fontWeight = "bold";
            resetControl.style.backgroundColor = "white";
            resetControl.style.border = "none";
            resetControl.style.cursor = "pointer";
            resetControl.style.padding = "0";
            resetControl.style.width = "30px";
            resetControl.style.height = "30px";
            resetControl.style.display = "flex";
            resetControl.style.justifyContent = "center";
            resetControl.style.alignItems = "center";
            resetControl.style.transition = "background-color 0.2s";
            resetControl.addEventListener("mouseover", function () {
              this.style.backgroundColor = "#f0f0f0";
            });
            resetControl.addEventListener("mouseout", function () {
              this.style.backgroundColor = "white";
            });

            const resetContainer = document.createElement("div");
            resetContainer.className = "mapboxgl-ctrl mapboxgl-ctrl-group";
            resetContainer.appendChild(resetControl);

            const initialView = {
              center: map.getCenter(),
              zoom: map.getZoom(),
              pitch: map.getPitch(),
              bearing: map.getBearing(),
              animate: mapData.reset_control.animate,
            };

            if (mapData.reset_control.duration) {
              initialView.duration = mapData.reset_control.duration;
            }

            resetControl.onclick = function () {
              map.easeTo(initialView);
            };

            map.addControl(
              {
                onAdd: function () {
                  return resetContainer;
                },
                onRemove: function () {
                  resetContainer.parentNode.removeChild(resetContainer);
                },
              },
              mapData.reset_control.position,
            );
          }

          // Add the layers control if provided
          if (mapData.layers_control) {
            const layersControl = document.createElement("div");
            layersControl.id = mapData.layers_control.control_id;

            // Handle use_icon parameter
            let className = mapData.layers_control.collapsible
              ? "layers-control collapsible"
              : "layers-control";

            layersControl.className = className;
            layersControl.style.position = "absolute";

            // Set the position correctly - fix position bug by using correct CSS positioning
            const position = mapData.layers_control.position || "top-left";
            if (position === "top-left") {
              layersControl.style.top = (mapData.layers_control.margin_top || 10) + "px";
              layersControl.style.left = (mapData.layers_control.margin_left || 10) + "px";
            } else if (position === "top-right") {
              layersControl.style.top = (mapData.layers_control.margin_top || 10) + "px";
              layersControl.style.right = (mapData.layers_control.margin_right || 10) + "px";
            } else if (position === "bottom-left") {
              layersControl.style.bottom = (mapData.layers_control.margin_bottom || 30) + "px";
              layersControl.style.left = (mapData.layers_control.margin_left || 10) + "px";
            } else if (position === "bottom-right") {
              layersControl.style.bottom = (mapData.layers_control.margin_bottom || 40) + "px";
              layersControl.style.right = (mapData.layers_control.margin_right || 10) + "px";
            }

            el.appendChild(layersControl);

            const layersList = document.createElement("div");
            layersList.className = "layers-list";
            layersControl.appendChild(layersList);

            // Fetch layers to be included in the control
            let layers =
              mapData.layers_control.layers ||
              map.getStyle().layers.map((layer) => layer.id);

            layers.forEach((layerId, index) => {
              const link = document.createElement("a");
              link.id = layerId;
              link.href = "#";
              link.textContent = layerId;
              link.className = "active";

              // Show or hide layer when the toggle is clicked
              link.onclick = function (e) {
                const clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();

                const visibility = map.getLayoutProperty(
                  clickedLayer,
                  "visibility",
                );

                // Toggle layer visibility by changing the layout object's visibility property
                if (visibility === "visible") {
                  map.setLayoutProperty(clickedLayer, "visibility", "none");
                  this.className = "";
                } else {
                  this.className = "active";
                  map.setLayoutProperty(clickedLayer, "visibility", "visible");
                }
              };

              layersList.appendChild(link);
            });

            // Handle collapsible behavior
            if (mapData.layers_control.collapsible) {
              const toggleButton = document.createElement("div");
              toggleButton.className = "toggle-button";

              if (mapData.layers_control.use_icon) {
                // Add icon-only class to the control for compact styling
                layersControl.classList.add("icon-only");

                // More GIS-like layers stack icon
                toggleButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                                    <polyline points="2 17 12 22 22 17"></polyline>
                                    <polyline points="2 12 12 17 22 12"></polyline>
                                </svg>`;
                toggleButton.style.display = "flex";
                toggleButton.style.alignItems = "center";
                toggleButton.style.justifyContent = "center";
              } else {
                toggleButton.textContent = "Layers";
              }

              toggleButton.onclick = function () {
                layersControl.classList.toggle("open");
              };
              layersControl.insertBefore(toggleButton, layersList);
            }
          }
        }
      },

      resize: function (width, height) {
        // Code to handle resizing if necessary
      },
    };
  },
});
</script>
<style type="text/css">.layers-control {
background: #fff;
position: absolute;
z-index: 1;
border-radius: 4px;
width: 120px;
border: 1px solid rgba(0, 0, 0, 0.15);
font-family: "Open Sans", sans-serif;
margin: 0px;
box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
overflow: hidden;
transition: all 0.2s ease-in-out;
}
.layers-control a {
font-size: 13px;
color: #404040;
display: block;
margin: 0;
padding: 10px;
text-decoration: none;
border-bottom: 1px solid rgba(0, 0, 0, 0.1);
text-align: center;
transition: all 0.15s ease-in-out;
font-weight: normal;
}
.layers-control a:last-child {
border: none;
}
.layers-control a:hover {
background-color: #f8f8f8;
color: #1a1a1a;
}
.layers-control a.active {
background-color: #4a90e2;
color: #ffffff;
font-weight: 500;
}
.layers-control a.active:hover {
background: #3b7ed2;
}
.layers-control .toggle-button {
display: none;
background: #4a90e2;
color: #ffffff;
text-align: center;
cursor: pointer;
padding: 8px 0;
border-radius: 4px 4px 0 0;
font-weight: 500;
letter-spacing: 0.3px;
box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05) inset;
transition: all 0.15s ease-in-out;
}
.layers-control .toggle-button:hover {
background: #3b7ed2;
}
.layers-control .layers-list {
display: block;
}
.layers-control.collapsible .toggle-button {
display: block;
border-bottom: 1px solid rgba(0, 0, 0, 0.25);
}
.layers-control.collapsible .layers-list {
display: none;
opacity: 0;
max-height: 0;
transition:
opacity 0.25s ease,
max-height 0.25s ease;
}
.layers-control.collapsible.open .layers-list {
display: block;
opacity: 1;
max-height: 500px; 
}

.layers-control.collapsible.icon-only {
width: auto;
min-width: 36px;
border-radius: 4px;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
transform: translateZ(
0
); 
}
.layers-control.collapsible.icon-only .toggle-button {
border-radius: 4px;
padding: 8px;
width: 36px;
height: 36px;
box-sizing: border-box;
margin: 0;
border-bottom: none;
display: flex;
align-items: center;
justify-content: center;
box-shadow: none;
}
.layers-control.collapsible.icon-only.open {
width: 120px;
box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}
.layers-control.collapsible.icon-only.open .toggle-button {
border-radius: 4px 4px 0 0;
border-bottom: 1px solid rgba(0, 0, 0, 0.1);
width: 100%;
}
</style>

</head>
<body>
<div id="htmlwidget_container">
  <div id="compare-container-31017" style="width:100%;height:500px;" class="mapboxgl_compare html-widget"></div>
</div>
<script type="application/json" data-for="compare-container-31017">{"x":{"map1":{"style":null,"center":[0,0],"zoom":0,"bearing":0,"pitch":0,"projection":"globe","parallels":null,"access_token":"pk.eyJ1IjoibWhjNTciLCJhIjoiY2xubWlxM2ZmMG05ODJvcnFobDNiOWNuOCJ9.xeowvsOfzZiA05R4P6emkA","additional_params":{"bounds":[-6.103681,54.470597,-5.796944,54.712705]},"layers":[{"id":"rush","type":"fill","source":{"type":"geojson","data":{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"time":15,"id":1},"geometry":{"type":"Polygon","coordinates":[[[-5.976681,54.675707],[-5.976686,54.674701],[-5.975703,54.674679],[-5.975697,54.673685],[-5.974758,54.673624],[-5.974711,54.672671],[-5.97379,54.672592],[-5.973681,54.671648],[-5.971803,54.671579],[-5.971681,54.670643],[-5.968813,54.670569],[-5.968681,54.669628],[-5.963917,54.669465],[-5.963681,54.668594],[-5.959946,54.668436],[-5.959681,54.667562],[-5.957013,54.667369],[-5.956791,54.666591],[-5.954091,54.666291],[-5.953822,54.66556],[-5.952115,54.665267],[-5.951681,54.664499],[-5.949681,54.664439],[-5.948681,54.663102],[-5.947681,54.663359],[-5.946937,54.662445],[-5.943681,54.662252],[-5.942681,54.661186],[-5.939681,54.66111],[-5.938681,54.660074],[-5.937451,54.659931],[-5.933594,54.655788],[-5.933438,54.654944],[-5.932647,54.654735],[-5.931365,54.653017],[-5.930473,54.652701],[-5.93127,54.650701],[-5.929726,54.649656],[-5.927933,54.645701],[-5.928681,54.6453],[-5.932024,54.645358],[-5.932681,54.64615],[-5.934096,54.646286],[-5.934681,54.648662],[-5.935773,54.645701],[-5.935681,54.644111],[-5.933681,54.644799],[-5.931681,54.643344],[-5.930681,54.644154],[-5.926681,54.644069],[-5.925453,54.642929],[-5.925311,54.641701],[-5.925681,54.641138],[-5.931095,54.640701],[-5.936681,54.638883],[-5.936681,54.638553],[-5.934192,54.63819],[-5.933785,54.636597],[-5.932799,54.635701],[-5.933681,54.63514],[-5.935681,54.63483],[-5.936681,54.635393],[-5.937681,54.635205],[-5.938583,54.634701],[-5.937949,54.634433],[-5.938205,54.633225],[-5.939308,54.633074],[-5.939681,54.634118],[-5.942461,54.631481],[-5.943252,54.631701],[-5.943681,54.632712],[-5.944681,54.633093],[-5.946352,54.63303],[-5.947681,54.634255],[-5.948952,54.630972],[-5.949787,54.630701],[-5.948205,54.630177],[-5.946163,54.627701],[-5.946681,54.62739],[-5.94798,54.627402],[-5.948681,54.627839],[-5.949681,54.627682],[-5.952118,54.626701],[-5.950814,54.624701],[-5.951681,54.623489],[-5.952911,54.623701],[-5.952218,54.624701],[-5.952681,54.625438],[-5.95416,54.62518],[-5.954681,54.624486],[-5.955681,54.625398],[-5.956681,54.625266],[-5.957681,54.627383],[-5.958995,54.626387],[-5.957918,54.630701],[-5.955613,54.631701],[-5.956399,54.631983],[-5.956681,54.632672],[-5.957681,54.632066],[-5.962012,54.632032],[-5.964834,54.630854],[-5.966427,54.630955],[-5.966681,54.631855],[-5.968681,54.63128],[-5.970241,54.632701],[-5.969681,54.633355],[-5.968681,54.633301],[-5.96801,54.633701],[-5.968681,54.635787],[-5.969681,54.635566],[-5.973361,54.631381],[-5.974681,54.630523],[-5.975489,54.630509],[-5.975924,54.629944],[-5.976681,54.629966],[-5.977913,54.628933],[-5.979562,54.626582],[-5.980729,54.626749],[-5.980978,54.625701],[-5.981681,54.625321],[-5.983154,54.626701],[-5.983102,54.628701],[-5.986681,54.629022],[-5.988681,54.63016],[-5.988755,54.628627],[-5.987841,54.627541],[-5.986305,54.627077],[-5.985132,54.625701],[-5.985681,54.625056],[-5.988391,54.624411],[-5.988756,54.623626],[-5.984681,54.623227],[-5.983681,54.624148],[-5.980681,54.624056],[-5.980149,54.622233],[-5.97942,54.621701],[-5.980681,54.619435],[-5.981681,54.621405],[-5.983681,54.621444],[-5.984681,54.622424],[-5.988106,54.622126],[-5.988357,54.620701],[-5.987127,54.619255],[-5.983442,54.618701],[-5.985159,54.618179],[-5.985383,54.615403],[-5.986917,54.615465],[-5.988123,54.616701],[-5.988681,54.618479],[-5.994162,54.617701],[-5.990681,54.617282],[-5.988104,54.614278],[-5.986681,54.614032],[-5.985681,54.613002],[-5.984506,54.612876],[-5.984681,54.612431],[-5.986681,54.612388],[-5.987681,54.611271],[-5.988681,54.611233],[-5.989213,54.610701],[-5.988413,54.609969],[-5.988125,54.608257],[-5.986507,54.606875],[-5.987417,54.605701],[-5.987171,54.605211],[-5.985681,54.603961],[-5.984488,54.603894],[-5.984539,54.602701],[-5.985681,54.603521],[-5.987681,54.603488],[-5.988468,54.602701],[-5.98757,54.60159],[-5.991681,54.601509],[-5.992297,54.601317],[-5.992484,54.600504],[-5.993681,54.600491],[-5.994237,54.603145],[-5.995125,54.603145],[-5.995513,54.601533],[-5.999233,54.598253],[-5.999429,54.595953],[-5.998681,54.594976],[-5.997827,54.596847],[-5.994681,54.59686],[-5.994513,54.595701],[-5.99531,54.59533],[-5.995495,54.594701],[-5.994569,54.593589],[-5.996364,54.593384],[-5.997681,54.591521],[-6.001235,54.591255],[-6.001235,54.590147],[-5.999681,54.589904],[-5.999681,54.589489],[-6.002681,54.589432],[-6.003219,54.590163],[-6.004143,54.590163],[-6.004143,54.588239],[-6.002681,54.58797],[-6.002549,54.587569],[-6.004317,54.587337],[-6.004681,54.586516],[-6.008235,54.586255],[-6.008547,54.584567],[-6.010259,54.584279],[-6.010681,54.583483],[-6.012681,54.583437],[-6.013681,54.582463],[-6.01638,54.5824],[-6.019681,54.581141],[-6.023681,54.581277],[-6.024681,54.582405],[-6.026672,54.58271],[-6.028003,54.583379],[-6.030681,54.585588],[-6.034164,54.587218],[-6.034681,54.588369],[-6.03654,54.588842],[-6.036681,54.58948],[-6.036379,54.587701],[-6.035155,54.587227],[-6.034225,54.586157],[-6.033799,54.584583],[-6.032311,54.584071],[-6.030289,54.582093],[-6.029982,54.579701],[-6.030681,54.579068],[-6.03191,54.57893],[-6.032681,54.578037],[-6.033949,54.578433],[-6.034681,54.579279],[-6.037042,54.579062],[-6.036935,54.574701],[-6.03764,54.572701],[-6.036266,54.572701],[-6.036317,54.573701],[-6.035436,54.574456],[-6.034729,54.576749],[-6.03442,54.575962],[-6.031448,54.575934],[-6.029681,54.574112],[-6.028681,54.575018],[-6.027681,54.574132],[-6.026253,54.574129],[-6.025681,54.573075],[-6.024681,54.573054],[-6.023681,54.574017],[-6.023022,54.57236],[-6.019933,54.571449],[-6.019681,54.570638],[-6.019076,54.571096],[-6.018329,54.571053],[-6.017681,54.570236],[-6.016382,54.57],[-6.015029,54.568353],[-6.013997,54.568385],[-6.013716,54.567701],[-6.015086,54.567296],[-6.015681,54.568487],[-6.016681,54.566264],[-6.018681,54.565725],[-6.019349,54.564369],[-6.020681,54.563649],[-6.018586,54.562606],[-6.017681,54.562693],[-6.017723,54.563743],[-6.016681,54.564019],[-6.015863,54.563519],[-6.014681,54.563578],[-6.013681,54.564572],[-6.011681,54.564198],[-6.010681,54.563441],[-6.009681,54.564077],[-6.007464,54.563918],[-6.006742,54.56064],[-6.004681,54.561057],[-6.0034,54.559701],[-6.004681,54.558435],[-6.008681,54.558376],[-6.009681,54.557316],[-6.010681,54.558003],[-6.012447,54.557935],[-6.012681,54.558295],[-6.012913,54.557933],[-6.011916,54.556701],[-6.013358,54.554701],[-6.011807,54.553701],[-6.011629,54.551701],[-6.009359,54.550023],[-6.010681,54.548041],[-6.012005,54.548701],[-6.012062,54.547701],[-6.011011,54.547371],[-6.010803,54.546701],[-6.010751,54.545771],[-6.011583,54.545701],[-6.010337,54.545701],[-6.010137,54.547157],[-6.0088,54.547582],[-6.007681,54.547794],[-6.005985,54.547397],[-6.003879,54.547701],[-6.001681,54.54873],[-6.000952,54.549972],[-5.999681,54.550103],[-5.998681,54.551061],[-5.998091,54.549111],[-5.998258,54.548278],[-5.999186,54.547701],[-5.998681,54.547253],[-5.997022,54.54736],[-5.995681,54.546597],[-5.995262,54.54512],[-5.994487,54.544701],[-5.994444,54.541701],[-5.993681,54.539943],[-5.992923,54.540701],[-5.992901,54.545701],[-5.993893,54.546701],[-5.993681,54.548216],[-5.992681,54.54733],[-5.986845,54.547537],[-5.986317,54.546701],[-5.986623,54.547759],[-5.988345,54.548037],[-5.989425,54.548957],[-5.993988,54.549394],[-5.993681,54.550798],[-5.989681,54.551164],[-5.989144,54.551701],[-5.989298,54.553084],[-5.990889,54.553493],[-5.991823,54.554843],[-5.988681,54.555084],[-5.987681,54.556067],[-5.985248,54.556268],[-5.984681,54.557219],[-5.982493,54.556889],[-5.982095,54.555287],[-5.978681,54.553946],[-5.979057,54.555701],[-5.978036,54.557056],[-5.975886,54.556496],[-5.974681,54.557174],[-5.973681,54.556434],[-5.971637,54.556657],[-5.970161,54.559701],[-5.973681,54.560114],[-5.974242,54.56214],[-5.975946,54.563701],[-5.974146,54.564166],[-5.973681,54.564906],[-5.971093,54.565113],[-5.970681,54.565882],[-5.969412,54.564701],[-5.971098,54.563118],[-5.971098,54.562284],[-5.969681,54.562044],[-5.968885,54.562905],[-5.967681,54.562946],[-5.96718,54.562202],[-5.965522,54.56186],[-5.965353,54.560701],[-5.96818,54.557701],[-5.968447,54.556467],[-5.971033,54.554701],[-5.970681,54.554019],[-5.969681,54.554386],[-5.967681,54.553606],[-5.965537,54.554557],[-5.964015,54.554701],[-5.962681,54.557266],[-5.959249,54.556701],[-5.958672,54.555701],[-5.95635,54.554032],[-5.955872,54.55251],[-5.953293,54.552089],[-5.952681,54.549296],[-5.952479,54.550701],[-5.951681,54.551317],[-5.950681,54.5504],[-5.949162,54.55022],[-5.948681,54.549395],[-5.946819,54.549563],[-5.946405,54.548701],[-5.946625,54.549757],[-5.948023,54.550359],[-5.948681,54.551335],[-5.949681,54.550984],[-5.950443,54.551939],[-5.951681,54.552085],[-5.9524,54.552982],[-5.954046,54.553336],[-5.956,54.555382],[-5.955977,54.555997],[-5.954389,54.556409],[-5.953681,54.557265],[-5.950406,54.557426],[-5.949681,54.559134],[-5.947681,54.556809],[-5.943775,54.558701],[-5.943479,54.559701],[-5.941519,54.560701],[-5.943056,54.561326],[-5.94312,54.56314],[-5.941681,54.563828],[-5.939611,54.563631],[-5.940105,54.565125],[-5.938109,54.567129],[-5.934681,54.567762],[-5.932128,54.568701],[-5.933578,54.569701],[-5.93168,54.569702],[-5.929681,54.570512],[-5.928681,54.570062],[-5.927681,54.570985],[-5.926681,54.571072],[-5.926681,54.573028],[-5.924681,54.575354],[-5.923681,54.573951],[-5.922827,54.573847],[-5.918497,54.574701],[-5.917681,54.57581],[-5.921195,54.578187],[-5.924403,54.578979],[-5.924691,54.579701],[-5.924047,54.580701],[-5.924783,54.581803],[-5.924084,54.583103],[-5.921681,54.582727],[-5.919681,54.584976],[-5.919351,54.586701],[-5.920058,54.587324],[-5.920337,54.589045],[-5.921254,54.589701],[-5.920969,54.590989],[-5.919921,54.591941],[-5.918304,54.592324],[-5.916127,54.594147],[-5.914199,54.594183],[-5.914237,54.591145],[-5.911315,54.590067],[-5.910681,54.587669],[-5.908681,54.588727],[-5.908439,54.589459],[-5.906681,54.589535],[-5.904625,54.590645],[-5.902919,54.590939],[-5.902027,54.592047],[-5.900354,54.592028],[-5.899681,54.591326],[-5.898681,54.591161],[-5.897403,54.592423],[-5.897929,54.593949],[-5.896476,54.594701],[-5.895947,54.595967],[-5.894862,54.596701],[-5.88948,54.597701],[-5.888726,54.599746],[-5.887442,54.59994],[-5.886681,54.599329],[-5.883473,54.600493],[-5.883578,54.601701],[-5.886681,54.602412],[-5.887267,54.601287],[-5.888027,54.601355],[-5.88811,54.60213],[-5.887111,54.602701],[-5.888681,54.603517],[-5.889681,54.602208],[-5.890194,54.602701],[-5.889869,54.603889],[-5.887681,54.603901],[-5.886681,54.604994],[-5.884681,54.605099],[-5.884008,54.606028],[-5.882681,54.606182],[-5.882038,54.607058],[-5.880681,54.607231],[-5.880054,54.608074],[-5.878422,54.608442],[-5.878059,54.609079],[-5.874488,54.610508],[-5.873681,54.611315],[-5.872681,54.61119],[-5.871681,54.612216],[-5.870373,54.612393],[-5.868482,54.614502],[-5.868314,54.615334],[-5.867518,54.615538],[-5.867162,54.616182],[-5.864681,54.616499],[-5.86432,54.61734],[-5.862505,54.617877],[-5.862681,54.618642],[-5.86284,54.61786],[-5.864725,54.617745],[-5.864922,54.616942],[-5.8678,54.61682],[-5.869681,54.615103],[-5.870083,54.614103],[-5.874859,54.612879],[-5.875258,54.611278],[-5.87695,54.61097],[-5.877681,54.610107],[-5.879681,54.610223],[-5.881681,54.608355],[-5.883681,54.608322],[-5.885681,54.606198],[-5.887681,54.606397],[-5.888681,54.605412],[-5.892052,54.60633],[-5.891039,54.608059],[-5.889451,54.608471],[-5.888542,54.609562],[-5.888444,54.610464],[-5.887612,54.61077],[-5.888511,54.610871],[-5.890257,54.609277],[-5.892681,54.608813],[-5.892952,54.607972],[-5.894721,54.607741],[-5.895182,54.606202],[-5.896681,54.604983],[-5.901681,54.605404],[-5.903681,54.604456],[-5.905681,54.604471],[-5.905106,54.606126],[-5.902983,54.606701],[-5.901681,54.608401],[-5.900313,54.608333],[-5.899214,54.610234],[-5.898515,54.610535],[-5.899971,54.612991],[-5.898681,54.613312],[-5.896681,54.612954],[-5.896066,54.614086],[-5.894681,54.61469],[-5.893652,54.616672],[-5.894681,54.618264],[-5.896284,54.616304],[-5.899838,54.615858],[-5.902319,54.612339],[-5.902681,54.612181],[-5.903281,54.612701],[-5.903141,54.613161],[-5.902324,54.613344],[-5.902449,54.613933],[-5.903681,54.614108],[-5.904399,54.612419],[-5.906901,54.611921],[-5.906783,54.610701],[-5.907499,54.609519],[-5.908681,54.610307],[-5.909681,54.609265],[-5.911123,54.609143],[-5.911474,54.605701],[-5.912299,54.605319],[-5.912557,54.604577],[-5.913681,54.605488],[-5.916681,54.605422],[-5.91854,54.60356],[-5.919792,54.60359],[-5.918831,54.605851],[-5.916681,54.605976],[-5.914848,54.607868],[-5.913196,54.608216],[-5.910061,54.611701],[-5.910681,54.612321],[-5.911884,54.612498],[-5.912681,54.612406],[-5.914023,54.611359],[-5.915029,54.612701],[-5.914681,54.61314],[-5.911964,54.613701],[-5.912681,54.615343],[-5.913949,54.614969],[-5.914681,54.614262],[-5.915399,54.614701],[-5.915082,54.616102],[-5.913144,54.618164],[-5.91291,54.61993],[-5.911681,54.621196],[-5.910681,54.619715],[-5.909681,54.62023],[-5.906681,54.620598],[-5.906533,54.620849],[-5.906648,54.621701],[-5.906684,54.621698],[-5.906722,54.620742],[-5.907681,54.620756],[-5.908487,54.620896],[-5.908681,54.621803],[-5.910681,54.621908],[-5.911681,54.622855],[-5.914681,54.622954],[-5.915093,54.623701],[-5.91402,54.62504],[-5.912681,54.626025],[-5.910681,54.624551],[-5.909587,54.624607],[-5.908681,54.625204],[-5.907487,54.624701],[-5.907224,54.625701],[-5.904681,54.628384],[-5.903926,54.627701],[-5.904114,54.627134],[-5.904884,54.626904],[-5.904881,54.625501],[-5.902788,54.626808],[-5.901681,54.626644],[-5.899999,54.628019],[-5.898681,54.628212],[-5.896434,54.627948],[-5.896036,54.626701],[-5.896841,54.625701],[-5.895681,54.625532],[-5.893444,54.627701],[-5.893931,54.628951],[-5.891681,54.628856],[-5.890681,54.629183],[-5.890413,54.630433],[-5.888924,54.630944],[-5.888858,54.631878],[-5.887681,54.632379],[-5.887449,54.633469],[-5.886608,54.633774],[-5.887681,54.633929],[-5.889152,54.633172],[-5.891681,54.632836],[-5.892681,54.63205],[-5.894311,54.633071],[-5.895681,54.633088],[-5.896305,54.632325],[-5.898017,54.632037],[-5.899681,54.630329],[-5.905681,54.630391],[-5.906681,54.631058],[-5.909953,54.631429],[-5.909681,54.634578],[-5.910929,54.633949],[-5.912505,54.630525],[-5.91782,54.630562],[-5.917836,54.638856],[-5.916839,54.640859],[-5.913992,54.643701],[-5.913986,54.644701],[-5.914974,54.645408],[-5.914969,54.645989],[-5.9132,54.64722],[-5.907342,54.653362],[-5.907216,54.654166],[-5.908681,54.654265],[-5.910429,54.652449],[-5.911124,54.652258],[-5.911104,54.654701],[-5.910022,54.656042],[-5.906368,54.656388],[-5.906681,54.658618],[-5.907681,54.658324],[-5.907918,54.658701],[-5.907342,54.659362],[-5.907289,54.661701],[-5.908681,54.661507],[-5.910681,54.659312],[-5.911681,54.659871],[-5.913919,54.659701],[-5.913245,54.658701],[-5.911196,54.657701],[-5.914478,54.656701],[-5.915557,54.655577],[-5.916681,54.656088],[-5.917681,54.65524],[-5.919033,54.655349],[-5.919216,54.656236],[-5.918588,54.656701],[-5.919479,54.656903],[-5.919631,54.657751],[-5.920681,54.65719],[-5.921681,54.658391],[-5.922681,54.658014],[-5.923681,54.658396],[-5.924429,54.656449],[-5.925681,54.655864],[-5.926681,54.656935],[-5.927681,54.655986],[-5.929681,54.655164],[-5.931938,54.656444],[-5.935226,54.660156],[-5.936476,54.660906],[-5.938249,54.661133],[-5.938548,54.661834],[-5.941681,54.661959],[-5.942681,54.66334],[-5.945681,54.662946],[-5.946681,54.663984],[-5.948146,54.664236],[-5.948681,54.664988],[-5.950681,54.664973],[-5.95151,54.665872],[-5.953225,54.666157],[-5.953681,54.666905],[-5.956319,54.667063],[-5.956681,54.667871],[-5.959409,54.667973],[-5.959681,54.668835],[-5.963453,54.668929],[-5.963681,54.66981],[-5.967681,54.66982],[-5.968456,54.669926],[-5.968681,54.670801],[-5.971511,54.670871],[-5.971634,54.671748],[-5.973556,54.671826],[-5.973608,54.672774],[-5.974357,54.673025],[-5.974544,54.673701],[-5.975615,54.673767],[-5.975681,54.674728],[-5.976659,54.674723],[-5.976681,54.675707]]]}},{"type":"Feature","properties":{"time":10,"id":1},"geometry":{"type":"Polygon","coordinates":[[[-5.919681,54.625922],[-5.919857,54.622877],[-5.920792,54.622701],[-5.921016,54.617701],[-5.922105,54.616701],[-5.922681,54.611485],[-5.923681,54.613437],[-5.92511,54.61113],[-5.926343,54.611039],[-5.926681,54.612173],[-5.928681,54.611327],[-5.931681,54.610729],[-5.932681,54.611016],[-5.935034,54.613348],[-5.936681,54.614331],[-5.937681,54.613717],[-5.938253,54.614129],[-5.938385,54.614997],[-5.940286,54.617096],[-5.941681,54.616746],[-5.943681,54.617317],[-5.947681,54.615946],[-5.948332,54.61805],[-5.951681,54.618139],[-5.953681,54.619713],[-5.95574,54.617701],[-5.954313,54.615701],[-5.955364,54.614701],[-5.954657,54.613676],[-5.955681,54.613117],[-5.957681,54.613236],[-5.958681,54.612192],[-5.959356,54.613026],[-5.960681,54.613095],[-5.961459,54.613701],[-5.961339,54.614359],[-5.959982,54.614701],[-5.960681,54.61518],[-5.964519,54.615863],[-5.966681,54.617071],[-5.967681,54.616087],[-5.968681,54.617069],[-5.969841,54.616861],[-5.969987,54.615701],[-5.969031,54.613701],[-5.969681,54.612864],[-5.970681,54.613313],[-5.971681,54.613046],[-5.972681,54.611135],[-5.973681,54.612692],[-5.975582,54.612701],[-5.975197,54.611217],[-5.976056,54.610076],[-5.976163,54.607183],[-5.977681,54.606437],[-5.978794,54.606701],[-5.980927,54.605701],[-5.980146,54.605236],[-5.98029,54.60431],[-5.983681,54.604063],[-5.984343,54.602363],[-5.985681,54.602257],[-5.987792,54.600701],[-5.986115,54.600267],[-5.985768,54.599701],[-5.987268,54.598288],[-5.989681,54.597805],[-5.990681,54.596588],[-5.991681,54.597242],[-5.993075,54.597307],[-5.993681,54.598041],[-5.995646,54.597701],[-5.99423,54.597152],[-5.99256,54.59458],[-5.993681,54.592873],[-5.995681,54.592941],[-5.996959,54.591979],[-5.997454,54.590474],[-5.998857,54.589877],[-5.99881,54.58783],[-5.999742,54.587701],[-5.998652,54.587672],[-5.997681,54.589344],[-5.996874,54.587508],[-5.995915,54.586701],[-5.996011,54.585701],[-5.993278,54.585104],[-5.992299,54.583319],[-5.993438,54.581458],[-5.994681,54.582025],[-5.998451,54.581701],[-6.000187,54.579701],[-5.998566,54.579586],[-5.997681,54.580421],[-5.992681,54.577535],[-5.990681,54.577928],[-5.989681,54.577479],[-5.989292,54.578312],[-5.988681,54.578606],[-5.987995,54.578387],[-5.987567,54.576701],[-5.988563,54.574583],[-5.991151,54.573701],[-5.990197,54.572701],[-5.988681,54.572926],[-5.985681,54.572108],[-5.98475,54.572701],[-5.985213,54.573701],[-5.984681,54.574176],[-5.983378,54.574004],[-5.983013,54.573369],[-5.981603,54.572779],[-5.982681,54.572356],[-5.984068,54.572314],[-5.984644,54.572664],[-5.984599,54.571619],[-5.987127,54.571147],[-5.987424,54.570444],[-5.988981,54.570001],[-5.990247,54.568267],[-5.991897,54.567917],[-5.993055,54.564075],[-5.993976,54.563701],[-5.993804,54.560824],[-5.994717,54.560701],[-5.994681,54.559478],[-5.994545,54.560565],[-5.993681,54.560591],[-5.993421,54.562701],[-5.992681,54.563375],[-5.992306,54.565326],[-5.991458,54.565701],[-5.991145,54.567165],[-5.989681,54.567383],[-5.987681,54.569118],[-5.983753,54.569773],[-5.982803,54.569579],[-5.982418,54.570438],[-5.980238,54.571258],[-5.977681,54.571379],[-5.973681,54.57107],[-5.972681,54.570122],[-5.97137,54.570012],[-5.970553,54.568701],[-5.970681,54.567612],[-5.967649,54.567669],[-5.966681,54.568032],[-5.965681,54.567455],[-5.964681,54.567428],[-5.963931,54.567701],[-5.965014,54.569701],[-5.965681,54.569878],[-5.966681,54.569025],[-5.967112,54.56927],[-5.967039,54.571059],[-5.965359,54.571379],[-5.965328,54.572701],[-5.964681,54.573253],[-5.963681,54.572254],[-5.961681,54.572488],[-5.960681,54.572152],[-5.959992,54.574012],[-5.958367,54.574387],[-5.95794,54.57596],[-5.95691,54.57693],[-5.9549,54.57692],[-5.953628,54.577754],[-5.95348,54.576902],[-5.952681,54.576716],[-5.949681,54.578071],[-5.947681,54.577735],[-5.941709,54.579729],[-5.939681,54.578877],[-5.938681,54.579214],[-5.937765,54.579785],[-5.936484,54.582504],[-5.936651,54.58567],[-5.935681,54.586121],[-5.934267,54.588287],[-5.933891,54.589911],[-5.930986,54.592006],[-5.930273,54.594701],[-5.924681,54.595762],[-5.924305,54.597325],[-5.922991,54.597701],[-5.923681,54.599287],[-5.925335,54.598355],[-5.92802,54.598362],[-5.928366,54.599386],[-5.92748,54.6005],[-5.927036,54.602701],[-5.924681,54.602193],[-5.924437,54.603457],[-5.923712,54.603732],[-5.922017,54.602365],[-5.919681,54.602296],[-5.918681,54.601467],[-5.913853,54.601529],[-5.913681,54.600649],[-5.912394,54.601414],[-5.912681,54.602441],[-5.91302,54.60204],[-5.917681,54.602008],[-5.918681,54.603074],[-5.920681,54.603046],[-5.922974,54.605701],[-5.922791,54.607811],[-5.920657,54.608701],[-5.921438,54.615701],[-5.920443,54.616701],[-5.920545,54.621701],[-5.920464,54.622484],[-5.919629,54.622701],[-5.919681,54.625922]]]}},{"type":"Feature","properties":{"time":5,"id":1},"geometry":{"type":"Polygon","coordinates":[[[-5.946681,54.601854],[-5.947681,54.60193],[-5.948681,54.600453],[-5.949681,54.601966],[-5.955082,54.6003],[-5.954903,54.600701],[-5.957681,54.601086],[-5.958786,54.601806],[-5.959681,54.601219],[-5.961348,54.602034],[-5.964563,54.601701],[-5.96371,54.600672],[-5.964389,54.597701],[-5.965537,54.596557],[-5.967856,54.595876],[-5.970681,54.59386],[-5.970717,54.592701],[-5.971814,54.591701],[-5.972189,54.590209],[-5.9735,54.589701],[-5.971882,54.5895],[-5.971794,54.588701],[-5.973778,54.585701],[-5.971826,54.585701],[-5.969681,54.586429],[-5.968681,54.587318],[-5.964681,54.587672],[-5.962776,54.588701],[-5.963681,54.588961],[-5.964042,54.589701],[-5.962681,54.589946],[-5.962172,54.586701],[-5.962757,54.585625],[-5.962701,54.584701],[-5.962676,54.584706],[-5.962608,54.585628],[-5.961499,54.585519],[-5.960681,54.585984],[-5.959607,54.585701],[-5.959664,54.584718],[-5.958634,54.584654],[-5.956756,54.585776],[-5.956681,54.586966],[-5.955681,54.586769],[-5.951439,54.588459],[-5.951383,54.588999],[-5.952529,54.589853],[-5.953775,54.589607],[-5.954101,54.590701],[-5.952087,54.591107],[-5.951444,54.591938],[-5.950462,54.59192],[-5.949681,54.590993],[-5.945127,54.591701],[-5.944454,54.592474],[-5.943627,54.592647],[-5.942898,54.594701],[-5.941536,54.595701],[-5.945376,54.597701],[-5.944042,54.599062],[-5.942667,54.599701],[-5.94227,54.600701],[-5.944681,54.601039],[-5.945681,54.60015],[-5.946681,54.601854]]]}}]},"generateId":true},"source_layer":null,"paint":{"fill-antialias":true,"fill-color":["match",["get","time"],5,"lightblue",10,"blue",15,"darkblue","#cccccc"],"fill-opacity":0.35,"fill-translate-anchor":"map"},"layout":{"visibility":"visible"},"slot":null,"minzoom":null,"maxzoom":null,"popup":null,"tooltip":null,"hover_options":null,"before_id":null,"filter":null}],"markers":[{"id":"marker_1","lng":-5.953681,"lat":54.593701,"color":"red","rotation":0,"popup":null,"options":{"draggable":false}}]},"map2":{"style":null,"center":[0,0],"zoom":0,"bearing":0,"pitch":0,"projection":"globe","parallels":null,"access_token":"pk.eyJ1IjoibWhjNTciLCJhIjoiY2xubWlxM2ZmMG05ODJvcnFobDNiOWNuOCJ9.xeowvsOfzZiA05R4P6emkA","additional_params":{"bounds":[-6.103681,54.470597,-5.796944,54.712705]},"layers":[{"id":"night","type":"fill","source":{"type":"geojson","data":{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"time":15,"id":1},"geometry":{"type":"Polygon","coordinates":[[[-5.967681,54.712705],[-5.96851,54.710701],[-5.96791,54.709701],[-5.968188,54.709208],[-5.969587,54.708701],[-5.970287,54.705306],[-5.971118,54.705264],[-5.971681,54.706009],[-5.97448,54.705902],[-5.974645,54.706737],[-5.975275,54.706701],[-5.974785,54.706597],[-5.974745,54.705637],[-5.972681,54.705442],[-5.970681,54.703349],[-5.969681,54.703727],[-5.969277,54.703106],[-5.969251,54.699701],[-5.970072,54.699092],[-5.970411,54.697431],[-5.973022,54.696701],[-5.970418,54.695964],[-5.970448,54.694468],[-5.972681,54.694348],[-5.973681,54.695318],[-5.974956,54.695426],[-5.975561,54.697821],[-5.97625,54.69727],[-5.977022,54.697361],[-5.977681,54.699056],[-5.979366,54.699016],[-5.979968,54.699701],[-5.979828,54.698701],[-5.980681,54.698156],[-5.981335,54.699047],[-5.982681,54.699092],[-5.983681,54.700047],[-5.985165,54.700217],[-5.985681,54.701799],[-5.989644,54.701701],[-5.987938,54.701444],[-5.987681,54.700155],[-5.98532,54.699062],[-5.983721,54.697661],[-5.982681,54.697562],[-5.981799,54.696583],[-5.980681,54.697246],[-5.980002,54.69638],[-5.978363,54.696019],[-5.978681,54.691968],[-5.978478,54.692498],[-5.977541,54.69256],[-5.976681,54.695142],[-5.97607,54.694312],[-5.974681,54.694097],[-5.973681,54.693077],[-5.972451,54.692931],[-5.972361,54.691701],[-5.97314,54.691160000000007],[-5.973481,54.689501],[-5.974148,54.689168],[-5.974448,54.687468],[-5.976016,54.686036],[-5.976317,54.684337],[-5.977415,54.683701],[-5.978516,54.680536],[-5.979681,54.680067],[-5.981106,54.681276],[-5.982119,54.683263],[-5.983829,54.683553],[-5.984127,54.684255],[-5.985832,54.68455],[-5.986138,54.685244],[-5.987681,54.685471],[-5.988283,54.686099],[-5.990681,54.686157],[-5.991681,54.687457],[-5.993681,54.687454],[-5.994681,54.688253],[-5.996681,54.688443],[-5.997681,54.689438],[-5.999681,54.689433],[-5.999978,54.689998],[-5.999215,54.691235],[-5.997928,54.691701],[-6.00085,54.69187],[-6.001707,54.690701],[-6.002681,54.690422],[-6.003791,54.690591],[-6.004053,54.691329],[-6.005681,54.69141],[-6.006681,54.691029],[-6.007681,54.692402],[-6.009681,54.692021],[-6.010471,54.692911],[-6.011681,54.693383],[-6.012681,54.693013],[-6.013141,54.693241],[-6.013681,54.694373],[-6.015681,54.694005],[-6.016681,54.694973],[-6.018681,54.694995],[-6.019681,54.696338],[-6.020932,54.69645],[-6.021681,54.697318],[-6.023681,54.69731],[-6.024681,54.698295],[-6.027681,54.69796],[-6.028681,54.699016],[-6.031021,54.699361],[-6.031681,54.700236],[-6.033681,54.700215],[-6.034476,54.700906],[-6.035681,54.701192],[-6.038373,54.701009],[-6.038681,54.702144],[-6.041681,54.702107],[-6.042681,54.703079],[-6.047439,54.702943],[-6.047681,54.703805],[-6.051324,54.704058],[-6.051681,54.704864],[-6.055661,54.704721],[-6.055867,54.705701],[-6.055681,54.704676],[-6.051809,54.704573],[-6.051681,54.703617],[-6.048681,54.703445],[-6.047681,54.702415],[-6.043681,54.702442],[-6.042681,54.701316],[-6.039681,54.701264],[-6.038681,54.700308],[-6.035681,54.70021],[-6.034681,54.699196],[-6.032369,54.699013],[-6.031681,54.698076],[-6.029681,54.698146],[-6.028681,54.696982],[-6.025681,54.697111],[-6.025081,54.696301],[-6.022918,54.695701],[-6.022537,54.694845],[-6.020681,54.695004],[-6.01908,54.693701],[-6.019681,54.693009],[-6.0212,54.693182],[-6.021681,54.693998],[-6.022681,54.694366],[-6.023681,54.69417],[-6.024605,54.694777],[-6.025774,54.694701],[-6.024817,54.694565],[-6.024681,54.693629],[-6.022681,54.693517],[-6.021838,54.692544],[-6.020217,54.692165],[-6.018087,54.690295],[-6.017681,54.688816],[-6.017416,54.689436],[-6.013681,54.689229],[-6.012681,54.688433],[-6.009681,54.688159],[-6.008681,54.687215],[-6.007681,54.688133],[-6.007067,54.687315],[-6.00541,54.686972],[-6.006151,54.684701],[-6.005179,54.683701],[-6.006681,54.682042],[-6.007681,54.682363],[-6.011681,54.681973],[-6.012681,54.682876],[-6.016044,54.682701],[-6.012776,54.682606],[-6.012681,54.681484],[-6.010231,54.681151],[-6.008681,54.678846],[-6.008416,54.679436],[-6.007681,54.679581],[-6.007147,54.679235],[-6.006681,54.677522],[-6.004681,54.677054],[-6.003681,54.677508],[-6.00296,54.676701],[-6.004033,54.675701],[-6.003681,54.67461],[-6.003407,54.675427],[-6.002474,54.675494],[-6.002129,54.676149],[-5.999427,54.676447],[-5.999018,54.677038],[-5.998372,54.67701],[-5.998055,54.676701],[-5.998886,54.675701],[-5.998259,54.674279],[-5.999472,54.673701],[-5.998901,54.672481],[-5.998345,54.672365],[-5.997681,54.672833],[-5.996681,54.675172],[-5.995816,54.674701],[-5.994959,54.672423],[-5.994681,54.67224],[-5.993681,54.673174],[-5.993122,54.672701],[-5.992968,54.671701],[-5.994833,54.670701],[-5.993626,54.667756],[-5.991903,54.667479],[-5.989681,54.665395],[-5.986681,54.665743],[-5.986298,54.665084],[-5.985681,54.664837],[-5.985265,54.665117],[-5.984681,54.663623],[-5.983207,54.663175],[-5.980965,54.660417],[-5.979328,54.660054],[-5.976399,54.656983],[-5.976291,54.655701],[-5.974366,54.652701],[-5.974405,54.649701],[-5.973422,54.648701],[-5.973507,54.647527],[-5.974681,54.647399],[-5.976308,54.649074],[-5.978041,54.649341],[-5.978681,54.650112],[-5.978955,54.648427],[-5.977681,54.648165],[-5.977281,54.647701],[-5.977964,54.644418],[-5.977398,54.644418],[-5.975681,54.646039],[-5.973681,54.645975],[-5.973181,54.645201],[-5.971459,54.644701],[-5.971681,54.642475],[-5.975681,54.642393],[-5.976681,54.64334],[-5.97732,54.641701],[-5.976681,54.641062],[-5.971681,54.640927],[-5.970506,54.637701],[-5.97134,54.63736],[-5.971574,54.635594],[-5.973352,54.635372],[-5.973681,54.634534],[-5.974797,54.634585],[-5.975046,54.635336],[-5.975681,54.635519],[-5.976316,54.635336],[-5.976681,54.634528],[-5.978329,54.634348],[-5.979681,54.632519],[-5.983681,54.632507],[-5.981955,54.634701],[-5.982681,54.635427],[-5.983681,54.635445],[-5.984681,54.634484],[-5.986681,54.634492],[-5.986681,54.634965],[-5.98521,54.63523],[-5.984974,54.635701],[-5.985681,54.636408],[-5.990681,54.636471],[-5.991161,54.637221],[-5.993681,54.637452],[-5.994681,54.638418],[-5.995857,54.637525],[-5.99628,54.640102],[-5.998055,54.640701],[-5.997681,54.641207],[-5.996433,54.641453],[-5.99615,54.64217],[-5.995144,54.642701],[-5.996681,54.64337],[-5.997284,54.642304],[-5.998978,54.642404],[-5.998681,54.643423],[-5.997302,54.643701],[-5.999172,54.64421],[-5.999681,54.645025],[-6.001263,54.645119],[-6.001681,54.646075],[-6.00189,54.644701],[-6.001227,54.644155],[-6.001102,54.642701],[-5.999307,54.640701],[-5.999681,54.63941],[-6.000219,54.640163],[-6.001894,54.640488],[-6.002681,54.641373],[-6.006681,54.641333],[-6.007681,54.640323],[-6.008681,54.640307],[-6.009681,54.642081],[-6.010681,54.641284],[-6.013681,54.641232],[-6.014681,54.640208],[-6.018681,54.640113],[-6.019681,54.639075],[-6.023681,54.638894],[-6.024016,54.638036],[-6.026379,54.637701],[-6.023681,54.637534],[-6.022681,54.638462],[-6.018681,54.638313],[-6.017681,54.639266],[-6.013681,54.639186],[-6.012681,54.640155],[-6.011681,54.639168],[-6.010681,54.640118],[-6.009681,54.639106],[-6.008681,54.639095],[-6.007681,54.638275],[-6.006681,54.638205],[-6.005923,54.639943],[-6.003681,54.640033],[-6.003134,54.639248],[-6.001681,54.639012],[-6.001147,54.638235],[-5.999681,54.637992],[-5.99916,54.637222],[-5.997681,54.636976],[-5.996681,54.635967],[-5.993681,54.63595],[-5.993681,54.635519],[-6.007681,54.635462],[-6.008681,54.636408],[-6.009681,54.636419],[-6.010681,54.635446],[-6.027681,54.635266],[-6.028681,54.63639],[-6.030027,54.636355],[-6.031376,54.638006],[-6.032681,54.638039],[-6.033559,54.638823],[-6.03444,54.638942],[-6.034701,54.639721],[-6.035501,54.639521],[-6.036,54.63802],[-6.037531,54.637851],[-6.037645,54.638738],[-6.038244,54.638701],[-6.037758,54.638624],[-6.037681,54.637622],[-6.032681,54.637363],[-6.030681,54.635232],[-6.029362,54.63502],[-6.029681,54.634224],[-6.036681,54.634009],[-6.038681,54.634759],[-6.039681,54.633825],[-6.040518,54.633864],[-6.040681,54.634778],[-6.041649,54.634701],[-6.041543,54.633701],[-6.039681,54.633249],[-6.027681,54.633144],[-6.026681,54.634121],[-6.008681,54.633944],[-6.008485,54.633505],[-6.010087,54.633107],[-6.011939,54.630701],[-6.010681,54.62983],[-6.009991,54.631011],[-6.009214,54.631168],[-6.009218,54.630238],[-6.009681,54.629892],[-6.010175,54.630195],[-6.010324,54.629701],[-6.007681,54.629275],[-6.006056,54.631701],[-6.006843,54.633863],[-6.004681,54.633924],[-6.004215,54.633167],[-6.003423,54.632959],[-6.004119,54.631263],[-6.002681,54.631015],[-6.001681,54.631964],[-6.001418,54.630701],[-6.001681,54.630332],[-6.005681,54.630033],[-6.005936,54.628701],[-6.004681,54.628021],[-6.004066,54.629086],[-6.003378,54.629004],[-6.0026,54.625782],[-6.001681,54.625598],[-6.000973,54.625993],[-5.999894,54.625914],[-5.99951,54.62653],[-5.997681,54.625563],[-5.997321,54.626341],[-5.997067,54.628701],[-5.999836,54.631856],[-5.997681,54.633895],[-5.993681,54.633883],[-5.994471,54.632701],[-5.99455,54.63057],[-5.995681,54.631472],[-5.996452,54.630701],[-5.996352,54.626701],[-5.995234,54.625148],[-5.992681,54.624901],[-5.991681,54.623965],[-5.989681,54.623881],[-5.989347,54.623035],[-5.988681,54.622868],[-5.984681,54.622849],[-5.983977,54.622997],[-5.983681,54.623842],[-5.980594,54.623789],[-5.980417,54.621965],[-5.979556,54.621701],[-5.980371,54.621391],[-5.980681,54.61956],[-5.980972,54.62141],[-5.983681,54.621564],[-5.983962,54.62242],[-5.984681,54.622561],[-5.988367,54.622387],[-5.98838,54.620002],[-5.987581,54.619801],[-5.987377,54.619005],[-5.983548,54.618701],[-5.985392,54.618412],[-5.985528,54.615548],[-5.986681,54.615533],[-5.987032,54.61635],[-5.987803,54.616579],[-5.987913,54.618701],[-5.988681,54.619469],[-5.989681,54.618496],[-5.992843,54.618539],[-5.993986,54.619701],[-5.995398,54.622984],[-5.996681,54.624041],[-5.997064,54.622701],[-5.995443,54.619939],[-5.995504,54.618524],[-5.999917,54.618465],[-6.000406,54.620976],[-6.001681,54.621794],[-6.003329,54.620701],[-6.001314,54.620068],[-6.001318,54.617701],[-6.000681,54.617064],[-5.995509,54.616873],[-5.995681,54.616373],[-5.997681,54.616286],[-5.998266,54.615701],[-5.997681,54.615116],[-5.996428,54.614955],[-5.996042,54.613341],[-5.994681,54.612412],[-5.993681,54.612155],[-5.993497,54.612517],[-5.994286,54.613701],[-5.993996,54.615701],[-5.992681,54.616929],[-5.990681,54.61691],[-5.98833,54.614052],[-5.986681,54.613869],[-5.98636,54.613022],[-5.984581,54.612801],[-5.987388,54.612408],[-5.987578,54.611598],[-5.98933,54.61135],[-5.989506,54.610701],[-5.98933,54.610052],[-5.98857,54.609812],[-5.988371,54.608011],[-5.987581,54.607801],[-5.987389,54.606993],[-5.986547,54.606701],[-5.987399,54.606419],[-5.987399,54.604983],[-5.986588,54.604794],[-5.986401,54.603981],[-5.984562,54.60382],[-5.984581,54.602701],[-5.984908,54.603474],[-5.988438,54.603457],[-5.988438,54.601944],[-5.987608,54.601628],[-5.992441,54.601461],[-5.992559,54.600579],[-5.993681,54.600575],[-5.993972,54.60341],[-5.99539,54.60341],[-5.995593,54.601613],[-5.996428,54.601448],[-5.997604,54.599624],[-5.998448,54.599468],[-5.998601,54.598621],[-5.99943,54.59845],[-5.999546,54.595701],[-5.99941,54.594972],[-5.997952,54.594972],[-5.997764,54.596784],[-5.994681,54.596808],[-5.994571,54.595701],[-5.995451,54.595471],[-5.995566,54.594701],[-5.995451,54.593931],[-5.994608,54.593628],[-5.996468,54.593487],[-5.997681,54.591588],[-6.001431,54.591451],[-6.001431,54.589951],[-5.999681,54.589581],[-6.002681,54.589568],[-6.002961,54.590421],[-6.004401,54.590421],[-6.004401,54.587981],[-6.002603,54.587623],[-6.004453,54.587473],[-6.004681,54.586586],[-6.008427,54.586447],[-6.0086,54.58462],[-6.010433,54.584453],[-6.010681,54.583575],[-6.013408,54.583428],[-6.013681,54.58257],[-6.0170959999999999,54.582701],[-6.016681,54.583187],[-6.015405,54.583425],[-6.014418,54.584701],[-6.014681,54.585463],[-6.016681,54.584215],[-6.018351,54.584701],[-6.017681,54.585798],[-6.018782,54.585802],[-6.019681,54.585141],[-6.020681,54.585269],[-6.021681,54.584406],[-6.022681,54.585364],[-6.025223,54.585243],[-6.025994,54.585014],[-6.026236,54.583701],[-6.027681,54.583539],[-6.03109,54.587292],[-6.033805,54.587577],[-6.03409,54.589292],[-6.035811,54.589571],[-6.036831,54.590851],[-6.034681,54.590997],[-6.033681,54.592032],[-6.032265,54.592285],[-6.031681,54.593134],[-6.030356,54.593376],[-6.030227,54.594701],[-6.030681,54.595155],[-6.031353,54.594373],[-6.032681,54.594308],[-6.033438,54.593458],[-6.035143,54.593163],[-6.035488,54.592508],[-6.036841,54.592541],[-6.037926,54.593701],[-6.038046,54.597701],[-6.040438,54.599701],[-6.040055,54.600701],[-6.040681,54.600772],[-6.041219,54.600239],[-6.042681,54.600149],[-6.043681,54.600973],[-6.044411,54.600971],[-6.044681,54.601857],[-6.044758,54.600624],[-6.041405,54.596977],[-6.040513,54.594533],[-6.042681,54.594434],[-6.043681,54.595387],[-6.044681,54.595374],[-6.045681,54.594388],[-6.048681,54.597005],[-6.049681,54.596158],[-6.050681,54.596912],[-6.051353,54.594373],[-6.052681,54.594213],[-6.05319,54.594701],[-6.053087,54.596701],[-6.053681,54.596965],[-6.054304,54.596324],[-6.055017,54.596365],[-6.055681,54.597973],[-6.056778,54.597701],[-6.057027,54.596701],[-6.056229,54.595701],[-6.056681,54.595381],[-6.058681,54.595328],[-6.059681,54.596287],[-6.061024,54.596358],[-6.061481,54.597501],[-6.060901,54.597701],[-6.061681,54.597781],[-6.062681,54.597091],[-6.063681,54.597399],[-6.063939,54.596959],[-6.066414,54.596968],[-6.066532,54.59785],[-6.067473,54.598701],[-6.067124,54.599701],[-6.069681,54.599132],[-6.072681,54.601821],[-6.075224,54.602158],[-6.075681,54.602907],[-6.078488,54.602894],[-6.078681,54.604122],[-6.079853,54.603701],[-6.079129,54.602701],[-6.076681,54.602524],[-6.075828,54.601554],[-6.074681,54.601439],[-6.073881,54.600501],[-6.072253,54.600129],[-6.072885,54.597905],[-6.073823,54.597701],[-6.072681,54.597599],[-6.072307,54.598327],[-6.071681,54.598399],[-6.069308,54.598074],[-6.068182,54.596701],[-6.067274,54.591701],[-6.067681,54.591242],[-6.069903,54.590923],[-6.07022,54.58924],[-6.071362,54.587701],[-6.070681,54.587605],[-6.069681,54.588369],[-6.06821,54.586701],[-6.070319,54.584339],[-6.071957,54.583977],[-6.072681,54.583091],[-6.074681,54.583754],[-6.075857,54.582877],[-6.076939,54.582701],[-6.078681,54.58088],[-6.082412,54.580701],[-6.07896,54.580423],[-6.078681,54.579974],[-6.077192,54.581211],[-6.075438,54.581458],[-6.073681,54.582329],[-6.070095,54.582287],[-6.069681,54.58196],[-6.068082,54.582701],[-6.068463,54.583701],[-6.067681,54.585188],[-6.066851,54.583531],[-6.065923,54.583459],[-6.065681,54.583027],[-6.065298,54.583701],[-6.066322,54.584701],[-6.065978,54.586998],[-6.064295,54.587315],[-6.063944,54.588964],[-6.062681,54.589075],[-6.061681,54.590055],[-6.060681,54.590051],[-6.059681,54.589073],[-6.058421,54.588961],[-6.057681,54.587231],[-6.056417,54.587437],[-6.055681,54.588264],[-6.054681,54.587233],[-6.053031,54.587351],[-6.051681,54.586157],[-6.050397,54.585985],[-6.05007,54.585312],[-6.048421,54.584961],[-6.047322,54.583701],[-6.047394,54.582414],[-6.049681,54.582044],[-6.050234,54.581254],[-6.051628,54.580701],[-6.049681,54.580327],[-6.046681,54.578469],[-6.045681,54.579236],[-6.044681,54.577967],[-6.043681,54.578629],[-6.041507,54.576875],[-6.041183,54.575199],[-6.039463,54.573701],[-6.039473,54.571701],[-6.040247,54.571267],[-6.040522,54.569542],[-6.041681,54.570325],[-6.043889,54.569701],[-6.043681,54.567974],[-6.042681,54.569189],[-6.040437,54.566701],[-6.042138,54.565158],[-6.042483,54.563503],[-6.043473,54.562493],[-6.052681,54.562259],[-6.054356,54.563026],[-6.05584,54.562859],[-6.059777,54.560797],[-6.061715,54.557701],[-6.061709,54.556673],[-6.060681,54.557212],[-6.059137,54.559157],[-6.057581,54.559601],[-6.055681,54.561205],[-6.049681,54.561088],[-6.048126,54.559701],[-6.047946,54.557701],[-6.045255,54.554701],[-6.045681,54.554056],[-6.047681,54.554275],[-6.048539,54.553701],[-6.048789,54.552701],[-6.047368,54.551701],[-6.045681,54.551348],[-6.042438,54.551458],[-6.041692,54.551701],[-6.042214,54.552701],[-6.040681,54.552958],[-6.037681,54.552719],[-6.035681,54.553077],[-6.035227,54.552247],[-6.036594,54.551788],[-6.037681,54.552606],[-6.03882,54.55184],[-6.039457,54.550477],[-6.040681,54.550208],[-6.039745,54.547701],[-6.040238,54.547258],[-6.041075,54.547307],[-6.041681,54.54803],[-6.043435,54.547947],[-6.043681,54.548451],[-6.043788,54.547701],[-6.042867,54.546701],[-6.045374,54.544394],[-6.046681,54.544238],[-6.047681,54.545159],[-6.049117,54.545265],[-6.0495,54.545882],[-6.050681,54.546183],[-6.049888,54.544494],[-6.048681,54.544268],[-6.048186,54.543701],[-6.048681,54.543257],[-6.051681,54.543102],[-6.052681,54.541997],[-6.054712,54.541701],[-6.053231,54.541151],[-6.053279,54.540299],[-6.054681,54.539922],[-6.054681,54.538733],[-6.053221,54.538161],[-6.053094,54.537114],[-6.053825,54.536557],[-6.052755,54.535701],[-6.054091,54.535111],[-6.054681,54.53434],[-6.055681,54.53446],[-6.057626,54.532701],[-6.056591,54.532611],[-6.055681,54.533195],[-6.054681,54.532671],[-6.053681,54.532834],[-6.052681,54.534424],[-6.050134,54.533701],[-6.049681,54.532955],[-6.049453,54.533473],[-6.047602,54.533622],[-6.047043,54.535063],[-6.044681,54.535259],[-6.043562,54.533701],[-6.044028,54.532701],[-6.042136,54.531701],[-6.043496,54.528701],[-6.043206,54.527701],[-6.041711,54.527671],[-6.041681,54.526845],[-6.04153,54.52755],[-6.039681,54.528999],[-6.039618,54.529764],[-6.040681,54.530011],[-6.041183,54.530701],[-6.039946,54.531701],[-6.039838,54.532858],[-6.038681,54.531709],[-6.037557,54.531576],[-6.036304,54.533701],[-6.037412,54.535701],[-6.035893,54.537913],[-6.033681,54.537996],[-6.032681,54.538983],[-6.030358,54.536701],[-6.030681,54.535358],[-6.032681,54.535273],[-6.033681,54.534203],[-6.035404,54.533701],[-6.034681,54.533243],[-6.031446,54.532936],[-6.032189,54.531701],[-6.031546,54.530701],[-6.031681,54.530234],[-6.032681,54.529897],[-6.035078,54.530098],[-6.036178,54.527701],[-6.0339,54.526482],[-6.034432,54.524701],[-6.03296,54.523422],[-6.032681,54.522125],[-6.031525,54.522701],[-6.030762,54.52162],[-6.031134,54.520154],[-6.034681,54.51999],[-6.035681,54.518922],[-6.036681,54.51904],[-6.037435,54.520455],[-6.037354,54.521374],[-6.036722,54.521701],[-6.037603,54.522701],[-6.038117,54.522701],[-6.039804,54.518701],[-6.039042,54.517701],[-6.039387,54.516701],[-6.037348,54.516034],[-6.037681,54.515246],[-6.041937,54.514957],[-6.042681,54.514075],[-6.043349,54.514701],[-6.043681,54.516563],[-6.04381,54.51583],[-6.045486,54.515896],[-6.046035,54.517055],[-6.046681,54.516952],[-6.04663,54.51565],[-6.049009,54.515029],[-6.051154,54.515228],[-6.052325,54.516057],[-6.054681,54.515985],[-6.05514,54.514701],[-6.053067,54.513315],[-6.05318,54.512199],[-6.054744,54.511764],[-6.056323,54.512059],[-6.056681,54.512712],[-6.057681,54.511428],[-6.059107,54.511127],[-6.060681,54.51014],[-6.061206,54.509226],[-6.062489,54.508893],[-6.062681,54.509212],[-6.063382,54.508701],[-6.059681,54.507783],[-6.058681,54.508009],[-6.058556,54.506701],[-6.057878,54.506504],[-6.057681,54.50593],[-6.056681,54.507189],[-6.054681,54.507069],[-6.054316,54.508336],[-6.053681,54.508632],[-6.051619,54.507763],[-6.051817,54.506565],[-6.05021,54.50623],[-6.049547,54.506835],[-6.050681,54.505138],[-6.052681,54.50522],[-6.054777,54.504701],[-6.053681,54.503445],[-6.0523,54.503319],[-6.051592,54.50379],[-6.051994,54.501701],[-6.051229,54.500701],[-6.054415,54.497435],[-6.058681,54.497274],[-6.059681,54.496808],[-6.060681,54.498012],[-6.061976,54.497996],[-6.063681,54.497367],[-6.065681,54.498174],[-6.066285,54.497305],[-6.067681,54.497098],[-6.069681,54.499069],[-6.070681,54.498],[-6.075178,54.497701],[-6.072681,54.497271],[-6.069681,54.497378],[-6.068928,54.496454],[-6.067244,54.496138],[-6.066681,54.495441],[-6.0661,54.49612],[-6.065298,54.496084],[-6.064681,54.495135],[-6.063687,54.494701],[-6.066488,54.494508],[-6.067681,54.493437],[-6.071681,54.493425],[-6.075681,54.494215],[-6.076478,54.492498],[-6.078681,54.492402],[-6.079681,54.491397],[-6.081681,54.491389],[-6.082681,54.490384],[-6.084133,54.490153],[-6.08546,54.48848],[-6.086681,54.488358],[-6.088445,54.486465],[-6.090105,54.486125],[-6.090436,54.485456],[-6.091888,54.484908],[-6.0922,54.48422],[-6.093825,54.483845],[-6.094077,54.483097],[-6.097681,54.482874],[-6.097961,54.481981],[-6.098681,54.481839],[-6.101681,54.481813],[-6.103681,54.482226],[-6.103681,54.481176],[-6.100681,54.481147],[-6.100423,54.481443],[-6.097681,54.481507],[-6.096681,54.482495],[-6.093681,54.482446],[-6.093159,54.483179],[-6.091467,54.483487],[-6.090681,54.484367],[-6.089407,54.484426],[-6.088681,54.48534],[-6.087251,54.485271],[-6.086052,54.487072],[-6.084345,54.487365],[-6.082965,54.488985],[-6.081681,54.489013],[-6.080681,54.490033],[-6.077681,54.489928],[-6.076681,54.490993],[-6.072681,54.490997],[-6.071681,54.490018],[-6.070454,54.489928],[-6.070681,54.48912],[-6.074673,54.488709],[-6.074702,54.489701],[-6.074683,54.488699],[-6.071294,54.488088],[-6.070929,54.486453],[-6.067681,54.487137],[-6.067433,54.485453],[-6.068092,54.485112],[-6.068642,54.483661],[-6.071794,54.482814],[-6.069787,54.481701],[-6.070681,54.481149],[-6.072785,54.480805],[-6.071203,54.479701],[-6.072432,54.477452],[-6.073998,54.477384],[-6.074681,54.478107],[-6.075122,54.477142],[-6.077001,54.476701],[-6.07595,54.476432],[-6.075236,54.475701],[-6.076212,54.474232],[-6.079681,54.472827],[-6.079738,54.471758],[-6.082123,54.471701],[-6.079785,54.470597],[-6.077681,54.471101],[-6.076142,54.473162],[-6.074448,54.473468],[-6.07205,54.47607],[-6.067571,54.476591],[-6.067534,54.476848],[-6.070061,54.477321],[-6.070165,54.478701],[-6.068307,54.480327],[-6.066936,54.483955],[-6.066371,54.484011],[-6.065681,54.483305],[-6.063879,54.483701],[-6.06506,54.484322],[-6.06604,54.485701],[-6.064908,54.486928],[-6.063266,54.487286],[-6.061927,54.488947],[-6.059681,54.488552],[-6.057681,54.489916],[-6.056681,54.489667],[-6.055397,54.490417],[-6.055033,54.492053],[-6.054089,54.493109],[-6.052681,54.493129],[-6.052004,54.491378],[-6.051129,54.490701],[-6.051016,54.488701],[-6.050137,54.488245],[-6.048681,54.485959],[-6.048525,54.489701],[-6.046467,54.490701],[-6.048681,54.491545],[-6.049681,54.491077],[-6.050057,54.491325],[-6.050049,54.492069],[-6.049222,54.492701],[-6.049594,54.494701],[-6.046681,54.494915],[-6.045681,54.495913],[-6.043681,54.495909],[-6.042681,54.496907],[-6.040681,54.496904],[-6.039681,54.4979],[-6.038124,54.498144],[-6.03681,54.49983],[-6.035063,54.500083],[-6.034681,54.50089],[-6.033478,54.500904],[-6.032681,54.50016],[-6.03194,54.50096],[-6.031192,54.500701],[-6.030418,54.498438],[-6.034012,54.497701],[-6.032985,54.496701],[-6.033713,54.495701],[-6.032218,54.495164],[-6.031681,54.493982],[-6.030329,54.494053],[-6.028932,54.49245],[-6.02722,54.492162],[-6.025681,54.489634],[-6.025319,54.491338],[-6.024203,54.491701],[-6.025681,54.491923],[-6.026488,54.492894],[-6.028093,54.493289],[-6.028555,54.494827],[-6.029681,54.495042],[-6.03028,54.495701],[-6.029681,54.496309],[-6.027111,54.496271],[-6.024681,54.495356],[-6.024802,54.496701],[-6.026681,54.497081],[-6.02799,54.498392],[-6.027681,54.501937],[-6.026539,54.501843],[-6.024209,54.498173],[-6.022121,54.496261],[-6.02047,54.495912],[-6.018681,54.494155],[-6.017911,54.494931],[-6.016681,54.495021],[-6.015681,54.49404],[-6.013433,54.493949],[-6.012681,54.493083],[-6.010681,54.49311],[-6.009681,54.492152],[-6.007681,54.49218],[-6.006603,54.489623],[-6.006136,54.491156],[-6.00508,54.4921],[-6.003681,54.492282],[-6.002681,54.491369],[-6.001185,54.491197],[-5.999681,54.489672],[-5.998777,54.489797],[-5.998708,54.490701],[-6.002681,54.49393],[-6.004681,54.494402],[-6.005681,54.493177],[-6.008681,54.493242],[-6.008681,54.494983],[-6.010681,54.495209],[-6.011681,54.494306],[-6.012265,54.495117],[-6.014681,54.495352],[-6.015237,54.496145],[-6.016681,54.496381],[-6.017226,54.497156],[-6.01888,54.497502],[-6.019681,54.49839],[-6.021854,54.498528],[-6.022859,54.499879],[-6.021681,54.500974],[-6.019681,54.501018],[-6.018681,54.501999],[-6.015791,54.499591],[-6.01334,54.500042],[-6.012968,54.499414],[-6.010991,54.498391],[-6.010681,54.497712],[-6.009681,54.49851],[-6.009737,54.499757],[-6.008914,54.499468],[-6.007574,54.499701],[-6.007976,54.500701],[-6.010093,54.501289],[-6.010163,54.502183],[-6.009305,54.502701],[-6.010681,54.502914],[-6.011681,54.502184],[-6.013681,54.502267],[-6.014681,54.503169],[-6.016911,54.503471],[-6.017342,54.50504],[-6.01988,54.505502],[-6.01902,54.506701],[-6.019988,54.507701],[-6.017681,54.507985],[-6.016681,54.50899],[-6.014681,54.509006],[-6.013031,54.507351],[-6.011681,54.507144],[-6.010681,54.50904],[-6.007342,54.50904],[-6.006681,54.508297],[-6.006021,54.509041],[-6.002681,54.509137],[-6.001681,54.510156],[-5.998293,54.510089],[-5.998137,54.508701],[-5.997518,54.508538],[-5.997054,54.511074],[-5.995404,54.511424],[-5.994681,54.512324],[-5.993681,54.512224],[-5.993308,54.513328],[-5.991865,54.513701],[-5.993271,54.514111],[-5.993436,54.514701],[-5.993325,54.515345],[-5.991519,54.515701],[-5.991235,54.516701],[-5.991719,54.516739],[-5.99211,54.51613],[-5.99379,54.51581],[-5.995545,54.513565],[-5.997288,54.512308],[-5.998091,54.512291],[-5.998756,54.512776],[-5.999681,54.511214],[-6.000604,54.512778],[-6.002168,54.513214],[-6.002681,54.514464],[-6.002681,54.511632],[-6.003268,54.512114],[-6.00558,54.5116],[-6.010681,54.51131],[-6.012223,54.512701],[-6.009157,54.515177],[-6.008934,54.515954],[-6.006972,54.516992],[-6.006898,54.518701],[-6.006093,54.519113],[-6.005775,54.520795],[-6.00496,54.52098],[-6.00394,54.52296],[-6.002004,54.524024],[-6.001127,54.525147],[-6.000812,54.527701],[-5.999941,54.527961],[-5.999767,54.529787],[-5.998936,54.529956],[-5.998681,54.531393],[-5.997681,54.531855],[-5.995681,54.53021],[-5.994681,54.530806],[-5.994887,54.529701],[-5.993474,54.529494],[-5.992084,54.530701],[-5.991973,54.532993],[-5.987681,54.533073],[-5.986801,54.529581],[-5.9848,54.528582],[-5.981319,54.528063],[-5.980935,54.526447],[-5.980241,54.526141],[-5.979681,54.524858],[-5.978681,54.523898],[-5.977405,54.523701],[-5.977134,54.524701],[-5.979344,54.526701],[-5.978617,54.528701],[-5.979317,54.529065],[-5.979618,54.530764],[-5.981681,54.531245],[-5.982137,54.531701],[-5.982223,54.532701],[-5.980967,54.533987],[-5.980289,54.534093],[-5.979681,54.533531],[-5.978424,54.534701],[-5.979681,54.536101],[-5.980681,54.536152],[-5.981681,54.535318],[-5.981973,54.536701],[-5.980681,54.538002],[-5.977681,54.538095],[-5.976681,54.537085],[-5.975977,54.536997],[-5.973867,54.537701],[-5.975681,54.538128],[-5.976681,54.539216],[-5.979871,54.539511],[-5.976681,54.542935],[-5.974681,54.542945],[-5.973681,54.541965],[-5.967294,54.542314],[-5.968261,54.545121],[-5.968998,54.545701],[-5.968983,54.547003],[-5.967337,54.548357],[-5.968033,54.549701],[-5.966892,54.550701],[-5.966866,54.552701],[-5.966032,54.553052],[-5.965681,54.553868],[-5.965143,54.552701],[-5.965768,54.551614],[-5.964556,54.551576],[-5.963681,54.553006],[-5.96251,54.552872],[-5.961681,54.551991],[-5.958681,54.551923],[-5.957104,54.553124],[-5.956853,54.553873],[-5.956358,54.552024],[-5.953523,54.551701],[-5.953507,54.548701],[-5.954295,54.548315],[-5.954551,54.547571],[-5.956681,54.547491],[-5.957681,54.548462],[-5.958681,54.547476],[-5.961198,54.547218],[-5.963166,54.545186],[-5.963445,54.543465],[-5.966024,54.543044],[-5.965055,54.541327],[-5.963409,54.540973],[-5.961681,54.539276],[-5.959681,54.539258],[-5.958402,54.540422],[-5.958402,54.54098],[-5.960681,54.541205],[-5.961108,54.541701],[-5.961026,54.542701],[-5.959681,54.544031],[-5.953681,54.543979],[-5.952681,54.542056],[-5.951903,54.542923],[-5.950681,54.543016],[-5.949681,54.543942],[-5.948371,54.542701],[-5.948995,54.540387],[-5.947299,54.540083],[-5.94829,54.538701],[-5.947443,54.537463],[-5.949054,54.537074],[-5.949681,54.536148],[-5.950681,54.536864],[-5.951312,54.536701],[-5.951233,54.535253],[-5.953484,54.534701],[-5.952681,54.5345],[-5.9521,54.533701],[-5.953376,54.532396],[-5.954681,54.532205],[-5.955339,54.531359],[-5.956869,54.530889],[-5.956292,54.529312],[-5.958681,54.527988],[-5.961681,54.52782],[-5.961907,54.526927],[-5.963376,54.526701],[-5.961681,54.526452],[-5.961419,54.527439],[-5.959681,54.527469],[-5.957681,54.525528],[-5.955681,54.527016],[-5.955081,54.529101],[-5.954067,54.530087],[-5.951681,54.530464],[-5.951976,54.531996],[-5.949681,54.532153],[-5.948681,54.533081],[-5.946076,54.533096],[-5.943377,54.531005],[-5.943,54.529382],[-5.941681,54.527957],[-5.94102,54.527362],[-5.939185,54.527197],[-5.937681,54.525475],[-5.93757,54.526701],[-5.938297,54.527085],[-5.938463,54.527919],[-5.939681,54.529172],[-5.940681,54.529083],[-5.942023,54.530359],[-5.942318,54.532064],[-5.944057,54.533701],[-5.943931,54.534951],[-5.941681,54.535112],[-5.940681,54.534393],[-5.938744,54.534701],[-5.940111,54.535271],[-5.939988,54.536008],[-5.936388,54.536408],[-5.937071,54.537701],[-5.935681,54.539052],[-5.931681,54.539056],[-5.930405,54.537977],[-5.929681,54.536435],[-5.928495,54.536515],[-5.927681,54.537193],[-5.92595,54.535432],[-5.922858,54.535524],[-5.922681,54.535176],[-5.922681,54.535789],[-5.925142,54.53624],[-5.926681,54.538159],[-5.928974,54.538408],[-5.92882,54.540562],[-5.93016,54.541222],[-5.930278,54.541701],[-5.929681,54.54395],[-5.927681,54.54197],[-5.926226,54.542246],[-5.925681,54.543982],[-5.922446,54.543936],[-5.921997,54.542701],[-5.922714,54.541701],[-5.921681,54.541623],[-5.92158,54.5426],[-5.92061,54.54263],[-5.919681,54.544036],[-5.918681,54.543058],[-5.917681,54.543063],[-5.916815,54.542567],[-5.912865,54.542517],[-5.912681,54.542239],[-5.910681,54.543202],[-5.908618,54.543638],[-5.909064,54.545084],[-5.906681,54.546162],[-5.904158,54.546224],[-5.903509,54.544701],[-5.903157,54.547225],[-5.904149,54.548701],[-5.903246,54.550701],[-5.905681,54.551013],[-5.905681,54.553004],[-5.904549,54.553569],[-5.903165,54.553217],[-5.902825,54.552557],[-5.900681,54.552317],[-5.899681,54.553446],[-5.892436,54.555701],[-5.892592,54.55679],[-5.894681,54.557576],[-5.895681,54.557311],[-5.898216,54.559701],[-5.89933,54.560052],[-5.900141,54.561241],[-5.899958,54.561978],[-5.899401,54.561981],[-5.898681,54.561186],[-5.893681,54.561215],[-5.892403,54.561423],[-5.891681,54.562315],[-5.890681,54.562367],[-5.889928,54.561701],[-5.889842,54.560862],[-5.890439,54.560701],[-5.889789,54.560593],[-5.887495,54.562701],[-5.89126,54.563122],[-5.892681,54.563683],[-5.893681,54.56344],[-5.894311,54.562331],[-5.895681,54.562221],[-5.896123,54.563143],[-5.894774,54.563701],[-5.897009,54.564029],[-5.897325,54.563345],[-5.900681,54.563327],[-5.900681,54.564131],[-5.897294,54.564314],[-5.896681,54.565353],[-5.8934,54.56642],[-5.893681,54.568376],[-5.890681,54.568893],[-5.888611,54.567701],[-5.887056,54.567326],[-5.886681,54.566073],[-5.88646,54.56748],[-5.887162,54.56822],[-5.88732,54.569701],[-5.885681,54.57119],[-5.884681,54.570499],[-5.882681,54.571787],[-5.881681,54.571604],[-5.879681,54.572605],[-5.876681,54.572605],[-5.876293,54.573313],[-5.875681,54.573301],[-5.873511,54.571871],[-5.873421,54.570961],[-5.872681,54.570385],[-5.871305,54.571324],[-5.868681,54.571593],[-5.867746,54.572766],[-5.866681,54.57286],[-5.865451,54.571931],[-5.865227,54.570701],[-5.866205,54.569701],[-5.866342,54.568362],[-5.869681,54.56782],[-5.870082,54.567102],[-5.872658,54.566701],[-5.870681,54.566018],[-5.869681,54.566458],[-5.866681,54.56624],[-5.865681,54.565272],[-5.864282,54.5651],[-5.862459,54.563479],[-5.856853,54.563529],[-5.856738,54.562644],[-5.855823,54.562559],[-5.855681,54.561459],[-5.855018,54.561364],[-5.854747,54.560635],[-5.853697,54.560701],[-5.854557,54.560825],[-5.854681,54.562015],[-5.85518,54.562701],[-5.85629,54.563092],[-5.856681,54.563923],[-5.858681,54.563983],[-5.859681,54.565014],[-5.863092,54.56529],[-5.862681,54.566375],[-5.860681,54.566659],[-5.860356,54.567376],[-5.858421,54.567701],[-5.859681,54.568063],[-5.862681,54.567859],[-5.863681,54.567062],[-5.865171,54.568701],[-5.864329,54.569349],[-5.863989,54.571009],[-5.862468,54.571488],[-5.861681,54.572457],[-5.860388,54.572701],[-5.860922,54.573942],[-5.859681,54.574697],[-5.858922,54.575942],[-5.857681,54.576313],[-5.856681,54.575615],[-5.854681,54.576442],[-5.853681,54.576176],[-5.850905,54.577701],[-5.853615,54.577767],[-5.854681,54.576982],[-5.859525,54.577857],[-5.860585,54.578797],[-5.860568,54.579814],[-5.863044,54.580338],[-5.862958,54.583978],[-5.862369,54.584013],[-5.861681,54.583253],[-5.860681,54.583256],[-5.859681,54.583284],[-5.858681,54.584011],[-5.857063,54.582319],[-5.855681,54.582153],[-5.854681,54.583143],[-5.850793,54.583701],[-5.850681,54.584915],[-5.850119,54.584263],[-5.848222,54.58416],[-5.846681,54.58334],[-5.844681,54.585313],[-5.843681,54.584189],[-5.842313,54.584069],[-5.841671,54.582701],[-5.841978,54.581404],[-5.840553,54.581573],[-5.839681,54.58216],[-5.835681,54.5815],[-5.837369,54.583701],[-5.840921,54.584461],[-5.840597,54.585785],[-5.843057,54.586324],[-5.842681,54.587281],[-5.836681,54.587299],[-5.835681,54.58685],[-5.834912,54.587932],[-5.834113,54.588133],[-5.830933,54.588449],[-5.829681,54.587838],[-5.828337,54.588701],[-5.834876,54.589506],[-5.835804,54.590824],[-5.831261,54.591701],[-5.830681,54.592925],[-5.829903,54.592479],[-5.828681,54.592553],[-5.827681,54.591803],[-5.824395,54.592415],[-5.822681,54.593399],[-5.820681,54.593595],[-5.820332,54.594352],[-5.819681,54.594538],[-5.818877,54.594505],[-5.818681,54.593849],[-5.817723,54.594701],[-5.822367,54.595015],[-5.823681,54.594039],[-5.824862,54.595882],[-5.826681,54.594888],[-5.829681,54.595207],[-5.830681,54.59729],[-5.831438,54.596701],[-5.831099,54.595701],[-5.831681,54.595241],[-5.833681,54.595295],[-5.834681,54.596163],[-5.835681,54.596201],[-5.836681,54.595333],[-5.838681,54.595354],[-5.840681,54.59632],[-5.841681,54.59538],[-5.842895,54.595487],[-5.8421,54.596701],[-5.842009,54.599029],[-5.840385,54.599405],[-5.838681,54.601076],[-5.83827,54.60229],[-5.837462,54.602701],[-5.838948,54.604968],[-5.835681,54.60513],[-5.834681,54.607175],[-5.829846,54.607701],[-5.832086,54.608296],[-5.831096,54.610116],[-5.830681,54.610343],[-5.829681,54.609889],[-5.828681,54.610296],[-5.827681,54.611518],[-5.825376,54.611701],[-5.825681,54.611976],[-5.828681,54.611931],[-5.829681,54.610996],[-5.830681,54.611732],[-5.831203,54.611223],[-5.833152,54.610701],[-5.833318,54.609338],[-5.834681,54.609191],[-5.835681,54.608235],[-5.836825,54.608845],[-5.837681,54.60722],[-5.844681,54.607389],[-5.846945,54.609437],[-5.84693,54.60995],[-5.845681,54.611001],[-5.843681,54.61104],[-5.843129,54.610701],[-5.843988,54.609701],[-5.843681,54.609132],[-5.841911,54.608471],[-5.840493,54.608513],[-5.839764,54.613701],[-5.840807,54.613827],[-5.841681,54.612303],[-5.844681,54.612381],[-5.844877,54.612897],[-5.843247,54.613267],[-5.842313,54.614333],[-5.842433,54.614949],[-5.845681,54.615366],[-5.846489,54.614509],[-5.847681,54.614461],[-5.848817,54.615565],[-5.848862,54.616701],[-5.848045,54.617065],[-5.847805,54.618825],[-5.846058,54.619078],[-5.845808,54.619828],[-5.844088,54.620107],[-5.843816,54.621836],[-5.842105,54.622125],[-5.841681,54.622916],[-5.839182,54.623202],[-5.836681,54.626263],[-5.83546,54.62648],[-5.835283,54.627701],[-5.83462,54.627762],[-5.833681,54.627183],[-5.832355,54.627374],[-5.833294,54.629088],[-5.835681,54.629353],[-5.835681,54.629971],[-5.834201,54.630221],[-5.833681,54.630995],[-5.831681,54.631037],[-5.830681,54.63008],[-5.829292,54.630312],[-5.828075,54.632095],[-5.826589,54.632701],[-5.828052,54.63333],[-5.827973,54.633993],[-5.826344,54.634364],[-5.825066,54.636086],[-5.824276,54.636106],[-5.820681,54.634295],[-5.819048,54.634334],[-5.818681,54.633517],[-5.817472,54.633492],[-5.818511,54.633871],[-5.818561,54.634821],[-5.820374,54.637008],[-5.824013,54.637369],[-5.824238,54.639701],[-5.823681,54.640575],[-5.822681,54.639639],[-5.821012,54.63937],[-5.818681,54.637853],[-5.813681,54.6382],[-5.813304,54.639701],[-5.814871,54.639891],[-5.815887,54.639495],[-5.815527,54.640855],[-5.816633,54.642749],[-5.816462,54.643701],[-5.814681,54.644759],[-5.812681,54.644367],[-5.811681,54.645048],[-5.809681,54.643952],[-5.808681,54.645348],[-5.807058,54.645324],[-5.8058,54.644582],[-5.804681,54.644614],[-5.804587,54.645607],[-5.803654,54.645701],[-5.80641,54.645972],[-5.807436,54.646701],[-5.807482,54.647701],[-5.806126,54.649146],[-5.804681,54.65036],[-5.802681,54.650343],[-5.800406,54.651426],[-5.798432,54.651701],[-5.798342,54.652362],[-5.796944,54.652701],[-5.799643,54.652701],[-5.80238,54.6514],[-5.805681,54.652208],[-5.806681,54.651187],[-5.807681,54.651089],[-5.809681,54.649171],[-5.811798,54.649584],[-5.812535,54.650847],[-5.813226,54.650701],[-5.813681,54.64955],[-5.815681,54.650164],[-5.817027,54.650047],[-5.817608,54.649701],[-5.817038,54.648701],[-5.817681,54.64813],[-5.818681,54.64959],[-5.819681,54.648973],[-5.82089,54.649492],[-5.82236,54.648701],[-5.822307,54.647701],[-5.82119,54.647192],[-5.820533,54.645553],[-5.82176,54.645622],[-5.824388,54.647994],[-5.825681,54.648115],[-5.826341,54.647361],[-5.828034,54.647054],[-5.828456,54.645476],[-5.831681,54.645421],[-5.832681,54.644428],[-5.835681,54.644441],[-5.836681,54.643449],[-5.839151,54.643171],[-5.839681,54.642384],[-5.841681,54.642336],[-5.842681,54.641305],[-5.846681,54.641057],[-5.847817,54.639701],[-5.847393,54.638989],[-5.845681,54.638364],[-5.844681,54.639376],[-5.84397,54.638701],[-5.847392,54.634412],[-5.849073,54.634093],[-5.848551,54.632571],[-5.849474,54.631701],[-5.84956,54.63058],[-5.850323,54.630343],[-5.851681,54.628528],[-5.852888,54.628494],[-5.852959,54.630701],[-5.854997,54.633385],[-5.856681,54.633988],[-5.860681,54.634142],[-5.861681,54.63519],[-5.866681,54.635292],[-5.867416,54.634436],[-5.869098,54.634118],[-5.871681,54.6314],[-5.872681,54.632348],[-5.874681,54.632263],[-5.875055,54.631327],[-5.873384,54.630701],[-5.874681,54.629438],[-5.878681,54.629377],[-5.879681,54.630333],[-5.880313,54.629701],[-5.880102,54.62828],[-5.877435,54.627701],[-5.878528,54.626548],[-5.880237,54.626257],[-5.880681,54.625492],[-5.881681,54.626456],[-5.884162,54.626182],[-5.884162,54.62522],[-5.88245,54.624701],[-5.88519,54.62421],[-5.885435,54.623701],[-5.884489,54.622701],[-5.885308,54.622328],[-5.8855,54.620701],[-5.887322,54.619342],[-5.888489,54.617701],[-5.888349,54.615033],[-5.887527,54.614701],[-5.887584,54.612604],[-5.888793,54.612589],[-5.88903,54.613352],[-5.889681,54.613527],[-5.892217,54.613237],[-5.892471,54.610701],[-5.893668,54.608688],[-5.895681,54.608852],[-5.896271,54.608291],[-5.898363,54.607701],[-5.897858,54.605701],[-5.903609,54.605629],[-5.903681,54.604586],[-5.905796,54.604701],[-5.904893,54.604913],[-5.904681,54.605714],[-5.902859,54.605879],[-5.902765,54.606785],[-5.899963,54.607983],[-5.899681,54.60885],[-5.898202,54.609222],[-5.895804,54.611824],[-5.894057,54.612077],[-5.892826,54.613846],[-5.891099,54.614119],[-5.890834,54.615854],[-5.890151,54.616171],[-5.88986,54.61788],[-5.888969,54.618701],[-5.890936,54.620701],[-5.890013,54.621701],[-5.890681,54.623355],[-5.891466,54.622486],[-5.892681,54.622434],[-5.894214,54.621234],[-5.894474,54.619701],[-5.895316,54.619336],[-5.895514,54.617701],[-5.896364,54.617384],[-5.896578,54.616598],[-5.900353,54.616373],[-5.901681,54.614485],[-5.904376,54.614396],[-5.90459,54.61261],[-5.907367,54.612387],[-5.907601,54.609621],[-5.907947,54.610435],[-5.908681,54.610568],[-5.909415,54.610435],[-5.909681,54.609564],[-5.911424,54.609444],[-5.911573,54.605701],[-5.912471,54.605491],[-5.912612,54.604632],[-5.912902,54.60548],[-5.916681,54.605578],[-5.917435,54.605455],[-5.918607,54.603627],[-5.919681,54.603607],[-5.918906,54.603926],[-5.918754,54.605774],[-5.915921,54.605941],[-5.914757,54.607777],[-5.912912,54.607932],[-5.912757,54.608777],[-5.911909,54.608929],[-5.91176,54.60978],[-5.910924,54.609944],[-5.910766,54.610786],[-5.90994,54.61096],[-5.90994,54.612442],[-5.910847,54.612701],[-5.910791,54.613811],[-5.909047,54.614067],[-5.908681,54.614893],[-5.906129,54.615149],[-5.90486,54.61688],[-5.903255,54.617275],[-5.903057,54.619078],[-5.901338,54.619358],[-5.900332,54.620701],[-5.900402,54.621701],[-5.901976,54.620996],[-5.903304,54.619325],[-5.905134,54.619154],[-5.906681,54.617471],[-5.907173,54.619209],[-5.908681,54.619447],[-5.91027,54.61829],[-5.910553,54.617573],[-5.911318,54.617338],[-5.911565,54.616585],[-5.91336,54.61638],[-5.914681,54.614566],[-5.914809,54.615701],[-5.913942,54.615962],[-5.91377,54.61679],[-5.911961,54.616981],[-5.911777,54.617797],[-5.910977,54.617997],[-5.909681,54.619846],[-5.906681,54.619872],[-5.906023,54.620043],[-5.905681,54.620879],[-5.904054,54.621074],[-5.903001,54.622701],[-5.902925,54.624701],[-5.901818,54.625838],[-5.900508,54.624874],[-5.900235,54.623147],[-5.899681,54.622924],[-5.898681,54.623911],[-5.897087,54.624107],[-5.896813,54.624833],[-5.895055,54.625075],[-5.894803,54.625823],[-5.893201,54.626221],[-5.892681,54.626921],[-5.890681,54.626967],[-5.889825,54.627845],[-5.888088,54.628108],[-5.886831,54.629851],[-5.885186,54.630206],[-5.877199,54.638701],[-5.877681,54.640211],[-5.881681,54.640333],[-5.882477,54.639497],[-5.884153,54.639173],[-5.884521,54.637541],[-5.886205,54.637225],[-5.887535,54.635555],[-5.888681,54.636378],[-5.889681,54.635493],[-5.891681,54.635451],[-5.892532,54.634552],[-5.894283,54.634303],[-5.894555,54.633574],[-5.89633,54.63335],[-5.896681,54.632533],[-5.89835,54.63237],[-5.899681,54.63055],[-5.905681,54.630559],[-5.904891,54.631701],[-5.905915,54.632701],[-5.905853,54.634873],[-5.900303,54.635323],[-5.899353,54.636701],[-5.899681,54.638327],[-5.900255,54.637275],[-5.901681,54.636309],[-5.907681,54.636462],[-5.908531,54.635551],[-5.91029,54.63531],[-5.910557,54.634577],[-5.911324,54.634344],[-5.911577,54.632597],[-5.912384,54.632404],[-5.912681,54.630569],[-5.917763,54.630619],[-5.9177670000000008,54.638787],[-5.917019,54.639039],[-5.916767,54.640787],[-5.916011,54.641031],[-5.915029,54.643049],[-5.913842,54.643701],[-5.913763,54.646783],[-5.912928,54.646948],[-5.912764,54.647784],[-5.911931,54.647951],[-5.911765,54.648785],[-5.910933,54.648953],[-5.910766,54.649786],[-5.909936,54.649956],[-5.909766,54.650786],[-5.908938,54.650958],[-5.907768,54.652788],[-5.90602,54.65304],[-5.90477,54.65479],[-5.90395,54.65497],[-5.903776,54.655796],[-5.903007,54.656027],[-5.902777,54.657797],[-5.901999,54.658019],[-5.901795,54.659815],[-5.90089,54.660701],[-5.900907,54.664701],[-5.900119,54.665139],[-5.899819,54.666839],[-5.899111,54.66713],[-5.898865,54.669701],[-5.898069,54.670089],[-5.897808,54.671828],[-5.896197,54.672217],[-5.893816,54.674836],[-5.8920959999999999,54.675116],[-5.891681,54.675912],[-5.890109,54.676129],[-5.888835,54.677855],[-5.887132,54.678152],[-5.88585,54.67987],[-5.882681,54.67999],[-5.879863,54.682883],[-5.877681,54.683029],[-5.876681,54.684558],[-5.874143,54.685163],[-5.870965,54.686985],[-5.869388,54.687408],[-5.868973,54.687992],[-5.867407,54.688427],[-5.865987,54.690007],[-5.864341,54.690361],[-5.864015,54.691035],[-5.862541,54.691561],[-5.862283,54.693303],[-5.860604,54.694624],[-5.860481,54.696501],[-5.859647,54.696667],[-5.859625,54.697645],[-5.858742,54.697701],[-5.859738,54.697758],[-5.859979,54.696999],[-5.860809,54.696829],[-5.861219,54.695239],[-5.862681,54.694876],[-5.864288,54.695094],[-5.865681,54.696289],[-5.868209,54.696701],[-5.867218,54.694701],[-5.865313,54.694069],[-5.865265,54.693285],[-5.866215,54.692235],[-5.867681,54.691985],[-5.868681,54.691129],[-5.871681,54.69194],[-5.873106,54.691701],[-5.873606,54.690626],[-5.875681,54.690978],[-5.877496,54.690701],[-5.876189,54.690193],[-5.875894,54.689488],[-5.874325,54.689057],[-5.874681,54.68819],[-5.876681,54.688211],[-5.877311,54.687331],[-5.878681,54.687358],[-5.879681,54.686558],[-5.881508,54.686528],[-5.881681,54.685967],[-5.882681,54.686182],[-5.883681,54.685812],[-5.884681,54.687163],[-5.886626,54.687756],[-5.892681,54.688208],[-5.893112,54.689132],[-5.891573,54.689593],[-5.891681,54.690483],[-5.891796,54.689816],[-5.893428,54.689954],[-5.893665,54.690717],[-5.894681,54.690777],[-5.897681,54.690046],[-5.898681,54.69072],[-5.901364,54.690018],[-5.904681,54.690428],[-5.906681,54.689958],[-5.907681,54.690249],[-5.907715,54.689735],[-5.908298,54.689701],[-5.905919,54.689463],[-5.90571,54.688672],[-5.904923,54.688459],[-5.902681,54.686469],[-5.900681,54.686273],[-5.899831,54.685551],[-5.898003,54.685379],[-5.898042,54.684062],[-5.898899,54.683701],[-5.89926,54.68028],[-5.901681,54.680427],[-5.902681,54.679445],[-5.903681,54.68138],[-5.904681,54.681373],[-5.905872,54.68051],[-5.907016,54.681701],[-5.907272,54.68311],[-5.908681,54.683952],[-5.909937,54.683957],[-5.911681,54.682349],[-5.912133,54.682701],[-5.91161,54.683772],[-5.912681,54.684889],[-5.913759,54.684779],[-5.915119,54.684139],[-5.915681,54.682823],[-5.916428,54.682954],[-5.916222,54.684242],[-5.915301,54.684321],[-5.915085,54.684701],[-5.916584,54.685798],[-5.917681,54.686016],[-5.91822,54.686701],[-5.916681,54.688411],[-5.915512,54.688701],[-5.915722,54.68966],[-5.91705,54.690332],[-5.917681,54.691625],[-5.919808,54.688828],[-5.919087,54.687701],[-5.920681,54.686196],[-5.921681,54.686984],[-5.923102,54.68728],[-5.924681,54.689155],[-5.926565,54.688817],[-5.926733,54.689701],[-5.926529,54.687853],[-5.924305,54.687077],[-5.9237,54.684701],[-5.924242,54.683701],[-5.922681,54.683396],[-5.922026,54.682701],[-5.923187,54.681701],[-5.922156,54.680701],[-5.922967,54.679416],[-5.921383,54.678999],[-5.920318,54.677701],[-5.920427,54.676447],[-5.921087,54.676107],[-5.921465,54.674485],[-5.92214,54.67416],[-5.922493,54.672513],[-5.923681,54.67141],[-5.927681,54.671344],[-5.929681,54.669032],[-5.936681,54.669263],[-5.937681,54.670476],[-5.940344,54.671038],[-5.940681,54.671657],[-5.941247,54.670701],[-5.940077,54.670305],[-5.939681,54.669246],[-5.938544,54.668838],[-5.938142,54.667701],[-5.938681,54.667137],[-5.939976,54.667996],[-5.941681,54.667104],[-5.943681,54.668982],[-5.946192,54.66919],[-5.948681,54.670693],[-5.950103,54.670279],[-5.951671,54.670711],[-5.952157,54.671701],[-5.954383,54.671999],[-5.956421,54.673961],[-5.957681,54.67335],[-5.958704,54.673701],[-5.957564,54.679701],[-5.960899,54.681483],[-5.960852,54.682701],[-5.959681,54.682953],[-5.958681,54.682319],[-5.956341,54.682361],[-5.955686,54.682701],[-5.957352,54.683701],[-5.957681,54.684796],[-5.957196,54.685701],[-5.955681,54.686005],[-5.955175,54.687195],[-5.953407,54.687701],[-5.953208,54.688701],[-5.953681,54.688739],[-5.953729,54.687749],[-5.956542,54.68784],[-5.956901,54.68692],[-5.95881,54.68683],[-5.959681,54.686128],[-5.963681,54.686229],[-5.964058,54.687078],[-5.962512,54.687701],[-5.962054,54.689074],[-5.960898,54.689701],[-5.962681,54.690841],[-5.963166,54.690186],[-5.964075,54.690307],[-5.964466,54.692701],[-5.963427,54.693447],[-5.963105,54.694701],[-5.963681,54.695691],[-5.964433,54.694453],[-5.965993,54.694013],[-5.966305,54.693325],[-5.968917,54.693465],[-5.968935,54.694955],[-5.968007,54.695701],[-5.968042,54.702062],[-5.966681,54.703239],[-5.965681,54.702554],[-5.964488,54.702701],[-5.965479,54.702903],[-5.965597,54.703786],[-5.967375,54.705007],[-5.9682,54.706182],[-5.968353,54.707701],[-5.967452,54.709701],[-5.967681,54.712705]]]}},{"type":"Feature","properties":{"time":10,"id":1},"geometry":{"type":"Polygon","coordinates":[[[-5.901681,54.668854],[-5.902735,54.668755],[-5.90323,54.66725],[-5.904681,54.666604],[-5.905335,54.665355],[-5.907681,54.664346],[-5.908201,54.663221],[-5.909546,54.662701],[-5.909987,54.661701],[-5.908681,54.658156],[-5.907432,54.659452],[-5.90712,54.66114],[-5.906182,54.6612],[-5.905681,54.660257],[-5.905281,54.661301],[-5.904681,54.661495],[-5.90434,54.65736],[-5.906101,54.656121],[-5.907353,54.654373],[-5.909097,54.654117],[-5.91346,54.64948],[-5.914336,54.649356],[-5.915681,54.647388],[-5.917187,54.649195],[-5.917982,54.6494],[-5.918004,54.650024],[-5.917254,54.650128],[-5.9171569999999999,54.649225],[-5.915404,54.649701],[-5.915042,54.651062],[-5.912109,54.652701],[-5.911996,54.654016],[-5.911326,54.655346],[-5.91058,54.6556],[-5.910681,54.656236],[-5.911681,54.656177],[-5.912324,54.655344],[-5.915178,54.654701],[-5.915681,54.653317],[-5.919681,54.65331],[-5.920453,54.653929],[-5.922377,54.654005],[-5.922681,54.654676],[-5.923235,54.653701],[-5.921367,54.651701],[-5.921551,54.650701],[-5.922681,54.650473],[-5.922956,54.651426],[-5.924681,54.651237],[-5.925681,54.652424],[-5.92693,54.652452],[-5.928231,54.654151],[-5.929925,54.654457],[-5.936185,54.660701],[-5.938422,54.66096],[-5.938681,54.661817],[-5.942396,54.661986],[-5.942681,54.663118],[-5.946447,54.662935],[-5.946602,54.66378],[-5.948443,54.663939],[-5.948681,54.664808],[-5.951519,54.664863],[-5.951631,54.665751],[-5.953571,54.665811],[-5.95365,54.666732],[-5.956646,54.666736],[-5.956672,54.66771],[-5.958558,54.667701],[-5.956705,54.667677],[-5.956681,54.666685],[-5.953766,54.666616],[-5.953714,54.665668],[-5.951806,54.665576],[-5.951681,54.664641],[-5.948887,54.664495],[-5.948681,54.663384],[-5.946975,54.663407],[-5.946799,54.662584],[-5.943681,54.662547000000007],[-5.942999,54.662383],[-5.942681,54.661525],[-5.939133,54.661249],[-5.938839,54.660543],[-5.937192,54.66019],[-5.930999,54.653383],[-5.929421,54.652961],[-5.928151,54.651231],[-5.926681,54.650871],[-5.926337,54.650045],[-5.92497,54.649701],[-5.925299,54.645701],[-5.928961,54.644701],[-5.926681,54.644493],[-5.924971,54.642701],[-5.924466,54.640701],[-5.924681,54.640175],[-5.926145,54.639701],[-5.926188,54.638208],[-5.927335,54.638047],[-5.927681,54.63914],[-5.929152,54.637701],[-5.926474,54.636701],[-5.925758,54.635624],[-5.926285,54.634305],[-5.927983,54.634399],[-5.928681,54.634979],[-5.929384,54.634701],[-5.930098,54.633701],[-5.929574,54.632594],[-5.931158,54.632178],[-5.932243,54.630262],[-5.933681,54.630012],[-5.934073,54.630309],[-5.933442,54.632462],[-5.932365,54.633017],[-5.931526,54.632546],[-5.931494,54.633701],[-5.932499,54.634701],[-5.932562,54.63682],[-5.93414,54.637701],[-5.933196,54.638701],[-5.935908,54.642474],[-5.936681,54.642726],[-5.938057,54.640077],[-5.943045,54.636065],[-5.947316,54.635336],[-5.948681,54.636085],[-5.950443,54.634463],[-5.951908,54.633928],[-5.95133,54.631701],[-5.952752,54.630701],[-5.948681,54.630306],[-5.946231,54.627701],[-5.946681,54.627259],[-5.947681,54.627201],[-5.948681,54.627823],[-5.949718,54.627738],[-5.952328,54.626701],[-5.951367,54.626015],[-5.950861,54.624701],[-5.951681,54.623399],[-5.953031,54.623701],[-5.952168,54.624701],[-5.952681,54.625502],[-5.953681,54.625395],[-5.954681,54.624376],[-5.955681,54.625283],[-5.956969,54.625413],[-5.957681,54.627255],[-5.959438,54.625458],[-5.960094,54.625701],[-5.959647,54.628667],[-5.958621,54.628641],[-5.958094,54.630114],[-5.955178,54.631701],[-5.956681,54.633252],[-5.957481,54.632501],[-5.959118,54.632138],[-5.962681,54.632292],[-5.963681,54.631464],[-5.965681,54.630986],[-5.966528,54.631701],[-5.966226,54.633701],[-5.967336,54.634046],[-5.968473,54.635909],[-5.969681,54.636368],[-5.970681,54.63627],[-5.971052,54.635072],[-5.972735,54.634755],[-5.973658,54.633701],[-5.973367,54.631387],[-5.976829,54.629849],[-5.979631,54.626651],[-5.980907,54.626927],[-5.981019,54.625701],[-5.981681,54.625294],[-5.983155,54.626701],[-5.982174,54.628701],[-5.987093,54.629289],[-5.988521,54.630861],[-5.989336,54.631046],[-5.989681,54.632507],[-5.989951,54.630971],[-5.99064,54.630701],[-5.98997,54.630412],[-5.987913,54.627469],[-5.986327,54.627055],[-5.985152,54.625701],[-5.985681,54.624994],[-5.987111,54.624701],[-5.988652,54.623701],[-5.984681,54.623273],[-5.983681,54.624181],[-5.980681,54.624089],[-5.980089,54.622293],[-5.979349,54.621701],[-5.980681,54.619224],[-5.981369,54.621013],[-5.983681,54.62127],[-5.984681,54.622229],[-5.987951,54.621701],[-5.988075,54.620701],[-5.986927,54.619455],[-5.983681,54.619128],[-5.983286,54.618701],[-5.983681,54.618237],[-5.984999,54.618019],[-5.985065,54.615317],[-5.982681,54.615154],[-5.981315,54.613701],[-5.981681,54.613252],[-5.982681,54.613216],[-5.983681,54.614123],[-5.985213,54.614169],[-5.985438,54.614944],[-5.986539,54.614701],[-5.985805,54.613577],[-5.984681,54.613377],[-5.984129,54.612701],[-5.984681,54.612262],[-5.986982,54.612002],[-5.987999,54.610019],[-5.987886,54.608496],[-5.986279,54.606701],[-5.987202,54.605701],[-5.986036,54.604346],[-5.984385,54.603997],[-5.984545,54.602565],[-5.985681,54.60344],[-5.987681,54.60339],[-5.98837,54.602701],[-5.987495,54.601887],[-5.987681,54.601455],[-5.991681,54.601401],[-5.99237,54.60039],[-5.993681,54.600359],[-5.994214,54.602701],[-5.994992,54.603012],[-5.995421,54.601441],[-5.999124,54.598144],[-5.999332,54.596701],[-5.998681,54.595119],[-5.997899,54.596919],[-5.994533,54.596849],[-5.994438,54.595701],[-5.99541,54.594701],[-5.994519,54.593539],[-5.996223,54.593243],[-5.997681,54.591441],[-6.001126,54.591146],[-6.001126,54.590256],[-5.999681,54.59],[-5.999681,54.589398],[-6.002681,54.589303],[-6.003324,54.590058],[-6.004038,54.590058],[-6.004038,54.588344],[-6.002681,54.588099],[-6.002492,54.587512],[-6.003681,54.587437],[-6.004681,54.586429],[-6.008117,54.586137],[-6.008476,54.584496],[-6.01013,54.58415],[-6.010681,54.583361],[-6.012681,54.58327],[-6.013681,54.582321],[-6.017477,54.581905],[-6.019681,54.580957],[-6.023681,54.580966],[-6.024681,54.581963],[-6.026681,54.582012],[-6.027882,54.582902],[-6.029681,54.582861],[-6.029841,54.580701],[-6.028515,54.578867],[-6.028681,54.578241],[-6.032681,54.577157],[-6.034681,54.578854],[-6.036692,54.578712],[-6.034996,54.578386],[-6.033856,54.576526],[-6.031681,54.576325],[-6.029681,54.574704],[-6.028681,54.575239],[-6.027465,54.574485],[-6.025681,54.575172],[-6.025183,54.574701],[-6.025883,54.573499],[-6.024681,54.573328],[-6.023681,54.574208],[-6.022734,54.572648],[-6.021681,54.572557],[-6.020671,54.571691],[-6.01807,54.571312],[-6.017681,54.570582],[-6.016253,54.570273],[-6.014681,54.571107],[-6.01335,54.571032],[-6.013363,54.569701],[-6.01426,54.56928],[-6.014429,54.568701],[-6.014344,54.567364],[-6.014681,54.567161],[-6.015331,54.567701],[-6.015681,54.569406],[-6.016588,54.568608],[-6.017068,54.567088],[-6.018745,54.566701],[-6.019681,54.564801],[-6.022143,54.564701],[-6.021454,54.563474],[-6.023729,54.562701],[-6.022023,54.562359],[-6.021782,54.560802],[-6.022472,54.560701],[-6.021605,54.560625],[-6.019681,54.56261],[-6.016681,54.56079],[-6.016049,54.561701],[-6.016902,54.56248],[-6.016681,54.563257],[-6.014681,54.563246],[-6.013681,54.564451],[-6.011681,54.56442],[-6.010681,54.563846],[-6.009681,54.564248],[-6.00737,54.564012],[-6.006681,54.561968],[-6.004353,54.561029],[-6.003285,54.559701],[-6.004681,54.558343],[-6.008681,54.558323],[-6.009681,54.557252],[-6.010681,54.557774],[-6.011739,54.557701],[-6.011408,54.556701],[-6.014963,54.553983],[-6.015904,54.551924],[-6.016723,54.551743],[-6.016681,54.550345],[-6.016477,54.551497],[-6.015561,54.551581],[-6.013072,54.554092],[-6.011681,54.55385],[-6.010681,54.555186],[-6.009939,54.554701],[-6.010114,54.554134],[-6.010681,54.55382],[-6.011068,54.554088],[-6.011155,54.553701],[-6.00905,54.550332],[-6.010184,54.548204],[-6.011718,54.547737],[-6.010857,54.547525],[-6.010681,54.546099],[-6.010306,54.547326],[-6.008858,54.547878],[-6.007681,54.548148],[-6.005681,54.547637],[-6.00351,54.54853],[-6.003379,54.549003],[-6.004234,54.549148],[-6.004029,54.550049],[-6.003351,54.550031],[-6.002681,54.548906],[-6.001681,54.549012],[-6.001038,54.550058],[-5.999681,54.550221],[-5.998997,54.551017],[-5.99836,54.551022],[-5.997681,54.548456],[-5.996681,54.548171],[-5.99516,54.545222],[-5.99435,54.544701],[-5.994406,54.541701],[-5.993681,54.539981],[-5.992961,54.540701],[-5.99294,54.545701],[-5.993932,54.546701],[-5.993965,54.547985],[-5.993681,54.548376],[-5.992681,54.547556],[-5.988873,54.547701],[-5.989511,54.547871],[-5.989616,54.548766],[-5.993681,54.548963],[-5.994359,54.549701],[-5.994154,54.552174],[-5.990916,54.551466],[-5.989441,54.551701],[-5.989465,54.552917],[-5.990985,54.553397],[-5.991875,54.554895],[-5.988681,54.555262],[-5.987681,54.556238],[-5.985269,54.556289],[-5.984681,54.557291],[-5.983536,54.556701],[-5.983065,54.554317],[-5.980681,54.553864],[-5.979681,54.553026],[-5.976527,54.551701],[-5.976329,54.552701],[-5.977406,54.552976],[-5.97814,54.555701],[-5.975681,54.556294],[-5.974681,54.557012],[-5.973681,54.556214],[-5.970904,54.556701],[-5.969681,54.558034],[-5.9693,54.559701],[-5.973681,54.560048],[-5.974265,54.562117],[-5.975975,54.563701],[-5.974192,54.564212],[-5.973681,54.564946],[-5.971681,54.56495],[-5.970681,54.565928],[-5.969198,54.564701],[-5.970072,54.563701],[-5.969856,54.562701],[-5.968681,54.563261],[-5.967474,54.562908],[-5.966681,54.562019],[-5.965478,54.561904],[-5.96537,54.56039],[-5.966261,54.559701],[-5.966176,54.559206],[-5.965681,54.558302],[-5.964377,54.557701],[-5.965681,54.556604],[-5.966681,54.556615],[-5.967369,54.555389],[-5.968608,54.554701],[-5.966681,54.554446],[-5.964681,54.555043],[-5.962681,54.557429],[-5.960317,54.557065],[-5.958751,54.556631],[-5.958442,54.555701],[-5.956318,54.554064],[-5.955784,54.552598],[-5.953212,54.55217],[-5.952681,54.550435],[-5.952285,54.551305],[-5.951681,54.551476],[-5.951023,54.551359],[-5.950681,54.550624],[-5.949134,54.550701],[-5.950512,54.55087],[-5.950561,54.551821],[-5.951681,54.551926],[-5.95248,54.552902],[-5.954105,54.553277],[-5.956026,54.555356],[-5.955993,54.556013],[-5.954423,54.556443],[-5.953681,54.55725],[-5.950374,54.557394],[-5.949681,54.559145],[-5.948756,54.557701],[-5.948681,54.556133],[-5.946681,54.556974],[-5.945882,54.556902],[-5.9451599999999999,54.55818],[-5.943871,54.558701],[-5.9436,54.559701],[-5.942003,54.560701],[-5.943116,54.561266],[-5.943091,54.563111],[-5.941681,54.563774],[-5.940681,54.563398],[-5.939528,54.563548],[-5.939379,54.565399],[-5.938586,54.565701],[-5.93788,54.5669],[-5.933254,54.567274],[-5.932566,54.567816],[-5.931681,54.56615],[-5.928681,54.565597],[-5.929301,54.566081],[-5.929088,54.568108],[-5.927464,54.568484],[-5.926681,54.570197],[-5.924681,54.56806],[-5.923805,54.567825],[-5.922681,54.56823],[-5.920681,54.568137],[-5.919462,54.568701],[-5.920522,54.56886],[-5.921668,54.569701],[-5.922186,54.573701],[-5.920159,54.575179],[-5.919681,54.576421],[-5.918284,54.576098],[-5.917681,54.575492],[-5.916732,54.575701],[-5.916919,54.577701],[-5.915907,54.579701],[-5.917358,54.580024],[-5.917721,54.580701],[-5.920681,54.581176],[-5.921158,54.581701],[-5.920681,54.582191],[-5.919341,54.582361],[-5.918263,54.583701],[-5.918152,54.585172],[-5.917441,54.585701],[-5.917681,54.587524],[-5.918128,54.586148],[-5.918681,54.585969],[-5.919967,54.587415],[-5.920282,54.5891],[-5.921128,54.589701],[-5.920975,54.590995],[-5.919935,54.591955],[-5.918312,54.592332],[-5.917681,54.593108],[-5.916774,54.592701],[-5.916695,54.591701],[-5.918468,54.590701],[-5.918681,54.589337],[-5.917681,54.589426],[-5.916318,54.590338],[-5.911417,54.589965],[-5.911355,54.588375],[-5.913037,54.587701],[-5.912119,54.585701],[-5.911861,54.581521],[-5.910681,54.582778],[-5.909081,54.583101],[-5.908002,54.584701],[-5.908258,54.585701],[-5.907681,54.58603],[-5.906681,54.585806],[-5.905681,54.586752],[-5.904681,54.586673],[-5.903681,54.588201],[-5.901681,54.587619],[-5.900681,54.5868],[-5.898681,54.58814],[-5.896519,54.586863],[-5.893681,54.586425],[-5.892632,54.586652],[-5.893506,54.587876],[-5.894681,54.587924],[-5.89535,54.588701],[-5.894681,54.589468],[-5.892681,54.589905],[-5.891419,54.591439],[-5.887681,54.592004],[-5.883681,54.59123],[-5.881255,54.591275],[-5.880547,54.591701],[-5.883109,54.593701],[-5.881733,54.594753],[-5.874488,54.595701],[-5.877681,54.597433],[-5.879681,54.596418],[-5.880445,54.596701],[-5.880681,54.597386],[-5.880681,54.598738],[-5.880397,54.597985],[-5.877681,54.598052],[-5.875681,54.598679],[-5.878679,54.599701],[-5.875642,54.600701],[-5.876327,54.601055],[-5.876681,54.602232],[-5.878681,54.602048],[-5.880545,54.604837],[-5.884681,54.604034],[-5.886446,54.604701],[-5.883924,54.604944],[-5.883858,54.605878],[-5.882681,54.60592],[-5.881897,54.606917],[-5.880681,54.606991],[-5.879875,54.607895],[-5.872681,54.611077],[-5.871681,54.612088],[-5.870279,54.612299],[-5.868099,54.615119],[-5.866056,54.616076],[-5.864681,54.616191],[-5.863681,54.617207],[-5.862235,54.617147],[-5.861796,54.616701],[-5.861844,54.613701],[-5.861681,54.613651],[-5.861037,54.614057],[-5.860337,54.614045],[-5.859809,54.613573],[-5.858845,54.613538],[-5.858681,54.612761],[-5.858387,54.613995],[-5.859885,54.615701],[-5.859251,54.617701],[-5.857681,54.617957],[-5.856681,54.617618],[-5.853132,54.617701],[-5.852032,54.618701],[-5.855681,54.619525],[-5.857681,54.619136],[-5.858963,54.62042],[-5.857176,54.623196],[-5.855801,54.623701],[-5.855443,54.625463],[-5.853652,54.62573],[-5.855681,54.625762],[-5.855825,54.624845],[-5.857015,54.624701],[-5.857917,54.622937],[-5.858773,54.622793],[-5.859015,54.622035],[-5.86107,54.620701],[-5.861306,54.619326],[-5.862681,54.619163],[-5.863333,54.618353],[-5.864869,54.617889],[-5.865681,54.617114],[-5.867981,54.617001],[-5.870262,54.614282],[-5.874681,54.613227],[-5.875358,54.611378],[-5.877041,54.611061],[-5.877681,54.610274],[-5.880294,54.609701],[-5.881681,54.608394],[-5.883681,54.608371],[-5.885681,54.606379],[-5.887681,54.606422],[-5.888681,54.605432],[-5.889681,54.606175],[-5.891681,54.606262],[-5.89201,54.606701],[-5.890923,54.607943],[-5.88928,54.6083],[-5.886681,54.611218],[-5.885148,54.611234],[-5.884304,54.610701],[-5.884087,54.611701],[-5.885479,54.611903],[-5.886241,54.612701],[-5.885558,54.613824],[-5.886407,54.615701],[-5.886323,54.616343],[-5.885361,54.616701],[-5.885681,54.617584],[-5.886681,54.617148],[-5.886981,54.616001],[-5.887706,54.615701],[-5.887011,54.614701],[-5.88733,54.61235],[-5.889335,54.611701],[-5.889229,54.610701],[-5.890419,54.609439],[-5.892681,54.609098],[-5.893186,54.608206],[-5.894838,54.607858],[-5.89527,54.60629],[-5.896267,54.605287],[-5.901681,54.605408],[-5.903681,54.604431],[-5.905681,54.604445],[-5.905135,54.606155],[-5.903003,54.606701],[-5.901681,54.608446],[-5.900334,54.608354],[-5.899258,54.610278],[-5.898515,54.610535],[-5.899987,54.613007],[-5.896681,54.613456],[-5.894483,54.615701],[-5.894681,54.61769],[-5.896223,54.616243],[-5.899737,54.615757],[-5.902681,54.612137],[-5.903332,54.612701],[-5.902498,54.613884],[-5.903922,54.613942],[-5.90439,54.61241],[-5.906857,54.611877],[-5.906681,54.610819],[-5.905681,54.611052],[-5.905531,54.610701],[-5.906681,54.61068],[-5.907482,54.609502],[-5.908681,54.610303],[-5.909681,54.609262],[-5.911109,54.609129],[-5.911445,54.605701],[-5.912538,54.604558],[-5.913681,54.605455],[-5.916681,54.60538],[-5.918516,54.603536],[-5.919811,54.603571],[-5.918845,54.605865],[-5.916214,54.606234],[-5.914855,54.607875],[-5.913197,54.608217],[-5.91026,54.61128],[-5.91026,54.612122],[-5.911665,54.612701],[-5.911439,54.615701],[-5.912681,54.615888],[-5.914681,54.614285],[-5.915037,54.615701],[-5.913945,54.616965],[-5.912325,54.617345],[-5.910071,54.620091],[-5.907564,54.620701],[-5.908572,54.62081],[-5.908681,54.621825],[-5.910681,54.621948],[-5.911681,54.622931],[-5.914681,54.623076],[-5.915251,54.623701],[-5.914156,54.625176],[-5.912681,54.626322],[-5.910681,54.625662],[-5.909681,54.626117],[-5.907681,54.626049],[-5.90565,54.62767],[-5.905452,54.628472],[-5.903905,54.628925],[-5.902636,54.628701],[-5.902723,54.627659],[-5.901681,54.6276],[-5.898681,54.628673],[-5.895905,54.628477],[-5.895681,54.627875],[-5.895099,54.629119],[-5.89392,54.629701],[-5.896779,54.630603],[-5.896902,54.63148],[-5.897647,54.631735],[-5.899681,54.630081],[-5.908776,54.630606],[-5.910181,54.631201],[-5.910681,54.632924],[-5.911961,54.631981],[-5.912681,54.630315],[-5.917681,54.630369],[-5.918846,54.631701],[-5.918759,54.637701],[-5.917127,54.640147],[-5.916554,54.642574],[-5.915681,54.642585],[-5.915648,54.643668],[-5.914515,54.643701],[-5.914844,54.645864],[-5.907931,54.652951],[-5.90528,54.6543],[-5.904288,54.655308],[-5.902457,54.658701],[-5.902448,54.660701],[-5.903169,54.661701],[-5.902102,54.663701],[-5.903681,54.663938],[-5.904331,54.664701],[-5.902434,54.666701],[-5.902521,54.668541],[-5.901746,54.668636],[-5.901681,54.668854]]]}},{"type":"Feature","properties":{"time":5,"id":1},"geometry":{"type":"Polygon","coordinates":[[[-5.944681,54.61103],[-5.945929,54.610949],[-5.946681,54.610441],[-5.947681,54.610787],[-5.94893,54.609701],[-5.948315,54.608701],[-5.94947,54.60649],[-5.951681,54.606582],[-5.953162,54.60622],[-5.954681,54.607495],[-5.956681,54.605649],[-5.957919,54.607463],[-5.957681,54.609406],[-5.960681,54.608013],[-5.961891,54.608491],[-5.962681,54.609548],[-5.963341,54.609361],[-5.964221,54.608701],[-5.962976,54.608406],[-5.963627,54.606701],[-5.963198,54.605701],[-5.963809,54.604829],[-5.964681,54.604863],[-5.965543,54.603701],[-5.966709,54.603673],[-5.968681,54.604827],[-5.969681,54.60216],[-5.973568,54.601814],[-5.974681,54.602071],[-5.974357,54.599377],[-5.975681,54.599246],[-5.976681,54.598304],[-5.978231,54.597701],[-5.974681,54.597321],[-5.973681,54.597658],[-5.973212,54.595701],[-5.971662,54.59572],[-5.970868,54.594701],[-5.971681,54.592709],[-5.973681,54.593738],[-5.974658,54.593678],[-5.975681,54.593339],[-5.976681,54.592011],[-5.977681,54.592124],[-5.979418,54.592701],[-5.979681,54.593767],[-5.982091,54.593111],[-5.982681,54.592576],[-5.983548,54.593834],[-5.986305,54.594077],[-5.987961,54.594701],[-5.988198,54.593701],[-5.986681,54.592485],[-5.984917,54.591465],[-5.981681,54.59108],[-5.980681,54.590003],[-5.979422,54.589701],[-5.978807,54.588575],[-5.977681,54.588853],[-5.976681,54.590171],[-5.974681,54.590102],[-5.974089,54.589293],[-5.972369,54.589013],[-5.972068,54.587701],[-5.973681,54.586137],[-5.975998,54.586018],[-5.976681,54.585228],[-5.978681,54.58517],[-5.979681,54.585843],[-5.980856,54.585876],[-5.984656,54.583701],[-5.984987,54.583007],[-5.986074,54.582701],[-5.982902,54.58248],[-5.981099,54.579701],[-5.979681,54.578616],[-5.979039,54.581059],[-5.977738,54.582758],[-5.975277,54.583701],[-5.97498,54.585],[-5.973681,54.585112],[-5.972681,54.584194],[-5.970495,54.584515],[-5.969681,54.585295],[-5.968067,54.585701],[-5.968195,54.586187],[-5.968681,54.586001],[-5.969044,54.586338],[-5.968681,54.587069],[-5.967681,54.585954],[-5.964681,54.586226],[-5.964118,54.585701],[-5.964385,54.584405],[-5.967298,54.581318],[-5.968989,54.581009],[-5.972062,54.577082],[-5.97302,54.576701],[-5.974254,54.575274],[-5.977681,54.573881],[-5.977836,54.572856],[-5.980495,54.572701],[-5.979888,54.572494],[-5.977681,54.572428],[-5.974681,54.573168],[-5.974477,54.574497],[-5.973591,54.574611],[-5.972467,54.575487],[-5.968118,54.580138],[-5.966307,54.580327],[-5.964654,54.581674],[-5.963681,54.581578],[-5.963065,54.580701],[-5.965686,54.575701],[-5.964786,54.575596],[-5.961681,54.576821],[-5.960998,54.580018],[-5.960287,54.580095],[-5.959681,54.579499],[-5.957943,54.579963],[-5.957413,54.580701],[-5.958119,54.582139],[-5.956681,54.582204],[-5.955681,54.583191],[-5.954264,54.583118],[-5.953681,54.582235],[-5.952681,54.583064],[-5.950681,54.581607],[-5.949681,54.581264],[-5.948681,54.58185],[-5.947681,54.580886],[-5.947353,54.581373],[-5.944706,54.581726],[-5.942681,54.58313],[-5.942608,54.584628],[-5.941681,54.584777],[-5.944681,54.584438],[-5.945681,54.583869],[-5.950681,54.584349],[-5.951387,54.585701],[-5.950428,54.586448],[-5.949681,54.588241],[-5.948337,54.588045],[-5.947681,54.587283],[-5.945348,54.587034],[-5.944583,54.586603],[-5.942482,54.586502],[-5.939511,54.587871],[-5.935681,54.587539],[-5.934519,54.590539],[-5.933645,54.590665],[-5.933681,54.591139],[-5.935681,54.590446],[-5.936681,54.591692],[-5.938457,54.590477],[-5.941681,54.590431],[-5.942681,54.589298],[-5.943361,54.590021],[-5.945681,54.590059],[-5.94651,54.590701],[-5.944331,54.591351],[-5.94302,54.59304],[-5.94151,54.59353],[-5.939681,54.5951],[-5.938295,54.595087],[-5.937681,54.594128],[-5.934681,54.5942],[-5.934191,54.595211],[-5.932282,54.595701],[-5.931681,54.596469],[-5.931681,54.597355],[-5.932681,54.597215],[-5.933986,54.598396],[-5.933681,54.599369],[-5.932347,54.599701],[-5.933368,54.600701],[-5.933681,54.604696],[-5.936681,54.602878],[-5.936742,54.604762],[-5.935681,54.605299],[-5.933681,54.604702],[-5.931823,54.605701],[-5.932681,54.60591],[-5.932924,54.606944],[-5.929681,54.607348],[-5.926393,54.606989],[-5.925681,54.605964],[-5.923681,54.605295],[-5.92348,54.6085],[-5.922593,54.608701],[-5.922427,54.609701],[-5.922731,54.609701],[-5.923121,54.609141],[-5.925681,54.608795],[-5.925988,54.608008],[-5.926681,54.607898],[-5.929681,54.608221],[-5.934681,54.608026],[-5.936681,54.609225],[-5.938012,54.608032],[-5.939681,54.607998],[-5.939703,54.607679],[-5.938058,54.606701],[-5.938853,54.604529],[-5.939681,54.605065],[-5.940681,54.604764],[-5.941681,54.605808],[-5.942681,54.605879],[-5.943681,54.604918],[-5.944986,54.605396],[-5.945094,54.606114],[-5.943463,54.608701],[-5.944492,54.60889],[-5.944553,54.610573],[-5.944017,54.610701],[-5.944681,54.61103]]]}}]},"generateId":true},"source_layer":null,"paint":{"fill-antialias":true,"fill-color":["match",["get","time"],5,"lightblue",10,"blue",15,"darkblue","#cccccc"],"fill-opacity":0.35,"fill-translate-anchor":"map"},"layout":{"visibility":"visible"},"slot":null,"minzoom":null,"maxzoom":null,"popup":null,"tooltip":null,"hover_options":null,"before_id":null,"filter":null}],"markers":[{"id":"marker_1","lng":-5.953681,"lat":54.593701,"color":"red","rotation":0,"popup":null,"options":{"draggable":false}}]},"elementId":"compare-container-31017","mousemove":false,"orientation":"vertical","mode":"swipe","swiper_color":"grey30","compare_legends":[{"html":"<div id=\"legend-5aec5\" class=\"mapboxgl-legend top-left\"><h2>Royal Victoria Hospital (5PM vs. 3AM) Accessibility<\/h2><div class=\"legend-item\"><div class=\"legend-patch-container\" style=\"width:20px; height:20px;\"><svg class=\"legend-color legend-shape-custom\" width=\"20\" height=\"20\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid meet\"><path d=\"M44.3376573416316,10.5349207953378 L44.0673932391593,11.1882492167563 L44.2630005509605,11.5142614030911 L44.1723691631593,11.6749854109541 L43.7162781144761,11.8402735894282 L43.4880695840415,12.9470849620365 L43.2171534571967,12.9607774738628 L43.0336085962893,12.7178983950398 L42.1211004867366,12.75278169898 L42.0673084759907,12.4805615233891 L41.8619207985996,12.4922979620977 L42.021666769904,12.5262032294767 L42.0347072573572,12.8391749283585 L42.7075964099537,12.9027473046979 L43.359620782625,13.5850908106942 L43.6856329689606,13.4618582042601 L43.81734189224,13.6643117719753 L43.8258182090845,14.774383266448 L43.558162204103,14.9729246879254 L43.4476440729354,15.514430929426 L42.5964262544131,15.7524198254546 L43.4453619876316,15.9926908067842 L43.4355816220411,16.4804050375408 L42.7075964099537,16.5195264999019 L42.3815842236184,16.2032946791557 L41.9659186860407,16.16808536303 L41.7686813133076,15.3872861767588 L41.5440589169223,15.5669188914278 L41.2923775090711,15.5372517824697 L41.0775354782761,14.984661126634 L40.5282049443007,14.9977016140869 L40.3319456081265,14.774383266448 L40.3775873142138,15.1003954527828 L40.0994989192698,15.2780720943364 L39.8862869494061,14.9875952363129 L39.4474745465985,14.9729246879254 L39.1214623602629,14.6615830499758 L38.6376602757414,14.6061609782974 L38.4694379875922,14.0904096995149 L37.1774516931443,14.1223588937762 L37.7336284830329,14.2061440256636 L37.8174136149209,14.6263737338501 L38.5871283868595,14.9827050535163 L39.1084218728094,15.4394481265728 L39.4474745465985,15.4717233330219 L39.7350172949464,15.7908892634401 L40.0994989192698,15.574743183901 L40.3208611937916,15.8570697372682 L40.8551951671955,15.9747601365324 L40.7515232919408,17.2954355033789 L40.8177037657666,17.1226490446218 L41.1231771843631,17.1024362890691 L41.4035476646117,16.2606728239518 L41.6027411104628,16.5312629386105 L42.055572037283,16.601355558674 L42.3815842236181,16.9338879887329 L42.7825792128106,16.9814857679382 L42.8119203095812,17.3824807571331 L42.5579568164259,17.5588533499377 L42.4467866608853,18.0997075670696 L42.2293365325995,18.2082696251185 L42.1315328766991,18.7624903418888 L41.6203457685248,19.2293397927217 L41.522216100438,19.7832344973064 L41.1642547198413,19.9905782478158 L40.8053153026864,21.0224068175687 L40.4255111056048,21.1753065329585 L39.9609437400772,20.7811577996803 L39.6306933953195,20.1333715854317 L39.0732125566857,20.0388280513921 L38.9760609251572,19.8099674965856 L38.4202101474553,19.7137939016162 L38.3204504184363,19.4875414442984 L37.8174136149209,19.4135366780041 L37.6211542787473,19.2088010249811 L36.839377055914,19.1898923181751 L36.513364869579,18.7660764759387 L35.861340496908,18.7670545124952 L35.5353283105726,18.5065707756153 L34.8833039379014,18.4446284602127 L34.5572917515657,18.1202463348078 L33.9052673788945,18.1218763957377 L33.8084417595529,17.9376795104599 L34.0571890577269,17.5344024359664 L34.4767667415409,17.3824807571331 L33.5241591330682,17.3273846976402 L33.244766689379,17.7084929434655 L32.9272308198878,17.7994503434551 L32.5653572930558,17.7443542839646 L32.4799421002355,17.5037572904472 L31.9491942608812,17.4773503033535 L31.6231820745459,17.6015609463487 L31.2971698882105,17.1539462145098 L30.6451455155393,17.2781568575073 L30.3875958883341,16.9880060116647 L29.9931211428683,16.8341282597159 L29.6671089565329,16.954752768659 L29.5171433508182,16.8804219901722 L29.3410967701976,16.5113761952409 L28.6890723975263,16.6313486798176 L28.3630602111907,16.3157688834424 L27.71103583852,16.3085966153426 L27.3850236521841,15.8707622490945 L26.9771824070784,15.8342488842221 L26.7329992795131,15.5512703064815 L26.0809749068418,15.5538784039749 L25.7549627205068,15.2327564004367 L24.7769261614996,15.3419704828567 L24.4509139751642,14.9977016140869 L23.6880454591393,14.8852274098025 L23.4728774161579,14.5999667467587 L22.8208530434869,14.6068130026707 L22.5616733553501,14.3815385819118 L22.1688286708157,14.2882990966189 L21.2912038652002,14.3479593267206 L21.1907921118087,13.9779354952305 L20.212755552803,13.9899979461245 L19.8867433664671,13.673114101005 L18.3355773838827,13.7174517583482 L18.2566824347898,13.4364292537276 L17.0690200399691,13.3539481705822 L16.9526336894472,13.0911823483967 L15.655105187832,13.1378020910454 L15.5879466774468,12.8183101484348 L15.6485849441053,13.1524726394305 L16.9109041295959,13.1860518946194 L16.9526336894469,13.4977195447568 L17.9306702484538,13.5537936408063 L18.2566824347895,13.8895861927319 L19.5607311801311,13.8807838637022 L19.8867433664668,14.2478735855158 L20.8647799254734,14.2648262192018 L21.1907921118087,14.5764938693393 L22.1688286708154,14.6084430636006 L22.494840857151,14.9390194205464 L23.248581031959,14.9986796506458 L23.4728774161579,15.30415306924 L24.1249017888289,15.2813322161962 L24.4509139751642,15.660810401094 L25.4289505341708,15.6187548290563 L25.624557845972,15.8828246999862 L26.3297222050161,16.0784320117894 L26.45393284801,16.3574984432922 L27.0590114658484,16.305662505666 L27.5809569761719,16.7304563844612 L27.3850236521841,16.9560568174034 L26.8898111411407,16.8996567091707 L26.7329992795131,16.6336307651162 L26.4069870931777,16.5136582805465 L26.0809749068421,16.5775566690667 L25.779739646668,16.3796672719627 L25.3986314008415,16.4044441981218 L25.7106250631653,16.4487818554673 L25.7549627205068,16.7539292618784 L26.4069870931777,16.7904426267461 L26.6818153662585,17.1076524840535 L27.2102811203084,17.2312111026708 L27.9046870772029,17.8408538911195 L28.0370480248551,18.3230259147085 L28.1234412542345,18.1208983591812 L29.3410967701973,18.188382881756 L29.6671089565327,18.4478885820748 L30.6451455155396,18.5372159211322 L30.9711577018746,18.8449714250319 L31.2971698882105,18.545692237974 L31.4973413706204,18.8123702063996 L32.0375435633783,18.924192386313 L31.7959685333035,19.6645660614811 L32.1128523784217,19.9905782478158 L31.6231820745456,20.5314324649454 L31.2971698882105,20.4267825531318 L29.993121142868,20.5539273058013 L29.6671089565329,20.25953830154 L28.5707299738868,20.3165904341529 L29.6361377988311,20.3475615918531 L29.6671089565327,20.7133472649223 L30.4658388130549,20.8219093229712 L30.9711577018746,21.5733674124746 L31.0575509312537,21.3810202225358 L31.2971698882102,21.3337484555183 L31.4712603957137,21.4465486719929 L31.6231820745456,22.0050075471817 L32.2752064472172,22.1575812503884 L32.6012186335525,22.0095717177882 L32.8362734199003,22.2726635521638 L32.4864623439626,22.5986757384986 L32.6012186335525,22.9543550337915 L32.6905459726085,22.688003077556 L32.9947153424595,22.6661602610711 L33.1071895467453,22.4526222790207 L33.988074474224,22.3554706474925 L34.1214134584353,22.1627974453705 L34.3320173308082,22.1719257865857 L34.4353631938766,22.2726635521638 L34.1644470670312,22.5986757384986 L34.3688567078635,23.0622650674671 L33.9734039258388,23.2507001111728 L34.1595568842361,23.648434978501 L34.3408196598391,23.6862523921131 L34.5572917515657,23.533678688911 L34.8833039379014,22.7711361850702 L35.1653044790816,22.9246879248357 L35.4446969227709,23.667343685307 L35.5353283105723,23.7270039154063 L35.861340496908,23.422508533371 L36.0435813090695,23.5767122975052 L36.0937871857647,23.9027244838423 L35.4857744582491,24.2287366701771 L35.879271167156,25.1888425589365 L36.4409901642122,25.2791479345504 L37.1653892422499,25.9585573308748 L38.1434258012566,25.8451050900293 L38.2682884686231,26.0599471208217 L38.4694379875925,26.1404721308494 L38.6050590571076,26.0491887186743 L38.7954501739278,26.5362509250622 L39.2759921365861,26.6823043845401 L40.0069114583503,27.5814459944489 L40.5405934073817,27.699788418091 L41.4954831011585,28.7009718423292 L41.5306924172824,29.1189194652102 L42.1582658759789,30.0969560242168 L42.1455514007117,31.0749925832234 L42.4660213798792,31.4010047695581 L42.4383103440406,31.7837430763157 L42.055572037283,31.8254726361702 L41.5251502101151,31.2794022240586 L40.9601710911954,31.1923569703044 L40.7515232919408,30.9410015746396 L40.6621959528848,31.4903321086156 L41.0775354782761,31.5757473014353 L41.2079403528109,31.7270169558952 L40.9852740295439,32.7973149636335 L41.1697969270095,32.7973149636312 L41.7295598509474,32.2688492095836 L42.3815842236184,32.2897139895097 L42.5445903167857,32.542047421731 L43.1059833016558,32.7050535149018 L43.0336085962893,33.4307566416848 L41.7295598509471,33.4574896409617 L41.4035476646115,33.1487561005031 L41.1952258775432,33.6830900739085 L41.4035476646115,33.8914118609767 L43.0336085962893,33.9354235061321 L43.4166729152336,34.9871388192522 L43.1447787518299,35.0983089747899 L43.0684919002269,35.6740464958595 L42.4888422329227,35.7464212012263 L42.3815842236184,36.0196194133737 L42.017754623668,36.0029927918686 L41.9365775892704,35.7581576399325 L41.7295598509474,35.6984974098332 L41.5225421126243,35.7581576399325 L41.4035476646115,36.0215754864891 L40.866279581531,36.0802576800319 L40.4255111056051,36.6765339688421 L39.1214623602635,36.6804461150752 L39.6841593938785,35.9651753782565 L39.4474745465985,35.7284905309768 L39.1214623602632,35.7226223116237 L38.7954501739275,36.035920022691 L38.1434258012566,36.0333119252 L38.1434258012568,35.8791081610657 L38.6229897273557,35.7927149316826 L38.6999286033312,35.639163191924 L38.4694379875922,35.4086725761807 L36.8393770559143,35.3881338084424 L36.6828912064737,35.1436246686942 L35.861340496908,35.0683158536463 L35.5353283105723,34.7533880816467 L35.1519379794417,35.044516964046 L35.0140348246219,34.2043835598586 L34.4353631938763,34.0091022602432 L34.557291751566,33.844140093957 L34.9641549601126,33.7639410961194 L35.0564164088454,33.5301903585163 L35.384384668299,33.3570778875714 L34.8833039379017,33.1389757349169 L34.6867185895414,33.4865047255464 L34.1344539458885,33.4539035069164 L34.2312795652298,33.1216970890361 L34.6808503701868,33.0310657012366 L34.0712075817393,32.8651254983915 L33.9052673788945,32.5994255665294 L33.389516100112,32.5687804210125 L33.2532430062238,32.257112770875 L33.1851064592791,32.7050535149018 L33.4012525388196,32.8830561686433 L33.4420040621115,33.3570778875691 L34.0271959365839,34.0091022602432 L33.9052673788945,34.429983992803 L33.729872822646,34.1844968164914 L33.1838024105341,34.0785428559334 L32.9272308198878,33.7900220710252 L31.6231820745456,33.8030625584759 L31.2971698882108,34.132334866675 L30.9711577018746,34.1375510616594 L30.6451455155396,33.5592054430987 L30.3191333292039,33.8190371556123 L29.3410967701976,33.8359897893006 L29.0150845838617,34.1698262681062 L27.7110358385197,34.2007974258087 L27.3850236521838,34.5391980752253 L26.0809749068421,34.5982062809513 L25.9717608244201,34.8779247368275 L25.2013940281084,34.9871388192522 L26.0809749068418,35.0415828543671 L26.4069870931777,34.7390435454494 L27.7110358385197,34.7876193612113 L28.0370480248551,34.4769297476326 L29.3410967701976,34.5030107225408 L29.6671089565327,34.1871049139824 L29.9931211428683,34.5088789418962 L30.3191333292036,34.1991673648788 L30.6451455155393,34.5290916974467 L30.9711577018746,34.5326778314989 L31.2971698882105,34.8000078242932 L31.6231820745456,34.8228286773369 L31.8702993117883,34.2562194974848 L32.6012186335525,34.2268784007145 L32.7795472994781,34.4827979669881 L33.2532430062241,34.5597368429659 L33.4273335137267,34.8130483117438 L33.9052673788947,34.8922692730271 L34.0751197279758,35.1432986565041 L34.5572917515657,35.223497654344 L34.8833039379014,35.5524439503553 L35.861340496908,35.5579861575229 L35.861340496908,35.6984974098355 L31.2971698882105,35.7170801044561 L30.9711577018746,35.4086725761807 L30.6451455155396,35.4050864421331 L30.3191333292039,35.7222962994358 L24.7769261614999,35.7809784929763 L24.4509139751642,35.4145407955384 L24.0121015723567,35.4259512220568 L23.5723111329902,34.8877051024161 L23.1468652298223,34.8769467002664 L22.8606265302196,34.6213531461806 L22.5734097940581,34.5825576960097 L22.4883206134248,34.3285942028515 L22.2275108643561,34.3937966401162 L22.0648307833749,34.8831409318096 L21.5657061260946,34.9382369913002 L21.5285407368527,34.649064182021 L21.3332594372382,34.6611266329128 L21.4917013597968,34.6862295712621 L21.5168042981447,35.0128937819702 L23.1468652298226,35.097330938231 L23.7988896024932,35.7920629073092 L24.2288996762703,35.8611774908139 L24.1249017888289,36.1206831911351 L21.8428164844806,36.1907758112009 L21.190792111809,35.9462666714481 L20.8647799254734,36.2507620534858 L20.5919077255112,36.2380475782207 L20.5387677391381,35.9400724399095 L20.2231879427655,35.9651753782565 L20.2577452345166,36.2911875645912 L20.8647799254737,36.4385450728158 L24.7769261614999,36.4727763523803 L25.1029383478352,36.1542624463285 L30.9711577018746,36.2119666033125 L31.0350560903969,36.3550859531138 L30.5127845678871,36.4848388032744 L29.9090099987938,37.2692241235978 L30.3191333292039,37.5531807378996 L30.5440817377753,37.1681603458342 L30.7973932065578,37.116976432579 L30.7960891578129,37.4201677658723 L30.6451455155396,37.5329679823445 L30.4840954954893,37.4341862898864 L30.435519679726,37.5952363099349 L31.2971698882105,37.734117501313 L31.8269396910057,36.9432119372631 L31.5703681003597,36.2383735904062 L32.2752064472172,36.2184868470366 L32.427128126049,36.465278072095 L32.6853297776269,36.533088606853 L32.4584252959373,37.0860052748789 L32.9272308198878,37.1668562970898 L33.2532430062238,36.8574707322556 L33.3389842112298,37.2692241235978 L33.2532430062238,37.3895226203554 L31.9491942608812,37.4870002640715 L31.8660611533659,37.9212484962697 L32.2752064472172,38.1429367829787 L32.4757039418137,37.7957338045301 L32.7000003260121,37.8224668038092 L32.9536378069809,38.8728780681826 L33.2532430062238,38.9328643104698 L33.4840596341489,38.8040894968658 L33.8358267832051,38.8298444595861 L33.9610154627581,38.6290209528031 L34.5572917515657,38.9442747369905 L34.6746561386464,38.6906372560225 L34.7574632339756,37.9212484962697 L33.8547354900129,36.8926800483789 L34.5572917515657,36.227941200442 L35.861340496908,36.231853346682 L35.6037908697028,36.6171997509283 L35.5780359069822,37.3119317200088 L35.209316124237,37.0178687279331 L34.9579607285722,37.2692241235955 L34.9905619472057,38.5732728689392 L35.3550435715288,39.0795697943187 L36.1873526832433,39.1600948043441 L36.513364869579,39.4652422107551 L37.1653892422499,39.4926272344077 L37.2742773124859,39.7684335440461 L37.4914014285853,39.8228775791634 L38.7954501739275,39.8290718107043 L39.0249627531077,39.780822007128 L39.1214623602635,39.5053417096728 L40.1278619794809,39.5226203555489 L40.1855661364622,40.1172665834247 L40.4662626288976,40.20333380062 L40.2005626970337,40.3043975783813 L40.0994989192695,40.9013258915626 L40.0046293730459,40.2982033468404 L39.1214623602632,40.2479974701464 L39.0298529359028,39.9689310386436 L38.7954501739275,39.9229633203705 L37.593769255095,39.9796894407909 L37.5895310966724,40.7572285052024 L37.8500148335547,40.8227569546549 L37.9165213195669,41.082262654976 L39.1648219810455,41.1813703596243 L38.5636555094427,41.275587881476 L38.5193178521013,42.2092867831394 L38.1434258012566,42.214176965936 L38.0289955238524,41.9478250097006 L37.7776401281879,41.8731682190283 L37.7417787876915,41.1813703596266 L37.4914014285856,40.9309930005184 L37.1653892422499,41.2482028578235 L36.1345387090568,41.2341843338094 L35.7619067800756,40.8553581732895 L35.3015775729698,39.7850601655513 L34.8833039379014,39.4404652845936 L34.7584412705348,39.8773216142829 L35.2869070245844,40.7777672729384 L35.2670202812181,41.2390745166059 L33.8283285029198,41.2583092355998 L33.6689085438012,40.4396926357118 L33.2532430062241,40.1730146672909 L32.7159749231424,40.5293459869548 L33.3728894786091,40.7357117009007 L33.3715854298633,41.5073825459614 L33.5792551925594,41.7150523086563 L35.2653902202867,41.7773206362467 L35.2093161242367,41.9403267294129 L34.557291751566,41.9686897896243 L34.3665746225594,42.1594069186309 L34.5572917515657,42.3501240476375 L34.9657850210442,42.4026120096371 L35.0916257249693,42.9287956783838 L35.5353283105726,43.2316609994892 L35.861340496908,43.3154461313767 L35.9213267391937,43.1974297199247 L35.6641031241749,42.8114312913051 L35.7586466582121,42.1594069186309 L36.1873526832436,41.7590639538117 L36.839377055914,41.7652581853503 L37.6058317059891,42.6970010138984 L38.1434258012566,42.7566612439977 L38.2480757130701,43.032793565824 L38.8280513925607,43.1048422590052 L37.9129351855173,43.2329650482336 L37.8509928701138,43.4970349191658 L37.2798195196541,43.577885941379 L37.2224413748582,43.7894678503071 L37.2798195196538,44.0010497592374 L37.5275887812684,44.0792926839619 L37.5924652063495,44.6664406315523 L37.8500148335547,44.7349031906814 L37.9126091733309,44.9983210372402 L38.1871114342255,45.0935165956531 L37.9093490514677,45.1854520321969 L37.9093490514677,45.6536055317765 L38.1737449345856,45.7152218349935 L38.2347092134305,45.9802697424846 L38.8342456241017,46.0327577044841 L38.8280513925613,46.3975653409921 L38.7214454076295,46.1455579209563 L37.5706223898646,46.1511001281216 L37.5706223898649,46.6443565660505 L37.8412125045238,46.7473764169319 L36.2655956079635,46.8018204520491 L36.2271261699763,47.0893632003961 L35.861340496908,47.0906672491405 L35.7664709506841,46.1664227008824 L35.3041856704603,46.1664227008824 L35.2380051966339,46.7522665997261 L34.9657850210442,46.8060586104724 L34.5823946899136,47.4007048383458 L34.3072404046465,47.4515627394154 L34.2573605401371,47.7276950612417 L33.9870964376648,47.7834431451056 L33.9492790240501,48.6796506453425 L33.9936166813913,48.917313529181 L34.4689424490692,48.917313529181 L34.5302327400999,48.3265794475407 L35.5353283105723,48.3187551550675 L35.5711896510693,48.6796506453425 L35.2842989270939,48.7546334482003 L35.2468075256653,49.0056628316772 L35.2842989270937,49.2566922151565 L35.5591272001747,49.3554739076146 L34.952744533591,49.4014416258877 L34.5572917515657,50.0205387677371 L33.3347460528072,50.0652024372681 L33.3347460528077,50.5542207167714 L33.9052673788947,50.6748452257145 L32.9272308198878,50.6790833841354 L32.8359474077139,50.4009949891937 L32.3664898593911,50.4009949891937 L32.3664898593911,51.1964647238524 L32.9526597704224,51.3131770865577 L32.3495372257016,51.3620789145097 L32.2752064472172,51.6512517237889 L31.0539647972041,51.6965674176909 L30.997564688968,52.2921916821255 L30.3999843514151,52.3466357172428 L30.3191333292036,52.6328744168454 L29.4300980970672,52.6807982082385 L29.3410967701976,52.9605166641147 L28.2277651538614,52.9178090677037 L28.3630602111907,52.7593671451439 L28.7790517609545,52.6817762447974 L29.100825788868,52.2657846950318 L29.015084583862,52.0173634090459 L28.3630602111907,52.4242266175939 L27.8186198600101,52.2657846950295 L28.0370480248551,51.9081493266236 L27.6781086076999,51.9068452778746 L27.3850236521841,52.122339333045 L27.0590114658487,52.0806097731952 L26.7329992795134,52.3619582900012 L26.4069870931777,52.0496386154927 L25.5782641155125,52.089086090037 L25.326908719848,52.163742880707 L25.2480137707551,52.5917968813712 L24.7769261614996,52.644610855554 L23.6655506182822,51.421087120238 L22.7804275323812,51.3281736471307 L22.6875140592753,50.7690627475662 L22.1264470865919,50.6781053475765 L21.7939146565295,50.260809749069 L22.494840857151,50.2132119698637 L22.8208530434866,49.8757893570059 L23.282486299338,49.7933082738651 L23.4728774161576,49.5165239276631 L23.904843563052,49.4376289785699 L23.94689913509,49.0056628316772 L23.798889602493,48.8576532990793 L23.5798094132758,49.1125948287963 L23.1468652298226,49.1337856209102 L22.9000740047665,49.4108959792954 L22.3442232270644,49.5070695742624 L22.2317490227785,49.7206075563128 L21.7906545346663,49.7098491541608 L21.4369313124923,49.331675018012 L21.3978098501327,48.0276262726706 L20.6179887004177,47.3756019000011 L20.7428513677842,47.049589713664 L20.5387677391378,47.0264428484347 L20.3633731828894,47.2002073437506 L19.8867433664671,47.2295484405209 L19.5607311801314,46.9609143989799 L19.3227422841065,46.9615664233533 L19.2347189937961,46.6727196262596 L19.2096160554482,47.074692652011 L20.3027349162309,48.2636590955746 L20.5935377864425,49.0604328789823 L19.8867433664668,49.0927080854268 L19.5607311801314,48.7820184718505 L19.2347189937961,48.786256630276 L18.9087068074607,49.1077046459997 L17.9306702484538,48.2545307543594 L17.6046580621185,48.5306630761857 L17.2786458757829,48.2848498876885 L17.0595656865655,49.1125948287963 L16.6266215031122,49.1647567786057 L16.4606813002671,49.0056628316772 L16.4942605554594,48.3536384590054 L16.3006093167765,48.2675712418147 L16.0975037246889,48.4765450532516 L15.8650570358319,48.4631785536155 L15.6485849441053,47.9389509579842 L15.290949575695,48.0276262726706 L15.209772541298,48.3536384590077 L15.4699302659936,48.6796506453448 L15.3225727577696,48.7839745449682 L14.6705483850987,48.8012531908444 L14.344536198763,48.4886075041504 L13.9067018325146,48.4654606389211 L13.7577142633593,48.0928287099352 L13.9468013314337,48.0276262726706 L13.692511826092,48.0015452977648 L13.3664996397561,48.2264937063359 L13.0404874534208,48.1260819529432 L12.956376309346,48.2695273149301 L12.1494961481657,48.2665932052558 L12.1110267101789,47.9790504569065 L11.8042492428365,47.7016140863335 L11.9180274958682,47.3756019000011 L11.0844143354078,47.5611028340256 L10.1063777764015,46.6844560649681 L9.27732878654991,46.5745899581725 L9.1283412173946,46.3304068306075 L8.21322501035084,46.3346449890307 L8.15030465838827,45.9343020242115 L7.7682183760029,46.0715531546574 L8.00425119890981,46.3975653409921 L8.80232903105896,46.4552694979715 L9.08041742600323,46.77150131872 L9.45435340373023,46.8089927201489 L9.71516315279862,47.1147921509309 L10.2459109921529,47.2360686842497 L10.0398712903884,47.961119786657 L9.73407185960612,48.0276262726706 L10.1063777764012,48.0608795156763 L10.2283063340907,47.8235426440256 L10.4323899627368,47.8000697666085 L11.2060168809109,47.9060237271687 L11.5731066027248,48.3536384590077 L11.8691256679174,49.9836993906838 L11.7364387080788,50.1333389842093 L11.0120396300414,50.2373368716542 L10.9086937669727,50.7860153812568 L10.5363878501782,51.2877481360252 L10.7584021490722,51.3190453059132 L11.0844143354078,51.0699719955539 L11.5639782615075,51.6137603223623 L10.8764185605259,52.3838011064862 L10.3424105993081,52.5018175179428 L10.1063777764009,52.7906643150319 L9.45435340373023,52.5745182354927 L9.07096307259934,52.8604309229076 L8.71821788698451,52.917809067706 L8.15030465838856,53.5114772590206 L6.93395319117037,53.5698334403755 L8.05934725840068,53.660464828175 L8.15030465838827,53.8068442998384 L8.63573680384167,53.4035672253426 L9.20756217867449,53.3230422153195 L9.78036559006557,53.0390856010178 L10.9494452902649,53.0527781128463 L11.0844143354078,53.1593840977799 L11.6057078213585,52.917809067706 L11.4814971783644,52.5917968813712 L11.7364387080788,52.1070167602865 L12.0070288227372,52.647218953045 L12.3095681316571,52.6706918304621 L12.3884630807501,52.8115290949556 L12.5133257481164,52.5917968813712 L12.1794892693087,52.2657846950318 L12.2916374614079,51.5169347030196 L12.8403159710109,51.4135888399527 L12.9547462484147,50.8759947446853 L13.3664996397564,50.8398073920007 L13.6925118260917,50.5203154493901 L14.0185240124277,50.5216194981368 L14.3445361987627,50.8404594163741 L14.7553115535459,50.8769727812441 L14.996560571434,51.4409738636006 L15.4086399749624,51.3738153532159 L15.6485849441053,51.1042032751184 L15.9745971304403,51.4403218392296 L16.5125172378938,51.4018524012441 L16.9526336894472,51.7911109517281 L17.3712333367018,51.8471850477753 L17.4778393216339,52.0665912491811 L18.0154334169011,52.1810215265832 L18.3737208096835,52.5917968813689 L18.3502479322678,53.011374565182 L17.6046580621185,53.1319990741251 L17.4243733230747,53.3895487013285 L16.9699123353231,53.5698334403755 L17.6046580621182,53.6917619980653 L18.5826946211248,54.2974926402785 L18.9087068074607,54.0474412933558 L19.2347189937961,54.4611507578158 L19.5607311801314,54.2453306904599 L20.2694816732252,54.8171560652918 L20.3751096215973,55.3635524895936 L20.9358505820949,55.8519187447235 L20.9325904602311,56.5039431173954 L20.6802570280078,56.6454324062645 L20.5906036767657,57.2078034276934 L20.2127555528024,56.9525358857909 L19.4929206453737,57.1559674900649 L19.5607311801314,57.7189905358672 L19.8867433664671,57.3228857294712 L20.618314712604,58.1340040490715 L20.0637679836471,58.6370408525889 L19.9512937793613,59.1765910209741 L19.6285417148897,59.5058633291709 L16.6266215031122,59.5821501807777 L16.0805510909997,59.332098833855 L15.5967490064779,59.3865428689722 L14.3132390288745,60.0587799971968 L13.6814274117562,61.0681137260891 L13.6833834848748,61.4032542536437 L14.0185240124274,61.22753368521 L14.5218868281294,60.5934399827854 L15.0291617900678,60.4486905720542 L15.6485849441053,59.9257670251719 L17.6046580621185,59.9639104509741 L18.1116070118702,60.4160893534218 L18.1702892054104,61.0681137260891 L19.0475879988391,62.046150285098 L18.9087068074607,62.256428145284 L18.2566824347895,62.1850314764761 L17.9769639789136,62.3721624714328 L17.8954609323296,62.6981746577675 L18.3587242491126,63.0241868441046 L18.9087068074607,63.1392691458824 L19.9659643277467,63.1034078053857 L20.2091694187528,63.0241868441046 L20.0389910574856,62.6981746577698 L20.5387677391378,62.61438952588 L21.5168042981447,62.6923064384144 L22.1688286708157,62.5755940757068 L22.3168382034124,62.8461841903654 L21.8711795446914,62.9958237838932 L21.5168042981447,62.7291458154723 L21.1454764179087,62.9788711502049 L20.9378066552126,63.4232257601772 L20.5387677391381,63.5109230383047 L20.8439151455479,64.328235589446 L20.6831911376846,64.472658987994 L20.4103189377219,64.4566843908622 L20.2127555528027,64.2209775801414 L19.6409301779702,64.2480365916084 L19.5607311801314,64.0837264496955 L19.5258478761936,64.328235589446 L19.8261050998089,64.6542477757831 L19.0087925486656,65.406357889662 L18.5826946211245,65.4572157907294 L18.2566824347898,65.1569585671126 L17.7885289352114,65.1224012753603 L17.6636662678451,64.9212517563918 L17.2786458757826,64.8231220883047 L17.5371735395466,65.3737566710251 L17.9306702484538,65.4474354251362 L18.0920462806902,65.632284334792 L17.9306702484536,65.7770337455232 L16.9526336894469,65.827565634405 L16.6266215031119,66.1878091003043 L15.9644907526642,66.2843087074569 L16.4473148006272,66.4636154099451 L16.4316662156832,66.7413777927012 L15.9745971304406,66.8642843869498 L15.9745971304403,67.251912876504 L16.4505749224907,67.4383918470873 L16.491978470155,67.7797266061805 L16.253663561944,67.9613153939673 L16.6024966013232,68.2403818254748 L16.1669443203788,68.4327290154089 L15.9745971304403,68.684084411076 L15.6485849441053,68.6449629487126 L15.0144912416826,69.2184183844791 L15.3519138545399,69.2477594812493 L15.6485849441053,69.0573683644305 L15.9745971304406,69.2281987500699 L16.3006093167765,69.1750587636994 L16.6266215031122,68.6566993874235 L17.4569745417084,68.892406198142 L17.6046580621188,69.1356112891504 L17.678988840603,68.9667369766264 L18.2824373975098,68.9181611608646 L18.4646782096714,68.4483776003552 L19.2347189937961,68.3844792118326 L19.5995266303059,68.8924061981443 L19.4476049514728,69.2184183844791 L20.0644200080196,69.5444305708161 L19.6210434346035,70.5224671298205 L19.715586968641,70.8484793161575 L20.2029751872124,70.8582596817484 L20.2127555528027,71.1275457476604 L20.2619833929393,70.897707156295 L20.8647799254734,70.4253154982922 L20.8853186932128,70.1759161757474 L20.5387677391381,70.095391165722 L20.3751096215976,69.8704427571509 L20.7783866960949,69.5444305708161 L20.8135960122188,69.1672344712262 L21.190792111809,69.5418224733251 L21.5572298092501,69.5851820941071 L21.9657230787286,68.8924061981443 L21.6045015762693,68.2403818254725 L22.099714087313,67.5192428692982 L22.8208530434869,67.4921838578335 L23.1468652298226,67.1704098299197 L23.9041915386799,67.9143696391377 L23.7988896024932,68.3522040053858 L23.1468652298223,68.3799150412262 L22.8208530434869,68.7287480806024 L22.2591340464308,68.892406198142 L22.4948408571513,69.0417197794866 L23.549490279947,69.1418055206891 L23.3072632254995,69.5444305708161 L23.516889061313,69.8704427571509 L23.4728774161579,70.0226904481698 L23.1468652298226,70.1325565549677 L22.3654140191759,70.0670281055129 L22.0068006142074,70.8484793161575 L22.7494563746793,71.2458881713002 L22.5760178915492,71.8265158751641 L23.055907829835,72.2434854614885 L23.1468652298223,72.6663232671637 L23.5237353172258,72.478540247836 L23.7724826154001,72.8309594212645 L23.6512060820837,73.3088932864325 L22.4948408571513,73.3623592849909 L22.1688286708157,73.7105402999961 L21.84281648448,73.6720708620084 L21.5970032959831,73.2107636183478 L21.6234102830762,72.911158419102 L21.8294499848404,72.8045524341708 L21.5422332486789,72.478540247836 L21.3746629849025,72.478540247836 L20.824680426554,73.7825889931774 L21.073101712542,74.1086011795098 L20.9606275082561,74.4346133658469 L21.6253663561945,74.652063494135 L21.5168042981447,74.9089610969674 L20.1292964331004,75.0031786188145 L19.8867433664671,75.2907213671661 L19.6689672259949,75.0866377385188 L19.5607311801311,74.4796030475611 L19.5186756080944,74.7185699801463 L18.9722791837955,74.6970531758492 L18.7932984934978,74.3192050518883 L18.5826946211248,74.3527843070771 L18.5993212426277,74.7772521736845 L17.8237382513359,74.979705741402 L17.124442111646,74.9148293163182 L16.7426818414476,74.6445652138474 L15.9745971304406,74.6680380912645 L15.8249575369128,75.0866377385188 L16.5007807991862,75.5384906287833 L16.4639414221303,75.9023202287302 L15.9540583627015,76.0441355297871 L15.4392851204776,75.9479619348177 L15.3225727577699,75.7350759771384 L14.9965605714343,76.153675624395 L14.5316671937197,76.2518052924798 L14.0185240124277,76.5735793203959 L13.8473676146013,76.8715544587071 L13.4290939795326,76.9801165167561 L13.3664996397564,76.8761186293159 L13.1379650971354,77.042710856532 L14.344536198763,77.3419900435876 L14.6705483850989,77.2683112894764 L14.7112999083908,77.6947352292038 L14.9323361707262,77.7589596299119 L14.9965605714343,77.9460906248686 L15.3225727577696,77.535641282273 L15.9745971304403,77.5747627446295 L16.0935915784532,77.1617053045452 L16.3006093167765,77.0652056973926 L16.9728464450003,77.348510287314 L16.9082960321055,77.7390728865424 L17.4321976155466,77.848286968967 L17.6483436950872,77.6510495962317 L17.2786458757829,78.2042922764454 L16.6266215031122,78.1775592771662 L15.943299960553,78.3467596018734 L16.3006093167762,78.7562309079101 L16.7508321461057,78.7973084433912 L16.9816487740311,78.6437567036234 L16.8505918751244,79.3247961608823 L17.0999911976709,79.6508083472148 L16.0613163720058,80.7155641477877 L14.6705483850989,80.7680521097896 L14.344536198763,80.9199737886229 L14.0185240124274,80.5274551162722 L13.5963382311232,80.5326713112543 L13.0404874534211,80.7377329764605 L12.3884630807501,80.4746411420895 L12.1915517202037,80.7579457320132 L11.7364387080791,80.8254302545834 L11.0844143354078,80.1828602353169 L10.7584021490722,80.5313672625099 L9.29232534712112,80.6288449062237 L10.1063777764015,80.7690301463485 L11.0844143354078,80.7341468424083 L11.3299015117186,81.0353821025839 L11.8789060335074,81.1384019534652 L12.0624508944142,81.3656324473419 L12.2518639746755,81.1442701728207 L12.5133257481164,81.1560066115292 L12.7144752670857,81.4653921763612 L13.0385313803031,81.6068814652303 L12.1253712463776,81.6698018171894 L11.7364387080791,82.0189608687581 L10.4323899627368,82.0228730149935 L9.1283412173943,81.7653233877878 L8.86850950488564,82.3250863117303 L8.15030465838856,82.3563834816159 L7.82429247205263,82.6840257288852 L7.17226809938165,82.6866338263739 L6.84625591304573,83.0142760736386 L6.37288621848669,83.0895848886842 L5.9402680472192,83.6350032764225 L5.54220716770406,83.6747767631546 L4.96712167100801,84.2919178318886 L4.42594144169068,84.4027619752408 L4.31803140801388,84.6208641279022 L3.84466171345484,84.7995188060147 L3.74294591131813,85.0238151902125 L3.21317610852297,85.1460697600878 L3.13102103756652,85.3899268754672 L1.95607311801323,85.4626275930195 L1.86478970583898,85.7537564754187 L1.6300609316776,85.8000502058773 L0.65202437267127,85.8085265227215 L0,85.6738834897666 L0,86.0161962854164 L0.978036559006615,86.0256506388241 L1.06214770308107,85.9291510316668 L1.95607311801323,85.9082862517408 L2.28208530434858,85.5861862116414 L3.26012186335519,85.6021608087709 L3.43030022462238,85.3631938761857 L3.98191284390188,85.2627821227977 L4.23815842236181,84.9758913988217 L4.65349794775341,84.9566566798255 L4.8901827950325,84.6586815415143 L5.3563802214926,84.6811763823749 L5.7472688329091,84.0940284347845 L6.30377163498345,83.9985068641884 L6.75366845212653,83.470367122324 L7.17226809938165,83.4612387811088 L7.498280285717,83.1287063510453 L8.47631684472361,83.1629376306098 L8.80232903105925,82.8157346521612 L10.1063777764009,82.8144306034168 L10.4323899627368,83.1335965338396 L10.8324069153706,83.1629376306075 L10.7584021490719,83.4263554771687 L9.45696150122128,83.5603464857525 L9.4475071478171,83.2369423969088 L9.45370137935747,83.5636066076169 L10.5585566788484,83.7628000534676 L10.6775511268616,84.2958299781286 L11.7364387080791,84.0728376426729 L11.8172897302903,84.6218421644611 L11.602447699495,84.7330123199988 L11.4231409970109,85.2060560023749 L10.3955505856807,85.4821883242012 L11.0498570436564,85.8450398875939 L10.7584021490722,86.0249986144484 L10.0724725090222,86.1371468065496 L10.5882237878053,86.4970642602611 L10.1875548107988,87.2302656673317 L9.67701972699754,87.2524344960021 L9.45435340373023,87.0167276852813 L9.31058202955615,87.3313294450953 L8.69800513143178,87.47510081927 L9.04064393927082,87.5627980973929 L9.27341664031391,87.8011130056047 L8.95522874645085,88.2800249073317 L7.82429247205292,88.7380720291349 L7.80570977743181,89.0865790563256 L7.02817071302148,89.1051617509461 L7.79038720467334,89.4650792046622 L8.47631684472332,89.3007690627493 L8.97804959949405,88.6288579467102 L9.53031424314631,88.5290982176933 L10.3120914659793,87.6808145088472 L11.7723000485758,87.5109621597667 L11.7843624994702,87.4271770278792 L10.9605297046004,87.2729732637403 L10.9266244372214,86.8230764465982 L11.5323550794326,86.2929806316137 L11.9793177868986,85.1102084195934 L12.1635146721784,85.091951737156 L12.3884630807498,85.3221163407092 L12.9759370405263,85.1930155149174 L12.5909166484644,84.9905619472069 L12.2714247058552,84.5409911422501 L12.640470500787,84.1409741896164 L13.1757825107504,84.0242618269065 L13.6123128282536,83.482755585406 L14.3445361987633,83.6115303990076 L14.9965605714343,83.1668497768452 L15.3225727577693,83.2480268112417 L15.7411724050242,83.0035176714912 L15.8598408408504,82.4701617346447 L16.1675963447513,82.1258928658772 L16.6266215031125,82.1193726221461 L16.8473317532612,82.6902199604238 L17.1325924163047,82.9109302105694 L17.1694317933605,83.5629545832458 L17.455996505149,83.7116161402125 L17.9306702484538,84.4568799981748 L17.9815281495221,83.2369423969064 L18.6524612290008,82.9109302105694 L17.9306702484538,82.6357759253042 L17.6046580621188,82.7883496285109 L17.4820774800563,82.7074986062977 L17.4846855775468,82.4649455396649 L17.7542976556463,82.2589058378998 L17.6330211223296,81.606881465228 L18.5826946211248,81.5371148573546 L18.9087068074605,81.2117546953909 L19.5607311801311,81.2130587441352 L19.8867433664671,80.8876985821738 L20.5387677391378,80.8886766187326 L20.8647799254737,80.5639684811422 L21.3723808995981,80.4844215076757 L21.8007609124429,79.9347649615142 L22.3703042019711,79.8522838783734 L22.4948408571513,79.5891920439977 L22.8870335173133,79.5846278733936 L23.1468652298226,79.827180940024 L23.3884402598971,79.5663711909562 L23.6322973752757,79.6508083472171 L23.8846308074999,80.3885739248964 L22.7129430098095,80.6288449062237 L23.047757525176,80.9548570925585 L22.8104206535242,81.2808692788955 L23.2978088720956,81.4559378229558 L23.4728774161576,81.8412842272044 L23.9136458920829,81.8181373619751 L24.3690849163942,82.3407348966719 L24.9272177794004,82.4346264063358 L25.4289505341708,83.2587852133914 L25.5469669456249,82.7032604478767 L25.9107965455749,82.5849180242369 L25.4289505341708,82.5125433188702 L25.1658586997981,82.1959854859384 L24.64260914073,82.0672106723367 L24.491991510643,81.5658039297515 L24.1249017888292,81.4957113096903 L23.9296204892138,81.2808692788955 L24.1249017888292,81.0826538696036 L24.9627531077113,81.0950423326832 L25.7549627205065,81.3933434831799 L25.7155152459602,80.9548570925585 L25.1029383478355,80.830972461751 L24.676188395922,80.4035704854647 L24.7769261614999,79.2478572849068 L25.149232078295,79.2785024304214 L25.9088404724572,80.4749671542727 L26.5895539175254,81.0983024545476 L27.1278000371653,81.2120807075787 L27.7110358385197,81.7848841189718 L27.9620652219981,81.5318986623725 L28.3630602111907,81.5025575656022 L28.6890723975263,81.8223755203961 L29.4219477924091,81.8520426293541 L29.6671089565329,82.1343691827237 L30.3191333292036,82.1255668536894 L30.6451455155396,82.4378865282025 L31.2971698882105,82.4287581869804 L31.6486110250801,83.262371347439 L31.800858716099,82.7625946657906 L32.1451275848691,82.4548391618885 L32.6012186335522,82.3955049439747 L32.9272308198878,82.6931540701004 L33.4149450506456,82.7492281661498 L33.9052673788945,83.2463967503095 L34.1999823953416,83.2056452270162 L34.2224772361995,82.9109302105717 L32.9272308198878,81.8582368608974 L32.2752064472172,81.7043591089441 L31.9491942608815,82.1037240372044 L30.9711577018746,82.0825332450929 L30.9711577018746,81.5149460286841 L30.3191333292036,81.4412672745684 L29.9931211428683,81.735656278832 L29.8027300260481,81.471260395712 L29.0150845838617,81.3946475319266 L28.8338218082593,81.136119868162 L28.3630602111907,81.0591809921842 L28.1853835696376,80.8065215477774 L27.6461594134388,80.6937213313051 L27.3850236521844,80.4042225098404 L26.6765991712773,80.3592328281262 L26.3489569240094,79.9187903643847 L26.7329992795134,79.5618070203452 L27.3850236521838,79.5474624841479 L27.7110358385197,79.2276445293541 L28.6532110570293,80.0126818740486 L29.4522669257376,79.8656503780118 L29.5735434590549,80.0703860310279 L30.2180695514403,80.4038964976549 L30.3191333292036,80.6252587721738 L30.6451455155396,80.365101047477 L30.6268888331042,79.9585638511145 L30.8951968624585,80.0527813729662 L31.3320531921478,79.9768205335495 L31.2009962932414,79.6508083472171 L30.5108284947691,79.4591131816516 L30.4880076417256,79.1676582870646 L30.7677260976015,78.9987839745452 L30.3191333292036,78.9293433788573 L29.9931211428683,79.1673322748814 L29.3410967701973,79.1402732634143 L29.0150845838617,78.8462102713409 L28.2880774083332,78.7477545910683 L28.1475661560229,78.2362414707067 L27.3201472271032,78.08562384062 L27.6005177073519,77.6947352292038 L27.2849379109796,77.3687230428691 L28.0370480248553,77.2761355819496 L28.3630602111907,76.9484933346803 L29.015084583862,76.9432771397028 L29.5530046913155,77.4828273080857 L29.993121142868,77.5503118306558 L30.3191333292042,76.9321927253653 L31.4076880193784,76.9321927253653 L31.6231820745456,77.1744197798103 L31.8383501175276,76.9318667131775 L32.9272308198878,76.9005695432872 L33.2532430062241,76.5683631254115 L34.3577722935286,76.5902059418987 L34.4086301945968,77.042710856532 L34.6104317379383,77.0958508429049 L34.761701392398,76.2690839383582 L35.2996214998521,76.1549796731416 L35.5353283105723,75.8615687054369 L35.861340496908,75.8941699240738 L35.9829430424108,75.5342524703554 L36.4533786272932,75.4126499248558 L35.9950054933057,75.2789849284575 L35.9412134825601,75.0866377385188 L35.9774008352434,74.8766858905183 L36.5661788437652,74.760625552184 L36.6587663046847,74.4346133658469 L36.5009764064979,74.4222249027673 L36.3735056416406,74.6207663242471 L35.8258051685977,74.7250902238728 L35.2536537815785,75.4569875821967 L34.6854145407955,75.8667849004213 L34.4236267551686,75.8723271075889 L34.2068286512547,75.7142111972123 L33.9052673788945,76.2234422322684 L33.6043581309073,75.7135591728436 L33.0944750714782,75.5714178595988 L32.9272308198878,75.1639026266798 L32.9272308198878,76.0871691383813 L32.7358616665094,75.9300312645705 L31.9821214917017,76.0976015283455 L30.3191333292039,76.1921450623827 L29.8164225378743,75.7386621111906 L30.8159759011795,74.9314559378234 L30.8886766187321,74.6781444690409 L31.5283125283226,74.3397438196265 L31.5524374301116,73.7825889931774 L31.8148772401113,73.6482719724081 L31.9185491153663,73.0999194749909 L32.1842490472296,73.0396072205182 L32.516781477292,72.3941030915752 L33.1479410700369,72.047226125312 L33.4338537574531,71.6811144400596 L33.5365475961493,70.8484793161599 L33.8205042104475,70.7637161477112 L33.8772303308694,70.1684178954621 L34.1481464577151,70.1133218359738 L34.2312795652301,69.6448423242065 L34.5572917515657,69.4942246941198 L35.2093161242364,70.0305147406429 L35.5353283105723,69.8362114775864 L35.4681698001871,70.1964549434857 L35.9288250194796,70.2639394660582 L36.3819819584856,69.8704427571509 L36.4181693111687,69.1232228260685 L37.8174136149209,69.0971418511627 L38.104304338896,70.2355764058445 L38.756654723754,70.561262579996 L39.8915031443876,70.7304629047009 L40.0166918239409,71.2572985978256 L40.2429442812572,71.3570583268379 L40.4255111056051,71.775331961909 L40.7515232919411,72.0883036607931 L41.1675148417051,72.1525280615012 L41.255864144202,71.8265158751641 L40.5353772124002,71.1744915024923 L40.772388071866,70.5224671298205 L40.5441795414316,70.4037986939951 L40.446049873344,69.8499039894104 L39.7734867329344,69.6930921277874 L39.6248251759652,69.5444305708161 L39.5967881279405,69.2184183844791 L40.0062594339778,68.7991667128515 L40.2272956963132,68.7646094211014 L40.4255111056051,68.9478282698204 L40.8353084238288,68.5663940118118 L40.4255111056051,68.1099769509385 L40.0994989192695,68.0933503294334 L39.7734867329341,68.3652444928411 L39.6782911745245,67.9143696391377 L40.0994989192695,67.4902277847135 L41.0775354782764,67.4599086513867 L41.4035476646117,67.7891809595859 L41.6330602437919,67.8178700319828 L42.3209459569602,67.5883574528029 L41.7295598509471,67.449150249237 L41.4035476646117,67.094448990503 L40.3635687902011,66.998275395536 L41.4035476646117,65.8820096695223 L42.055572037283,65.8787495476579 L42.3815842236181,66.1982414902685 L44.4638240577434,66.0844632372374 L44.1485702735572,65.1693470301899 L43.9082992922279,64.9802599621178 L43.9131894750231,64.5557920955105 L44.4498055337311,64.1143715952101 L44.2229010520414,63.6762112167765 L44.5948809566501,63.3501990304417 L44.6033572734951,62.6981746577675 L44.8752514368984,62.5837443803654 L44.9896817143026,62.3177184363155 L45.165076270551,62.6981746577675 L44.9613186540915,63.052549904316 L45.3564454239298,63.0649383673979 L45.6417060869736,62.5987409409361 L46.0234663571728,62.6424265739082 L46.2937304596448,62.9296433100651 L47.2717670186514,62.9518121387378 L47.7858882365023,62.5602715029506 L47.867717295273,62.3160883753833 L48.0290933275087,62.91888490792 L48.9533378757697,63.0241868441046 L48.9585540707512,64.0022234031089 L48.7016564679186,64.128064107034 L48.6181973482172,64.3706171736738 L47.9237913913221,64.3966981485773 L47.5977792049865,64.0801403156433 L47.2717670186512,64.4015883313739 L46.4511943456446,64.4856994754469 L45.8096023629367,65.148156238083 L45.7186449629488,65.7092232107652 L44.8778595343895,65.8464743412111 L45.1937653429485,66.406237265149 L45.730381401657,66.5216455791122 L46.2937304596448,67.0748882593236 L46.9457548323158,67.0807564786791 L47.3627244186385,66.7012782937836 L47.3627244186385,66.5193634938067 L46.6197426459805,66.4460107518857 L46.4805354424148,66.2843087074569 L46.507268441694,65.9582965211245 L46.9457548323158,65.5247003132996 L48.901827950329,65.5416529469879 L49.2278401366641,66.1685743813104 L49.4814776176335,65.8859218157577 L49.8798645093354,65.8556026824286 L50.205876695671,65.553715397882 L50.6329526597709,65.9582965211245 L50.4295210554971,66.7126887203043 L50.9824377235225,66.8117964249503 L50.6593596468637,67.2623452664635 L50.93549196869,67.6659483531494 L50.4102863365033,67.7927670936358 L50.2058766956713,68.0946543781847 L49.8798645093354,67.8612296527648 L49.6741508197581,67.9143696391377 L49.6999057824782,68.3864352849527 L48.9660523510368,68.5663940118118 L49.2278401366641,68.6319224612597 L49.4172532169252,68.8924061981443 L49.0012616671614,69.3178521013128 L48.5758157639934,69.3801204289032 L48.3612997453847,69.655926738544 L47.8625011002912,69.8091524661194 L48.0506101318067,70.323273683972 L47.2717670186512,70.7549138186792 L46.2937304596448,70.8096838659843 L46.2200517055328,71.1008127483812 L45.7411398038059,71.1744915024923 L46.2937304596448,71.2556685368911 L46.3791456524645,70.9338945089772 L46.9457548323158,70.9241141433864 L47.5977792049865,71.5569037970643 L48.2498035776578,71.0717976637941 L48.4454108894589,70.3920622552889 L48.7759872464033,70.0706142395582 L49.553852323,69.9477076453119 L49.4576787280306,69.4482569758444 L50.205876695671,69.3970730625916 L50.5318888820069,69.0945337536716 L51.3811506274107,69.0896435708774 L52.2610575183305,69.771335052505 L52.3839641125785,70.3004528309282 L52.8139741863552,70.7650201964556 L53.029468241523,70.9589974473242 L53.6277006034486,71.0127894580704 L54.1180229316972,71.5741824429405 L54.1542102843803,71.1744915024923 L53.9171994249142,71.0493028229405 L53.8630814019834,70.7774086595375 L53.4659985590262,70.3689153900573 L53.1399863726908,70.397930474642 L52.7024780186282,69.9819389248788 L52.6063044236591,69.4260881471763 L52.039369231622,68.892406198142 L52.0804467671002,68.4848909652229 L52.8139741863552,68.4324030032257 L53.1399863726908,68.6668057651999 L53.7714719776227,68.5663940118118 L53.325813318902,68.3805670655995 L53.3659128178214,68.1402960842653 L54.5395566886289,68.0098912097314 L54.3168903653621,67.5883574528029 L54.7700473043682,67.1479149890637 L56.0740960497104,67.1466109403147 L56.4900875994742,67.4983780893745 L56.7261204223814,68.0010888807041 L57.1127708753755,67.9750079057959 L57.3781447950529,67.7539716434579 L57.942471889599,68.3280791035954 L58.9505015697489,68.2980859824541 L59.0082057267302,68.4115382232997 L59.0082057267302,68.2116927530755 L58.2058897361584,68.0646612570365 L57.7041569813883,67.439043871463 L56.9566110381207,67.3578668370619 L57.0068169148167,66.655636587696 L56.5699605851271,66.4404685447135 L56.5314911471388,66.2843087074569 L56.7261204223811,65.5511073003886 L57.3781447950527,66.1966114293363 L57.8524925261708,66.1066320659102 L58.0301691677239,65.5406749104314 L59.0848185905191,65.5556714709997 L59.2311980621839,65.9582965211245 L58.9974473245811,66.2843087074569 L59.3342179130656,66.309737657994 L59.3671451438857,65.9912237519446 L59.6833769646311,65.9814433863561 L59.9862422857366,65.523070252365 L60.3122544720722,65.8419101706023 L60.6382666584078,65.8402801096724 L60.9205932117748,66.001982154092 L62.2083413477997,66.0182827634116 L62.2683275900854,66.1089141512111 L62.9203519627564,65.7949644157727 L63.5929151031671,65.6528231025279 L63.4475136680614,65.1814094810863 L64.224400708099,64.8299683442167 L65.0469294542232,64.8097555886663 L65.258511363155,65.3062721484526 L65.3732676527449,64.4834173901437 L65.0498635639001,64.0022234031089 L65.3442525681611,63.3501990304417 L64.550412894434,63.2484832283024 L64.550412894434,62.5993929653071 L64.9194586893659,62.4151960800293 L65.3706595552539,62.5299523696215 L65.4815036986087,62.7451204126018 L66.1804738261119,62.8233633373217 L66.5064860124472,62.4552955789492 L68.8684443024479,61.7201380987632 L68.81758640138,61.3651108278437 L68.1365469441248,61.1088652493847 L67.8105347577892,61.1952584787632 L66.9840938654289,60.4160893534218 L66.6209162898508,60.3016590760151 L66.3565204067331,59.9140305864633 L66.4161806368324,59.6737596051314 L66.5977694246212,59.6727815685749 L66.8324981987829,59.9319612567151 L68.4625591304608,59.9225069033098 L68.8792027045973,59.8546963685518 L69.1145835031315,59.5638934983404 L69.4405956894671,59.5469408646497 L69.6860828657779,59.76406498075 L69.7141199138023,60.0375892050829 L69.5194906385603,60.0900771670871 L69.7313985596779,60.1252864832104 L70.4792705151319,59.4380527944152 L69.2518346335788,59.300801663967 L68.7885713167958,59.1179088274336 L68.4625591304605,59.1971297887123 L68.2571714530688,59.5586773033583 L67.8105347577892,59.594538643855 L67.666437371429,59.2939554080574 L68.1062278107954,59.1120406080781 L67.3775905743362,59.0051086109614 L67.2745707234534,59.2281009464148 L66.1804738261116,59.2339691657679 L66.1804738261119,58.9718553679534 L67.28467710123,58.912195137854 L67.4845225714539,58.5734684762519 L68.5541685548205,58.2256134734322 L68.4625591304605,57.5879336369599 L69.4405956894674,57.4193853366261 L70.1154409151816,57.8079918627391 L70.6223898649332,57.930246432612 L70.7446444348085,58.3387397020899 L70.8166931279894,57.8800405559157 L70.5878325731818,57.6387915380296 L70.5363226477408,57.1559674900649 L71.0706566211444,56.6705353446115 L71.3966688074803,56.8958097653704 L72.0486931801516,56.4759060693695 L72.3747053664867,56.5355662994688 L73.0267297391576,56.2092281009462 L74.0047662981648,56.2092281009462 L74.1312590264622,55.9784114730243 L74.3307784844999,55.9823236192574 L75.0382249288481,56.448521045717 L75.0675660256184,56.7451921352838 L75.3088150435065,56.9329751546138 L75.7574078119038,56.6268497116417 L76.6128637888487,56.5391524335164 L76.9176851830722,56.1567401389467 L77.2648881615194,56.1260949934344 L77.6658831507123,56.4289603145376 L77.7389098804512,56.8299553037278 L77.4200699622154,57.1559674900649 L77.375406292687,57.5924978075687 L76.2868516025128,57.7691964125635 L76.1561207157922,58.0032731623521 L75.3163133237921,58.1340040490715 L75.9608394161775,58.3566703723394 L76.2868516025128,58.2132250103503 L77.2648881615194,58.2842956669727 L77.5909003478551,58.5998754633455 L78.0469913965385,58.655949559395 L78.6413116122282,59.1844153134449 L80.4689359288252,59.1681147041276 L80.5064273302538,59.4566354890358 L80.8047284807508,59.4843465248761 L80.8510222112105,59.8429599298432 L81.0671682907505,59.8739310875457 L81.1555175932476,60.1115939713819 L81.4978303889,60.0900771670848 L81.2174599086516,60.049651655977 L81.1770343975462,59.6616971542397 L81.014354316564,59.4380527944129 L80.652480789732,59.3105820295579 L80.5250100248749,59.0396659027091 L79.8729856522042,59.020105171532 L79.5469734658683,58.6839866074209 L78.4349458982779,58.5940072439924 L78.5689369068617,58.2402840218173 L79.220961279533,58.1476965608978 L79.3269152400918,57.9139458232947 L79.9577488206508,57.8079918627391 L79.5469734658683,57.6899754512824 L78.5689369068617,57.7564819372961 L78.242924720526,58.0163136498027 L77.757166562886,57.4819796763997 L78.0316688237809,57.2707237796548 L78.1425129671346,56.7295435503398 L78.6383775025513,56.5733837130833 L78.8949490931973,56.2574779045225 L79.3164828501287,56.1779309310583 L79.1423923426258,55.7733498078158 L79.5469734658683,55.5272106071331 L79.7944167152971,55.1213254351463 L80.1989978385393,55.0003749140131 L80.5250100248746,55.2279314200753 L81.1770343975462,54.9583193419801 L81.5030465838815,55.0450385835441 L82.4080564131489,54.5478699993798 L81.5245633881798,54.5263531950804 L81.1770343975462,54.7822727613563 L79.5978313669368,54.4970120983125 L79.2522584494209,54.1905606431571 L79.2578006565885,53.8590062496547 L78.4505944832218,53.6881758640154 L78.4786315312469,52.5014915057526 L78.6706527089987,52.4900810792319 L78.8949490931973,52.7378503408468 L79.220961279533,52.7368723042879 L79.5469734658686,52.7277439630728 L79.8729856522042,52.4907331036053 L80.4004733696947,53.0423457228845 L80.8510222112108,53.0964637458162 L81.1770343975459,52.7737116813435 L82.4445697780184,52.5917968813712 L82.4810831428879,52.1960180871538 L82.6643019916089,52.4085780326476 L83.2827471090875,52.4421572878411 L83.7851318882298,52.7094872806354 L84.4371562609011,52.0662652369933 L84.7631684472364,52.4327029344358 L85.2091531181441,52.4718243967946 L85.4184529417712,52.9178090677037 L85.3183672005664,53.3406468733835 L85.782934566094,53.2855508138906 L86.067217192579,53.0941816605107 L87.3712659379207,53.3093497034932 L86.8209573673867,52.5917968813712 L85.6629620815229,52.3440276197517 L85.7685900298959,51.9123874850422 L84.9666000515102,51.7366669166086 L85.0891806335721,51.4246732542879 L87.0452537515856,51.4188050349325 L87.3712659379209,51.5651845065982 L87.6219693092127,51.2124393209819 L87.8824530460953,51.1469108715318 L88.9191717986418,51.0438910206457 L89.3273390559344,51.2430844664988 L89.765499434369,50.9617359496905 L87.6337057479212,50.6992961396904 L87.3311664390013,50.2696120781033 L88.8122398015241,49.9836993906838 L89.0013268695988,49.584660474609 L89.2549643505674,49.7300619097135 L89.6533512422698,49.7059370079254 L89.9793634286051,49.9504461476782 L91.0506394729037,49.7509266896396 L91.6094243602827,49.4301306982846 L92.2614487329534,49.366232309762 L92.3752269859851,49.1194410847083 L92.5874609192894,49.0588028180501 L92.849574717103,49.0695612201975 L92.913473105625,49.2834252144357 L93.2257927801344,49.0056628316772 L91.7117921867925,48.9032950051692 L91.2834121739474,49.2214828990308 L90.8983917818846,48.6206424396141 L90.3053756149408,48.9446985528335 L89.3273390559342,48.840700665391 L89.0013268695985,48.1616172812544 L88.7545356445425,48.3536384590077 L88.8650537757104,48.6796506453425 L88.6753146832632,48.8296162510558 L88.0232903105916,48.8120115929941 L87.6972781242566,48.5290330152558 L87.3712659379207,48.5166445521716 L87.0452537515859,48.7996231299145 L86.3932293789143,48.7927768740002 L85.741205006243,48.4778491020006 L85.415192819908,48.784300557156 L85.0194140256964,48.7494172532182 L85.2785937138331,48.3536384590077 L85.3082608227898,47.5946820892191 L85.8377046133985,47.472101507156 L86.3932293789143,46.9273351437887 L86.5272203874984,46.531556349576 L86.7906382340573,46.3975653409921 L86.3061841251624,45.6584957145707 L87.3712659379209,45.6056817403834 L87.6972781242566,44.9389868193287 L89.2735470451888,44.767504409316 L88.5432797477971,44.573527158445 L88.8660318122698,43.9801849793183 L89.0013268695988,43.9061802130193 L89.3273390559344,44.0541897456126 L89.6533512422698,43.9215027857755 L89.9793634286051,43.523115894074 L90.7308215181082,43.4634556639746 L90.6313878012761,43.3738023127317 L89.6533512422698,43.3884728611145 L89.3273390559342,43.69329425534 L89.0013268695988,43.4533492861959 L88.8311485083314,43.619289489041 L88.1957507571632,43.7894678503094 L88.141632734232,44.233822460284 L87.6972781242566,44.2817462516748 L87.3712659379207,44.5934139018099 L86.9983079967531,44.3945464681493 L86.7192415652499,44.9243162709436 L84.4371562609014,44.869220211453 L83.6990646710377,44.2015472538395 L83.7039548538322,44.0343030022477 L84.1111440745657,43.6916641944078 L84.7631684472364,43.6789497191404 L84.9431271740939,43.7894678503094 L84.6630827060319,44.1154800366442 L84.7631684472364,44.3009809706686 L85.3402100170508,44.516475025839 L85.8024952972743,44.5027825140104 L86.0401581811131,42.8114312913028 L85.7001274707654,42.770353755824 L85.415192819908,43.2671963278004 L84.4371562609014,43.2417673772656 L84.3732578723791,43.0735450891173 L84.9046577361064,42.9529205801719 L85.2091531181441,42.60539158954 L85.1700316557839,42.4045680827547 L84.1111440745657,42.2686210010532 L83.8477262280066,42.5480134447416 L83.4591197018948,42.5636620296902 L83.0887698582174,42.2037445759741 L83.0740993098328,41.8333947322962 L83.3404512660686,41.7147262964708 L83.4186941907893,41.1409448485188 L83.9882374803172,41.0584637653757 L84.0697405269014,40.8139546256252 L84.6304814873981,40.7229972256379 L84.7191568020811,40.1593221554623 L85.2769636529012,40.0651046336129 L85.4151928199077,39.8072289942217 L86.2298972735603,39.7139895089289 L87.0452537515856,38.716066206555 L87.4433146311007,38.6453215621205 L87.5010187880824,38.2472606826045 L87.7171648676226,38.2273739392372 L88.0232903105916,38.4161349951261 L88.455582469673,38.3538666675357 L88.1494570267037,37.7950817801567 L87.3712659379209,37.7086885507782 L87.3712659379207,37.5072130196242 L87.8537639736975,37.4257099730399 L88.0232903105916,37.173376540814 L88.6753146832632,37.15968402899 L89.0013268695985,37.4716776913107 L89.4541577964185,37.3960428640842 L89.850914627189,36.8147631358469 L90.3353687360838,36.6171997509283 L89.8584129074745,36.4121380857198 L89.8841678701949,36.195992006183 L90.4152417217362,36.0750414850544 L90.8318852958724,35.5136485001821 L91.0894349230779,35.5071282564533 L92.2614487329534,36.0975363259081 L92.7938266332396,36.0848218506407 L92.913473105625,36.3511738068761 L93.3076218389041,36.3593241115371 L92.968895177302,36.2357654929174 L92.9525945679849,35.9260539158954 L92.3615344741588,35.2130652643798 L91.1751761280842,35.0953748651156 L91.1018233861583,34.335114446578 L91.2834121739477,34.050179795722 L91.6094243602827,34.355327202133 L92.1535386992769,34.4430244802559 L92.913473105625,34.9375849669292 L94.5435340373026,34.8244587382691 L94.6664406315512,34.335114446578 L94.1555795355632,34.2731721311754 L93.8243511542461,34.402272956965 L93.9417155413268,33.9588963835469 L93.58114606324,33.3414293026274 L93.6368941471036,33.0310657012366 L94.217521850967,32.6861448080935 L94.8695462236376,32.8139415851363 L95.1955584099736,32.5919272862418 L95.8475827826448,32.9492366424691 L96.1735949689802,32.4941236303425 L96.7027127474032,32.5019479228134 L97.1128360778129,32.7438489650751 L97.4776437143219,32.7334165751109 L97.5082888598376,32.4096864740817 L97.8124582296889,32.3790413285648 L96.9139686441486,32.2906920260685 L96.5794801409682,32.0530291422323 L96.5644835803961,31.7270169558952 L97.0065561050672,31.2559293466368 L97.4776437143221,30.8601505524286 L98.1296680869934,30.8656927595963 L98.8713458109067,30.5126215617945 L99.514893866733,30.4229682105515 L99.5442349635035,30.2074741553858 L100,30.0969560242168 L99.1200931090805,30.0969560242168 L98.2277977550802,30.5210978786386 L97.1516315279868,30.2576800320775 L96.8256193416515,30.5905384743288 L96.4996071553158,30.6224876685901 L95.8475827826448,31.2477790419805 L95.1574149841725,31.1131360090256 L94.9171440028429,30.7013826176833 L94.6918695820851,30.7489803968909 L94.5435340373026,31.1242204233608 L93.8915096646319,30.9240489409535 L93.4526972618237,30.9621923667512 L93.263284181563,31.0749925832257 L93.4491111277741,31.4010047695581 L93.2394852919601,31.587157727956 L92.9134731056253,31.1111799359079 L92.5874609192896,31.3123294548764 L92.1933121860093,31.1431291301669 L91.7140742720966,31.4010047695581 L91.7313529179719,31.7270169558952 L92.0955085301092,31.8929571587403 L92.3096985365312,32.4272911321434 L91.9096815838977,32.4047962912874 L91.0529215582084,31.6314953852992 L90.6313878012761,31.5920479107526 L90.4162197582947,31.8378610992497 L89.8642811268288,31.9379468404569 L89.7267039841951,32.4523940704904 L88.6753146832632,32.4703247407399 L88.3493024969275,32.7940548417714 L87.3712659379207,32.7898166833482 L87.0452537515856,33.1132207721942 L86.2400036513366,33.2038521599937 L86.067217192579,33.4604237506383 L85.4151928199077,33.4760723355846 L85.0891806335724,33.8121908996957 L83.7851318882298,33.8930419219066 L83.4147820445533,34.335114446578 L83.5530112115595,34.5672351232489 L84.1111440745657,34.7709927397084 L84.4371562609011,34.4410684071382 L84.6689509253862,34.6611266329128 L83.5533372237456,36.0593929001058 L83.005310738516,36.1633907875484 L83.1754890997832,36.6595813351515 L82.8745798517954,36.9432119372631 L82.8465428037701,37.3086715981445 L82.5977955055964,37.3859364863055 L82.1550709565528,37.9776486045046 L81.7615742476455,37.9887330188399 L81.7384273824154,37.2692241235978 L81.0740145466639,36.3942074154749 L80.5250100248749,36.1976220671129 L79.220961279533,36.1474161904212 L78.894949093197,35.8057554191355 L77.2648881615194,35.7725021761322 L77.0252692045629,36.051568607635 L76.4769167071466,36.1552404828897 L75.6348272298421,37.0413416053502 L75.3088150435062,36.7322820527061 L74.6567906708355,36.7599930885418 L74.5348621131461,37.0651404949528 L75.0796284765127,37.2692241235978 L74.6567906708355,37.6809775149401 L73.352741925493,37.7008642583073 L73.0267297391579,37.3891966081699 L72.8206900373937,37.5952363099349 L72.8894786087109,38.0584996267179 L73.7589531096674,38.2472606826045 L73.4026217900026,38.6231527334477 L72.8454669635555,38.7180222796751 L72.7007175528223,38.9674216022198 L72.3747053664867,38.6531458545936 L71.5658691321881,38.7424731936464 L71.5658691321881,39.0560969169039 L72.1240019951946,39.2252972416111 L71.2307286046355,39.3853692251054 L71.1508556189831,39.5513094279482 L71.4592631472562,39.8773216142829 L71.1922591666478,39.9989241597848 L71.1296648268713,40.5293459869548 L70.535670623368,40.9723965481804 L70.1552144019143,41.5073825459614 L70.2008561080015,42.3771830591045 L70.4688381251692,42.4854191049657 L70.450255430548,43.1690666597133 L70.0561066972683,43.1739568425076 L69.978841809107,42.9252095443338 L69.7666078758024,42.8681574117232 L68.9398409712558,42.9627009457627 L68.8570338759269,43.7894678503094 L68.4667972888829,44.4457303814022 L67.8105347577892,44.3922643828415 L67.6181875678516,44.5751572193772 L66.9361700740376,44.767504409316 L67.1008062281369,45.4195287819855 L65.2259101445213,45.4430016594027 L65.2024372671053,45.7830323697515 L64.5129214930054,45.7455409683226 L64.8073104972664,45.6764263848179 L64.8764250807694,45.4152906235623 L65.4704192842729,45.3614986128184 L65.5010644297884,45.0661315719982 L66.4145505759011,44.6755689727698 L66.5064860124472,44.3929164072171 L66.9886580360374,44.2716398739007 L67.7704352588704,43.4233561650547 L68.3399785483983,43.3408750819115 L68.7412995497775,42.764159524283 L69.3043225955789,42.6751581974134 L69.3907158249577,42.1095270541224 L69.6133821482247,42.0061811910509 L69.7082516944486,41.4490263646087 L69.9987285524731,41.181370359622 L69.3574625819512,40.5293459869548 L69.6583718299395,40.20333380062 L69.4405956894674,39.6641096444204 L69.1846761231938,39.9474142343441 L68.7885713167958,39.9643668680348 L68.2887946351437,40.3555814916365 L68.2040314666965,40.8553581732918 L67.9295292058018,40.9743526213004 L67.8649787929073,41.5073825459637 L67.5878684345219,41.610728409026 L67.5181018266465,41.8669739874873 L66.2874058232301,41.9403267294129 L65.8544616397765,42.5558377372147 L64.9758587976017,42.5848528217971 L64.9060921897263,43.1671105865956 L64.0007563482725,43.2398113041502 L63.92446949667,44.1415610115523 L63.8116692801975,43.8761870918734 L63.5723763354277,43.8328274710914 L63.3330833906573,43.8761870918757 L63.2463641490918,44.1601437061729 L62.6781249083091,44.1992651685316 L62.6295490925453,45.4195287819855 L62.3367901492156,45.4879913411169 L62.2908224309423,45.7680358091786 L62.1962788969051,45.4915774751668 L60.9642788447435,45.4596282809055 L60.718465656246,45.4997277798231 L60.3363793738612,46.0956780564455 L59.9862422857369,46.1021983001743 L60.2389017301469,45.9982004127318 L60.2884555824693,45.3957298923852 L61.2120481063581,45.3412858572633 L61.591526291253,44.7427274831545 L62.1930187750421,44.692195594275 L62.243550663924,44.4167152968197 L62.5200089979369,44.3671614444944 L62.5685848137004,44.0897250739238 L62.8411310014774,44.0362590753677 L62.8926409269178,43.7617568144713 L63.1619269928309,43.7050306940485 L63.1619269928309,43.2218806338984 L62.8662339398247,43.1374434776375 L62.8844906222597,42.7755699508061 L63.4530558752287,42.6921108311041 L63.572376335428,42.4228247651898 L64.4043594349561,42.3393656454878 L64.8180688994153,41.7750385509412 L65.3413184584839,41.6462637373418 L65.4058688713784,41.0584637653757 L65.9662838196891,40.9671803532029 L66.294252079143,40.5293459869548 L66.2714312260995,40.2033338006177 L65.7582880448069,40.4331723919854 L65.3253438613539,40.9779387553503 L64.7287415603596,41.0336868392142 L64.2244007080987,41.5823653488146 L64.0640027124215,41.015756168967 L63.5723763354277,40.9381652686182 L63.0543429713408,41.3153613682081 L62.9620815226074,41.5491121058112 L62.7126822000609,41.6257249696012 L62.6321571900358,41.8712121459106 L62.0469653155634,41.9380446441097 L61.6163032174145,42.5294307501187 L61.5745736575635,42.1594069186309 L61.8572262231162,42.0743177379967 L61.9133003191657,41.8043796477114 L62.5030563642471,41.742111320121 L62.5630426065325,41.4760853760711 L62.8238523556012,41.4108829388042 L63.2463641490921,40.8080864062721 L64.224400708099,40.7996100894256 L64.4389167267076,40.7438620055617 L64.550412894434,40.471315817783 L65.0808347216019,40.4077434414505 L65.4241255538135,39.8773216142829 L65.4489024799749,39.2252972416111 L65.8097979702481,38.8546213857453 L66.2368739343474,39.1688971333738 L66.325875261217,39.7319201791737 L66.5064860124475,39.8046208967306 L66.8324981987829,39.4828468688168 L67.3521616238019,39.4189484802965 L67.4414889628576,39.1822636330146 L68.0146183864354,39.1033686839213 L68.0967734573921,38.8595115685442 L68.6190449799011,38.729758718379 L68.7885713167958,38.5015501879458 L69.4405956894677,38.4865536273752 L69.7196621209699,38.2003149277725 L70.2859452886351,38.1145737227673 L70.6957426068588,37.546334481983 L71.2320326533807,37.4306001558342 L73.8358919856423,34.6611266329128 L73.6787541118289,34.1688482315474 L72.3747053664864,34.1290747448153 L72.1151996661638,34.4016209325916 L71.5688032418655,34.507248880964 L71.4488307572935,35.0393007690639 L70.899826235505,35.1423206199452 L70.4662300276787,35.686760971127 L70.0926200621381,35.4184529417715 L69.7666078758024,35.7069737266797 L69.1145835031312,35.7206662385013 L68.8371471325602,36.0137511940206 L68.2662997942866,36.094928228417 L68.1776244796031,36.3325911122555 L67.5989528488577,36.4056178419956 L67.4845225714541,36.6719697982334 L66.94040823246,36.7251097846039 L66.5064860124475,37.3184519637353 L64.550412894434,37.3155178540564 L64.8079625216392,36.9432119372631 L64.4741260428315,36.6171997509283 L64.4943387983846,35.9091012822093 L66.3037064325466,35.7623957983535 L66.6134180095652,35.3131510055846 L66.5064860124472,34.7830551906025 L66.3193550174906,35.1260200106256 L65.8544616397765,35.4409477826298 L63.898388521763,35.391067918119 L63.6212781633779,35.6880650198713 L63.0478227276138,35.766633956779 L62.9607774738622,36.0056008893619 L62.7107261269426,36.0815617287809 L62.6282450437998,36.6511050183073 L62.365153209427,36.7140253702687 L62.2683275900854,37.3122577321944 L60.6115336591286,37.295957122877 L60.6102296103828,34.6330895848869 L60.8540867257617,34.5509345139316 L60.9362417967185,33.9810652122197 L61.1827070095878,33.9015182387531 L61.5028509765695,33.2436256467281 L61.88982744175,33.0310657012366 L61.91558240447,32.0262961429508 L62.1878025800609,31.9725041322069 L62.2412685786193,31.6999579444282 L62.5128367298371,31.645513909311 L62.5669547527685,31.3736197459079 L62.8381968918,31.3188496986029 L62.8926409269178,31.0472815473853 L63.1632310415765,30.9918594757069 L63.2186531132534,30.7212693610506 L63.488591203539,30.6651952649965 L63.8700254615519,30.0685929640054 L64.4398947632665,29.9864378930524 L64.8474099961858,29.4159165669625 L65.1147399889809,29.357234373422 L65.1714661094034,29.0879483075077 L65.4221694806957,29.0126394924667 L65.4971522835524,28.4355979226503 L65.7507897645213,28.3632232172813 L65.8172962505337,27.7777053306254 L66.1123372791675,27.4888585335317 L66.1067950719996,26.1848097881903 L66.363692674832,26.0420164505745 L66.4614963307327,25.4877957338042 L66.6923129586587,25.3929261875838 L66.7725119564975,24.5547488565142 L67.0320176568206,24.4282561282157 L67.1171068374536,23.8613209361803 L67.6423124696403,23.7345021956917 L68.4185474853048,22.880676279678 L68.9792884458021,22.7893928675052 L69.1145835031315,22.5298871671841 L69.627074660051,22.4591425227449 L70.042414185442,21.8964454891328 L70.5976129387717,21.7996198697923 L71.0155605616541,21.2395309336666 L72.0486931801513,21.2004094713055 L72.9673955212447,20.2572562162391 L73.6787541118289,20.2096584370338 L74.0047662981645,19.7111858041252 L74.8321852270836,19.5139484313898 L75.8682519552583,18.9199542278897 L76.3823731731095,18.7820510730705 L76.5176682304382,18.5916599562494 L77.0282033142398,18.4498446551925 L77.4911406188366,17.9347454007833 L78.0277566775449,17.8193370868177 L78.1340366502901,17.599604873231 L78.614578612949,17.4281224632183 L78.6986897570234,16.8602092346241 L79.2460642178808,16.4295471364735 L79.2861637168002,15.8176222627193 L79.5580578802035,15.7635042397898 L79.565230148303,15.4446643215526 L79.8530989088373,15.4264076391175 L79.5283907712469,15.4078249444947 L79.4498218343403,15.6552681939264 L79.179231719682,15.7106902656025 L79.0455667232842,16.2290496418737 L78.5689369068617,16.3473920655159 L78.0450353234202,16.2763214088958 L77.5909003478551,15.8867368462239 L76.7667415407992,15.7524198254546 L77.0898196174577,16.4044441981241 L77.7108728324265,16.6104838998869 L77.7265214173708,16.8660774539749 L77.4168098403519,17.2083902496316 L76.9388759751841,17.2898932962113 L76.6128637888487,17.5689597277164 L75.6348272298418,17.3045638445941 L75.1702598643139,17.3824807571331 L75.0072537711465,17.7329438574415 L74.3307784844996,17.6181875678516 L73.739066366301,17.7084929434678 L74.1651642938412,17.8741071341251 L74.2613378888106,18.1039457254928 L74.772851009171,18.2444569778054 L74.6567906708355,18.5271095433558 L74.0047662981648,18.5202632874415 L73.7993786207734,18.8071540114198 L73.352741925493,18.7983516823855 L73.0267297391579,19.0591614314556 L72.4311054747228,19.0689417970419 L72.3747053664867,19.2518346335799 L72.0486931801513,19.1817420135141 L71.7226809938157,19.3023665224618 L71.3966688074803,18.8619240587226 L70.7625751050577,18.668598832225 L68.7885713167961,18.5212413240004 L68.6480600644853,18.2200060638248 L69.1497928192554,18.069714445926 L69.1145835031315,17.7795636000879 L69.0770921017028,17.9970137283737 L68.545040213603,17.9520240466572 L68.467775325442,17.7032767484858 L68.1365469441248,17.683716017304 L67.1585103851179,17.9220309255159 L66.8324981987829,17.7022987119269 L65.9578075028446,17.9311592667311 L64.8764250807694,17.7974942703351 L64.224400708099,17.9507199979151 L63.8983885217636,17.8558504516924 L63.8873041074278,18.0234207154674 L63.697239002794,18.0345051298026 L64.4728219940866,18.1120960301515 L64.5409585410304,18.3699716695427 L64.7975301316767,18.4394122652306 L65.5284494534403,19.0881765160381 L66.1804738261119,19.1520749045583 L66.4575841844967,19.3874557030959 L67.053534461118,19.4435297991454 L67.0408199858512,19.872887848547 L66.7614275421616,19.9905782478182 L66.6437371428949,21.1058659372683 L65.8544616397765,21.0579421458776 L65.5284494534403,21.3780861128569 L65.2024372671056,20.7472525323013 L64.8764250807696,20.7495346176022 L64.4881445668442,21.0308831344105 L64.1151866256763,20.6426026204877 L64.0317275059744,20.1832514499401 L63.572376335428,19.9087491890461 L63.1629050293901,19.9071191281139 L62.5943397764214,20.4313467237405 L62.4469822681977,20.3165904341506 L62.6174866416512,19.9674313825866 L62.2683275900854,19.6032757704495 L61.9168864532161,19.6391371109486 L61.4735098797992,19.8477849101977 L61.2902910310785,20.2768169474185 L61.0467599278863,20.2341093510075 L61.113918438271,19.8142056550065 L61.4141756618863,19.7884506922885 L61.4845942941347,19.6645660614811 L60.9959020268178,19.3069306930705 L60.6382666584075,19.2358600364481 L60.462546089973,19.0125416888092 L60.9642788447435,18.4550608501746 L61.3453870905697,18.3605173161374 L61.2769245314392,18.0478716294411 L60.8439803479859,17.8287914402254 L60.6382666584078,17.4072576832923 L59.9448387380722,18.3191137684707 L60.17989352442,18.6865295024745 L59.6602300994012,19.1771778429076 L59.3342179130653,18.9202802400753 L58.8709545962829,18.8237806329203 L58.3561813540596,18.2125077835418 L57.741974395003,18.3226999025253 L57.6872043476988,18.0345051298026 L57.7537108337113,18.6369756501515 L58.4787619361215,18.8899611067462 L58.6759993088542,19.6645660614811 L58.4993007038606,19.9905782478158 L59.00820572673,20.0900119646473 L59.22174370878,20.3165904341506 L58.8432435604443,20.6426026204877 L59.1793621245563,20.9686148068225 L58.9149662414386,21.3875404662622 L59.4313695445936,21.5234875479637 L59.7785725230411,21.9466513658291 L59.7430371947301,22.3554706474925 L59.527869151749,22.4663147908447 L59.4046365453143,22.9951065570847 L59.1845783195378,23.1010605176427 L59.0694960177609,23.6380025885368 L58.6821935403946,23.997594030065 L57.3781447950524,24.0191108343644 L56.7261204223811,24.772851009171 L54.4440351180325,24.6975421941276 L54.1180229316972,24.3020894121027 L53.2498524794859,24.1188705633814 L53.1399863726908,23.9170690200396 L52.9554634752249,24.2287366701771 L53.3368977332375,24.3578374959689 L53.4659985590259,24.7030844012929 L53.8366744148899,24.8360973733202 L53.9677313137966,25.2067732291837 L53.7920107453615,25.3906441022783 L53.3698249640574,25.1105996342143 L52.8139741863552,25.4014025044257 L52.1619498136842,24.7891516184883 L51.3433332137957,24.7213410837303 L50.5318888820069,24.2313447676704 L50.0682995530376,24.3663138128108 L49.5571124448633,24.225476548315 L49.3986705223046,23.9027244838423 L48.6729673955211,23.8055728523117 L48.0085545597696,23.1659369427241 L47.5977792049862,23.3651303885749 L47.2642687383655,23.2507001111705 L47.6359226307879,21.2946269931572 L46.5486719893589,20.7136732771078 L46.5639945621168,20.3165904341506 L46.9457548323161,20.234435363193 L47.2717670186512,20.4411270893314 L48.0346355346764,20.4274345775051 L48.2481735167264,20.3165904341529 L47.7050372142914,19.9905782478158 L47.5977792049865,19.6335949037786 L47.7558951153593,19.338553875144 L48.2498035776578,19.239446170498 L48.4147657439437,18.8514916687584 L48.991155289385,18.6865295024721 L49.0560317144656,18.3605173161374 L48.9018279503293,18.3481288530578 L48.8861793653848,18.6708809175305 L47.969107085223,18.6412138085724 L47.8520687103281,18.941145019999 L47.2297114466138,18.9704861167693 L46.9457548323161,19.1993466715804 L45.6417060869736,19.1664194407579 L45.5187994927253,18.8896350945606 L46.0228143327995,18.6865295024721 L46.1721279141415,18.2389147706355 L46.548998001545,18.0345051298026 L45.9677182733089,17.6628512373826 L45.8096023629367,17.8763892194307 L45.5132572855571,17.836941744884 L45.3857865207003,17.056468570796 L45.7245131823028,16.8132634797899 L45.829489106303,16.4044441981241 L45.6417060869738,16.0816921336538 L45.3965449228497,16.4852952203351 L44.8879659121659,16.6287405823242 L44.7862501100291,16.853036966522 L43.9347062793204,16.8073952604344 L43.9288380599667,16.3216371027955 L44.2313773688861,16.0784320117894 L44.2199669423645,14.0046684945097 L44.6636695279669,13.6209521511909 L44.9896817143023,13.8442704988322 L45.3786142526005,13.7963467074414 L45.0555361759423,13.7304922458011 L45.0170667379548,13.4426234852663 L44.43741707065,13.0445626057502 L44.168457016923,12.6614982868072 L44.1185771524142,12.1662857757629 L44.4123141323024,11.5142614030934 L44.3376573416316,10.5349207953378 Z\" / fill=\"lightblue\"><\/svg><\/div><span class=\"legend-text\">5 minutes<\/span><\/div><div class=\"legend-item\"><div class=\"legend-patch-container\" style=\"width:20px; height:20px;\"><svg class=\"legend-color legend-shape-custom\" width=\"20\" height=\"20\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid meet\"><path d=\"M44.3376573416316,10.5349207953378 L44.0673932391593,11.1882492167563 L44.2630005509605,11.5142614030911 L44.1723691631593,11.6749854109541 L43.7162781144761,11.8402735894282 L43.4880695840415,12.9470849620365 L43.2171534571967,12.9607774738628 L43.0336085962893,12.7178983950398 L42.1211004867366,12.75278169898 L42.0673084759907,12.4805615233891 L41.8619207985996,12.4922979620977 L42.021666769904,12.5262032294767 L42.0347072573572,12.8391749283585 L42.7075964099537,12.9027473046979 L43.359620782625,13.5850908106942 L43.6856329689606,13.4618582042601 L43.81734189224,13.6643117719753 L43.8258182090845,14.774383266448 L43.558162204103,14.9729246879254 L43.4476440729354,15.514430929426 L42.5964262544131,15.7524198254546 L43.4453619876316,15.9926908067842 L43.4355816220411,16.4804050375408 L42.7075964099537,16.5195264999019 L42.3815842236184,16.2032946791557 L41.9659186860407,16.16808536303 L41.7686813133076,15.3872861767588 L41.5440589169223,15.5669188914278 L41.2923775090711,15.5372517824697 L41.0775354782761,14.984661126634 L40.5282049443007,14.9977016140869 L40.3319456081265,14.774383266448 L40.3775873142138,15.1003954527828 L40.0994989192698,15.2780720943364 L39.8862869494061,14.9875952363129 L39.4474745465985,14.9729246879254 L39.1214623602629,14.6615830499758 L38.6376602757414,14.6061609782974 L38.4694379875922,14.0904096995149 L37.1774516931443,14.1223588937762 L37.7336284830329,14.2061440256636 L37.8174136149209,14.6263737338501 L38.5871283868595,14.9827050535163 L39.1084218728094,15.4394481265728 L39.4474745465985,15.4717233330219 L39.7350172949464,15.7908892634401 L40.0994989192698,15.574743183901 L40.3208611937916,15.8570697372682 L40.8551951671955,15.9747601365324 L40.7515232919408,17.2954355033789 L40.8177037657666,17.1226490446218 L41.1231771843631,17.1024362890691 L41.4035476646117,16.2606728239518 L41.6027411104628,16.5312629386105 L42.055572037283,16.601355558674 L42.3815842236181,16.9338879887329 L42.7825792128106,16.9814857679382 L42.8119203095812,17.3824807571331 L42.5579568164259,17.5588533499377 L42.4467866608853,18.0997075670696 L42.2293365325995,18.2082696251185 L42.1315328766991,18.7624903418888 L41.6203457685248,19.2293397927217 L41.522216100438,19.7832344973064 L41.1642547198413,19.9905782478158 L40.8053153026864,21.0224068175687 L40.4255111056048,21.1753065329585 L39.9609437400772,20.7811577996803 L39.6306933953195,20.1333715854317 L39.0732125566857,20.0388280513921 L38.9760609251572,19.8099674965856 L38.4202101474553,19.7137939016162 L38.3204504184363,19.4875414442984 L37.8174136149209,19.4135366780041 L37.6211542787473,19.2088010249811 L36.839377055914,19.1898923181751 L36.513364869579,18.7660764759387 L35.861340496908,18.7670545124952 L35.5353283105726,18.5065707756153 L34.8833039379014,18.4446284602127 L34.5572917515657,18.1202463348078 L33.9052673788945,18.1218763957377 L33.8084417595529,17.9376795104599 L34.0571890577269,17.5344024359664 L34.4767667415409,17.3824807571331 L33.5241591330682,17.3273846976402 L33.244766689379,17.7084929434655 L32.9272308198878,17.7994503434551 L32.5653572930558,17.7443542839646 L32.4799421002355,17.5037572904472 L31.9491942608812,17.4773503033535 L31.6231820745459,17.6015609463487 L31.2971698882105,17.1539462145098 L30.6451455155393,17.2781568575073 L30.3875958883341,16.9880060116647 L29.9931211428683,16.8341282597159 L29.6671089565329,16.954752768659 L29.5171433508182,16.8804219901722 L29.3410967701976,16.5113761952409 L28.6890723975263,16.6313486798176 L28.3630602111907,16.3157688834424 L27.71103583852,16.3085966153426 L27.3850236521841,15.8707622490945 L26.9771824070784,15.8342488842221 L26.7329992795131,15.5512703064815 L26.0809749068418,15.5538784039749 L25.7549627205068,15.2327564004367 L24.7769261614996,15.3419704828567 L24.4509139751642,14.9977016140869 L23.6880454591393,14.8852274098025 L23.4728774161579,14.5999667467587 L22.8208530434869,14.6068130026707 L22.5616733553501,14.3815385819118 L22.1688286708157,14.2882990966189 L21.2912038652002,14.3479593267206 L21.1907921118087,13.9779354952305 L20.212755552803,13.9899979461245 L19.8867433664671,13.673114101005 L18.3355773838827,13.7174517583482 L18.2566824347898,13.4364292537276 L17.0690200399691,13.3539481705822 L16.9526336894472,13.0911823483967 L15.655105187832,13.1378020910454 L15.5879466774468,12.8183101484348 L15.6485849441053,13.1524726394305 L16.9109041295959,13.1860518946194 L16.9526336894469,13.4977195447568 L17.9306702484538,13.5537936408063 L18.2566824347895,13.8895861927319 L19.5607311801311,13.8807838637022 L19.8867433664668,14.2478735855158 L20.8647799254734,14.2648262192018 L21.1907921118087,14.5764938693393 L22.1688286708154,14.6084430636006 L22.494840857151,14.9390194205464 L23.248581031959,14.9986796506458 L23.4728774161579,15.30415306924 L24.1249017888289,15.2813322161962 L24.4509139751642,15.660810401094 L25.4289505341708,15.6187548290563 L25.624557845972,15.8828246999862 L26.3297222050161,16.0784320117894 L26.45393284801,16.3574984432922 L27.0590114658484,16.305662505666 L27.5809569761719,16.7304563844612 L27.3850236521841,16.9560568174034 L26.8898111411407,16.8996567091707 L26.7329992795131,16.6336307651162 L26.4069870931777,16.5136582805465 L26.0809749068421,16.5775566690667 L25.779739646668,16.3796672719627 L25.3986314008415,16.4044441981218 L25.7106250631653,16.4487818554673 L25.7549627205068,16.7539292618784 L26.4069870931777,16.7904426267461 L26.6818153662585,17.1076524840535 L27.2102811203084,17.2312111026708 L27.9046870772029,17.8408538911195 L28.0370480248551,18.3230259147085 L28.1234412542345,18.1208983591812 L29.3410967701973,18.188382881756 L29.6671089565327,18.4478885820748 L30.6451455155396,18.5372159211322 L30.9711577018746,18.8449714250319 L31.2971698882105,18.545692237974 L31.4973413706204,18.8123702063996 L32.0375435633783,18.924192386313 L31.7959685333035,19.6645660614811 L32.1128523784217,19.9905782478158 L31.6231820745456,20.5314324649454 L31.2971698882105,20.4267825531318 L29.993121142868,20.5539273058013 L29.6671089565329,20.25953830154 L28.5707299738868,20.3165904341529 L29.6361377988311,20.3475615918531 L29.6671089565327,20.7133472649223 L30.4658388130549,20.8219093229712 L30.9711577018746,21.5733674124746 L31.0575509312537,21.3810202225358 L31.2971698882102,21.3337484555183 L31.4712603957137,21.4465486719929 L31.6231820745456,22.0050075471817 L32.2752064472172,22.1575812503884 L32.6012186335525,22.0095717177882 L32.8362734199003,22.2726635521638 L32.4864623439626,22.5986757384986 L32.6012186335525,22.9543550337915 L32.6905459726085,22.688003077556 L32.9947153424595,22.6661602610711 L33.1071895467453,22.4526222790207 L33.988074474224,22.3554706474925 L34.1214134584353,22.1627974453705 L34.3320173308082,22.1719257865857 L34.4353631938766,22.2726635521638 L34.1644470670312,22.5986757384986 L34.3688567078635,23.0622650674671 L33.9734039258388,23.2507001111728 L34.1595568842361,23.648434978501 L34.3408196598391,23.6862523921131 L34.5572917515657,23.533678688911 L34.8833039379014,22.7711361850702 L35.1653044790816,22.9246879248357 L35.4446969227709,23.667343685307 L35.5353283105723,23.7270039154063 L35.861340496908,23.422508533371 L36.0435813090695,23.5767122975052 L36.0937871857647,23.9027244838423 L35.4857744582491,24.2287366701771 L35.879271167156,25.1888425589365 L36.4409901642122,25.2791479345504 L37.1653892422499,25.9585573308748 L38.1434258012566,25.8451050900293 L38.2682884686231,26.0599471208217 L38.4694379875925,26.1404721308494 L38.6050590571076,26.0491887186743 L38.7954501739278,26.5362509250622 L39.2759921365861,26.6823043845401 L40.0069114583503,27.5814459944489 L40.5405934073817,27.699788418091 L41.4954831011585,28.7009718423292 L41.5306924172824,29.1189194652102 L42.1582658759789,30.0969560242168 L42.1455514007117,31.0749925832234 L42.4660213798792,31.4010047695581 L42.4383103440406,31.7837430763157 L42.055572037283,31.8254726361702 L41.5251502101151,31.2794022240586 L40.9601710911954,31.1923569703044 L40.7515232919408,30.9410015746396 L40.6621959528848,31.4903321086156 L41.0775354782761,31.5757473014353 L41.2079403528109,31.7270169558952 L40.9852740295439,32.7973149636335 L41.1697969270095,32.7973149636312 L41.7295598509474,32.2688492095836 L42.3815842236184,32.2897139895097 L42.5445903167857,32.542047421731 L43.1059833016558,32.7050535149018 L43.0336085962893,33.4307566416848 L41.7295598509471,33.4574896409617 L41.4035476646115,33.1487561005031 L41.1952258775432,33.6830900739085 L41.4035476646115,33.8914118609767 L43.0336085962893,33.9354235061321 L43.4166729152336,34.9871388192522 L43.1447787518299,35.0983089747899 L43.0684919002269,35.6740464958595 L42.4888422329227,35.7464212012263 L42.3815842236184,36.0196194133737 L42.017754623668,36.0029927918686 L41.9365775892704,35.7581576399325 L41.7295598509474,35.6984974098332 L41.5225421126243,35.7581576399325 L41.4035476646115,36.0215754864891 L40.866279581531,36.0802576800319 L40.4255111056051,36.6765339688421 L39.1214623602635,36.6804461150752 L39.6841593938785,35.9651753782565 L39.4474745465985,35.7284905309768 L39.1214623602632,35.7226223116237 L38.7954501739275,36.035920022691 L38.1434258012566,36.0333119252 L38.1434258012568,35.8791081610657 L38.6229897273557,35.7927149316826 L38.6999286033312,35.639163191924 L38.4694379875922,35.4086725761807 L36.8393770559143,35.3881338084424 L36.6828912064737,35.1436246686942 L35.861340496908,35.0683158536463 L35.5353283105723,34.7533880816467 L35.1519379794417,35.044516964046 L35.0140348246219,34.2043835598586 L34.4353631938763,34.0091022602432 L34.557291751566,33.844140093957 L34.9641549601126,33.7639410961194 L35.0564164088454,33.5301903585163 L35.384384668299,33.3570778875714 L34.8833039379017,33.1389757349169 L34.6867185895414,33.4865047255464 L34.1344539458885,33.4539035069164 L34.2312795652298,33.1216970890361 L34.6808503701868,33.0310657012366 L34.0712075817393,32.8651254983915 L33.9052673788945,32.5994255665294 L33.389516100112,32.5687804210125 L33.2532430062238,32.257112770875 L33.1851064592791,32.7050535149018 L33.4012525388196,32.8830561686433 L33.4420040621115,33.3570778875691 L34.0271959365839,34.0091022602432 L33.9052673788945,34.429983992803 L33.729872822646,34.1844968164914 L33.1838024105341,34.0785428559334 L32.9272308198878,33.7900220710252 L31.6231820745456,33.8030625584759 L31.2971698882108,34.132334866675 L30.9711577018746,34.1375510616594 L30.6451455155396,33.5592054430987 L30.3191333292039,33.8190371556123 L29.3410967701976,33.8359897893006 L29.0150845838617,34.1698262681062 L27.7110358385197,34.2007974258087 L27.3850236521838,34.5391980752253 L26.0809749068421,34.5982062809513 L25.9717608244201,34.8779247368275 L25.2013940281084,34.9871388192522 L26.0809749068418,35.0415828543671 L26.4069870931777,34.7390435454494 L27.7110358385197,34.7876193612113 L28.0370480248551,34.4769297476326 L29.3410967701976,34.5030107225408 L29.6671089565327,34.1871049139824 L29.9931211428683,34.5088789418962 L30.3191333292036,34.1991673648788 L30.6451455155393,34.5290916974467 L30.9711577018746,34.5326778314989 L31.2971698882105,34.8000078242932 L31.6231820745456,34.8228286773369 L31.8702993117883,34.2562194974848 L32.6012186335525,34.2268784007145 L32.7795472994781,34.4827979669881 L33.2532430062241,34.5597368429659 L33.4273335137267,34.8130483117438 L33.9052673788947,34.8922692730271 L34.0751197279758,35.1432986565041 L34.5572917515657,35.223497654344 L34.8833039379014,35.5524439503553 L35.861340496908,35.5579861575229 L35.861340496908,35.6984974098355 L31.2971698882105,35.7170801044561 L30.9711577018746,35.4086725761807 L30.6451455155396,35.4050864421331 L30.3191333292039,35.7222962994358 L24.7769261614999,35.7809784929763 L24.4509139751642,35.4145407955384 L24.0121015723567,35.4259512220568 L23.5723111329902,34.8877051024161 L23.1468652298223,34.8769467002664 L22.8606265302196,34.6213531461806 L22.5734097940581,34.5825576960097 L22.4883206134248,34.3285942028515 L22.2275108643561,34.3937966401162 L22.0648307833749,34.8831409318096 L21.5657061260946,34.9382369913002 L21.5285407368527,34.649064182021 L21.3332594372382,34.6611266329128 L21.4917013597968,34.6862295712621 L21.5168042981447,35.0128937819702 L23.1468652298226,35.097330938231 L23.7988896024932,35.7920629073092 L24.2288996762703,35.8611774908139 L24.1249017888289,36.1206831911351 L21.8428164844806,36.1907758112009 L21.190792111809,35.9462666714481 L20.8647799254734,36.2507620534858 L20.5919077255112,36.2380475782207 L20.5387677391381,35.9400724399095 L20.2231879427655,35.9651753782565 L20.2577452345166,36.2911875645912 L20.8647799254737,36.4385450728158 L24.7769261614999,36.4727763523803 L25.1029383478352,36.1542624463285 L30.9711577018746,36.2119666033125 L31.0350560903969,36.3550859531138 L30.5127845678871,36.4848388032744 L29.9090099987938,37.2692241235978 L30.3191333292039,37.5531807378996 L30.5440817377753,37.1681603458342 L30.7973932065578,37.116976432579 L30.7960891578129,37.4201677658723 L30.6451455155396,37.5329679823445 L30.4840954954893,37.4341862898864 L30.435519679726,37.5952363099349 L31.2971698882105,37.734117501313 L31.8269396910057,36.9432119372631 L31.5703681003597,36.2383735904062 L32.2752064472172,36.2184868470366 L32.427128126049,36.465278072095 L32.6853297776269,36.533088606853 L32.4584252959373,37.0860052748789 L32.9272308198878,37.1668562970898 L33.2532430062238,36.8574707322556 L33.3389842112298,37.2692241235978 L33.2532430062238,37.3895226203554 L31.9491942608812,37.4870002640715 L31.8660611533659,37.9212484962697 L32.2752064472172,38.1429367829787 L32.4757039418137,37.7957338045301 L32.7000003260121,37.8224668038092 L32.9536378069809,38.8728780681826 L33.2532430062238,38.9328643104698 L33.4840596341489,38.8040894968658 L33.8358267832051,38.8298444595861 L33.9610154627581,38.6290209528031 L34.5572917515657,38.9442747369905 L34.6746561386464,38.6906372560225 L34.7574632339756,37.9212484962697 L33.8547354900129,36.8926800483789 L34.5572917515657,36.227941200442 L35.861340496908,36.231853346682 L35.6037908697028,36.6171997509283 L35.5780359069822,37.3119317200088 L35.209316124237,37.0178687279331 L34.9579607285722,37.2692241235955 L34.9905619472057,38.5732728689392 L35.3550435715288,39.0795697943187 L36.1873526832433,39.1600948043441 L36.513364869579,39.4652422107551 L37.1653892422499,39.4926272344077 L37.2742773124859,39.7684335440461 L37.4914014285853,39.8228775791634 L38.7954501739275,39.8290718107043 L39.0249627531077,39.780822007128 L39.1214623602635,39.5053417096728 L40.1278619794809,39.5226203555489 L40.1855661364622,40.1172665834247 L40.4662626288976,40.20333380062 L40.2005626970337,40.3043975783813 L40.0994989192695,40.9013258915626 L40.0046293730459,40.2982033468404 L39.1214623602632,40.2479974701464 L39.0298529359028,39.9689310386436 L38.7954501739275,39.9229633203705 L37.593769255095,39.9796894407909 L37.5895310966724,40.7572285052024 L37.8500148335547,40.8227569546549 L37.9165213195669,41.082262654976 L39.1648219810455,41.1813703596243 L38.5636555094427,41.275587881476 L38.5193178521013,42.2092867831394 L38.1434258012566,42.214176965936 L38.0289955238524,41.9478250097006 L37.7776401281879,41.8731682190283 L37.7417787876915,41.1813703596266 L37.4914014285856,40.9309930005184 L37.1653892422499,41.2482028578235 L36.1345387090568,41.2341843338094 L35.7619067800756,40.8553581732895 L35.3015775729698,39.7850601655513 L34.8833039379014,39.4404652845936 L34.7584412705348,39.8773216142829 L35.2869070245844,40.7777672729384 L35.2670202812181,41.2390745166059 L33.8283285029198,41.2583092355998 L33.6689085438012,40.4396926357118 L33.2532430062241,40.1730146672909 L32.7159749231424,40.5293459869548 L33.3728894786091,40.7357117009007 L33.3715854298633,41.5073825459614 L33.5792551925594,41.7150523086563 L35.2653902202867,41.7773206362467 L35.2093161242367,41.9403267294129 L34.557291751566,41.9686897896243 L34.3665746225594,42.1594069186309 L34.5572917515657,42.3501240476375 L34.9657850210442,42.4026120096371 L35.0916257249693,42.9287956783838 L35.5353283105726,43.2316609994892 L35.861340496908,43.3154461313767 L35.9213267391937,43.1974297199247 L35.6641031241749,42.8114312913051 L35.7586466582121,42.1594069186309 L36.1873526832436,41.7590639538117 L36.839377055914,41.7652581853503 L37.6058317059891,42.6970010138984 L38.1434258012566,42.7566612439977 L38.2480757130701,43.032793565824 L38.8280513925607,43.1048422590052 L37.9129351855173,43.2329650482336 L37.8509928701138,43.4970349191658 L37.2798195196541,43.577885941379 L37.2224413748582,43.7894678503071 L37.2798195196538,44.0010497592374 L37.5275887812684,44.0792926839619 L37.5924652063495,44.6664406315523 L37.8500148335547,44.7349031906814 L37.9126091733309,44.9983210372402 L38.1871114342255,45.0935165956531 L37.9093490514677,45.1854520321969 L37.9093490514677,45.6536055317765 L38.1737449345856,45.7152218349935 L38.2347092134305,45.9802697424846 L38.8342456241017,46.0327577044841 L38.8280513925613,46.3975653409921 L38.7214454076295,46.1455579209563 L37.5706223898646,46.1511001281216 L37.5706223898649,46.6443565660505 L37.8412125045238,46.7473764169319 L36.2655956079635,46.8018204520491 L36.2271261699763,47.0893632003961 L35.861340496908,47.0906672491405 L35.7664709506841,46.1664227008824 L35.3041856704603,46.1664227008824 L35.2380051966339,46.7522665997261 L34.9657850210442,46.8060586104724 L34.5823946899136,47.4007048383458 L34.3072404046465,47.4515627394154 L34.2573605401371,47.7276950612417 L33.9870964376648,47.7834431451056 L33.9492790240501,48.6796506453425 L33.9936166813913,48.917313529181 L34.4689424490692,48.917313529181 L34.5302327400999,48.3265794475407 L35.5353283105723,48.3187551550675 L35.5711896510693,48.6796506453425 L35.2842989270939,48.7546334482003 L35.2468075256653,49.0056628316772 L35.2842989270937,49.2566922151565 L35.5591272001747,49.3554739076146 L34.952744533591,49.4014416258877 L34.5572917515657,50.0205387677371 L33.3347460528072,50.0652024372681 L33.3347460528077,50.5542207167714 L33.9052673788947,50.6748452257145 L32.9272308198878,50.6790833841354 L32.8359474077139,50.4009949891937 L32.3664898593911,50.4009949891937 L32.3664898593911,51.1964647238524 L32.9526597704224,51.3131770865577 L32.3495372257016,51.3620789145097 L32.2752064472172,51.6512517237889 L31.0539647972041,51.6965674176909 L30.997564688968,52.2921916821255 L30.3999843514151,52.3466357172428 L30.3191333292036,52.6328744168454 L29.4300980970672,52.6807982082385 L29.3410967701976,52.9605166641147 L28.2277651538614,52.9178090677037 L28.3630602111907,52.7593671451439 L28.7790517609545,52.6817762447974 L29.100825788868,52.2657846950318 L29.015084583862,52.0173634090459 L28.3630602111907,52.4242266175939 L27.8186198600101,52.2657846950295 L28.0370480248551,51.9081493266236 L27.6781086076999,51.9068452778746 L27.3850236521841,52.122339333045 L27.0590114658487,52.0806097731952 L26.7329992795134,52.3619582900012 L26.4069870931777,52.0496386154927 L25.5782641155125,52.089086090037 L25.326908719848,52.163742880707 L25.2480137707551,52.5917968813712 L24.7769261614996,52.644610855554 L23.6655506182822,51.421087120238 L22.7804275323812,51.3281736471307 L22.6875140592753,50.7690627475662 L22.1264470865919,50.6781053475765 L21.7939146565295,50.260809749069 L22.494840857151,50.2132119698637 L22.8208530434866,49.8757893570059 L23.282486299338,49.7933082738651 L23.4728774161576,49.5165239276631 L23.904843563052,49.4376289785699 L23.94689913509,49.0056628316772 L23.798889602493,48.8576532990793 L23.5798094132758,49.1125948287963 L23.1468652298226,49.1337856209102 L22.9000740047665,49.4108959792954 L22.3442232270644,49.5070695742624 L22.2317490227785,49.7206075563128 L21.7906545346663,49.7098491541608 L21.4369313124923,49.331675018012 L21.3978098501327,48.0276262726706 L20.6179887004177,47.3756019000011 L20.7428513677842,47.049589713664 L20.5387677391378,47.0264428484347 L20.3633731828894,47.2002073437506 L19.8867433664671,47.2295484405209 L19.5607311801314,46.9609143989799 L19.3227422841065,46.9615664233533 L19.2347189937961,46.6727196262596 L19.2096160554482,47.074692652011 L20.3027349162309,48.2636590955746 L20.5935377864425,49.0604328789823 L19.8867433664668,49.0927080854268 L19.5607311801314,48.7820184718505 L19.2347189937961,48.786256630276 L18.9087068074607,49.1077046459997 L17.9306702484538,48.2545307543594 L17.6046580621185,48.5306630761857 L17.2786458757829,48.2848498876885 L17.0595656865655,49.1125948287963 L16.6266215031122,49.1647567786057 L16.4606813002671,49.0056628316772 L16.4942605554594,48.3536384590054 L16.3006093167765,48.2675712418147 L16.0975037246889,48.4765450532516 L15.8650570358319,48.4631785536155 L15.6485849441053,47.9389509579842 L15.290949575695,48.0276262726706 L15.209772541298,48.3536384590077 L15.4699302659936,48.6796506453448 L15.3225727577696,48.7839745449682 L14.6705483850987,48.8012531908444 L14.344536198763,48.4886075041504 L13.9067018325146,48.4654606389211 L13.7577142633593,48.0928287099352 L13.9468013314337,48.0276262726706 L13.692511826092,48.0015452977648 L13.3664996397561,48.2264937063359 L13.0404874534208,48.1260819529432 L12.956376309346,48.2695273149301 L12.1494961481657,48.2665932052558 L12.1110267101789,47.9790504569065 L11.8042492428365,47.7016140863335 L11.9180274958682,47.3756019000011 L11.0844143354078,47.5611028340256 L10.1063777764015,46.6844560649681 L9.27732878654991,46.5745899581725 L9.1283412173946,46.3304068306075 L8.21322501035084,46.3346449890307 L8.15030465838827,45.9343020242115 L7.7682183760029,46.0715531546574 L8.00425119890981,46.3975653409921 L8.80232903105896,46.4552694979715 L9.08041742600323,46.77150131872 L9.45435340373023,46.8089927201489 L9.71516315279862,47.1147921509309 L10.2459109921529,47.2360686842497 L10.0398712903884,47.961119786657 L9.73407185960612,48.0276262726706 L10.1063777764012,48.0608795156763 L10.2283063340907,47.8235426440256 L10.4323899627368,47.8000697666085 L11.2060168809109,47.9060237271687 L11.5731066027248,48.3536384590077 L11.8691256679174,49.9836993906838 L11.7364387080788,50.1333389842093 L11.0120396300414,50.2373368716542 L10.9086937669727,50.7860153812568 L10.5363878501782,51.2877481360252 L10.7584021490722,51.3190453059132 L11.0844143354078,51.0699719955539 L11.5639782615075,51.6137603223623 L10.8764185605259,52.3838011064862 L10.3424105993081,52.5018175179428 L10.1063777764009,52.7906643150319 L9.45435340373023,52.5745182354927 L9.07096307259934,52.8604309229076 L8.71821788698451,52.917809067706 L8.15030465838856,53.5114772590206 L6.93395319117037,53.5698334403755 L8.05934725840068,53.660464828175 L8.15030465838827,53.8068442998384 L8.63573680384167,53.4035672253426 L9.20756217867449,53.3230422153195 L9.78036559006557,53.0390856010178 L10.9494452902649,53.0527781128463 L11.0844143354078,53.1593840977799 L11.6057078213585,52.917809067706 L11.4814971783644,52.5917968813712 L11.7364387080788,52.1070167602865 L12.0070288227372,52.647218953045 L12.3095681316571,52.6706918304621 L12.3884630807501,52.8115290949556 L12.5133257481164,52.5917968813712 L12.1794892693087,52.2657846950318 L12.2916374614079,51.5169347030196 L12.8403159710109,51.4135888399527 L12.9547462484147,50.8759947446853 L13.3664996397564,50.8398073920007 L13.6925118260917,50.5203154493901 L14.0185240124277,50.5216194981368 L14.3445361987627,50.8404594163741 L14.7553115535459,50.8769727812441 L14.996560571434,51.4409738636006 L15.4086399749624,51.3738153532159 L15.6485849441053,51.1042032751184 L15.9745971304403,51.4403218392296 L16.5125172378938,51.4018524012441 L16.9526336894472,51.7911109517281 L17.3712333367018,51.8471850477753 L17.4778393216339,52.0665912491811 L18.0154334169011,52.1810215265832 L18.3737208096835,52.5917968813689 L18.3502479322678,53.011374565182 L17.6046580621185,53.1319990741251 L17.4243733230747,53.3895487013285 L16.9699123353231,53.5698334403755 L17.6046580621182,53.6917619980653 L18.5826946211248,54.2974926402785 L18.9087068074607,54.0474412933558 L19.2347189937961,54.4611507578158 L19.5607311801314,54.2453306904599 L20.2694816732252,54.8171560652918 L20.3751096215973,55.3635524895936 L20.9358505820949,55.8519187447235 L20.9325904602311,56.5039431173954 L20.6802570280078,56.6454324062645 L20.5906036767657,57.2078034276934 L20.2127555528024,56.9525358857909 L19.4929206453737,57.1559674900649 L19.5607311801314,57.7189905358672 L19.8867433664671,57.3228857294712 L20.618314712604,58.1340040490715 L20.0637679836471,58.6370408525889 L19.9512937793613,59.1765910209741 L19.6285417148897,59.5058633291709 L16.6266215031122,59.5821501807777 L16.0805510909997,59.332098833855 L15.5967490064779,59.3865428689722 L14.3132390288745,60.0587799971968 L13.6814274117562,61.0681137260891 L13.6833834848748,61.4032542536437 L14.0185240124274,61.22753368521 L14.5218868281294,60.5934399827854 L15.0291617900678,60.4486905720542 L15.6485849441053,59.9257670251719 L17.6046580621185,59.9639104509741 L18.1116070118702,60.4160893534218 L18.1702892054104,61.0681137260891 L19.0475879988391,62.046150285098 L18.9087068074607,62.256428145284 L18.2566824347895,62.1850314764761 L17.9769639789136,62.3721624714328 L17.8954609323296,62.6981746577675 L18.3587242491126,63.0241868441046 L18.9087068074607,63.1392691458824 L19.9659643277467,63.1034078053857 L20.2091694187528,63.0241868441046 L20.0389910574856,62.6981746577698 L20.5387677391378,62.61438952588 L21.5168042981447,62.6923064384144 L22.1688286708157,62.5755940757068 L22.3168382034124,62.8461841903654 L21.8711795446914,62.9958237838932 L21.5168042981447,62.7291458154723 L21.1454764179087,62.9788711502049 L20.9378066552126,63.4232257601772 L20.5387677391381,63.5109230383047 L20.8439151455479,64.328235589446 L20.6831911376846,64.472658987994 L20.4103189377219,64.4566843908622 L20.2127555528027,64.2209775801414 L19.6409301779702,64.2480365916084 L19.5607311801314,64.0837264496955 L19.5258478761936,64.328235589446 L19.8261050998089,64.6542477757831 L19.0087925486656,65.406357889662 L18.5826946211245,65.4572157907294 L18.2566824347898,65.1569585671126 L17.7885289352114,65.1224012753603 L17.6636662678451,64.9212517563918 L17.2786458757826,64.8231220883047 L17.5371735395466,65.3737566710251 L17.9306702484538,65.4474354251362 L18.0920462806902,65.632284334792 L17.9306702484536,65.7770337455232 L16.9526336894469,65.827565634405 L16.6266215031119,66.1878091003043 L15.9644907526642,66.2843087074569 L16.4473148006272,66.4636154099451 L16.4316662156832,66.7413777927012 L15.9745971304406,66.8642843869498 L15.9745971304403,67.251912876504 L16.4505749224907,67.4383918470873 L16.491978470155,67.7797266061805 L16.253663561944,67.9613153939673 L16.6024966013232,68.2403818254748 L16.1669443203788,68.4327290154089 L15.9745971304403,68.684084411076 L15.6485849441053,68.6449629487126 L15.0144912416826,69.2184183844791 L15.3519138545399,69.2477594812493 L15.6485849441053,69.0573683644305 L15.9745971304406,69.2281987500699 L16.3006093167765,69.1750587636994 L16.6266215031122,68.6566993874235 L17.4569745417084,68.892406198142 L17.6046580621188,69.1356112891504 L17.678988840603,68.9667369766264 L18.2824373975098,68.9181611608646 L18.4646782096714,68.4483776003552 L19.2347189937961,68.3844792118326 L19.5995266303059,68.8924061981443 L19.4476049514728,69.2184183844791 L20.0644200080196,69.5444305708161 L19.6210434346035,70.5224671298205 L19.715586968641,70.8484793161575 L20.2029751872124,70.8582596817484 L20.2127555528027,71.1275457476604 L20.2619833929393,70.897707156295 L20.8647799254734,70.4253154982922 L20.8853186932128,70.1759161757474 L20.5387677391381,70.095391165722 L20.3751096215976,69.8704427571509 L20.7783866960949,69.5444305708161 L20.8135960122188,69.1672344712262 L21.190792111809,69.5418224733251 L21.5572298092501,69.5851820941071 L21.9657230787286,68.8924061981443 L21.6045015762693,68.2403818254725 L22.099714087313,67.5192428692982 L22.8208530434869,67.4921838578335 L23.1468652298226,67.1704098299197 L23.9041915386799,67.9143696391377 L23.7988896024932,68.3522040053858 L23.1468652298223,68.3799150412262 L22.8208530434869,68.7287480806024 L22.2591340464308,68.892406198142 L22.4948408571513,69.0417197794866 L23.549490279947,69.1418055206891 L23.3072632254995,69.5444305708161 L23.516889061313,69.8704427571509 L23.4728774161579,70.0226904481698 L23.1468652298226,70.1325565549677 L22.3654140191759,70.0670281055129 L22.0068006142074,70.8484793161575 L22.7494563746793,71.2458881713002 L22.5760178915492,71.8265158751641 L23.055907829835,72.2434854614885 L23.1468652298223,72.6663232671637 L23.5237353172258,72.478540247836 L23.7724826154001,72.8309594212645 L23.6512060820837,73.3088932864325 L22.4948408571513,73.3623592849909 L22.1688286708157,73.7105402999961 L21.84281648448,73.6720708620084 L21.5970032959831,73.2107636183478 L21.6234102830762,72.911158419102 L21.8294499848404,72.8045524341708 L21.5422332486789,72.478540247836 L21.3746629849025,72.478540247836 L20.824680426554,73.7825889931774 L21.073101712542,74.1086011795098 L20.9606275082561,74.4346133658469 L21.6253663561945,74.652063494135 L21.5168042981447,74.9089610969674 L20.1292964331004,75.0031786188145 L19.8867433664671,75.2907213671661 L19.6689672259949,75.0866377385188 L19.5607311801311,74.4796030475611 L19.5186756080944,74.7185699801463 L18.9722791837955,74.6970531758492 L18.7932984934978,74.3192050518883 L18.5826946211248,74.3527843070771 L18.5993212426277,74.7772521736845 L17.8237382513359,74.979705741402 L17.124442111646,74.9148293163182 L16.7426818414476,74.6445652138474 L15.9745971304406,74.6680380912645 L15.8249575369128,75.0866377385188 L16.5007807991862,75.5384906287833 L16.4639414221303,75.9023202287302 L15.9540583627015,76.0441355297871 L15.4392851204776,75.9479619348177 L15.3225727577699,75.7350759771384 L14.9965605714343,76.153675624395 L14.5316671937197,76.2518052924798 L14.0185240124277,76.5735793203959 L13.8473676146013,76.8715544587071 L13.4290939795326,76.9801165167561 L13.3664996397564,76.8761186293159 L13.1379650971354,77.042710856532 L14.344536198763,77.3419900435876 L14.6705483850989,77.2683112894764 L14.7112999083908,77.6947352292038 L14.9323361707262,77.7589596299119 L14.9965605714343,77.9460906248686 L15.3225727577696,77.535641282273 L15.9745971304403,77.5747627446295 L16.0935915784532,77.1617053045452 L16.3006093167765,77.0652056973926 L16.9728464450003,77.348510287314 L16.9082960321055,77.7390728865424 L17.4321976155466,77.848286968967 L17.6483436950872,77.6510495962317 L17.2786458757829,78.2042922764454 L16.6266215031122,78.1775592771662 L15.943299960553,78.3467596018734 L16.3006093167762,78.7562309079101 L16.7508321461057,78.7973084433912 L16.9816487740311,78.6437567036234 L16.8505918751244,79.3247961608823 L17.0999911976709,79.6508083472148 L16.0613163720058,80.7155641477877 L14.6705483850989,80.7680521097896 L14.344536198763,80.9199737886229 L14.0185240124274,80.5274551162722 L13.5963382311232,80.5326713112543 L13.0404874534211,80.7377329764605 L12.3884630807501,80.4746411420895 L12.1915517202037,80.7579457320132 L11.7364387080791,80.8254302545834 L11.0844143354078,80.1828602353169 L10.7584021490722,80.5313672625099 L9.29232534712112,80.6288449062237 L10.1063777764015,80.7690301463485 L11.0844143354078,80.7341468424083 L11.3299015117186,81.0353821025839 L11.8789060335074,81.1384019534652 L12.0624508944142,81.3656324473419 L12.2518639746755,81.1442701728207 L12.5133257481164,81.1560066115292 L12.7144752670857,81.4653921763612 L13.0385313803031,81.6068814652303 L12.1253712463776,81.6698018171894 L11.7364387080791,82.0189608687581 L10.4323899627368,82.0228730149935 L9.1283412173943,81.7653233877878 L8.86850950488564,82.3250863117303 L8.15030465838856,82.3563834816159 L7.82429247205263,82.6840257288852 L7.17226809938165,82.6866338263739 L6.84625591304573,83.0142760736386 L6.37288621848669,83.0895848886842 L5.9402680472192,83.6350032764225 L5.54220716770406,83.6747767631546 L4.96712167100801,84.2919178318886 L4.42594144169068,84.4027619752408 L4.31803140801388,84.6208641279022 L3.84466171345484,84.7995188060147 L3.74294591131813,85.0238151902125 L3.21317610852297,85.1460697600878 L3.13102103756652,85.3899268754672 L1.95607311801323,85.4626275930195 L1.86478970583898,85.7537564754187 L1.6300609316776,85.8000502058773 L0.65202437267127,85.8085265227215 L0,85.6738834897666 L0,86.0161962854164 L0.978036559006615,86.0256506388241 L1.06214770308107,85.9291510316668 L1.95607311801323,85.9082862517408 L2.28208530434858,85.5861862116414 L3.26012186335519,85.6021608087709 L3.43030022462238,85.3631938761857 L3.98191284390188,85.2627821227977 L4.23815842236181,84.9758913988217 L4.65349794775341,84.9566566798255 L4.8901827950325,84.6586815415143 L5.3563802214926,84.6811763823749 L5.7472688329091,84.0940284347845 L6.30377163498345,83.9985068641884 L6.75366845212653,83.470367122324 L7.17226809938165,83.4612387811088 L7.498280285717,83.1287063510453 L8.47631684472361,83.1629376306098 L8.80232903105925,82.8157346521612 L10.1063777764009,82.8144306034168 L10.4323899627368,83.1335965338396 L10.8324069153706,83.1629376306075 L10.7584021490719,83.4263554771687 L9.45696150122128,83.5603464857525 L9.4475071478171,83.2369423969088 L9.45370137935747,83.5636066076169 L10.5585566788484,83.7628000534676 L10.6775511268616,84.2958299781286 L11.7364387080791,84.0728376426729 L11.8172897302903,84.6218421644611 L11.602447699495,84.7330123199988 L11.4231409970109,85.2060560023749 L10.3955505856807,85.4821883242012 L11.0498570436564,85.8450398875939 L10.7584021490722,86.0249986144484 L10.0724725090222,86.1371468065496 L10.5882237878053,86.4970642602611 L10.1875548107988,87.2302656673317 L9.67701972699754,87.2524344960021 L9.45435340373023,87.0167276852813 L9.31058202955615,87.3313294450953 L8.69800513143178,87.47510081927 L9.04064393927082,87.5627980973929 L9.27341664031391,87.8011130056047 L8.95522874645085,88.2800249073317 L7.82429247205292,88.7380720291349 L7.80570977743181,89.0865790563256 L7.02817071302148,89.1051617509461 L7.79038720467334,89.4650792046622 L8.47631684472332,89.3007690627493 L8.97804959949405,88.6288579467102 L9.53031424314631,88.5290982176933 L10.3120914659793,87.6808145088472 L11.7723000485758,87.5109621597667 L11.7843624994702,87.4271770278792 L10.9605297046004,87.2729732637403 L10.9266244372214,86.8230764465982 L11.5323550794326,86.2929806316137 L11.9793177868986,85.1102084195934 L12.1635146721784,85.091951737156 L12.3884630807498,85.3221163407092 L12.9759370405263,85.1930155149174 L12.5909166484644,84.9905619472069 L12.2714247058552,84.5409911422501 L12.640470500787,84.1409741896164 L13.1757825107504,84.0242618269065 L13.6123128282536,83.482755585406 L14.3445361987633,83.6115303990076 L14.9965605714343,83.1668497768452 L15.3225727577693,83.2480268112417 L15.7411724050242,83.0035176714912 L15.8598408408504,82.4701617346447 L16.1675963447513,82.1258928658772 L16.6266215031125,82.1193726221461 L16.8473317532612,82.6902199604238 L17.1325924163047,82.9109302105694 L17.1694317933605,83.5629545832458 L17.455996505149,83.7116161402125 L17.9306702484538,84.4568799981748 L17.9815281495221,83.2369423969064 L18.6524612290008,82.9109302105694 L17.9306702484538,82.6357759253042 L17.6046580621188,82.7883496285109 L17.4820774800563,82.7074986062977 L17.4846855775468,82.4649455396649 L17.7542976556463,82.2589058378998 L17.6330211223296,81.606881465228 L18.5826946211248,81.5371148573546 L18.9087068074605,81.2117546953909 L19.5607311801311,81.2130587441352 L19.8867433664671,80.8876985821738 L20.5387677391378,80.8886766187326 L20.8647799254737,80.5639684811422 L21.3723808995981,80.4844215076757 L21.8007609124429,79.9347649615142 L22.3703042019711,79.8522838783734 L22.4948408571513,79.5891920439977 L22.8870335173133,79.5846278733936 L23.1468652298226,79.827180940024 L23.3884402598971,79.5663711909562 L23.6322973752757,79.6508083472171 L23.8846308074999,80.3885739248964 L22.7129430098095,80.6288449062237 L23.047757525176,80.9548570925585 L22.8104206535242,81.2808692788955 L23.2978088720956,81.4559378229558 L23.4728774161576,81.8412842272044 L23.9136458920829,81.8181373619751 L24.3690849163942,82.3407348966719 L24.9272177794004,82.4346264063358 L25.4289505341708,83.2587852133914 L25.5469669456249,82.7032604478767 L25.9107965455749,82.5849180242369 L25.4289505341708,82.5125433188702 L25.1658586997981,82.1959854859384 L24.64260914073,82.0672106723367 L24.491991510643,81.5658039297515 L24.1249017888292,81.4957113096903 L23.9296204892138,81.2808692788955 L24.1249017888292,81.0826538696036 L24.9627531077113,81.0950423326832 L25.7549627205065,81.3933434831799 L25.7155152459602,80.9548570925585 L25.1029383478355,80.830972461751 L24.676188395922,80.4035704854647 L24.7769261614999,79.2478572849068 L25.149232078295,79.2785024304214 L25.9088404724572,80.4749671542727 L26.5895539175254,81.0983024545476 L27.1278000371653,81.2120807075787 L27.7110358385197,81.7848841189718 L27.9620652219981,81.5318986623725 L28.3630602111907,81.5025575656022 L28.6890723975263,81.8223755203961 L29.4219477924091,81.8520426293541 L29.6671089565329,82.1343691827237 L30.3191333292036,82.1255668536894 L30.6451455155396,82.4378865282025 L31.2971698882105,82.4287581869804 L31.6486110250801,83.262371347439 L31.800858716099,82.7625946657906 L32.1451275848691,82.4548391618885 L32.6012186335522,82.3955049439747 L32.9272308198878,82.6931540701004 L33.4149450506456,82.7492281661498 L33.9052673788945,83.2463967503095 L34.1999823953416,83.2056452270162 L34.2224772361995,82.9109302105717 L32.9272308198878,81.8582368608974 L32.2752064472172,81.7043591089441 L31.9491942608815,82.1037240372044 L30.9711577018746,82.0825332450929 L30.9711577018746,81.5149460286841 L30.3191333292036,81.4412672745684 L29.9931211428683,81.735656278832 L29.8027300260481,81.471260395712 L29.0150845838617,81.3946475319266 L28.8338218082593,81.136119868162 L28.3630602111907,81.0591809921842 L28.1853835696376,80.8065215477774 L27.6461594134388,80.6937213313051 L27.3850236521844,80.4042225098404 L26.6765991712773,80.3592328281262 L26.3489569240094,79.9187903643847 L26.7329992795134,79.5618070203452 L27.3850236521838,79.5474624841479 L27.7110358385197,79.2276445293541 L28.6532110570293,80.0126818740486 L29.4522669257376,79.8656503780118 L29.5735434590549,80.0703860310279 L30.2180695514403,80.4038964976549 L30.3191333292036,80.6252587721738 L30.6451455155396,80.365101047477 L30.6268888331042,79.9585638511145 L30.8951968624585,80.0527813729662 L31.3320531921478,79.9768205335495 L31.2009962932414,79.6508083472171 L30.5108284947691,79.4591131816516 L30.4880076417256,79.1676582870646 L30.7677260976015,78.9987839745452 L30.3191333292036,78.9293433788573 L29.9931211428683,79.1673322748814 L29.3410967701973,79.1402732634143 L29.0150845838617,78.8462102713409 L28.2880774083332,78.7477545910683 L28.1475661560229,78.2362414707067 L27.3201472271032,78.08562384062 L27.6005177073519,77.6947352292038 L27.2849379109796,77.3687230428691 L28.0370480248553,77.2761355819496 L28.3630602111907,76.9484933346803 L29.015084583862,76.9432771397028 L29.5530046913155,77.4828273080857 L29.993121142868,77.5503118306558 L30.3191333292042,76.9321927253653 L31.4076880193784,76.9321927253653 L31.6231820745456,77.1744197798103 L31.8383501175276,76.9318667131775 L32.9272308198878,76.9005695432872 L33.2532430062241,76.5683631254115 L34.3577722935286,76.5902059418987 L34.4086301945968,77.042710856532 L34.6104317379383,77.0958508429049 L34.761701392398,76.2690839383582 L35.2996214998521,76.1549796731416 L35.5353283105723,75.8615687054369 L35.861340496908,75.8941699240738 L35.9829430424108,75.5342524703554 L36.4533786272932,75.4126499248558 L35.9950054933057,75.2789849284575 L35.9412134825601,75.0866377385188 L35.9774008352434,74.8766858905183 L36.5661788437652,74.760625552184 L36.6587663046847,74.4346133658469 L36.5009764064979,74.4222249027673 L36.3735056416406,74.6207663242471 L35.8258051685977,74.7250902238728 L35.2536537815785,75.4569875821967 L34.6854145407955,75.8667849004213 L34.4236267551686,75.8723271075889 L34.2068286512547,75.7142111972123 L33.9052673788945,76.2234422322684 L33.6043581309073,75.7135591728436 L33.0944750714782,75.5714178595988 L32.9272308198878,75.1639026266798 L32.9272308198878,76.0871691383813 L32.7358616665094,75.9300312645705 L31.9821214917017,76.0976015283455 L30.3191333292039,76.1921450623827 L29.8164225378743,75.7386621111906 L30.8159759011795,74.9314559378234 L30.8886766187321,74.6781444690409 L31.5283125283226,74.3397438196265 L31.5524374301116,73.7825889931774 L31.8148772401113,73.6482719724081 L31.9185491153663,73.0999194749909 L32.1842490472296,73.0396072205182 L32.516781477292,72.3941030915752 L33.1479410700369,72.047226125312 L33.4338537574531,71.6811144400596 L33.5365475961493,70.8484793161599 L33.8205042104475,70.7637161477112 L33.8772303308694,70.1684178954621 L34.1481464577151,70.1133218359738 L34.2312795652301,69.6448423242065 L34.5572917515657,69.4942246941198 L35.2093161242364,70.0305147406429 L35.5353283105723,69.8362114775864 L35.4681698001871,70.1964549434857 L35.9288250194796,70.2639394660582 L36.3819819584856,69.8704427571509 L36.4181693111687,69.1232228260685 L37.8174136149209,69.0971418511627 L38.104304338896,70.2355764058445 L38.756654723754,70.561262579996 L39.8915031443876,70.7304629047009 L40.0166918239409,71.2572985978256 L40.2429442812572,71.3570583268379 L40.4255111056051,71.775331961909 L40.7515232919411,72.0883036607931 L41.1675148417051,72.1525280615012 L41.255864144202,71.8265158751641 L40.5353772124002,71.1744915024923 L40.772388071866,70.5224671298205 L40.5441795414316,70.4037986939951 L40.446049873344,69.8499039894104 L39.7734867329344,69.6930921277874 L39.6248251759652,69.5444305708161 L39.5967881279405,69.2184183844791 L40.0062594339778,68.7991667128515 L40.2272956963132,68.7646094211014 L40.4255111056051,68.9478282698204 L40.8353084238288,68.5663940118118 L40.4255111056051,68.1099769509385 L40.0994989192695,68.0933503294334 L39.7734867329341,68.3652444928411 L39.6782911745245,67.9143696391377 L40.0994989192695,67.4902277847135 L41.0775354782764,67.4599086513867 L41.4035476646117,67.7891809595859 L41.6330602437919,67.8178700319828 L42.3209459569602,67.5883574528029 L41.7295598509471,67.449150249237 L41.4035476646117,67.094448990503 L40.3635687902011,66.998275395536 L41.4035476646117,65.8820096695223 L42.055572037283,65.8787495476579 L42.3815842236181,66.1982414902685 L44.4638240577434,66.0844632372374 L44.1485702735572,65.1693470301899 L43.9082992922279,64.9802599621178 L43.9131894750231,64.5557920955105 L44.4498055337311,64.1143715952101 L44.2229010520414,63.6762112167765 L44.5948809566501,63.3501990304417 L44.6033572734951,62.6981746577675 L44.8752514368984,62.5837443803654 L44.9896817143026,62.3177184363155 L45.165076270551,62.6981746577675 L44.9613186540915,63.052549904316 L45.3564454239298,63.0649383673979 L45.6417060869736,62.5987409409361 L46.0234663571728,62.6424265739082 L46.2937304596448,62.9296433100651 L47.2717670186514,62.9518121387378 L47.7858882365023,62.5602715029506 L47.867717295273,62.3160883753833 L48.0290933275087,62.91888490792 L48.9533378757697,63.0241868441046 L48.9585540707512,64.0022234031089 L48.7016564679186,64.128064107034 L48.6181973482172,64.3706171736738 L47.9237913913221,64.3966981485773 L47.5977792049865,64.0801403156433 L47.2717670186512,64.4015883313739 L46.4511943456446,64.4856994754469 L45.8096023629367,65.148156238083 L45.7186449629488,65.7092232107652 L44.8778595343895,65.8464743412111 L45.1937653429485,66.406237265149 L45.730381401657,66.5216455791122 L46.2937304596448,67.0748882593236 L46.9457548323158,67.0807564786791 L47.3627244186385,66.7012782937836 L47.3627244186385,66.5193634938067 L46.6197426459805,66.4460107518857 L46.4805354424148,66.2843087074569 L46.507268441694,65.9582965211245 L46.9457548323158,65.5247003132996 L48.901827950329,65.5416529469879 L49.2278401366641,66.1685743813104 L49.4814776176335,65.8859218157577 L49.8798645093354,65.8556026824286 L50.205876695671,65.553715397882 L50.6329526597709,65.9582965211245 L50.4295210554971,66.7126887203043 L50.9824377235225,66.8117964249503 L50.6593596468637,67.2623452664635 L50.93549196869,67.6659483531494 L50.4102863365033,67.7927670936358 L50.2058766956713,68.0946543781847 L49.8798645093354,67.8612296527648 L49.6741508197581,67.9143696391377 L49.6999057824782,68.3864352849527 L48.9660523510368,68.5663940118118 L49.2278401366641,68.6319224612597 L49.4172532169252,68.8924061981443 L49.0012616671614,69.3178521013128 L48.5758157639934,69.3801204289032 L48.3612997453847,69.655926738544 L47.8625011002912,69.8091524661194 L48.0506101318067,70.323273683972 L47.2717670186512,70.7549138186792 L46.2937304596448,70.8096838659843 L46.2200517055328,71.1008127483812 L45.7411398038059,71.1744915024923 L46.2937304596448,71.2556685368911 L46.3791456524645,70.9338945089772 L46.9457548323158,70.9241141433864 L47.5977792049865,71.5569037970643 L48.2498035776578,71.0717976637941 L48.4454108894589,70.3920622552889 L48.7759872464033,70.0706142395582 L49.553852323,69.9477076453119 L49.4576787280306,69.4482569758444 L50.205876695671,69.3970730625916 L50.5318888820069,69.0945337536716 L51.3811506274107,69.0896435708774 L52.2610575183305,69.771335052505 L52.3839641125785,70.3004528309282 L52.8139741863552,70.7650201964556 L53.029468241523,70.9589974473242 L53.6277006034486,71.0127894580704 L54.1180229316972,71.5741824429405 L54.1542102843803,71.1744915024923 L53.9171994249142,71.0493028229405 L53.8630814019834,70.7774086595375 L53.4659985590262,70.3689153900573 L53.1399863726908,70.397930474642 L52.7024780186282,69.9819389248788 L52.6063044236591,69.4260881471763 L52.039369231622,68.892406198142 L52.0804467671002,68.4848909652229 L52.8139741863552,68.4324030032257 L53.1399863726908,68.6668057651999 L53.7714719776227,68.5663940118118 L53.325813318902,68.3805670655995 L53.3659128178214,68.1402960842653 L54.5395566886289,68.0098912097314 L54.3168903653621,67.5883574528029 L54.7700473043682,67.1479149890637 L56.0740960497104,67.1466109403147 L56.4900875994742,67.4983780893745 L56.7261204223814,68.0010888807041 L57.1127708753755,67.9750079057959 L57.3781447950529,67.7539716434579 L57.942471889599,68.3280791035954 L58.9505015697489,68.2980859824541 L59.0082057267302,68.4115382232997 L59.0082057267302,68.2116927530755 L58.2058897361584,68.0646612570365 L57.7041569813883,67.439043871463 L56.9566110381207,67.3578668370619 L57.0068169148167,66.655636587696 L56.5699605851271,66.4404685447135 L56.5314911471388,66.2843087074569 L56.7261204223811,65.5511073003886 L57.3781447950527,66.1966114293363 L57.8524925261708,66.1066320659102 L58.0301691677239,65.5406749104314 L59.0848185905191,65.5556714709997 L59.2311980621839,65.9582965211245 L58.9974473245811,66.2843087074569 L59.3342179130656,66.309737657994 L59.3671451438857,65.9912237519446 L59.6833769646311,65.9814433863561 L59.9862422857366,65.523070252365 L60.3122544720722,65.8419101706023 L60.6382666584078,65.8402801096724 L60.9205932117748,66.001982154092 L62.2083413477997,66.0182827634116 L62.2683275900854,66.1089141512111 L62.9203519627564,65.7949644157727 L63.5929151031671,65.6528231025279 L63.4475136680614,65.1814094810863 L64.224400708099,64.8299683442167 L65.0469294542232,64.8097555886663 L65.258511363155,65.3062721484526 L65.3732676527449,64.4834173901437 L65.0498635639001,64.0022234031089 L65.3442525681611,63.3501990304417 L64.550412894434,63.2484832283024 L64.550412894434,62.5993929653071 L64.9194586893659,62.4151960800293 L65.3706595552539,62.5299523696215 L65.4815036986087,62.7451204126018 L66.1804738261119,62.8233633373217 L66.5064860124472,62.4552955789492 L68.8684443024479,61.7201380987632 L68.81758640138,61.3651108278437 L68.1365469441248,61.1088652493847 L67.8105347577892,61.1952584787632 L66.9840938654289,60.4160893534218 L66.6209162898508,60.3016590760151 L66.3565204067331,59.9140305864633 L66.4161806368324,59.6737596051314 L66.5977694246212,59.6727815685749 L66.8324981987829,59.9319612567151 L68.4625591304608,59.9225069033098 L68.8792027045973,59.8546963685518 L69.1145835031315,59.5638934983404 L69.4405956894671,59.5469408646497 L69.6860828657779,59.76406498075 L69.7141199138023,60.0375892050829 L69.5194906385603,60.0900771670871 L69.7313985596779,60.1252864832104 L70.4792705151319,59.4380527944152 L69.2518346335788,59.300801663967 L68.7885713167958,59.1179088274336 L68.4625591304605,59.1971297887123 L68.2571714530688,59.5586773033583 L67.8105347577892,59.594538643855 L67.666437371429,59.2939554080574 L68.1062278107954,59.1120406080781 L67.3775905743362,59.0051086109614 L67.2745707234534,59.2281009464148 L66.1804738261116,59.2339691657679 L66.1804738261119,58.9718553679534 L67.28467710123,58.912195137854 L67.4845225714539,58.5734684762519 L68.5541685548205,58.2256134734322 L68.4625591304605,57.5879336369599 L69.4405956894674,57.4193853366261 L70.1154409151816,57.8079918627391 L70.6223898649332,57.930246432612 L70.7446444348085,58.3387397020899 L70.8166931279894,57.8800405559157 L70.5878325731818,57.6387915380296 L70.5363226477408,57.1559674900649 L71.0706566211444,56.6705353446115 L71.3966688074803,56.8958097653704 L72.0486931801516,56.4759060693695 L72.3747053664867,56.5355662994688 L73.0267297391576,56.2092281009462 L74.0047662981648,56.2092281009462 L74.1312590264622,55.9784114730243 L74.3307784844999,55.9823236192574 L75.0382249288481,56.448521045717 L75.0675660256184,56.7451921352838 L75.3088150435065,56.9329751546138 L75.7574078119038,56.6268497116417 L76.6128637888487,56.5391524335164 L76.9176851830722,56.1567401389467 L77.2648881615194,56.1260949934344 L77.6658831507123,56.4289603145376 L77.7389098804512,56.8299553037278 L77.4200699622154,57.1559674900649 L77.375406292687,57.5924978075687 L76.2868516025128,57.7691964125635 L76.1561207157922,58.0032731623521 L75.3163133237921,58.1340040490715 L75.9608394161775,58.3566703723394 L76.2868516025128,58.2132250103503 L77.2648881615194,58.2842956669727 L77.5909003478551,58.5998754633455 L78.0469913965385,58.655949559395 L78.6413116122282,59.1844153134449 L80.4689359288252,59.1681147041276 L80.5064273302538,59.4566354890358 L80.8047284807508,59.4843465248761 L80.8510222112105,59.8429599298432 L81.0671682907505,59.8739310875457 L81.1555175932476,60.1115939713819 L81.4978303889,60.0900771670848 L81.2174599086516,60.049651655977 L81.1770343975462,59.6616971542397 L81.014354316564,59.4380527944129 L80.652480789732,59.3105820295579 L80.5250100248749,59.0396659027091 L79.8729856522042,59.020105171532 L79.5469734658683,58.6839866074209 L78.4349458982779,58.5940072439924 L78.5689369068617,58.2402840218173 L79.220961279533,58.1476965608978 L79.3269152400918,57.9139458232947 L79.9577488206508,57.8079918627391 L79.5469734658683,57.6899754512824 L78.5689369068617,57.7564819372961 L78.242924720526,58.0163136498027 L77.757166562886,57.4819796763997 L78.0316688237809,57.2707237796548 L78.1425129671346,56.7295435503398 L78.6383775025513,56.5733837130833 L78.8949490931973,56.2574779045225 L79.3164828501287,56.1779309310583 L79.1423923426258,55.7733498078158 L79.5469734658683,55.5272106071331 L79.7944167152971,55.1213254351463 L80.1989978385393,55.0003749140131 L80.5250100248746,55.2279314200753 L81.1770343975462,54.9583193419801 L81.5030465838815,55.0450385835441 L82.4080564131489,54.5478699993798 L81.5245633881798,54.5263531950804 L81.1770343975462,54.7822727613563 L79.5978313669368,54.4970120983125 L79.2522584494209,54.1905606431571 L79.2578006565885,53.8590062496547 L78.4505944832218,53.6881758640154 L78.4786315312469,52.5014915057526 L78.6706527089987,52.4900810792319 L78.8949490931973,52.7378503408468 L79.220961279533,52.7368723042879 L79.5469734658686,52.7277439630728 L79.8729856522042,52.4907331036053 L80.4004733696947,53.0423457228845 L80.8510222112108,53.0964637458162 L81.1770343975459,52.7737116813435 L82.4445697780184,52.5917968813712 L82.4810831428879,52.1960180871538 L82.6643019916089,52.4085780326476 L83.2827471090875,52.4421572878411 L83.7851318882298,52.7094872806354 L84.4371562609011,52.0662652369933 L84.7631684472364,52.4327029344358 L85.2091531181441,52.4718243967946 L85.4184529417712,52.9178090677037 L85.3183672005664,53.3406468733835 L85.782934566094,53.2855508138906 L86.067217192579,53.0941816605107 L87.3712659379207,53.3093497034932 L86.8209573673867,52.5917968813712 L85.6629620815229,52.3440276197517 L85.7685900298959,51.9123874850422 L84.9666000515102,51.7366669166086 L85.0891806335721,51.4246732542879 L87.0452537515856,51.4188050349325 L87.3712659379209,51.5651845065982 L87.6219693092127,51.2124393209819 L87.8824530460953,51.1469108715318 L88.9191717986418,51.0438910206457 L89.3273390559344,51.2430844664988 L89.765499434369,50.9617359496905 L87.6337057479212,50.6992961396904 L87.3311664390013,50.2696120781033 L88.8122398015241,49.9836993906838 L89.0013268695988,49.584660474609 L89.2549643505674,49.7300619097135 L89.6533512422698,49.7059370079254 L89.9793634286051,49.9504461476782 L91.0506394729037,49.7509266896396 L91.6094243602827,49.4301306982846 L92.2614487329534,49.366232309762 L92.3752269859851,49.1194410847083 L92.5874609192894,49.0588028180501 L92.849574717103,49.0695612201975 L92.913473105625,49.2834252144357 L93.2257927801344,49.0056628316772 L91.7117921867925,48.9032950051692 L91.2834121739474,49.2214828990308 L90.8983917818846,48.6206424396141 L90.3053756149408,48.9446985528335 L89.3273390559342,48.840700665391 L89.0013268695985,48.1616172812544 L88.7545356445425,48.3536384590077 L88.8650537757104,48.6796506453425 L88.6753146832632,48.8296162510558 L88.0232903105916,48.8120115929941 L87.6972781242566,48.5290330152558 L87.3712659379207,48.5166445521716 L87.0452537515859,48.7996231299145 L86.3932293789143,48.7927768740002 L85.741205006243,48.4778491020006 L85.415192819908,48.784300557156 L85.0194140256964,48.7494172532182 L85.2785937138331,48.3536384590077 L85.3082608227898,47.5946820892191 L85.8377046133985,47.472101507156 L86.3932293789143,46.9273351437887 L86.5272203874984,46.531556349576 L86.7906382340573,46.3975653409921 L86.3061841251624,45.6584957145707 L87.3712659379209,45.6056817403834 L87.6972781242566,44.9389868193287 L89.2735470451888,44.767504409316 L88.5432797477971,44.573527158445 L88.8660318122698,43.9801849793183 L89.0013268695988,43.9061802130193 L89.3273390559344,44.0541897456126 L89.6533512422698,43.9215027857755 L89.9793634286051,43.523115894074 L90.7308215181082,43.4634556639746 L90.6313878012761,43.3738023127317 L89.6533512422698,43.3884728611145 L89.3273390559342,43.69329425534 L89.0013268695988,43.4533492861959 L88.8311485083314,43.619289489041 L88.1957507571632,43.7894678503094 L88.141632734232,44.233822460284 L87.6972781242566,44.2817462516748 L87.3712659379207,44.5934139018099 L86.9983079967531,44.3945464681493 L86.7192415652499,44.9243162709436 L84.4371562609014,44.869220211453 L83.6990646710377,44.2015472538395 L83.7039548538322,44.0343030022477 L84.1111440745657,43.6916641944078 L84.7631684472364,43.6789497191404 L84.9431271740939,43.7894678503094 L84.6630827060319,44.1154800366442 L84.7631684472364,44.3009809706686 L85.3402100170508,44.516475025839 L85.8024952972743,44.5027825140104 L86.0401581811131,42.8114312913028 L85.7001274707654,42.770353755824 L85.415192819908,43.2671963278004 L84.4371562609014,43.2417673772656 L84.3732578723791,43.0735450891173 L84.9046577361064,42.9529205801719 L85.2091531181441,42.60539158954 L85.1700316557839,42.4045680827547 L84.1111440745657,42.2686210010532 L83.8477262280066,42.5480134447416 L83.4591197018948,42.5636620296902 L83.0887698582174,42.2037445759741 L83.0740993098328,41.8333947322962 L83.3404512660686,41.7147262964708 L83.4186941907893,41.1409448485188 L83.9882374803172,41.0584637653757 L84.0697405269014,40.8139546256252 L84.6304814873981,40.7229972256379 L84.7191568020811,40.1593221554623 L85.2769636529012,40.0651046336129 L85.4151928199077,39.8072289942217 L86.2298972735603,39.7139895089289 L87.0452537515856,38.716066206555 L87.4433146311007,38.6453215621205 L87.5010187880824,38.2472606826045 L87.7171648676226,38.2273739392372 L88.0232903105916,38.4161349951261 L88.455582469673,38.3538666675357 L88.1494570267037,37.7950817801567 L87.3712659379209,37.7086885507782 L87.3712659379207,37.5072130196242 L87.8537639736975,37.4257099730399 L88.0232903105916,37.173376540814 L88.6753146832632,37.15968402899 L89.0013268695985,37.4716776913107 L89.4541577964185,37.3960428640842 L89.850914627189,36.8147631358469 L90.3353687360838,36.6171997509283 L89.8584129074745,36.4121380857198 L89.8841678701949,36.195992006183 L90.4152417217362,36.0750414850544 L90.8318852958724,35.5136485001821 L91.0894349230779,35.5071282564533 L92.2614487329534,36.0975363259081 L92.7938266332396,36.0848218506407 L92.913473105625,36.3511738068761 L93.3076218389041,36.3593241115371 L92.968895177302,36.2357654929174 L92.9525945679849,35.9260539158954 L92.3615344741588,35.2130652643798 L91.1751761280842,35.0953748651156 L91.1018233861583,34.335114446578 L91.2834121739477,34.050179795722 L91.6094243602827,34.355327202133 L92.1535386992769,34.4430244802559 L92.913473105625,34.9375849669292 L94.5435340373026,34.8244587382691 L94.6664406315512,34.335114446578 L94.1555795355632,34.2731721311754 L93.8243511542461,34.402272956965 L93.9417155413268,33.9588963835469 L93.58114606324,33.3414293026274 L93.6368941471036,33.0310657012366 L94.217521850967,32.6861448080935 L94.8695462236376,32.8139415851363 L95.1955584099736,32.5919272862418 L95.8475827826448,32.9492366424691 L96.1735949689802,32.4941236303425 L96.7027127474032,32.5019479228134 L97.1128360778129,32.7438489650751 L97.4776437143219,32.7334165751109 L97.5082888598376,32.4096864740817 L97.8124582296889,32.3790413285648 L96.9139686441486,32.2906920260685 L96.5794801409682,32.0530291422323 L96.5644835803961,31.7270169558952 L97.0065561050672,31.2559293466368 L97.4776437143221,30.8601505524286 L98.1296680869934,30.8656927595963 L98.8713458109067,30.5126215617945 L99.514893866733,30.4229682105515 L99.5442349635035,30.2074741553858 L100,30.0969560242168 L99.1200931090805,30.0969560242168 L98.2277977550802,30.5210978786386 L97.1516315279868,30.2576800320775 L96.8256193416515,30.5905384743288 L96.4996071553158,30.6224876685901 L95.8475827826448,31.2477790419805 L95.1574149841725,31.1131360090256 L94.9171440028429,30.7013826176833 L94.6918695820851,30.7489803968909 L94.5435340373026,31.1242204233608 L93.8915096646319,30.9240489409535 L93.4526972618237,30.9621923667512 L93.263284181563,31.0749925832257 L93.4491111277741,31.4010047695581 L93.2394852919601,31.587157727956 L92.9134731056253,31.1111799359079 L92.5874609192896,31.3123294548764 L92.1933121860093,31.1431291301669 L91.7140742720966,31.4010047695581 L91.7313529179719,31.7270169558952 L92.0955085301092,31.8929571587403 L92.3096985365312,32.4272911321434 L91.9096815838977,32.4047962912874 L91.0529215582084,31.6314953852992 L90.6313878012761,31.5920479107526 L90.4162197582947,31.8378610992497 L89.8642811268288,31.9379468404569 L89.7267039841951,32.4523940704904 L88.6753146832632,32.4703247407399 L88.3493024969275,32.7940548417714 L87.3712659379207,32.7898166833482 L87.0452537515856,33.1132207721942 L86.2400036513366,33.2038521599937 L86.067217192579,33.4604237506383 L85.4151928199077,33.4760723355846 L85.0891806335724,33.8121908996957 L83.7851318882298,33.8930419219066 L83.4147820445533,34.335114446578 L83.5530112115595,34.5672351232489 L84.1111440745657,34.7709927397084 L84.4371562609011,34.4410684071382 L84.6689509253862,34.6611266329128 L83.5533372237456,36.0593929001058 L83.005310738516,36.1633907875484 L83.1754890997832,36.6595813351515 L82.8745798517954,36.9432119372631 L82.8465428037701,37.3086715981445 L82.5977955055964,37.3859364863055 L82.1550709565528,37.9776486045046 L81.7615742476455,37.9887330188399 L81.7384273824154,37.2692241235978 L81.0740145466639,36.3942074154749 L80.5250100248749,36.1976220671129 L79.220961279533,36.1474161904212 L78.894949093197,35.8057554191355 L77.2648881615194,35.7725021761322 L77.0252692045629,36.051568607635 L76.4769167071466,36.1552404828897 L75.6348272298421,37.0413416053502 L75.3088150435062,36.7322820527061 L74.6567906708355,36.7599930885418 L74.5348621131461,37.0651404949528 L75.0796284765127,37.2692241235978 L74.6567906708355,37.6809775149401 L73.352741925493,37.7008642583073 L73.0267297391579,37.3891966081699 L72.8206900373937,37.5952363099349 L72.8894786087109,38.0584996267179 L73.7589531096674,38.2472606826045 L73.4026217900026,38.6231527334477 L72.8454669635555,38.7180222796751 L72.7007175528223,38.9674216022198 L72.3747053664867,38.6531458545936 L71.5658691321881,38.7424731936464 L71.5658691321881,39.0560969169039 L72.1240019951946,39.2252972416111 L71.2307286046355,39.3853692251054 L71.1508556189831,39.5513094279482 L71.4592631472562,39.8773216142829 L71.1922591666478,39.9989241597848 L71.1296648268713,40.5293459869548 L70.535670623368,40.9723965481804 L70.1552144019143,41.5073825459614 L70.2008561080015,42.3771830591045 L70.4688381251692,42.4854191049657 L70.450255430548,43.1690666597133 L70.0561066972683,43.1739568425076 L69.978841809107,42.9252095443338 L69.7666078758024,42.8681574117232 L68.9398409712558,42.9627009457627 L68.8570338759269,43.7894678503094 L68.4667972888829,44.4457303814022 L67.8105347577892,44.3922643828415 L67.6181875678516,44.5751572193772 L66.9361700740376,44.767504409316 L67.1008062281369,45.4195287819855 L65.2259101445213,45.4430016594027 L65.2024372671053,45.7830323697515 L64.5129214930054,45.7455409683226 L64.8073104972664,45.6764263848179 L64.8764250807694,45.4152906235623 L65.4704192842729,45.3614986128184 L65.5010644297884,45.0661315719982 L66.4145505759011,44.6755689727698 L66.5064860124472,44.3929164072171 L66.9886580360374,44.2716398739007 L67.7704352588704,43.4233561650547 L68.3399785483983,43.3408750819115 L68.7412995497775,42.764159524283 L69.3043225955789,42.6751581974134 L69.3907158249577,42.1095270541224 L69.6133821482247,42.0061811910509 L69.7082516944486,41.4490263646087 L69.9987285524731,41.181370359622 L69.3574625819512,40.5293459869548 L69.6583718299395,40.20333380062 L69.4405956894674,39.6641096444204 L69.1846761231938,39.9474142343441 L68.7885713167958,39.9643668680348 L68.2887946351437,40.3555814916365 L68.2040314666965,40.8553581732918 L67.9295292058018,40.9743526213004 L67.8649787929073,41.5073825459637 L67.5878684345219,41.610728409026 L67.5181018266465,41.8669739874873 L66.2874058232301,41.9403267294129 L65.8544616397765,42.5558377372147 L64.9758587976017,42.5848528217971 L64.9060921897263,43.1671105865956 L64.0007563482725,43.2398113041502 L63.92446949667,44.1415610115523 L63.8116692801975,43.8761870918734 L63.5723763354277,43.8328274710914 L63.3330833906573,43.8761870918757 L63.2463641490918,44.1601437061729 L62.6781249083091,44.1992651685316 L62.6295490925453,45.4195287819855 L62.3367901492156,45.4879913411169 L62.2908224309423,45.7680358091786 L62.1962788969051,45.4915774751668 L60.9642788447435,45.4596282809055 L60.718465656246,45.4997277798231 L60.3363793738612,46.0956780564455 L59.9862422857369,46.1021983001743 L60.2389017301469,45.9982004127318 L60.2884555824693,45.3957298923852 L61.2120481063581,45.3412858572633 L61.591526291253,44.7427274831545 L62.1930187750421,44.692195594275 L62.243550663924,44.4167152968197 L62.5200089979369,44.3671614444944 L62.5685848137004,44.0897250739238 L62.8411310014774,44.0362590753677 L62.8926409269178,43.7617568144713 L63.1619269928309,43.7050306940485 L63.1619269928309,43.2218806338984 L62.8662339398247,43.1374434776375 L62.8844906222597,42.7755699508061 L63.4530558752287,42.6921108311041 L63.572376335428,42.4228247651898 L64.4043594349561,42.3393656454878 L64.8180688994153,41.7750385509412 L65.3413184584839,41.6462637373418 L65.4058688713784,41.0584637653757 L65.9662838196891,40.9671803532029 L66.294252079143,40.5293459869548 L66.2714312260995,40.2033338006177 L65.7582880448069,40.4331723919854 L65.3253438613539,40.9779387553503 L64.7287415603596,41.0336868392142 L64.2244007080987,41.5823653488146 L64.0640027124215,41.015756168967 L63.5723763354277,40.9381652686182 L63.0543429713408,41.3153613682081 L62.9620815226074,41.5491121058112 L62.7126822000609,41.6257249696012 L62.6321571900358,41.8712121459106 L62.0469653155634,41.9380446441097 L61.6163032174145,42.5294307501187 L61.5745736575635,42.1594069186309 L61.8572262231162,42.0743177379967 L61.9133003191657,41.8043796477114 L62.5030563642471,41.742111320121 L62.5630426065325,41.4760853760711 L62.8238523556012,41.4108829388042 L63.2463641490921,40.8080864062721 L64.224400708099,40.7996100894256 L64.4389167267076,40.7438620055617 L64.550412894434,40.471315817783 L65.0808347216019,40.4077434414505 L65.4241255538135,39.8773216142829 L65.4489024799749,39.2252972416111 L65.8097979702481,38.8546213857453 L66.2368739343474,39.1688971333738 L66.325875261217,39.7319201791737 L66.5064860124475,39.8046208967306 L66.8324981987829,39.4828468688168 L67.3521616238019,39.4189484802965 L67.4414889628576,39.1822636330146 L68.0146183864354,39.1033686839213 L68.0967734573921,38.8595115685442 L68.6190449799011,38.729758718379 L68.7885713167958,38.5015501879458 L69.4405956894677,38.4865536273752 L69.7196621209699,38.2003149277725 L70.2859452886351,38.1145737227673 L70.6957426068588,37.546334481983 L71.2320326533807,37.4306001558342 L73.8358919856423,34.6611266329128 L73.6787541118289,34.1688482315474 L72.3747053664864,34.1290747448153 L72.1151996661638,34.4016209325916 L71.5688032418655,34.507248880964 L71.4488307572935,35.0393007690639 L70.899826235505,35.1423206199452 L70.4662300276787,35.686760971127 L70.0926200621381,35.4184529417715 L69.7666078758024,35.7069737266797 L69.1145835031312,35.7206662385013 L68.8371471325602,36.0137511940206 L68.2662997942866,36.094928228417 L68.1776244796031,36.3325911122555 L67.5989528488577,36.4056178419956 L67.4845225714541,36.6719697982334 L66.94040823246,36.7251097846039 L66.5064860124475,37.3184519637353 L64.550412894434,37.3155178540564 L64.8079625216392,36.9432119372631 L64.4741260428315,36.6171997509283 L64.4943387983846,35.9091012822093 L66.3037064325466,35.7623957983535 L66.6134180095652,35.3131510055846 L66.5064860124472,34.7830551906025 L66.3193550174906,35.1260200106256 L65.8544616397765,35.4409477826298 L63.898388521763,35.391067918119 L63.6212781633779,35.6880650198713 L63.0478227276138,35.766633956779 L62.9607774738622,36.0056008893619 L62.7107261269426,36.0815617287809 L62.6282450437998,36.6511050183073 L62.365153209427,36.7140253702687 L62.2683275900854,37.3122577321944 L60.6115336591286,37.295957122877 L60.6102296103828,34.6330895848869 L60.8540867257617,34.5509345139316 L60.9362417967185,33.9810652122197 L61.1827070095878,33.9015182387531 L61.5028509765695,33.2436256467281 L61.88982744175,33.0310657012366 L61.91558240447,32.0262961429508 L62.1878025800609,31.9725041322069 L62.2412685786193,31.6999579444282 L62.5128367298371,31.645513909311 L62.5669547527685,31.3736197459079 L62.8381968918,31.3188496986029 L62.8926409269178,31.0472815473853 L63.1632310415765,30.9918594757069 L63.2186531132534,30.7212693610506 L63.488591203539,30.6651952649965 L63.8700254615519,30.0685929640054 L64.4398947632665,29.9864378930524 L64.8474099961858,29.4159165669625 L65.1147399889809,29.357234373422 L65.1714661094034,29.0879483075077 L65.4221694806957,29.0126394924667 L65.4971522835524,28.4355979226503 L65.7507897645213,28.3632232172813 L65.8172962505337,27.7777053306254 L66.1123372791675,27.4888585335317 L66.1067950719996,26.1848097881903 L66.363692674832,26.0420164505745 L66.4614963307327,25.4877957338042 L66.6923129586587,25.3929261875838 L66.7725119564975,24.5547488565142 L67.0320176568206,24.4282561282157 L67.1171068374536,23.8613209361803 L67.6423124696403,23.7345021956917 L68.4185474853048,22.880676279678 L68.9792884458021,22.7893928675052 L69.1145835031315,22.5298871671841 L69.627074660051,22.4591425227449 L70.042414185442,21.8964454891328 L70.5976129387717,21.7996198697923 L71.0155605616541,21.2395309336666 L72.0486931801513,21.2004094713055 L72.9673955212447,20.2572562162391 L73.6787541118289,20.2096584370338 L74.0047662981645,19.7111858041252 L74.8321852270836,19.5139484313898 L75.8682519552583,18.9199542278897 L76.3823731731095,18.7820510730705 L76.5176682304382,18.5916599562494 L77.0282033142398,18.4498446551925 L77.4911406188366,17.9347454007833 L78.0277566775449,17.8193370868177 L78.1340366502901,17.599604873231 L78.614578612949,17.4281224632183 L78.6986897570234,16.8602092346241 L79.2460642178808,16.4295471364735 L79.2861637168002,15.8176222627193 L79.5580578802035,15.7635042397898 L79.565230148303,15.4446643215526 L79.8530989088373,15.4264076391175 L79.5283907712469,15.4078249444947 L79.4498218343403,15.6552681939264 L79.179231719682,15.7106902656025 L79.0455667232842,16.2290496418737 L78.5689369068617,16.3473920655159 L78.0450353234202,16.2763214088958 L77.5909003478551,15.8867368462239 L76.7667415407992,15.7524198254546 L77.0898196174577,16.4044441981241 L77.7108728324265,16.6104838998869 L77.7265214173708,16.8660774539749 L77.4168098403519,17.2083902496316 L76.9388759751841,17.2898932962113 L76.6128637888487,17.5689597277164 L75.6348272298418,17.3045638445941 L75.1702598643139,17.3824807571331 L75.0072537711465,17.7329438574415 L74.3307784844996,17.6181875678516 L73.739066366301,17.7084929434678 L74.1651642938412,17.8741071341251 L74.2613378888106,18.1039457254928 L74.772851009171,18.2444569778054 L74.6567906708355,18.5271095433558 L74.0047662981648,18.5202632874415 L73.7993786207734,18.8071540114198 L73.352741925493,18.7983516823855 L73.0267297391579,19.0591614314556 L72.4311054747228,19.0689417970419 L72.3747053664867,19.2518346335799 L72.0486931801513,19.1817420135141 L71.7226809938157,19.3023665224618 L71.3966688074803,18.8619240587226 L70.7625751050577,18.668598832225 L68.7885713167961,18.5212413240004 L68.6480600644853,18.2200060638248 L69.1497928192554,18.069714445926 L69.1145835031315,17.7795636000879 L69.0770921017028,17.9970137283737 L68.545040213603,17.9520240466572 L68.467775325442,17.7032767484858 L68.1365469441248,17.683716017304 L67.1585103851179,17.9220309255159 L66.8324981987829,17.7022987119269 L65.9578075028446,17.9311592667311 L64.8764250807694,17.7974942703351 L64.224400708099,17.9507199979151 L63.8983885217636,17.8558504516924 L63.8873041074278,18.0234207154674 L63.697239002794,18.0345051298026 L64.4728219940866,18.1120960301515 L64.5409585410304,18.3699716695427 L64.7975301316767,18.4394122652306 L65.5284494534403,19.0881765160381 L66.1804738261119,19.1520749045583 L66.4575841844967,19.3874557030959 L67.053534461118,19.4435297991454 L67.0408199858512,19.872887848547 L66.7614275421616,19.9905782478182 L66.6437371428949,21.1058659372683 L65.8544616397765,21.0579421458776 L65.5284494534403,21.3780861128569 L65.2024372671056,20.7472525323013 L64.8764250807696,20.7495346176022 L64.4881445668442,21.0308831344105 L64.1151866256763,20.6426026204877 L64.0317275059744,20.1832514499401 L63.572376335428,19.9087491890461 L63.1629050293901,19.9071191281139 L62.5943397764214,20.4313467237405 L62.4469822681977,20.3165904341506 L62.6174866416512,19.9674313825866 L62.2683275900854,19.6032757704495 L61.9168864532161,19.6391371109486 L61.4735098797992,19.8477849101977 L61.2902910310785,20.2768169474185 L61.0467599278863,20.2341093510075 L61.113918438271,19.8142056550065 L61.4141756618863,19.7884506922885 L61.4845942941347,19.6645660614811 L60.9959020268178,19.3069306930705 L60.6382666584075,19.2358600364481 L60.462546089973,19.0125416888092 L60.9642788447435,18.4550608501746 L61.3453870905697,18.3605173161374 L61.2769245314392,18.0478716294411 L60.8439803479859,17.8287914402254 L60.6382666584078,17.4072576832923 L59.9448387380722,18.3191137684707 L60.17989352442,18.6865295024745 L59.6602300994012,19.1771778429076 L59.3342179130653,18.9202802400753 L58.8709545962829,18.8237806329203 L58.3561813540596,18.2125077835418 L57.741974395003,18.3226999025253 L57.6872043476988,18.0345051298026 L57.7537108337113,18.6369756501515 L58.4787619361215,18.8899611067462 L58.6759993088542,19.6645660614811 L58.4993007038606,19.9905782478158 L59.00820572673,20.0900119646473 L59.22174370878,20.3165904341506 L58.8432435604443,20.6426026204877 L59.1793621245563,20.9686148068225 L58.9149662414386,21.3875404662622 L59.4313695445936,21.5234875479637 L59.7785725230411,21.9466513658291 L59.7430371947301,22.3554706474925 L59.527869151749,22.4663147908447 L59.4046365453143,22.9951065570847 L59.1845783195378,23.1010605176427 L59.0694960177609,23.6380025885368 L58.6821935403946,23.997594030065 L57.3781447950524,24.0191108343644 L56.7261204223811,24.772851009171 L54.4440351180325,24.6975421941276 L54.1180229316972,24.3020894121027 L53.2498524794859,24.1188705633814 L53.1399863726908,23.9170690200396 L52.9554634752249,24.2287366701771 L53.3368977332375,24.3578374959689 L53.4659985590259,24.7030844012929 L53.8366744148899,24.8360973733202 L53.9677313137966,25.2067732291837 L53.7920107453615,25.3906441022783 L53.3698249640574,25.1105996342143 L52.8139741863552,25.4014025044257 L52.1619498136842,24.7891516184883 L51.3433332137957,24.7213410837303 L50.5318888820069,24.2313447676704 L50.0682995530376,24.3663138128108 L49.5571124448633,24.225476548315 L49.3986705223046,23.9027244838423 L48.6729673955211,23.8055728523117 L48.0085545597696,23.1659369427241 L47.5977792049862,23.3651303885749 L47.2642687383655,23.2507001111705 L47.6359226307879,21.2946269931572 L46.5486719893589,20.7136732771078 L46.5639945621168,20.3165904341506 L46.9457548323161,20.234435363193 L47.2717670186512,20.4411270893314 L48.0346355346764,20.4274345775051 L48.2481735167264,20.3165904341529 L47.7050372142914,19.9905782478158 L47.5977792049865,19.6335949037786 L47.7558951153593,19.338553875144 L48.2498035776578,19.239446170498 L48.4147657439437,18.8514916687584 L48.991155289385,18.6865295024721 L49.0560317144656,18.3605173161374 L48.9018279503293,18.3481288530578 L48.8861793653848,18.6708809175305 L47.969107085223,18.6412138085724 L47.8520687103281,18.941145019999 L47.2297114466138,18.9704861167693 L46.9457548323161,19.1993466715804 L45.6417060869736,19.1664194407579 L45.5187994927253,18.8896350945606 L46.0228143327995,18.6865295024721 L46.1721279141415,18.2389147706355 L46.548998001545,18.0345051298026 L45.9677182733089,17.6628512373826 L45.8096023629367,17.8763892194307 L45.5132572855571,17.836941744884 L45.3857865207003,17.056468570796 L45.7245131823028,16.8132634797899 L45.829489106303,16.4044441981241 L45.6417060869738,16.0816921336538 L45.3965449228497,16.4852952203351 L44.8879659121659,16.6287405823242 L44.7862501100291,16.853036966522 L43.9347062793204,16.8073952604344 L43.9288380599667,16.3216371027955 L44.2313773688861,16.0784320117894 L44.2199669423645,14.0046684945097 L44.6636695279669,13.6209521511909 L44.9896817143023,13.8442704988322 L45.3786142526005,13.7963467074414 L45.0555361759423,13.7304922458011 L45.0170667379548,13.4426234852663 L44.43741707065,13.0445626057502 L44.168457016923,12.6614982868072 L44.1185771524142,12.1662857757629 L44.4123141323024,11.5142614030934 L44.3376573416316,10.5349207953378 Z\" / fill=\"blue\"><\/svg><\/div><span class=\"legend-text\">10 minutes<\/span><\/div><div class=\"legend-item\"><div class=\"legend-patch-container\" style=\"width:20px; height:20px;\"><svg class=\"legend-color legend-shape-custom\" width=\"20\" height=\"20\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid meet\"><path d=\"M44.3376573416316,10.5349207953378 L44.0673932391593,11.1882492167563 L44.2630005509605,11.5142614030911 L44.1723691631593,11.6749854109541 L43.7162781144761,11.8402735894282 L43.4880695840415,12.9470849620365 L43.2171534571967,12.9607774738628 L43.0336085962893,12.7178983950398 L42.1211004867366,12.75278169898 L42.0673084759907,12.4805615233891 L41.8619207985996,12.4922979620977 L42.021666769904,12.5262032294767 L42.0347072573572,12.8391749283585 L42.7075964099537,12.9027473046979 L43.359620782625,13.5850908106942 L43.6856329689606,13.4618582042601 L43.81734189224,13.6643117719753 L43.8258182090845,14.774383266448 L43.558162204103,14.9729246879254 L43.4476440729354,15.514430929426 L42.5964262544131,15.7524198254546 L43.4453619876316,15.9926908067842 L43.4355816220411,16.4804050375408 L42.7075964099537,16.5195264999019 L42.3815842236184,16.2032946791557 L41.9659186860407,16.16808536303 L41.7686813133076,15.3872861767588 L41.5440589169223,15.5669188914278 L41.2923775090711,15.5372517824697 L41.0775354782761,14.984661126634 L40.5282049443007,14.9977016140869 L40.3319456081265,14.774383266448 L40.3775873142138,15.1003954527828 L40.0994989192698,15.2780720943364 L39.8862869494061,14.9875952363129 L39.4474745465985,14.9729246879254 L39.1214623602629,14.6615830499758 L38.6376602757414,14.6061609782974 L38.4694379875922,14.0904096995149 L37.1774516931443,14.1223588937762 L37.7336284830329,14.2061440256636 L37.8174136149209,14.6263737338501 L38.5871283868595,14.9827050535163 L39.1084218728094,15.4394481265728 L39.4474745465985,15.4717233330219 L39.7350172949464,15.7908892634401 L40.0994989192698,15.574743183901 L40.3208611937916,15.8570697372682 L40.8551951671955,15.9747601365324 L40.7515232919408,17.2954355033789 L40.8177037657666,17.1226490446218 L41.1231771843631,17.1024362890691 L41.4035476646117,16.2606728239518 L41.6027411104628,16.5312629386105 L42.055572037283,16.601355558674 L42.3815842236181,16.9338879887329 L42.7825792128106,16.9814857679382 L42.8119203095812,17.3824807571331 L42.5579568164259,17.5588533499377 L42.4467866608853,18.0997075670696 L42.2293365325995,18.2082696251185 L42.1315328766991,18.7624903418888 L41.6203457685248,19.2293397927217 L41.522216100438,19.7832344973064 L41.1642547198413,19.9905782478158 L40.8053153026864,21.0224068175687 L40.4255111056048,21.1753065329585 L39.9609437400772,20.7811577996803 L39.6306933953195,20.1333715854317 L39.0732125566857,20.0388280513921 L38.9760609251572,19.8099674965856 L38.4202101474553,19.7137939016162 L38.3204504184363,19.4875414442984 L37.8174136149209,19.4135366780041 L37.6211542787473,19.2088010249811 L36.839377055914,19.1898923181751 L36.513364869579,18.7660764759387 L35.861340496908,18.7670545124952 L35.5353283105726,18.5065707756153 L34.8833039379014,18.4446284602127 L34.5572917515657,18.1202463348078 L33.9052673788945,18.1218763957377 L33.8084417595529,17.9376795104599 L34.0571890577269,17.5344024359664 L34.4767667415409,17.3824807571331 L33.5241591330682,17.3273846976402 L33.244766689379,17.7084929434655 L32.9272308198878,17.7994503434551 L32.5653572930558,17.7443542839646 L32.4799421002355,17.5037572904472 L31.9491942608812,17.4773503033535 L31.6231820745459,17.6015609463487 L31.2971698882105,17.1539462145098 L30.6451455155393,17.2781568575073 L30.3875958883341,16.9880060116647 L29.9931211428683,16.8341282597159 L29.6671089565329,16.954752768659 L29.5171433508182,16.8804219901722 L29.3410967701976,16.5113761952409 L28.6890723975263,16.6313486798176 L28.3630602111907,16.3157688834424 L27.71103583852,16.3085966153426 L27.3850236521841,15.8707622490945 L26.9771824070784,15.8342488842221 L26.7329992795131,15.5512703064815 L26.0809749068418,15.5538784039749 L25.7549627205068,15.2327564004367 L24.7769261614996,15.3419704828567 L24.4509139751642,14.9977016140869 L23.6880454591393,14.8852274098025 L23.4728774161579,14.5999667467587 L22.8208530434869,14.6068130026707 L22.5616733553501,14.3815385819118 L22.1688286708157,14.2882990966189 L21.2912038652002,14.3479593267206 L21.1907921118087,13.9779354952305 L20.212755552803,13.9899979461245 L19.8867433664671,13.673114101005 L18.3355773838827,13.7174517583482 L18.2566824347898,13.4364292537276 L17.0690200399691,13.3539481705822 L16.9526336894472,13.0911823483967 L15.655105187832,13.1378020910454 L15.5879466774468,12.8183101484348 L15.6485849441053,13.1524726394305 L16.9109041295959,13.1860518946194 L16.9526336894469,13.4977195447568 L17.9306702484538,13.5537936408063 L18.2566824347895,13.8895861927319 L19.5607311801311,13.8807838637022 L19.8867433664668,14.2478735855158 L20.8647799254734,14.2648262192018 L21.1907921118087,14.5764938693393 L22.1688286708154,14.6084430636006 L22.494840857151,14.9390194205464 L23.248581031959,14.9986796506458 L23.4728774161579,15.30415306924 L24.1249017888289,15.2813322161962 L24.4509139751642,15.660810401094 L25.4289505341708,15.6187548290563 L25.624557845972,15.8828246999862 L26.3297222050161,16.0784320117894 L26.45393284801,16.3574984432922 L27.0590114658484,16.305662505666 L27.5809569761719,16.7304563844612 L27.3850236521841,16.9560568174034 L26.8898111411407,16.8996567091707 L26.7329992795131,16.6336307651162 L26.4069870931777,16.5136582805465 L26.0809749068421,16.5775566690667 L25.779739646668,16.3796672719627 L25.3986314008415,16.4044441981218 L25.7106250631653,16.4487818554673 L25.7549627205068,16.7539292618784 L26.4069870931777,16.7904426267461 L26.6818153662585,17.1076524840535 L27.2102811203084,17.2312111026708 L27.9046870772029,17.8408538911195 L28.0370480248551,18.3230259147085 L28.1234412542345,18.1208983591812 L29.3410967701973,18.188382881756 L29.6671089565327,18.4478885820748 L30.6451455155396,18.5372159211322 L30.9711577018746,18.8449714250319 L31.2971698882105,18.545692237974 L31.4973413706204,18.8123702063996 L32.0375435633783,18.924192386313 L31.7959685333035,19.6645660614811 L32.1128523784217,19.9905782478158 L31.6231820745456,20.5314324649454 L31.2971698882105,20.4267825531318 L29.993121142868,20.5539273058013 L29.6671089565329,20.25953830154 L28.5707299738868,20.3165904341529 L29.6361377988311,20.3475615918531 L29.6671089565327,20.7133472649223 L30.4658388130549,20.8219093229712 L30.9711577018746,21.5733674124746 L31.0575509312537,21.3810202225358 L31.2971698882102,21.3337484555183 L31.4712603957137,21.4465486719929 L31.6231820745456,22.0050075471817 L32.2752064472172,22.1575812503884 L32.6012186335525,22.0095717177882 L32.8362734199003,22.2726635521638 L32.4864623439626,22.5986757384986 L32.6012186335525,22.9543550337915 L32.6905459726085,22.688003077556 L32.9947153424595,22.6661602610711 L33.1071895467453,22.4526222790207 L33.988074474224,22.3554706474925 L34.1214134584353,22.1627974453705 L34.3320173308082,22.1719257865857 L34.4353631938766,22.2726635521638 L34.1644470670312,22.5986757384986 L34.3688567078635,23.0622650674671 L33.9734039258388,23.2507001111728 L34.1595568842361,23.648434978501 L34.3408196598391,23.6862523921131 L34.5572917515657,23.533678688911 L34.8833039379014,22.7711361850702 L35.1653044790816,22.9246879248357 L35.4446969227709,23.667343685307 L35.5353283105723,23.7270039154063 L35.861340496908,23.422508533371 L36.0435813090695,23.5767122975052 L36.0937871857647,23.9027244838423 L35.4857744582491,24.2287366701771 L35.879271167156,25.1888425589365 L36.4409901642122,25.2791479345504 L37.1653892422499,25.9585573308748 L38.1434258012566,25.8451050900293 L38.2682884686231,26.0599471208217 L38.4694379875925,26.1404721308494 L38.6050590571076,26.0491887186743 L38.7954501739278,26.5362509250622 L39.2759921365861,26.6823043845401 L40.0069114583503,27.5814459944489 L40.5405934073817,27.699788418091 L41.4954831011585,28.7009718423292 L41.5306924172824,29.1189194652102 L42.1582658759789,30.0969560242168 L42.1455514007117,31.0749925832234 L42.4660213798792,31.4010047695581 L42.4383103440406,31.7837430763157 L42.055572037283,31.8254726361702 L41.5251502101151,31.2794022240586 L40.9601710911954,31.1923569703044 L40.7515232919408,30.9410015746396 L40.6621959528848,31.4903321086156 L41.0775354782761,31.5757473014353 L41.2079403528109,31.7270169558952 L40.9852740295439,32.7973149636335 L41.1697969270095,32.7973149636312 L41.7295598509474,32.2688492095836 L42.3815842236184,32.2897139895097 L42.5445903167857,32.542047421731 L43.1059833016558,32.7050535149018 L43.0336085962893,33.4307566416848 L41.7295598509471,33.4574896409617 L41.4035476646115,33.1487561005031 L41.1952258775432,33.6830900739085 L41.4035476646115,33.8914118609767 L43.0336085962893,33.9354235061321 L43.4166729152336,34.9871388192522 L43.1447787518299,35.0983089747899 L43.0684919002269,35.6740464958595 L42.4888422329227,35.7464212012263 L42.3815842236184,36.0196194133737 L42.017754623668,36.0029927918686 L41.9365775892704,35.7581576399325 L41.7295598509474,35.6984974098332 L41.5225421126243,35.7581576399325 L41.4035476646115,36.0215754864891 L40.866279581531,36.0802576800319 L40.4255111056051,36.6765339688421 L39.1214623602635,36.6804461150752 L39.6841593938785,35.9651753782565 L39.4474745465985,35.7284905309768 L39.1214623602632,35.7226223116237 L38.7954501739275,36.035920022691 L38.1434258012566,36.0333119252 L38.1434258012568,35.8791081610657 L38.6229897273557,35.7927149316826 L38.6999286033312,35.639163191924 L38.4694379875922,35.4086725761807 L36.8393770559143,35.3881338084424 L36.6828912064737,35.1436246686942 L35.861340496908,35.0683158536463 L35.5353283105723,34.7533880816467 L35.1519379794417,35.044516964046 L35.0140348246219,34.2043835598586 L34.4353631938763,34.0091022602432 L34.557291751566,33.844140093957 L34.9641549601126,33.7639410961194 L35.0564164088454,33.5301903585163 L35.384384668299,33.3570778875714 L34.8833039379017,33.1389757349169 L34.6867185895414,33.4865047255464 L34.1344539458885,33.4539035069164 L34.2312795652298,33.1216970890361 L34.6808503701868,33.0310657012366 L34.0712075817393,32.8651254983915 L33.9052673788945,32.5994255665294 L33.389516100112,32.5687804210125 L33.2532430062238,32.257112770875 L33.1851064592791,32.7050535149018 L33.4012525388196,32.8830561686433 L33.4420040621115,33.3570778875691 L34.0271959365839,34.0091022602432 L33.9052673788945,34.429983992803 L33.729872822646,34.1844968164914 L33.1838024105341,34.0785428559334 L32.9272308198878,33.7900220710252 L31.6231820745456,33.8030625584759 L31.2971698882108,34.132334866675 L30.9711577018746,34.1375510616594 L30.6451455155396,33.5592054430987 L30.3191333292039,33.8190371556123 L29.3410967701976,33.8359897893006 L29.0150845838617,34.1698262681062 L27.7110358385197,34.2007974258087 L27.3850236521838,34.5391980752253 L26.0809749068421,34.5982062809513 L25.9717608244201,34.8779247368275 L25.2013940281084,34.9871388192522 L26.0809749068418,35.0415828543671 L26.4069870931777,34.7390435454494 L27.7110358385197,34.7876193612113 L28.0370480248551,34.4769297476326 L29.3410967701976,34.5030107225408 L29.6671089565327,34.1871049139824 L29.9931211428683,34.5088789418962 L30.3191333292036,34.1991673648788 L30.6451455155393,34.5290916974467 L30.9711577018746,34.5326778314989 L31.2971698882105,34.8000078242932 L31.6231820745456,34.8228286773369 L31.8702993117883,34.2562194974848 L32.6012186335525,34.2268784007145 L32.7795472994781,34.4827979669881 L33.2532430062241,34.5597368429659 L33.4273335137267,34.8130483117438 L33.9052673788947,34.8922692730271 L34.0751197279758,35.1432986565041 L34.5572917515657,35.223497654344 L34.8833039379014,35.5524439503553 L35.861340496908,35.5579861575229 L35.861340496908,35.6984974098355 L31.2971698882105,35.7170801044561 L30.9711577018746,35.4086725761807 L30.6451455155396,35.4050864421331 L30.3191333292039,35.7222962994358 L24.7769261614999,35.7809784929763 L24.4509139751642,35.4145407955384 L24.0121015723567,35.4259512220568 L23.5723111329902,34.8877051024161 L23.1468652298223,34.8769467002664 L22.8606265302196,34.6213531461806 L22.5734097940581,34.5825576960097 L22.4883206134248,34.3285942028515 L22.2275108643561,34.3937966401162 L22.0648307833749,34.8831409318096 L21.5657061260946,34.9382369913002 L21.5285407368527,34.649064182021 L21.3332594372382,34.6611266329128 L21.4917013597968,34.6862295712621 L21.5168042981447,35.0128937819702 L23.1468652298226,35.097330938231 L23.7988896024932,35.7920629073092 L24.2288996762703,35.8611774908139 L24.1249017888289,36.1206831911351 L21.8428164844806,36.1907758112009 L21.190792111809,35.9462666714481 L20.8647799254734,36.2507620534858 L20.5919077255112,36.2380475782207 L20.5387677391381,35.9400724399095 L20.2231879427655,35.9651753782565 L20.2577452345166,36.2911875645912 L20.8647799254737,36.4385450728158 L24.7769261614999,36.4727763523803 L25.1029383478352,36.1542624463285 L30.9711577018746,36.2119666033125 L31.0350560903969,36.3550859531138 L30.5127845678871,36.4848388032744 L29.9090099987938,37.2692241235978 L30.3191333292039,37.5531807378996 L30.5440817377753,37.1681603458342 L30.7973932065578,37.116976432579 L30.7960891578129,37.4201677658723 L30.6451455155396,37.5329679823445 L30.4840954954893,37.4341862898864 L30.435519679726,37.5952363099349 L31.2971698882105,37.734117501313 L31.8269396910057,36.9432119372631 L31.5703681003597,36.2383735904062 L32.2752064472172,36.2184868470366 L32.427128126049,36.465278072095 L32.6853297776269,36.533088606853 L32.4584252959373,37.0860052748789 L32.9272308198878,37.1668562970898 L33.2532430062238,36.8574707322556 L33.3389842112298,37.2692241235978 L33.2532430062238,37.3895226203554 L31.9491942608812,37.4870002640715 L31.8660611533659,37.9212484962697 L32.2752064472172,38.1429367829787 L32.4757039418137,37.7957338045301 L32.7000003260121,37.8224668038092 L32.9536378069809,38.8728780681826 L33.2532430062238,38.9328643104698 L33.4840596341489,38.8040894968658 L33.8358267832051,38.8298444595861 L33.9610154627581,38.6290209528031 L34.5572917515657,38.9442747369905 L34.6746561386464,38.6906372560225 L34.7574632339756,37.9212484962697 L33.8547354900129,36.8926800483789 L34.5572917515657,36.227941200442 L35.861340496908,36.231853346682 L35.6037908697028,36.6171997509283 L35.5780359069822,37.3119317200088 L35.209316124237,37.0178687279331 L34.9579607285722,37.2692241235955 L34.9905619472057,38.5732728689392 L35.3550435715288,39.0795697943187 L36.1873526832433,39.1600948043441 L36.513364869579,39.4652422107551 L37.1653892422499,39.4926272344077 L37.2742773124859,39.7684335440461 L37.4914014285853,39.8228775791634 L38.7954501739275,39.8290718107043 L39.0249627531077,39.780822007128 L39.1214623602635,39.5053417096728 L40.1278619794809,39.5226203555489 L40.1855661364622,40.1172665834247 L40.4662626288976,40.20333380062 L40.2005626970337,40.3043975783813 L40.0994989192695,40.9013258915626 L40.0046293730459,40.2982033468404 L39.1214623602632,40.2479974701464 L39.0298529359028,39.9689310386436 L38.7954501739275,39.9229633203705 L37.593769255095,39.9796894407909 L37.5895310966724,40.7572285052024 L37.8500148335547,40.8227569546549 L37.9165213195669,41.082262654976 L39.1648219810455,41.1813703596243 L38.5636555094427,41.275587881476 L38.5193178521013,42.2092867831394 L38.1434258012566,42.214176965936 L38.0289955238524,41.9478250097006 L37.7776401281879,41.8731682190283 L37.7417787876915,41.1813703596266 L37.4914014285856,40.9309930005184 L37.1653892422499,41.2482028578235 L36.1345387090568,41.2341843338094 L35.7619067800756,40.8553581732895 L35.3015775729698,39.7850601655513 L34.8833039379014,39.4404652845936 L34.7584412705348,39.8773216142829 L35.2869070245844,40.7777672729384 L35.2670202812181,41.2390745166059 L33.8283285029198,41.2583092355998 L33.6689085438012,40.4396926357118 L33.2532430062241,40.1730146672909 L32.7159749231424,40.5293459869548 L33.3728894786091,40.7357117009007 L33.3715854298633,41.5073825459614 L33.5792551925594,41.7150523086563 L35.2653902202867,41.7773206362467 L35.2093161242367,41.9403267294129 L34.557291751566,41.9686897896243 L34.3665746225594,42.1594069186309 L34.5572917515657,42.3501240476375 L34.9657850210442,42.4026120096371 L35.0916257249693,42.9287956783838 L35.5353283105726,43.2316609994892 L35.861340496908,43.3154461313767 L35.9213267391937,43.1974297199247 L35.6641031241749,42.8114312913051 L35.7586466582121,42.1594069186309 L36.1873526832436,41.7590639538117 L36.839377055914,41.7652581853503 L37.6058317059891,42.6970010138984 L38.1434258012566,42.7566612439977 L38.2480757130701,43.032793565824 L38.8280513925607,43.1048422590052 L37.9129351855173,43.2329650482336 L37.8509928701138,43.4970349191658 L37.2798195196541,43.577885941379 L37.2224413748582,43.7894678503071 L37.2798195196538,44.0010497592374 L37.5275887812684,44.0792926839619 L37.5924652063495,44.6664406315523 L37.8500148335547,44.7349031906814 L37.9126091733309,44.9983210372402 L38.1871114342255,45.0935165956531 L37.9093490514677,45.1854520321969 L37.9093490514677,45.6536055317765 L38.1737449345856,45.7152218349935 L38.2347092134305,45.9802697424846 L38.8342456241017,46.0327577044841 L38.8280513925613,46.3975653409921 L38.7214454076295,46.1455579209563 L37.5706223898646,46.1511001281216 L37.5706223898649,46.6443565660505 L37.8412125045238,46.7473764169319 L36.2655956079635,46.8018204520491 L36.2271261699763,47.0893632003961 L35.861340496908,47.0906672491405 L35.7664709506841,46.1664227008824 L35.3041856704603,46.1664227008824 L35.2380051966339,46.7522665997261 L34.9657850210442,46.8060586104724 L34.5823946899136,47.4007048383458 L34.3072404046465,47.4515627394154 L34.2573605401371,47.7276950612417 L33.9870964376648,47.7834431451056 L33.9492790240501,48.6796506453425 L33.9936166813913,48.917313529181 L34.4689424490692,48.917313529181 L34.5302327400999,48.3265794475407 L35.5353283105723,48.3187551550675 L35.5711896510693,48.6796506453425 L35.2842989270939,48.7546334482003 L35.2468075256653,49.0056628316772 L35.2842989270937,49.2566922151565 L35.5591272001747,49.3554739076146 L34.952744533591,49.4014416258877 L34.5572917515657,50.0205387677371 L33.3347460528072,50.0652024372681 L33.3347460528077,50.5542207167714 L33.9052673788947,50.6748452257145 L32.9272308198878,50.6790833841354 L32.8359474077139,50.4009949891937 L32.3664898593911,50.4009949891937 L32.3664898593911,51.1964647238524 L32.9526597704224,51.3131770865577 L32.3495372257016,51.3620789145097 L32.2752064472172,51.6512517237889 L31.0539647972041,51.6965674176909 L30.997564688968,52.2921916821255 L30.3999843514151,52.3466357172428 L30.3191333292036,52.6328744168454 L29.4300980970672,52.6807982082385 L29.3410967701976,52.9605166641147 L28.2277651538614,52.9178090677037 L28.3630602111907,52.7593671451439 L28.7790517609545,52.6817762447974 L29.100825788868,52.2657846950318 L29.015084583862,52.0173634090459 L28.3630602111907,52.4242266175939 L27.8186198600101,52.2657846950295 L28.0370480248551,51.9081493266236 L27.6781086076999,51.9068452778746 L27.3850236521841,52.122339333045 L27.0590114658487,52.0806097731952 L26.7329992795134,52.3619582900012 L26.4069870931777,52.0496386154927 L25.5782641155125,52.089086090037 L25.326908719848,52.163742880707 L25.2480137707551,52.5917968813712 L24.7769261614996,52.644610855554 L23.6655506182822,51.421087120238 L22.7804275323812,51.3281736471307 L22.6875140592753,50.7690627475662 L22.1264470865919,50.6781053475765 L21.7939146565295,50.260809749069 L22.494840857151,50.2132119698637 L22.8208530434866,49.8757893570059 L23.282486299338,49.7933082738651 L23.4728774161576,49.5165239276631 L23.904843563052,49.4376289785699 L23.94689913509,49.0056628316772 L23.798889602493,48.8576532990793 L23.5798094132758,49.1125948287963 L23.1468652298226,49.1337856209102 L22.9000740047665,49.4108959792954 L22.3442232270644,49.5070695742624 L22.2317490227785,49.7206075563128 L21.7906545346663,49.7098491541608 L21.4369313124923,49.331675018012 L21.3978098501327,48.0276262726706 L20.6179887004177,47.3756019000011 L20.7428513677842,47.049589713664 L20.5387677391378,47.0264428484347 L20.3633731828894,47.2002073437506 L19.8867433664671,47.2295484405209 L19.5607311801314,46.9609143989799 L19.3227422841065,46.9615664233533 L19.2347189937961,46.6727196262596 L19.2096160554482,47.074692652011 L20.3027349162309,48.2636590955746 L20.5935377864425,49.0604328789823 L19.8867433664668,49.0927080854268 L19.5607311801314,48.7820184718505 L19.2347189937961,48.786256630276 L18.9087068074607,49.1077046459997 L17.9306702484538,48.2545307543594 L17.6046580621185,48.5306630761857 L17.2786458757829,48.2848498876885 L17.0595656865655,49.1125948287963 L16.6266215031122,49.1647567786057 L16.4606813002671,49.0056628316772 L16.4942605554594,48.3536384590054 L16.3006093167765,48.2675712418147 L16.0975037246889,48.4765450532516 L15.8650570358319,48.4631785536155 L15.6485849441053,47.9389509579842 L15.290949575695,48.0276262726706 L15.209772541298,48.3536384590077 L15.4699302659936,48.6796506453448 L15.3225727577696,48.7839745449682 L14.6705483850987,48.8012531908444 L14.344536198763,48.4886075041504 L13.9067018325146,48.4654606389211 L13.7577142633593,48.0928287099352 L13.9468013314337,48.0276262726706 L13.692511826092,48.0015452977648 L13.3664996397561,48.2264937063359 L13.0404874534208,48.1260819529432 L12.956376309346,48.2695273149301 L12.1494961481657,48.2665932052558 L12.1110267101789,47.9790504569065 L11.8042492428365,47.7016140863335 L11.9180274958682,47.3756019000011 L11.0844143354078,47.5611028340256 L10.1063777764015,46.6844560649681 L9.27732878654991,46.5745899581725 L9.1283412173946,46.3304068306075 L8.21322501035084,46.3346449890307 L8.15030465838827,45.9343020242115 L7.7682183760029,46.0715531546574 L8.00425119890981,46.3975653409921 L8.80232903105896,46.4552694979715 L9.08041742600323,46.77150131872 L9.45435340373023,46.8089927201489 L9.71516315279862,47.1147921509309 L10.2459109921529,47.2360686842497 L10.0398712903884,47.961119786657 L9.73407185960612,48.0276262726706 L10.1063777764012,48.0608795156763 L10.2283063340907,47.8235426440256 L10.4323899627368,47.8000697666085 L11.2060168809109,47.9060237271687 L11.5731066027248,48.3536384590077 L11.8691256679174,49.9836993906838 L11.7364387080788,50.1333389842093 L11.0120396300414,50.2373368716542 L10.9086937669727,50.7860153812568 L10.5363878501782,51.2877481360252 L10.7584021490722,51.3190453059132 L11.0844143354078,51.0699719955539 L11.5639782615075,51.6137603223623 L10.8764185605259,52.3838011064862 L10.3424105993081,52.5018175179428 L10.1063777764009,52.7906643150319 L9.45435340373023,52.5745182354927 L9.07096307259934,52.8604309229076 L8.71821788698451,52.917809067706 L8.15030465838856,53.5114772590206 L6.93395319117037,53.5698334403755 L8.05934725840068,53.660464828175 L8.15030465838827,53.8068442998384 L8.63573680384167,53.4035672253426 L9.20756217867449,53.3230422153195 L9.78036559006557,53.0390856010178 L10.9494452902649,53.0527781128463 L11.0844143354078,53.1593840977799 L11.6057078213585,52.917809067706 L11.4814971783644,52.5917968813712 L11.7364387080788,52.1070167602865 L12.0070288227372,52.647218953045 L12.3095681316571,52.6706918304621 L12.3884630807501,52.8115290949556 L12.5133257481164,52.5917968813712 L12.1794892693087,52.2657846950318 L12.2916374614079,51.5169347030196 L12.8403159710109,51.4135888399527 L12.9547462484147,50.8759947446853 L13.3664996397564,50.8398073920007 L13.6925118260917,50.5203154493901 L14.0185240124277,50.5216194981368 L14.3445361987627,50.8404594163741 L14.7553115535459,50.8769727812441 L14.996560571434,51.4409738636006 L15.4086399749624,51.3738153532159 L15.6485849441053,51.1042032751184 L15.9745971304403,51.4403218392296 L16.5125172378938,51.4018524012441 L16.9526336894472,51.7911109517281 L17.3712333367018,51.8471850477753 L17.4778393216339,52.0665912491811 L18.0154334169011,52.1810215265832 L18.3737208096835,52.5917968813689 L18.3502479322678,53.011374565182 L17.6046580621185,53.1319990741251 L17.4243733230747,53.3895487013285 L16.9699123353231,53.5698334403755 L17.6046580621182,53.6917619980653 L18.5826946211248,54.2974926402785 L18.9087068074607,54.0474412933558 L19.2347189937961,54.4611507578158 L19.5607311801314,54.2453306904599 L20.2694816732252,54.8171560652918 L20.3751096215973,55.3635524895936 L20.9358505820949,55.8519187447235 L20.9325904602311,56.5039431173954 L20.6802570280078,56.6454324062645 L20.5906036767657,57.2078034276934 L20.2127555528024,56.9525358857909 L19.4929206453737,57.1559674900649 L19.5607311801314,57.7189905358672 L19.8867433664671,57.3228857294712 L20.618314712604,58.1340040490715 L20.0637679836471,58.6370408525889 L19.9512937793613,59.1765910209741 L19.6285417148897,59.5058633291709 L16.6266215031122,59.5821501807777 L16.0805510909997,59.332098833855 L15.5967490064779,59.3865428689722 L14.3132390288745,60.0587799971968 L13.6814274117562,61.0681137260891 L13.6833834848748,61.4032542536437 L14.0185240124274,61.22753368521 L14.5218868281294,60.5934399827854 L15.0291617900678,60.4486905720542 L15.6485849441053,59.9257670251719 L17.6046580621185,59.9639104509741 L18.1116070118702,60.4160893534218 L18.1702892054104,61.0681137260891 L19.0475879988391,62.046150285098 L18.9087068074607,62.256428145284 L18.2566824347895,62.1850314764761 L17.9769639789136,62.3721624714328 L17.8954609323296,62.6981746577675 L18.3587242491126,63.0241868441046 L18.9087068074607,63.1392691458824 L19.9659643277467,63.1034078053857 L20.2091694187528,63.0241868441046 L20.0389910574856,62.6981746577698 L20.5387677391378,62.61438952588 L21.5168042981447,62.6923064384144 L22.1688286708157,62.5755940757068 L22.3168382034124,62.8461841903654 L21.8711795446914,62.9958237838932 L21.5168042981447,62.7291458154723 L21.1454764179087,62.9788711502049 L20.9378066552126,63.4232257601772 L20.5387677391381,63.5109230383047 L20.8439151455479,64.328235589446 L20.6831911376846,64.472658987994 L20.4103189377219,64.4566843908622 L20.2127555528027,64.2209775801414 L19.6409301779702,64.2480365916084 L19.5607311801314,64.0837264496955 L19.5258478761936,64.328235589446 L19.8261050998089,64.6542477757831 L19.0087925486656,65.406357889662 L18.5826946211245,65.4572157907294 L18.2566824347898,65.1569585671126 L17.7885289352114,65.1224012753603 L17.6636662678451,64.9212517563918 L17.2786458757826,64.8231220883047 L17.5371735395466,65.3737566710251 L17.9306702484538,65.4474354251362 L18.0920462806902,65.632284334792 L17.9306702484536,65.7770337455232 L16.9526336894469,65.827565634405 L16.6266215031119,66.1878091003043 L15.9644907526642,66.2843087074569 L16.4473148006272,66.4636154099451 L16.4316662156832,66.7413777927012 L15.9745971304406,66.8642843869498 L15.9745971304403,67.251912876504 L16.4505749224907,67.4383918470873 L16.491978470155,67.7797266061805 L16.253663561944,67.9613153939673 L16.6024966013232,68.2403818254748 L16.1669443203788,68.4327290154089 L15.9745971304403,68.684084411076 L15.6485849441053,68.6449629487126 L15.0144912416826,69.2184183844791 L15.3519138545399,69.2477594812493 L15.6485849441053,69.0573683644305 L15.9745971304406,69.2281987500699 L16.3006093167765,69.1750587636994 L16.6266215031122,68.6566993874235 L17.4569745417084,68.892406198142 L17.6046580621188,69.1356112891504 L17.678988840603,68.9667369766264 L18.2824373975098,68.9181611608646 L18.4646782096714,68.4483776003552 L19.2347189937961,68.3844792118326 L19.5995266303059,68.8924061981443 L19.4476049514728,69.2184183844791 L20.0644200080196,69.5444305708161 L19.6210434346035,70.5224671298205 L19.715586968641,70.8484793161575 L20.2029751872124,70.8582596817484 L20.2127555528027,71.1275457476604 L20.2619833929393,70.897707156295 L20.8647799254734,70.4253154982922 L20.8853186932128,70.1759161757474 L20.5387677391381,70.095391165722 L20.3751096215976,69.8704427571509 L20.7783866960949,69.5444305708161 L20.8135960122188,69.1672344712262 L21.190792111809,69.5418224733251 L21.5572298092501,69.5851820941071 L21.9657230787286,68.8924061981443 L21.6045015762693,68.2403818254725 L22.099714087313,67.5192428692982 L22.8208530434869,67.4921838578335 L23.1468652298226,67.1704098299197 L23.9041915386799,67.9143696391377 L23.7988896024932,68.3522040053858 L23.1468652298223,68.3799150412262 L22.8208530434869,68.7287480806024 L22.2591340464308,68.892406198142 L22.4948408571513,69.0417197794866 L23.549490279947,69.1418055206891 L23.3072632254995,69.5444305708161 L23.516889061313,69.8704427571509 L23.4728774161579,70.0226904481698 L23.1468652298226,70.1325565549677 L22.3654140191759,70.0670281055129 L22.0068006142074,70.8484793161575 L22.7494563746793,71.2458881713002 L22.5760178915492,71.8265158751641 L23.055907829835,72.2434854614885 L23.1468652298223,72.6663232671637 L23.5237353172258,72.478540247836 L23.7724826154001,72.8309594212645 L23.6512060820837,73.3088932864325 L22.4948408571513,73.3623592849909 L22.1688286708157,73.7105402999961 L21.84281648448,73.6720708620084 L21.5970032959831,73.2107636183478 L21.6234102830762,72.911158419102 L21.8294499848404,72.8045524341708 L21.5422332486789,72.478540247836 L21.3746629849025,72.478540247836 L20.824680426554,73.7825889931774 L21.073101712542,74.1086011795098 L20.9606275082561,74.4346133658469 L21.6253663561945,74.652063494135 L21.5168042981447,74.9089610969674 L20.1292964331004,75.0031786188145 L19.8867433664671,75.2907213671661 L19.6689672259949,75.0866377385188 L19.5607311801311,74.4796030475611 L19.5186756080944,74.7185699801463 L18.9722791837955,74.6970531758492 L18.7932984934978,74.3192050518883 L18.5826946211248,74.3527843070771 L18.5993212426277,74.7772521736845 L17.8237382513359,74.979705741402 L17.124442111646,74.9148293163182 L16.7426818414476,74.6445652138474 L15.9745971304406,74.6680380912645 L15.8249575369128,75.0866377385188 L16.5007807991862,75.5384906287833 L16.4639414221303,75.9023202287302 L15.9540583627015,76.0441355297871 L15.4392851204776,75.9479619348177 L15.3225727577699,75.7350759771384 L14.9965605714343,76.153675624395 L14.5316671937197,76.2518052924798 L14.0185240124277,76.5735793203959 L13.8473676146013,76.8715544587071 L13.4290939795326,76.9801165167561 L13.3664996397564,76.8761186293159 L13.1379650971354,77.042710856532 L14.344536198763,77.3419900435876 L14.6705483850989,77.2683112894764 L14.7112999083908,77.6947352292038 L14.9323361707262,77.7589596299119 L14.9965605714343,77.9460906248686 L15.3225727577696,77.535641282273 L15.9745971304403,77.5747627446295 L16.0935915784532,77.1617053045452 L16.3006093167765,77.0652056973926 L16.9728464450003,77.348510287314 L16.9082960321055,77.7390728865424 L17.4321976155466,77.848286968967 L17.6483436950872,77.6510495962317 L17.2786458757829,78.2042922764454 L16.6266215031122,78.1775592771662 L15.943299960553,78.3467596018734 L16.3006093167762,78.7562309079101 L16.7508321461057,78.7973084433912 L16.9816487740311,78.6437567036234 L16.8505918751244,79.3247961608823 L17.0999911976709,79.6508083472148 L16.0613163720058,80.7155641477877 L14.6705483850989,80.7680521097896 L14.344536198763,80.9199737886229 L14.0185240124274,80.5274551162722 L13.5963382311232,80.5326713112543 L13.0404874534211,80.7377329764605 L12.3884630807501,80.4746411420895 L12.1915517202037,80.7579457320132 L11.7364387080791,80.8254302545834 L11.0844143354078,80.1828602353169 L10.7584021490722,80.5313672625099 L9.29232534712112,80.6288449062237 L10.1063777764015,80.7690301463485 L11.0844143354078,80.7341468424083 L11.3299015117186,81.0353821025839 L11.8789060335074,81.1384019534652 L12.0624508944142,81.3656324473419 L12.2518639746755,81.1442701728207 L12.5133257481164,81.1560066115292 L12.7144752670857,81.4653921763612 L13.0385313803031,81.6068814652303 L12.1253712463776,81.6698018171894 L11.7364387080791,82.0189608687581 L10.4323899627368,82.0228730149935 L9.1283412173943,81.7653233877878 L8.86850950488564,82.3250863117303 L8.15030465838856,82.3563834816159 L7.82429247205263,82.6840257288852 L7.17226809938165,82.6866338263739 L6.84625591304573,83.0142760736386 L6.37288621848669,83.0895848886842 L5.9402680472192,83.6350032764225 L5.54220716770406,83.6747767631546 L4.96712167100801,84.2919178318886 L4.42594144169068,84.4027619752408 L4.31803140801388,84.6208641279022 L3.84466171345484,84.7995188060147 L3.74294591131813,85.0238151902125 L3.21317610852297,85.1460697600878 L3.13102103756652,85.3899268754672 L1.95607311801323,85.4626275930195 L1.86478970583898,85.7537564754187 L1.6300609316776,85.8000502058773 L0.65202437267127,85.8085265227215 L0,85.6738834897666 L0,86.0161962854164 L0.978036559006615,86.0256506388241 L1.06214770308107,85.9291510316668 L1.95607311801323,85.9082862517408 L2.28208530434858,85.5861862116414 L3.26012186335519,85.6021608087709 L3.43030022462238,85.3631938761857 L3.98191284390188,85.2627821227977 L4.23815842236181,84.9758913988217 L4.65349794775341,84.9566566798255 L4.8901827950325,84.6586815415143 L5.3563802214926,84.6811763823749 L5.7472688329091,84.0940284347845 L6.30377163498345,83.9985068641884 L6.75366845212653,83.470367122324 L7.17226809938165,83.4612387811088 L7.498280285717,83.1287063510453 L8.47631684472361,83.1629376306098 L8.80232903105925,82.8157346521612 L10.1063777764009,82.8144306034168 L10.4323899627368,83.1335965338396 L10.8324069153706,83.1629376306075 L10.7584021490719,83.4263554771687 L9.45696150122128,83.5603464857525 L9.4475071478171,83.2369423969088 L9.45370137935747,83.5636066076169 L10.5585566788484,83.7628000534676 L10.6775511268616,84.2958299781286 L11.7364387080791,84.0728376426729 L11.8172897302903,84.6218421644611 L11.602447699495,84.7330123199988 L11.4231409970109,85.2060560023749 L10.3955505856807,85.4821883242012 L11.0498570436564,85.8450398875939 L10.7584021490722,86.0249986144484 L10.0724725090222,86.1371468065496 L10.5882237878053,86.4970642602611 L10.1875548107988,87.2302656673317 L9.67701972699754,87.2524344960021 L9.45435340373023,87.0167276852813 L9.31058202955615,87.3313294450953 L8.69800513143178,87.47510081927 L9.04064393927082,87.5627980973929 L9.27341664031391,87.8011130056047 L8.95522874645085,88.2800249073317 L7.82429247205292,88.7380720291349 L7.80570977743181,89.0865790563256 L7.02817071302148,89.1051617509461 L7.79038720467334,89.4650792046622 L8.47631684472332,89.3007690627493 L8.97804959949405,88.6288579467102 L9.53031424314631,88.5290982176933 L10.3120914659793,87.6808145088472 L11.7723000485758,87.5109621597667 L11.7843624994702,87.4271770278792 L10.9605297046004,87.2729732637403 L10.9266244372214,86.8230764465982 L11.5323550794326,86.2929806316137 L11.9793177868986,85.1102084195934 L12.1635146721784,85.091951737156 L12.3884630807498,85.3221163407092 L12.9759370405263,85.1930155149174 L12.5909166484644,84.9905619472069 L12.2714247058552,84.5409911422501 L12.640470500787,84.1409741896164 L13.1757825107504,84.0242618269065 L13.6123128282536,83.482755585406 L14.3445361987633,83.6115303990076 L14.9965605714343,83.1668497768452 L15.3225727577693,83.2480268112417 L15.7411724050242,83.0035176714912 L15.8598408408504,82.4701617346447 L16.1675963447513,82.1258928658772 L16.6266215031125,82.1193726221461 L16.8473317532612,82.6902199604238 L17.1325924163047,82.9109302105694 L17.1694317933605,83.5629545832458 L17.455996505149,83.7116161402125 L17.9306702484538,84.4568799981748 L17.9815281495221,83.2369423969064 L18.6524612290008,82.9109302105694 L17.9306702484538,82.6357759253042 L17.6046580621188,82.7883496285109 L17.4820774800563,82.7074986062977 L17.4846855775468,82.4649455396649 L17.7542976556463,82.2589058378998 L17.6330211223296,81.606881465228 L18.5826946211248,81.5371148573546 L18.9087068074605,81.2117546953909 L19.5607311801311,81.2130587441352 L19.8867433664671,80.8876985821738 L20.5387677391378,80.8886766187326 L20.8647799254737,80.5639684811422 L21.3723808995981,80.4844215076757 L21.8007609124429,79.9347649615142 L22.3703042019711,79.8522838783734 L22.4948408571513,79.5891920439977 L22.8870335173133,79.5846278733936 L23.1468652298226,79.827180940024 L23.3884402598971,79.5663711909562 L23.6322973752757,79.6508083472171 L23.8846308074999,80.3885739248964 L22.7129430098095,80.6288449062237 L23.047757525176,80.9548570925585 L22.8104206535242,81.2808692788955 L23.2978088720956,81.4559378229558 L23.4728774161576,81.8412842272044 L23.9136458920829,81.8181373619751 L24.3690849163942,82.3407348966719 L24.9272177794004,82.4346264063358 L25.4289505341708,83.2587852133914 L25.5469669456249,82.7032604478767 L25.9107965455749,82.5849180242369 L25.4289505341708,82.5125433188702 L25.1658586997981,82.1959854859384 L24.64260914073,82.0672106723367 L24.491991510643,81.5658039297515 L24.1249017888292,81.4957113096903 L23.9296204892138,81.2808692788955 L24.1249017888292,81.0826538696036 L24.9627531077113,81.0950423326832 L25.7549627205065,81.3933434831799 L25.7155152459602,80.9548570925585 L25.1029383478355,80.830972461751 L24.676188395922,80.4035704854647 L24.7769261614999,79.2478572849068 L25.149232078295,79.2785024304214 L25.9088404724572,80.4749671542727 L26.5895539175254,81.0983024545476 L27.1278000371653,81.2120807075787 L27.7110358385197,81.7848841189718 L27.9620652219981,81.5318986623725 L28.3630602111907,81.5025575656022 L28.6890723975263,81.8223755203961 L29.4219477924091,81.8520426293541 L29.6671089565329,82.1343691827237 L30.3191333292036,82.1255668536894 L30.6451455155396,82.4378865282025 L31.2971698882105,82.4287581869804 L31.6486110250801,83.262371347439 L31.800858716099,82.7625946657906 L32.1451275848691,82.4548391618885 L32.6012186335522,82.3955049439747 L32.9272308198878,82.6931540701004 L33.4149450506456,82.7492281661498 L33.9052673788945,83.2463967503095 L34.1999823953416,83.2056452270162 L34.2224772361995,82.9109302105717 L32.9272308198878,81.8582368608974 L32.2752064472172,81.7043591089441 L31.9491942608815,82.1037240372044 L30.9711577018746,82.0825332450929 L30.9711577018746,81.5149460286841 L30.3191333292036,81.4412672745684 L29.9931211428683,81.735656278832 L29.8027300260481,81.471260395712 L29.0150845838617,81.3946475319266 L28.8338218082593,81.136119868162 L28.3630602111907,81.0591809921842 L28.1853835696376,80.8065215477774 L27.6461594134388,80.6937213313051 L27.3850236521844,80.4042225098404 L26.6765991712773,80.3592328281262 L26.3489569240094,79.9187903643847 L26.7329992795134,79.5618070203452 L27.3850236521838,79.5474624841479 L27.7110358385197,79.2276445293541 L28.6532110570293,80.0126818740486 L29.4522669257376,79.8656503780118 L29.5735434590549,80.0703860310279 L30.2180695514403,80.4038964976549 L30.3191333292036,80.6252587721738 L30.6451455155396,80.365101047477 L30.6268888331042,79.9585638511145 L30.8951968624585,80.0527813729662 L31.3320531921478,79.9768205335495 L31.2009962932414,79.6508083472171 L30.5108284947691,79.4591131816516 L30.4880076417256,79.1676582870646 L30.7677260976015,78.9987839745452 L30.3191333292036,78.9293433788573 L29.9931211428683,79.1673322748814 L29.3410967701973,79.1402732634143 L29.0150845838617,78.8462102713409 L28.2880774083332,78.7477545910683 L28.1475661560229,78.2362414707067 L27.3201472271032,78.08562384062 L27.6005177073519,77.6947352292038 L27.2849379109796,77.3687230428691 L28.0370480248553,77.2761355819496 L28.3630602111907,76.9484933346803 L29.015084583862,76.9432771397028 L29.5530046913155,77.4828273080857 L29.993121142868,77.5503118306558 L30.3191333292042,76.9321927253653 L31.4076880193784,76.9321927253653 L31.6231820745456,77.1744197798103 L31.8383501175276,76.9318667131775 L32.9272308198878,76.9005695432872 L33.2532430062241,76.5683631254115 L34.3577722935286,76.5902059418987 L34.4086301945968,77.042710856532 L34.6104317379383,77.0958508429049 L34.761701392398,76.2690839383582 L35.2996214998521,76.1549796731416 L35.5353283105723,75.8615687054369 L35.861340496908,75.8941699240738 L35.9829430424108,75.5342524703554 L36.4533786272932,75.4126499248558 L35.9950054933057,75.2789849284575 L35.9412134825601,75.0866377385188 L35.9774008352434,74.8766858905183 L36.5661788437652,74.760625552184 L36.6587663046847,74.4346133658469 L36.5009764064979,74.4222249027673 L36.3735056416406,74.6207663242471 L35.8258051685977,74.7250902238728 L35.2536537815785,75.4569875821967 L34.6854145407955,75.8667849004213 L34.4236267551686,75.8723271075889 L34.2068286512547,75.7142111972123 L33.9052673788945,76.2234422322684 L33.6043581309073,75.7135591728436 L33.0944750714782,75.5714178595988 L32.9272308198878,75.1639026266798 L32.9272308198878,76.0871691383813 L32.7358616665094,75.9300312645705 L31.9821214917017,76.0976015283455 L30.3191333292039,76.1921450623827 L29.8164225378743,75.7386621111906 L30.8159759011795,74.9314559378234 L30.8886766187321,74.6781444690409 L31.5283125283226,74.3397438196265 L31.5524374301116,73.7825889931774 L31.8148772401113,73.6482719724081 L31.9185491153663,73.0999194749909 L32.1842490472296,73.0396072205182 L32.516781477292,72.3941030915752 L33.1479410700369,72.047226125312 L33.4338537574531,71.6811144400596 L33.5365475961493,70.8484793161599 L33.8205042104475,70.7637161477112 L33.8772303308694,70.1684178954621 L34.1481464577151,70.1133218359738 L34.2312795652301,69.6448423242065 L34.5572917515657,69.4942246941198 L35.2093161242364,70.0305147406429 L35.5353283105723,69.8362114775864 L35.4681698001871,70.1964549434857 L35.9288250194796,70.2639394660582 L36.3819819584856,69.8704427571509 L36.4181693111687,69.1232228260685 L37.8174136149209,69.0971418511627 L38.104304338896,70.2355764058445 L38.756654723754,70.561262579996 L39.8915031443876,70.7304629047009 L40.0166918239409,71.2572985978256 L40.2429442812572,71.3570583268379 L40.4255111056051,71.775331961909 L40.7515232919411,72.0883036607931 L41.1675148417051,72.1525280615012 L41.255864144202,71.8265158751641 L40.5353772124002,71.1744915024923 L40.772388071866,70.5224671298205 L40.5441795414316,70.4037986939951 L40.446049873344,69.8499039894104 L39.7734867329344,69.6930921277874 L39.6248251759652,69.5444305708161 L39.5967881279405,69.2184183844791 L40.0062594339778,68.7991667128515 L40.2272956963132,68.7646094211014 L40.4255111056051,68.9478282698204 L40.8353084238288,68.5663940118118 L40.4255111056051,68.1099769509385 L40.0994989192695,68.0933503294334 L39.7734867329341,68.3652444928411 L39.6782911745245,67.9143696391377 L40.0994989192695,67.4902277847135 L41.0775354782764,67.4599086513867 L41.4035476646117,67.7891809595859 L41.6330602437919,67.8178700319828 L42.3209459569602,67.5883574528029 L41.7295598509471,67.449150249237 L41.4035476646117,67.094448990503 L40.3635687902011,66.998275395536 L41.4035476646117,65.8820096695223 L42.055572037283,65.8787495476579 L42.3815842236181,66.1982414902685 L44.4638240577434,66.0844632372374 L44.1485702735572,65.1693470301899 L43.9082992922279,64.9802599621178 L43.9131894750231,64.5557920955105 L44.4498055337311,64.1143715952101 L44.2229010520414,63.6762112167765 L44.5948809566501,63.3501990304417 L44.6033572734951,62.6981746577675 L44.8752514368984,62.5837443803654 L44.9896817143026,62.3177184363155 L45.165076270551,62.6981746577675 L44.9613186540915,63.052549904316 L45.3564454239298,63.0649383673979 L45.6417060869736,62.5987409409361 L46.0234663571728,62.6424265739082 L46.2937304596448,62.9296433100651 L47.2717670186514,62.9518121387378 L47.7858882365023,62.5602715029506 L47.867717295273,62.3160883753833 L48.0290933275087,62.91888490792 L48.9533378757697,63.0241868441046 L48.9585540707512,64.0022234031089 L48.7016564679186,64.128064107034 L48.6181973482172,64.3706171736738 L47.9237913913221,64.3966981485773 L47.5977792049865,64.0801403156433 L47.2717670186512,64.4015883313739 L46.4511943456446,64.4856994754469 L45.8096023629367,65.148156238083 L45.7186449629488,65.7092232107652 L44.8778595343895,65.8464743412111 L45.1937653429485,66.406237265149 L45.730381401657,66.5216455791122 L46.2937304596448,67.0748882593236 L46.9457548323158,67.0807564786791 L47.3627244186385,66.7012782937836 L47.3627244186385,66.5193634938067 L46.6197426459805,66.4460107518857 L46.4805354424148,66.2843087074569 L46.507268441694,65.9582965211245 L46.9457548323158,65.5247003132996 L48.901827950329,65.5416529469879 L49.2278401366641,66.1685743813104 L49.4814776176335,65.8859218157577 L49.8798645093354,65.8556026824286 L50.205876695671,65.553715397882 L50.6329526597709,65.9582965211245 L50.4295210554971,66.7126887203043 L50.9824377235225,66.8117964249503 L50.6593596468637,67.2623452664635 L50.93549196869,67.6659483531494 L50.4102863365033,67.7927670936358 L50.2058766956713,68.0946543781847 L49.8798645093354,67.8612296527648 L49.6741508197581,67.9143696391377 L49.6999057824782,68.3864352849527 L48.9660523510368,68.5663940118118 L49.2278401366641,68.6319224612597 L49.4172532169252,68.8924061981443 L49.0012616671614,69.3178521013128 L48.5758157639934,69.3801204289032 L48.3612997453847,69.655926738544 L47.8625011002912,69.8091524661194 L48.0506101318067,70.323273683972 L47.2717670186512,70.7549138186792 L46.2937304596448,70.8096838659843 L46.2200517055328,71.1008127483812 L45.7411398038059,71.1744915024923 L46.2937304596448,71.2556685368911 L46.3791456524645,70.9338945089772 L46.9457548323158,70.9241141433864 L47.5977792049865,71.5569037970643 L48.2498035776578,71.0717976637941 L48.4454108894589,70.3920622552889 L48.7759872464033,70.0706142395582 L49.553852323,69.9477076453119 L49.4576787280306,69.4482569758444 L50.205876695671,69.3970730625916 L50.5318888820069,69.0945337536716 L51.3811506274107,69.0896435708774 L52.2610575183305,69.771335052505 L52.3839641125785,70.3004528309282 L52.8139741863552,70.7650201964556 L53.029468241523,70.9589974473242 L53.6277006034486,71.0127894580704 L54.1180229316972,71.5741824429405 L54.1542102843803,71.1744915024923 L53.9171994249142,71.0493028229405 L53.8630814019834,70.7774086595375 L53.4659985590262,70.3689153900573 L53.1399863726908,70.397930474642 L52.7024780186282,69.9819389248788 L52.6063044236591,69.4260881471763 L52.039369231622,68.892406198142 L52.0804467671002,68.4848909652229 L52.8139741863552,68.4324030032257 L53.1399863726908,68.6668057651999 L53.7714719776227,68.5663940118118 L53.325813318902,68.3805670655995 L53.3659128178214,68.1402960842653 L54.5395566886289,68.0098912097314 L54.3168903653621,67.5883574528029 L54.7700473043682,67.1479149890637 L56.0740960497104,67.1466109403147 L56.4900875994742,67.4983780893745 L56.7261204223814,68.0010888807041 L57.1127708753755,67.9750079057959 L57.3781447950529,67.7539716434579 L57.942471889599,68.3280791035954 L58.9505015697489,68.2980859824541 L59.0082057267302,68.4115382232997 L59.0082057267302,68.2116927530755 L58.2058897361584,68.0646612570365 L57.7041569813883,67.439043871463 L56.9566110381207,67.3578668370619 L57.0068169148167,66.655636587696 L56.5699605851271,66.4404685447135 L56.5314911471388,66.2843087074569 L56.7261204223811,65.5511073003886 L57.3781447950527,66.1966114293363 L57.8524925261708,66.1066320659102 L58.0301691677239,65.5406749104314 L59.0848185905191,65.5556714709997 L59.2311980621839,65.9582965211245 L58.9974473245811,66.2843087074569 L59.3342179130656,66.309737657994 L59.3671451438857,65.9912237519446 L59.6833769646311,65.9814433863561 L59.9862422857366,65.523070252365 L60.3122544720722,65.8419101706023 L60.6382666584078,65.8402801096724 L60.9205932117748,66.001982154092 L62.2083413477997,66.0182827634116 L62.2683275900854,66.1089141512111 L62.9203519627564,65.7949644157727 L63.5929151031671,65.6528231025279 L63.4475136680614,65.1814094810863 L64.224400708099,64.8299683442167 L65.0469294542232,64.8097555886663 L65.258511363155,65.3062721484526 L65.3732676527449,64.4834173901437 L65.0498635639001,64.0022234031089 L65.3442525681611,63.3501990304417 L64.550412894434,63.2484832283024 L64.550412894434,62.5993929653071 L64.9194586893659,62.4151960800293 L65.3706595552539,62.5299523696215 L65.4815036986087,62.7451204126018 L66.1804738261119,62.8233633373217 L66.5064860124472,62.4552955789492 L68.8684443024479,61.7201380987632 L68.81758640138,61.3651108278437 L68.1365469441248,61.1088652493847 L67.8105347577892,61.1952584787632 L66.9840938654289,60.4160893534218 L66.6209162898508,60.3016590760151 L66.3565204067331,59.9140305864633 L66.4161806368324,59.6737596051314 L66.5977694246212,59.6727815685749 L66.8324981987829,59.9319612567151 L68.4625591304608,59.9225069033098 L68.8792027045973,59.8546963685518 L69.1145835031315,59.5638934983404 L69.4405956894671,59.5469408646497 L69.6860828657779,59.76406498075 L69.7141199138023,60.0375892050829 L69.5194906385603,60.0900771670871 L69.7313985596779,60.1252864832104 L70.4792705151319,59.4380527944152 L69.2518346335788,59.300801663967 L68.7885713167958,59.1179088274336 L68.4625591304605,59.1971297887123 L68.2571714530688,59.5586773033583 L67.8105347577892,59.594538643855 L67.666437371429,59.2939554080574 L68.1062278107954,59.1120406080781 L67.3775905743362,59.0051086109614 L67.2745707234534,59.2281009464148 L66.1804738261116,59.2339691657679 L66.1804738261119,58.9718553679534 L67.28467710123,58.912195137854 L67.4845225714539,58.5734684762519 L68.5541685548205,58.2256134734322 L68.4625591304605,57.5879336369599 L69.4405956894674,57.4193853366261 L70.1154409151816,57.8079918627391 L70.6223898649332,57.930246432612 L70.7446444348085,58.3387397020899 L70.8166931279894,57.8800405559157 L70.5878325731818,57.6387915380296 L70.5363226477408,57.1559674900649 L71.0706566211444,56.6705353446115 L71.3966688074803,56.8958097653704 L72.0486931801516,56.4759060693695 L72.3747053664867,56.5355662994688 L73.0267297391576,56.2092281009462 L74.0047662981648,56.2092281009462 L74.1312590264622,55.9784114730243 L74.3307784844999,55.9823236192574 L75.0382249288481,56.448521045717 L75.0675660256184,56.7451921352838 L75.3088150435065,56.9329751546138 L75.7574078119038,56.6268497116417 L76.6128637888487,56.5391524335164 L76.9176851830722,56.1567401389467 L77.2648881615194,56.1260949934344 L77.6658831507123,56.4289603145376 L77.7389098804512,56.8299553037278 L77.4200699622154,57.1559674900649 L77.375406292687,57.5924978075687 L76.2868516025128,57.7691964125635 L76.1561207157922,58.0032731623521 L75.3163133237921,58.1340040490715 L75.9608394161775,58.3566703723394 L76.2868516025128,58.2132250103503 L77.2648881615194,58.2842956669727 L77.5909003478551,58.5998754633455 L78.0469913965385,58.655949559395 L78.6413116122282,59.1844153134449 L80.4689359288252,59.1681147041276 L80.5064273302538,59.4566354890358 L80.8047284807508,59.4843465248761 L80.8510222112105,59.8429599298432 L81.0671682907505,59.8739310875457 L81.1555175932476,60.1115939713819 L81.4978303889,60.0900771670848 L81.2174599086516,60.049651655977 L81.1770343975462,59.6616971542397 L81.014354316564,59.4380527944129 L80.652480789732,59.3105820295579 L80.5250100248749,59.0396659027091 L79.8729856522042,59.020105171532 L79.5469734658683,58.6839866074209 L78.4349458982779,58.5940072439924 L78.5689369068617,58.2402840218173 L79.220961279533,58.1476965608978 L79.3269152400918,57.9139458232947 L79.9577488206508,57.8079918627391 L79.5469734658683,57.6899754512824 L78.5689369068617,57.7564819372961 L78.242924720526,58.0163136498027 L77.757166562886,57.4819796763997 L78.0316688237809,57.2707237796548 L78.1425129671346,56.7295435503398 L78.6383775025513,56.5733837130833 L78.8949490931973,56.2574779045225 L79.3164828501287,56.1779309310583 L79.1423923426258,55.7733498078158 L79.5469734658683,55.5272106071331 L79.7944167152971,55.1213254351463 L80.1989978385393,55.0003749140131 L80.5250100248746,55.2279314200753 L81.1770343975462,54.9583193419801 L81.5030465838815,55.0450385835441 L82.4080564131489,54.5478699993798 L81.5245633881798,54.5263531950804 L81.1770343975462,54.7822727613563 L79.5978313669368,54.4970120983125 L79.2522584494209,54.1905606431571 L79.2578006565885,53.8590062496547 L78.4505944832218,53.6881758640154 L78.4786315312469,52.5014915057526 L78.6706527089987,52.4900810792319 L78.8949490931973,52.7378503408468 L79.220961279533,52.7368723042879 L79.5469734658686,52.7277439630728 L79.8729856522042,52.4907331036053 L80.4004733696947,53.0423457228845 L80.8510222112108,53.0964637458162 L81.1770343975459,52.7737116813435 L82.4445697780184,52.5917968813712 L82.4810831428879,52.1960180871538 L82.6643019916089,52.4085780326476 L83.2827471090875,52.4421572878411 L83.7851318882298,52.7094872806354 L84.4371562609011,52.0662652369933 L84.7631684472364,52.4327029344358 L85.2091531181441,52.4718243967946 L85.4184529417712,52.9178090677037 L85.3183672005664,53.3406468733835 L85.782934566094,53.2855508138906 L86.067217192579,53.0941816605107 L87.3712659379207,53.3093497034932 L86.8209573673867,52.5917968813712 L85.6629620815229,52.3440276197517 L85.7685900298959,51.9123874850422 L84.9666000515102,51.7366669166086 L85.0891806335721,51.4246732542879 L87.0452537515856,51.4188050349325 L87.3712659379209,51.5651845065982 L87.6219693092127,51.2124393209819 L87.8824530460953,51.1469108715318 L88.9191717986418,51.0438910206457 L89.3273390559344,51.2430844664988 L89.765499434369,50.9617359496905 L87.6337057479212,50.6992961396904 L87.3311664390013,50.2696120781033 L88.8122398015241,49.9836993906838 L89.0013268695988,49.584660474609 L89.2549643505674,49.7300619097135 L89.6533512422698,49.7059370079254 L89.9793634286051,49.9504461476782 L91.0506394729037,49.7509266896396 L91.6094243602827,49.4301306982846 L92.2614487329534,49.366232309762 L92.3752269859851,49.1194410847083 L92.5874609192894,49.0588028180501 L92.849574717103,49.0695612201975 L92.913473105625,49.2834252144357 L93.2257927801344,49.0056628316772 L91.7117921867925,48.9032950051692 L91.2834121739474,49.2214828990308 L90.8983917818846,48.6206424396141 L90.3053756149408,48.9446985528335 L89.3273390559342,48.840700665391 L89.0013268695985,48.1616172812544 L88.7545356445425,48.3536384590077 L88.8650537757104,48.6796506453425 L88.6753146832632,48.8296162510558 L88.0232903105916,48.8120115929941 L87.6972781242566,48.5290330152558 L87.3712659379207,48.5166445521716 L87.0452537515859,48.7996231299145 L86.3932293789143,48.7927768740002 L85.741205006243,48.4778491020006 L85.415192819908,48.784300557156 L85.0194140256964,48.7494172532182 L85.2785937138331,48.3536384590077 L85.3082608227898,47.5946820892191 L85.8377046133985,47.472101507156 L86.3932293789143,46.9273351437887 L86.5272203874984,46.531556349576 L86.7906382340573,46.3975653409921 L86.3061841251624,45.6584957145707 L87.3712659379209,45.6056817403834 L87.6972781242566,44.9389868193287 L89.2735470451888,44.767504409316 L88.5432797477971,44.573527158445 L88.8660318122698,43.9801849793183 L89.0013268695988,43.9061802130193 L89.3273390559344,44.0541897456126 L89.6533512422698,43.9215027857755 L89.9793634286051,43.523115894074 L90.7308215181082,43.4634556639746 L90.6313878012761,43.3738023127317 L89.6533512422698,43.3884728611145 L89.3273390559342,43.69329425534 L89.0013268695988,43.4533492861959 L88.8311485083314,43.619289489041 L88.1957507571632,43.7894678503094 L88.141632734232,44.233822460284 L87.6972781242566,44.2817462516748 L87.3712659379207,44.5934139018099 L86.9983079967531,44.3945464681493 L86.7192415652499,44.9243162709436 L84.4371562609014,44.869220211453 L83.6990646710377,44.2015472538395 L83.7039548538322,44.0343030022477 L84.1111440745657,43.6916641944078 L84.7631684472364,43.6789497191404 L84.9431271740939,43.7894678503094 L84.6630827060319,44.1154800366442 L84.7631684472364,44.3009809706686 L85.3402100170508,44.516475025839 L85.8024952972743,44.5027825140104 L86.0401581811131,42.8114312913028 L85.7001274707654,42.770353755824 L85.415192819908,43.2671963278004 L84.4371562609014,43.2417673772656 L84.3732578723791,43.0735450891173 L84.9046577361064,42.9529205801719 L85.2091531181441,42.60539158954 L85.1700316557839,42.4045680827547 L84.1111440745657,42.2686210010532 L83.8477262280066,42.5480134447416 L83.4591197018948,42.5636620296902 L83.0887698582174,42.2037445759741 L83.0740993098328,41.8333947322962 L83.3404512660686,41.7147262964708 L83.4186941907893,41.1409448485188 L83.9882374803172,41.0584637653757 L84.0697405269014,40.8139546256252 L84.6304814873981,40.7229972256379 L84.7191568020811,40.1593221554623 L85.2769636529012,40.0651046336129 L85.4151928199077,39.8072289942217 L86.2298972735603,39.7139895089289 L87.0452537515856,38.716066206555 L87.4433146311007,38.6453215621205 L87.5010187880824,38.2472606826045 L87.7171648676226,38.2273739392372 L88.0232903105916,38.4161349951261 L88.455582469673,38.3538666675357 L88.1494570267037,37.7950817801567 L87.3712659379209,37.7086885507782 L87.3712659379207,37.5072130196242 L87.8537639736975,37.4257099730399 L88.0232903105916,37.173376540814 L88.6753146832632,37.15968402899 L89.0013268695985,37.4716776913107 L89.4541577964185,37.3960428640842 L89.850914627189,36.8147631358469 L90.3353687360838,36.6171997509283 L89.8584129074745,36.4121380857198 L89.8841678701949,36.195992006183 L90.4152417217362,36.0750414850544 L90.8318852958724,35.5136485001821 L91.0894349230779,35.5071282564533 L92.2614487329534,36.0975363259081 L92.7938266332396,36.0848218506407 L92.913473105625,36.3511738068761 L93.3076218389041,36.3593241115371 L92.968895177302,36.2357654929174 L92.9525945679849,35.9260539158954 L92.3615344741588,35.2130652643798 L91.1751761280842,35.0953748651156 L91.1018233861583,34.335114446578 L91.2834121739477,34.050179795722 L91.6094243602827,34.355327202133 L92.1535386992769,34.4430244802559 L92.913473105625,34.9375849669292 L94.5435340373026,34.8244587382691 L94.6664406315512,34.335114446578 L94.1555795355632,34.2731721311754 L93.8243511542461,34.402272956965 L93.9417155413268,33.9588963835469 L93.58114606324,33.3414293026274 L93.6368941471036,33.0310657012366 L94.217521850967,32.6861448080935 L94.8695462236376,32.8139415851363 L95.1955584099736,32.5919272862418 L95.8475827826448,32.9492366424691 L96.1735949689802,32.4941236303425 L96.7027127474032,32.5019479228134 L97.1128360778129,32.7438489650751 L97.4776437143219,32.7334165751109 L97.5082888598376,32.4096864740817 L97.8124582296889,32.3790413285648 L96.9139686441486,32.2906920260685 L96.5794801409682,32.0530291422323 L96.5644835803961,31.7270169558952 L97.0065561050672,31.2559293466368 L97.4776437143221,30.8601505524286 L98.1296680869934,30.8656927595963 L98.8713458109067,30.5126215617945 L99.514893866733,30.4229682105515 L99.5442349635035,30.2074741553858 L100,30.0969560242168 L99.1200931090805,30.0969560242168 L98.2277977550802,30.5210978786386 L97.1516315279868,30.2576800320775 L96.8256193416515,30.5905384743288 L96.4996071553158,30.6224876685901 L95.8475827826448,31.2477790419805 L95.1574149841725,31.1131360090256 L94.9171440028429,30.7013826176833 L94.6918695820851,30.7489803968909 L94.5435340373026,31.1242204233608 L93.8915096646319,30.9240489409535 L93.4526972618237,30.9621923667512 L93.263284181563,31.0749925832257 L93.4491111277741,31.4010047695581 L93.2394852919601,31.587157727956 L92.9134731056253,31.1111799359079 L92.5874609192896,31.3123294548764 L92.1933121860093,31.1431291301669 L91.7140742720966,31.4010047695581 L91.7313529179719,31.7270169558952 L92.0955085301092,31.8929571587403 L92.3096985365312,32.4272911321434 L91.9096815838977,32.4047962912874 L91.0529215582084,31.6314953852992 L90.6313878012761,31.5920479107526 L90.4162197582947,31.8378610992497 L89.8642811268288,31.9379468404569 L89.7267039841951,32.4523940704904 L88.6753146832632,32.4703247407399 L88.3493024969275,32.7940548417714 L87.3712659379207,32.7898166833482 L87.0452537515856,33.1132207721942 L86.2400036513366,33.2038521599937 L86.067217192579,33.4604237506383 L85.4151928199077,33.4760723355846 L85.0891806335724,33.8121908996957 L83.7851318882298,33.8930419219066 L83.4147820445533,34.335114446578 L83.5530112115595,34.5672351232489 L84.1111440745657,34.7709927397084 L84.4371562609011,34.4410684071382 L84.6689509253862,34.6611266329128 L83.5533372237456,36.0593929001058 L83.005310738516,36.1633907875484 L83.1754890997832,36.6595813351515 L82.8745798517954,36.9432119372631 L82.8465428037701,37.3086715981445 L82.5977955055964,37.3859364863055 L82.1550709565528,37.9776486045046 L81.7615742476455,37.9887330188399 L81.7384273824154,37.2692241235978 L81.0740145466639,36.3942074154749 L80.5250100248749,36.1976220671129 L79.220961279533,36.1474161904212 L78.894949093197,35.8057554191355 L77.2648881615194,35.7725021761322 L77.0252692045629,36.051568607635 L76.4769167071466,36.1552404828897 L75.6348272298421,37.0413416053502 L75.3088150435062,36.7322820527061 L74.6567906708355,36.7599930885418 L74.5348621131461,37.0651404949528 L75.0796284765127,37.2692241235978 L74.6567906708355,37.6809775149401 L73.352741925493,37.7008642583073 L73.0267297391579,37.3891966081699 L72.8206900373937,37.5952363099349 L72.8894786087109,38.0584996267179 L73.7589531096674,38.2472606826045 L73.4026217900026,38.6231527334477 L72.8454669635555,38.7180222796751 L72.7007175528223,38.9674216022198 L72.3747053664867,38.6531458545936 L71.5658691321881,38.7424731936464 L71.5658691321881,39.0560969169039 L72.1240019951946,39.2252972416111 L71.2307286046355,39.3853692251054 L71.1508556189831,39.5513094279482 L71.4592631472562,39.8773216142829 L71.1922591666478,39.9989241597848 L71.1296648268713,40.5293459869548 L70.535670623368,40.9723965481804 L70.1552144019143,41.5073825459614 L70.2008561080015,42.3771830591045 L70.4688381251692,42.4854191049657 L70.450255430548,43.1690666597133 L70.0561066972683,43.1739568425076 L69.978841809107,42.9252095443338 L69.7666078758024,42.8681574117232 L68.9398409712558,42.9627009457627 L68.8570338759269,43.7894678503094 L68.4667972888829,44.4457303814022 L67.8105347577892,44.3922643828415 L67.6181875678516,44.5751572193772 L66.9361700740376,44.767504409316 L67.1008062281369,45.4195287819855 L65.2259101445213,45.4430016594027 L65.2024372671053,45.7830323697515 L64.5129214930054,45.7455409683226 L64.8073104972664,45.6764263848179 L64.8764250807694,45.4152906235623 L65.4704192842729,45.3614986128184 L65.5010644297884,45.0661315719982 L66.4145505759011,44.6755689727698 L66.5064860124472,44.3929164072171 L66.9886580360374,44.2716398739007 L67.7704352588704,43.4233561650547 L68.3399785483983,43.3408750819115 L68.7412995497775,42.764159524283 L69.3043225955789,42.6751581974134 L69.3907158249577,42.1095270541224 L69.6133821482247,42.0061811910509 L69.7082516944486,41.4490263646087 L69.9987285524731,41.181370359622 L69.3574625819512,40.5293459869548 L69.6583718299395,40.20333380062 L69.4405956894674,39.6641096444204 L69.1846761231938,39.9474142343441 L68.7885713167958,39.9643668680348 L68.2887946351437,40.3555814916365 L68.2040314666965,40.8553581732918 L67.9295292058018,40.9743526213004 L67.8649787929073,41.5073825459637 L67.5878684345219,41.610728409026 L67.5181018266465,41.8669739874873 L66.2874058232301,41.9403267294129 L65.8544616397765,42.5558377372147 L64.9758587976017,42.5848528217971 L64.9060921897263,43.1671105865956 L64.0007563482725,43.2398113041502 L63.92446949667,44.1415610115523 L63.8116692801975,43.8761870918734 L63.5723763354277,43.8328274710914 L63.3330833906573,43.8761870918757 L63.2463641490918,44.1601437061729 L62.6781249083091,44.1992651685316 L62.6295490925453,45.4195287819855 L62.3367901492156,45.4879913411169 L62.2908224309423,45.7680358091786 L62.1962788969051,45.4915774751668 L60.9642788447435,45.4596282809055 L60.718465656246,45.4997277798231 L60.3363793738612,46.0956780564455 L59.9862422857369,46.1021983001743 L60.2389017301469,45.9982004127318 L60.2884555824693,45.3957298923852 L61.2120481063581,45.3412858572633 L61.591526291253,44.7427274831545 L62.1930187750421,44.692195594275 L62.243550663924,44.4167152968197 L62.5200089979369,44.3671614444944 L62.5685848137004,44.0897250739238 L62.8411310014774,44.0362590753677 L62.8926409269178,43.7617568144713 L63.1619269928309,43.7050306940485 L63.1619269928309,43.2218806338984 L62.8662339398247,43.1374434776375 L62.8844906222597,42.7755699508061 L63.4530558752287,42.6921108311041 L63.572376335428,42.4228247651898 L64.4043594349561,42.3393656454878 L64.8180688994153,41.7750385509412 L65.3413184584839,41.6462637373418 L65.4058688713784,41.0584637653757 L65.9662838196891,40.9671803532029 L66.294252079143,40.5293459869548 L66.2714312260995,40.2033338006177 L65.7582880448069,40.4331723919854 L65.3253438613539,40.9779387553503 L64.7287415603596,41.0336868392142 L64.2244007080987,41.5823653488146 L64.0640027124215,41.015756168967 L63.5723763354277,40.9381652686182 L63.0543429713408,41.3153613682081 L62.9620815226074,41.5491121058112 L62.7126822000609,41.6257249696012 L62.6321571900358,41.8712121459106 L62.0469653155634,41.9380446441097 L61.6163032174145,42.5294307501187 L61.5745736575635,42.1594069186309 L61.8572262231162,42.0743177379967 L61.9133003191657,41.8043796477114 L62.5030563642471,41.742111320121 L62.5630426065325,41.4760853760711 L62.8238523556012,41.4108829388042 L63.2463641490921,40.8080864062721 L64.224400708099,40.7996100894256 L64.4389167267076,40.7438620055617 L64.550412894434,40.471315817783 L65.0808347216019,40.4077434414505 L65.4241255538135,39.8773216142829 L65.4489024799749,39.2252972416111 L65.8097979702481,38.8546213857453 L66.2368739343474,39.1688971333738 L66.325875261217,39.7319201791737 L66.5064860124475,39.8046208967306 L66.8324981987829,39.4828468688168 L67.3521616238019,39.4189484802965 L67.4414889628576,39.1822636330146 L68.0146183864354,39.1033686839213 L68.0967734573921,38.8595115685442 L68.6190449799011,38.729758718379 L68.7885713167958,38.5015501879458 L69.4405956894677,38.4865536273752 L69.7196621209699,38.2003149277725 L70.2859452886351,38.1145737227673 L70.6957426068588,37.546334481983 L71.2320326533807,37.4306001558342 L73.8358919856423,34.6611266329128 L73.6787541118289,34.1688482315474 L72.3747053664864,34.1290747448153 L72.1151996661638,34.4016209325916 L71.5688032418655,34.507248880964 L71.4488307572935,35.0393007690639 L70.899826235505,35.1423206199452 L70.4662300276787,35.686760971127 L70.0926200621381,35.4184529417715 L69.7666078758024,35.7069737266797 L69.1145835031312,35.7206662385013 L68.8371471325602,36.0137511940206 L68.2662997942866,36.094928228417 L68.1776244796031,36.3325911122555 L67.5989528488577,36.4056178419956 L67.4845225714541,36.6719697982334 L66.94040823246,36.7251097846039 L66.5064860124475,37.3184519637353 L64.550412894434,37.3155178540564 L64.8079625216392,36.9432119372631 L64.4741260428315,36.6171997509283 L64.4943387983846,35.9091012822093 L66.3037064325466,35.7623957983535 L66.6134180095652,35.3131510055846 L66.5064860124472,34.7830551906025 L66.3193550174906,35.1260200106256 L65.8544616397765,35.4409477826298 L63.898388521763,35.391067918119 L63.6212781633779,35.6880650198713 L63.0478227276138,35.766633956779 L62.9607774738622,36.0056008893619 L62.7107261269426,36.0815617287809 L62.6282450437998,36.6511050183073 L62.365153209427,36.7140253702687 L62.2683275900854,37.3122577321944 L60.6115336591286,37.295957122877 L60.6102296103828,34.6330895848869 L60.8540867257617,34.5509345139316 L60.9362417967185,33.9810652122197 L61.1827070095878,33.9015182387531 L61.5028509765695,33.2436256467281 L61.88982744175,33.0310657012366 L61.91558240447,32.0262961429508 L62.1878025800609,31.9725041322069 L62.2412685786193,31.6999579444282 L62.5128367298371,31.645513909311 L62.5669547527685,31.3736197459079 L62.8381968918,31.3188496986029 L62.8926409269178,31.0472815473853 L63.1632310415765,30.9918594757069 L63.2186531132534,30.7212693610506 L63.488591203539,30.6651952649965 L63.8700254615519,30.0685929640054 L64.4398947632665,29.9864378930524 L64.8474099961858,29.4159165669625 L65.1147399889809,29.357234373422 L65.1714661094034,29.0879483075077 L65.4221694806957,29.0126394924667 L65.4971522835524,28.4355979226503 L65.7507897645213,28.3632232172813 L65.8172962505337,27.7777053306254 L66.1123372791675,27.4888585335317 L66.1067950719996,26.1848097881903 L66.363692674832,26.0420164505745 L66.4614963307327,25.4877957338042 L66.6923129586587,25.3929261875838 L66.7725119564975,24.5547488565142 L67.0320176568206,24.4282561282157 L67.1171068374536,23.8613209361803 L67.6423124696403,23.7345021956917 L68.4185474853048,22.880676279678 L68.9792884458021,22.7893928675052 L69.1145835031315,22.5298871671841 L69.627074660051,22.4591425227449 L70.042414185442,21.8964454891328 L70.5976129387717,21.7996198697923 L71.0155605616541,21.2395309336666 L72.0486931801513,21.2004094713055 L72.9673955212447,20.2572562162391 L73.6787541118289,20.2096584370338 L74.0047662981645,19.7111858041252 L74.8321852270836,19.5139484313898 L75.8682519552583,18.9199542278897 L76.3823731731095,18.7820510730705 L76.5176682304382,18.5916599562494 L77.0282033142398,18.4498446551925 L77.4911406188366,17.9347454007833 L78.0277566775449,17.8193370868177 L78.1340366502901,17.599604873231 L78.614578612949,17.4281224632183 L78.6986897570234,16.8602092346241 L79.2460642178808,16.4295471364735 L79.2861637168002,15.8176222627193 L79.5580578802035,15.7635042397898 L79.565230148303,15.4446643215526 L79.8530989088373,15.4264076391175 L79.5283907712469,15.4078249444947 L79.4498218343403,15.6552681939264 L79.179231719682,15.7106902656025 L79.0455667232842,16.2290496418737 L78.5689369068617,16.3473920655159 L78.0450353234202,16.2763214088958 L77.5909003478551,15.8867368462239 L76.7667415407992,15.7524198254546 L77.0898196174577,16.4044441981241 L77.7108728324265,16.6104838998869 L77.7265214173708,16.8660774539749 L77.4168098403519,17.2083902496316 L76.9388759751841,17.2898932962113 L76.6128637888487,17.5689597277164 L75.6348272298418,17.3045638445941 L75.1702598643139,17.3824807571331 L75.0072537711465,17.7329438574415 L74.3307784844996,17.6181875678516 L73.739066366301,17.7084929434678 L74.1651642938412,17.8741071341251 L74.2613378888106,18.1039457254928 L74.772851009171,18.2444569778054 L74.6567906708355,18.5271095433558 L74.0047662981648,18.5202632874415 L73.7993786207734,18.8071540114198 L73.352741925493,18.7983516823855 L73.0267297391579,19.0591614314556 L72.4311054747228,19.0689417970419 L72.3747053664867,19.2518346335799 L72.0486931801513,19.1817420135141 L71.7226809938157,19.3023665224618 L71.3966688074803,18.8619240587226 L70.7625751050577,18.668598832225 L68.7885713167961,18.5212413240004 L68.6480600644853,18.2200060638248 L69.1497928192554,18.069714445926 L69.1145835031315,17.7795636000879 L69.0770921017028,17.9970137283737 L68.545040213603,17.9520240466572 L68.467775325442,17.7032767484858 L68.1365469441248,17.683716017304 L67.1585103851179,17.9220309255159 L66.8324981987829,17.7022987119269 L65.9578075028446,17.9311592667311 L64.8764250807694,17.7974942703351 L64.224400708099,17.9507199979151 L63.8983885217636,17.8558504516924 L63.8873041074278,18.0234207154674 L63.697239002794,18.0345051298026 L64.4728219940866,18.1120960301515 L64.5409585410304,18.3699716695427 L64.7975301316767,18.4394122652306 L65.5284494534403,19.0881765160381 L66.1804738261119,19.1520749045583 L66.4575841844967,19.3874557030959 L67.053534461118,19.4435297991454 L67.0408199858512,19.872887848547 L66.7614275421616,19.9905782478182 L66.6437371428949,21.1058659372683 L65.8544616397765,21.0579421458776 L65.5284494534403,21.3780861128569 L65.2024372671056,20.7472525323013 L64.8764250807696,20.7495346176022 L64.4881445668442,21.0308831344105 L64.1151866256763,20.6426026204877 L64.0317275059744,20.1832514499401 L63.572376335428,19.9087491890461 L63.1629050293901,19.9071191281139 L62.5943397764214,20.4313467237405 L62.4469822681977,20.3165904341506 L62.6174866416512,19.9674313825866 L62.2683275900854,19.6032757704495 L61.9168864532161,19.6391371109486 L61.4735098797992,19.8477849101977 L61.2902910310785,20.2768169474185 L61.0467599278863,20.2341093510075 L61.113918438271,19.8142056550065 L61.4141756618863,19.7884506922885 L61.4845942941347,19.6645660614811 L60.9959020268178,19.3069306930705 L60.6382666584075,19.2358600364481 L60.462546089973,19.0125416888092 L60.9642788447435,18.4550608501746 L61.3453870905697,18.3605173161374 L61.2769245314392,18.0478716294411 L60.8439803479859,17.8287914402254 L60.6382666584078,17.4072576832923 L59.9448387380722,18.3191137684707 L60.17989352442,18.6865295024745 L59.6602300994012,19.1771778429076 L59.3342179130653,18.9202802400753 L58.8709545962829,18.8237806329203 L58.3561813540596,18.2125077835418 L57.741974395003,18.3226999025253 L57.6872043476988,18.0345051298026 L57.7537108337113,18.6369756501515 L58.4787619361215,18.8899611067462 L58.6759993088542,19.6645660614811 L58.4993007038606,19.9905782478158 L59.00820572673,20.0900119646473 L59.22174370878,20.3165904341506 L58.8432435604443,20.6426026204877 L59.1793621245563,20.9686148068225 L58.9149662414386,21.3875404662622 L59.4313695445936,21.5234875479637 L59.7785725230411,21.9466513658291 L59.7430371947301,22.3554706474925 L59.527869151749,22.4663147908447 L59.4046365453143,22.9951065570847 L59.1845783195378,23.1010605176427 L59.0694960177609,23.6380025885368 L58.6821935403946,23.997594030065 L57.3781447950524,24.0191108343644 L56.7261204223811,24.772851009171 L54.4440351180325,24.6975421941276 L54.1180229316972,24.3020894121027 L53.2498524794859,24.1188705633814 L53.1399863726908,23.9170690200396 L52.9554634752249,24.2287366701771 L53.3368977332375,24.3578374959689 L53.4659985590259,24.7030844012929 L53.8366744148899,24.8360973733202 L53.9677313137966,25.2067732291837 L53.7920107453615,25.3906441022783 L53.3698249640574,25.1105996342143 L52.8139741863552,25.4014025044257 L52.1619498136842,24.7891516184883 L51.3433332137957,24.7213410837303 L50.5318888820069,24.2313447676704 L50.0682995530376,24.3663138128108 L49.5571124448633,24.225476548315 L49.3986705223046,23.9027244838423 L48.6729673955211,23.8055728523117 L48.0085545597696,23.1659369427241 L47.5977792049862,23.3651303885749 L47.2642687383655,23.2507001111705 L47.6359226307879,21.2946269931572 L46.5486719893589,20.7136732771078 L46.5639945621168,20.3165904341506 L46.9457548323161,20.234435363193 L47.2717670186512,20.4411270893314 L48.0346355346764,20.4274345775051 L48.2481735167264,20.3165904341529 L47.7050372142914,19.9905782478158 L47.5977792049865,19.6335949037786 L47.7558951153593,19.338553875144 L48.2498035776578,19.239446170498 L48.4147657439437,18.8514916687584 L48.991155289385,18.6865295024721 L49.0560317144656,18.3605173161374 L48.9018279503293,18.3481288530578 L48.8861793653848,18.6708809175305 L47.969107085223,18.6412138085724 L47.8520687103281,18.941145019999 L47.2297114466138,18.9704861167693 L46.9457548323161,19.1993466715804 L45.6417060869736,19.1664194407579 L45.5187994927253,18.8896350945606 L46.0228143327995,18.6865295024721 L46.1721279141415,18.2389147706355 L46.548998001545,18.0345051298026 L45.9677182733089,17.6628512373826 L45.8096023629367,17.8763892194307 L45.5132572855571,17.836941744884 L45.3857865207003,17.056468570796 L45.7245131823028,16.8132634797899 L45.829489106303,16.4044441981241 L45.6417060869738,16.0816921336538 L45.3965449228497,16.4852952203351 L44.8879659121659,16.6287405823242 L44.7862501100291,16.853036966522 L43.9347062793204,16.8073952604344 L43.9288380599667,16.3216371027955 L44.2313773688861,16.0784320117894 L44.2199669423645,14.0046684945097 L44.6636695279669,13.6209521511909 L44.9896817143023,13.8442704988322 L45.3786142526005,13.7963467074414 L45.0555361759423,13.7304922458011 L45.0170667379548,13.4426234852663 L44.43741707065,13.0445626057502 L44.168457016923,12.6614982868072 L44.1185771524142,12.1662857757629 L44.4123141323024,11.5142614030934 L44.3376573416316,10.5349207953378 Z\" / fill=\"darkblue\"><\/svg><\/div><span class=\"legend-text\">15 minutes<\/span><\/div><\/div>","css":"\n    @import url('https://fonts.googleapis.com/css2?family=Open+Sans&display=swap');\n    #legend-5aec5 h2 {\n      font-size: 14px;\n      font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      line-height: 20px;\n      margin-bottom: 10px;\n      margin-top: 0px;\n      white-space: nowrap;\n      max-width: 100%;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    #legend-5aec5 {\n      position: absolute;\n      border-radius: 10px;\n      margin: 10px;\n      max-width: 250px;\n      background-color: #ffffff80;\n      padding: 10px 20px;\n      z-index: 1002;\n    }\n    #legend-5aec5.top-left {\n      top: 10px;\n      left: 10px;\n    }\n    #legend-5aec5.bottom-left {\n      bottom: 10px;\n      left: 10px;\n    }\n    #legend-5aec5.top-right {\n      top: 10px;\n      right: 10px;\n    }\n    #legend-5aec5.bottom-right {\n      bottom: 10px;\n      right: 10px;\n    }\n    #legend-5aec5 .legend-item {\n      display: flex;\n      align-items: center;\n      margin-bottom: 5px;\n      font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      white-space: nowrap;\n      max-width: 100%;\n      overflow: hidden;\n    }\n    #legend-5aec5 .legend-patch-container {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      margin-right: 5px;\n    }\n    #legend-5aec5 .legend-color {\n      display: inline-block;\n      flex-shrink: 0;\n    }\n    #legend-5aec5 .legend-shape-line {\n      align-self: center;\n      image-rendering: pixelated;\n      image-rendering: -moz-crisp-edges;\n      image-rendering: crisp-edges;\n      transform: translateZ(0);\n      -webkit-transform: translateZ(0);\n    }\n    #legend-5aec5 .legend-shape-hexagon {\n      display: block;\n    }\n    #legend-5aec5 .legend-shape-custom {\n      display: block;\n    }\n    #legend-5aec5 .legend-text {\n      flex-grow: 1;\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n  \n#legend-5aec5 {\n  background-color: rgba(255, 255, 255, 0.70) !important;\n}\n","target":"compare","add":false}]},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="compare-container-31017">{"viewer":{"width":"100%","height":"100vh","padding":0,"fill":false},"browser":{"width":"100%","height":"100vh","padding":0,"fill":false}}</script>
</body>
</html>
